'use strict';
"use strict";
window.parseTimeMarkers = window.parseTimeMarkers || {};
window.parseTimeMarkers['powerbiportal.explore.bundle.min.js'] = {
    nominalStart: Date.now(),
    start: Date.now()
};
var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},__extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}})(),__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return i([e,t])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,a=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){l.label=r[1];break}if(6===r[0]&&l.label<o[1]){l.label=o[1],o=r;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(r);break}o[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],a=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=t.get("Embed_Updated"),i=r+" "+e.lastRefreshTime,n={snapshotId:e.objectId,reportId:e.reportId,name:e.snapshotName,date:i,resourceUri:e.resourceAbsoluteUri,culture:e.snapshotCulture,size:{height:e.snapshotHeight,width:e.snapshotWidth},type:e.type,metadata:e.metadata,hostUri:e.hostUri,embedType:e.embedType,disabled:e.disabled,createDate:e.createDate,workspaceName:e.workspaceName,publisherUserName:e.publisherUserName,uniqueId:e.uniqueId};return n}function r(e){return{snapshotEmbedResource:e.snapshotEmbedResource,options:{name:e.options.name,culture:e.options.culture,version:e.options.version,type:e.options.type,size:e.options.size,reportId:e.options.reportId,metadata:e.options.metadata,embedType:e.options.embedType}}}e.convertEmbed=t,e.serializeEmbedCreationRequest=r})(t=e.EmbedSerializer||(e.EmbedSerializer={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function r(r,i,n,a,o,s,l,u,c,p,f){var d=t.CustomerAction(n,a,o,s,l,u,c,p,f),h=C(d.info,{visualType:r,isEnabled:i}),m={name:"PBI.EX.ToggleSeeData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({visualType:h.visualType,isEnabled:h.isEnabled},null,d.formatted())},info:h,loggers:t.EXToggleSeeDataLoggers};return m}function i(r,i,n,a,o,s,l,u,c,p){var f=t.Verbose(i,n,a,o,s,l,u,c,p),d=C(f.info,{fromCache:r}),h={name:"PBI.EX.GetExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({fromCache:d.fromCache},null,f.formatted())},info:d,loggers:t.EXGetExplorationLoggers};return h}function n(r,i,n,a,o,s,l,u,c,p){var f=t.Verbose(i,n,a,o,s,l,u,c,p),d=C(f.info,{code:r}),h={name:"PBI.EX.VisualQueryGeneratorWarning",category:e.TelemetryCategory.Verbose,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({code:d.code},null,f.formatted())},info:d,loggers:t.EXVisualQueryGeneratorWarningLoggers};return h}function a(r,i,n){var a={code:r,debugInfo:i,message:n},o={name:"PBI.EX.VisualQueryGeneratorError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({code:a.code,debugInfo:a.debugInfo,message:a.message},null)},info:a,loggers:t.EXVisualQueryGeneratorErrorLoggers};return o}function o(r,i,n,a,o,s,l,u,c,p,f,d,h,m,v,g,b,w,E,F){var P=t.CustomerAction(d,h,m,v,g,b,w,E,F),V=C(P.info,{action:r,editor:i,dataType:n,groupCount:a,totalGroupCount:o,groupedValues:s,groupedValuesMin:l,groupedValuesMax:u,ungroupedValues:c,isOtherEnabled:p,hasGroupOnKeys:f}),D={name:"PBI.EX.Groups.GroupsAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({action:x[V.action],editor:S[V.editor],dataType:V.dataType,groupCount:V.groupCount,totalGroupCount:V.totalGroupCount,groupedValues:V.groupedValues,groupedValuesMin:V.groupedValuesMin,groupedValuesMax:V.groupedValuesMax,ungroupedValues:V.ungroupedValues,isOtherEnabled:V.isOtherEnabled,hasGroupOnKeys:V.hasGroupOnKeys},null,P.formatted())},info:V,loggers:t.EXGroupsGroupsActionLoggers};return D}function s(r,i,n,a,o,s,l,u,c,p,f,d,h,m){var v=t.CustomerAction(s,l,u,c,p,f,d,h,m),g=C(v.info,{action:r,editor:i,sourceDataType:n,binSize:a,binUnit:o}),b={name:"PBI.EX.Groups.BinBySizeAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({action:x[g.action],editor:S[g.editor],sourceDataType:g.sourceDataType,binSize:g.binSize,binUnit:F[g.binUnit]},null,v.formatted())},info:g,loggers:t.EXGroupsBinBySizeActionLoggers};return b}function l(r,i,n,a,o,s,l,u,c,p,f,d,h,m,v){var g=t.CustomerAction(l,u,c,p,f,d,h,m,v),b=C(g.info,{action:r,editor:i,sourceDataType:n,binCount:a,min:o,max:s}),w={name:"PBI.EX.Groups.BinByCountAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({action:x[b.action],editor:S[b.editor],sourceDataType:b.sourceDataType,binCount:b.binCount,min:b.min,max:b.max},null,g.formatted())},info:b,loggers:t.EXGroupsBinByCountActionLoggers};return w}function u(r,i,n,a,o,s,l,u,c,p,f,d,h,m){var v=t.CustomerAction(s,l,u,c,p,f,d,h,m),g=C(v.info,{visualType:r,role:i,sourceRole:n,action:a,groupType:o}),b={name:"PBI.EX.Groups.Usage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({visualType:g.visualType,role:g.role,sourceRole:g.sourceRole,action:x[g.action],groupType:E[g.groupType]},null,v.formatted())},info:g,loggers:t.EXGroupsUsageLoggers};return b}function c(r,i,n,a){var o={errorType:r,action:i,groupType:n,message:a},s={name:"PBI.EX.Groups.Error",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({errorType:w[o.errorType],action:x[o.action],groupType:E[o.groupType],message:o.message},null)},info:o,loggers:t.EXGroupsErrorLoggers};return s}function p(r,i,n,a,o,s,l,u,c,p){var f=t.CustomerAction(i,n,a,o,s,l,u,c,p),d=C(f.info,{operation:r}),h={name:"PBI.EX.ModelChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({operation:d.operation},null,f.formatted())},info:d,loggers:t.EXModelChangeLoggers};return h}function f(r,i,n,a,o,s,l,u,c,p,f){var d=t.CustomerAction(n,a,o,s,l,u,c,p,f),h=C(d.info,{message:r,actionId:i}),m={name:"PBI.EX.Measures",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({message:h.message,actionId:h.actionId},null,d.formatted())},info:h,loggers:t.EXMeasuresLoggers};return m}function d(r,i,n,a,o,s,l,u,c,p,f){var d=t.CustomerAction(n,a,o,s,l,u,c,p,f),h=C(d.info,{sourceType:r,targetType:i}),m={name:"PBI.EX.ReportMeasureDataTypeChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({sourceType:h.sourceType,targetType:h.targetType},null,d.formatted())},info:h,loggers:t.EXReportMeasureDataTypeChangeLoggers};return m}function h(r,i,n,a,o,s,l,u,c,p,f,d){var h=t.CustomerAction(a,o,s,l,u,c,p,f,d),m=C(h.info,{dataType:r,sourceTypes:i,targetTypes:n}),v={name:"PBI.EX.ReportMeasureMoveRoleKind",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({dataType:m.dataType,sourceTypes:m.sourceTypes,targetTypes:m.targetTypes},null,h.formatted())},info:m,loggers:t.EXReportMeasureMoveRoleKindLoggers};return v}function m(r,i,n,a,o,s,l,u,c,p){var f=t.CustomerAction(i,n,a,o,s,l,u,c,p),d=C(f.info,{daxTemplateName:r}),h={name:"PBI.EX.QuickCalcMeasureEdited",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({daxTemplateName:d.daxTemplateName},null,f.formatted())},info:d,loggers:t.EXQuickCalcMeasureEditedLoggers};return h}function v(r,i,n,a,o,s,l,u,c,p){var f=t.CustomerAction(i,n,a,o,s,l,u,c,p),d=C(f.info,{daxTemplateName:r}),h={name:"PBI.EX.QuickCalcMeasureDeleted",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({daxTemplateName:d.daxTemplateName},null,f.formatted())},info:d,loggers:t.EXQuickCalcMeasureDeletedLoggers};return h}function g(r,i,n,a,o,s,l,u,c,p,f){var d=t.Verbose(n,a,o,s,l,u,c,p,f),h=C(d.info,{visualType:r,fixedRoleByProjectionCount:i}),m={name:"PBI.EX.VisualDrillableRoleActiveItemsFixed",category:e.TelemetryCategory.Verbose,time:Date.now(),id:y(),formatted:function(){return e.extendFormatted({visualType:h.visualType,fixedRoleByProjectionCount:h.fixedRoleByProjectionCount},null,d.formatted())},info:h,loggers:t.EXVisualDrillableRoleActiveItemsFixedLoggers};return m}var y,b=jsCommon.Utility,C=jsCommon.UnionExtensions.mergeUnionType;y=b?b.generateGuid:Function.prototype;var x;!(function(e){e[e.Create=0]="Create",e[e.Update=1]="Update",e[e.Delete=2]="Delete",e[e.Other=3]="Other"})(x=t.EditorAction||(t.EditorAction={}));var S;!(function(e){e[e.Visual=0]="Visual",e[e.Dialog=1]="Dialog",e[e.FieldList=2]="FieldList",e[e.FieldWell=3]="FieldWell",e[e.Other=4]="Other"})(S=t.EditorType||(t.EditorType={}));var w;!(function(e){e[e.DAX=0]="DAX",e[e.DQLimit=1]="DQLimit",e[e.ModelAuthoring=2]="ModelAuthoring",e[e.Other=3]="Other"})(w=t.GroupErrorType||(t.GroupErrorType={}));var E;!(function(e){e[e.List=0]="List",e[e.Bin=1]="Bin"})(E=t.GroupType||(t.GroupType={}));var F;!(function(e){e[e.Number=0]="Number",e[e.Year=1]="Year",e[e.Month=2]="Month",e[e.Day=3]="Day",e[e.Hour=4]="Hour",e[e.Minute=5]="Minute",e[e.Second=6]="Second"})(F=t.BinUnit||(t.BinUnit={})),t.EXToggleSeeData=r,t.EXGetExploration=i,t.EXVisualQueryGeneratorWarning=n,t.EXVisualQueryGeneratorError=a,t.EXGroupsGroupsAction=o,t.EXGroupsBinBySizeAction=s,t.EXGroupsBinByCountAction=l,t.EXGroupsUsage=u,t.EXGroupsError=c,t.EXModelChange=p,t.EXMeasures=f,t.EXReportMeasureDataTypeChange=d,t.EXReportMeasureMoveRoleKind=h,t.EXQuickCalcMeasureEdited=m,t.EXQuickCalcMeasureDeleted=v,t.EXVisualDrillableRoleActiveItemsFixed=g})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return void 0===e&&(e=[]),i.extendWithName(i.extendWithId(e))}var i=jsCommon.ArrayExtensions,n=e.data.DataReaderUtils;t.createDataSourceArray=r;var a;!(function(e){function t(e){return _.contains(Object.keys(e),"extends")}function r(e,t){if(!_.isEmpty(e)){var r,i=n.findSchemas(t);return r=i?_.filter(e,(function(e){return _.contains(i,e.name)})):e,a(r)}}function i(e,r){if(!_.isEmpty(e)){var i=n.findSchemas(r);return i?_.chain(e).filter((function(e){return _.contains(i,e.name)})).map((function(r){return t(r)?_.find(e,(function(e){return e.name===r.extends})):r})).uniq().value():_.filter(e,(function(e){return!t(e)}))}}function a(e){return _.map(e,(function(e){return e[n.readerType(e)]}))}e.isExtension=t,e.referenced=r,e.queried=i,e.dataReaderDataSources=a})(a=t.DataSource||(t.DataSource={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Categorical=0]="Categorical",e[e.Range=1]="Range",e[e.Advanced=2]="Advanced",e[e.Passthrough=3]="Passthrough",e[e.Visual=4]="Visual",e[e.TopN=5]="TopN",e[e.Include=6]="Include",e[e.Exclude=7]="Exclude",e[e.RelativeDate=8]="RelativeDate"})(t=e.FilterType||(e.FilterType={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.createDisplayNameGetter;!(function(e){function t(e){return _.filter(e,(function(e){return!e.transient}))}e.objectDescriptors={background:{displayName:i("PagePropertyPane_PageBackground"),properties:{color:{displayName:i("PagePropertyPane_PageBackgroundColor"),type:{fill:{solid:{color:!0}}}},image:{type:{image:{}}},transparency:{displayName:i("Visual_Background_Transparency"),type:{numeric:!0}}}}},e.filterTransient=t})(r=t.Section||(t.Section={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.SnapshotReportType="Report";var t;!(function(e){e[e.Static=0]="Static",e[e.Interactive=1]="Interactive"})(t=e.EmbedType||(e.EmbedType={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.createDisplayNameGetter,n=e.data.DataViewObjectDefinitions;!(function(r){function i(e){return e.type||t.VisualLink.Back}r.Bookmark="Bookmark",r.Back="Back",r.Type=e.createEnumType([{value:r.Back,displayName:function(e){return e.get("Visual_VisualLink_Back")}},{value:r.Bookmark,displayName:function(e){return e.get("Visual_VisualLink_Bookmark")}}]),r.getType=i,r.BookmarkNone=""})(r=t.VisualLink||(t.VisualLink={}));var a;!(function(e){function t(e){return!!e&&e.show===!1}e.isHidden=t})(a=t.VisualTitle||(t.VisualTitle={}));var o;!(function(e){function t(t,r){var i=__assign({},e.CommonObjectDescriptors);if(!r)return i;var n=r.getStylePresets(t);if(!n||!n.presets)return i;var a=r.getEnumFromStylePresets(n);return i.stylePresetName={displayName:n.sectionTitle,properties:{name:{displayName:n.sliceTitle,type:{enumeration:a}}}},i}function n(e,t){if(e){var r=t.serializeVisualContainer(e);return t.deserializeVisualContainer(r,!0)}}function a(e){return!!e.display&&"hidden"===e.display.mode}function o(e,t){t?e.display={mode:"hidden"}:e.display=void 0}e.CommonObjectDescriptors={title:{displayName:i("Visual_Title"),description:i("Visual_TitleDescription"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},text:{displayName:i("Visual_Title_Text"),description:i("Visual_Title_TextDescription"),type:{text:!0},suppressFormatPainterCopy:!0},fontColor:{displayName:i("Visual_Title_FontColor"),description:i("Visual_Title_FontColorDescription"),type:{fill:{solid:{color:!0}}}},background:{displayName:i("Visual_Title_BackgroundColor"),description:i("Visual_Title_BackgroundColorDescription"),type:{fill:{solid:{color:{nullable:!0}}}}},alignment:{displayName:i("Visual_Title_Alignment"),description:i("Visual_Title_AlignmentDescription"),type:{formatting:{alignment:!0}}},fontSize:{displayName:i("Visual_TextSize"),description:i("Visual_TextSizeDescription"),type:{formatting:{fontSize:!0}}},fontFamily:{displayName:i("Visual_FontFamily"),type:{formatting:{fontFamily:!0}}}}},background:{displayName:i("Visual_Background"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},color:{displayName:i("Visual_Background_Color"),description:i("Visual_Background_ColorDescription"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:i("Visual_Background_Transparency"),description:i("Visual_Background_TransparencyDescription"),type:{numeric:!0}}}},lockAspect:{displayName:i("Visual_BasicShape_LockAspect"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}}}},general:{displayName:i("Visual_General_Properties"),properties:{x:{displayName:i("Visual_General_Properties_X_Coordinate"),type:{numeric:!0}},y:{displayName:i("Visual_General_Properties_Y_Coordinate"),type:{numeric:!0}},width:{displayName:i("Visual_General_Properties_Width"),type:{numeric:!0}},height:{displayName:i("Visual_General_Properties_Height"),type:{numeric:!0}},altText:{displayName:i("Visual_General_Properties_Description"),placeHolderText:i("Visual_General_Properties_Description_Placeholder"),type:{formatting:{altText:!0}}},allowBinnedLineSample:{displayName:i("Visual_General_HighDensitySampling"),description:i("Visual_General_HighDensitySamplingDescription"),type:{bool:!0}},allowOverlappingPointsSample:{displayName:i("Visual_General_HighDensitySampling"),description:i("Visual_General_HighDensitySamplingDescription"),type:{bool:!0}}}},border:{displayName:i("Visual_Border"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},color:{displayName:i("Visual_Border_Color"),type:{fill:{solid:{color:!0}}}}}},visualLink:{displayName:i("Visual_VisualLink"),properties:{show:{displayName:i("Visual_Show"),type:{bool:!0}},type:{displayName:i("Visual_VisualLink_Type"),description:i("Visual_VisualLink_Type_Description"),type:{enumeration:r.Type}},bookmark:{displayName:i("Visual_VisualLink_Bookmark"),description:i("Visual_VisualLink_Bookmark_Description"),type:{reference:{bookmark:!0}}}}}},e.getObjectDescriptors=t,e.clone=n,e.isHidden=a,e.setHidden=o})(o=t.VisualContainer||(t.VisualContainer={}));var s;!(function(e){function t(e){if(e){var t={visualType:e.visualType};e.stylePresetName&&(t.stylePresetName=_.cloneDeep(e.stylePresetName)),e.altText&&(t.altText=_.cloneDeep(e.altText)),e.aspectRatio&&(t.aspectRatio=_.cloneDeep(e.aspectRatio)),e.background&&(t.background=_.cloneDeep(e.background)),e.title&&(t.title=_.cloneDeep(e.title)),e.border&&(t.border=_.cloneDeep(e.border)),e.columnProperties&&(t.columnProperties=_.cloneDeep(e.columnProperties)),e.query&&(t.query=e.query.clone()),e.queryOptions&&(t.queryOptions=_.cloneDeep(e.queryOptions)),e.objects&&(t.objects=n.clone(e.objects));var r=e.conversionSourceContext;if(r){var i={};i.visualType=r.visualType,r.query&&(i.query=r.query.clone()),t.conversionSourceContext=i}return t}}function r(e,t){if(!e||!e.getCurrentVisual)return t.resolve();var r=e.getCurrentVisual();return r?r.enumerateObjectRepetitionAsync?r.enumerateObjectRepetitionAsync():r.enumerateObjectRepetition?t.resolve(r.enumerateObjectRepetition()):t.resolve():t.resolve()}e.clone=t,e.enumerateObjectRepetition=r})(s=t.SingleVisualConfig||(t.SingleVisualConfig={}));var l;!(function(e){function t(e){if(e.visualContainer)return e.visualContainer.config.singleVisual.visualType}e.getVisualType=t})(l=t.PinData||(t.PinData={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){switch(e){case 0:return"Default";case 1:return"DataFilter";case 2:return"HighlightFilter";case 3:return"NoFilter"}}e.toString=t})(t=e.VisualRelationshipFilterActionUtil||(e.VisualRelationshipFilterActionUtil={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=jsCommon.ArrayExtensions,i=e.data.ProjectionUtils,n=e.data.QueryProjectionCollection,a=e.data.QueryProjectionsByRole,o=e.data.SemanticQuery,s=e.data.transforms.plugins.KMeansClustering,l=e.data.transforms.plugins.SpatialClustering,u=e.data.SQExpr,c=e.data.SQExprBuilder,p=(function(){function e(e,t){this.defn=e,this.projections=t;for(var r in t)_.isEmpty(t[r].activeProjectionRefs)||this.ensureActiveItems(r)}return e.prototype.add=function(e,t,r){var i=r&&r.exprName,a=r&&r.index,o=this.defn.selectNameOf(e);o||(o=this.addSelect(e,i));var s=this.getRoleProjections(t);s||(s=[],this.projections[t]=new n(s));var l={queryRef:o};return null==a||a>s.length?(s.push(l),s.length-1):(s.splice(a,0,l),this.addNewQueryRefToActiveProjectionRefsIfNeeded(t,o,a),a)},e.prototype.removeExpr=function(t,r){if(r){for(var i=this.defn.select(),n=!1,a=i.length-1;a>=0;--a){var o=i[a].expr;if(e.areEqualIgnoringAggregate(o,t)){if(!this.removeAllProjectionsForExpr(o))return!1;n=!0}}return n}return this.removeAllProjectionsForExpr(t)},e.prototype.getQueryRef=function(e,t){var r=this.getRoleProjections(e);if(r&&!(t>=r.length))return r[t].queryRef},e.prototype.removeProjection=function(e,t){var r=this.getQueryRef(e,t),i=this.defn.select().withName(r).expr,n=this.getRoleProjections(e);n.splice(t,1);var a=this.projections[e].activeProjectionRefs;return _.pull(a,r),_.isEmpty(n)?delete this.projections[e]:a&&0===a.length&&a.push(n[Math.max(0,t-1)].queryRef),this.isUsed(r)||this.removeExpr(i,!1),!0},e.prototype.moveProjection=function(e,t,r,i){if(t===r)return!1;var n=this.getRoleProjections(e);if(!n||r+i>n.length)return!1;if(t<0||r<0)return!1;var a=this.projections[e].activeProjectionRefs,o=n.splice(t,i);n.splice.apply(n,[r,0].concat(o));var s=r;if(r>t&&(s+=i),a)if(s<a.length){var l=_.take(n,r+1);this.projections[e].activeProjectionRefs=_.map(l,(function(e){return e.queryRef}))}else if(t<a.length){for(var u=0,c=o;u<c.length;u++){var p=c[u];_.pull(a,p.queryRef)}0===a.length&&a.push(n[0].queryRef)}return!0},e.prototype.setAggregate=function(e,t,r,i){return this.updateExpression(e,t,(function(e){return c.setAggregate(e,r)}),i)},e.prototype.removeAggregate=function(e,t,r){return this.updateExpression(e,t,(function(e){return c.removeAggregate(e)}),r)},e.prototype.setPercentOfGrandTotal=function(e,t,r){var i=this.updateExpression(e,t,(function(e){return c.setPercentOfGrandTotal(e)}),r);return i},e.prototype.removePercentOfGrandTotal=function(e,t,r){var i=this.updateExpression(e,t,(function(e){return c.removePercentOfGrandTotal(e)}),r);return i},e.prototype.setPercentOfRoleTotal=function(e,t,r,i){var n=this.updateExpression(t,r,(function(t){return c.setPercentOfRoleTotal(t,e)}),i);return n},e.prototype.removePercentOfRoleTotal=function(e,t,r){var i=this.updateExpression(e,t,(function(e){return c.removePercentOfRoleTotal(e)}),r);return i},e.prototype.orderBy=function(e){this.defn=this.defn.orderBy(e)},e.prototype.removeOrderBy=function(e){this.defn=this.defn.removeOrderBy(e)},e.prototype.removeUnusedOrderBy=function(){for(var e=this.defn,t=e.orderBy(),r=0,i=t;r<i.length;r++){var n=i[r],a=n.expr,o=e.selectNameOf(a);o||(this.defn=e.removeOrderBy(a))}},e.prototype.addTransform=function(e,t,r){for(var i={},n=this.defn.transforms(),a=0,o=n;a<o.length;a++){var u=o[a];i[u.name]=!0}var p=jsCommon.StringExtensions.findUniqueName(i,e.name),f={algorithm:e.name,name:p,input:{parameters:t},output:void 0};this.defn=this.defn.transforms(n.concat([f]));for(var d=(e.name===s.name||e.name===l.name)&&r.grouping&&r.grouping.cluster,h=0,m=e.outputRoles;h<m.length;h++){var v=m[h],g=v.name;d&&(g=r.grouping.cluster.clusteringRole),this.add(c.transformOutputRoleRef(v.algorithmRole),g,{exprName:v.columnName?v.columnName:v.algorithmRole})}return p},e.prototype.removeTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(e){return e.name===t}));if(r){for(var i=0,n=e.outputRoles;i<n.length;i++){var a=n[i];this.removeExpr(c.transformOutputRoleRef(a.algorithmRole),!1)}this.defn=this.defn.removeTransform(r)}},e.prototype.updateTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(t){return t.name===e}));r&&(r.input.parameters=t)},e.prototype.clone=function(){return new e(this.defn,a.clone(this.projections))},e.prototype.equals=function(e){return!!o.equals(this.defn,e.defn)&&_.isEqual(this.projections,e.projections)},e.prototype.ensureDrillableRoles=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this.ensureActiveItems(n)&&t.push(n)}return t},e.prototype.ensureActiveItems=function(e){var t=this.projections[e];if(t){var r=t.all();return _.isEmpty(r)||t.activeProjectionRefs?void 0:(t.activeProjectionRefs=[r[0].queryRef],!0)}},e.prototype.toggleShowAll=function(e){var t=this.projections[e];t&&(t.showAll=!t.showAll)},e.prototype.roleContainsExpr=function(e,t){var r=this.projections[e],i=r&&r.all();if(_.isEmpty(i))return!1;for(var n=this.defn.select(),a=0,o=n;a<o.length;a++)for(var s=o[a],l=0,c=i;l<c.length;l++){var p=c[l];if(p.queryRef===s.name&&u.equals(t,s.expr))return!0}return!1},e.prototype.getRoleNameForExpr=function(e){var t=this.projections;for(var r in t){var i=this.tryGetExprs(r);if(i&&i.length>0)for(var n=0,a=i;n<a.length;n++){var o=a[n];if(u.equals(e,o))return r}}},e.prototype.tryGetExpr=function(e,t){var r=this.getRoleProjections(e);if(r){var n=r[t];return i.tryGetExprByProjection(this.defn,n)}},e.prototype.tryGetExprs=function(e){return i.tryGetExprs(this.defn,this.projections,e)},e.prototype.getUniqueQueryRefs=function(){var e=_.values(this.projections);return _.chain(e).map((function(e){return e.all()})).flatten(!0).map((function(e){return e.queryRef})).uniq().value()},e.prototype.currentDrillMode=function(e){var t=this.getRoleProjections(e),r=this.projections[e].activeProjectionRefs;if(!_.isEmpty(r)){if(r.length>1)return 2;if(r[0]!==t[0].queryRef)return 3}},e.prototype.addSelect=function(e,t){var r=this.defn;this.defn=r=r.addSelect(e,t);var i=r.select(),n=i.length-1;return i[n].name},e.prototype.removeAllProjectionsForExpr=function(e){var t=this.defn,r=t.selectNameOf(e);if(!r)return!1;var i=this.projections;for(var n in i){for(var a=i[n].all(),o=a.length-1;o>=0;o--){var s=a[o];if(s.queryRef===r){a.splice(o,1);var l=i[n].activeProjectionRefs;_.pull(l,r),l&&_.isEmpty(l)&&!_.isEmpty(a)&&l.push(a[Math.max(0,o-1)].queryRef)}}0===a.length&&delete i[n]}return this.defn=t.removeSelect(e).removeOrderBy(e),!0},e.prototype.updateExpression=function(e,t,i,n){var a=this.getRoleProjections(e);if(!a||t>=a.length)return!1;var o=a[t],s=this.defn,l=o.queryRef,u=s.select(),c=r.indexWithName(u,l),p=u[c].expr,f=i(p),d=s.selectNameOf(f);return d?(o.queryRef=d,this.isUsed(l)||(this.defn=s.removeSelect(p)),!0):(this.getUsageCount(l)>1?o.queryRef=this.addSelect(f):this.defn=s.setSelectAt(c,f),!0)},e.prototype.isUsed=function(e){return this.getUsageCount(e)>0},e.prototype.getUsageCount=function(e){var t=0,r=this.projections;for(var i in r){var n=r[i].all();t+=_.filter(n,(function(t){return t.queryRef===e})).length}return t},e.prototype.getRoleProjections=function(e){var t=a.getRole(this.projections,e);if(t)return t.all()},e.prototype.addNewQueryRefToActiveProjectionRefsIfNeeded=function(e,t,r){var i=this.getRoleProjections(e),n=this.projections[e].activeProjectionRefs;n&&(n.length>1&&r<n.length?n.splice(r,0,t):1===n.length&&0===r&&i.length>1&&i[1].queryRef===n[0]&&n.splice(0,1,t))},e.areEqualIgnoringAggregate=function(e,t){return u.equals(c.removeAggregate(e),c.removeAggregate(t))},e})();t.VisualQuery=p})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,r=jsCommon.StringExtensions.parseIntSubstrFast;!(function(e){function t(e){for(var t,n=0,a=0,o=0,s=0,l=0,u=0,c=e.length;l<=c;l++){var p=l===c?46:e.charCodeAt(l);switch(p){case 46:case 45:if(l===u)return;var f=r(e,u,l-u);if(null==f)return;switch(s){case 0:n=f;break;case 1:a=f;break;case 2:o=f;break;default:return}if(s++,u=l+1,45===p){if(3!==s)return;if(t=e.substr(l+1),!i(t))return;l=c}break;default:if(p<48||p>57)return}}var d={major:n,minor:a,patch:o};return t&&(d.prerel=t),d}function i(e){for(var t=0,r=e.length;t<r;t++){var i=e.charCodeAt(t);if(!(65<=i&&i<=90||97<=i&&i<=122||48<=i&&i<=57||45===i||46===i))return!1}return!0}function n(e){return _.isString(e)?e:null==e.prerel?e.major+"."+e.minor+"."+e.patch:e.major+"."+e.minor+"."+e.patch+"-"+e.prerel}function a(e,t){return c(u(e),u(t))>0}function o(e,t){return c(u(e),u(t))<0}function s(e,t){return e=u(e),t=u(t),!c(u(e),u(t))}function l(e,t){return a(u(e),u(t))?e:t}function u(r){return _.isString(r)?t(r)||e.Zero:r}function c(e,t){var r=p(e.major,t.major);return r?r:(r=p(e.minor,t.minor))?r:(r=p(e.patch,t.patch),r?r:f(e.prerel,t.prerel))}function p(e,t){e=e||0,t=t||0;var r=e-t;return 0===r?0:r<0?-1:1}function f(e,t){var i=_.isEmpty(e),n=_.isEmpty(t);if(i)return n?0:1;if(n)return-1;var a=r(e,0,e.length),o=r(t,0,t.length);return null!=a?null!=o?p(a,o):-1:null!=o?1:e.localeCompare(t)}e.Zero={major:0,minor:0,patch:0},e.ZeroStr="0.0",e.tryParse=t,e.toString=n,e.gt=a,e.lt=o,e.eq=s,e.max=l})(t=e.Version||(e.Version={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=jsCommon.ArrayExtensions,n=e.data.dsr;!(function(e){function t(e,t){return e.modelExtensions&&e.modelExtensions.withName(t)}function r(e,r){var i=t(e,r);if(!i)throw new Error("Unable to find expected model extension: "+r);return i}function a(e,t,r){e.modelExtensions||(e.modelExtensions=i.createWithName());var n=e.modelExtensions.withName(t);return n||(n=o(t,r),e.modelExtensions.push(n)),n}function o(e,t){return{name:e,extends:t,entities:i.createWithName()}}function s(e,t,r){var i=a(e,t,n.DefaultSchemaName);return c(i,r)}function l(e,t){return e.entities.withName(t)}function u(e,t,i){var n=r(e,t),a=l(n,i);if(!a)throw new Error("Unable to find expected entity: "+i);return a}function c(e,t){e.entities||(e.entities=i.createWithName());var r=e.entities.withName(t);return r||(r={name:t,extends:t,measures:i.createWithName()},e.entities.push(r)),r}function p(e,t){if(e.measures||(e.measures=i.createWithName()),e.measures.withName(t.name))throw new Error("Measure "+t.name+" already exists and cannot be added");e.measures.push(t)}function f(e,t,r,i){var n=u(e,t,r);return h(n,i)}function d(e,t){return e.measures.withName(t)}function h(e,t){var r=d(e,t);if(!r)throw new Error("Unable to find expected measure:"+t);return r}function m(e,t,r,i){var n=u(e,t,r),a=h(n,i),o=n.measures.indexOf(a);n.measures.splice(o,1),0===n.measures.length&&(delete n.measures,C(e,t,n))}function v(e,t,r){var i=null===r||void 0===r;i?y(e,t):g(e,t,r)}function g(e,t,r){e.annotations||(e.annotations=i.createWithName());var n=e.annotations.withName(t);n?n.value=r:(n={name:t,value:r},e.annotations.push(n))}function y(e,t){var r=e.annotations&&e.annotations.withName(t);if(r){var i=e.annotations.indexOf(r);e.annotations.splice(i,1),e.annotations&&0===e.annotations.length&&delete e.annotations}}function b(e,t){var r=e.annotations&&e.annotations.withName(t);if(r)return r.value}function C(e,t,i){if(!S(i)){var n=r(e,t),a=n.entities.indexOf(i);n.entities.splice(a,1),0===n.entities.length&&(delete n.entities,x(e,n))}}function x(e,t){if(!S(t)){var r=e.modelExtensions.indexOf(t);e.modelExtensions.splice(r,1),0===e.modelExtensions.length&&delete e.modelExtensions}}function S(e){var t=Object.keys(e),r=_.chain(t).filter((function(e){return"name"!==e&&"extends"!==e})).filter((function(t){return!(_.isArray(e[t])&&_.isEmpty(e[t]))})).value();return _.any(r)}function w(e){if(e){var t={Version:0,Name:e.name,Extends:e.extends};return e.entities&&(t.Entities=_.map(e.entities,(function(e){return E(e)}))),t}}function E(e){var t={Extends:e.extends,Name:e.name};return e.measures&&(t.Measures=_.map(e.measures,(function(e){return F(e)}))),t}function F(e){var t=e.dataType;return 6!==t&&9!==t||(t=7),{Name:e.name,Expression:e.expression,DataType:t}}e.getOptionalModelExtension=t,e.getExpectedModelExtension=r,e.getOrCreateModelExtension=a,e.createModelExtension=o,e.ensureEntityExists=s,e.findEntity=l,e.getExpectedEntity=u,e.getOrCreateExtendingEntity=c,e.addMeasure=p,e.getExpectedMeasure=f,e.findMeasureFromEntity=d,e.removeMeasure=m,e.setAnnotation=v,e.getAnnotationValue=b,e.toQueryExtensionSchema=w})(r=t.ModelExtensionUtils||(t.ModelExtensionUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(e){this.modelExtension=e,this.visited={}}return t.prototype.visitReference=function(t){if(t.schema===this.modelExtension.name){var r=e.ModelExtensionUtils.findEntity(this.modelExtension,t.entity);
if(r){var i=e.ModelExtensionUtils.findMeasureFromEntity(r,t.name);if(i){var n=this.toVisitedKey(t);if(!this.visited[n]){this.visitMeasure(this.modelExtension,r,i),this.visited[n]=!0;for(var a=0,o=i.references.measures;a<o.length;a++){var s=o[a];this.visitReference(s)}}}}}},t.prototype.visitMeasure=function(e,t,r){},t.prototype.toVisitedKey=function(e){return JSON.stringify(e)},t})();e.ModelExtensionDependencyVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(t,r,i){t[e.ExplorationDataReaderType]={name:"exploration",extends:"dsr",queryExtensionProvider:e.createExplorationQueryExtensionProvider(),schemaReader:function(t){return e.createConceptualSchemaReader(r,i)}}}e.ExplorationDataReaderType="exploration",e.registerExplorationDataReaderExtension=t})(t=e.dataReaderPlugins||(e.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(){return i}function i(e){return function(t){if(1===e.length){var r=e[0],i=r.getModelExtensions();if(i)return n.toQueryExtensionSchema(u.build(t,i.withName(r.schemaName)))}}}var n=e.explore.util.ModelExtensionUtils,a=e.explore.util.ModelExtensionDependencyVisitor,o=e.data.SQExpr,s=e.data.SQExprRewriter;t.createExplorationQueryExtensionProvider=r;var l=(function(e){function t(t){var r=e.call(this)||this;return r.dependencyVisitor=t,r}return __extends(t,e),t.prototype.visitMeasureRef=function(e){return o.isEntity(e.source)&&this.dependencyVisitor.visitReference({schema:e.source.schema,entity:e.source.entity,name:e.ref}),e},t})(s),u=(function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.build=function(e,r){var i=new t(r);return e.rewrite(new l(i)),i.result},t.prototype.visitMeasure=function(e,t,r){this.result=this.result||n.createModelExtension(e.name,e.extends);var i=n.getOrCreateExtendingEntity(this.result,t.name),a=n.findMeasureFromEntity(i,r.name);a||n.addMeasure(i,r)},t})(a)})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=jsCommon.ArrayExtensions,n=e.data.ConceptualSchema;!(function(t){function r(e,t,r){var a=new n;return a.name=e,a.extends=t,a.capabilities={canEdit:r,discourageQueryAggregateUsage:!1,isExtendable:!1,normalizedFiveStateKpiRange:!1,supportsMedian:!1,supportsPercentile:!1,supportsScopedEval:!1,supportsClustering:!1,supportsStringMinMax:!1,limitOnNumberOfGroups:null,supportsMultiTableTupleFilters:!1,supportsTimeIntelligenceQuickMeasures:!1,measureRestrictions:0,supportsBinByCount:!1,supportsCalculatedColumns:!1,supportsGrouping:!1,limitMultiColumnFiltersToQueryGroupColumns:!1,supportsBinnedLineSample:!1,supportsOverlappingPointsSample:!1,supportsInsights:!1},a.entities=i.createWithName(),a}function a(t,n){var a=r(t.name,t.extends,n);if(!t.entities)return a;for(var o=0,s=t.entities;o<s.length;o++){var l=s[o],u={name:l.name,extends:l.extends,displayName:l.name,properties:i.createWithName(),hierarchies:i.createWithName(),displayFolders:i.createWithName()};if(a.entities.push(u),l.measures)for(var c=0,p=l.measures;c<p.length;c++){var f=p[c],d={name:f.name,displayName:f.name,type:e.ValueType.fromPrimitiveTypeAndCategory(f.dataType),kind:1,hidden:f.hidden,errorMessage:f.errorMessage,queryable:f.errorMessage?1:0,format:f.formatInformation&&f.formatInformation.formatString,measure:{},canDelete:a.capabilities.canEdit};f.measureTemplate&&(d.measure.template={name:f.measureTemplate.daxTemplateName}),u.properties.push(d)}}return a}t.createExtensionSchema=r,t.convertModelExtension=a})(r=t.ExplorationConceptualSchemaFactory||(t.ExplorationConceptualSchemaFactory={}))})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return void 0===t&&(t=!1),new n(e,t)}var i=e.data.FederatedConceptualSchema;t.createConceptualSchemaReader=r;var n=(function(){function e(e,t){this.promiseFactory=e,this.canEditSchemas=t}return e.prototype.execute=function(e){var r=e.dataSources;if(!r||r.length>1)return this.promiseFactory.reject(null);var i=r[0],n=i.exploration;if(!n)return this.promiseFactory.reject(null);var a=[],o=n.getModelExtensions();if(_.isEmpty(o))a.push(t.ExplorationConceptualSchemaFactory.createExtensionSchema(i.name,i.extends,this.canEditSchemas));else for(var s=0,l=o;s<l.length;s++){var u=l[s];a.push(t.ExplorationConceptualSchemaFactory.convertModelExtension(u,this.canEditSchemas))}return this.promiseFactory.resolve({data:{extensionSchemas:a}})},e.prototype.transform=function(e){for(var t=e.data,r={schemas:{}},n=0,a=t.extensionSchemas;n<a.length;n++){var o=a[n];r.schemas[o.name]=o}return{schema:new i(r)}},e})()})(r=t.dataReaderPlugins||(t.dataReaderPlugins={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.explore.contracts;!(function(e){function t(e,t,i,a){var o=r(e,i),s=n(e,i);return{added:{visualContainers:o.added,relationships:s.added},updated:{visualContainers:o.updated,relationships:s.updated},removed:{visualContainers:o.removed,relationships:s.removed},page:{page:i,ordinal:a},originalPage:{page:e,ordinal:t}}}function r(e,t){for(var r=[],i=[],n=e.visualContainers.slice(),a=0,o=t.visualContainers;a<o.length;a++){var s=o[a];if(void 0===s.id)r.push(s);else{var l=jsCommon.ArrayExtensions.findWithId(n,s.id);if(l){var u=n.indexOf(l);n.splice(u,1),jsCommon.JsonComparer.equals(l,s)||i.push(s)}else r.push(s)}}return{added:r,updated:i,removed:n}}function n(e,t){for(var r=e.relationships?e.relationships.slice():[],i=t.relationships||[],n=[],a=[],o=0;o<i.length;o++){var s=t.relationships[o];if(void 0===s.source.id||void 0===s.target.id)n.push(s);else{var l=s.source.id,u=s.target.id,c=_.find(r,(function(e){return e.source.id===l&&e.target.id===u}));if(c){var p=r.indexOf(c);r.splice(p,1),c.type!==s.type&&a.push(s)}else n.push(s)}}return{added:n,updated:a,removed:r}}function a(e,r){for(var i=[],n=[],a=e.slice(),o=0,s=r.length;o<s;o++){var l=r[o];if(void 0===l.id)i.push({page:l,ordinal:o});else{var u=jsCommon.ArrayExtensions.findWithId(a,l.id);if(u){var c=a.indexOf(u);a.splice(c,1);var p=e.indexOf(u),f=t(u,p,l,o);n.push(f)}else i.push({page:l,ordinal:o})}}return{added:i,updated:n,removed:a}}function o(e,t){for(var r=[],i=[],n=t||[],a=e?e.slice():[],o=0,s=n;o<s.length;o++){var l=s[o];if(void 0===l.id)r.push(l);else{var u=l.id,c=_.findIndex(a,(function(e){return e.id===u}));c>=0?(i.push({updatedPod:l,originalPod:a[c]}),a.splice(c,1)):r.push(l)}}return{added:r,removed:a,updated:i}}function s(e,t){var r=i.Section.filterTransient(t.sections),n=a(e.sections,r),s=o(e.pods,t.pods);return{pages:n,pods:s}}e.diff=s})(r=t.ExplorationDiffer||(t.ExplorationDiffer={}))})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a){return new u(e,t,r,i,n,a)}var n,a=jsCommon.JsonExtensions;!(function(e){var t;!(function(e){e.Bookmark="Bookmark",e.Back="Back"})(t=e.VisualLink||(e.VisualLink={}))})(n=r.wireContracts||(r.wireContracts={})),r.createExplorationProxy=i;var o="_",s="[0-9]+",l=18e5,u=(function(){function i(e,t,r,i,n,a){this.promiseFactory=e,this.httpService=t,this.serializer=r,this.telemetryService=i,this.featureSwitchService=n,this.cache={},this.uriPrefix=a||"explore/"}return i.prototype.get=function(t){var r=this,n=this.telemetryService,a=n.startEvent(e.telemetry.EXGetExploration,!1),o=t.sectionId,s=t.id,l=t.model,u=i.getKey(s,o);if(t.allowCache){var c=this.getExplorationCache(s,o,l);if(c)return a.event.info.fromCache=!0,a.resolve(),c}var p=this.promiseFactory.defer(),f=this.uriPrefix+"reports/"+s+"/exploration";return _.isNumber(o)&&(f+="/sections/"+o),this.cache[u]={promise:p.promise},this.httpService.get(f,this.httpService.powerbiRequestOptions(a.event,"GetExploration")).then((function(e){a.resolve(),r.onSuccess(e.data,p,l,u)}),(function(t){a.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),r.onError(t,s,p,u)})),p.promise},i.prototype.save=function(e,t,n){var a=this,o=this.promiseFactory.defer(),s=i.getKey(n),l=this.serializer.serializeExploration(t,{withData:!0}),u=this.cloneExplorationShallow(l);if(null==t.id){var c=this.uriPrefix+"explorations/?reportid="+n;this.httpService.put(c,l,this.httpService.powerbiRequestOptions(null,"SaveExploration")).then((function(e){return a.onSuccess(e.data,o,null,s)}),(function(e){return a.onError(e,n,o,s)}))}else{var p=r.ExplorationDiffer.diff(e,t);this.featureSwitchService.featureSwitches.allUpSaveReport?this.explorationUpdateDiff(p,t.id,t,u).then((function(){o.resolve(t),a.updateExplorationCache(s,l)}),(function(e){o.reject(e)})):this.updateExploration(p,t.id,t,u).then((function(e){o.resolve(t),a.updateExplorationCache(s,l)}),(function(){return o.reject()}))}return o.promise},i.prototype.doUpdatePage=function(e,t,r){var i=this;return e.then((function(){return i.updatePage(t,r)}))},i.prototype.doAddPage=function(e,t,r){var i=this;return e.then((function(){return i.addPage(r,t)}))},i.prototype.doDeletePage=function(e,t,r){var i=this;return e.then((function(){return i.deletePage(t,r)}))},i.prototype.updateExploration=function(e,t,r,i){var n=this.promiseFactory.resolve();return n=this.doUpdateTopLevelProperties(n,r,i),n=this.doUpdateExplorationPods(n,e.pods,t),n=this.doUpdateExplorationPages(n,e.pages,t)},i.prototype.updateTopLevelProperties=function(e,t){var r=this.promiseFactory.defer(),i=this.uriPrefix+"explorations/"+e.id;return this.httpService.post(i,t,this.httpService.powerbiRequestOptions(null,"UpdateExplorationProperty")).then((function(e){r.resolve(null)}),(function(e){return r.reject(null)})),r.promise},i.prototype.doUpdateTopLevelProperties=function(e,t,r){var i=this;return e.then((function(){return i.updateTopLevelProperties(t,r)}))},i.prototype.getModelsAndExploration=function(e){var t=this,r=this.promiseFactory.defer(),i=this.uriPrefix+"reports/"+e+"/modelsAndExploration";return this.httpService.get(i,this.httpService.powerbiRequestOptions(null,"GetModelsAndExploration")).then((function(e){var i=e.data.models;t.featureSwitchService.registerFeatureSwitches(e.data.featureSwitches),t.serializer.ensureInitialized().then((function(){var n=t.serializer.deserializeExploration(e.data.exploration,[],!0,i);r.resolve({exploration:n,models:i,featureSwitches:e.data.featureSwitches})}))}),(function(e){r.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),r.promise},i.prototype.cloneExplorationShallow=function(e){return{id:e.id,reportId:e.reportId,baseTheme:e.baseTheme,theme:e.theme,config:e.config,filters:e.filters,layoutOptimization:e.layoutOptimization,sections:void 0,resourcePackages:_.cloneDeep(e.resourcePackages)}},i.prototype.explorationUpdateDiff=function(e,t,r,i){var n=this,a=this.promiseFactory.defer(),o={};o.exploration=i;var s=-1;o.addedPods=e.pods.added.reduce((function(e,t){if(null!=t){t.id=s--;var r=n.serializer.serializePod(t);null!=r&&e.push(r)}return e}),[]),o.deletedPods=e.pods.removed.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),o.updatedPods=e.pods.updated.reduce((function(e,t){if(null!=t){var r=n.serializer.serializePod(t.originalPod),i=n.serializer.serializePod(t.updatedPod);jsCommon.JsonComparer.equals(r,i)||e.push(i)}return e}),[]);var l=-1,u=-1;o.addedPages=e.pages.added.map((function(e){if(e.page.id=l--,e.page.visualContainers)for(var t=0,r=e.page.visualContainers;t<r.length;t++){var i=r[t];i.id=u--}return n.serializer.serializePage(e.page,e.ordinal)})),o.deletedPages=e.pages.removed.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),o.updatedPages=e.pages.updated.reduce((function(e,t){if(null!=t){for(var r=0,i=t.added.visualContainers;r<i.length;r++){var a=i[r];a.id=u--}var o=n.getUpdatedPageProperty(t);null!=o&&e.push(o)}return e}),[]);var c=this.uriPrefix+"explorations/savereport/"+t;return this.httpService.post(c,o,this.httpService.powerbiRequestOptions()).then((function(e){var t=!1,i=!1,n=!1;if(e&&e.data&&e.data.addedPodIds&&e.data.addedPodIds.length>0&&(t=!0),e&&e.data&&e.data.addedSectionIds&&e.data.addedSectionIds.length>0&&(i=!0),e&&e.data&&e.data.addedVisualContainerIds&&e.data.addedVisualContainerIds.length>0&&(n=!0),r.pods&&t)for(var o=0,s=r.pods;o<s.length;o++){var l=s[o];l.id<0&&(l.id=_.find(e.data.addedPodIds,{oldId:l.id}).id)}if(r.sections)for(var u=0,c=r.sections;u<c.length;u++){var p=c[u];if(p.id<0&&i&&(p.id=_.find(e.data.addedSectionIds,{oldId:p.id}).id),p.visualContainers&&n)for(var f=0,d=p.visualContainers;f<d.length;f++){var h=d[f];h.id<0&&(h.id=_.find(e.data.addedVisualContainerIds,{oldId:h.id}).id)}}a.resolve(r)}),(function(e){return a.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),a.promise},i.prototype.doAddPod=function(e,t,r){var i=this;return e.then((function(){return i.addPod(r,t)}))},i.prototype.doUpdatePod=function(e,t,r){var i=this;return e.then((function(){return i.updatePod(t,r)}))},i.prototype.doDeletePod=function(e,t,r){var i=this;return e.then((function(){return i.deletePod(t,r)}))},i.prototype.updateExplorationPods=function(e,t){for(var r=this.promiseFactory.resolve(),i=0,n=e.added;i<n.length;i++){var a=n[i];r=this.doAddPod(r,t,a)}for(var o=0,s=e.updated;o<s.length;o++){var l=s[o];r=this.doUpdatePod(r,t,l)}for(var u=0,c=e.removed;u<c.length;u++){var p=c[u];r=this.doDeletePod(r,t,p.id)}return r},i.prototype.doUpdateExplorationPods=function(e,t,r){var i=this;return e.then((function(){return i.updateExplorationPods(t,r)}))},i.prototype.updateExplorationPages=function(e,t){for(var r=this.promiseFactory.resolve(),i=0,n=e.added;i<n.length;i++){var a=n[i];r=this.doAddPage(r,t,a)}for(var o=0,s=e.updated;o<s.length;o++){var l=s[o];r=this.doUpdatePage(r,t,l)}for(var u=0,c=e.removed;u<c.length;u++){var p=c[u];r=this.doDeletePage(r,t,p.id)}return r},i.prototype.doUpdateExplorationPages=function(e,t,r){var i=this;return e.then((function(){return i.updateExplorationPages(t,r)}))},i.prototype.addPod=function(e,t){var r=this;e.id=void 0;var i=this.serializer.serializePod(e),n=this.uriPrefix+"explorations/"+t+"/pods";return this.httpService.post(n,i,this.httpService.powerbiRequestOptions(null,"AddPod")).then((function(t){var i=r.serializer.deserializePod(t.data);e.id=i.id}),_.noop)},i.prototype.updatePod=function(e,t){var r=this,i=this.promiseFactory.resolve(),n=this.serializer.serializePod(t.originalPod),a=this.serializer.serializePod(t.updatedPod);return jsCommon.JsonComparer.equals(n,a)||(i=i.then((function(){var i=r.uriPrefix+"explorations/"+e+"/pods/"+t.updatedPod.id;return r.httpService.post(i,a,r.httpService.powerbiRequestOptions(null,"UpdatePod"))}))),i},i.prototype.deletePod=function(e,t){var r=this.uriPrefix+"explorations/"+e+"/pods/"+t;return this.httpService.delete(r,this.httpService.powerbiRequestOptions(null,"DeletePod"))},i.prototype.addPage=function(e,t){var r=this,i=this.promiseFactory.defer(),n=this.serializer.serializePage(e.page,e.ordinal),a=this.uriPrefix+"explorations/"+t+"/pages";return this.httpService.post(a,n,this.httpService.powerbiRequestOptions(null,"AddPage")).then((function(t){var n=r.serializer.deserializePage(t.data);e.page.id=n.id;var a=e.page.visualContainers,o=n.visualContainers;if(o)for(var s=0;s<o.length;s++)a[s].id=o[s].id;i.resolve(null)}),(function(e){return i.reject(null)})),i.promise},i.prototype.doUpdateVisualContainer=function(e,t,r,i,n){var a=this;return e.then((function(){return a.updateVisualContainer(t,r,i,n)}))},i.prototype.doDeleteVisualContainer=function(e,t,r,i){var n=this;return e.then((function(){return n.deleteVisualContainer(t,r,i)}))},i.prototype.doAddVisualContainer=function(e,t,r,i,n){var a=this;return e.then((function(){return a.addVisualContainer(t,r,i,n)}))},i.prototype.updatePage=function(e,t){for(var r=this.promiseFactory.resolve(),i=t.page.page.id,n=!(_.isEmpty(t.added.relationships)&&_.isEmpty(t.updated.relationships)&&_.isEmpty(t.removed.relationships)&&_.isEmpty(t.updated.visualContainers)),a=0,o=t.added.visualContainers;a<o.length;a++){var s=o[a],l=n?s.name:void 0;r=this.doAddVisualContainer(r,e,i,s,l)}for(var u=0,c=t.updated.visualContainers;u<c.length;u++){var p=c[u],l=n?p.name:void 0;r=this.doUpdateVisualContainer(r,e,i,p,l)}for(var f=0,d=t.removed.visualContainers;f<d.length;f++){var h=d[f];r=this.doDeleteVisualContainer(r,e,i,h.id)}return r=n?this.updatePageDeep(r,e,t):this.updatePageShallow(r,e,t)},i.prototype.updatePageShallow=function(e,t,r){var i=this,n=this.serializer.serializePageShallow(r.originalPage.page,r.originalPage.ordinal),a=this.serializer.serializePageShallow(r.page.page,r.page.ordinal);return jsCommon.JsonComparer.equals(n,a)||(e=e.then((function(){var e=i.promiseFactory.defer(),n=i.uriPrefix+"explorations/"+t+"/pages/"+r.page.page.id;return i.httpService.post(n,a,i.httpService.powerbiRequestOptions(null,"UpdatePageShallow")).then((function(t){return e.resolve(null)}),(function(t){return e.reject(null)})),e.promise}))),e},i.prototype.updatePageDeep=function(e,t,r){var i=this,n=this.serializer.serializePage(r.page.page,r.page.ordinal);return e=e.then((function(){var e=i.promiseFactory.defer(),a=i.uriPrefix+"explorations/"+t+"/pages/"+r.page.page.id;return i.httpService.post(a,n,i.httpService.powerbiRequestOptions(null,"UpdatePageDeep")).then((function(t){return e.resolve(null)}),(function(t){return e.reject(null)})),e.promise}))},i.prototype.deletePage=function(e,t){var r=this.promiseFactory.defer(),i=this.uriPrefix+"explorations/"+e+"/pages/"+t;return this.httpService.delete(i,this.httpService.powerbiRequestOptions(null,"DeletePage")).then((function(e){return r.resolve(void 0)}),(function(e){return r.reject()})),r.promise},i.prototype.addVisualContainer=function(e,t,r,i){var n=this,a=this.promiseFactory.defer();r.id=void 0;var o=this.serializer.serializeVisualContainer(r,{withData:!0},i),s=this.uriPrefix+"explorations/"+e+"/pages/"+t+"/visualcontainers";return this.httpService.post(s,o,this.httpService.powerbiRequestOptions(null,"AddVisualContainer")).then((function(e){var t=n.serializer.deserializeVisualContainer(e.data);r.id=t.id,a.resolve(null)}),(function(e){return a.reject(null)})),a.promise},i.prototype.updateVisualContainer=function(e,t,r,i){var n=this.promiseFactory.defer(),a=this.uriPrefix+"explorations/"+e+"/pages/"+t+"/visualcontainers/"+r.id,o=this.serializer.serializeVisualContainer(r,{withData:!0},i);return this.httpService.post(a,o,this.httpService.powerbiRequestOptions(null,"UpdateVisualContainer")).then((function(e){return n.resolve(null)}),(function(e){return n.reject(null)})),n.promise},i.prototype.deleteVisualContainer=function(e,t,r){var i=this.promiseFactory.defer(),n=this.uriPrefix+"explorations/"+e+"/pages/"+t+"/visualcontainers/"+r;return this.httpService.delete(n,this.httpService.powerbiRequestOptions(null,"DeleteVisualContainer")).then((function(e){return i.resolve(void 0)}),(function(e){return i.reject()})),i.promise},i.prototype.saveAs=function(e,t,r,i){var n=this,a=this.promiseFactory.defer(),o=this.serializer.serializeExploration(e,{withData:!0});o.reportId=void 0;var s={modelIds:[r],exploration:o,packageId:i};t=encodeURIComponent(t);var l=this.uriPrefix+"explorations/?name="+t;return this.httpService.put(l,s,this.httpService.powerbiRequestOptions(null,"SaveExplorationAs")).then((function(e){return n.onSuccess(e.data,a)}),(function(e){return n.onError(e,r,a)})),a.promise},i.prototype.saveVisualContainerQueries=function(e,t){var r=this.uriPrefix+"explorations/"+e+"/cache";return this.httpService.post(r,t,this.httpService.powerbiRequestOptions(null,"SaveVisualContainerQueries"))},i.prototype.getUpdatedPageProperty=function(e){var t=this,r=!(_.isEmpty(e.added.relationships)&&_.isEmpty(e.updated.relationships)&&_.isEmpty(e.removed.relationships)&&_.isEmpty(e.updated.visualContainers)),i={pageId:e.page.page.id};if(i.addedVisualContainers=e.added.visualContainers.reduce((function(e,i){if(null!=i){var n=r?i.name:void 0;e.push(t.serializer.serializeVisualContainer(i,{withData:!0},n))}return e}),[]),i.updatedVisualContainers=e.updated.visualContainers.reduce((function(e,i){if(null!=i){var n=r?i.name:void 0;e.push(t.serializer.serializeVisualContainer(i,{withData:!0},n))}return e}),[]),i.deletedVisualContainers=e.removed.visualContainers.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),r){var n=this.serializer.serializePage(e.page.page,e.page.ordinal);i.pageProperty=n}else{var a=this.serializer.serializePageShallow(e.originalPage.page,e.originalPage.ordinal),o=this.serializer.serializePageShallow(e.page.page,e.page.ordinal);jsCommon.JsonComparer.equals(a,o)||(i.pageProperty=o)}return i},i.prototype.getExplorationCache=function(e,t,r){var n=i.getKey(e,t),a=this.cache[n];if(a||(n=i.getKey(e),a=this.cache[n]),a){if(a.promise)return a.promise;if(a.data){if(null!=t&&!_.any(a.data.sections,(function(e){return e.id===t})))return;var o=this.promiseFactory.defer(),s=[];return o.resolve(this.serializer.deserializeExploration(a.data,s,!0,r)),o.promise}}},i.prototype.updateExplorationCache=function(e,t){var r=this;if(e){if(!t)return void delete this.cache[e];var n=this.cache[e];n?(n.promise&&delete n.promise,n.data=t):this.cache[e]={data:t,promise:null},i.isAllSectionsKey(e)&&_.forOwn(this.cache,(function(t,i){i!==e&&null!=i.match(new RegExp("^"+e+"$"))&&delete r.cache[i]})),this.cacheExpirationTimerId&&clearTimeout(this.cacheExpirationTimerId),this.cacheExpirationTimerId=setTimeout((function(){r.clearCache()}),l)}},i.prototype.clearCache=function(){this.cache={}},i.prototype.logDeserializationErrorsTelemetryEvents=function(r,i){if(_.find(i,(function(e){return 0===e.errorType}))){var n=a.tryParseJSON(r.config);this.telemetryService.logEvent(e.telemetry.NewerExplorationVersion,n.version.toString(),t.services.upgrade.CurrentExplorationVersion.toString())}},i.prototype.onSuccess=function(e,t,r,i){var n=[],a=this.serializer.deserializeExploration(e,n,!0,r);t.resolve(a),this.logDeserializationErrorsTelemetryEvents(e,n),this.updateExplorationCache(i,e)},i.prototype.onError=function(e,t,r,i){r.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{}),this.updateExplorationCache(i,null)},i.getKey=function(e,t){return null!=t?e+o+t:e+o+s},i.isAllSectionsKey=function(e){if(!e)return!1;var t=e.split(o);return!(!t||2!==t.length)&&t[1]===s},i})()})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("Explore/proxies/linguisticSchemaProxy",(function(e){var t=(powerbi.explore.proxies.wireContracts,jsCommon.StringExtensions),r=0,i=(function(){function e(e,t){this.promiseFactory=e,this.httpService=t,this.schemas={},this.originalSchemas={}}return e.prototype.init=function(e,t){var i=this,n=this.promiseFactory.defer();if(e=e||r,this.schemas[e]={content:{Entities:[]}},this.originalSchemas[e]={content:{Entities:[]}},e&&t){var a="explore/reports/"+e+"/linguisticschema";this.httpService.get(a,this.httpService.powerbiRequestOptions()).then((function(t){i.schemas[e]=t.data,i.originalSchemas[e]=_.cloneDeep(t.data),n.resolve(null)}),(function(t){i.schemas[e]=null;var r=t?{error:t.error,requestId:t.requestId}:{};n.reject(r)}))}return n.promise},e.prototype.save=function(e){var t=this,i=this.promiseFactory.defer(),n=this.schemas[e],a=this.originalSchemas[e];if(n||(n=this.schemas[r],n&&(this.schemas[r]=null,this.schemas[e]=n,a=this.originalSchemas[r],this.originalSchemas[r]=null,this.originalSchemas[e]=a)),!_.isEqual(n,a)){if(n){var o="explore/reports/"+e+"/linguisticschema";n.content&&!_.isEmpty(n.content.Entities)?(n.id=void 0,this.httpService.post(o,n,this.httpService.powerbiRequestOptions()).then((function(r){t.originalSchemas[e]=_.cloneDeep(r.data),i.resolve(null)}),(function(e){var t=e?{error:e.error,requestId:e.requestId}:{};i.reject(t)}))):a?this.httpService.delete(o,this.httpService.powerbiRequestOptions()).then((function(r){delete t.originalSchemas[e],i.resolve(null)}),(function(e){var t=e?{error:e.error,requestId:e.requestId}:{};i.reject(t)})):(this.originalSchemas[e]=n,i.resolve(null))}return i.promise}},e.prototype.get=function(e,t){e=e||r;var i,n=this.schemas[e];return n&&(i=this.getWordsForPodEntity(n,t)),this.promiseFactory.resolve({podName:t,words:i||[]})},e.prototype.set=function(e,t,i){e=e||r;var n=this.schemas[e];n&&this.setWordsForPodEntity(n,t,i)},e.prototype.getSchema=function(e){return _.cloneDeep(this.schemas[e||r])},e.prototype.setSchema=function(e,t){this.schemas[e||r]=t},e.prototype.getWordsForPodEntity=function(e,t){var r=this.findPodEntity(e,t);if(r&&2!==r.Source)return _.map(_.filter(r.Words,(function(e){return null==e.Source||0===e.Source})),(function(e){return e.Value}))},e.prototype.setWordsForPodEntity=function(e,r,i){var n=this.findPodEntity(e,r);if(_.isEmpty(i)){if(n){var a=e.content.Entities.indexOf(n);e.content.Entities.splice(a,1)}}else{n?2===n.Source&&(n.Source=1):(n={Name:null,ConceptualEntity:r,Source:1},e.content.Entities.push(n));var o=i[0],s=t.deriveClsCompliantName(o,"pod");n.Name=this.makeUniquePodEntityName(s,e.content.Entities,n),n.Words=_.map(i,(function(e){return{Value:e,Source:0}}))}},e.prototype.findPodEntity=function(e,t){if(e.content&&e.content.Entities)return _.find(e.content.Entities,(function(e){return e.ConceptualEntity===t}))},e.prototype.makeUniquePodEntityName=function(e,r,i){for(var n={},a=0,o=r;a<o.length;a++){var s=o[a];s!==i&&(n[s.Name]=!0)}return t.findUniqueName(n,e)},e})();return{create:function(e,t){return new i(e,t)}}}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e,t,r){return new i(e,t,r)}t.createEmbedProxy=r;var i=(function(){function t(e,t,r){this.httpService=e,this.promiseFactory=t,this.localizationService=r}return t.prototype.createEmbed=function(t){var r=this,i="snapshots/embed/",n=this.promiseFactory.defer(),a=e.services.EmbedSerializer.serializeEmbedCreationRequest(t);return this.httpService.post(i,a,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(e.services.EmbedSerializer.convertEmbed(t.data,r.localizationService))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getSnapshotEmbedsForReport=function(t){var r=this,i="snapshots/embed/reports/"+t.toString(),n=this.promiseFactory.defer();return this.httpService.get(i,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,r.localizationService)})))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getLiveEmbeds=function(t){var r,i,n=this;t?(r="snapshots/embed/reports/tenantAdmin/interactive/",i=this.httpService.powerbiRequestOptions(null,null,{isAdminRequest:!0})):(r="snapshots/embed/reports/interactive/",i=this.httpService.powerbiRequestOptions());var a=this.promiseFactory.defer();return this.httpService.get(r,i).then((function(t){return a.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,n.localizationService)})))}),(function(e){return a.reject(e)})),a.promise},t.prototype.getLiveEmbedsForReport=function(t){var r=this,i="snapshots/embed/reports/interactive/"+t.toString(),n=this.promiseFactory.defer();return this.httpService.get(i,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,r.localizationService)})))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getLiveEmbedsByEmbedKeyAsSysAdmin=function(t,r){var i=this,n=r+"/snapshots/embed/admin/reports/interactive/"+t,a=this.promiseFactory.defer();return this.httpService.get(n,this.httpService.sysAdminRequestOptions()).then((function(t){return a.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,i.localizationService)})))}),(function(e){return a.reject(e)})),a.promise},t.prototype.saveSnapshotEmbed=function(e,t){var r="snapshots/embed/"+e,i=this.promiseFactory.defer();return this.httpService.put(r,t,this.httpService.powerbiRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.deleteSnapshotEmbed=function(e){var t="snapshots/embed/"+e,r=this.promiseFactory.defer();return this.httpService.delete(t,this.httpService.powerbiRequestOptions()).then((function(e){return r.resolve(null)}),(function(e){return r.reject(e)})),r.promise},t.prototype.deleteLiveEmbed=function(e){var t="snapshots/embed/interactive/"+e,r=this.promiseFactory.defer();return this.httpService.delete(t,this.httpService.powerbiRequestOptions()).then((function(e){return r.resolve(null)}),(function(e){return r.reject(e)})),r.promise},t.prototype.deleteLiveEmbedAsSysAdmin=function(e,t){var r=t+"/snapshots/embed/admin/interactive/"+e,i=this.promiseFactory.defer();return this.httpService.delete(r,this.httpService.sysAdminRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.updateLiveEmbed=function(e,t){var r="/snapshots/embed/interactive/"+e,i=this.promiseFactory.defer();return this.httpService.put(r,t,this.httpService.powerbiRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.updateLiveEmbedAsSysAdmin=function(e,t,r){var i=r+"/snapshots/embed/admin/interactive/"+e,n=this.promiseFactory.defer();return this.httpService.put(i,t,this.httpService.sysAdminRequestOptions()).then((function(e){return n.resolve(null)}),(function(e){return n.reject(e)})),n.promise},t})()})(t=e.proxies||(e.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,i,n){if(!(t&&t.clientError&&t.clientError.ignorable)){var a;if(t&&t.serviceError)a=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessageFromServiceError(t.serviceError);else if(t&&t.clientError)a=e.helpers.PowerBIServiceExceptionErrorHelper.GetErrorDetailsFromClientError(t.clientError);else{var o=$.Deferred();o.resolve(null),a=o.promise()}a.then((function(e){r.error(e&&e.message?e.message:i,n,{requestId:t?t.requestId:void 0,displayableErrorInfo:e?e.displayableErrorInfo:void 0})}))}}t.handleConceptualSchemaError=r})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=e.drilldown;return null!=t?t.roles:[]}function r(e,t,r){return{expr:e.defn.select().withName(t).expr,roleName:r}}function i(e,t,r){if(t)switch(r){case 1:return o(e,t);case 0:var i=t;if(i.expr){for(var s=jsCommon.ArrayExtensions.ensureArray(i.expr),l=[],u=0,c=s;u<c.length;u++){var p=c[u];l.push(a(e,p))}return l}return n(e,t)}}function n(e,t){for(var i=[],n=t.count||1,a=t.role,o=e.projections[a].all(),s=t.index+n-1,l=n-1;l>=0;l--,s--)i.push(r(e,o[s].queryRef,a));return i}function a(e,t){var r=e.defn.selectNameOf(t),i=s(e.projections,r);return{expr:t,roleName:i}}function o(e,t){var i=[],n=e.projections,a=t.sourceCount,o=t.sourceIndex,s=t.sourceRole,l=t.targetRole;if(n[l]){var u=n[l].all(),c=t.targetIndex;c>=o&&s===l&&(c+=a);for(var p=c,f=u.length;p<f;p++)i.push(r(e,u[p].queryRef,l))}if(n[s])for(var d=n[s].all(),p=a-1;p>=0;p--)i.push(r(e,d[o+p].queryRef,s));return i}function s(e,t){for(var r in e){var i=e[r].all(),n=_.findIndex(i,(function(e){return e.queryRef===t}));if(n>=0)return r}}e.getDrillableRoles=t,e.getDrillFilterRemovalInfoList=i})(t=e.DrillUtils||(e.DrillUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){t.visitExploration(e),u(e.filters,t);var a=e.bookmarks;if(!_.isEmpty(a))for(var o=0,s=a;o<s.length;o++){var l=s[o];r(l,e.sections,i,t)}var c=e.sections;if(!_.isEmpty(c))for(var p=0,f=c;p<f.length;p++){var d=f[p];n(d,t,i)}}function r(e,t,r,n){n.visitBookmark(e),i(e.explorationState,t,r,n.explorationStateVisitor)}function i(e,t,r,i){e&&(c(e.filters,i),_.forOwn(e.sections,(function(e,n){var o=_.find(t,(function(e){
return e.name===n}));a(e,o,r,i)})))}function n(e,t,r){t.visitSection(e),u(e.filters,t);var i=e.visualContainers;if(!_.isEmpty(i))for(var n=0,a=i.length;n<a;n++)o(i[n],t.visualContainerVisitor,r)}function a(e,t,r,i){if(e&&t){i.visitSectionState(e),c(e.filters,i);var n=i.visualContainerStateVisitor,a=t.visualContainers;_.forOwn(e.visualContainers,(function(e,t){var i=_.find(a,(function(e){return e.name===t}));s(e,i,r,n)}))}}function o(t,r,i){var n;if(r.visitVisualContainer(t),t.config&&(n=t.config.singleVisual)){r.visitSingleVisualConfig(n);var a=n.query;a&&r.visitQuery(a);var o=n.objects;if(o){var s=void 0,l=e.VisualContainerUtils.getVisualCapabilities(t,i);l&&(s=l.objects),s&&r.visitDataViewObjects(o,s),p(o,r)}}u(t.filters,r)}function s(e,t,r,i){e&&t&&(i.visitVisualContainerState(e),c(e.filters,i),l(e&&e.singleVisual,t,r,i))}function l(t,r,i,n){if(t){n.visitSingleVisualState(t);var a=t.orderBy;a&&n.visitOrderByStates(a);var o=t.objects;if(o){var s=e.VisualContainerUtils.getVisualCapabilities(r,i);if(s){var l=s.objects;l&&n.visitDataViewObjectDefinitionUpdates(o,l)}var u=o.merge;u&&p(u,n);var c=o.remove;if(!_.isEmpty(c))for(var f=0,d=c;f<d.length;f++){var h=d[f],m=h.selector;m&&n.visitSelector(m)}}var v=t.activeProjections;v&&n.visitActiveProjectionStates(v)}}function u(e,t){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r];t.visitFilter(n)}}function c(e,t){if(e){var r=e.nameIdentifiedMerges;_.forOwn(r,(function(e){t.visitFilter(e)}));var i=e.exprIdentifiedMerges;if(!_.isEmpty(i))for(var n=0,a=i;n<a.length;n++){var o=a[n];t.visitFilter(o)}}}function p(e,t){_.forOwn(e,(function(e){if(!_.isEmpty(e))for(var r=0,i=e;r<i.length;r++){var n=i[r],a=n.selector;a&&t.visitSelector(a)}}))}e.traverseExploration=t,e.traverseVisualContainer=o,e.traverseVisualContainerState=s,e.traverseSingleVisualState=l})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.visitVisualContainer=function(e){},e.prototype.visitSingleVisualConfig=function(e){},e.prototype.visitQuery=function(e){},e.prototype.visitDataViewObjects=function(e,t){},e.prototype.visitSelector=function(e){},e.prototype.visitFilter=function(e){},e})();e.DefaultVisualContainerVisitor=t;var r=(function(t){function r(e){var r=t.call(this)||this;return r.rewriters=e,r}return __extends(r,t),r.prototype.visitQuery=function(e){var t=e.defn;if(t)for(var r=this.rewriters,i=0,n=r;i<n.length;i++){var a=n[i];e=a.rewriteQuery(e)}},r.prototype.visitDataViewObjects=function(t,r){e.rewriteFilterOutput(t,r,this.rewriters)},r.prototype.visitFilter=function(t){e.rewriteFilterContainer(t,this.rewriters)},r.prototype.visitSelector=function(t){e.rewriteSelector(t,this.rewriters)},r})(t);e.VisualContainerRewriter=r})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.visitActiveProjectionStates=function(e){},e.prototype.visitDataViewObjectDefinitionUpdates=function(e,t){},e.prototype.visitFilter=function(e){},e.prototype.visitOrderByStates=function(e){},e.prototype.visitSelector=function(e){},e.prototype.visitSingleVisualState=function(e){},e.prototype.visitVisualContainerState=function(e){},e})();e.DefaultVisualContainerStateVisitor=t;var r=(function(t){function r(e){var r=t.call(this)||this;return r.rewriters=e,r}return __extends(r,t),r.prototype.visitActiveProjectionStates=function(e){var t=this;_.forOwn(e,(function(r,i){var n=r.map((function(e){return t.rewriteExpr(e)}));e[i]=n}))},r.prototype.visitFilter=function(t){e.rewriteFilterContainerState(t,this.rewriters)},r.prototype.visitDataViewObjectDefinitionUpdates=function(t,r){var i=t.merge;i&&e.rewriteFilterOutput(i,r,this.rewriters)},r.prototype.visitOrderByStates=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];i.expr=this.rewriteExpr(i.expr)}},r.prototype.visitSelector=function(t){e.rewriteSelector(t,this.rewriters)},r.prototype.rewriteExpr=function(e){return _.reduce(this.rewriters,(function(e,t){return t.rewriteExpr(e)}),e)},r})(t);e.VisualContainerStateRewriter=r})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.explorationStateVisitor=e,this.visualContainerVisitor=t}return e.prototype.visitBookmark=function(e){},e.prototype.visitFilter=function(e){},e.prototype.visitExploration=function(e){},e.prototype.visitSection=function(e){},e})();e.DefaultExplorationVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.visualContainerStateVisitor=e}return e.prototype.visitFilter=function(e){},e.prototype.visitSectionState=function(e){},e})();e.DefaultExplorationStateVisitor=t;var r=(function(t){function r(e,r){var i=t.call(this,r)||this;return i.rewriters=e,i}return __extends(r,t),r.prototype.visitFilter=function(t){e.rewriteFilterContainerState(t,this.rewriters)},r})(t);e.ExplorationStateRewriter=r})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){var r=e.getMetadata(t);if(r){var i=r.format;return O.create({format:i,allowFormatBeautification:!0})}}function n(e,r,i,n){var a=e.getMetadata(r);if(a){if(5===i)return t.contracts.FilterType.Categorical;var o=a.type,s=o&&(o.text||o.bool||o.dateTime),l=a.idOnEntityKey&&n&&N.equals(e,n);return!s||I.isMeasure(e)||l?t.contracts.FilterType.Advanced:t.contracts.FilterType.Categorical}}function a(e,t,r,i,n,a,s){if(!e||!t)return!1;var l=M.asFieldPattern(e),u=R.toFieldExprEntityItemPattern(l),c=t.schema(u.schema);if(!c)return!1;var p,f=c.findProperty(u.entity,R.getPropertyName(l));if(!f&&l.hierarchyLevel){var d=c.findHierarchy(u.entity,l.hierarchyLevel.name);d&&(p=d.levels.withName(l.hierarchyLevel.level))}if(!f&&!p||!r||!r.container)return!1;if(f&&1===f.kind&&(0!==r.scopeType||c.capabilities.limitMultiColumnFiltersToQueryGroupColumns))return!1;if(i){if(!s.featureSwitches.drillthrough)return!1;var h=f&&0===f.kind||p;if(!h)return!1;var m=!1;if(1===r.scopeType){var v=r.container;v&&!v.transient&&(m=!0)}if(!m)return!1}if(0===r.scopeType){var g=r.container;if(!g||!o(g,n,a))return!1}return!0}function o(e,r,i){var n=t.util.VisualContainerUtils.getVisualType(e);return!i.supportsFilterOutput(e)&&r.isQueryVisual(n)}function s(e,t){e.filters||(e.filters=[]),e.filters.push(t)}function l(i,n,a,o,s){if(!a)return!1;var l=i.expression;if(!l)return!1;var u=e.data.SQExprUtils.isMeasure(l),c=!_.isEmpty(r.validate(i,n,o)),p=t.util.VisualContainerUtils.hasGrouping(a,n);if(u&&!p&&!c)return!0;var f=l.getTargetEntity().schema,d=n.schema(f);return!(!u||!d.capabilities.limitMultiColumnFiltersToQueryGroupColumns)||(!!t.util.VisualContainerUtils.hasFilterMappingWithNonAggregatableColumns(a,n,s)||!(!t.util.VisualContainerUtils.hasGroupByItemsInQuery(a)||!u))}function u(e,t){var r=e.getMetadata(t);if(r)return r.type}function c(t,r){var i=e.data.SQExprUtils.getDefaultValues(t,r);if(!_.isEmpty(i)){var n=e.data.createDataViewScopeIdentity(e.data.SQExprUtils.getDataViewScopeIdentityComparisonExpr(t,i));return{isNot:!1,scopeIds:[n]}}}function p(e,r,i){var n=e.expression,a=e.filter,o=t.util.ModelAuthoringUtility.validate(n,r,i);if(a&&(o=a.validate(r,i,o)),!_.isEmpty(o))return o}function f(e){if(_.isEmpty(e))return A;for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return j.findUniqueName(t,A)}function d(e,t,r){var i=1,n=r.format(t,[i.toFixed()]);if(_.isEmpty(e))return n;for(var a={},o=0,s=e;o<s.length;o++){var l=s[o];l.restatement&&(a[l.restatement]=!0)}for(;a[n];)n=r.format(t,[(++i).toFixed()]);return n}function h(e){return e===t.contracts.FilterType.Categorical||e===t.contracts.FilterType.Visual}function m(e,t,r){var i=e.filters,n=[];if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s&&s.filter;if(l&&_.isEmpty(l.validate(t,r))&&2===s.howCreated&&v(l.where())){var u=C(e,s.expression);u&&n.push(u)}}return n}function v(e){return!_.isEmpty(e)&&_.all(e,(function(e){return g(e)}))}function g(e){if(null==e)return!1;var t=e.condition;return N.isIn(t)?t.values&&1===t.values.length:N.isCompareRef(t)?0===t.comparison:void 0}function y(e,t){if(!_.isEmpty(e)){if(!t)return e;for(var r=[],i=0,n=e;i<n.length;i++){var a=n[i],o=a.condition;if(N.isIn(o)){var s=o.args;_.any(s,(function(e){return N.equals(e,t)}))&&r.push(a)}else if(N.isCompareRef(o)){var l=N.isConstant(o.left)?o.right:o.left;N.equals(l,t)&&r.push(a)}}return r}}function b(e,t){if(e){var r=e.condition;if(N.isIn(r)){if(!t)return r.values;if(_.isEmpty(r.values))return[[]];var i=r.args,n=_.findIndex(i,(function(e){return N.equals(e,t)})),a=n!==-1?_.map(r.values,(function(e){return[e[n]]})):[[]];return a}if(N.isCompareRef(r)){var o=N.isConstant(r.left),s=o?r.right:r.left,l=N.isConstant(r.left)?r.left:r.right;return!t||N.equals(s,t)?[[l]]:[[]]}}}function C(e,r){var i=t.util.VisualContainerUtils.getVisualQuery(e);if(i)return i.defn.selectNameOf(r)}function x(t,i,n){var a=[],o=n&&n.Filters&&0!==n.Filters.length?n.Filters:null;o&&o.length!==i.length&&(o=null);for(var s=0,l=i.length;s<l;s++){var u=i[s],c=o&&o[s],p=c&&c.expression&&T.deserializeExpr(c.expression);a.push({name:r.getNextFilterName(a),filter:new e.data.SemanticFilter(t,[u]),restatement:c&&c.Restatement,expression:p,howCreated:0,type:c&&c.type})}return a}function S(t,i){var n=_.filter(t.From,(function(t){return t.Type!==e.data.EntitySourceType.Pod})),a={Version:t.Version,From:n,Where:t.Where},o={RemovedIndexes:[]},s=T.deserializeFilter(a,o);if(i&&!_.isEmpty(o.RemovedIndexes)&&(i.Filters=_.filter(i.Filters,(function(e,t){return!_.contains(o.RemovedIndexes,t)}))),s)return r.deriveFromSQFilters(s.from(),s.where(),i)}function w(e,t){_.isEmpty(e.filters)||(t.filters=P(t.filters,e.filters,"explore"),e.filters=[])}function E(e,t,r,i){var n=i;if(!_.isEmpty(r)){t&&!_.isEmpty(t.parameters)&&_.remove(e.filters,(function(e){return _.any(t.parameters,(function(t){return t.boundFilter===e.name}))}));var a=V(r);_.remove(e.filters,(function(e){return _.any(D(e),(function(e){return _.any(a,(function(t){return N.equals(e,t)}))}))})),e.filters=P(e.filters,r,"param"),n=!0}if(n)for(var o=0,s=e.visualContainers;o<s.length;o++){var l=s[o];l.cachedData=null}}function F(e,t){e=e||[],t=t||[];for(var r={},i=[],n=0,a=t;n<a.length;n++){var o=a[n];r[o.name]=o}for(var s=0,l=e;s<l.length;s++){var o=l[s],u=r[o.name];u&&_.isEqual(u,o)||i.push(o)}return i}function P(e,t,r){var i={};e=e||[];for(var n=0,a=e;n<a.length;n++){var o=a[n];i[o.name]=!0}for(var s=0,l=t;s<l.length;s++){var o=l[s];o.name=r+"_"+o.name,i[o.name]||(i[o.name]=!0)}return e.concat(t)}function V(e){return _.flatten(_.map(e,(function(e){return D(e)})))}function D(e){var t=[];if(e.expression&&t.push(e.expression),e.filter)for(var r=0,i=e.filter.conditions();r<i.length;r++){var n=i[r],a=new k;n.accept(a),t=t.concat(a.fields)}return t}var R=e.data.FieldExprPattern,T=e.data.services.SemanticQuerySerializer,N=e.data.SQExpr,M=e.data.SQExprConverter,I=e.data.SQExprUtils,j=jsCommon.StringExtensions,O=e.visuals.valueFormatter,A="Filter";r.getFormatter=i,r.getDefaultFilterType=n,r.canAdd=a,r.supportsVisualFilters=o,r.add=s,r.shouldDisableFilter=l,r.getValueType=u,r.getDefaultRetainedValue=c,r.validate=p,r.getNextFilterName=f,r.getNextAutoGenRestatement=d,r.isCategoricalFilter=h,r.getQueryRefsForSingleItemDrillFilters=m,r.areSingleValueFilters=v,r.isSingleValueFilter=g,r.getFiltersForColumn=y,r.getFilterValues=b,r.deriveFromSQFilters=x,r.extractParameterFilters=S,r.mergeExplorationSectionFilters=w,r.applySectionParameterFilters=E,r.extractParameterFiltersFromSection=F,r.mergeFilters=P;var k=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.visitColumnRef=function(e){this.fields.push(e)},t.prototype.visitHierarchyLevel=function(e){this.fields.push(e)},t.prototype.visitMeasureRef=function(e){this.fields.push(e)},t.prototype.visitEntity=function(e){this.fields.push(e)},t.prototype.visitAggr=function(e){},t})(e.data.DefaultSQExprVisitorWithTraversal)})(r=t.FilterUtils||(t.FilterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.cultureInfo=e,this.maxDecimalPlaces=15}return e.prototype.updateFormatUponDataTypeChange=function(e,t){var r=this;return this.updateFormatInformation(e,t,(function(t){return _.contains(r.getValidFormatsForDataType(e),t.format)||(t=r.getDefaultFormatInformationForDataType(e)),r.updateFormatInformationForDateTimeDataType(e,t),t}))},e.prototype.changeFormat=function(e,t,r){var i=this;return this.updateFormatInformation(e,t,(function(e){return i.setFormatAndDownstreamEffects(e,r),e}))},e.prototype.toggleThousandsSeparator=function(e,t){var r=this;return this.updateFormatInformation(e,t,(function(t){var i=r.getThousandSeparatorValidSettingsForFormat(t.format).isChangeable;if(!i){var n=r.getFormatThatWillAllowThousandSeparatorToChange(e);null!=n&&(r.setFormatAndDownstreamEffects(t,n),i=!0)}return i&&(t.thousandSeparator=!t.thousandSeparator),t}))},e.prototype.setAccuracy=function(e,t,r){var i=this;return this.updateFormatInformation(e,t,(function(t){var n=i.isAccuracyValidForFormat(t.format,r);if(!n){var a=i.getFormatThatWillAllowAccuracyToChange(e,t.format);n=a&&i.isAccuracyValidForFormat(a,r),n&&i.setFormatAndDownstreamEffects(t,a)}return n&&(t.accuracy=r),t}))},e.prototype.setDateTimeFormat=function(e,t,r,i,n){var a=this;return this.updateFormatInformation(e,t,(function(e){return a.setFormatAndDownstreamEffects(e,r),n||(n=a.buildDateTimeFormatString(i)),e.dateTimeCustomFormat={lcid:a.cultureInfo.lcid,formatGroup:i,formatString:n},e}))},e.prototype.setCurrencyFormat=function(e,t,r,i,n,a,o,s){var l=this;return this.updateFormatInformation(e,t,(function(e){return l.setFormatAndDownstreamEffects(e,r),e.currencyFormat={lcid:i,displayName:n,currencySymbol:a,positivePattern:o,negativePattern:s},e}))},e.prototype.updateFormatInformation=function(e,t,r){return t||(t=this.getDefaultFormatInformationForDataType(e)),t=r(t),this.finalizeFormatInformation(t),t},e.prototype.getValidFormatsForDataType=function(e){switch(e){case 11:return["Binary"];case 5:return["Boolean"];case 2:case 3:case 4:return["General","NumberDecimal","NumberWhole","CurrencyCustom","CurrencyGeneral","Percentage","Scientific"];case 7:case 8:case 6:case 9:return["DateTimeGeneralPattern","DateTimeCustom"];case 1:case 13:return["Text"];default:return[]}},e.prototype.getDefaultFormatInformationForDataType=function(e){var t=this.getDefaultFormatForDataType(e);if(!t)return null;var r={formatString:null,format:t,accuracy:this.getDefaultAccuracyForFormat(t),thousandSeparator:this.getDefaultThousandSeparatorForFormat(t),currencyFormat:this.isCurrencyFormat(t)?this.buildDefaultCurrencyFormat():null,dateTimeCustomFormat:this.isDateTimeFormat(t)?this.buildDefaultDateTimeFormat():null};return r},e.prototype.getDefaultFormatForDataType=function(e){switch(e){default:case 0:case 12:case 13:return null;case 1:return"Text";case 2:return"CurrencyGeneral";case 3:return"General";case 4:return"NumberWhole";case 5:return"Boolean";case 6:case 7:case 8:case 9:case 10:return"DateTimeGeneralPattern";case 11:return"Binary"}},e.prototype.setFormatAndDownstreamEffects=function(e,t){e.format=t,this.makeAccuracyValid(e),this.makeThousandSeparatorValid(e),this.makeCurrencyFormatValid(e),this.makeDateTimeFormatValid(e)},e.prototype.makeAccuracyValid=function(e){var t=this.getAccuracyRangeForFormat(e.format);t?(null==e.accuracy||e.accuracy<t.min||e.accuracy>t.max)&&(e.accuracy=t.default):e.accuracy=null},e.prototype.getFormatThatWillAllowAccuracyToChange=function(e,t){switch(e){case 2:return"CurrencyCustom";case 3:case 4:return"CurrencyGeneral"===t?"CurrencyCustom":"NumberDecimal"}},e.prototype.getDefaultAccuracyForFormat=function(e){var t=this.getAccuracyRangeForFormat(e);return t&&t.default},e.prototype.isAccuracyValidForFormat=function(e,t){var r=this.getAccuracyRangeForFormat(e);return null!=r&&t>=r.min&&t<=r.max},e.prototype.getAccuracyRangeForFormat=function(e){switch(e){case"NumberWhole":return{min:0,max:0,default:0};case"CurrencyCustom":return{min:0,max:this.maxDecimalPlaces,default:this.cultureInfo.currencyDecimalDigits};case"NumberDecimal":case"Scientific":return{min:0,max:this.maxDecimalPlaces,default:this.cultureInfo.numberDecimalDigits};case"Percentage":return{min:0,max:this.maxDecimalPlaces,default:this.cultureInfo.percentDecimalDigits}}},e.prototype.makeThousandSeparatorValid=function(e){var t=this.getThousandSeparatorValidSettingsForFormat(e.format);t.isChangeable||(e.thousandSeparator=t.defaultValue)},e.prototype.getFormatThatWillAllowThousandSeparatorToChange=function(e){switch(e){case 2:case 3:return"NumberDecimal";case 4:return"NumberWhole"}},e.prototype.getDefaultThousandSeparatorForFormat=function(e){return this.getThousandSeparatorValidSettingsForFormat(e).defaultValue},e.prototype.getThousandSeparatorValidSettingsForFormat=function(e){switch(e){case"CurrencyGeneral":case"CurrencyCustom":return{isChangeable:!1,defaultValue:!0};case"General":case"Scientific":case"Binary":case"Boolean":case"DateTimeGeneralPattern":case"DateTimeCustom":case"Text":default:return{isChangeable:!1,defaultValue:!1};case"NumberDecimal":case"NumberWhole":case"Percentage":return{isChangeable:!0,defaultValue:!1}}},e.prototype.finalizeFormatInformation=function(e){e.formatString=this.buildFormatString(e)},e.prototype.buildFormatString=function(e){var t=this.buildThousandsPartOfFormatString(e.thousandSeparator),r=this.buildDecimalPartOfFormatString(e.accuracy);switch(e.format){case"Text":case"General":return"G";case"NumberDecimal":return t+"0"+r;case"NumberWhole":return t+"0";case"CurrencyGeneral":case"CurrencyCustom":"CurrencyGeneral"===e.format&&(r=".###############");var i=e.currencyFormat,n=i.currencySymbol,a=t+"0"+r,o=this.buildCurrencyPositiveFormatter(n,i.positivePattern,a),s=this.buildCurrencyNegativeFormatter(n,i.negativePattern,a);return o+";"+s+";"+o;case"Percentage":var l=this.cultureInfo.percentSymbol,u=this.cultureInfo.percentPositivePattern,c=this.cultureInfo.percentNegativePattern,a=t+"0"+r,o=this.buildPercentPositiveFormatter(l,u,a),s=this.buildPercentNegativeFormatter(l,c,a);return o+";"+s+";"+o;case"Scientific":return"0"+r+"E+000";case"DateTimeGeneralPattern":case"DateTimeCustom":return e.dateTimeCustomFormat.formatString;case"Boolean":return'"TRUE";"TRUE";"FALSE"'}return""},e.prototype.buildThousandsPartOfFormatString=function(e){return e?"#,":""},e.prototype.buildDecimalPartOfFormatString=function(e){return null==e||e<=0?"":"."+_.repeat("0",e)},e.prototype.buildCurrencyNegativeFormatter=function(e,t,r){switch(e=this.escapeCurrencySymbol(e),t){case 0:return"("+e+r+")";case 1:return"-"+e+r;case 2:return e+"-"+r;case 3:return""+e+r+"-";case 4:return"("+r+e+")";case 5:return"-"+r+e;case 6:return r+"-"+e;case 7:return""+r+e+"-";case 8:return"-"+r+" "+e;case 9:return"-"+e+" "+r;case 10:return r+" "+e+"-";case 11:return e+" "+r+"-";case 12:return e+" -"+r;case 13:return r+"- "+e;case 14:return"("+e+" "+r+")";case 15:return"("+r+" "+e+")"}return""},e.prototype.buildCurrencyPositiveFormatter=function(e,t,r){switch(e=this.escapeCurrencySymbol(e),t){case 0:return""+e+r;case 1:return""+r+e;case 2:return e+" "+r;case 3:return r+" "+e}return""},e.prototype.escapeCurrencySymbol=function(e){return"$"===e?"\\$":'"'+e+'"'},e.prototype.buildPercentNegativeFormatter=function(e,t,r){switch(t){case 0:return"-"+r+" "+e;case 1:return"-"+r+e;case 2:return"-"+e+r;case 3:return e+"-"+r;case 4:return""+e+r+"-";case 5:return r+"-"+e;case 6:return""+r+e+"-";case 7:return"-"+e+" "+r;case 8:return r+" "+e+"-";case 9:return e+" "+r+"-";case 10:return e+" -"+r;case 11:return r+"- "+e}return""},e.prototype.buildPercentPositiveFormatter=function(e,t,r){switch(t){case 0:return r+" "+e;case 1:return""+r+e;case 2:return""+e+r;case 3:return e+" "+r}return""},e.prototype.buildDateTimeFormatString=function(e){switch(e){case"GeneralDateTimeLong":return"G";case"ShortDate":return this.cultureInfo.shortDatePattern;case"LongDate":return this.cultureInfo.longDatePattern;case"MonthDay":return this.cultureInfo.monthDayPattern;case"RFC1123":return this.cultureInfo.rfc1123Pattern;case"SortableDateTime":return this.cultureInfo.sortableDateTimePattern;case"ShortTime":return this.cultureInfo.shortTimePattern;case"LongTime":return this.cultureInfo.longTimePattern;case"UniversalSortableDateTime":return this.cultureInfo.universalSortableDateTimePattern;case"YearMonth":return this.cultureInfo.yearMonthPattern;case"YearYY":return"yy";case"YearYYYY":return"yyyy";case"FullDateTimeShort":case"GeneralDateTimeShort":case"RoundTripDateTime":case"UniversalFullDateTime":case"FullDateTimeLong":default:return this.cultureInfo.fullDateTimePattern}},e.prototype.buildDateTimeFormat=function(e){return{lcid:this.cultureInfo.lcid,formatGroup:e,formatString:this.buildDateTimeFormatString(e)}},e.prototype.buildDefaultDateTimeFormat=function(){return this.buildDateTimeFormat("GeneralDateTimeLong")},e.prototype.buildDefaultDateFormat=function(){return this.buildDateTimeFormat("LongDate")},e.prototype.buildDefaultTimeFormat=function(){return this.buildDateTimeFormat("LongTime")},e.prototype.updateFormatInformationForDateTimeDataType=function(e,t){if(6===e||9===e){var r=t.dateTimeCustomFormat,i=r.formatGroup;6===e?"LongDate"!==i&&"ShortDate"!==i&&(t.dateTimeCustomFormat=this.buildDefaultDateFormat()):"LongTime"!==i&&"ShortTime"!==i&&(t.dateTimeCustomFormat=this.buildDefaultTimeFormat())}},e.prototype.makeDateTimeFormatValid=function(e){this.isDateTimeFormat(e.format)?e.dateTimeCustomFormat||(e.dateTimeCustomFormat=this.buildDefaultDateTimeFormat()):e.dateTimeCustomFormat=null},e.prototype.isDateTimeFormat=function(e){return"DateTimeCustom"===e||"DateTimeGeneralPattern"===e},e.prototype.buildDefaultCurrencyFormat=function(){return{lcid:this.cultureInfo.lcid,displayName:this.cultureInfo.currencySymbol+" "+this.cultureInfo.displayName,currencySymbol:this.cultureInfo.currencySymbol,positivePattern:this.cultureInfo.currencyPositivePattern,negativePattern:this.cultureInfo.currencyNegativePattern}},e.prototype.makeCurrencyFormatValid=function(e){this.isCurrencyFormat(e.format)?e.currencyFormat||(e.currencyFormat=this.buildDefaultCurrencyFormat()):e.currencyFormat=null},e.prototype.isCurrencyFormat=function(e){return"CurrencyCustom"===e||"CurrencyGeneral"===e},e})();e.FormatUtils=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.SQExprConverter,o=e.data.SQExprGroupUtils,s=e.data.SQHierarchyExprUtils;!(function(t){function r(e,t,r,n){if(r&&t&&i.isHierarchyLevel(n)){for(var a=n,l=a.arg,u=s.expandExpr(e,l),c=[],p=0,f=t.dataRoles;p<f.length;p++){var d=f[p],h=r.tryGetExprs(d.name);if(h)for(var m=_(o.groupExprs(e,h)).filter((function(e){return i.equals(e.expr,l)})).reverse().value(),v=0,g=m;v<g.length;v++){var y=g[v],b=s.getInsertionIndex(u,y.children,a);c.push({expr:a,schema:e,targetRole:d.name,targetIndex:y.selectQueryIndex+b})}}return c}}function l(t,r){if(t&&t.kind===e.VisualDataRoleKind.Measure){var i=s.getHierarchySourceAsVariationSource(r);if(i)return n.columnRef(i.arg,i.property)}}function u(e,t,r,n,a,o){var s=e.singleVisual.query.tryGetExprs(t)||[],u=s.slice(r,r+n);if(!_.isEmpty(u)){var c;if(c=_.isEmpty(o)?u[0]:o[0],i.isHierarchyLevel(c)){var p=l(a,c);if(p)return[p]}return _.isEmpty(o)?u:o}}function c(e,t){return i.isHierarchyLevel(e)&&i.isHierarchyLevel(t)&&i.equals(e.arg,t.arg)}function p(e,t){var r=a.asFieldPattern(t),i=r.hierarchyLevel;if(i){var n=e.findHierarchy(i.entity,i.name);return n?_.findIndex(n.levels,(function(e){return e.name===i.level})):void 0}}function f(e){_.isEmpty(e)||e.sort(d)}function d(e,t){return e.displayName.localeCompare(t.displayName,void 0,{sensitivity:"base"})}t.getOptionsToAddHierarchyLevelToExistingHierarchies=r,t.getHierarchyReplacementExpressions=u,t.hierarchyLevelComparer=c,t.findHierarchyLevelIndex=p,t.sortHierarchies=f})(r=t.HierarchyUtils||(t.HierarchyUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.visuals.matrixRoleNames;!(function(e){function t(e,t,o,s,l){if(e.matrix){for(var u=[],c=[],p=[],f=[],d=e.matrix,h=0,m=t;h<m.length;h++){var v=m[h],g=__assign({},v);g.roles={},u.push(g)}var y=function(e){if(l&&l.featureSwitches.showGeneratedColumnsInDetailView)return!0;var r=t[e.index];return!r||!_.isEmpty(r.roles)},b=r(d.rows,u,c,i.rows)&&r(d.columns,u,p,i.columns,(function(e){return!e.isMeasure}))&&n(d.valueSources,u,f,i.values,y);if(b){a(o,s,c,p,f);var C={};c.length>0&&(C[i.rows]=c),p.length>0&&(C[i.columns]=p),f.length>0&&(C[i.values]=f);var x={selects:u,roles:{ordering:C}};return x}}}function r(e,t,r,i,a){if(!e||_.isEmpty(e.levels))return!0;for(var o=0,s=e.levels;o<s.length;o++){var l=s[o];if(!n(l.sources,t,r,i,a))return!1}return!0}function n(e,t,r,i,n){if(_.isEmpty(e))return!0;for(var a=0,o=e;a<o.length;a++){var s=o[a];if(!n||n(s)){if(r.push(s.index),!t[s.index])return!1;t[s.index].roles[i]=!0}}return!0}function a(e,t,r,i,n){if(!_.isEmpty(e)&&t){var a=r.length>=2,l=i.length>=2,u=n.length>=2;if(a||l||u){var c=o(e,t);c&&(a&&s(r,c),l&&s(i,c),u&&s(n,c))}}}function o(e,t){var r=_.chain(e).map((function(e){return t[e]})).flatten().filter((function(e){return _.isNumber(e)})).value(),i=_.reduce(r,(function(e,t,r){return void 0===e[t]&&(e[t]=r),e}),{});return Object.keys(i).length>=2?i:void 0}function s(e,t){e.sort((function(e,r){return l(e,t)-l(r,t)}))}function l(e,t,r){return void 0===r&&(r=Number.MAX_VALUE),_.isNumber(t[e])?t[e]:r}e.generate=t})(r=t.MatrixVisualDataViewConverter||(t.MatrixVisualDataViewConverter={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.contracts.SchemaChangeType.ObjectTypeEnum,a=e.data.SQExpr,o=e.data.SQExprBuilder,s=e.data.SQExprConverter;!(function(e){function t(e,t,r){if(e){var n=s.asFieldPattern(e),a=i.toFieldExprEntityItemPattern(n),o=""===a.entity?null:a.entity,l={itemShowHide:{schema:a.schema,entity:o,property:b(n),objectType:y(n),makeHidden:t}};g(l,r)}}function r(e,t){if(e){var r,n=s.asFieldPattern(e);if(n.hierarchyLevel){var a=n.hierarchyLevel;r={hierarchyLevelDelete:{schema:a.schema,entity:a.entity,hierarchy:a.name,hierarchyLevel:a.level}}}else{var o=i.toFieldExprEntityItemPattern(n);r={itemDelete:{schema:o.schema,entity:o.entity,property:b(n),objectType:y(n)}}}g(r,t)}}function l(e,t,r){if(e){var i=s.asFieldPattern(e),n=i.hierarchyLevel;if(n){var a={hierarchyLevelMove:{schema:n.schema,entity:n.entity,hierarchy:n.name,level:n.level,index:t}};g(a,r)}}}function u(e,t){var r=i.toFieldExprEntityItemPattern(e),n={entityRefresh:{schema:r.schema,entity:r.entity}};g(n,t)}function c(e,t,r){if(e){var n,a=s.asFieldPattern(e),o=i.toFieldExprEntityItemPattern(a);if(a.hierarchyLevel){var l=a.hierarchyLevel;n={hierarchyLevelRename:{schema:l.schema,entity:l.entity,hierarchy:l.name,before:l.level,after:t}}}else i.hasFieldExprName(a)?n={propertyRename:{schema:o.schema,entity:o.entity,objectType:y(a),before:b(a),after:t}}:a.hierarchy?n={propertyRename:{schema:o.schema,entity:o.entity,objectType:y(a),before:i.getHierarchyName(a),after:t}}:o.entity&&(n={entityRename:{schema:o.schema,before:o.entity,after:t}});g(n,r)}}function p(e,t){var r={newMeasure:{schema:e.schema,entity:e.entity}};g(r,t)}function f(e,t){if(!_.isEmpty(e)){for(var r,i=[],n=0,o=e;n<o.length;n++){var l=o[n],u=s.asFieldPattern(l),c=u.column||u.groupingColumn;if(!c)return;if(r){if(!a.equals(l.source,r))return}else r=l.source;i.push(c.name)}var p={hierarchyCreate:{schema:r.schema,entity:r.entity,name:null,properties:i}};g(p,t)}}function d(e,t,r,i){if(e){var n=s.asFieldPattern(e),a=n.column||n.groupingColumn;if(a){var o={hierarchyLevelCreate:{schema:a.schema,entity:a.entity,hierarchy:t,property:a.name,index:r}};g(o,i)}}}function h(e,t){var r={newCalculatedColumn:{schema:e.schema,entity:e.entity}};g(r,t)}function m(e){if(null!=e&&!_.isEmpty(e.changes)){var t=_.filter(e.changes,(function(e){return e.newMeasureCreated||e.newCalculatedColumnCreated||e.measureMove||e.newCalculatedTableCreated||e.newBins||e.newGroups}));if(0!==t.length){var r,i,n,a,s=t[t.length-1];return s.newMeasureCreated?(r=s.newMeasureCreated.schema,i=s.newMeasureCreated.entity,a=s.newMeasureCreated.measureDefinition.name,o.measureRef(o.entity(r,i),a)):s.newCalculatedColumnCreated?(r=s.newCalculatedColumnCreated.schema,i=s.newCalculatedColumnCreated.entity,n=s.newCalculatedColumnCreated.name,o.columnRef(o.entity(r,i),n||a)):s.newCalculatedTableCreated?(r=s.newCalculatedTableCreated.schema,i=s.newCalculatedTableCreated.entity,o.entity(r,i)):s.measureMove?(r=s.measureMove.schema,i=s.measureMove.destination,a=s.measureMove.property,o.measureRef(o.entity(r,i),a)):s.newBins?(r=s.newBins.schema,i=s.newBins.entity,n=s.newBins.name,o.columnRef(o.entity(r,i),n)):s.newGroups?(r=s.newGroups.schema,i=s.newGroups.entity,n=s.newGroups.name,o.columnRef(o.entity(r,i),n)):void 0}}}function v(e,t,r){var i=[];if(e&&(i=e.validate(t,r,i)),!_.isEmpty(i))return i}function g(e,t){t.apply({changes:[e]})}function y(e){return b(e)?e.column||e.groupingColumn?n.Column:e.measure?n.Measure:e.hierarchy?n.Hierarchy:"":n.Table}function b(e){return i.getPropertyName(e)||i.getHierarchyName(e)}e.hide=t,e.deleteItem=r,e.move=l,e.refreshEntity=u,e.rename=c,e.createMeasure=p,e.createHierarchy=f,e.createHierarchyLevel=d,e.createCalculatedColumn=h,e.getSelectedItemFromModelChange=m,e.validate=v,e.GetObjectTypeForSchemaChange=y})(r=t.ModelAuthoringUtility||(t.ModelAuthoringUtility={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}var r;!(function(e){e[e.None=0]="None",e[e.DuplicatedName=1]="DuplicatedName",e[e.EmptyName=2]="EmptyName",e[e.NameTooLong=3]="NameTooLong"})(r=e.NameValidationError||(e.NameValidationError={})),e.createNameValidator=t;var i=(function(){function e(e,t){this.federatedConceptualSchema=e,this.localizationService=t,this.MaximumNameLength=512}return e.prototype.validateMeasureName=function(t,i){if(!t||0===t.trim().length)return{error:r.EmptyName,reason:this.localizationService.get("NameValidationFailedEmptyName")};if(t.length>this.MaximumNameLength)return{error:r.NameTooLong,reason:this.localizationService.format("NameValidationFailedLongName",[t,this.MaximumNameLength])};var n=e.normalizeModelItemName(t);return i&&e.normalizeModelItemName(i)===n?{error:r.None}:this.validateColumnAndMeasureNameUniqueness(n)},e.prototype.validateExistingMeasureName=function(t){var r=e.normalizeModelItemName(t.name);return this.validateColumnAndMeasureNameUniqueness(r,(function(e,r){return r!==t}))},e.prototype.makeValidMeasureName=function(e){var t=this;return this.makeValidName(e,(function(e){return t.validateMeasureName(e).error}))},e.prototype.makeValidName=function(e,t){var i,n=e,a=t(n);if(a===r.DuplicatedName)i=2;else{if(a===r.None)return e;i=0}for(;;){var o=void 0;switch(o=i?n+" "+i:n,a=t(o)){case r.None:return o;case r.DuplicatedName:i++,1===i&&(i=2);continue;case r.NameTooLong:n=n.slice(0,Math.min(this.MaximumNameLength,n.length-1)),i=0;continue;default:throw new Error("MakeValidName encountered a problem it can't fix.")}}},e.prototype.validateColumnAndMeasureNameUniqueness=function(t,i){for(var n=0,a=this.federatedConceptualSchema.schemas;n<a.length;n++)for(var o=a[n],s=0,l=o.entities;s<l.length;s++)for(var u=l[s],c=0,p=u.properties;c<p.length;c++){var f=p[c];if((!i||i(u,f))&&e.normalizeModelItemName(f.name)===t){
var d=f.measure?"NameValidationFailedCollisionMeasure":"NameValidationFailedCollisionColumn";return{error:r.DuplicatedName,reason:this.localizationService.format(d,[f.name,u.name])}}}return{error:r.None}},e.normalizeModelItemName=function(e){return jsCommon.StringExtensions.normalizeCase(e)},e})()})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new o(e,t,r,i)}var i=e.data.QueryProjectionCollection,n=e.data.QueryProjectionsByRole,a=(function(){function e(e,t,r){this.plugin=e,this.initialize(t,r)}return Object.defineProperty(e,"ValuesRoleName",{get:function(){return e.ValuesRole},enumerable:!0,configurable:!0}),e.getProjection=function(e,t){var r=n.getRole(e,t);return r||(e[t]=r=new i([])),r.all()},e.addCategoryRole=function(t,r){e.getProjection(t,e.CategoryRole).push(r.projection)},e.addValuesRole=function(t,r){e.getProjection(t,e.ValuesRole).push(r.projection)},e.addSeriesRole=function(t,r){e.getProjection(t,e.SeriesRole).push(r.projection)},e.addBreakdownRole=function(t,r){e.getProjection(t,e.BreakdownRole).push(r.projection)},e.addGroupRole=function(t,r){e.getProjection(t,e.GroupRole).push(r.projection)},e.addDetailsRole=function(t,r){e.getProjection(t,e.DetailsRole).push(r.projection)},e.addYRole=function(t,r){e.getProjection(t,e.YRole).push(r.projection)},e.addTargetValueRole=function(t,r){e.getProjection(t,e.TargetValueRole).push(r.projection)},e.addMinValueRole=function(t,r){e.getProjection(t,e.MinValueRole).push(r.projection)},e.addMaxValueRole=function(t,r){e.getProjection(t,e.MaxValueRole).push(r.projection)},e.addXRole=function(t,r){e.getProjection(t,e.XRole).push(r.projection)},e.addSizeRole=function(t,r){e.getProjection(t,e.SizeRole).push(r.projection)},e.addGradientRole=function(t,r){e.getProjection(t,e.GradientRole).push(r.projection)},e.addTooltipRole=function(t,r){e.getProjection(t,e.TooltipRole).push(r.projection)},e.addRowsRole=function(t,r){e.getProjection(t,e.RowsRole).push(r.projection)},e.addColumnsRole=function(t,r){e.getProjection(t,e.ColumnsRole).push(r.projection)},e.prototype.initialize=function(e,t){var r=e.select();this.projectionsInfo=[];for(var i=0,n=r.length;i<n;i++){var a=r[i];this.projectionsInfo.push({projection:{queryRef:a.name},metadata:a.expr.getMetadata(t)})}},e.ValuesRole="Values",e.SeriesRole="Series",e.BreakdownRole="Breakdown",e.CategoryRole="Category",e.GroupRole="Group",e.DetailsRole="Details",e.YRole="Y",e.XRole="X",e.SizeRole="Size",e.GradientRole="Gradient",e.PlayRole="Play",e.RowsRole="Rows",e.ColumnsRole="Columns",e.MinValueRole="MinValue",e.MaxValueRole="MaxValue",e.TargetValueRole="TargetValue",e.TooltipRole="Tooltips",e})();t.QueryProjectionBuilder=a;var o=(function(e){function t(t,r,i,n){var a=e.call(this,t,i,n)||this;return a.dataRoles=r,a}return __extends(t,e),t.prototype.validatePlugin=function(){return!0},t.prototype.build=function(e){for(var t={},r=0,i=this.dataRoles.length;r<i;r++){var n=this.dataRoles[r],o=this.projectionsInfo[n.Projection];if(o&&(a.getProjection(t,n.Name).push(o.projection),n.isActive)){var s=t[n.Name];s.addActiveQueryReference(o.projection.queryRef)}}return t},t})(a);t.DataRolesQueryProjectionBuilder=o,t.createProjectionBuilderFromDataRoles=r})(r=t.QueryProjectionBuilderCoreUtils||(t.QueryProjectionBuilderCoreUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,i){var n=e.createJQueryPromiseFactory().defer(),a=d(t,r);return a===-1?n.resolve(void 0):i.get(t.reportId,t.pods[a].name).then((function(e){var t=e&&e.words.slice();if(_.isEmpty(t))n.resolve(void 0);else{t.shift();var r={altNames:t};n.resolve(r)}})),n.promise}function i(e,t,r){var i=d(e,t);i>-1&&(r.set(e.reportId,e.pods[i].name,[]),e.pods.splice(i,1))}function n(e,t,r){return a(e,t.name,t.displayName,r)}function a(e,t,r,i){var n=d(e,t);n===-1&&(n=m(e,t));var a=e.pods[n];return i.get(e.reportId,a.name).then((function(t){var n=t&&t.words;_.isEmpty(n)?n=[r]:n[0]=r,i.set(e.reportId,a.name,n)}))}function o(e,t,r,i){var n=d(e,t.name);n===-1&&(n=m(e,t.name)),r.unshift(t.displayName),i.set(e.reportId,e.pods[n].name,r)}function s(e,t,r){var i=d(e,t);i===-1&&(i=m(e,t));var n=e.pods[i];n.parameters||(n.parameters=[]),n.parameters.push({name:"Param_"+r,boundFilter:r})}function l(e,t,r,i){var n=d(e,t);if(n>-1){var a=e.pods[n],o=h(a,r);o>-1&&(a.parameters.splice(o,1),v(e,n,i))}}function u(e,t,r){var i=d(e,t);if(i===-1)return!1;var n=h(e.pods[i],r);return n!==-1}function c(e,t,r,i){var n=d(e,t);(n!==-1||r)&&(n===-1&&(n=m(e,t)),e.pods[n].cortanaEnabled=r,v(e,n,i))}function p(e,t){if(e&&e.pods){var r=e.pods,i=_.findIndex(r,(function(e){return e.name===t}));return i!==-1?i:void 0}}function f(t,r,i,n){var a=d(t,t.sections[i].name);if(a===-1)return e.createJQueryPromiseFactory().resolve();var o=m(t,r.name),s=t.pods[o],l=t.pods[a];return s.cortanaEnabled=l.cortanaEnabled,s.parameters=_.cloneDeep(l.parameters),y(t.reportId,r,s,l,n)}function d(e,t){return e&&e.pods?_.findIndex(e.pods,(function(e){return e.boundSection===t})):-1}function h(e,t){return e&&e.parameters?_.findIndex(e.parameters,(function(e){return e.boundFilter===t})):-1}function m(e,t){return e.pods||(e.pods=[]),e.pods.push({name:g(e.pods),boundSection:t,parameters:[]}),e.pods.length-1}function v(e,t,r){var i=e.pods[t];!i.cortanaEnabled&&_.isEmpty(i.parameters)&&r.get(e.reportId,i.name).then((function(r){r&&!_.isEmpty(r.words)||(e.pods.splice(t,1),0===e.pods.length&&(e.pods=void 0))}))}function g(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return b.findUniqueName(t,C)}function y(e,t,r,i,n){return n.get(e,i.name).then((function(i){var a=i&&i.words.slice();_.isEmpty(a)||(a.shift(),a.unshift(t.displayName),n.set(e,r.name,a))}))}var b=jsCommon.StringExtensions,C="Pod";t.getLinguisticMetadata=r,t.deletePod=i,t.ensurePod=n,t.updateLinguisticPrimaryName=a,t.updateLinguisticAltNames=o,t.addParameter=s,t.deleteParameter=l,t.hasParameter=u,t.setCortanaEnabled=c,t.findPodIndexForPodName=p,t.duplicatePod=f,t.findPodIndexForSectionName=d})(r=t.PodUtils||(t.PodUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return{automaticallyImport:!1,sandboxProperties:[i.AllowSameOrigin,i.AllowForms,i.AllowScripts]}}var i=e.visualHost.SandboxProperty;t.createPowerAppsVisualRegisterOptions=r})(r=t.PowerAppsVisualHelper||(t.PowerAppsVisualHelper={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(e){var t=e.resourcePackages;return t||(t=[],e.resourcePackages=t),t}function i(e,t,r){var i=_.find(e,(function(e){return e.type===t&&e.name===r}));return i||(i={id:void 0,name:r,type:t,items:[]},e.push(i)),i}function n(r){var i=t.ensureResourcePackages(r),n=t.ensureResourcePackage(i,1,e.visualHost.constants.RegistedredResourcePackageName);return n}t.ensureResourcePackages=r,t.ensureResourcePackage=i,t.ensureRegisteredResourcePackage=n})(r=t.ResourcePackageUtils||(t.ResourcePackageUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t){for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i];a.measureMove&&r.push(new c(e.data.createMoveMeasureRewriter(a.measureMove))),a.entityRename&&r.push(new c(e.data.createEntityRenameRewriter(a.entityRename))),a.propertyRename&&r.push(new c(e.data.createPropertyRenameRewriter(a.propertyRename))),a.hierarchyLevelRename&&r.push(new c(e.data.createHierarchyLevelRenameRewriter(a.hierarchyLevelRename))),a.removeVariation&&r.push(new p(new u(a.removeVariation),a.removeVariation))}return r}function i(e,t){var r=s.asFieldPattern(e);return r.columnHierarchyLevelVariation&&r.columnHierarchyLevelVariation.source.entity===t.entity&&r.columnHierarchyLevelVariation.source.schema===t.schema&&r.columnHierarchyLevelVariation.source.name===t.property&&r.columnHierarchyLevelVariation.variationName===t.name}var n=e.data.SQColumnRefExpr,a=e.data.SQEntityExpr,o=e.data.SQExpr,s=e.data.SQExprConverter,l=e.data.SQExprRewriter;t.createSchemaChangeRewriters=r;var u=(function(e){function t(t){var r=this;return r=e.call(this)||this,r.change=t,r}return __extends(t,e),t.prototype.visitHierarchyLevel=function(e){return i(e,this.change)?new n(new a(this.change.schema,this.change.entity),this.change.property):e},t})(l),c=(function(){function e(e){this.rewriter=e}return e.prototype.rewriteQuery=function(e){var t=e.defn;return t=t.rewrite(this.rewriter),e.defn=t,e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.rewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.rewriter)},e})();t.VisualQueryExprRewriter=c;var p=(function(){function e(e,t){this.rewriter=e,this.change=t}return e.prototype.rewriteQuery=function(e){this.removeDuplicateSQHierarchyLevelExpr(e);var t=e.defn;return t=t.rewrite(this.rewriter),e.defn=t,e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.rewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.rewriter)},e.prototype.removeDuplicateSQHierarchyLevelExpr=function(e){for(var t=e.defn.select(),r=0;r<t.length;){var n=t[r];if(r++,o.isHierarchyLevel(n.expr)&&i(n.expr,this.change))for(;r<t.length&&o.isHierarchyLevel(t[r].expr)&&o.equals(n.expr.arg,t[r].expr.arg);)e.removeExpr(t[r].expr,!1),r++}},e})()})(r=t.schemaRewriterUtils||(t.schemaRewriterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=[];if(!e||!e.visualContainers)return r;for(var i=0,n=e.visualContainers;i<n.length;i++){var a=n[i];t.addScriptVisualId(a,r)}return r}function r(e,r){var i={totalVisualsCount:0,scriptVisualsUniqueIds:[]};if(!e||!e.sections)return i;for(var n=0,a=e.sections;n<a.length;n++){var o=a[n];if(o.visualContainers){var s=t(o,r);i.scriptVisualsUniqueIds=i.scriptVisualsUniqueIds.concat(s),i.totalVisualsCount+=o.visualContainers.length}}return i}function i(e,r,i,n,a){var o=[];switch(e){case 0:if(!n)return o;a.addScriptVisualId(n,o);break;case 1:o=t(i,a);break;case 2:if(!r)return o;for(var s=0,l=r.sections;s<l.length;s++){var u=l[s],c=t(u,a);o=o.concat(c)}break;default:return o}return o}function n(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n&&n.config&&n.config.singleVisual){var a=n.config.singleVisual.visualType;if(a&&t.isScriptVisual(a))return!0}}return!1}function a(e,t,r,i,n,a){var o=e.control(),s=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_OkButton"),l=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_CancelButton"),u=[new InJs.ModalDialogAction(s,function(e,t){o.hideDialog(),n()}),new InJs.ModalDialogAction(l,function(e,t){o.hideDialog(),a()})],c=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_Title"),p=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_WarningMessage"),f="<div><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart1")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821887" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink1")+"</a><span> "+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart2")+"</span><br/><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart3")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821886" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink2")+"</a></div>";i.message=p;var d={dialogName:c,isDismissable:!1,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",dialogActions:u,notificationType:jsCommon.ModalDialogNotificationType.SecurityWarning,notificationText:p,htmlMessageText:f,focusOnFirstButton:!1,noActiveButtons:!0,flipContentAndNotificationOrder:!0};r.showLegacyWebModalDialog(d)}e.defaultScript="##############################",e.getScriptVisualIdsInSection=t,e.getVisualStasInExploration=r,e.getScriptVisualIds=i,e.visualContainerHasScriptVisuals=n,e.confirmRefreshForRDataSource=a})(t=e.ScriptVisualsUtil||(e.ScriptVisualsUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,r){void 0===r&&(r=!0),this.containerSelector=e,this.itemsSelector=t,this.includeDescendants=r}return Object.defineProperty(e.prototype,"position",{get:function(){},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.scrollItemIntoView=function(e,t,r){var i=this.getContainer(),n=this.getRange(i),a=this.getItems(),o=a[e];if(o){var s=0===e,l=e===a.length-1,u=this.getRange($(o),!0);if(s?t=0:l?t=r||0:null!==t&&void 0!==t||(t=this.getDefaultOverscroll()),n&&u){var c=this.calculatePositionDelta(n,u,t);this.position=this.position+c}}},e.prototype.getPageDownItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n<r.length-1;n++){var a=this.getRange(r.eq(n));if(i+=a.size,i>t.size)return n}return r.length-1}return-1},e.prototype.getPageUpItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n>0;n--){var a=this.getRange(r.eq(n));if(i+=a.size,i>t.size)return n}return 0}return-1},e.prototype.retainPosition=function(e){var t=this.position;try{e()}finally{this.position=t}},e.prototype.handleKeyDown=function(e,t,r){var i=!0,n=e,a=this.getItems(),o=a.length-1;switch(t.keyCode){case $.ui.keyCode.PAGE_UP:var s=this.getPageUpItemIndex(e);n=Math.max(s,0);break;case $.ui.keyCode.PAGE_DOWN:var l=this.getPageDownItemIndex(e);n=Math.min(l,o);break;case $.ui.keyCode.END:n=o;break;case $.ui.keyCode.HOME:n=0;break;default:n=this.getNewIndexOnKeyDown(e,o,t),i=void 0!==n}return void 0!==n&&n!==e&&(r(n),this.scrollItemIntoView(n)),i},e.prototype.onScroll=function(e){var t=this,r=this.getContainer();r.scroll((function(r){var i=t.position/t.max;e(i)}))},e.prototype.getNewIndexOnKeyDown=function(e,t,r){},e.prototype.getRange=function(e,t){void 0===t&&(t=!1)},e.prototype.getDefaultOverscroll=function(){},e.prototype.getContainer=function(){return $(this.containerSelector)},e.prototype.getItems=function(){return this.retrieveItems()},e.prototype.retrieveItems=function(){return this.includeDescendants?this.getContainer().find(this.itemsSelector):this.getContainer().children(this.itemsSelector)},e.prototype.calculatePositionDelta=function(e,t,r){return t.min<e.min?-(e.min-t.min+r):t.max>e.max?t.max-e.max+r:0},e})();e.BaseScrollHelper=t;var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){var e=this.getContainer();return e.scrollTop()},set:function(e){var t=this.getContainer();t.scrollTop()!==e&&t.scrollTop(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollHeight:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){switch(r.keyCode){case $.ui.keyCode.UP:return r.scrollHandled=!0,Math.min(Math.max(e-1,0),t);case $.ui.keyCode.DOWN:return Math.min(e+1,t)}},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerHeight():e.innerHeight();return{min:r.top,max:r.top+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 0},t})(t);e.VerticalScrollHelper=r;var i=(function(e){function t(t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0);var a=e.call(this,t,r,n)||this;return a.isRtl=i,a}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){var e=this.getContainer();return e.scrollLeft()},set:function(e){var t=this.getContainer();t.scrollLeft()!==e&&t.scrollLeft(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollWidth:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){var i=0;switch(r.keyCode){case $.ui.keyCode.LEFT:i=-1;break;case $.ui.keyCode.RIGHT:i=1}if(this.isRtl&&(i=-i),0!==i)return e+=i,e<0&&(e=0),e>t&&(e=t),e},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerWidth():e.innerWidth();return{min:r.left,max:r.left+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 16},t.prototype.calculatePositionDelta=function(t,r,i){var n=e.prototype.calculatePositionDelta.call(this,t,r,i);return this.isRtl?-n:n},t})(t);e.HorizontalScrollHelper=i;var n=(function(){function e(e,t,r){this.lastScrollLeft=0,this.lastScrollTop=0,this.scrollPanel=e,this.syncedPanel=t,this.syncOptions=r,this.onScroll=this.onScroll.bind(this),this.scrollPanel.addEventListener("scroll",this.onScroll)}return e.prototype.dispose=function(){this.scrollPanel.removeEventListener("scroll",this.onScroll)},e.prototype.onScroll=function(e){var t=this;this.syncOptions.syncDelay?(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.syncScrollPositions()}),this.syncOptions.syncDelay)):this.syncScrollPositions()},e.prototype.syncScrollPositions=function(){if(this.syncOptions.syncX){var e=this.scrollPanel.scrollLeft;e!==this.lastScrollLeft&&(this.syncedPanel.scrollLeft=e,this.lastScrollLeft=e)}if(this.syncOptions.syncY){var t=this.scrollPanel.scrollTop;t!==this.lastScrollTop&&(this.syncedPanel.scrollTop=t,this.lastScrollTop=t)}},e})();e.ScrollSyncHelper=n})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(t,r,i){this.selection=e.createTreeSelectionManager(t),this.scrollHelper=new e.VerticalScrollHelper(r,i),this.getVisibleNodes=t}return t.prototype.onNodeClick=function(e,t){if(t.ctrlKey)this.selection.toggle(e);else if(t.shiftKey&&this.selection.lastSelected){var r=this.selection.lastSelected;this.selection.clear(),this.selection.selectRange(this.getNodesRange(r,e))}else{var i=500;this.lastNodeClickTime&&t.timeStamp-this.lastNodeClickTime>i&&_.isEqual(this.selection.getSelectedItems(),[e])?this.selection.toggle(e):(this.selection.clear(),this.selection.select(e)),this.lastNodeClickTime=t.timeStamp}t.stopPropagation()},t.prototype.onBackgroundClick=function(e){this.selection.clear(),e.stopPropagation()},t.prototype.onKeyDown=function(e){var t=this,r=this.getVisibleNodes(),i=!1,n=this.selection.lastSelected,a=65;e.ctrlKey&&e.keyCode===a&&(this.selection.selectAll(),i=!0),e.keyCode===$.ui.keyCode.ESCAPE&&(this.selection.clear(),i=!0),e.keyCode===$.ui.keyCode.LEFT&&n&&(n.isExpanded?n.isExpanded=!1:n.parent&&this.selectAndScrollTo([n.parent]),i=!0),e.keyCode===$.ui.keyCode.RIGHT&&n?(n.children&&(n.isExpanded?n.children.length>0&&this.selectAndScrollTo([n.children[0]]):n.isExpanded=!0),i=!0):i=this.scrollHelper.handleKeyDown(r.indexOf(this.selection.lastSelected),e,(function(i){e.ctrlKey||e.shiftKey||t.selection.clear(),t.selection.select(r[i])})),i&&(e.stopPropagation(),e.preventDefault())},t.prototype.toggleExpandCollapse=function(e,t){e.isExpanded=!e.isExpanded,t&&t.stopPropagation()},t.prototype.selectAndScrollTo=function(e){var t=this;this.selection.clear(),this.selection.selectRange(e),requestAnimationFrame((function(){var r=t.getVisibleNodes(),i=r.indexOf(e[0]),n=30;t.scrollHelper.scrollItemIntoView(i,n)}))},t.prototype.getNodesRange=function(e,t){var r,i=this.getVisibleNodes(),n=i.indexOf(e),a=i.indexOf(t),o=Math.min(n,a),s=Math.max(n,a);if(o>-1){r=[];for(var l=o;l<=s;l++)r.push(i[l])}return r},t})();e.TreeHelper=t})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createTreeSelectionManager=t;var r=(function(){function e(e){this.selectedItems=[],this.getItems=e}return Object.defineProperty(e.prototype,"lastSelected",{get:function(){return _.last(this.selectedItems)},enumerable:!0,configurable:!0}),e.prototype.getSelectedItems=function(){return this.selectedItems.slice()},e.prototype.select=function(e){e.isSelected||(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.selectRange=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.select(i)}},e.prototype.selectAll=function(){this.selectRange(this.getItems())},e.prototype.toggle=function(e){e.isSelected?(e.isSelected=!1,this.selectedItems.splice(this.selectedItems.indexOf(e),1)):(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.clear=function(){for(var e=0,t=this.selectedItems;e<t.length;e++){var r=t[e];r.isSelected=!1}this.selectedItems.splice(0)},e})()})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return{automaticallyImport:!1,sandboxProperties:[n.AllowSameOrigin,n.AllowForms,n.AllowPopups,n.AllowScripts],visualTypeOptions:i()}}function i(){return{watermarkKey:"visioVisual"}}var n=e.visualHost.SandboxProperty;t.createVisioVisualRegisterOptions=r})(r=t.VisioVisualHelper||(t.VisioVisualHelper={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return{automaticallyImport:!1,sandboxProperties:[i.AllowSameOrigin,i.AllowScripts]}}var i=e.visualHost.SandboxProperty;t.createGlobeMapVisualRegisterOptions=r})(r=t.GlobeMapVisualHelper||(t.GlobeMapVisualHelper={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){var r=e.data;if(!_.isEmpty(r)){for(var a=[],o=0,s=r;o<s.length;o++){var l=s[o];h.isScopeIdentity(l)?a.push(i(l,t)):h.isScopeWildcard(l)||h.isScopeTotal(l)?a.push(n(l,t)):h.isRoleWildcard(l)||h.isWildcard(l)?a.push(l):a.push(l)}e.data=a}}function i(e,t){return p(c(e.expr,t))}function n(e,t){var r=_.map(e.exprs,(function(e){return c(e,t)}));return d.fromExprs(r)}function a(e,t){l(e,t)}function o(e,t){l(e,t)}function s(t,r,i){var n=f.findFilterOutput(r);if(n){var a=e.data.DataViewObjectDefinitions.getPropertyContainer(t,n,null);if(a){var o=n.propertyName,s=a[o];if(s){for(var l=0,u=i;l<u.length;l++){var c=u[l];s=c.rewriteFilter(s)}a[o]=s}}}}function l(e,t){var r=e.expression,i=e.filter;r&&(e.expression=c(r,t)),i&&(e.filter=u(i,t))}function u(e,t){return _.reduce(t,(function(e,t){return t.rewriteFilter(e)}),e)}function c(e,t){return _.reduce(t,(function(e,t){return t.rewriteExpr(e)}),e)}var p=e.data.createDataViewScopeIdentity,f=e.data.DataViewObjectDescriptors,d=e.data.DataViewScopeWildcard,h=e.data.Selector;t.rewriteSelector=r,t.rewriteFilterContainer=a,t.rewriteFilterContainerState=o,t.rewriteFilterOutput=s})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(r,i,a,o,s,l,u){var c=[],p=i.where(c,new e.data.SQFrom),f={expr:[],visualType:s.plugin.name,schema:l,query:new t.contracts.VisualQuery(p,s.build(o))},d=u.create(f);return n(r,i,a,d.singleVisual)}function n(e,r,i,n){var a=t.FilterUtils.deriveFromSQFilters(r.from(),r.where(),i),o={name:e,config:{singleVisual:n},filters:a,layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:null}])};return o}r.create=i,r.createWithSingleVisualConfig=n})(r=t.VisualContainerFactory||(t.VisualContainerFactory={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=jsCommon.CssConstants,a=e.data.services.DataViewObjectSerializer,o=e.common.utils.IdUtility,s=jsCommon.PixelConverter,l=e.data.SQExpr,u=e.data.SQExprUtils;!(function(r){function i(e){if(e&&e.config&&e.config.singleVisual)return e.config.singleVisual.visualType}function c(e){return e.config&&e.config.singleVisual?e.config.singleVisual.query:null}function p(e){var t=e.config;if(t){var r=t.singleVisual;if(r&&r.query){var i=r.query;return i.defn.select()}}}function f(e,t){var i=r.getVisualType(e);if(i&&t){var n=t.getPlugin(i);if(n)return n.capabilities}}function d(e,t){var r=f(e,t);if(r&&!_.isEmpty(r.dataRoles))return r.dataRoles}function h(e){if(e){var t=e.capabilities;if(t&&!_.isEmpty(t.dataRoles))return t.dataRoles}}function m(t,r,i){var n=f(t,r);if(n){var a=c(t);if(a){var o=e.requireSync("Explore/services/visualCapabilitiesHelper").create(n,i);return o.getNumberRangesForRoles(a)}}}function v(e,t){var i=r.getVisualType(e);return t&&t.isScriptVisual(i)}function g(e){return e.config&&e.config.singleVisual&&e.config.singleVisual.objects}function y(e,t,r){var i=e.config.singleVisual.query.projections[t],n=i.all(),a=n[r];return a.queryRef}function b(t,r,i,n,a,o){if(i){var s=i.defn.select(),c=i.projections,p=[],f=[],d=Q(i),h=e.DataViewAnalysis.chooseDataViewMappings(i.projections,a.dataViewMappings,d),m=h.supportedMappings;if(m){for(var v=0,g=m;v<g.length;v++){var y=g[v],b=m.length>1?x(y):null,C=[];for(var E in c)if(null==b||_.contains(b,E))for(var F=c[E],P=0,V=F.all();P<V.length;P++){var D=V[P],R=X.indexWithName(s,D.queryRef),T=s[R];if(!l.isTransformOutputRoleRef(T.expr)){var N=T.expr.getMetadata(r),M={Restatement:t.getDisplayName(T.expr,r,a,T.name,n),Name:D.queryRef,Type:S(N.type)},I=u.getKpiMetadata(T.expr,r);I&&(M.kpi=I);var j=D.format||N.format;j&&(M.Format=j);var O=w(N.type);O&&(M.DataCategory=O),p[R]=M,C.push({Name:E,Projection:R,isActive:_.contains(F.activeProjectionRefs,D.queryRef)})}}f.push({DataRoles:C})}return{queryMetadata:{Select:p,Filters:o},visualElements:f}}}}function C(e,t){var r=e;if(r.role)return void t.push(r.role);var i=e;if(i.bind)return void(i.bind.to&&t.push(i.bind.to));var n=e;if(n.for)return void(n.for.in&&t.push(n.for.in));var a=e;if(a.group){if(a.group.by&&t.push(a.group.by),a.group.select)for(var o=0,s=a.group.select;o<s.length;o++){var l=s[o];C(l,t)}}else{var u=e;if(u.composite)for(var c=0,p=u.composite;c<p.length;c++){var f=p[c];C(f,t)}else{var d=e;if(d.select)for(var h=0,m=d.select;h<m.length;h++){var l=m[h];C(l,t)}}}}function x(e){var t=[];return e&&(e.categorical&&(e.categorical.categories&&C(e.categorical.categories,t),e.categorical.values&&C(e.categorical.values,t)),e.table&&e.table.rows&&C(e.table.rows,t),e.single&&C(e.single,t),e.tree&&(e.tree.nodes&&C(e.tree.nodes,t),e.tree.values&&C(e.tree.values,t)),e.matrix&&(e.matrix.columns&&C(e.matrix.columns,t),e.matrix.rows&&C(e.matrix.rows,t),e.matrix.values&&C(e.matrix.values,t))),t=_.unique(t)}function S(e){switch(e.extendedType){case 66048:return 67;case 131584:return 35}switch(e.primitiveType){case 1:return 2048;case 2:case 3:return 1;case 4:return 3;case 5:return 4096;case 6:return 20;case 7:return 4;case 9:return 8}}function w(e){return J[e.categoryString]}function E(e,t){if(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.defn){var r=e.config.singleVisual.query.projections,i=e.config.singleVisual.query.defn.select();if(r&&i.length>0)for(var n in r)for(var a=r[n],o=0,s=a.all();o<s.length;o++){var l=s[o],u=jsCommon.ArrayExtensions.findItemWithName(i,l.queryRef);if(u){var c=u.expr,p=c.getMetadata(t);if(p&&0===p.kind&&null==p.aggregate)return!0}}return!1}}function F(e){return function(t){return e===t}}function P(e){return function(t){return e!==t}}function V(e,t,r,i){return function(n){if(e===n)return!0;var a=r&&r.relationshipFilterAction(t,e,n,i);return 3!==a}}function D(t,r){t.publishToChannel(e.explore.services.events.dataSelectionChanged,{affectContainer:function(e){return e===r}})}function R(t,i,n,o,s,l,u,c){if(l){var p,f=t.capabilities(l.visualType);if(f){var d=r.describeForPinning(i,s,l.query,l.columnProperties,f,u);if(d){var h=a.serializeObjects(l.objects,f.objects);p=o.transforms&&f&&f.objects?e.data.services.DataViewTransformActionsSerializer.serializeDataViewTransformActions(o.transforms,f.objects):{objects:h},p.objects=p.objects||h,p.visualElements=d.visualElements,p.queryMetadata=d.queryMetadata}}return{queryObject:o.options.query.command,dataObject:n,transformsObject:p,dataUpdatedTime:c}}}function T(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return N(t)}function N(e){return o.generateUniqueId(e)}function M(t,r){t.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(e){return e!==r}})}function I(t){return _.some(t,(function(t){return t.dsr&&t.dsr.vsName===e.common.constants.onPremiseVSName}))}function j(e){return e&&null!=e.fontSize?s.fromPoint(e.fontSize):s.toString(r.DefaultTitleFontSizeInPixel)}function O(t){var i=j(t),n={fontFamily:t&&t.fontFamily||r.DefaultTitleFontFamily,fontSize:i};return e.TextMeasurementService.estimateSvgTextHeight(n)}function A(e,t,r,i){var a={},o=null!=t;return a[n.transformProperty]=o?"scale("+t+")":"",a[n.widthProperty]=o?e.width:"",a[n.heightProperty]=o?e.height:"",a[n.borderProperty]=i||"",a[n.backgroundColorProperty]=r||"",a}function k(t){if(t&&t.show){var r=e.visuals.visualBackgroundHelper.getDefaultValues();return(t.transparency||0===t.transparency)&&(r.transparency=t.transparency),t.color&&(r.color=t.color),e.common.utils.ColorUtility.hexToRGBString(r.color,(100-r.transparency)/100)}}function z(e){return null!=e&&null!=e.metadata&&null!=e.metadata.segment}function q(e){if(e&&e.defn){var t=e.defn.groupBy();return!_.isEmpty(t)}return!1}function B(e){var t=r.getVisualQuery(e);return q(t)}function U(e,t,i){var n=r.getDataRolesForVisual(e,t),a=c(e);if(a&&!_.isEmpty(n)){var o=n[0].name,s=a.tryGetExprs(o);return!_.isEmpty(s)&&_.any(s,(function(e){var t=e.getMetadata(i);if(t)return t.type.text}))}}function L(e,t,r){var i=K(e,r);if(_.isEmpty(i))return!1;for(var n=0,a=i;n<a.length;n++){var o=a[n],s=1===u.getAggregateBehavior(o,t);if(s)return!0}return!1}function Q(t){for(var r={},i=t.defn.select(),n=0,a=i;n<a.length;n++){var o=a[n],s=void 0;s=u.isMeasure(o.expr)?e.VisualDataRoleKind.Measure:e.VisualDataRoleKind.Grouping,r[o.name]=s}return r}function H(e){for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],n=0,a=i.visualContainers;n<a.length;n++){var o=a[n];delete o.cachedData,o.isInitialLoadQueryDirty=!0}}function G(e){for(var t=e.activeSectionIndex,r=e.sections[t].visualContainers,i={},n=0,a=r;n<a.length;n++){var o=a[n],s=o.config.singleVisual.visualType;i[s]||(i[s]=0),i[s]++}return i}function W(e,i,n,a,o){var s=t.FilterUtils.supportsVisualFilters(e,i,n);if(s){var l=function(e){var r=0;return{name:void 0,expression:e,expanded:!1,howCreated:r,type:t.FilterUtils.getDefaultFilterType(e,a,r)}},c=r.getSelectExprs(e);if(c){var p=_.chain(c).map((function(e){return e.expr})).filter((function(e){return u.isExprValidForFiltering(e)&&_.isEmpty(e.validate(a,o))})).map((function(e){return l(e)})).value();return p}}}function K(t,r){var i=c(t);if(i){var n=f(t,r);if(n&&n.filterMappings&&n.filterMappings.measureFilter&&n.filterMappings.measureFilter.targetRoles){for(var a=n.filterMappings.measureFilter.targetRoles,o=_.chain(n.dataRoles).filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping})).map((function(e){return e.name})).difference(a).value(),s=[],l=0,u=o;l<u.length;l++){var d=u[l];i.projections[d]&&s.push.apply(s,i.projections[d].all())}var h=p(t);return _.isEmpty(s)?void 0:_.chain(h).filter((function(e){return _.some(s,(function(t){return t.queryRef===e.name}))})).map((function(e){return e.expr})).value()}}}var X=jsCommon.ArrayExtensions,J=e.data.ConceptualDataCategory;r.DefaultTitleFontSizeInPixel=12,r.DefaultTitleFontFamily="'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif",r.getVisualType=i,r.getVisualQuery=c,r.getSelectExprs=p,r.getVisualCapabilities=f,r.getDataRolesForVisual=d,r.getDataRolesForVisualPlugin=h,r.getNumberRangesForRoles=m,
r.isScriptVisual=v,r.getObjectDefinitions=g,r.getQueryName=y,r.describeForPinning=b,r.getRolesForDataViewMapping=x,r.toSemanticType=S,r.toConceptualDataCategory=w,r.hasGrouping=E,r.contractEqualityComparator=F,r.contractUnEqualityComparator=P,r.filterAffects=V,r.clearDataSelection=D,r.createCacheEntry=R,r.uniqueName=T,r.nextUniqueName=N,r.notifyVisualContainersExceptSource=M,r.hasOnPremDataSource=I,r.getTitleFontSize=j,r.getTitleHeight=O,r.getVisualStyleAttributes=A,r.getVisualBackgroundRGBColor=k,r.isSegment=z,r.hasGroupByItems=q,r.hasGroupByItemsInQuery=B,r.containSearchableField=U,r.hasFilterMappingWithNonAggregatableColumns=L,r.createRoleKindByQueryRef=Q,r.clearVisualContainerQueryCaches=H,r.getVisualTypesAndCountsFromActiveSection=G,r.getAutoVisualFilterContainers=W})(i=r.VisualContainerUtils||(r.VisualContainerUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=e.data.SQExpr,a=e.data.SQExprConverter,o=jsCommon.StringExtensions,s=e.explore.util.VisualContainerUtils;!(function(r){function i(e,r,i){if(!r||!r.column||!r.column.groupingMetadata)return t.services.GroupMode.None;if(i){var n=i.getGroupingDesignState(e,r.name);if(!n)return t.services.GroupMode.Basic;if(n.partitionTable)return t.services.GroupMode.Clustering;if(n.binItem)return t.services.GroupMode.Binning}return t.services.GroupMode.Basic}function l(e,r,n){var a=i(e,r,n);return a===t.services.GroupMode.Basic||a===t.services.GroupMode.Binning}function u(e,r,n){var a=i(e,r,n);return a===t.services.GroupMode.Clustering}function c(e,t,r){if(!t||!t.column||!t.column.groupingMetadata)return!1;var i=r.getGroupingDesignState(e,t.name);return!(!i||!i.groupItems&&!i.partitionTable)}function p(e,t){if(t&&f(e,t)&&(n.isColumn(t)||n.isGroupRef(t))){var r=t.getConceptualProperty(e);return d(r)}return!1}function f(e,t){return S(e,t).capabilities.canEdit}function d(e){return e&&!!(e.type.dateTime||e.type.integer||e.type.numeric||e.type.text)}function h(e,t){return o.constructNameFromList(e,t.get("GroupDefinition_And"),I)}function m(e){if(e&&e.column&&e.column.keys){var t=e.column.keys;return 1===t.length&&t[0].name!==e.name||t.length>1}return!1}function v(e,t){var r=t&&t.defn.select();if(r&&r.length>0&&e)for(var i=0,n=e;i<n.length;i++){var a=n[i];if(!a||!a.dataMap)return;var o=Object.keys(a.dataMap),s=_.size(o);if(2===s){var l=r.withName(o[0]),u=r.withName(o[1]);if(l&&u)return N(l.expr,u.expr)}}}function g(e,t){_.any(e,(function(e){return e.blankDefaultPlaceholder}))||e.splice(0,0,{name:t.get("NullValue"),blankDefaultPlaceholder:!0})}function y(e){return _.filter(e,(function(e){return!e.blankDefaultPlaceholder}))}function b(t,r,i){var n=[],a=s.getVisualCapabilities(t,r);if(a&&a.grouping)for(var o=s.getVisualQuery(t),l=o.projections,u=s.createRoleKindByQueryRef(o),c=_.filter(a.grouping.groupingRules,(function(e){return e.kind===i})),p=0,f=c;p<f.length;p++){var d=f[p],h=e.DataViewAnalysis.checkForConditionErrors(l,d.condition,u,!1);_.isEmpty(h)&&n.push(d)}return n}function C(t,r,i){var n=a.asFieldPattern(t);if(n.groupingColumn)return _.map(n.groupingColumn.groupedColumns,(function(t){return e.data.SQExprBuilder.fieldExpr(t)}));if(n.column){var o=r.schema(n.column.schema),s=o.findProperty(n.column.entity,n.column.name);if(c(n.column.entity,s,i)){var l=t.getTargetEntity();return x(s.column.groupingMetadata,l)}}}function x(t,r){return _.map(t.groupedColumns,(function(t){if(R(t))return e.data.SQExprBuilder.columnRef(r,t.name)}))}function S(t,r){var i=e.data.FieldExprPattern.getSchema(a.asFieldPattern(r));return t.schema(i)}function w(e,t){var r=t&&t.defn.select();if(!_.isEmpty(r)&&!_.isEmpty(e)){for(var i=0,a=e;i<a.length;i++){var o=a[i];if(!o||!o.dataMap)return!1;var s=Object.keys(o.dataMap),l=_.size(o.dataMap);if(l>2)return!1;if(2===l){var u=r.withName(s[0]),c=r.withName(s[1]);if(u&&c&&!T(u.expr,c.expr))return!1}else if(1===l){var p=r.withName(s[0]);if(p&&!n.isColumn(p.expr)&&!n.isGroupRef(p.expr))return!1}}return!0}return!1}function E(e){return e.dateTime?t.services.GroupDataType.DateTime:e.numeric?t.services.GroupDataType.Number:t.services.GroupDataType.Category}function F(e){switch(e){case 4:return 3;case 6:return 2;case 8:return 0;case 9:return 7;case 10:return 6;case 11:return 5}}function P(e){switch(e){case 3:return 4;case 2:return 6;case 0:return 8;case 7:return 9;case 6:return 10;case 5:return 11}}function V(e){if(!e.get()){var r,i={dbName:"dbName",id:1,vsName:"vsName"},n=[{type:"dsr",id:i.id,name:r,dsr:{schemaName:r,vsName:i.vsName,dbName:i.dbName}}],a=t.contracts.createDataSourceArray(n);e.set(a)}}function D(t,r){var i=r.getDetails(e.common.localize);t.error(i.message,"GroupDialog",{debugErrorInfo:i.debugErrorInfo,displayableErrorInfo:i.displayableErrorInfo,helpLink:i.helpLink})}function R(e){return 0===e.kind}function T(e,t){return!!N(e,t)}function N(e,t){if(n.isGroupRef(e)&&n.isColumn(t)&&M(e,t))return e;if(n.isGroupRef(t)&&n.isColumn(e)&&M(t,e))return t;if(n.isGroupRef(e)&&n.isGroupRef(t)){if(M(e,t))return e;if(M(t,e))return t}}function M(t,r){return e.data.SQExprUtils.sequenceEqual(t.groupedExprs,[r])}var I=50;r.getGroupMode=i,r.isGroupOrBinColumn=l,r.isClusteringColumn=u,r.isGroupOrClusteringColumn=c,r.canExprBeGrouped=p,r.canEditSchema=f,r.canPropertyBeGrouped=d,r.generateGroupDisplayName=h,r.hasGroupOnKeys=m,r.findGroupingColumn=v,r.ensureBlankDefaultPlaceholder=g,r.filterOutBlankDefaultPlaceholder=y,r.getValidGroupingRules=b,r.getGroupedColumns=C,r.getGroupedColumnsFromMetadata=x,r.getConceptualSchema=S,r.canGroup=w,r.getGroupDataType=E,r.convertToTimeUnit=F,r.convertToBinUnit=P,r.ensureDataSources=V,r.showQueryError=D})(i=r.GroupUtils||(r.GroupUtils={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.SQExpr,i=(function(){function e(e){this.key=[],this.value=[],this.comparer=e}return e.prototype.add=function(e,t){this.key.push(e),this.value.push(t)},e.prototype.get=function(e){if(r.isHierarchyLevel(e))for(var t=0;t<this.key.length;t++)if(this.comparer(this.key[t],e))return this.value[t]},e})();t.SQExprToRoleDictionary=i})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getFormatInfo:function(){return r}}}e.createCultureService=t;var r={lcid:1033,displayName:"English (United States)",currencyDecimalDigits:2,numberDecimalDigits:2,percentDecimalDigits:2,percentSymbol:"%",percentPositivePattern:0,percentNegativePattern:0,currencySymbol:"$",currencyPositivePattern:0,currencyNegativePattern:0,shortDatePattern:"M/d/yyyy",longDatePattern:"dddd, MMMM d, yyyy",fullDateTimePattern:"dddd, MMMM d, yyyy h:mm:ss tt",monthDayPattern:"MMMM d",rfc1123Pattern:"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'",sortableDateTimePattern:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",shortTimePattern:"h:mm tt",longTimePattern:"h:mm:ss tt",universalSortableDateTimePattern:"yyyy'-'MM'-'dd HH':'mm':'ss'Z'",yearMonthPattern:"MMMM yyyy"}})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createDataSourcesService=t;var r=(function(){function e(){}return e.prototype.set=function(e){this.dataSources=e},e.prototype.get=function(){return this.dataSources},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createDaxParserService=t;var r=(function(){function e(){}return e.prototype.getMeasureReferences=function(e,t){return _.isArray(t)?_.map(t,(function(e){return{measures:[],unrecognizedReferences:!1}})):[]},e.prototype.renameMeasureReferences=function(e,t,r,i){return _.map(t,(function(e){return e.expression}))},e.prototype.renameMovedMeasureTableReference=function(e,t,r,i,n){return _.map(t,(function(e){return e.expression}))},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new h(e,t,r)}function n(e,t,r,i){if(!r||!r.includeDefaultAggregate)return i.defaultAggregate(e,t,!1)===e.func}function a(e,t,r,i){var n=s(t,r),a=i.aggregateDisplayNames[n];return c.format(a,[e])}function o(e,t,r){if(!_.isEmpty(e)){if(1===e.length)return e[0];var i=e.pop();return d.format(r.stringResourceProvider.get(t),e.length>1?e.join(r.stringResourceProvider.get("ListJoin_Separator")):e[0],i)}return null}function s(t,r){var i=e.data.aggregateFunctionName(t);return(3===t||4===t)&&r&&r.type&&(r.type.dateTime?i="Date"+i:r.type.text&&(i="String"+i)),i}var l=e.data.FieldExprPattern,u=e.data.FilterPattern,c=e.formattingService,p=e.data.SQExpr,f=e.data.SQExprBuilder,d=jsCommon.StringExtensions;r.createDisplayNameService=i;var h=(function(){function r(e,t,r){this.locOptions=e,this.aggrOps=t,this.featureSwitches=r}return r.prototype.getOriginalDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t))return l.visit(t,new m(r,this.locOptions,this.aggrOps,i,n))},r.prototype.getDisplayName=function(e,t,r,i,n,a){if(this.featureSwitches.featureSwitches.fieldAlias&&n&&i){var o=n[i];if(o&&o.displayName)return o.displayName}return this.getOriginalDisplayName(e,t,r,a)},r.prototype.getQualifiedDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t))return v.run(t,r,this.locOptions,this.aggrOps,i,n)},r.prototype.getFilterRestatement=function(t,r,i,n){if(e.data.SQFilterConverter.asFieldPattern(t))return u.visit(t,new g(r,this.locOptions,this.aggrOps,i,n))},r.prototype.getQualifiedFilterRestatement=function(t,r,i,n){if(e.data.SQFilterConverter.asFieldPattern(t))return u.visit(t,new g(r,this.locOptions,this.aggrOps,i,n,(!0)))},r.prototype.getVisualTitle=function(r,i,n){var a=r.title;if(a){if(t.contracts.VisualTitle.isHidden(a))return a;if(null==a.show&&(a.show=!(!n||n.suppressDefaultTitle)),void 0!==a.text)return a}var s=[],l=[],u=[];if(r&&r.query){var c=r.query,p=c.projections;if(p&&n&&!n.suppressDefaultTitle&&n.dataRoles)for(var f=c.defn.select(),h=0,m=n.dataRoles;h<m.length;h++){var v=m[h],g=this.getDisplayNamesByDataRole(p[v.name],f,i,n,r.columnProperties);if(g)switch(v.kind){case e.VisualDataRoleKind.Grouping:l=l.concat(g);break;case e.VisualDataRoleKind.Measure:s=s.concat(g);break;case e.VisualDataRoleKind.GroupingOrMeasure:u=u.concat(g)}}}var y=e.Prototype.inherit(a||{show:!n.suppressDefaultTitle});y.titleComponents={};var b,C="VisualTitle_And_Template";return s.length>0?(y.titleComponents.title=o(s,C,this.locOptions),l.length>0&&(b=o(l,C,this.locOptions),y.titleComponents.subtitle=d.format(this.locOptions.stringResourceProvider.get("VisualTitle_By_Template"),"",b).trim())):u.length>0?y.titleComponents.title=o(s,C,this.locOptions):l.length>0&&(y.titleComponents.title=o(l,C,this.locOptions)),b?y.text=d.format(this.locOptions.stringResourceProvider.get("VisualTitle_By_Template"),y.titleComponents.title,b):y.text=y.titleComponents.title,y},r.prototype.getDisplayNamesByDataRole=function(e,t,r,i,n){var a=[];if(e)if(_.isEmpty(e.activeProjectionRefs))for(var o=0,s=e.all();o<s.length;o++){var l=s[o],u=t.withName(l.queryRef),c=this.getDisplayName(u.expr,r,i,l.queryRef,n);a.push(c)}else for(var p=0,f=e.activeProjectionRefs;p<f.length;p++){var d=f[p],u=t.withName(d);u&&u.expr&&a.push(this.getDisplayName(u.expr,r,i,d,n))}return a},r})(),m=(function(){function t(e,t,r,i,n){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.displayOptions=n}return t.prototype.visitColumn=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitColumnAggr=function(e){return t.getDisplayNameForSQAggregate(e,f.fromColumnAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitGroupingColumn=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitGroupingColumnAggr=function(e){return t.getDisplayNameForSQAggregate(e,f.fromGroupingColumnAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitColumnHierarchyLevelVariation=function(e){return t.getVariationLevelName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitEntity=function(e){return t.getDisplayNameForEntity(e,this.schema)},t.prototype.visitEntityAggr=function(e){return t.getDisplayNameForSQAggregate(e,f.fromEntityAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitHierarchy=function(e){return t.getDisplayNameForHierarchy(e,this.schema)},t.prototype.visitHierarchyLevel=function(e){return t.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider)},t.prototype.visitHierarchyLevelAggr=function(e){return t.getDisplayNameForSQAggregate(e,f.fromHierarchyLevelAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions)},t.prototype.visitMeasure=function(e){return t.getDisplayNameForProperty(e,this.schema)},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){var t=this.locOptions.showValueAsDisplayNames;return c.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[l.visit(e.arg,this),e.k])},t.prototype.visitPercentOfGrandTotal=function(e){return c.format(this.locOptions.showValueAsDisplayNames.PercentOfGrandTotal,[l.visit(e.baseExpr,this)])},t.prototype.visitPercentOfRoleTotal=function(t){var r=this.visualCapabilities.dataRoleTotals,i=_.find(r,(function(e){return _.isEqual(t.roles,e.roles)})),n=e.data.getDisplayName(i.shortDisplayName,this.locOptions.stringResourceProvider);return c.format(n,[l.visit(t.baseExpr,this)])},t.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},t.prototype.visitFilteredEval=function(e){for(var t=this.locOptions.stringResourceProvider.get("VisualTitle_For_Template"),r=l.visit(e.baseExpr,this),i=[],n=new g(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.displayOptions),a=0,s=e.filters;a<s.length;a++){var p=s[a],f=u.visit(p,n);f&&i.push(f)}if(!_.isEmpty(i)){var d=o(i,"FilterRestatement_CompoundAnd",this.locOptions);return c.format(t,[r,d])}},t.getDisplayNameForEntity=function(e,t){var r=t.schema(e.schema).entities.withName(e.entity);if(r)return r.displayName},t.getDisplayNameForProperty=function(e,t){var r=t.schema(e.schema),i=r.findProperty(e.entity,e.name);if(i)return i.displayName},t.getDisplayNameForHierarchyLevel=function(e,t,r,i){var n=t.schema(e.schema),a=n.findHierarchy(e.entity,e.name);if(a){var o=a.levels.withName(e.level);if(o){var s=o.displayName||o.column.displayName;if(r&&r.includeHierarchyName&&i){var l=a.displayName;s=d.format(i.get("IncludeVariationSourceDisplayName"),l,s)}return s}}},t.getDisplayNameForHierarchy=function(e,t){var r=t.schema(e.schema),i=r.findHierarchy(e.entity,e.name);if(i)return i.displayName},t.getVariationLevelName=function(e,t,r,i){var n=t.schema(e.source.schema).findProperty(e.source.entity,e.source.name);if(n)for(var a=n.column.variations,o=0,s=a;o<s.length;o++){var l=s[o];if(l.name===e.variationName)for(var u=0,c=l.defaultHierarchy.levels;u<c.length;u++){var p=c[u];if(p.name===e.level.level){var f=p.column.displayName;return r&&r.includeVariationSource&&i?d.format(i.get("IncludeVariationSourceDisplayName"),n.displayName,f):f}}}},t.getDisplayNameForSQAggregate=function(e,r,i,o,s,u,c){var p=i.schema(e.schema).entities.withName(e.entity);if(p){var f=l.visit(r.arg,new t(i,o,u,s,c));return f?n(r,i,c,u)?f:a(f,r.func,r.arg.getMetadata(i),o):a(p.displayName,r.func,r.arg.getMetadata(i),o)}},t})(),v=(function(){function t(e,t,r,i,n){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.displayOptions=n}return t.run=function(e,r,i,n,a,o){var s=new t(r,i,n,a,o);return s.accept(e)},t.prototype.accept=function(e){var t=e;if(p.isAggregation(t)){var r=l.visit(t.arg,this);return n(t,this.schema,this.displayOptions,this.aggrOps)?r:a(r,t.func,t.arg.getMetadata(this.schema),this.locOptions)}return l.visit(e,this)},t.prototype.visitEntity=function(e){var t=m.getDisplayNameForEntity(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitColumn=function(e){var t=m.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitColumnAggr=function(e){},t.prototype.visitGroupingColumn=function(e){var t=m.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitGroupingColumnAggr=function(e){},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=m.getVariationLevelName(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e.source)},t.prototype.visitEntityAggr=function(e){var t=m.getDisplayNameForSQAggregate(e,f.fromEntityAggr(e),this.schema,this.locOptions,this.visualCapabilities,this.aggrOps,this.displayOptions);return this.formatWithEntity(t,e)},t.prototype.visitHierarchy=function(e){var t=m.getDisplayNameForHierarchy(e,this.schema);return this.formatWithEntity(t,e)},t.prototype.visitHierarchyLevel=function(e){var t=m.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions,this.locOptions.stringResourceProvider);return this.formatWithEntity(t,e)},t.prototype.visitHierarchyLevelAggr=function(e){},t.prototype.visitMeasure=function(e){var t=this.locOptions.qualifiedDisplayNameTemplate,r=m.getDisplayNameForProperty(e,this.schema),i=m.getDisplayNameForEntity(e,this.schema);return i?d.format(t,i,r):r},t.prototype.visitSelectRef=function(e){},t.prototype.visitPercentile=function(e){var t=this.locOptions.showValueAsDisplayNames;return c.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[this.accept(f.fieldExpr(e.arg)),e.k])},t.prototype.visitPercentOfGrandTotal=function(e){return c.format(this.locOptions.showValueAsDisplayNames.PercentOfGrandTotalTooltip,[this.accept(f.fieldExpr(e.baseExpr))])},t.prototype.visitPercentOfRoleTotal=function(t){var r=this.visualCapabilities.dataRoleTotals,i=_.find(r,(function(e){return _.isEqual(t.roles,e.roles)})),n=e.data.getDisplayName(i.tooltip,this.locOptions.stringResourceProvider);return c.format(n,[this.accept(f.fieldExpr(t.baseExpr))])},t.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},t.prototype.visitFilteredEval=function(e){for(var t=this.locOptions.stringResourceProvider.get("VisualTitle_For_Template"),r=this.accept(f.fieldExpr(e.baseExpr)),i=[],n=new g(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.displayOptions,(!0)),a=0,s=e.filters;a<s.length;a++){var l=s[a],p=u.visit(l,n);p&&i.push(p)}if(!_.isEmpty(i)){var d=o(i,"FilterRestatement_CompoundAnd",this.locOptions);return c.format(t,[r,d])}},t.prototype.formatWithEntity=function(e,t){var r=this.locOptions.qualifiedDisplayNameTemplate,i=m.getDisplayNameForEntity(t,this.schema);return i?d.format(r,i,e):e},t})(),g=(function(){function t(e,t,r,i,n,a){this.schema=e,this.locOptions=t,this.aggrOps=r,this.visualCapabilities=i,this.displayOptions=n,this.isQualified=a,this.displayNameServiceVisitor=this.isQualified?new v(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.displayOptions):new m(this.schema,this.locOptions,this.aggrOps,this.visualCapabilities,this.displayOptions)}return t.prototype.visitIn=function(t){var r=this,i=t.args,n=t.values,a=_.map(n,(function(t){return _.map(t,(function(t,n){var a=f.fieldExpr(i[n]),o=a&&a.getMetadata(r.schema);return e.visuals.valueFormatter.format(t.value,o&&o.format)})).join(" ")})),s=o(a,"FilterRestatement_CompoundOr",this.locOptions);if(this.displayOptions&&this.displayOptions.includeFieldNamesInFilter){var u=t.args,c=_.map(u,(function(e){return l.visit(e,r.displayNameServiceVisitor)})).join(" ");return d.format(this.locOptions.stringResourceProvider.get("VisualTitle_Is_Template"),c,s)}return s},t})();r.getAggregateKey=s})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.common.EventChannelType;!(function(e){e[e.Unknown=0]="Unknown",e[e.Swipe=1]="Swipe"})(r=t.SectionNavigationAction||(t.SectionNavigationAction={}));var n;!(function(e){e.explorationLoaded={type:i.Section,name:"explorationLoaded"},e.explorationUnloaded={type:i.Section,name:"explorationUnloaded"},e.filterContainerChanged={type:i.Visual,name:"filterContainerChanged"},e.explorationFiltersContainerChanged={type:i.Section,name:"explorationFiltersContainerChanged"},e.sectionFiltersContainerChanged={type:i.Section,name:"sectionFiltersContainerChanged"},e.formFactorChanged={type:i.Section,name:"formFactorChanged"},e.modelChanged={type:i.Data,name:"modelChanged"},e.enableEditing={type:i.Section,name:"enableEditing"},e.visualRelationshipsModeChanged={type:i.Visual,name:"visualRelationshipsModeChanged"},e.schemaItemActivationChanged={type:i.Data,name:"schemaItemActivationChanged"},e.selectionChanged={type:i.Visual,name:"selectionChanged"},e.dataPointsSelected={type:i.Visual,name:"dataPointsSelected"},e.undoRedoStackUpdated={type:i.Section,name:"undoRedoStackUpdated"},e.undoRedoStackCleared={type:i.Section,name:"undoRedoStackCleared"},e.clipboardDataUpdated={type:i.Section,name:"clipboardDataUpdated"},e.dataSelectionChanged={type:i.Visual,name:"dataSelectionChanged"},e.drillModeChanged={type:i.Visual,name:"drillModeChanged"},e.refreshExploration={type:i.Visual,name:"refreshExploration"},e.clearAnnotations={type:i.Visual,name:"clearAnnotations"},e.saveReportCompleted={type:i.Data,name:"saveReportCompleted"},e.customSaveAsTriggered={type:i.Data,name:"customSaveAsTriggered"},e.sectionLayoutRemoved={type:i.Section,name:"sectionLayoutRemoved"},e.canvasChanged={type:i.Section,name:"canvasChanged"},e.visualContainerChanged={type:i.Visual,name:"visualContainerChanged"},e.visualContainerDataRendered={type:i.Visual,name:"visualContainerDataRendered"},e.visualContainerPositionChanged={type:i.Visual,name:"visualContainerPositionChanged"},e.visualConversion={type:i.Visual,name:"visualConversion"},e.canvasSizeChangedEvent={type:i.Visual,name:"canvasSizeChanged"},e.visualPluginsChanged={type:i.Visual,name:"visualPluginsChanged"},e.addCustomVisual={type:i.Visual,name:"addCustomVisual"},e.deleteCustomVisual={type:i.Visual,name:"deleteCustomVisual"},e.modelingContextChanged={type:i.Data,name:"modelingContextChanged"},e.changeViewMode={type:i.Visual,name:"changeViewMode"},e.requestViewModeChange={type:i.Visual,name:"requestViewModeChange"},e.changeEditMode={type:i.Visual,name:"changeEditMode"},e.saveKeyPressedEvent={type:i.Section,name:"saveEventViaCtrlS"},e.canvasDisplayChanged={type:i.Section,name:"canvasDisplayChanged"},e.canvasDimensionChanged={type:i.Section,name:"canvasDimensionChanged"},e.canvasBackgroundChanged={type:i.Section,name:"canvasBackgroundChanged"},e.visibilityChanged={type:i.Visual,name:"visibilityChanged"},e.align={type:i.Section,name:"align"},e.deleteSectionInitiated={type:i.Section,name:"deleteSectionInitiated"},e.sectionNameChanged={type:i.Section,name:"sectionNameChanged"},e.renameSection={type:i.Section,name:"renameSection"},e.sectionChanged={type:i.Section,name:"sectionChanged"},e.podParameterChanged={type:i.Section,name:"podParameterChanged"},e.missingTableRelationship={type:i.Visual,name:"missingTableRelationship"},e.addVisualContainer={type:i.Section,name:"addVisualContainer"},e.deleteVisualContainer={type:i.Visual,name:"deleteVisualContainer"},e.addInsightContainer={type:i.Section,name:"addInsightContainer"},e.changeFormFactor={name:"changeFormFactor",type:i.Section},e.arrangeVisualsOrder={type:i.Section,name:"arrangeVisualsOrder"},e.createImage={type:i.Section,name:"createImage"},e.createBasicShape={type:i.Section,name:"createBasicShape"},e.createTextbox={type:i.Section,name:"createTextbox"},e.importVisual={type:i.Section,name:"importVisual"},e.installVisual={type:i.Section,name:"installVisual"},e.downloadVisual={type:i.Section,name:"downloadVisual"},e.visualContainerQueryBlocked={type:i.Visual,name:"visualContainerQueryBlocked"},e.newQueryCacheResultAvailable={type:i.Visual,name:"newQueryCacheResultAvailable"},e.exportVisualData={type:i.Visual,name:"exportVisualData"},e.reportSlidesChanged={type:i.Section,name:"reportSlidesChanged"},e.createSection={type:i.Section,name:"createSection"},e.deleteSection={type:i.Section,name:"deleteSection"},e.duplicateSection={type:i.Section,name:"duplicateSection"},e.copyTable={type:i.Section,name:"copyDataTable"},e.showEnableScriptVisualsDialog={type:i.Visual,name:"showEnableScriptVisualsDialog"},e.reportVisualError={name:"ReportVisualError"},e.removeVisualContainerFromLayout={name:"removeVisualContainerFromLayout"},e.toggleSortVisualContainer={name:"toggleSortVisualContainer"},e.filterValueChanged={name:"filterValueChanged"},e.reorderSection={name:"reorderSection"},e.saveAsExploration={name:"saveAsExploration"},e.generateReportQR={name:"generateReportQR"},e.saveExploration={name:"saveExploration"},e.switchSection={name:"switchSection"},e.pauseQueriesChanged={name:"pauseQueriesChanged"},e.redo={name:"redo"},e.undo={name:"undo"},e.deleteVisual={name:"deleteVisual"},e.deleteCustomVisuals={name:"deleteCustomVisuals"},e.exportToPowerPoint={name:"exportToPowerPoint"},e.exportAsImage={name:"exportAsImage"},e.getClusters={name:"getClusters"}})(n=t.events||(t.events={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,r,i,n,a,o,s,l,u,c){var p=t.services.createVisualAuthoringCore(e,o,a,s);return new g(p,e,r,i,n,l,u,c,s)}var n=e.data.CsvWriter,a=e.data.DataShapeBindingDataReduction,o=t.contracts.DataSource,s=e.data.DataViewTransform,l=e.data.dsr,u=t.QueryProjectionBuilderCoreUtils.QueryProjectionBuilder,c=e.data.services.SemanticQuerySerializer,p=jsCommon.StringExtensions,f=e.data.SQExpr,d=e.data.SQExprRewriter,h=e.data.SQScopedEvalExpr;r.createExportVisualDataService=i;var m=1e6,v="data",g=(function(){function r(e,t,r,i,n,a,o,s,l){this.visualPluginService=t,this.visualAuthoring=e,this.visualQueryGenerator=r,this.dataProxy=i,this.conceptualSchemaProxy=n,this.promiseFactory=a,this.displayNameService=o,this.localizationService=s,this.featureSwitchService=l}return r.prototype.exportToCsv=function(e,t,r,i,n,a){var o=this,s=this.promiseFactory.defer();if(null!=r&&null!=n){var l=this.exportDataViewSourceToCSV(t,n,!1,e,this.featureSwitchService.featureSwitches.cellLevelFormatting);if(null!=l)return s.resolve(l),s.promise}return this.conceptualSchemaProxy.get(r).then((function(t){var n=o.getGeneratedQuery(t,i,r,a);if(!n||!n.result||n.result.error)return void s.resolve({blob:null,error:0});var l=n.result;o.overrideDataQueryLimit(l.options.query.command);var u=l.transforms,c=function(t){return o.exportDataViewSourceToCSV(t,u,!0,e,o.featureSwitchService.featureSwitches.cellLevelFormatting)};o.queryData(l.options,c).then((function(e){s.resolve(e)}),(function(e){s.reject(e)}))}),(function(){s.reject({blob:null,error:3})})),s.promise},r.prototype.exportToExcel=function(t,i,n,a,s){var u=this,c=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(p){var f=u.getGeneratedQuery(p,n,i,a);if(f&&f.result&&!f.result.error){var d=f.result,h=d.options.query.command,m=u.generateExportDataCommand(p,h.Commands[0].SemanticQueryDataShapeCommand.Query,s,n,d.transforms,f.selectsWithDisplayName);h.Commands.push(m),u.overrideDataQueryLimit(h),u.clearDataQuerySubtotal(h);var v=e.common.httpService.powerbiRequestOptions();v.responseType="blob";var g=l.generateSemanticQueryRequest([h],o.referenced(i,n.query&&n.query.defn));e.common.httpService.post("/export/xlsx",g,v).then((function(e){if(0===e.data.size)return void c.reject({blob:null,error:1});var i={blob:e.data,isPartialResult:!1,format:1,fileName:r.getFileName(t,1)};c.resolve(i)}),(function(e){c.reject({blob:null,error:2})}))}else c.reject({blob:null,error:0})}),(function(){c.reject({blob:null,error:3})})),c.promise},r.prototype.getGeneratedQuery=function(r,i,n,a){var o=t.contracts.SingleVisualConfig.clone(i),s=this.getPercentRoleSelectIndexToDisplayNameMapping(o,r);this.rewritePercentRoleRefs(o,r,a);var l=this.mapSelectIndexWithExprs(o,s);this.clearConversionContextWithPercentRole(o);var u=this.visualPluginService.getPlugin(e.visuals.plugins.table.name);if(i.visualType!==u.name){var c=this.visualAuthoring.convert({schema:r,source:o,target:u.name});if(!c)return}for(var p=o.query,d=p.projections,h=function(e){var t=_.find(p.defn.select(),(function(t){return f.equals(t.expr,e.expr)})),r=v.getQueryProjectionForSelect(t,d);r&&(r.displayName=e.name)},v=this,g=0,y=l;g<y.length;g++){var b=y[g];h(b)}var C=this.visualPluginService.capabilities(e.visuals.plugins.table.name),x=_.cloneDeep(C.dataViewMappings);return x[0].table.rows.dataReductionAlgorithm={top:{count:m}},this.clearVisualConfigObjects(o),{result:this.visualQueryGenerator.execute({dataSources:n,config:o,schema:r,additionalFilters:a,dataViewMappingsOverride:x}),selectsWithDisplayName:l}},r.prototype.queryData=function(e,t){var r=this.promiseFactory.defer();return this.dataProxy.execute(e).then((function(e){var i=t(e.dataViewSource);null!=i?r.resolve(i):r.reject({blob:null,error:1})}),(function(){r.reject({blob:null,error:2})})),r.promise},r.prototype.exportDataViewSourceToCSV=function(t,i,a,o,l){var u=r.readDataViewSource(t,l);if(u){var c=u.dataView,p=c&&c.table;if(p&&p.columns.length===i.selects.length){var f=r.isPartialResult(u);if(!f||a){var d=this.visualPluginService.capabilities(e.visuals.plugins.table.name),h=s.apply({transforms:i,dataRoles:d.dataRoles,objectDescriptors:d.objects,prototype:c,colorAllocatorFactory:e.visuals.createColorAllocatorFactory(),dataViewMappings:d.dataViewMappings});if(!_.isEmpty(h))return{isPartialResult:f,blob:n.fromDataView(h[0]),format:0,fileName:r.getFileName(o,0)}}}}},r.readDataViewSource=function(e,t){var r;try{r=l.read(31,e.data,t,"csv")}catch(e){return}return r},r.isPartialResult=function(t){if(!t)return!1;var r=_.some(t.warnings,(function(t){return t instanceof e.data.dsr.DsrLimitsWarning}));return!!t.restartToken||r},r.getFileName=function(e,t){var r=v;if(!_.isEmpty(e)){var i=p.normalizeFileName(e);_.isEmpty(i)||(r=i)}switch(t){case 0:return r+".csv";case 1:return r+".xlsx"}},r.prototype.generateExportDataCommand=function(e,t,r,i,n,a){var o=this,s=c.deserializeQuery(t),l={includeVariationSource:!0,includeDefaultAggregate:!0,includeHierarchyName:!0},u=this.visualPluginService.capabilities(i.visualType),p=_.map(s.select(),(function(t){var r=_.find(a,(function(e){return f.equals(t.expr,e.expr)}));return{queryName:t.name,displayName:r?r.name:o.displayNameService.getDisplayName(t.expr,e,u,t.name,i.columnProperties,l),qualifiedDisplayName:r?r.name:o.displayNameService.getQualifiedDisplayName(t.expr,e,u,l)}}));this.ensureUniqueName(p,r);var d={ExportDataCommand:{Columns:_.map(p,(function(e){return{QueryName:e.queryName,Name:e.useQualified?e.qualifiedDisplayName:e.displayName}})),Ordering:this.getTableOrderingFromTransforms(n)||this.getDefaultTableOrdering(s.select().length),FiltersDescription:this.generateFiltersDescriptionString(r)}};return d},r.prototype.getTableOrderingFromTransforms=function(e){if(e.roles&&e.roles.ordering)return e.roles.ordering[u.ValuesRoleName]},r.prototype.getDefaultTableOrdering=function(e){return _.range(e)},r.prototype.ensureUniqueName=function(e,t){for(var r={},i={},n=t.filtersNamesAndRestatements||[],a=e.concat(n),o=0,s=a;o<s.length;o++){var l=s[o],u=l.displayName.toLowerCase(),c=l.qualifiedDisplayName.toLowerCase();u in r&&r[u]!==c&&(i[u]=!0),r[u]=c}for(var p=0,f=e;p<f.length;p++){var d=f[p];d.useQualified=i[d.displayName.toLowerCase()]}for(var h=0,m=n;h<m.length;h++){var v=m[h];v.useQualified=i[v.displayName.toLowerCase()]}},r.prototype.generateFiltersDescriptionString=function(e){if(null==e.filtersNamesAndRestatements)return"";
if(0===e.filtersNamesAndRestatements.length)return this.localizationService.get("ExportData_NoAppliedFiltersText");for(var t="",r=0,i=e.filtersNamesAndRestatements;r<i.length;r++){var n=i[r];t=t.concat(this.localizationService.format("ExportData_SingleFilterText",["\n",n.useQualified?n.qualifiedDisplayName:n.displayName,n.restatement]))}return this.localizationService.format("ExportData_AppliedFiltersText",[t])},r.prototype.overrideDataQueryLimit=function(e){e.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction={Primary:a.createFrom({top:{count:m}},void 0)}},r.prototype.clearDataQuerySubtotal=function(e){for(var t=0,r=e.Commands[0].SemanticQueryDataShapeCommand.Binding.Primary.Groupings;t<r.length;t++){var i=r[t];null!=i.Subtotal&&(i.Subtotal=0)}},r.prototype.clearVisualConfigObjects=function(e){e.objects=void 0},r.prototype.getPercentRoleSelectIndexToDisplayNameMapping=function(t,r){for(var i=this.visualPluginService.capabilities(t.visualType),n=t.query,a=n.defn.select(),o=[],s=0;s<a.length;s++){var l=a[s];if(e.data.FieldExprPattern.isPercentRoleTotalExpr(l.expr)){var u=this.displayNameService.getDisplayName(l.expr,r,i,l.name,t.columnProperties);o.push({selectIndex:s,displayName:u})}}return o},r.prototype.rewritePercentRoleRefs=function(e,t,r){var i=e.query,n=i.defn.select(),a=i.projections,o=new y(n,a);i.defn=i.defn.rewrite(o),r&&r.dataFilter&&(r.dataFilter=r.dataFilter.rewrite(o))},r.prototype.mapSelectIndexWithExprs=function(e,t){for(var r=e.query.defn.select(),i=[],n=0,a=t;n<a.length;n++){var o=a[n];i.push({expr:r[o.selectIndex].expr,name:o.displayName})}return i},r.prototype.clearConversionContextWithPercentRole=function(t){if(t.conversionSourceContext&&t.conversionSourceContext.query)for(var r=t.conversionSourceContext.query,i=r.defn.select(),n=0,a=i;n<a.length;n++){var o=a[n];if(e.data.FieldExprPattern.isPercentRoleTotalExpr(o.expr)){t.conversionSourceContext=void 0;break}}},r.prototype.getQueryProjectionForSelect=function(e,t){for(var r in t){var i=t[r].all(),n=_.find(i,(function(t){return t.queryRef===e.name}));if(n)return n}},r})();r.ExportVisualDataService=g;var y=(function(e){function t(t,r){var i=e.call(this)||this;return i.selects=t,i.projections=r,i}return __extends(t,e),t.prototype.visitScopedEval=function(e){for(var t=this,r=[],i=!1,n=0,a=e.scope;n<a.length;n++){var o=a[n];if(f.isRoleRef(o)){i=!0;var s=this.projections[o.role];if(s){var l=s.all();r.push.apply(r,_.map(l,(function(e){return t.selects.withName(e.queryRef).expr})))}}else r.push(o)}return i?new h(e.expression,r):e},t})(d)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e){return new i(e)}t.createFederatedSchemaValidator=r;var i=(function(){function t(e){this.localization=e}return t.prototype.validate=function(t){if(t)for(var r=e.util.createNameValidator(t,this.localization),i=0,n=t.schemas;i<n.length;i++){var a=n[i];if(a.isExtensionSchema)for(var o=t.schema(a.extends),s=0,l=a.entities;s<l.length;s++){var u=l[s],c=!1,p=o.entities.withName(u.name);if(!p){c=!0,u.errorMessage=this.localization.get("ReportMeasuresMissingTableErrorMessage"),u.queryable=1;var f=u;f.isAbandoned=!0}for(var d=0,h=u.properties;d<h.length;d++){var m=h[d];if(1===m.kind){var v=r.validateExistingMeasureName(m);v.error===e.util.NameValidationError.DuplicatedName?(m.errorMessage=v.reason,m.queryable=1):c&&(m.errorMessage=this.localization.get("ReportMeasuresMissingTableMeasureErrorMessage"),m.queryable=1)}}}}},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a,o){return new v(e,t,r,i,n,a,o)}var n=e.data.DataViewObjectDefinitions,a=e.data.DataViewObjectDescriptors,o=e.data.FilterKindDetector,s=e.visuals.plugins,l=e.explore.util.ScriptVisualsUtil,u=e.data.Selector,c=e.data.SemanticFilter,p=e.data.services.SemanticQuerySerializer,f=e.data.SQExprUtils,d=e.data.SubqueryRewriter,h=e.data.TopNFilterPruner,m=e.explore.util.VisualContainerUtils;r.createFilterGenerator=i;var v=(function(){function i(e,t,r,i,n,a,o){this.eventBridge=e,this.visualPlugins=t,this.aggrOps=r,this.relationshipService=i,this.hostFilters=n,this.telemetryService=a,this.scriptVisuals=o}return i.prototype.collectVisualContainerFilters=function(e,t,r){var i=new g;i.collectFilters(r.filters,r),t&&i.collectFilters(t.filters),this.collectSelfFilter(i,r),e&&i.collectFilters(e.filters);var n=this.hostFilters.getSelectedHostFilters();return n&&i.collectFilters(n.filters),t&&this.collectCrossFilter(i,t,r),i.getCollectedFilters()},i.prototype.addVisualContainerFilters=function(e,t,r,i,n){e.addCollectedFilters(this.collectVisualContainerFilters(t,r,i),!0,this.getShouldApplyFilter(i,n,r)),r&&this.addHighlightFilter(e,r,i,n)},i.prototype.calculateVisualContainerFilter=function(e,r,i,n){var a=new y(i);return this.addVisualContainerFilters(a,e,r,i,n),{dataFilter:a.getMergedDataFilter(),highlightFilter:a.getHighlightFilter(),filterMetadata:a.getMetadata(),queryRefsForSingleItemDrillFilters:t.FilterUtils.getQueryRefsForSingleItemDrillFilters(i,n,this.aggrOps)}},i.prototype.calculateDetailVisualFilter=function(e,r,i,n,a){var o=new y(i);return this.addVisualContainerFilters(o,e,r,i,n),0===a&&(a=1),o.mergeHighlightFilterBasedOnRelationship(a),{dataFilter:o.getMergedDataFilter(),highlightFilter:o.getHighlightFilter(),filterMetadata:o.getMetadata(),queryRefsForSingleItemDrillFilters:t.FilterUtils.getQueryRefsForSingleItemDrillFilters(i,n,this.aggrOps)}},i.prototype.clearCrossHighlight=function(e){e.crossHighlight&&this.setCrossHighlight(null,null,e)},i.prototype.clearVisualContainerCrossHighlight=function(e,t){e.crossHighlight&&e.crossHighlight.sourceVisualContainer===t&&this.setCrossHighlight(null,null,e)},i.prototype.calculateFilterContainerInputFilter=function(e,t,r,i,n){if(r&&t&&n){var a;0===n.scopeType&&(a=n.container);var o=new g;if(e&&o.collectFilters(e.filters),1===n.scopeType){var s=5===r.howCreated?_.filter(t.filters,(function(e){return 5===e.howCreated})):t.filters;o.collectFilters(s)}else 2!==n.scopeType&&o.collectFilters(t.filters);a&&(o.collectFilters(a.filters,a),this.collectCrossFilter(o,t,a));var l=new y(a);return l.addCollectedFilters(o.getCollectedFilters(),!1,this.getShouldApplyFilterContainerInputFilter(r,a,i,t)),l.getMergedDataFilter()}},i.prototype.mergeFiltersBasedOnRelationship=function(e,t,r,i){var n=new y(null);return e&&n.addVisualFilter(e),t&&n.addCrossFilter(t),r&&n.setHighlight(r),n.mergeHighlightFilterBasedOnRelationship(i),{dataFilter:n.getMergedDataFilter(),highlightFilter:n.getHighlightFilter()}},i.prototype.getVisualContainerCrossFilters=function(e,t,r){var i=new g;this.collectCrossFilter(i,e,t);var n=new y(t);return n.addCollectedFilters(i.getCollectedFilters(),!1,this.getShouldApplyFilter(t,r,e)),this.addHighlightFilter(n,e,t,r),{dataFilters:n.getCrossFilters(),highlightFilter:n.getHighlightFilter()}},i.prototype.logRFilterTelemetry=function(e,t,r){var i=l.getScriptVisualIdsInSection(t,this.scriptVisuals);_.isEmpty(i)||this.telemetryService.logEvent(e,r,JSON.stringify(i))},i.prototype.setCrossHighlight=function(t,r,i,n){var a=i.crossHighlight;n?(i.crossHighlight={sourceVisualContainer:n,selection:r,selectorFilter:u.filterFromSelector(r),collectedFilters:_.isEmpty(r)?[]:this.collectVisualContainerFilters(t,i,n)},this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,i,e.telemetry.CrossFilterType.Highlight)):i.crossHighlight=void 0,a!==i.crossHighlight&&(null!=a&&a.sourceVisualContainer!==n&&(m.clearDataSelection(this.eventBridge,a.sourceVisualContainer),n=null),m.notifyVisualContainersExceptSource(this.eventBridge,n))},i.prototype.collectSelfFilter=function(e,t){var r=m.getVisualCapabilities(t,this.visualPlugins),i=this.tryGetSelfFilterProperty(r);if(i){var a=t.config.singleVisual.objects;if(a){var o=n.getValue(a,i,null);o&&e.collectFilter(o,null,t)}}},i.prototype.collectCrossFilter=function(t,r,i){for(var n=0,a=r.visualContainers;n<a.length;n++){var o=a[n];if(o!==i){var s=m.getVisualCapabilities(o,this.visualPlugins),l=this.tryGetFilterPropertyIdentifier(s);if(l){var u=m.getObjectDefinitions(o);if(u){var c=e.data.DataViewObjectDefinitions.getValue(u,l,null);c&&t.collectFilter(c,null,o)}}}}},i.prototype.addHighlightFilter=function(e,t,r,i){if(t.crossHighlight&&t.crossHighlight.sourceVisualContainer!==r&&m.getVisualType(r)!==s.slicer.name){var n=this.buildHighlightFilter(t.crossHighlight,i,t);if(n){e.setHighlight(n);var a=this.relationshipService.relationshipFilterAction(t,t.crossHighlight.sourceVisualContainer,r,i),o=m.getVisualCapabilities(r,this.visualPlugins);e.mergeHighlightFilterBasedOnRelationship(a,!o.supportsHighlight)}}},i.prototype.buildHighlightFilter=function(e,t,r){var i=new y(e.sourceVisualContainer);return e.selectorFilter&&i.setSelectorFilter(e.selectorFilter),i.addCollectedFilters(e.collectedFilters,!1,this.getShouldApplyHighlightFilter(e.sourceVisualContainer,t,r)),i.getMergedHighlightFilter()},i.prototype.getShouldApplyFilterContainerInputFilter=function(e,t,r,i){var n=this;return function(a,o,s){return n.shouldApplyFilterContainerInputFilter(a,o,s,e,t,r,i)}},i.prototype.shouldApplyFilterContainerInputFilter=function(t,r,i,n,a,o,s){if(r===n)return!1;if(!this.shouldApplyFilter(t,r,i,a,o,s))return!1;var l=r&&r.expression;return(!l||!f.isMeasure(l))&&!e.data.TopNFilterPattern.extractParametersFromFilter(t)},i.prototype.getShouldApplyHighlightFilter=function(e,t,r){var i=this;return function(n,a,o){return i.shouldApplyHighlightFilter(n,a,o,e,t,r)}},i.prototype.shouldApplyHighlightFilter=function(e,t,r,i,n,a){return!!this.shouldApplyFilter(e,t,r,i,n,a)&&!_.any(e.conditions(),(function(e){return 1===o.run(e)}))},i.prototype.getShouldApplyFilter=function(e,t,r){var i=this;return function(n,a,o){return i.shouldApplyFilter(n,a,o,e,t,r)}},i.prototype.shouldApplyFilter=function(e,r,i,n,a,o){if(r&&t.FilterUtils.shouldDisableFilter(r,a,i,this.aggrOps,this.visualPlugins))return!1;if(!(_.isEmpty(e.validate(a,this.aggrOps))||i&&i===n))return!1;if(i&&n&&i!==n){var s=this.relationshipService.relationshipFilterAction(o,i,n,a);if(3===s)return!1}return!0},i.prototype.generateFilterMetadata=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a={Restatement:n.restatement,type:n.type};n.expression&&(a.expression=p.serializeExpr(n.expression)),t.push(a)}return t}},i.prototype.setFilterOnSelectData=function(t,r,i,n){this.supportsFilterOutput(n)?(this.clearCrossHighlight(i),m.notifyVisualContainersExceptSource(this.eventBridge,n),this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,i,e.telemetry.CrossFilterType.Data)):this.setCrossHighlight(t,r,i,n)},i.prototype.supportsFilterOutput=function(e){return null!=this.tryGetFilterPropertyIdentifier(m.getVisualCapabilities(e,this.visualPlugins))},i.prototype.tryGetFilterPropertyIdentifier=function(e){if(e)return a.findFilterOutput(e.objects)},i.prototype.tryGetSelfFilterEnabledProperty=function(e){if(e)return a.findSelfFilterEnabled(e.objects)},i.prototype.tryGetSelfFilterProperty=function(e){if(e)return a.findSelfFilter(e.objects)},i.prototype.resolveFilterTargets=function(e,t,i,n,a){var o={dataRoles:i,mappings:n,queryProjections:t.projections,select:t.defn.select(),schema:e},s=new r.VisualFilterMappingResolver(o),l=t.defn;return a&&(l=l.addSemanticFilter(a)),s.resolveSemanticQuery(l)},i.prototype.applyFilterOutput=function(e){this.supportsFilterOutput(e)&&m.notifyVisualContainersExceptSource(this.eventBridge,e)},i})(),g=(function(){function e(){this.collectedFilters=[]}return e.prototype.collectFilters=function(e,t){if(e)for(var r=0,i=e;r<i.length;r++){var n=i[r];n.filter&&this.collectFilter(n.filter,n,t)}},e.prototype.collectFilter=function(e,t,r){e&&this.collectedFilters.push({filter:e,filterContainer:t,sourceVisualContainer:r})},e.prototype.getCollectedFilters=function(){return this.collectedFilters},e})(),y=(function(){function e(e){if(this.visualContainer=e,e){var t=m.getVisualQuery(e);t&&(this.visualSemanticQuery=t.defn)}this.needToEnsurePrecedence=!1,this.shouldPruneUnnecessaryFilters=!1}return e.prototype.setSelectorFilter=function(e){this.selectorFilter=e,this.shouldPruneUnnecessaryFilters=!0},e.prototype.addDrillFilter=function(e){this.drillFilters=this.drillFilters||[],this.drillFilters.push(e)},e.prototype.addVisualFilter=function(e){this.visualSemanticQuery&&(e=d.rewriteSubqueriesForContainingQuery(e,this.visualSemanticQuery)),this.visualFilters=this.visualFilters||[],this.visualFilters.push(e),this.needToEnsurePrecedence=!0,this.shouldPruneUnnecessaryFilters=!0},e.prototype.addExternalFilter=function(e){this.externalFilters=this.externalFilters||[],this.externalFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.addCrossFilter=function(e){this.crossFilters=this.crossFilters||[],this.crossFilters.push(e),this.needToEnsurePrecedence=!0},e.prototype.setHighlight=function(e){this.highlightFilter=e},e.prototype.addCollectedFilters=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var a=n[i],o=a.filter,s=a.filterContainer,l=a.sourceVisualContainer;if((!r||r(o,s,l))&&(s&&0===s.precedence?this.addDrillFilter(o):a.sourceVisualContainer?a.sourceVisualContainer===this.visualContainer?this.addVisualFilter(o):this.addCrossFilter(o):this.addExternalFilter(o),t&&s)){var u=s.expression&&p.serializeExpr(s.expression);this.metadata=this.metadata||[],this.metadata.push({Restatement:s.restatement,expression:u,type:s.type})}}},e.prototype.mergeHighlightFilterBasedOnRelationship=function(e,t){switch(e){case 0:case 2:if(!t)break;case 1:this.highlightFilter&&(this.addCrossFilter(this.highlightFilter),this.highlightFilter=void 0);break;case 3:this.highlightFilter=void 0}},e.prototype.getMergedDataFilter=function(){if(this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.drillFilters||this.externalFilters||this.visualFilters||this.crossFilters){var e=this.drillFilters||[],t=this.visualFilters||[],r=this.externalFilters||[],i=this.crossFilters||[];return c.merge(e.concat(t).concat(r).concat(i))}},e.prototype.getMergedHighlightFilter=function(){if(this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.selectorFilter||this.visualFilters){var e=this.selectorFilter?[this.selectorFilter]:[],t=this.visualFilters||[];return c.merge(e.concat(t))}},e.prototype.getCrossFilters=function(){return this.crossFilters},e.prototype.getHighlightFilter=function(){return this.highlightFilter},e.prototype.getMetadata=function(){return this.metadata},e.prototype.ensurePrecedence=function(){if(this.needToEnsurePrecedence){if(this.visualFilters){var e=c.merge(this.visualFilters);e=d.makeSubqueriesLowerPrecedenceThanColumnFilters(e),this.externalFilters&&(e=d.makeSubqueriesLowerPrecedenceThanSpecificFilters(e,this.externalFilters)),this.crossFilters&&(e=d.makeSubqueriesLowerPrecedenceThanSpecificFilters(e,this.crossFilters)),this.visualFilters=[e]}this.needToEnsurePrecedence=!1}},e.prototype.pruneUnnecessaryFilters=function(){if(this.shouldPruneUnnecessaryFilters){if(this.visualFilters&&this.selectorFilter){var e=c.merge(this.visualFilters);e=h.removeUnnecessaryTopNFilters(e,this.selectorFilter),this.visualFilters=[e]}this.shouldPruneUnnecessaryFilters=!1}},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i,n,a,o,s){return new r(e,t,i,n,a,o)}e.createClipboardService=t;var r=(function(){function t(e,t,r,i,n,a){this.eventBridge=e,this.popOutService=t,this.undoRedoService=r,this.visualStylePresetService=i,this.rootScope=n,this.registeredResourceReferences=a,a.addReferenceSource(this)}return t.prototype.getReferences=function(){return this.data&&this.data.referencedStaticResources},t.prototype.restoreMissingResources=function(e){return this.registeredResourceReferences.restoreReferences(_.map(this.data.referencedStaticResources,(function(e){return e.name})))},t.prototype.setData=function(t){this.data=t,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.getData=function(){return this.data},t.prototype.clearData=function(){this.data=void 0,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.copySelectedVisuals=function(){var e=this.handler.serializeSelection(),t=this.handler.getSelectionResources();return{visuals:e,referencedStaticResources:t}},t.prototype.copy=function(){this.setData(this.copySelectedVisuals())},t.prototype.cut=function(){var e=this;this.rootScope.$evalAsync((function(){e.undoRedoService.register("Cut",(function(){e.setData(e.copySelectedVisuals()),e.handler.deleteSelection()}))}))},t.prototype.paste=function(){var e=this;if(this.canPaste()){var t=this.getData();this.restoreMissingResources(t&&t.referencedStaticResources).then((function(){e.rootScope.$evalAsync((function(){e.undoRedoService.register("Paste",(function(){e.handler.deserializeAndDuplicateData(t.visuals)}))}))}))}},t.prototype.canPaste=function(){return Boolean(null==this.popOutService.get()&&this.data&&this.data.visuals)},t.prototype.setHandler=function(e){this.handler=e},t.prototype.getFormatData=function(){return this.formatData},t.prototype.setFormatData=function(t){this.formatData=t,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.clearFormatData=function(){this.formatData=void 0,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.copyFormat=function(){var e=this.handler.serializeSelection();if(1===e.length){var t=e[0],r={visuals:[t]};this.setFormatData(r)}},t.prototype.tryPasteFormat=function(){var e=this;this.canPasteFormat()&&this.rootScope.$evalAsync((function(){e.undoRedoService.register("PasteFormat",(function(){var t=e.getFormatData(),r=e.handler.deserializeVisualContainer(t.visuals[0]).config.singleVisual;e.handler.pasteVisualFormat(r,e.visualStylePresetService),e.clearFormatData()}))}))},t.prototype.canPasteFormat=function(){return!(!this.formatData||!this.formatData.visuals)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.DataViewObjectDefinition,n=e.data.DataViewObjectDefinitions,a=e.explore.contracts.VisualContainer;!(function(r){function o(e,r){var i=t.selectionUtils.getSelectedVisual(e);if(i){var n=i.config.singleVisual.visualType,a=r.isCustomVisual(n);if(!a)return i.config.singleVisual}}function s(e,r,i,n){var o=t.selectionUtils.getSelectedVisual(e);if(o&&n){var s=o.config.singleVisual,c=s.visualType,p=r.isCustomVisual(c);if(!p){s.objects||(s.objects={});var f=r.capabilities(c),d=r.capabilities(n.visualType);if(f&&d){for(var h in n.objects){var m=f.objects[h],v=d.objects[h];l(m,v,n,s,h)}var g=a.getObjectDescriptors(c,i);u(g,n,s)}return o}}}function l(t,r,i,a,o){if(t&&r&&o&&!t.suppressFormatPainterCopy&&!r.suppressFormatPainterCopy){var s=i.objects[o];for(var l in t.properties)for(var u=t.properties[l],p=r.properties[l],f=0,d=s;f<d.length;f++){var h=d[f];if(u&&p&&!u.suppressFormatPainterCopy&&!p.suppressFormatPainterCopy&&e.ValueType.fromDescriptor(u.type).equals(e.ValueType.fromDescriptor(p.type))){var m=n.ensure(i.objects,o,h.selector),v=n.ensure(a.objects,o,h.selector);c(l,m,v)}}}}function u(e,t,r){if(e)for(var i in e){var n=e[i];if(n&&t[i])for(var a in n.properties){var o=t[i],s=n.properties;o&&o[a]&&s&&s[a]&&!s[a].suppressFormatPainterCopy&&(r[i]||(r[i]={}),r[i][a]=o[a])}}}function c(e,t,r){var n=t.properties[e],a=r.properties[e];n?r.properties[e]=n:a&&i.deleteSingleProperty(r,e)}r.copyFormatVisualConfig=o,r.pasteFormatVisualConfig=s})(r=t.FormatPainter||(t.FormatPainter={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a,s,l,u,c){return new o(e,t,r,i,n,a,s,l,u,c)}var n=t.contracts.DataSource,a=e.explore.util.VisualContainerUtils;r.createModelChangeHandler=i;var o=(function(){function t(e,t,i,n,a,o,s,l,u,c){var p=this;this.conceptualSchemaProxy=e,this.dataProxy=t,this.dataSources=n,this.eventBridge=a,this.undoRedoService=o,this.visualPluginService=s,this.promiseFactory=l,this.lazySync=u,this.pbiLazyLoad=c,this.handlerTokens=[];var f=a.createChannelSubscriptionManager().subscribe(r.events.explorationLoaded,(function(e,t){return p.currentExplorationContract=t}));i.$on("$destroy",(function(){return f.unsubscribeAll()}))}return t.prototype.applyChange=function(t){var i=this,o=t.providerType;o||(o="dsr");var s=this.dataSources.get(),l=n.referenced(s,null);if(l){var u=n.dataReaderDataSources(n.queried(s,null)),c=this.conceptualSchemaProxy,p=this.dataProxy;c.stopCommunication(new e.IgnorableClientError),c.clearCache(),p.stopCommunication(o);var f=_.find(s,(function(e){return!n.isExtension(e)}));f&&this.pbiLazyLoad.isLoaded("powerbi.insights")&&this.lazySync("insightsCache").clearForModel(f.dsr.modelId),t.change.then((function(n){n.isSchemaChangeListComplete||(p.clearCache(o,u),i.currentExplorationContract&&a.clearVisualContainerQueryCaches(i.currentExplorationContract));var s;n&&(s=n.changes)&&!_.isEmpty(s)&&(n.isSchemaChangeListComplete&&"dsr"===o&&e.data.dsr.createQueryCacheHandler().apply(p,u,s),i.currentExplorationContract&&r.createSchemaChangeHandler(i.visualPluginService).apply(i.currentExplorationContract,s)),i.conceptualSchemaProxy.resumeCommunication();var l=[];try{for(var c=0,f=i.handlerTokens;c<f.length;c++){var d=f[c];l.push(d.handle(n))}}finally{i.promiseFactory.all(l).finally((function(){i.dataProxy.resumeCommunication(o),t.leaveUndo||(i.undoRedoService.canUndo()||i.undoRedoService.canRedo())&&(i.undoRedoService.clear(),i.eventBridge.publishToChannel(r.events.undoRedoStackCleared));var e=i.eventBridge;e.publishToChannel(r.events.enableEditing),e.publishToChannel(r.events.modelChanged,n),e.publishToChannel(r.events.visualContainerChanged,{affectContainer:function(){return!0}})}))}}),(function(){return i.resumeCommunication(o)}))}},t.prototype.register=function(e){var t=this,r={handle:e,stopHandling:function(){var e=t.handlerTokens.indexOf(r);e>-1&&t.handlerTokens.splice(e,1)}};return this.handlerTokens.push(r),r},t.prototype.resumeCommunication=function(e){this.conceptualSchemaProxy.resumeCommunication(),this.dataProxy.resumeCommunication(e)},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createServicePauser=t;var r=(function(){function e(){this.isPaused=!1}return e.prototype.register=function(e){var t=jQuery.extend(!0,{},e);return this.updateService(t),t},e.prototype.pause=function(){this.isPaused=!0},e.prototype.resume=function(){this.isPaused=!1},e.prototype.updateService=function(e){var t=function(t){if(_.isFunction(e[t])){var i=e[t],n=r;e[t]=function(){if(!n.isPaused)return i.apply(e,arguments)}}},r=this;for(var i in e)t(i)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new o(e,t,r,i,n)}var i=e.data.DataViewObjectDefinitions,n=e.visualHost.ResourcePackageReferenceResolver;t.createRegisteredResourceReferenceService=r;var a;!(function(e){function t(e,t,r){e&&i.visitPropertyExprs({definitions:e,visitor:function(e){if(25===e.kind){var i=n.findRegisteredResourceReference(e,t);if(i){var a={name:i.name,type:i.type};r.push(a)}}}})}e.addObjectsReferences=t})(a=t.RegisteredResourceReferences||(t.RegisteredResourceReferences={}));var o=(function(){function e(e,t,r,i,n){this.promiseFactory=e,this.resourceLoader=t,this.explorationNavigation=r,this.explorationSerializer=i,this.resourceRegistration=n,this.referenceSources=[],this.preservedReferences={}}return e.prototype.addReferenceSource=function(e){this.referenceSources.push(e)},e.prototype.removeReferenceSource=function(e){_.pull(this.referenceSources,e)},e.prototype.garbageCollectUnreferencedRegisteredResources=function(){var e=this.explorationNavigation.getCurrentExploration();if(e&&!_.isEmpty(e.resourcePackages)){var t=n.getRegisteredResourcePackage(e.resourcePackages);if(t){if(_.isEmpty(t.items))return void _.pull(e.resourcePackages,t);for(var r=_.indexBy(this.explorationSerializer.getReferencedRegisteredResources(e),(function(e){return e.name})),i=_.map(_.filter(t.items,(function(e){return!r[e.name]})),(function(e){return{name:e.name,type:e.type}})),a={},o=0,s=this.referenceSources;o<s.length;o++){var l=s[o],u=l.getReferences();if(!_.isEmpty(u))for(var c=0,p=u;c<p.length;c++){var f=p[c];a[f.name]=f}}var d={};for(var h in a)r[h]||d[h]||(d[h]=this.preservedReferences[h]||{name:h,type:a[h].type,uri:n.loadRegisteredResourceAsDataUri(this.promiseFactory,this.resourceLoader,e.resourcePackages,h)});if(this.preservedReferences=d,!_.isEmpty(i)){var m=_.indexBy(i,(function(e){return e.name}));t.items=_.filter(t.items,(function(e){return!m[e.name]})),_.isEmpty(t.items)&&_.pull(e.resourcePackages,t)}return _.map(i,(function(e){return t.name+"/"+e.name}))}}},e.prototype.needingRestore=function(e){var t=this;if(!_.isEmpty(e)){var r=this.explorationNavigation.getCurrentExploration();if(r){var i=r.resourcePackages;if(!_.isEmpty(i))return _.map(_.filter(e,(function(e){return t.preservedReferences[e]&&!n.findRegisteredResource(e,i)})),(function(e){return t.preservedReferences[e]}))}}},e.prototype.restoreReferences=function(e){var t=this,r=this.needingRestore(e);if(_.isEmpty(r))return this.promiseFactory.resolve(void 0);var i=_.map(r,(function(e){return e.uri.then((function(r){t.resourceRegistration.restore(e.name,e.type,r)}))}));return this.promiseFactory.all(i).then((function(){}))},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return new s(e,t)}var i=jsCommon.FileUtils,n=e.explore.util.ResourcePackageUtils,a=e.data.SQExprBuilder,o=jsCommon.UrlUtils;t.createResourceRegistrationService=r;var s=(function(){function e(e,t){this.explorationNavigationService=e,this.resourcePublishingService=t}return e.prototype.addResource=function(e,t,r,i){var n=o.getBase64ContentFromDataUri(i);this.resourcePublishingService.publish(e.name,t,n);var a={type:r,path:t,name:t,content:i};e.items.push(a)},e.prototype.restore=function(e,t,r){var i=this.ensureResourcePackageExists();_.find(i.items,(function(t){return t.name===e}))||this.addResource(i,e,t,r)},e.prototype.add=function(e,t,r){var i=this.ensureResourcePackageExists(),n=this.getUniqueName(e,i);return this.addResource(i,n,t,r),a.resourcePackageItem(i.name,i.type,n)},e.prototype.getUniqueName=function(e,t){var r=e.replace(/[^a-zA-Z0-9:@\-._~!$&'()*+,;=]/g,"_"),n=i.getFileWithoutExtension(r),a=i.getFileExtension(r);a&&(a="."+a);for(var o;;){var s=Math.random().toString().substr(2);if(o=n+s+a,!_.find(t.items,(function(e){return e&&e.name&&e.name.toUpperCase()===o.toUpperCase()})))break}return o},e.prototype.ensureResourcePackageExists=function(){var e=this.explorationNavigationService.getCurrentExploration();return n.ensureRegisteredResourcePackage(e)},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{publish:_.noop}}e.createResourcePublishingService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(t){return r[t]||e.v3_6}e.v1_0="1.0",e.v2_0="2.0",e.v2_2="2.2",e.v2_3="2.3",e.v2_5="2.5",e.v3_0="3.0",e.v3_1="3.1",e.v3_2="3.2",e.v3_3="3.3",e.v3_4="3.4",e.v3_5="3.5",e.v3_6="3.6";var r={CY17SU10:e.v3_6};e.getVersionForBaseTheme=t})(t=e.ExplorationVersions||(e.ExplorationVersions={}));var r;!(function(e){e.bookmarks=t.v3_6,e.visualHidden=t.v3_6})(r=e.ExplorationFeatureVersions||(e.ExplorationFeatureVersions={}));var i;!(function(e){e.v1_0="1.0"})(i=e.ExplorationStateVersions||(e.ExplorationStateVersions={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new S(e,t)}var n=jsCommon.ArrayExtensions,a=e.explore.contracts,o=e.data.services.DataViewObjectSerializer,s=e.data.DefaultSQExprVisitor,l=e.explore.services.upgrade.ExplorationStateVersions,u=e.explore.services.upgrade.ExplorationVersions,c=e.explore.services.upgrade.ExplorationFeatureVersions,p=jsCommon.JsonExtensions,f=e.data.QueryProjectionCollection,d=e.visualHost.ResourcePackageReferenceResolver,h=e.data.services.SemanticQuerySerializer,m=e.data.SQExpr,v=jsCommon.StringExtensions,g=e.explore.contracts.Version,y=t.util.VisualContainerUtils,b=a.VisualQuery,C="Gradient",x="Size";r.createExplorationSerializer=i;var S=(function(){function i(e,t){this.visualPlugins=e,this.telemetryService=t,this.explorationUpgrader=r.upgrade.createExplorationUpgrader()}return i.prototype.deepCopyExploration=function(e,t){return this.deserializeExploration(this.serializeExploration(e,t),[],!0)},i.prototype.ensureInitialized=function(){return this.visualPlugins.ensureBuiltInPlugins()},i.prototype.deserializeExploration=function(t,r,i,n){var o,s=this;if(t){var l=this.explorationUpgrader.upgrade(t,r,i);if(!l)return;o={id:l.id,width:void 0,height:void 0,sections:void 0,dataSources:void 0,reportId:l.reportId,theme:l.theme,bookmarks:[]};var u=null;if(l.config&&(u=p.tryParseJSON(l.config),u.tags&&(o.tags=u.tags)),u&&u.bookmarks&&(o.bookmarks=this.deserializeBookmarks(u.bookmarks)),l.sections){var c=_.sortBy(l.sections,(function(e){return void 0!==e.ordinal?e.ordinal:0}));if(o.sections=_.map(c,(function(e){return s.deserializePage(e)})),o.filters=this.deserializeFilterContainers(l.filters),o.dataSources=a.createDataSourceArray(),l.resourcePackages&&(o.resourcePackages=this.deserializeResourcePackages(l.resourcePackages)),l.pods&&(o.pods=_.map(l.pods,(function(e){return s.deserializePod(e)}))),u&&(_.isNumber(u.activeSectionIndex)&&u.activeSectionIndex<l.sections.length&&(o.activeSectionIndex=u.activeSectionIndex),u.modelExtensions&&(o.modelExtensions=this.deserializeModelExtensions(u.modelExtensions))),n&&n.lastTimeAModelChangeWasDetectedInTheCluster&&!_.isEmpty(n.onPremModelConnectionString))for(var f=jsCommon.DateExtensions.deserializeDate(n.lastTimeAModelChangeWasDetectedInTheCluster),d=0,h=o.sections;d<h.length;d++)for(var m=h[d],v=0,g=m.visualContainers;v<g.length;v++){var y=g[v];if(y.cachedData&&y.cachedData.dataUpdatedTime&&y.cachedData.data){var b=+y.cachedData.dataUpdatedTime-+f;y.useInitialCachedQuery=b>=0}else y.useInitialCachedQuery=!1}}l.report&&(o.report=e.Prototype.inherit(l.report),l.report.linguisticSchemaId&&(o.reportHasLinguisticSchema=!0)),u&&u.baseTheme&&(o.baseTheme=u.baseTheme)}return o},i.prototype.deserializeResourcePackages=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this.upgradeResourcePackage(n.resourcePackage),t.push(n.resourcePackage)}return t},i.prototype.deserializePage=function(e){if(e){var r={id:e.id,objectId:e.objectId,name:e.name,displayName:e.displayName,visualContainers:void 0,size:{displayOption:void 0!==e.displayOption?e.displayOption:0,height:void 0!==e.height?e.height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight,width:void 0!==e.width?e.width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth},filters:this.deserializeFilterContainers(e.filters)};e.transient&&(r.transient=e.transient);var i;if(e.config&&(i=p.tryParseJSON(e.config)),i&&i.objects&&(r.objects=o.deserializeObjects(i.objects,a.Section.objectDescriptors)),e.visualContainers){r.visualContainers=[];for(var n=0,s=e.visualContainers;n<s.length;n++){var l=s[n],u=this.deserializeVisualContainer(l);r.visualContainers.push(u)}if(this.ensureNames(r.visualContainers),i&&i.relationships){r.relationships=[];for(var c=0,f=i.relationships;c<f.length;c++){var d=f[c],h=this.deserializeRelationship(d,r.visualContainers);
h&&r.relationships.push(h)}}}return r}},i.prototype.deserializePod=function(e){if(e)return{id:e.id,name:e.name,boundSection:e.boundSection,parameters:this.deserializePodParameters(e.parameters),cortanaEnabled:e.cortanaEnabled}},i.prototype.deserializeBookmarks=function(e){if(e)return _.map(e,(function(e){var t=e.explorationState,i={displayName:e.displayName,name:e.name,explorationState:r.ExplorationState.deserialize(t)};return i}))},i.prototype.deserializeModelExtensions=function(e){var t=this;return n.extendWithName(_.map(e,(function(e){var r={name:e.name,extends:e.extends};return e.entities&&(r.entities=t.deserializeModelExtensionEntities(e.entities)),r})))},i.prototype.deserializeModelExtensionEntities=function(e){var t=this;return n.extendWithName(_.map(e,(function(e){var r;return r=e.extends?{name:e.name,extends:e.extends}:{name:e.name},e.measures&&(r.measures=t.deserializeModelExtensionMeasures(e.measures)),r})))},i.prototype.deserializeModelExtensionMeasures=function(e){var t=this;return n.extendWithName(_.map(e,(function(e){var r={name:e.name,dataType:e.dataType,expression:e.expression,errorMessage:e.errorMessage,hidden:e.hidden,references:t.deserializeExpressionReferences(e.references),formulaOverride:e.formulaOverride,formatInformation:e.formatInformation};return e.annotations&&(r.annotations=t.deserializeModelExtensionAnnotations(e.annotations)),e.measureTemplate&&(r.measureTemplate={daxTemplateName:e.measureTemplate.daxTemplateName,version:e.measureTemplate.version}),r})))},i.prototype.deserializeExpressionReferences=function(e){if(!e)return{unrecognizedReferences:!1,measures:[]};var t={unrecognizedReferences:!!e.unrecognizedReferences,measures:e.measures||[]};return t},i.prototype.deserializeModelExtensionAnnotations=function(e){return n.extendWithName(_.map(e,(function(e){return{name:e.name,value:e.value}})))},i.prototype.deserializeFilterCollection=function(e,t,r){if(e){var i=this.explorationUpgrader.upgradeFilterCollection(e,t,r);if(i)return this.deserializeFilterContainers(i.filters)}},i.prototype.deserializeFilterContainer=function(e){return{name:e.name,type:a.FilterType[e.type],expression:e.expression?h.deserializeExpr(e.expression):void 0,filter:e.filter&&e.filter.Where?h.deserializeFilter(e.filter):void 0,restatement:e.restatement,cachedValueItems:this.deserializeFilterLabelIdPairs(e.cachedDisplayNames),howCreated:e.howCreated}},i.prototype.deserializeFilterLabelIdPairs=function(e){if(e&&!(e.length<1)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];if(n.id){var a=o.deserializeScopeIdentity(n.id);a&&t.push({identity:a,displayName:n.displayName})}}return t}},i.prototype.deserializeVisualContainer=function(e,t,r){var i={name:r,id:t?void 0:e.id,layouts:n.createWithId()};null!=e.visibility&&(i.visibility=e.visibility),null!=e.detailVisualLayout&&(i.detailVisualLayout=e.detailVisualLayout),void 0===e.dataBinaryBase64Encoded&&void 0===e.query&&void 0===e.dataTransforms||(i.cachedData={data:e.dataBinaryBase64Encoded,query:e.query,transforms:e.dataTransforms,dataUpdatedTime:e.dataUpdatedTime?jsCommon.DateExtensions.parseUtcDate(e.dataUpdatedTime):void 0}),i.filters=this.deserializeFilterContainers(e.filters);var a=p.tryParseJSON(e.config);return a&&(r||(i.name=a.name),a.singleVisual&&(i.config={singleVisual:this.deserializeSingleVisual(a.singleVisual,e.prototypeQuery)}),(o=i.layouts).push.apply(o,a.layouts)),i;var o},i.prototype.deserializeRelationship=function(e,t){var r=n.findItemWithName(t,e.source),i=n.findItemWithName(t,e.target);if(0!==e.type&&r&&i)return{source:r,target:i,type:e.type}},i.prototype.deserializeFilterContainers=function(e){var t=this;if(!v.isNullOrUndefinedOrWhiteSpaceString(e)){var r=[],i=p.tryParseJSON(e);return i&&(r=i.map((function(e){return t.deserializeFilterContainer(e)}))),r}},i.prototype.deserializePodParameters=function(e){var t=this,r=[];if(!v.isNullOrUndefinedOrWhiteSpaceString(e)){var i=p.tryParseJSON(e);i&&(r=i.map((function(e){return t.deserializePodParameter(e)})))}return r},i.prototype.deserializePodParameter=function(e){return{name:e.name,boundFilter:e.boundFilter}},i.prototype.deserializeVisualQuery=function(e,t,r,i){var n=new b(t,this.convertProjections(r,t.select(),i));this.upgradeVisualQuery(n,e.visualType),e.query=n},i.prototype.deserializeSingleVisual=function(e,t){var r={visualType:e.visualType||e.visualConfig.visualType},i=e.visualConfig?e.visualConfig.projections:void 0,n=e.projections||{};if(i)for(var a=0,s=i;a<s.length;a++){var l=s[a],u=n[l.role];u||(u=[],n[l.role]=u),u.push(l)}else if(n&&n.length>0){i=n,n={};for(var c=0,f=i;c<f.length;c++){var l=f[c],u=n[l.role];u||(u=[],n[l.role]=u),u.push(l)}}var d=e.prototypeQuery?e.prototypeQuery:t?p.tryParseJSON(t):null;if(d){var m=h.deserializeQuery(d);this.deserializeVisualQuery(r,m,n,e.showAllRoles)}var v=this.deserializeVisualTitle(e.title);v&&(r.title=v);var g=e.background;g&&(r.background=g);var y=e.aspectRatio;y&&(r.aspectRatio=y);var b=e.border;b&&(r.border=b);var C=e.stylePresetName;C&&(r.stylePresetName=C);var x=e.altText;x&&(r.altText=x);var S=e.visualLink;S&&(r.visualLink=S);var w=e.display;null!=e.display&&(r.display=w),r.columnProperties=e.columnProperties||{};var E=e.queryOptions;E&&(r.queryOptions=E);var F=this.visualPlugins.capabilities(r.visualType);if(F&&e.objects)r.objects=o.deserializeObjects(e.objects,F.objects);else{var P=e.objects;P&&(r.objects=o.deserializeObjects(P,null))}return r},i.prototype.deserializeVisualTitle=function(e){if(e)return e.hidden?{show:!1}:e},i.prototype.ensureNames=function(e){for(var t,r=e.length,i={},n=0;n<r;n++){var a=e[n].name;_.isEmpty(a)?t=!0:i[a]=!0}if(t)for(var n=0;n<r;n++){var o=e[n],s=o.name;_.isEmpty(s)&&(o.name=y.nextUniqueName(i),i[o.name]=!0)}},i.prototype.convertProjections=function(e,t,r){var i={};for(var n in e){var a=_.contains(r,n);i[n]=this.convertProjectionArray(e[n],t,a)}return i},i.prototype.convertProjectionArray=function(e,t,r){for(var i,n=[],a=0,o=e;a<o.length;a++){var s=o[a],l=this.convertProjection(s,t);s.active&&(i=i||[],i.push(l.queryRef)),n.push(l)}return new f(n,i,r)},i.prototype.convertProjection=function(e,t){var r=e.queryRef;_.isNumber(e.queryRef)&&(r=t[e.queryRef].name);var i={queryRef:r};return e.format&&(i.format=e.format),i},i.prototype.serializeExploration=function(e,t){var r=new w(this.visualPlugins);return r.serializeExploration(e,t)},i.prototype.serializeModelExtensions=function(e){var t=new w(this.visualPlugins);return t.serializeModelExtensions(e)},i.prototype.serializePage=function(e,t,r){var i=new w(this.visualPlugins);return i.serializePage(e,t,r)},i.prototype.serializePageShallow=function(e,t,r){var i=new w(this.visualPlugins);return i.serializePageShallow(e,t,r)},i.prototype.serializeVisualContainer=function(e,t){var r=new w(this.visualPlugins);return r.serializeVisualContainer(e,t)},i.prototype.serializePod=function(e){var t=new w(this.visualPlugins);return t.serializePod(e)},i.prototype.serializeFilterCollection=function(e){var t=new w(this.visualPlugins);return t.serializeFilterCollection(e)},i.prototype.serializeResourcePackages=function(e){var t=new w(this.visualPlugins);return t.serializeResourcePackages(e)},i.prototype.upgradeVisualQuery=function(r,i){if(i===e.visuals.plugins.filledMap.name&&r.projections[C]){var n=r.projections[C],a=r.projections[x];if(a&&a.all.length>0)for(var o=a.all().length,s=o-1;s>=0;s--)r.removeProjection(x,s);r.projections[x]=n,delete r.projections[C]}var l=this.visualPlugins.capabilities(i);if(l){var u=t.util.DrillUtils.getDrillableRoles(l),c=r.ensureDrillableRoles(u);if(!_.isEmpty(c)){for(var p={},f=0,d=c;f<d.length;f++){var h=d[f],m=r.projections[h],v=0;m&&(v=_.size(m.all())),p[h]=v}this.telemetryService.logEvent(e.telemetry.EXVisualDrillableRoleActiveItemsFixed,i,JSON.stringify(p))}}},i.prototype.upgradeResourcePackage=function(e){void 0===e.type&&(e.type=0)},i.prototype.getReferencedRegisteredResources=function(e){var t=[];if(d.findRegisteredResource(e.theme,e.resourcePackages)&&t.push({name:e.theme,type:201}),!_.isEmpty(e.sections))for(var i=0,n=e.sections;i<n.length;i++){var a=n[i];if(r.RegisteredResourceReferences.addObjectsReferences(a.objects,e.resourcePackages,t),!_.isEmpty(a.visualContainers))for(var o=0,s=a.visualContainers;o<s.length;o++){var l=s[o],u=l.config&&l.config.singleVisual&&l.config.singleVisual.objects;r.RegisteredResourceReferences.addObjectsReferences(u,e.resourcePackages,t)}}return t},i})(),w=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitColumnRef=function(e){var t=e.source.accept(this);if(t)return t.column=e.ref,t},t.prototype.visitMeasureRef=function(e){var t=e.source.accept(this);if(t)return t.measure=e.ref,t},t.prototype.visitAggr=function(e){var t=e.arg.accept(this);if(t)return t.aggregate=e.func,t},t.prototype.visitEntity=function(e){var t={schema:e.schema,entity:e.entity};return e.variable&&(t.entityVar=e.variable),t},t.instance=new t,t}(s),(function(){function t(e){this.visualPlugins=e,this.version=u.v2_5}return t.prototype.serializeExploration=function(e,t){var r=this,i=e.sections;t&&t.withTransientPages||(i=a.Section.filterTransient(i));var n,o=_.map(i,(function(e,i){return r.serializePage(e,i,t)}));_.isEmpty(e.pods)||(n=_.map(e.pods,(function(e){return r.serializePod(e)})));var s=this.serializeExplorationShallowWithResourcePackages(e,t);return s.sections=o,s.pods=n,s},t.prototype.serializeBookmarks=function(e){if(e){var t=l.v1_0,i=_.map(e,(function(e){var i={displayName:e.displayName,name:e.name,explorationState:r.ExplorationState.serialize(e.explorationState)};return t=g.max(i.explorationState.version,t),i}));return t===l.v1_0&&(this.version=g.max(this.version,c.bookmarks)),i}},t.prototype.serializeExplorationShallowWithResourcePackages=function(e,t){var r=e.activeSectionIndex,i=this.createVersionedElementConfig(u.v2_5);if(_.isNumber(r)&&(i.activeSectionIndex=r),_.isEmpty(e.modelExtensions)||(this.version=g.max(this.version,u.v3_0),i.modelExtensions=this.serializeModelExtensions(e.modelExtensions)),!_.isEmpty(e.bookmarks)){var n=this.serializeBookmarks(e.bookmarks);i.bookmarks=n}_.isEmpty(e.baseTheme)||(this.version=g.max(this.version,u.getVersionForBaseTheme(e.baseTheme)),i.baseTheme=e.baseTheme),e.tags&&(i.tags=e.tags),this.requireVersion(i,this.version);var a={id:e.id,reportId:e.reportId,theme:e.theme,filters:this.serializeFilterContainers(e.filters),resourcePackages:this.serializeResourcePackages(e.resourcePackages,t),sections:void 0,config:JSON.stringify(i),layoutOptimization:this.getLayoutOptimizations(e)};return a},t.prototype.serializeFilterCollection=function(e){if(!_.isEmpty(e)){var t=this.createVersionedElementConfig(u.v2_5);return{filters:this.serializeFilterContainers(e),config:JSON.stringify(t)}}},t.prototype.serializePage=function(e,t,r){var i=this.serializePageShallow(e,t,r);i.visualContainers=[];for(var n=0,a=e.visualContainers;n<a.length;n++){var o=a[n];i.visualContainers.push(this.serializeVisualContainer(o,r))}return i},t.prototype.serializePageShallow=function(e,t,r){var i={id:e.id,name:e.name,displayName:e.displayName,filters:this.serializeFilterContainers(e.filters),ordinal:t,visualContainers:void 0,transient:e.transient};e.size&&(i.displayOption=e.size.displayOption,i.width=e.size.width,i.height=e.size.height);var n={};if(!_.isEmpty(e.relationships)){n.relationships=[];for(var s=0,l=e.relationships;s<l.length;s++){var u=l[s],c=this.serializeRelationship(u);c&&n.relationships.push(c)}r&&r.featureUsage&&(r.featureUsage.hasVisualRelationships=!0)}var p=o.serializeObjects(e.objects,a.Section.objectDescriptors);return p&&(n.objects=p),i.config=JSON.stringify(n),i},t.prototype.serializePod=function(e){var t=this.serializePodParameters(e.parameters);return{id:e.id,name:e.name,boundSection:e.boundSection,parameters:_.isEmpty(t)?void 0:JSON.stringify(t),cortanaEnabled:e.cortanaEnabled?e.cortanaEnabled:void 0}},t.prototype.serializeVisualContainer=function(t,r,i){var n,a=this.serializeVisualContainerConfig(t,r),o=t.layouts&&t.layouts.withId(0);return n=o?{id:t.id,x:o.position.x,y:o.position.y,z:o.position.z,width:o.position.width,height:o.position.height,config:JSON.stringify(a),filters:this.serializeFilterContainers(t.filters)}:{id:t.id,config:JSON.stringify(a),filters:this.serializeFilterContainers(t.filters)},r&&r.withVisibility&&(null!=t.visibility&&(n.visibility=t.visibility),null!=t.detailVisualLayout&&(n.detailVisualLayout=t.detailVisualLayout)),r&&t.cachedData&&((r.withQuery||r.withData)&&(n.query=t.cachedData.queryObject?JSON.stringify(t.cachedData.queryObject):t.cachedData.query,n.dataTransforms=t.cachedData.transformsObject?e.data.services.DataViewTransformActionsSerializer.serializeTransformActions(t.cachedData.transformsObject):t.cachedData.transforms,n.dataUpdatedTime=t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime.toISOString():void 0),r.withData&&(n.dataBinaryBase64Encoded=t.cachedData.dataObject?jsCommon.GzipUtility.compress(JSON.stringify(t.cachedData.dataObject)):t.cachedData.data)),n},t.prototype.serializeModelExtensions=function(e){var t=this;if(e)return _.map(e,(function(e){var r={name:e.name,extends:e.extends,entities:t.serializeModelExtensionEntities(e.entities)};return r}))},t.prototype.serializeRelationship=function(e){return{source:e.source.name,target:e.target.name,type:e.type}},t.prototype.serializeVisualContainerConfig=function(t,r){var i={name:t.name,layouts:t.layouts},n=t.config;if(n&&n.singleVisual){var s=n.singleVisual,l=s.query;i.singleVisual={title:s.title,background:s.background,aspectRatio:s.aspectRatio,border:s.border,stylePresetName:s.stylePresetName,visualType:s.visualType,projections:this.serializeQueryProjections(l?l.projections:void 0),prototypeQuery:l?h.serializeQuery(l.defn):void 0},s.altText&&(this.version=g.max(this.version,u.v3_1),i.singleVisual.altText=s.altText);var p=s.columnProperties;if(p&&!_.isEmpty(p)&&(this.version=g.max(this.version,u.v3_4),i.singleVisual.columnProperties=p),s.queryOptions&&(null!=s.queryOptions.allowBinnedLineSample&&(this.version=g.max(this.version,u.v3_3)),null!=s.queryOptions.allowOverlappingPointsSample&&(this.version=g.max(this.version,u.v3_5)),i.singleVisual.queryOptions=s.queryOptions),s.visualLink&&(a.VisualLink.getType(s.visualLink)===a.VisualLink.Bookmark?this.version=g.max(this.version,c.bookmarks):this.version=g.max(this.version,u.v3_5),i.singleVisual.visualLink=s.visualLink),s.display&&(this.version=g.max(this.version,c.visualHidden),i.singleVisual.display=s.display),l&&l.defn){var f=l.defn.select();_.any(f,(function(e){return m.isFilteredEval(e.expr)}))&&(this.version=g.max(this.version,u.v3_5))}var d=this.serializeShowAllRoles(l?l.projections:void 0);_.isEmpty(d)||(i.singleVisual.showAllRoles=d,r&&r.featureUsage&&(r.featureUsage.hasShowAllEnabled=!0)),s.visualType===e.visuals.plugins.ribbonChart.name&&(this.version=g.max(this.version,u.v3_5));var v=s.objects;this.IsConditionalColorScaleFound(v)&&(this.version=g.max(this.version,u.v3_6));var y=this.visualPlugins.capabilities(s.visualType);if(y){var b=o.serializeObjects(v,y.objects);b&&(i.singleVisual.objects=b)}else v&&(i.singleVisual.objects=o.serializeObjects(v,null))}return i},t.prototype.IsConditionalColorScaleFound=function(e){if(_.isEmpty(e))return!1;for(var t in e){var r=e[t];if(!_.isEmpty(r))for(var i=0,n=r;i<n.length;i++){var a=n[i];if(a){var o=a.properties;for(var s in o){var l=o[s];if(l&&l instanceof m&&m.isFillRule(l)&&l.rule.conditional)return!0}}}}},t.prototype.serializeShowAllRoles=function(e){if(e){var t=_.pick(e,(function(e){return e.showAll===!0}));return _.keys(t)}},t.prototype.serializeQueryProjections=function(e){if(e){var t={};for(var r in e){var i=e[r].all(),n=e[r].activeProjectionRefs;if(i.length>0){t[r]=[];for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s.queryRef,u={queryRef:l};s.format&&(u.format=s.format),_.contains(n,l)&&(u.active=!0),t[r].push(u)}}}return t}},t.prototype.serializeModelExtensionEntities=function(t){var r=this;if(e.contract)return _.map(t,(function(e){var t={name:e.name};return e.extends&&(t.extends=e.extends),e.measures&&(t.measures=r.serializeModelExtensionMeasures(e.measures)),t}))},t.prototype.serializeExpressionReferences=function(e){if(e&&(e.unrecognizedReferences||!_.isEmpty(e.measures))){var t={unrecognizedReferences:e.unrecognizedReferences};return _.isEmpty(e.measures)||(t.measures=e.measures),t}},t.prototype.serializeModelExtensionAnnotations=function(e){if(e)return _.map(e,(function(e){return{name:e.name,value:e.value}}))},t.prototype.serializeModelExtensionMeasures=function(e){var t=this;if(e)return _.map(e,(function(e){var r={name:e.name,dataType:e.dataType,expression:e.expression,errorMessage:e.errorMessage,hidden:e.hidden,references:t.serializeExpressionReferences(e.references),formulaOverride:e.formulaOverride,formatInformation:e.formatInformation};return e.annotations&&(r.annotations=t.serializeModelExtensionAnnotations(e.annotations)),e.measureTemplate&&(r.measureTemplate={daxTemplateName:e.measureTemplate.daxTemplateName,version:e.measureTemplate.version}),r}))},t.prototype.serializeFilterContainers=function(e){if(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];(0!==n.howCreated||n.filter)&&(5===n.howCreated&&(this.version=g.max(this.version,u.v3_5)),t.push({name:n.name,expression:n.expression?h.serializeExpr(n.expression):void 0,filter:n.filter?h.serializeFilter(n.filter):void 0,type:a.FilterType[n.type],restatement:n.restatement,cachedDisplayNames:this.serializeFilterLabelIdPairs(n.cachedValueItems),howCreated:n.howCreated}))}return JSON.stringify(t)}},t.prototype.serializeFilterLabelIdPairs=function(e){if(e&&!(e.length<1)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];if(n.identity&&n.identity.expr){var a=o.serializeScopeIdentity(n.identity);a&&t.push({id:a,displayName:n.displayName})}}return t}},t.prototype.createVersionedElementConfig=function(e){return{version:e}},t.prototype.requireVersion=function(e,t){e.version=g.toString(g.max(e.version,t))},t.prototype.serializeResourcePackages=function(e,t){if(!_.isEmpty(e)){for(var r=[],i=function(e){var i=_.find(e.items,(function(e){return 5===e.type}));if(i&&void 0!==i.content){var n=_.isString(i.content)?jsCommon.JsonExtensions.tryParseJSON(i.content):i.content;n&&(n.content=void 0,i.content=JSON.stringify(n))}var a=e.items,o=t&&t.excludeResourceItemContent;if(!_.isEmpty(a)&&_.any(a,(function(e){return o&&e.content||e.contentBlob||e.contentBlobUrl||e.promise}))){var s=["contentBlob","contentBlobUrl","promise"];o&&s.push("content"),a=_.map(a,(function(e){return _.omit(e,s)}))}r.push({resourcePackage:{id:e.id,name:e.name,type:e.type,items:a}})},n=0,a=e;n<a.length;n++){var o=a[n];i(o)}return r}},t.prototype.getLayoutOptimizations=function(e){var t=this.getDistinctLayouts(e);return this.getLayoutOptimizationFromLayouts(t)},t.prototype.getLayoutOptimizationFromLayouts=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var n=i[r];switch(n.id){case 1:t|=1}}return t},t.prototype.getDistinctLayouts=function(e){for(var t=e.sections,r=n.createWithId(),i=0,a=t;i<a.length;i++)for(var o=a[i],s=0,l=o.visualContainers;s<l.length;s++)for(var u=l[s],c=0,p=u.layouts;c<p.length;c++){var f=p[c];r.withId(f.id)||r.push(f)}return r},t.prototype.serializePodParameters=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];t.push({name:n.name,boundFilter:n.boundFilter})}return t}},t})())})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return new a}var i=e.explore.contracts.Version,n=jsCommon.JsonExtensions;t.createExplorationUpgrader=r;var a=(function(){function e(){this.versionUpgraders=[t.v1_0.createVersionUpgrader(),t.v2_0.createVersionUpgrader(),t.v2_2.createVersionUpgrader(),t.v2_3.createVersionUpgrader(),t.v2_5.createVersionUpgrader()]}return e.prototype.upgrade=function(e,t,r){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgrade(t)})))return e},e.prototype.upgradeFilterCollection=function(e,t,r){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgradeFilterCollection(t)})))return e},e.prototype.getVersionUpgraders=function(){return this.versionUpgraders},e.prototype.upgradeElement=function(e,r,n,a){var o=this.getVersionedElementConfig(e),s=o.version&&_.isString(o.version)?o.version:i.ZeroStr;if(i.gt(s,t.CurrentExplorationVersion)){if(r.push({errorType:0}),!n)return}else{for(var l=0,u=this.versionUpgraders;l<u.length;l++){var c=u[l],p=c.getVersion();(i.lt(p,"2.2")||i.gt(p,s))&&a(c,e)}o.version=t.CurrentExplorationVersion,e.config=JSON.stringify(o)}return e},e.prototype.getVersionedElementConfig=function(e){var t;return e.config&&(t=n.tryParseJSON(e.config)),t||(t={version:i.ZeroStr}),t},e})()})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.CurrentExplorationVersion="3.6"})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new p}var n=e.data.services.DataViewObjectSerializer,a=e.visuals.GradientUtils,o=jsCommon.JsonExtensions,s=e.visuals.labelStyle,l=e.visuals.plugins,u=e.data.services.SemanticQuerySerializer,c=e.data.SQExprBuilder;r.createVersionUpgrader=i;var p=(function(){function r(){}return r.prototype.upgrade=function(e){if(e&&(e.filters=this.upgradeFilterContainers(e.filters),e.sections))for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.filters=this.upgradeFilterContainers(i.filters),i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var s=a[n];if(s.filters=this.upgradeFilterContainers(s.filters),s.config){var l=o.tryParseJSON(s.config);if(l&&l.singleVisual){var u=l.singleVisual,c=u.visualType||u.visualConfig.visualType;u.objects=this.upgradeVisualObjects(u.objects,c)}s.config=JSON.stringify(l)}}}},r.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},r.prototype.getVersion=function(){return t.ExplorationVersions.v1_0},r.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=o.tryParseJSON(e);if(t)for(var r=0,i=t;r<i.length;r++){var n=i[r];this.upgradeFilterContainer(n)}return JSON.stringify(t)}},r.prototype.upgradeFilterContainer=function(e){if(!e.expression&&e.field){var t=f.fieldDef(e.field);t&&(e.expression=u.serializeExpr(t))}void 0===e.howCreated&&(e.howCreated=e.autoGenerated?0:1)},r.prototype.upgradeVisualObjects=function(e,t){switch(this.dropMalformedSelectors(e),t){case l.filledMap.name:return this.upgradeObjectsFilledMap(e);case l.card.name:return this.upgradeObjectsCard(e);case l.donutChart.name:case l.pieChart.name:return this.upgradeObjectsDonutChart(e)}return e},r.prototype.dropMalformedSelectors=function(e){if(e)for(var t in e){var r=e[t];if(r)for(var i=r.length-1;i>=0;i--){var n=r[i],a=n.selector;a&&(a.metadata||delete a.metadata,_.isEmpty(Object.keys(a))&&r.splice(i,1))}}},r.prototype.upgradeObjectsFilledMap=function(t){var r="dataPoint",i="fillRule";t||(t={});var o=t[r];o||(t[r]=o=[]);for(var s,l=0,u=o;l<u.length;l++){var c=u[l];if(!c.selector){s=c;break}}return s||(s={selector:null,properties:{}},o.push(s)),null==s.properties[i]&&(s.properties[i]=n.serializeObjectProperty(a.getDefaultFillRuleDefinition(),e.visuals.filledMapCapabilities.objects[r].properties[i])),t},r.prototype.upgradeObjectsCard=function(e){var t="cardTitle",r="categoryLabels";if(e){var i=e[t];i&&(e[r]=i,delete e[t])}return e},r.prototype.upgradeObjectsDonutChart=function(t){var r="categoryLabels",i="labels",a="labelStyle",o="show";if(t){var l,p=this.getMetadataOnceObjectDefn(t,i),f=this.getPropertyExpr(p,o),d=!!f&&u.deserializeExpr(f).value,h=this.getMetadataOnceObjectDefn(t,r);if(h){var m=this.getPropertyExpr(h,o),v=!!m&&u.deserializeExpr(m).value;d&&v?l=s.categoryAndData:d&&!v?l=s.data:!d&&v&&(l=s.category),delete t[r]}else{var g=p&&p.properties[a];g||(l=d?s.categoryAndData:s.category)}if(null!=l){var y=e.visuals.donutChartCapabilities.objects[i].properties;if(!p){var b=t[i];b||(t[i]=b=[]),p=_.find(b,(function(e){return!e.selector})),p||(p={properties:{}},b.push(p))}p.properties[o]=n.serializeObjectProperty(c.boolean(!0),y[o]),p.properties[a]=n.serializeObjectProperty(c.text(l),y[a])}return t}},r.prototype.getMetadataOnceObjectDefn=function(e,t){if(e){var r=e[t];if(!_.isEmpty(r))return _.find(r,(function(e){return!e.selector}))}},r.prototype.getPropertyExpr=function(e,t){if(e){var r=e.properties[t];if(r)return r.expr}},r})();r.VersionUpgrader=p;var f;!(function(e){function t(e){return r(e)||i(e)||n(e)||a(e)}function r(e){var t=e.aggregate;if(void 0!==t){var r=i(e)||a(e);if(r)return c.aggregate(r,t)}}function i(e){var t=e.column;if(t){var r=a(e);if(r)return c.columnRef(r,t)}}function n(e){var t=e.measure;if(t){var r=a(e);if(r)return c.measureRef(r,t)}}function a(e){return c.entity(e.schema,e.entity,e.entityVar)}e.fieldDef=t})(f||(f={}))})(r=t.v1_0||(t.v1_0={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new n}var i=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var n=(function(){function t(){}return t.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var n=r[t];if(n.visualContainers)for(var a=0,o=n.visualContainers;a<o.length;a++){var s=o[a],l=void 0;if(s.config&&(l=i.tryParseJSON(s.config)),l=l||{},!l.layouts){var u={x:s.x,y:s.y,z:s.z,width:s.width,height:s.height};l.layouts=[{id:0,position:u}],s.config=JSON.stringify(l)}}}},t.prototype.upgradeFilterCollection=function(e){},t.prototype.getVersion=function(){return e.ExplorationVersions.v2_0},t})()})(t=e.v2_0||(e.v2_0={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(){return new n}var i=jsCommon.JsonExtensions;t.createVersionUpgrader=r;var n=(function(){function t(){}return t.prototype.upgrade=function(e){},t.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},t.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=i.tryParseJSON(e);if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];this.upgradeFilterContainer(a)}return JSON.stringify(t)}},t.prototype.upgradeFilterContainer=function(e){2!==e.howCreated||e.precedence||(e.precedence=0)},t.prototype.getVersion=function(){return e.ExplorationVersions.v2_2},t})()})(t=e.v2_2||(e.v2_2={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new c}var n=e.data.DataViewObjectDefinitions,a=e.data.services.DataViewObjectSerializer,o=jsCommon.JsonExtensions,s=e.visuals.plugins,l=e.visuals.slicerMode,u=e.data.SQExprBuilder;r.createVersionUpgrader=i;var c=(function(){function r(){}return r.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,a=i.visualContainers;n<a.length;n++){var s=a[n];if(s.config){var l=o.tryParseJSON(s.config);if(l&&l.singleVisual){var u=l.singleVisual,c=u.visualType||u.visualConfig.visualType;u.objects=this.upgradeVisualObjects(u.objects,c)}s.config=JSON.stringify(l)}}}},r.prototype.upgradeFilterCollection=function(e){},r.prototype.getVersion=function(){return t.ExplorationVersions.v2_3},r.prototype.upgradeVisualObjects=function(e,t){return t===s.slicer.name?this.upgradeSlicerObjects(e):e},r.prototype.upgradeSlicerObjects=function(t){var r="data",i="mode";t||(t={});var o=n.ensure(t,r,null),s=e.visuals.slicerCapabilities.objects[r].properties;return null==o.properties[i]&&(o.properties[i]=a.serializeObjectProperty(u.text(l.basic),s[i])),t},r})();r.VersionUpgrader=c})(r=t.v2_3||(t.v2_3={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(r){function i(){return new s}var n=e.data.DataViewObjectDefinitions,a=jsCommon.JsonExtensions,o=e.visuals.plugins;r.createVersionUpgrader=i;var s=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var s=o[n];if(s.config){var l=a.tryParseJSON(s.config);if(l&&l.singleVisual){var u=l.singleVisual,c=u.visualType||u.visualConfig.visualType;u.objects=this.upgradeVisualObjects(u.objects,c)}s.config=JSON.stringify(l)}}}},e.prototype.upgradeFilterCollection=function(e){},e.prototype.getVersion=function(){return t.ExplorationVersions.v2_5},e.prototype.upgradeVisualObjects=function(e,t){return t===o.gauge.name?this.upgradeGaugeTarget(e):e},e.prototype.upgradeGaugeTarget=function(e){var t="labels",r="target",i=["show","labelDisplayUnits","labelPrecision","color"];e||(e={});var a=n.getObjectDefinition(e,t,null);if(!a)return e;for(var o=n.ensure(e,r,null),s=0,l=i;s<l.length;s++){var u=l[s];null!=a.properties[u]&&(o.properties[u]=a.properties[u])}return e},e})();r.VersionUpgrader=s})(r=t.v2_5||(t.v2_5={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createSchemaItemActivationService=t;var r=(function(){function t(e){this.eventBridge=e}return t.prototype.setActiveItem=function(e){_.isEqual(this.activeItems,e)||(this.activeItems=e,this.raiseEvent())},t.prototype.clearActiveItem=function(){this.activeItems&&(this.activeItems=null,this.raiseEvent())},t.prototype.getActiveItem=function(){return this.activeItems},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.schemaItemActivationChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.SQExprConverter;!(function(e){function t(e,t){var r=n.asFieldPattern(t),o=i.toFieldExprEntityItemPattern(r),s=o.schema,l=o.entity,u=a.createActiveSchemaItem(s,l,r);e.setActiveItem(u)}e.setActiveSchemaItem=t})(r=t.schemaItemActivationUtils||(t.schemaItemActivationUtils={}));var a;!(function(e){function t(e,t,r){var n=i.getPropertyName(r),a=i.getHierarchyName(r)||r.hierarchyLevel&&r.hierarchyLevel.name,o=r.hierarchyLevel&&r.hierarchyLevel.level;return{schema:e,entity:t,property:n,hierarchy:a,hierarchyLevel:o}}e.createActiveSchemaItem=t})(a=t.ActiveSchemaItemFactory||(t.ActiveSchemaItemFactory={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new a(e)}var n=e.explore.schemaRewriterUtils;r.createSchemaChangeHandler=i;var a=(function(){function e(e){this.visualPluginService=e}return e.prototype.apply=function(e,r){var i=n.createSchemaChangeRewriters(r),a=new o(i);t.util.traverseExploration(e,a,this.visualPluginService)},e})(),o=(function(e){function r(r){var i=this,n=new t.util.VisualContainerStateRewriter(r),a=new t.util.ExplorationStateRewriter(r,n),o=new s(r);return i=e.call(this,a,o)||this}return __extends(r,e),r})(t.util.DefaultExplorationVisitor),s=(function(e){function t(t){var r=this;return r=e.call(this,t)||this}return __extends(t,e),t.prototype.visitSingleVisualConfig=function(e){e.conversionSourceContext=void 0},t})(t.util.VisualContainerRewriter);r.SchemaChangeVisualContainerRewriter=s})(r=t.services||(t.services={}));
})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){return new n(e,t,r)}e.createReportTileService=t;var r=10,i=2,n=(function(){function e(e,t,r){this.promiseFactory=e,this.explorationProxy=t,this.timeout=r,this.explorationJobsQueue=[],this.inProgressJobsQueue=[]}return e.prototype.getExploration=function(e,t){var r=this.promiseFactory.defer();return this.explorationJobsQueue.push({reportId:e,sectionId:t,deferred:r}),this.scheduleLoadExploration(),r.promise},e.prototype.scheduleLoadExploration=function(){var e=this;this.delayTimeout&&this.timeout.cancel(this.delayTimeout),this.delayTimeout=this.timeout((function(){e.loadExplorations()}),r)},e.prototype.loadExplorations=function(){var e=this,t=this.explorationJobsQueue;if(!_.isEmpty(t)){var r=t.shift();this.inProgressJobsQueue.push(r);var i=this.shouldRequestForAllSection(r.reportId,r.sectionId),n=r.reportId,a=i?null:r.sectionId;i&&(this.inProgressJobsQueue=this.inProgressJobsQueue.concat(_.remove(t,(function(e){return e.reportId===n}))));var o={id:n,sectionId:a,allowCache:!0};this.explorationProxy.get(o).then((function(t){e.processResult(o.id,o.sectionId,t)}),(function(){e.processResult(o.id,o.sectionId,null)})),this.loadExplorations()}},e.prototype.processResult=function(e,t,r){for(var i=[],n=0,a=this.inProgressJobsQueue;n<a.length;n++){var o=a[n];o.reportId!==e||_.isNumber(t)&&t!==o.sectionId?i.push(o):r?o.deferred.resolve(r):o.deferred.reject(r)}this.inProgressJobsQueue=i},e.prototype.shouldRequestForAllSection=function(e,t){if(null==t)return!0;var r=this.explorationJobsQueue;if(_.isEmpty(r))return!1;for(var n=0,a=0,o=r;a<o.length;a++){var s=o[a];if(s.reportId===e){if(null==s.sectionId)return!0;if(s.sectionId!==t&&n++,n>=i)return!0}}return!1},e})();e.ReportTileService=n})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){var n=r.createSelectableVisualContainer(e);t.selectElement(n,i)}function i(e,t){var r=o(t);_.contains(r,e)&&n(_.without(r,e),t)}function n(e,t){var i=_.map(e,(function(e){return r.createSelectableVisualContainer(e)}));t.selectElements(i)}function a(e,t){var r=o(t);return _.contains(r,e)}function o(e){return _.chain(e.getSelectedElements()).map((function(e){return e.visualContainer})).compact().value()}function s(e){return o(e).length>1}function l(e){var t=o(e);if(1===t.length)return t[0]}function u(e){var t=o(e);if(t.length>1)for(var r=t[0].config.singleVisual.visualType,i=1,n=t.length;i<n;i++)if(t[i].config.singleVisual.visualType!==r)return null;return t[0]}e.selectVisualContainer=t,e.unselectVisualContainer=i,e.selectVisualContainers=n,e.isVisualContainerSelected=a,e.getSelectedVisuals=o,e.hasMultipleVisualContainerSelection=s,e.getSelectedVisual=l,e.getDefaultSelectedVisualInSingleOrMultiCase=u})(t=e.selectionUtils||(e.selectionUtils={}));var r;!(function(e){function t(e){return n.createFromVisualContainer(e)}e.createSelectableVisualContainer=t})(r=e.SelectableItemFactory||(e.SelectableItemFactory={}));var i;!(function(e){function t(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(!n.equals(e[r],t[r]))return!1;return!0}e.equals=t})(i=e.SelectableUtils||(e.SelectableUtils={}));var n=(function(){function e(){}return Object.defineProperty(e.prototype,"id",{get:function(){if(this._visualContainer)return this._visualContainer.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualContainer",{get:function(){return this._visualContainer},enumerable:!0,configurable:!0}),e.createFromVisualContainer=function(t){var r=new e;return r._visualContainer=t,r},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.id===t.id&&e.visualContainer===t.visualContainer)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new a(e,t,r,i,n)}var i=e.common.contracts.TenantType,n=e.explore.util.VisualContainerUtils;t.createScriptVisualsService=r;var a=(function(){function e(e,t,r,i,n){this.services={visualPlugin:e,featureSwitchService:t,localizationService:r,userInfo:i,embedModeService:n}}return e.prototype.addScriptVisualId=function(e,t){var r=n.getVisualType(e);this.services.visualPlugin.isScriptVisual(r)&&e.id&&t.push(e.id)},e.prototype.showEnableScriptVisualDialogIfRequired=function(e,t,r){return!1},e.prototype.getScriptVisualErrorDetails=function(){var e,t=this,r=this.services.localizationService,i=this.services.featureSwitchService.featureSwitches;return r.ensureLocalization((function(){if(i.scriptVisualEnabled){var n=t.services.embedModeService.isAnonymousLiveEmbed();if(n)return void(i.scriptVisualAnonymousEmbeddingEnabled||(e=t.buildErrorDetails(r.get("RError_RVisualsNotSupportedInEmbedReports"))));var a=t.getUserInfoForErrorDetails();a&&a.isViralTenant?e=t.buildErrorDetails(r.get("RError_RVisualsNotSupportedForViralTenant")):i.rScriptVisualEnabled===!1?e=t.buildErrorDetails(r.get("RError_RVisualsDisabledByAdmin")):a&&!a.isPremiumUser&&(e=t.buildErrorDetails(r.get("RError_RVisualsIsProFeature")))}else e=t.buildErrorDetails(r.get("RError_RVisualsNotSupported"))})),e},e.prototype.overrideEmbeddedErrorDetails=function(e){var t=this.services.embedModeService.isAppTokenEmbed()||this.services.embedModeService.isSaasEmbed(),r=this.services&&this.services.localizationService;if(t&&e){var i=e,n=[{errorInfoKey:r.get("RError_RVisualsEmbeddedText"),errorInfoValue:r.get("RError_RVisualsErrorInEmbedReports")}];return i.message=r.get("RError_RVisualsEmbeddedText"),i.displayableErrorInfo=n,i.helpLink="",i}},e.prototype.shouldBlockScriptVisual=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.getUserInfoForErrorDetails(),r=this.services.embedModeService.isAnonymousLiveEmbed();return r?!e.scriptVisualAnonymousEmbeddingEnabled||!e.scriptVisualEnabled:!e.scriptVisualEnabled||t&&t.isViralTenant||!e.rScriptVisualEnabled||t&&!t.isPremiumUser},e.prototype.canLaunchExternalIDE=function(){return!1},e.prototype.launchExternalIDE=function(e){return null},e.prototype.openOptionsDialog=function(){return null},e.prototype.refreshRCustomVisuals=function(e){},e.prototype.buildErrorDetails=function(e){return{message:e,displayableErrorInfo:[],helpLink:"https://go.microsoft.com/fwlink/?linkid=829101",errorType:1}},e.prototype.getUserInfoForErrorDetails=function(){var e=this.services.userInfo;if(e&&!Array.isArray(e)){var t=e.userMetadata&&e.userMetadata.tenantMetadata&&e.userMetadata.tenantMetadata.tenantType===i.ViralTenant;return{isViralTenant:t,isPremiumUser:e.isPremiumUser}}},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new i(e)}var r=jsCommon.ArrayExtensions;e.createSelectionService=t;var i=(function(){function t(e){this.eventBridge=e,this.selectedElements=r.createWithId()}return t.prototype.selectElement=function(e,t){this.selectElements([e],t)},t.prototype.selectElements=function(t,r){if(!e.SelectableUtils.equals(t,this.selectedElements)){if(r||this.clearSelectionCore(!1),this.selectedElements.length){for(var i=this.selectedElements.length,n=0;n<i;n++)if(this.selectedElements[n]===t[0]){this.selectedElements.splice(n,1);break}i===this.selectedElements.length&&this.addISelectable(t)}else this.addISelectable(t);this.raiseEvent()}},t.prototype.clearSelection=function(){this.clearSelectionCore(!0)},t.prototype.addISelectable=function(e){this.selectedElements=r.extendWithId(this.selectedElements.concat(e))},t.prototype.clearSelectionCore=function(e){this.selectedElements=r.createWithId(),e&&this.raiseEvent()},t.prototype.getSelectedElements=function(){return this.selectedElements},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.selectionChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,a,o,s,l,u,c){return new n(e,t,r,i,a,o,s,l,u,c)}r.createEmbedService=i;var n=(function(){function r(e,t,r,i,n,a,o,s,l,u){this.locationService=e,this.promiseFactory=t,this.explorationSerializer=r,this.conceptualSchemaProxy=i,this.visualQueryGenerator=n,this.dataProxy=a,this.visualPlugin=o,this.displayNameService=s,this.filterGenerator=l,this.activeGroupId=u}return r.prototype.createEmbedUri=function(e){switch(e.embedType){case t.contracts.EmbedType.Interactive:return this.createInteractiveEmbedUri(e);default:return this.createStaticEmbedUri(e)}},r.prototype.createSharepointEmbedUri=function(t){var i=this.locationService.host(),n=r.protocol.concat(i),a=this.activeGroupId.activeGroupObjectId,o=r.sharePointEmbedHostPathEncodedReport+t;a&&a!==e.common.constants.myWorkspaceGroupId&&(o=o+r.sharePointEmbedHostPathGroupId+a);var s=jsCommon.Utility.urlCombine(n,o);return s},r.prototype.createInteractiveEmbedUri=function(t){var i=t.snapshotId,n=this.locationService.host(),a=r.protocol.concat(n),o=e.common.ClusterLocationHelper.getClusterIndexForClusterUri(),s="";o&&(s="&c="+o);var l,u,c=window.tenantId;if(c&&i){var p={k:i,t:c,c:o};l=btoa(JSON.stringify(p)),u=jsCommon.Utility.urlCombine(a,r.interactiveEmbedHostPathEncodedReport+encodeURIComponent(l))}else u=jsCommon.Utility.urlCombine(a,r.interactiveEmbedHostPath+encodeURIComponent(i)+s);return u},r.prototype.createStaticEmbedUri=function(e){var t={storageHost:e.resourceUri,cultureInfo:e.culture},i=btoa(JSON.stringify(t));if(!e.hostUri){var n=this.locationService.host().split(".");n&&n.length>0&&(e.hostUri=r.protocol.concat(n[0].concat(r.blobHostSuffix)))}var a=jsCommon.Utility.urlCombine(e.hostUri,r.embedHostPath+i);return a},r.prototype.createEmbedCode=function(e){var t=this.createEmbedUri(e);return'<iframe width="'+e.size.width+'" height="'+e.size.height+'" src="'+t+'" frameborder="0" allowFullScreen="true"></iframe>'},r.prototype.createEmbedReportResource=function(t,r,i){var n=this,a=this.promiseFactory.defer();return this.conceptualSchemaProxy.getWithWireContract(t.dataSources).then((function(o){var s=[],l=_.filter(t.sections,(function(e){return _.contains(r,e.id)}));if(l.length!==r.length)return void a.reject(null);for(var u=0,c=l;u<c.length;u++)for(var p=c[u],f=0,d=p.visualContainers;f<d.length;f++){var h=d[f];(!h.cachedData||i&&i.ignoreExistingCache)&&s.push(n.prepareVisualContainer(o.contract,t,p,h))}n.waitForAll(s).then((function(){var s=n.explorationSerializer.serializeExploration(t,{withData:!0});s.sections=_.filter(s.sections,(function(e){return _.contains(r,e.id)}));var l={conceptualSchemaResponse:o.data,exploration:s,clientVersion:e.build,reportSections:r,enableShareLink:i&&i.enableShareLink,dependencyVersions:{jquery:$.fn.jquery,"jquery-ui":$.ui.version,globalize:"0.1.1"}};a.resolve(l)}))})),a.promise},r.prototype.prepareVisualContainer=function(e,r,i,n){var a=this,o={config:n.config.singleVisual,dataSources:r.dataSources,schema:e,additionalFilters:this.filterGenerator.calculateVisualContainerFilter(r,i,n,e)},s=this.visualQueryGenerator.execute(o);return s?this.dataProxy.execute(s.options).then((function(r){var i=r&&r.dataViewSource?r.dataViewSource.data:void 0;n.cachedData=t.util.VisualContainerUtils.createCacheEntry(a.visualPlugin,a.displayNameService,i,s,e,n.config.singleVisual,a.filterGenerator.generateFilterMetadata(n.filters))})):this.promiseFactory.resolve(null)},r.prototype.waitForAll=function(e){var t=null;t=e.length>0?this.waitForBoth(this.promiseFactory.resolve(null),e[0]):this.promiseFactory.resolve(null);for(var r=1;r<e.length;r++)t=this.waitForBoth(t,e[r]);return t},r.prototype.waitForBoth=function(e,t){var r=this.promiseFactory.defer();return e.then((function(){return t.then((function(){return r.resolve(null)}))})),r.promise},r.embedHostPath="embed/snapshotEmbedHost.html?embedId=",r.interactiveEmbedHostPath="view?key=",r.interactiveEmbedHostPathEncodedReport="view?r=",r.sharePointEmbedHostPathEncodedReport="reportEmbed?reportId=",r.sharePointEmbedHostPathGroupId="&groupId=",r.blobHostSuffix=".blob.core.windows.net/",r.protocol="https://",r})();r.EmbedService=n})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new a(e,r,t,new o(e,i,n))}var i=e.visuals.TooltipManager,n=e.visualHost.visualPluginServiceHelpers.VisualPluginStorage;t.createExplorationVisualPluginService=r;var a=(function(){function t(t,r,i,a){var s=this;this.asyncFeatureSwitchService=t,this.resourceLoader=r,this.promiseFactory=i,this.resourceLoader=r,this.promiseFactory=i,this.trustedConvertibleVisualTypes=[],this.customConvertibleVisualTypes=[],this.storage=new n,this.initBuiltInPlugins=this.asyncFeatureSwitchService.getFeatureSwitches().then((function(r){a=a||new o(t),s.globalConvertibleVisualTypes=s.getConvertibleCoreVisualTypeNames(r);for(var i in e.visuals.plugins)s.storage.loadPlugin(i,a.getPlugin(i))}))}return t.prototype.getConvertibleCoreVisualTypeNames=function(t){var r=[e.visuals.plugins.barChart.name,e.visuals.plugins.columnChart.name,e.visuals.plugins.clusteredBarChart.name,e.visuals.plugins.clusteredColumnChart.name,e.visuals.plugins.hundredPercentStackedBarChart.name,e.visuals.plugins.hundredPercentStackedColumnChart.name,e.visuals.plugins.lineChart.name,e.visuals.plugins.areaChart.name,e.visuals.plugins.stackedAreaChart.name,e.visuals.plugins.lineStackedColumnComboChart.name,e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.ribbonChart.name];t&&t.dataDotChartEnabled&&r.push.apply(r,[e.visuals.plugins.dataDotClusteredColumnComboChart.name,e.visuals.plugins.dataDotStackedColumnComboChart.name]),r.push.apply(r,[e.visuals.plugins.waterfallChart.name,e.visuals.plugins.scatterChart.name,e.visuals.plugins.pieChart.name,e.visuals.plugins.donutChart.name]),t&&t.sunburstVisualEnabled&&r.push(e.visuals.plugins.sunburst.name),r.push.apply(r,[e.visuals.plugins.treemap.name,e.visuals.plugins.map.name,e.visuals.plugins.filledMap.name]),t&&t.shapeMapVisualEnabled&&r.push(e.visuals.plugins.shapeMap.name),r.push.apply(r,[e.visuals.plugins.funnel.name,e.visuals.plugins.gauge.name,e.visuals.plugins.card.name,e.visuals.plugins.multiRowCard.name,e.visuals.plugins.kpi.name,e.visuals.plugins.slicer.name]),t&&t.pivotTableVisualEnabled?(r.push(e.visuals.plugins.tableEx.name),r.push(e.visuals.plugins.pivotTable.name)):(r.push(e.visuals.plugins.table.name),r.push(e.visuals.plugins.matrix.name)),t&&t.scriptVisualEnabled&&t.scriptVisualAuthoringEnabled&&r.push(e.visuals.plugins.scriptVisual.name);var i=e.localStorageService.getData("DEVELOPER_MODE_ENABLED");return i&&r.push(e.visuals.plugins.debugVisual.name),r},t.prototype.getVisuals=function(){return this.storage.getLoadedPlugins()},t.prototype.getConvertibleVisuals=function(){for(var e=this,t=[],r=0,i=this.globalConvertibleVisualTypes;r<i.length;r++){var n=i[r];this.storage.hasPlugin(n)&&t.push(n)}for(var a=0,o=this.trustedConvertibleVisualTypes;a<o.length;a++){var s=o[a];this.storage.hasPlugin(s)&&t.push(s)}for(var l=0,u=this.customConvertibleVisualTypes;l<u.length;l++){var c=u[l];this.storage.hasPlugin(c)&&t.push(c)}return t.map((function(t){return e.storage.getLoadedPlugin(t)}))},t.prototype.ensureBuiltInPlugins=function(){return this.initBuiltInPlugins},t.prototype.ensureTrustedVisualPlugins=function(e){n.ensureTrustedVisualPlugins(this.storage,e);for(var t=0,r=e;t<r.length;t++){var i=r[t];this.addTrustedConvertibleVisualType(i.name)}},t.prototype.ensurePlugins=function(e,t){var r=this,i=[];if(e&&e.length)for(var n=function(e){if(0===e.type){var n=a.ensurePlugin(e,t).then((function(){return r.addCustomConvertibleVisualType(e.name)}));i.push(n)}},a=this,o=0,s=e;o<s.length;o++){var l=s[o];n(l)}return this.promiseFactory.allSettled(i)},t.prototype.ensurePlugin=function(e,t){return n.ensurePlugin(this.storage,this.promiseFactory,this.resourceLoader,e,t)},t.prototype.addTrustedConvertibleVisualType=function(e){this.trustedConvertibleVisualTypes.indexOf(e)<0&&this.trustedConvertibleVisualTypes.push(e)},t.prototype.addCustomConvertibleVisualType=function(e){this.customConvertibleVisualTypes.indexOf(e)<0&&this.customConvertibleVisualTypes.push(e)},t.prototype.capabilities=function(e){var t=this.getPlugin(e);return t?t.capabilities:void 0},t.prototype.removeAllCustomVisuals=function(){for(var e=0,t=this.customConvertibleVisualTypes;e<t.length;e++){var r=t[e];this.storage.unloadPlugin(r)}this.customConvertibleVisualTypes=[]},t.prototype.removePlugin=function(e){var t=this.getPlugin(e);t&&(this.storage.unloadPlugin(e),_.remove(this.customConvertibleVisualTypes,(function(t){return t===e})))},t.prototype.getTelemetryHostInformation=function(){return{name:"Exploration"}},t.prototype.isCustomVisual=function(t){return e.visualHost.utils.isCustomVisual(this.getPlugin(t),t)},t.prototype.isScriptVisual=function(t){return e.visualHost.utils.isScriptVisual(this.getPlugin(t))},t.prototype.isScriptVisualQueryable=function(){return e.visualHost.utils.isScriptVisualQueryable(this.asyncFeatureSwitchService.featureSwitches)},t.prototype.isLightWeightRenderingVisual=function(t){return e.visualHost.utils.isLightWeightRenderingVisual(this.getPlugin(t))},t.prototype.getInteractivityOptions=function(){return{overflow:"hidden",isVisualInteractive:!0}},t.prototype.loadPluginByNameIfAny=function(t){if(!this.getPlugin(t))return this.storage.hasPlugin(t)?void this.storage.loadPlugin(t):void(e.visuals.plugins[t]&&this.storage.loadPlugin(t,e.visuals.plugins[t]))},t.prototype.getPlugin=function(e){return this.storage.getLoadedPlugin(e)},t.prototype.getStorage=function(){return this.storage},t})();t.ExplorationVisualPluginService=a;var o=(function(){function t(e,t,r){this.featureSwitchService=e,this.mapControlFactory=t,this.visualSandbox=r;var n=this.featureSwitchService.featureSwitches;i.ShowTouchScreenOptimizedTooltips=n&&n.touchScreenOptimizedTooltips}return t.prototype.getPlugin=function(t){var r=this,i=this.featureSwitchService.featureSwitches,n=i&&i.forecastEnabled,a=!!i&&i.whatIf,o=i&&i.improvedMapLegend;e.visuals.SlicerHelper.SingleValueSlicer=a;var s=i&&i.axisControlImprovements,l=i&&i.responsiveCartesianChart,u=i&&i.responsiveSlicer,c=i&&i.customFontFamily,p=i&&i.customFontFamilyForDataLabel,f=i&&i.binnedLineSampling,d=i&&i.lineMarkersEnabled,h=i&&i.lineStylesEnabled,m=i&&i.touchScreenOptimizedTooltips;switch(t){case e.visuals.plugins.barChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.barChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:6,isScrollable:!0,animator:t.createWebColumnChartAnimator(),tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.card.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.card,(function(t){return t.module.createCard({isScrollable:!0,animator:new e.visuals.BaseAnimator,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.clusteredBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredBarChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:5,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.clusteredColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredColumnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:3,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.columnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.columnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:4,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.dataDotClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotClusteredColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:16,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createDataDotChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.dataDotStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotStackedColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:17,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createDataDotChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.donutChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.donutChart,(function(){return new e.visuals.DonutChart({animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,behavior:new e.visuals.DonutChartWebBehavior,customFontFamily:c,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.funnel.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.funnel,(function(){return new e.visuals.FunnelChart({animator:new e.visuals.WebFunnelAnimator,behavior:new e.visuals.FunnelWebBehavior,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,axisControlImprovements:s,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.gauge.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.gauge,(function(t){return t.module.createGauge({animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.hundredPercentStackedBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedBarChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:7,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.hundredPercentStackedColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedColumnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:8,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.lineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineChart,(function(t){var r=t.module;return r.createCartesianChart({chartType:0,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:new e.visuals.BaseAnimator,behavior:r.createCartesianChartBehavior([r.createLineChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,forecastEnabled:n,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:r.createCartesianViewModelAdapter({responsiveCartesianChart:l}),binnedLineSamplingSupported:f,lineMarkersEnabled:d,lineStylesEnabled:h})}),i);case e.visuals.plugins.areaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.areaChart,(function(t){var r=t.module;return r.createCartesianChart({chartType:1,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:new e.visuals.BaseAnimator,behavior:r.createCartesianChartBehavior([r.createLineChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:r.createCartesianViewModelAdapter({responsiveCartesianChart:l}),binnedLineSamplingSupported:f,lineMarkersEnabled:d,lineStylesEnabled:h})}),i);case e.visuals.plugins.stackedAreaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.stackedAreaChart,(function(t){var r=t.module;return r.createCartesianChart({chartType:2,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:new e.visuals.BaseAnimator,behavior:r.createCartesianChartBehavior([r.createLineChartWebBehavior()]),axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:r.createCartesianViewModelAdapter({responsiveCartesianChart:l}),binnedLineSamplingSupported:f,lineMarkersEnabled:d,lineStylesEnabled:h})}),i);case e.visuals.plugins.lineClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineClusteredColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:14,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createLineChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l}),lineMarkersEnabled:d,lineStylesEnabled:h})}),i);case e.visuals.plugins.lineStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineStackedColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:15,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior(),t.createLineChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l}),lineMarkersEnabled:d,lineStylesEnabled:h})}),i);case e.visuals.plugins.pieChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pieChart,(function(){return new e.visuals.DonutChart({sliceWidthRatio:0,animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,behavior:new e.visuals.DonutChartWebBehavior,customFontFamily:c,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.ribbonChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.ribbonChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:9,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:t.createWebColumnChartAnimator(),behavior:t.createCartesianChartBehavior([t.createColumnChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.scatterChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scatterChart,(function(t){var r=t.module;return r.createCartesianChart({chartType:10,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,animator:new e.visuals.BaseAnimator,behavior:r.createCartesianChartBehavior([r.createScatterChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,lassoSelectEnabled:i&&i.lassoSelectEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,scatterWithMatrixDV:i&&i.scatterWithMatrixDV,scatterWithDataVolume:i&&i.scatterWithDataVolume,viewModelAdapter:r.createCartesianViewModelAdapter({responsiveCartesianChart:l})})}),i);case e.visuals.plugins.treemap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.treemap,(function(e){var t=e.module;return new t.Treemap({animator:t.webAnimator(),isScrollable:!0,behavior:t.webBehavior(),tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,customFontFamily:c,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.accessibleTable.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.accessibleTable,(function(e){var t=e.module;return new t.AccessibleTable}),i);case e.visuals.plugins.sunburst.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.sunburst,(function(e){var t=e.module;return new t.Sunburst({isScrollable:!0,behavior:t.behavior(),customFontFamilyForDataLabel:p,touchScreenOptimizedTooltipsEnabled:m})}),i);case e.visuals.plugins.waterfallChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.waterfallChart,(function(e){
var t=e.module;return t.createCartesianChart({chartType:13,isScrollable:!0,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,behavior:t.createCartesianChartBehavior([t.createWaterfallChartWebBehavior()]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:s,responsiveCartesianChart:l,customFontFamily:c,customFontFamilyForDataLabel:p,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:l}),waterfallBreakdown:i&&i.waterfallBreakdown})}),i);case e.visuals.plugins.map.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.applyImprovedMapLegendMappings(e.visuals.plugins.map,o,!1),(function(){return new e.visuals.Map({behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,isLegendScrollable:!0,mapControlFactory:r.mapControlFactory,customFontFamily:c,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.filledMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.applyImprovedMapLegendMappings(e.visuals.plugins.filledMap,o,!0),(function(){return new e.visuals.Map({filledMap:!0,behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,filledMapDataLabelsEnabled:i&&i.filledMapDataLabelsEnabled,isLegendScrollable:!0,mapControlFactory:r.mapControlFactory,customFontFamily:c,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.shapeMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.shapeMap,(function(e){var t=e.module;return new t.ShapeMap({behavior:new t.ShapeMapBehavior,tooltipsEnabled:!0,touchScreenOptimizedTooltipsEnabled:m,customFontFamily:c,customFontFamilyForDataLabel:p})}),i);case e.visuals.plugins.slicer.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.slicer,(function(){return new e.visuals.Slicer({behavior:new e.visuals.SlicerWebBehavior,customFontFamilyForDataLabel:p,viewModelAdapter:new e.visuals.SlicerViewModelAdapter({responsiveSlicer:u})})}),i);case e.visuals.plugins.matrix.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.matrix,(function(){return new e.visuals.Matrix({})}),i);case e.visuals.plugins.table.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.table,(function(){return new e.visuals.Table({})}),i);case e.visuals.plugins.pivotTable.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pivotTable,(function(){return new e.visuals.PivotTable((void 0),i&&i.pivotTableDataBars)}),i);case e.visuals.plugins.tableEx.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.tableEx,(function(){return new e.visuals.TableEx((void 0),i&&i.pivotTableDataBars)}),i);case e.visuals.plugins.scriptVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scriptVisual,(function(e){return new e.module.ScriptVisual}),i);case e.visuals.plugins.debugVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.debugVisual,(function(){return new e.visuals.system.DebugVisual(r.visualSandbox)}),i);case e.visuals.plugins.textbox.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.textbox,(function(e){return e.module.createTextbox()}),i);default:return e.Prototype.inherit(e.visuals.plugins[t])}},t})();t.ExplorationVisualPluginProvider=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n,a,o,s,l,u,c,p){return new v(e,t,r,o,s,u,a,i,n,l,c,p)}function i(e,t,r){for(var i=[],n=[],a=u.getExpectedModelExtension(e,t),o=0,s=a.entities;o<s.length;o++)for(var l=s[o],c=0,p=l.measures;c<p.length;c++){var f=p[c];f.references.unrecognizedReferences&&(n.push(f),i.push({context:{schema:a.name,entity:l.name,property:f.name},expression:f.expression}))}if(_.any(i))for(var d=r.getMeasureReferences(e.modelExtensions,i),h=0;h<d.length;h++)n[h].references={unrecognizedReferences:d[h].unrecognizedReferences,measures:d[h].measures}}function n(e,t,r,i,n){var a=n.getMeasureReferences(e.modelExtensions,{context:{schema:t,entity:r,property:i.name},expression:i.expression});i.references={unrecognizedReferences:a.unrecognizedReferences,measures:a.measures}}function a(e,t,r,i){for(var n=[],a=[],o=0,s=e.entities;o<s.length;o++)for(var l=s[o],u=0,c=l.measures;u<c.length;u++){var p=c[u],f=_.findIndex(p.references.measures,t);f!==-1&&(a.push(p),n.push({context:{schema:e.name,entity:l.name,property:p.name},expression:p.expression}),r?p.references.measures[f]=r:p.references.measures.splice(f,1))}if(i)for(var d=i(n),h=0;h<d.length;h++)a[h].expression=d[h]}var o=e.data.dsr,s=e.explore.util,l=e.common.dialog.MessageDialogBuilder,u=e.explore.util.ModelExtensionUtils,c=e.explore.util.FormatUtils,p=e.explore.util.NameValidationError,f=e.data.contracts.SchemaChangeType.ObjectTypeEnum,d=e.data.contracts.primitiveTypeFromDataType,h={changes:[],isSchemaChangeListComplete:!0};t.createModelAuthoringService=r;var m;!(function(e){e.isNew="43dbc3e8-3a1c-4b6f-9923-b49ff7d6691c"})(m||(m={}));var v=(function(){function t(e,t,r,i,n,a,o,s,l,u,c,p){this.promiseFactory=e,this.telemetryService=t,this.modelChangeHandler=r,this.dataSourcesService=i,this.conceptualSchemaProxy=n,this.explorationSerializer=a,this.explorationNavigationService=o,o&&(this.services={cultureService:c,daxParserService:u,localizationService:l,promiseFactory:this.promiseFactory,telemetryService:this.telemetryService,modelAuthoringDialogService:new g(s,p)})}return t.prototype.apply=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.tryApply(t)];case 1:return e=r.sent(),[2]}}))}))},t.prototype.tryApply=function(e){var r=this;return this.lastChange=t.continueTaskUnconditionally(this.lastChange,(function(){return r.tryApplyCore(e)})),this.lastChange},t.prototype.tryApplyCore=function(r){return __awaiter(this,void 0,e.Promise,(function(){var e,i,n,a,o,s,l,u,c=this;return __generator(this,(function(p){switch(p.label){case 0:return this.services?(e=_.map(r.changes,(function(e){return c.getSchemaChangeExecutor(e)})),e=_.filter(e,(function(e){return e&&e.canExecute()})),e.length>0?(i=r.changes[0],n=e[0],this.logTelemetry(i),[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]):[3,7]):[3,7];case 1:a=p.sent(),o=this.explorationNavigationService.getCurrentExploration(),s=void 0,o.modelExtensions&&(s=this.explorationSerializer.serializeModelExtensions(o.modelExtensions)),this.onBeginModelChange(),l=h,p.label=2;case 2:return p.trys.push([2,4,5,7]),[4,n.execute(this.services,a,o)];case 3:return l=p.sent(),[2,!0];case 4:if(u=p.sent(),o.modelExtensions=s?this.explorationSerializer.deserializeModelExtensions(s):void 0,t.isHandledAuthoringError(u))return[2,!0];throw u;case 5:return[4,this.onEndModelChange(l)];case 6:return p.sent(),[7];case 7:return[2,!1]}}))}))},t.prototype.onBeginModelChange=function(){this.pendingModelChangeDefer=this.promiseFactory.defer(),this.modelChangeHandler.applyChange({change:this.pendingModelChangeDefer.promise})},t.prototype.onEndModelChange=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return this.pendingModelChangeDefer.resolve(t),this.pendingModelChangeDefer=null,e=this.promiseFactory.defer(),e.resolve(void 0),[4,e.promise];case 1:return r.sent(),[2]}}))}))},t.prototype.getSchemaChangeExecutor=function(e){return e.newMeasure?new b(e.newMeasure):e.newQuickCalc?new C(e.newQuickCalc):e.copyFormatting?new R(e.copyFormatting):e.propertyRename?new x(e.propertyRename):e.itemDelete?new S(e.itemDelete):e.updateCalculation?new w(e.updateCalculation):e.measureMove?new E(e.measureMove):e.setAnnotation?new F(e.setAnnotation):e.itemShowHide?new P(e.itemShowHide):e.setDataType?new V(e.setDataType):e.setFormatting?new D(e.setFormatting):e.toggleThousandsSeparator?new T(e.toggleThousandsSeparator):e.setDecimalPlaces?new N(e.setDecimalPlaces):e.setDateTimeFormatInfo?new M(e.setDateTimeFormatInfo):e.setCurrencyFormatInfo?new I(e.setCurrencyFormatInfo):void 0},t.prototype.logTelemetry=function(t){var r=Object.getOwnPropertyNames(t);this.telemetryService.logEvent(e.telemetry.EXModelChange,r[0])},t.createHandledAuthoringError=function(){var e=new Error;return e.suppressExceptionHandler=!0,e},t.isHandledAuthoringError=function(e){return e.suppressExceptionHandler},t.continueTaskUnconditionally=function(t,r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:if(!t)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t];case 2:return i.sent(),[3,4];case 3:return e=i.sent(),[3,4];case 4:return[4,r()];case 5:return[2,i.sent()]}}))}))},t})();t.ModelAuthoringService=v;var g=(function(){function t(e,t){this.modalDialogService=e,this.uiBlockingService=t}return t.prototype.showDialog=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:this.uiBlockingService.beginAllowModalDialogs(),r.label=1;case 1:return r.trys.push([1,,3,4]),e=new l(this.modalDialogService),[4,e.show("model authoring message",t)];case 2:return[2,r.sent()];case 3:return this.uiBlockingService.endAllowModalDialogs(),[7];case 4:return[2]}}))}))},t})(),y=(function(){function e(e){this.schemaChangeBase=e}return e.prototype.canExecute=function(){return!!this.schemaChangeBase.schema},e.prototype.showMessage=function(e,t,r){var i={okButtonText:"OK_ButtonText",titleText:t,messageText:r};return e.modelAuthoringDialogService.showDialog(i)},e})(),b=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var a,s,l,p,f,d,h,v,g;return __generator(this,(function(y){if(a=r.schema(o.DefaultSchemaName),!a||!a.capabilities.isExtendable)throw new Error("Attempting to extend a non-existent or non-extendable schema");return s=u.ensureEntityExists(n,this.schemaChange.schema,this.schemaChange.entity),l=e.explore.util.createNameValidator(r,t.localizationService),p=l.makeValidMeasureName(t.localizationService.get("NewMeasureName")),f={name:p,dataType:3,references:{unrecognizedReferences:!1,measures:[]},expression:"",hidden:!1},u.addMeasure(s,f),i(n,this.schemaChange.schema,t.daxParserService),d=new c(t.cultureService.getFormatInfo()),f.formatInformation=d.updateFormatUponDataTypeChange(f.dataType,f.formatInformation),h={schema:this.schemaChange.schema,entity:s.name,property:f.name,annotationName:m.isNew,value:"true"},v=F.setAnnotation(h,t,n),g={schema:this.schemaChange.schema,entity:this.schemaChange.entity,measureDefinition:{name:f.name,expression:f.expression}},[2,{changes:[{newMeasureCreated:g},v],isSchemaChangeListComplete:!1}]}))}))},r})(y),C=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a,o,l,c,p,f,d,h;return __generator(this,(function(m){switch(m.label){case 0:return e={newMeasure:{schema:this.schemaChange.schema,entity:this.schemaChange.entity}},n=new b(e.newMeasure),[4,n.execute(t,r,i)];case 1:return a=m.sent(),o=_.find(a.changes,(function(e){return e.newMeasureCreated})),l=s.createNameValidator(r,t.localizationService),c=l.makeValidMeasureName(this.schemaChange.name),p={updateCalculation:{schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:o.newMeasureCreated.measureDefinition.name,expression:this.schemaChange.expression,anonymizedExpression:"",newName:c}},f=new w(p.updateCalculation),[4,f.execute(t,r,i)];case 2:return m.sent(),d=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,c),d.measureTemplate={daxTemplateName:this.schemaChange.daxTemplateName,version:0},h={schema:this.schemaChange.schema,entity:this.schemaChange.entity,measureDefinition:{name:c,expression:this.schemaChange.expression}},[2,{changes:[{newMeasureCreated:h}],isSchemaChangeListComplete:!1}]}}))}))},r})(y),x=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var a,o,l;return __generator(this,(function(c){switch(c.label){case 0:return a=u.getExpectedMeasure(n,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.before),o=s.createNameValidator(r,t.localizationService),l=o.validateMeasureName(this.schemaChange.after,this.schemaChange.before),l.error===p.None?[3,2]:[4,this.showMessage(t,t.localizationService.get("RenameMeasureErrorTitle"),l.reason)];case 1:throw c.sent(),v.createHandledAuthoringError();case 2:return this.fixupUponMeasureRename(t.daxParserService,n),a.name=this.schemaChange.after,i(n,this.schemaChange.schema,t.daxParserService),a.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureEdited,a.measureTemplate.daxTemplateName),[2,{changes:[{propertyRename:this.schemaChange}],isSchemaChangeListComplete:!1}]}}))}))},r.prototype.fixupUponMeasureRename=function(e,t){var r=this,i={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.before},n={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.after},o=u.getExpectedModelExtension(t,this.schemaChange.schema);debug&&u.getExpectedMeasure(t,i.schema,i.entity,i.name),a(o,i,n,(function(i){return e.renameMeasureReferences(t.modelExtensions,i,r.schemaChange.before,r.schemaChange.after)}))},r})(y),S=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r,n;return __generator(this,(function(a){switch(a.label){case 0:return r=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),n=0,u.getAnnotationValue(r,m.isNew)?[3,2]:[4,this.showDeleteConfirmationDialog(t)];case 1:n=a.sent(),a.label=2;case 2:return 0===n?(u.removeMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),this.fixupMeasureReferences(u.getOptionalModelExtension(i,this.schemaChange.schema)),r.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureDeleted,r.measureTemplate.daxTemplateName),[2,{changes:[{itemDelete:this.schemaChange}],isSchemaChangeListComplete:!1}]):[2,h]}}))}))},r.prototype.showDeleteConfirmationDialog=function(e){var t={okButtonText:"ModalDialogButtonText_Delete",cancelButtonText:"ModalDialogButtonText_Cancel",titleText:"DeleteMeasurePromptTitle",messageText:e.localizationService.format("DeleteMeasurePrompt",[this.schemaChange.property])};return e.modelAuthoringDialogService.showDialog(t)},r.prototype.fixupMeasureReferences=function(e){if(e){var t={schema:this.schemaChange.schema,entity:this.schemaChange.entity,name:this.schemaChange.property};a(e,t,void 0)}},r})(y),w=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var a,o,s,l,c,p,d,h;return __generator(this,(function(v){switch(v.label){case 0:return a=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),a.expression=this.schemaChange.expression,a.formulaOverride=this.schemaChange.expressionOverride&&this.schemaChange.expressionOverride.formula,a.errorMessage=this.schemaChange.errorMessage,t.telemetryService.logEvent(e.telemetry.EXMeasures,this.schemaChange.anonymizedExpression||"","ReportModelOperationUpdateMeasure"),a.formulaOverride&&(o={expression:a.formulaOverride,formula:a.formulaOverride}),s={updateExpression:{schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:this.schemaChange.property,expression:this.schemaChange.expression,errorMessage:this.schemaChange.errorMessage,expressionOverride:o}},n(i,this.schemaChange.schema,this.schemaChange.entity,a,t.daxParserService),l=[s],this.schemaChange.newName===this.schemaChange.property?[3,2]:(c={propertyRename:{schema:this.schemaChange.schema,objectType:f.Measure,entity:this.schemaChange.entity,before:this.schemaChange.property,after:this.schemaChange.newName}},p=new x(c.propertyRename),[4,p.execute(t,r,i)]);case 1:d=v.sent(),l.push.apply(l,d.changes),v.label=2;case 2:return a.measureTemplate&&t.telemetryService.logEvent(e.telemetry.EXQuickCalcMeasureEdited,a.measureTemplate.daxTemplateName),h={schema:this.schemaChange.schema,entity:this.schemaChange.entity,property:this.schemaChange.newName,annotationName:m.isNew,value:null},l.push(F.setAnnotation(h,t,i)),[2,{changes:l,isSchemaChangeListComplete:!1}]}}))}))},r})(y),E=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,n){return __awaiter(this,void 0,e.Promise,(function(){var e,r,a;return __generator(this,(function(o){return e=u.getExpectedModelExtension(n,this.schemaChange.schema),r=u.getExpectedMeasure(n,this.schemaChange.schema,this.schemaChange.source,this.schemaChange.property),a=u.getOrCreateExtendingEntity(e,this.schemaChange.destination),this.fixupUponMeasureMove(t.daxParserService,n),u.removeMeasure(n,this.schemaChange.schema,this.schemaChange.source,this.schemaChange.property),u.addMeasure(a,r),i(n,this.schemaChange.schema,t.daxParserService),[2,{changes:[{measureMove:this.schemaChange}],isSchemaChangeListComplete:!1}]}))}))},r.prototype.fixupUponMeasureMove=function(e,t){var r=this,i=u.getExpectedModelExtension(t,this.schemaChange.schema),n={schema:this.schemaChange.schema,entity:this.schemaChange.source,name:this.schemaChange.property},o={schema:this.schemaChange.schema,entity:this.schemaChange.destination,name:this.schemaChange.property};debug&&u.getExpectedMeasure(t,n.schema,n.entity,n.name),a(i,n,o,(function(i){return e.renameMovedMeasureTableReference(t.modelExtensions,i,r.schemaChange.property,r.schemaChange.source,r.schemaChange.destination)}))},r})(y),F=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.setAnnotation=function(e,t,r){var i=u.getExpectedMeasure(r,e.schema,e.entity,e.property);return u.setAnnotation(i,e.annotationName,e.value),{setAnnotation:e}},r.prototype.execute=function(t,i,n){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){return e=r.setAnnotation(this.schemaChange,t,n),[2,{changes:[e],isSchemaChangeListComplete:!0}]}))}))},r})(y),P=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,t,r,n,a,o,s,e;return __generator(this,(function(l){if(this.schemaChange.property)e=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),e.hidden=this.schemaChange.makeHidden;else if(t=u.getOptionalModelExtension(i,this.schemaChange.schema))for(r=0,n=t.entities;r<n.length;r++)for(a=n[r],o=0,s=a.measures;o<s.length;o++)e=s[o],e.hidden=this.schemaChange.makeHidden;return[2,{changes:[{itemShowHide:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(y),V=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var r,n,a;return __generator(this,(function(o){return r=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),n=r.dataType,r.dataType=d(this.schemaChange.dataType),a=new c(t.cultureService.getFormatInfo()),r.formatInformation=a.updateFormatUponDataTypeChange(r.dataType,r.formatInformation),t.telemetryService.logEvent(e.telemetry.EXReportMeasureDataTypeChange,e.PrimitiveTypeStrings[n],e.PrimitiveTypeStrings[r.dataType]),[2,{changes:[{setDataType:this.schemaChange}],isSchemaChangeListComplete:!1}]}))}))},r})(y),D=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new c(t.cultureService.getFormatInfo()),e.formatInformation=r.changeFormat(e.dataType,e.formatInformation,this.schemaChange.format),[2,{changes:[{setFormatting:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(y),R=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a;return __generator(this,(function(o){switch(o.label){case 0:return this.schemaChange.sourceSchema?(e=u.getExpectedMeasure(i,this.schemaChange.sourceSchema,this.schemaChange.sourceEntity,this.schemaChange.sourceProperty),n={setFormatting:{schema:this.schemaChange.schema,entity:this.schemaChange.targetEntity,property:this.schemaChange.targetProperty,format:e.formatInformation.format}},a=new D(n.setFormatting),[4,a.execute(t,r,i)]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2,{changes:[{copyFormatting:this.schemaChange}],isSchemaChangeListComplete:!0}]}}))}))},r})(y),T=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new c(t.cultureService.getFormatInfo()),e.formatInformation=r.toggleThousandsSeparator(e.dataType,e.formatInformation),[2,{changes:[{toggleThousandsSeparator:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(y),N=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new c(t.cultureService.getFormatInfo()),e.formatInformation=r.setAccuracy(e.dataType,e.formatInformation,this.schemaChange.decimalPlaces),[2,{changes:[{setDecimalPlaces:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(y),M=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new c(t.cultureService.getFormatInfo()),e.formatInformation=r.setDateTimeFormat(e.dataType,e.formatInformation,this.schemaChange.formatType,this.schemaChange.dateTimeCustomFormatGroup,this.schemaChange.formatString),[2,{changes:[{setDateTimeFormatInfo:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(y),I=(function(t){function r(e){var r=t.call(this,e)||this;return r.schemaChange=e,r}return __extends(r,t),r.prototype.execute=function(t,r,i){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(n){return e=u.getExpectedMeasure(i,this.schemaChange.schema,this.schemaChange.entity,this.schemaChange.property),r=new c(t.cultureService.getFormatInfo()),e.formatInformation=r.setCurrencyFormat(e.dataType,e.formatInformation,this.schemaChange.formatType,this.schemaChange.lcid,this.schemaChange.displayName,this.schemaChange.currencySymbol,this.schemaChange.positivePattern,this.schemaChange.negativePattern),[2,{changes:[{setCurrencyFormatInfo:this.schemaChange}],isSchemaChangeListComplete:!0}]}))}))},r})(y)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getGroupingDesignState:function(e,t){return null}}}e.createGroupingDesignStateService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new s(e)}var n;!(function(e){e[e.None=0]="None",e[e.Basic=1]="Basic",e[e.Binning=2]="Binning",e[e.Clustering=3]="Clustering"})(n=r.GroupMode||(r.GroupMode={}));var a;!(function(e){e[e.Category=0]="Category",e[e.Number=1]="Number",e[e.DateTime=2]="DateTime"})(a=r.GroupDataType||(r.GroupDataType={}));var o;!(function(e){e[e.BySize=0]="BySize",e[e.ByCount=1]="ByCount"})(o=r.BinMode||(r.BinMode={})),r.createDisabledGroupAuthoringService=i;var s=(function(){function e(e){this.visual=new l,this.dialog=new u,this.telemetry=new c(e)}return e})(),l=(function(){function e(){}return e.prototype.canGroup=function(e,t,r){return!1},e.prototype.group=function(e,t,r,i,n){return null},e})(),u=(function(){function e(){}return e.prototype.showDialog=function(e){return null},e})(),c=(function(){function r(e){this.telemetryService=e}return r.prototype.logGroupActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinBySizeActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinByCountActionTelemetry=function(e,t,r,i,n,a){},r.prototype.logGroupsErrorTelemetry=function(e,t,r,i){},r.prototype.logGroupsDeleteTelemetry=function(e,t,r){},r.prototype.logGroupsUsageTelemetry=function(r,i,a,o,s,l){var u=this;r.then((function(r){var c=i.getConceptualProperty(r);if(c){var p=i.getTargetEntity().entity,f=t.utils.GroupUtils.getGroupMode(p,c,null);if(f!==n.None){var d=f===n.Binning?e.telemetry.GroupType.Bin:e.telemetry.GroupType.List;u.telemetryService.logEvent(e.telemetry.EXGroupsUsage,a,o,s,l,d)}}}))},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.canRedo=_.noopFalse,this.canUndo=_.noopFalse,this.undo=_.noop,this.redo=_.noop,this.clear=_.noop,this.getTopUndoFrame=_.noop,this.getReferences=function(){return[]},this.setHandler=_.noop}return e.prototype.register=function(e,t,r){return t()},e})();e.NoOpUndoRedoService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createUIBlockingService=t;var r=(function(){function e(e){this.promiseFactory=e}return e.prototype.waitTillUnblocked=function(){return this.promiseFactory.resolve()},e.prototype.beginBlockUI=function(){},e.prototype.endBlockUI=function(){},e.prototype.beginAllowModalDialogs=function(){},e.prototype.endAllowModalDialogs=function(){},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new o(e,t,r,i)}var i=jsCommon.CircularStack,n=30;t.createUndoRedoService=r;var a=(function(){function e(e){this.frames=e||[]}return e.prototype.addUndoFrame=function(e){this.frames.push(e)},e.prototype.rollbackFrame=function(){var t=_.map(this.frames,(function(e){return e.rollbackFrame()}));return new e(t)},e.prototype.getFrame=function(){return this.frames[0]},e.prototype.getReferences=function(){if(0!==this.frames.length)return 1===this.frames.length?this.frames[0].getReferences():Array.prototype.concat.apply([],_.map(this.frames,(function(e){return e.getReferences()})))},e})(),o=(function(){function r(e,t,r,a){this.registeredResourceReferences=a,this.currentTransaction=void 0,this.loggerService=r,this.rootScope=e,this.eventBridge=t,this.undoStack=new i(n),this.redoStack=new i(n),this.registeredResourceReferences.addReferenceSource(this)}return r.prototype.getReferences=function(){return this.addStackReferences(this.undoStack,this.addStackReferences(this.redoStack))},r.prototype.addStackReferences=function(e,t){for(var r=e.length;r-- >0;){var i=e.item(r).getReferences();_.isEmpty(i)||(t||(t=[]),t.push.apply(t,i))}return t},r.prototype.setHandler=function(e){this.handler=e,this.clear()},r.prototype.undo=function(){this.canUndo()&&this.rollbackTop(this.undoStack,this.redoStack)},r.prototype.redo=function(){this.canRedo()&&this.rollbackTop(this.redoStack,this.undoStack)},r.prototype.clear=function(){this.undoStack.clear(),this.redoStack.clear(),this.eventBridge.publishToChannel(t.events.undoRedoStackUpdated)},r.prototype.canRedo=function(){return this.redoStack.length>0},r.prototype.canUndo=function(){return this.undoStack.length>0},r.prototype.getTopUndoFrame=function(){var e=this.undoStack.peek();return e?e.getFrame():void 0},r.prototype.canMergeWithTopFrame=function(e){if(!e)return!1;if(this.canUndo()){var t=this.getTopUndoFrame();if(t&&void 0!==t.recurringActionInfo&&t.recurringActionInfo.equals(e))return!0}return!1},r.prototype.undoRedoPostProcessing=function(e){this.loggerService.addUserAction({message:e,type:"UndoRedo"}),this.rootScope.$evalAsync(_.noop)},r.prototype.register=function(e,t,r){var i=this,n=this.captureUndoFrame(this.handler);n.recurringActionInfo=r;var a=this.canMergeWithTopFrame(r),o=this.startTransaction(n),s=t(),l=s;return this.isIPromise(l)?l.then((function(){return i.endTransaction(o,a,e)}),(function(){return i.cancelTransaction(o)})):_.isBoolean(s)&&!s?this.cancelTransaction(o):this.endTransaction(o,a,e),this.undoRedoPostProcessing(e),s},r.prototype.rollbackTop=function(r,i){var n=this;this.rootScope.$evalAsync((function(){var a=r.pop(),o=a.rollbackFrame(),s=n.validTransactionCheck(o);s&&(i.push(o),n.rootScope.$emit(e.common.constants.onReportChangedEventName,!0),n.eventBridge.publishToChannel(t.events.undoRedoStackUpdated))}))},r.prototype.isIPromise=function(e){return e&&e.finally},r.prototype.startTransaction=function(e){var t=new a;return this.currentTransaction||(this.currentTransaction=t,this.currentTransaction.addUndoFrame(e)),this.currentTransaction},r.prototype.endTransaction=function(r,i,n){if(!i){this.redoStack.clear();var a=this.validTransactionCheck(this.currentTransaction);a&&this.undoStack.push(this.currentTransaction)}this.currentTransaction=void 0,this.rootScope.$emit(e.common.constants.onReportChangedEventName,!0,n),this.eventBridge.publishToChannel(t.events.undoRedoStackUpdated)},r.prototype.cancelTransaction=function(e){this.currentTransaction=void 0},r.prototype.captureUndoFrame=function(e){return new s(e)},r.prototype.validTransactionCheck=function(e){return!!e},r})(),s=(function(){function e(e,t){this.handler=e,this.snapshot=this.handler.takeSnapshot(t)}return e.prototype.rollbackFrame=function(){var t=new e(this.handler,this.snapshot);return this.handler.rollback(this.snapshot),t},e.prototype.getReferences=function(){return this.snapshot.getReferences&&this.snapshot.getReferences()},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("Explore/services/columnPropertiesAuthoring",(function(e){function t(e,t){var r=[];if(t.columnProperties)for(var i=0,n=e;i<n.length;i++){var a=n[i],o=t.query.defn.selectNameOf(a),s=t.columnProperties[o];s&&r.push({originalExpr:a,columnProperty:s})}return r}function r(e,t,r,i){var n=_.find(i,(function(t){return t.originalExpr===e}));if(n){var a=r.query.defn.selectNameOf(t);r.columnProperties[a]||(r.columnProperties[a]=n.columnProperty)}}return{getColumnPropertiesForExprs:t,applyColumnPropertiesByExpr:r}}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new F(e,t,r,i)}var n=e.data.DataViewObjectDefinitions,a=e.data.DataViewObjectDescriptors,o=e.data.DataViewRoleWildcard,s=e.explore.util.DrillUtils,l=e.data.FieldExprPattern,u=e.visuals.GradientUtils,c=t.util.HierarchyUtils,p=jsCommon.JsonComparer,f=e.data.QueryProjectionCollection,d=e.data.QueryProjectionsByRole,h=e.data.ScopeIdentityExtractor,m=e.data.Selector,v=e.data.SemanticQuery,g=t.contracts.SingleVisualConfig,y=e.data.SQExpr,b=e.data.SQExprBuilder,C=e.data.SQExprConverter,x=e.explore.utils.SQExprToRoleDictionary,S=e.data.SQExprUtils,w=e.data.SQHierarchyExprUtils,E=t.contracts.VisualQuery;
r.createVisualAuthoringCore=i;var F=(function(){function r(e,t,r,i){this.visualPluginService=e,this.geoTaggingService=t,this.aggrOps=r,this.featureSwitchService=i}return r.prototype.create=function(t){var r=this.visualPluginService.capabilities(t.visualType),i=e.requireSync("Explore/services/visualCapabilitiesHelper").create(r,this.geoTaggingService);if(i){var n=t.query||new E(v.create(),{}),a={visualType:t.visualType,query:n};for(var o in a.query.projections)this.ensureDependentObjectDefn(i.objectDescs,o,a);if(_.isEmpty(t.expr)||this.tryAdd(i,a,t))return{singleVisual:a}}},r.prototype.add=function(t,i){var n=i.singleVisual;if(!n)return!1;var a=this.visualPluginService.capabilities(n.visualType),o=e.requireSync("Explore/services/visualCapabilitiesHelper").create(a,this.geoTaggingService);return!!o&&(n.query||(n.query=new E(v.create(),{})),!!this.tryAdd(o,n,t)&&(r.clearConversionSourceContext(n),!0))},r.prototype.remove=function(e,t){var i=t.singleVisual;return!!i&&(!!this.tryRemove(i.query,i.columnProperties,e)&&(r.clearConversionSourceContext(i),!0))},r.prototype.replace=function(e,t){var i=t.singleVisual;if(!i)return!1;if(e.sourceRole===e.targetRole&&!e.replacementExpressions)return!!i.query.moveProjection(e.targetRole,e.sourceIndex,e.targetIndex,e.sourceCount)&&(r.clearConversionSourceContext(i),!0);for(var n=[],a=0;a<e.sourceCount;a++)if(n[a]=i.query.tryGetExpr(e.sourceRole,e.sourceIndex+a),!n[a])return!1;return this.replaceProjectionCore(t,n,e.sourceRole,e.targetRole,e.sourceIndex,e.targetIndex,e.replacementExpressions,e.schema,e.allowPartialReplace)},r.prototype.convert=function(t){var r=t.source;if(!r||r.visualType===t.target)return!1;var i=r.conversionSourceContext;i||(i=r.conversionSourceContext=this.createConversionSourceContext(r.query,r.visualType));var n=this.visualPluginService.capabilities(i.visualType),a=this.visualPluginService.capabilities(t.target);if(!n||!a||_.isEmpty(a.dataRoles))return!1;if(p.equals(n,a)){var o=this.visualPluginService.capabilities(r.visualType);return this.convertRoleWildCardProperties(o,a,r.objects),r.query=i.query,r.visualType=t.target,!0}var l=t.schema,u=this.convertDrillableRoles(i.query,n,a,l),c=u.query,f=s.getDrillableRoles(a),h=i.query.getUniqueQueryRefs();h=_.difference(h,u.drillableRoleProjectionQueryRefs);var m=i.query.defn.select(),v=_.map(h,(function(e){return m.withName(e).expr})),g=e.requireSync("Explore/services/visualCapabilitiesHelper").create(a,this.geoTaggingService),y=e.requireSync("Explore/services/visualCapabilitiesHelper").create(n,this.geoTaggingService);g.orderByRolePreferences(l,v);var b=d.clone(c.projections),C=this.getExpressionRoleMappings(r.query,v),x=this.getConversionExprRoleList(C,y,g,l,b,f);if(_.isEmpty(x)&&_.isEmpty(c.projections))return!1;for(var S=0,w=x;S<w.length;S++){var E=w[S];c.add(E.expr,E.roleName),this.ensureDependentObjectDefn(g.objectDescs,E.roleName,r)}var F,P,V=s.getDrillableRoles(this.visualPluginService.capabilities(r.visualType));_.isEmpty(V)?(F=s.getDrillableRoles(n),P=i.query):(F=V,P=r.query);for(var D=0,R=f;D<R.length;D++){var T=R[D];if(c.projections[T]){c.ensureActiveItems(T);for(var N=0,M=F;N<M.length;N++){var I=M[N];P.projections[I]&&(c.projections[T].activeProjectionRefs=P.projections[I].activeProjectionRefs)}}}return this.updateTargetShowAllInfo(i,c,g),c.removeUnusedOrderBy(),this.convertRoleWildCardProperties(n,a,r.objects),this.upgradePivotTableProperties(r.objects,r.visualType,t.target),r.query=c,r.visualType=t.target,!0},r.prototype.convertRoleWildCardProperties=function(t,r,i){if(!_.isEmpty(i)){var n=_.chain(t.dataRoles).filter((function(t){return t.kind!==e.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value(),a=_.chain(r.dataRoles).filter((function(t){return t.kind!==e.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value();if(!_.isEmpty(n)&&!_.isEmpty(a))for(var s in i){var l=i[s];if(!_.isEmpty(l))for(var u=0,c=l;u<c.length;u++){var p=c[u],f=p.selector;if(f&&!_.isEmpty(f.data))for(var d=0,h=f.data.length;d<h;d++){var v=f.data[d];m.isRoleWildcard(v)&&_.isEqual(_.sortBy(v.roles),_.sortBy(n))&&(f.data[d]=o.fromRoles(a))}}}}},r.prototype.upgradePivotTableProperties=function(e,t,r){"matrix"!==t&&"table"!==t||"pivotTable"!==r&&"tableEx"!==r||(n.moveProperty(e,"general",void 0,"textSize","grid"),n.moveProperty(e,"general",void 0,"autoSizeColumnWidth","columnHeaders")),"matrix"===t&&"pivotTable"===r&&(n.moveProperty(e,"general",void 0,"columnSubtotals","subTotals"),n.moveProperty(e,"general",void 0,"rowSubtotals","subTotals")),"table"===t&&"tableEx"===r&&n.moveProperty(e,"general",void 0,"totals","total")},r.prototype.setAggregate=function(e,t){var i=t.singleVisual.query.setAggregate(e.role,e.index,e.newAggregate,e.schema);return!!i&&(r.clearConversionSourceContext(t.singleVisual),!0)},r.prototype.removeAggregate=function(e,t){var i=t.singleVisual.query.removeAggregate(e.role,e.index,e.schema);return!!i&&(r.clearConversionSourceContext(t.singleVisual),!0)},r.prototype.setPercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.setPercentOfGrandTotal(e.role,e.index,e.schema)&&(r.clearConversionSourceContext(t.singleVisual),!0)},r.prototype.removePercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.removePercentOfGrandTotal(e.role,e.index,e.schema)&&(r.clearConversionSourceContext(t.singleVisual),!0)},r.prototype.setPercentOfRoleTotal=function(e,t){return!!t.singleVisual.query.setPercentOfRoleTotal(e.roleRefs,e.role,e.index,e.schema)&&(r.clearConversionSourceContext(t.singleVisual),!0)},r.prototype.removePercentOfRoleTotal=function(e,t){return!!t.singleVisual.query.removePercentOfRoleTotal(e.role,e.index,e.schema)&&(r.clearConversionSourceContext(t.singleVisual),!0)},r.prototype.toggleShowAll=function(e,t){t.singleVisual.query.toggleShowAll(e),r.clearConversionSourceContext(t.singleVisual)},r.prototype.changeActiveProjection=function(e,t,i){var n=t.query.projections[e];if(n){var a=n.all(),o=_.findIndex(a,(function(e){return!_.isEmpty(n.activeProjectionRefs)&&e.queryRef===n.activeProjectionRefs[n.activeProjectionRefs.length-1]}));if(!(o<0)){r.clearConversionSourceContext(t);var s=1!==i?o+1:o-1,l=n.all()[s],u=l&&l.queryRef,c=2===i||1===i&&n.activeProjectionRefs.length>1;if(u){if(c)return n.activeProjectionRefs=_.map(n.all(),(function(e){return e.queryRef})),n.activeProjectionRefs.splice(s+1,n.activeProjectionRefs.length-(s+1)),n.activeProjectionRefs;if(!_.any(n.activeProjectionRefs,(function(e){return u===e})))return n.activeProjectionRefs=[u],n.activeProjectionRefs}}}},r.prototype.addDrillFilter=function(e,t,r,i,n){this.addFilters(e,t,r,i,n,2,!0)},r.prototype.addDrillToDetailsFilter=function(e,t,r,i,n){this.addFilters(e,t,r,i,n,0,!1)},Object.defineProperty(r.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),r.prototype.addFilters=function(r,i,n,a,o,s,l){if(i&&n&&!_.isEmpty(a)&&o)for(var u=function(a){for(var u=n.defn.select().withName(a).expr,c=o.expr,p=h.getInExpr(c),f=[],d=[],m=_.first(p.values),v=u.getKeyColumns(r),g=0;g<p.args.length;g++){var C=p.args[g];C&&m&&S.indexOfExpr(v,C)!==-1&&(f.push(C),d.push(m[g]))}if(!_.isEmpty(f)&&!_.isEmpty(d)){var x=e.DataViewScopeIdentity.filterFromIdentity([{kind:1,expr:b.inValues(f,[d]),key:o.key}]),w=_.filter(i,(function(e){return y.equals(u,e.expression)})),E=void 0;if(l&&(E=_.find(w,(function(e){return e.howCreated===s}))),E=E||_.find(w,(function(e){return!e.filter&&2!==e.howCreated})))E.filter=x,E.howCreated=s,E.precedence=0;else{var F={name:null,expression:u,filter:x,type:t.contracts.FilterType.Categorical,howCreated:s,precedence:0};i.push(F)}}},c=0,p=a;c<p.length;c++){var f=p[c];u(f)}},r.prototype.removeDrillFilter=function(e,t){if(e){for(var r,i=0,n=e.length;i<n;i++){var a=e[i];if(2===a.howCreated&&y.equals(t,a.expression)){r=i;break}}void 0!==r&&e.splice(r,1)}},r.prototype.replaceProjectionCore=function(t,i,o,s,l,u,c,p,f){var d=t.singleVisual;if(!d||!d.query)return!1;for(var h=g.clone(d),m=h.query.defn.orderBy(),v=c||i,y=e.requireSync("Explore/services/columnPropertiesAuthoring"),b=y.getColumnPropertiesForExprs(v,h),C=i.length,x=0;x<C;x++)if(!this.tryRemove(h.query,h.columnProperties,{role:o,index:l}))return!1;m.length>0&&h.query.orderBy(m);var S=this.visualPluginService.capabilities(d.visualType),w=e.requireSync("Explore/services/visualCapabilitiesHelper").create(S,this.geoTaggingService);if(!w)return!1;var E=w.roles.withName(s);if(!E)return!1;for(var x=0;x<v.length;x++){var F=v[x];v[x]=this.aggregateIfNecessary(v[x],E,p);var P={expr:v[x],schema:p,targetRole:s,targetIndex:u+x};if(!this.tryAdd(w,h,P)){if(x>0&&f)break;return!1}if(d.query.projections[o].showAll){var V=v[x].getMetadata(p);this.isShowAllRole(E.kind)&&V&&1!==V.kind&&(h.query.projections[s].showAll=!0)}y.applyColumnPropertiesByExpr(F,v[x],h,b)}if(t.singleVisual=h,r.clearConversionSourceContext(t.singleVisual),t.singleVisual.objects){var D=a.findFilterOutput(w.objectDescs);D&&n.deleteProperty(t.singleVisual.objects,D.objectName,null,D.propertyName)}return!0},r.prototype.aggregateIfNecessary=function(t,r,i){var n=l.getAggregate(t);return null!=n||r.kind!==e.VisualDataRoleKind.Measure||S.discourageAggregation(t,i)?r.kind===e.VisualDataRoleKind.Grouping?b.removeAggregate(t):t:this.aggrOps.createExprWithAggregate(t,i,!0,r.requiredTypes)},r.clearConversionSourceContext=function(e){e.conversionSourceContext=null},r.prototype.getConversionExprRoleList=function(e,t,r,i,n,a){var o=this,s=this.getCompatRolesForExprs(e,t,r,i,!1,n,a);if(_.isEmpty(s)){var l=_.map(e,(function(e){var t=e.expr;return{expr:S.isMeasure(t)?t:o.aggrOps.createExprWithAggregate(t,i,!0,null)}}));s=this.getCompatRolesForExprs(l,t,r,i,!0,n,a)}if(_.isEmpty(s)){var u=_.map(e,(function(e){var t=e.expr;return{expr:S.isMeasure(t)?b.removeAggregate(t):t}}));s=this.getCompatRolesForExprs(u,t,r,i,!0,n,a)}return s},r.prototype.getCompatRolesForExprs=function(e,t,r,i,n,a,o){for(var s=[],l=a?a:{},u=new x(c.hierarchyLevelComparer),p=0,f=e;p<f.length;p++){var d=f[p],h=this.getTargetRoleForConversion(d,t,r),m=r.findCompatibleRole({queryProjections:l,schema:i,expr:d.expr,targetRole:h,preferDrillableRoles:!1,roleToExprMap:u,useStrict:!0});if(m){this.updateProjections(l,m.name,o);var v=r.getNumberRangesForRoles(l),g=v[m.name];if(this.shouldUseVariation(d.expr,i,m.name,o,g)){var y=w.getSourceVariationExpr(d.expr);return s.push({expr:y,roleName:m.name}),s}if(s.push({expr:d.expr,roleName:m.name}),n)return s}}return s},r.prototype.shouldUseVariation=function(e,t,r,i,n){if(!_.contains(i,r)&&n&&1===n.max){var a=C.asFieldPattern(e,t);if(a&&a.columnHierarchyLevelVariation)return!0}return!1},r.prototype.getExpressionRoleMappings=function(e,t){return _.map(t,(function(t){return{expr:t,roleName:e.getRoleNameForExpr(t)}}))},r.prototype.getTargetRoleForConversion=function(e,t,r){var i=t.roles.withName(e.roleName),n=r.roles.withName(e.roleName);if(i&&n){var a=this.getDataViewMappingConditions(t.capabilities),o=this.getDataViewMappingConditions(r.capabilities),s=e.roleName,l=a&&o&&_.isEqual(a[s],o[s])||!a&&!o;return!r.hasPreferredTypes()&&l&&_.isEqual(i.kind,n.kind)?s:void 0}},r.prototype.getDataViewMappingConditions=function(e){var t=e.dataViewMappings&&e.dataViewMappings[0];return t&&t.conditions},r.prototype.updateProjections=function(e,t,r){var i={queryRef:t},n=d.getRole(e,t);n||(e[t]=n=new f([]));var a=n.all();a.push(i),_.contains(r,t)&&n.addActiveQueryReference(a[0].queryRef)},r.prototype.createConversionSourceContext=function(e,t){return{query:e,visualType:t}},r.prototype.convertDrillableRoles=function(e,t,r,i){var n=new E(e.defn.select([]),{}),a=s.getDrillableRoles(t);if(_.isEmpty(a))return{query:n,drillableRoleProjectionQueryRefs:[]};var o=this.populateQueryForDrillableProjections(r,e,i,a,n);return{query:n,drillableRoleProjectionQueryRefs:o}},r.prototype.populateQueryForDrillableProjections=function(e,t,r,i,n){for(var a=s.getDrillableRoles(e),o=t.projections,l=t.defn.select(),u=[],c=0,p=i;c<p.length;c++){var f=p[c],d=o[f];if(d){var h=_.map(d.all(),(function(e){return e.queryRef})),m=_.map(h,(function(e){return l.withName(e)}));if(this.convertDrillableExprs(m,r,e,n),u=_.union(u,h),_.isEmpty(a))break}}return n.ensureDrillableRoles(a),u},r.prototype.convertDrillableExprs=function(t,r,i,n){for(var a=e.requireSync("Explore/services/visualCapabilitiesHelper").create(i,this.geoTaggingService),o=a.getNumberRangesForRoles(n),l=s.getDrillableRoles(i),u=_.isEmpty(l),p=new x(c.hierarchyLevelComparer),f=0,d=t;f<d.length;f++){var h=d[f],m=h.expr,v=h.name,g=a.findCompatibleRole({queryProjections:n.projections,schema:r,expr:m,preferDrillableRoles:!0,roleToExprMap:p,useStrict:!0});if(g){var y=g.name,b=o[y];if(this.shouldUseVariation(h.expr,r,g.name,l,b)){var C=w.getSourceVariationExpr(h.expr);return void n.add(C,y,{exprName:v})}if(n.add(m,y,{exprName:v}),u){var S=n.projections[y].all().length;if(b&&b.max&&b.max<=S)return}}}},r.prototype.tryRemove=function(e,t,r){var i=r;if(i&&i.expr){if(_.isArray(i.expr)){for(var n=!1,a=0,o=i.expr;a<o.length;a++){var s=o[a];n=e.removeExpr(s,!!i.ignoreAggregates)||n}return n}return e.removeExpr(i.expr,!!i.ignoreAggregates)}var l=r;if(l&&l.role&&$.isNumeric(l.index)){var u=e.getQueryRef(l.role,l.index),c=e.removeProjection(l.role,l.index);return u&&!e.isUsed(u)&&t&&t[u]&&delete t[u],c}return!1},r.prototype.tryAdd=function(e,t,r){var i=r.expr,n=new x(c.hierarchyLevelComparer),a=!1,o=r.targetIndex;if(_.isArray(i))for(var l=0,u=i;l<u.length;l++){var p=u[l];a=null!=this.tryAddQuery(e,t,r,p,o,n)||a,null!=o&&o++}else if(null==this.tryAddQuery(e,t,r,i,o,n))return!1;var f=s.getDrillableRoles(e.capabilities);return t.query.ensureDrillableRoles(f),!_.isArray(i)||a},r.prototype.tryAddQuery=function(e,t,r,i,n,a){var o=e.findCompatibleRole({queryProjections:t.query.projections,schema:r.schema,expr:i,preferDrillableRoles:!1,roleToExprMap:a,targetRole:r.targetRole});if(o){var s=o.name,l=t.query.add(i,s,{index:n});return this.ensureDependentObjectDefn(e.objectDescs,s,t),a.add(i,o),l}},r.prototype.ensureDependentObjectDefn=function(e,t,r){if(e)for(var i in e){var a=e[i];for(var o in a.properties){var s=a.properties[o];if(s.rule&&s.rule.inputRole===t){var l=r.objects;l||(l=r.objects={});var u=n.ensure(l,i,null);u.properties[o]||(u.properties[o]=this.createDefaultDefinition(s.type))}}}},r.prototype.createDefaultDefinition=function(e){if(e.fillRule){var t=u.getDefaultFillRuleDefinition();return t}},r.prototype.getSourceShowAllInfo=function(e){for(var t={},r=0,i=_.values(e);r<i.length;r++)for(var n=i[r],a=n.showAll,o=0,s=n.all();o<s.length;o++){var l=s[o];t[l.queryRef]=a}return t},r.prototype.updateTargetShowAllInfo=function(e,t,r){for(var i=this.getSourceShowAllInfo(e.query.projections),n=0,a=_.keys(t.projections);n<a.length;n++){var o=a[n],s=r.roles.withName(o).kind;if(this.isShowAllRole(s))for(var l=0,u=t.projections[o].all();l<u.length;l++){var c=u[l],p=i[c.queryRef];p&&(t.projections[o].showAll=p)}}},r.prototype.isShowAllRole=function(t){return t===e.VisualDataRoleKind.Grouping||t===e.VisualDataRoleKind.GroupingOrMeasure},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new c(e,t,r)}var n=e.DataViewMapping,a=e.data.QueryProjectionsByRole,o=e.data.SQExpr,s=e.data.SQExprUtils,l=e.explore.util.VisualContainerUtils,u=t.contracts.VisualQuery;r.createSortService=i;var c=(function(){function r(e,t,r){this.displayNameService=e,this.featureSwitches=t,this.visualPluginService=r}return r.prototype.getSortableFields=function(t){var r=t.visualType,i=t.query,n=i.projections,a=t.schema,o=this.visualPluginService.capabilities(r);if(o&&this.isVisualSortable(o)){if(o.sorting){var s=this.visualPluginService.getPlugin(r);if(s&&s.getSortableRoles){var l={mappings:o.dataViewMappings,queryDefn:i.defn,queryProjections:n,schema:a,objectDescriptors:o.objects,objectDefinitions:t.objectDefns,roles:o.dataRoles},u=e.data.compileDataView(l),c={dataViewMappings:u};return this.getSortableFieldsFromAllowedRoles(n,i,a,o,s.getSortableRoles(c),t.columnProperties)}return this.getDefaultSortableFields(n,i,a,o,t.columnProperties)}return this.getDefaultSortableFields(n,i,a,o,t.columnProperties)}return[]},r.prototype.addSort=function(e,t){e&&e.defn&&t&&(e.defn=e.defn.orderBy(t))},r.prototype.removeSort=function(e,t){if(e&&e.defn&&t)for(var r=0,i=t;r<i.length;r++){var n=i[r];e.defn=e.defn.removeOrderBy(n.expr)}},r.prototype.resetSort=function(e){if(e&&e.defn){var t=e.defn.orderBy();this.removeSort(e,t)}},r.prototype.applyImplicitSort=function(e,t){if(!t)return e;var r=e.defn;if(!r)return e;for(var i=t.clauses,n=r.select(),o=[],s=0,l=i;s<l.length;s++){var c=l[s],p=a.getRole(e.projections,c.role);if(p){var f=c.direction;o.push.apply(o,_.map(p.all(),(function(e){return{expr:n.withName(e.queryRef).expr,direction:f}})))}}return new u(r.orderBy(o),e.projections)},r.prototype.ensureValidSorting=function(e){var t=_.chain(this.getSortableFields(e)).map((function(e){return e.exprs})).flatten().map((function(e){return e.name})).value(),r=e.query,i=r.defn;if(!i)return r;for(var n=i.orderBy(),a=!1,o=n.length-1;o>=0;o--){var s=i.selectNameOf(n[o].expr);_.contains(t,s)||(n.splice(o,1),a=!0)}return a?new u(i.orderBy(n),r.projections):r},r.prototype.isVisualSortable=function(t){return _.some(t.dataRoles,(function(t){return t.kind!==e.VisualDataRoleKind.Measure}))},r.prototype.getDefaultSortableFields=function(e,t,r,i,n){var a=this.getSortableFieldsFromProjections(e,t,r,i,n);return a},r.prototype.getSortableFieldsFromAllowedRoles=function(e,t,r,i,n,a){if(!n||0===n.length)return[];var o=this.getSortableFieldsFromProjections(e,t,r,i,a,n);return o},r.prototype.findSortExpressionIndex=function(e,r){if(e&&r)for(var i=0,n=r.length;i<n;i++)if(o.equals(e,r[i].expr))return i;return t.constants.invalidSortExprIndex},r.prototype.getSortableFieldsFromProjections=function(r,i,o,u,c,p){var f=[],d=i.defn.select(),h=i.defn.orderBy();if(u.dataRoles)for(var m=0,v=u.dataRoles;m<v.length;m++){var g=v[m];if(!(p&&_.indexOf(p,g.name)<0)){var y=a.getRole(r,g.name);if(y){var b=y.activeProjectionRefs;if(_.isEmpty(b))for(var C=0,x=y.all();C<x.length;C++){var S=x[C],w=d.withName(S.queryRef),E=w&&w.expr;if(E&&s.isExprValidForSorting(E)){var F=S.displayName||this.displayNameService.getDisplayName(E,o,u,S.queryRef,c),P=this.findSortExpressionIndex(E,h),V=P!==t.constants.invalidSortExprIndex;f.push({displayName:F,exprs:[{name:S.queryRef,expr:E}],active:V,sortDirection:V?h[P].direction:void 0})}}else{var D=l.createRoleKindByQueryRef(i),R=e.DataViewAnalysis.chooseDataViewMappings(r,u.dataViewMappings,D);if(R.supportedMappings){var T=n.targetDataViewKinds(R.supportedMappings),N=0!==(1&T);f.push.apply(f,this.getSortableFieldsFromActiveProjections(o,d,b,h,u,c,N))}}}}}return f},r.prototype.getSortableFieldsFromActiveProjections=function(e,r,i,n,a,s,l){for(var u,c=!1,p=[],f=[],d=0,h=i;d<h.length;d++){var m=h[d],v=r.withName(m),g=v&&v.expr;if(g&&!o.isFilteredEval(g)){var y=this.findSortExpressionIndex(g,n);if(l)c=c||y!==t.constants.invalidSortExprIndex,c&&!u&&(u=n[y].direction),f.push({name:m,expr:g});else{c=y!==t.constants.invalidSortExprIndex,u=c?n[y].direction:void 0;var b=this.getDisplayNameFromQueryRef(e,r,m,a,s);p.push({displayName:b,exprs:[v],active:c,sortDirection:u})}}}if(l){var b=this.concatDisplayNamesForActiveItems(e,r,i,a,s);return[{displayName:b,exprs:f,active:c,sortDirection:c?u:void 0}]}return p},r.prototype.concatDisplayNamesForActiveItems=function(e,t,r,i,n){var a=this,o=_.map(r,(function(r){return a.getDisplayNameFromQueryRef(e,t,r,i,n)}));return o.join(" ")},r.prototype.getDisplayNameFromQueryRef=function(e,t,r,i,n){var a=t.withName(r),o=a&&a.expr;return o?this.displayNameService.getDisplayName(o,e,i,r,n):""},r})();r.SortService=c})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("Explore/services/visualCapabilitiesHelper",(function(e){function t(e){return e&&e.geography&&(e.geography.latitude||e.geography.longitude)}var r=powerbi,i=r.data,n=r.explore,a=n.contracts,o=n.util,s=jsCommon.ArrayExtensions,l=r.DataViewMapping,u=r.DataViewAnalysis,c=o.DrillUtils,p=jsCommon.MathExtensions,f=i.SQExpr,d=i.SQExprConverter,h=a.VisualQuery,m=r.ValueType,v=(function(){function e(e,t,r,i){this.capabilities=e,this.roles=t,this.objectDescs=r,this.roleMappings=i,this.drillableRoles=c.getDrillableRoles(e)}return e.prototype.findCompatibleRole=function(e){var t=e.expr,r=e.roleToExprMap,i=e.targetRole,n=e.preferDrillableRoles;if(f.isHierarchyLevel(t)){n=!0;var a=this.getExistingTargetRoleForHierarchyLevelIfAny(t,r);if(a){if(i&&i!==a.name)return;i=a.name}}var o,s=d.asFieldPattern(t);s&&(o=s.column||s.columnAggr||s.groupingColumn||s.groupingColumnAggr||s.measure);var l={projections:e.queryProjections,metadata:t.getMetadata(e.schema),columnName:o?o.name:void 0,preferDrillableRoles:n,targetRole:i,useStrict:e.useStrict},u=this.findRole(l);return u||(l.preferDrillableRoles=!e.preferDrillableRoles,u=this.findRole(l)),u&&r&&r.add(t,u),u},e.prototype.findRole=function(e){var t=this.roleMappings;if(!_.isEmpty(t))for(var r=t[0].getValueType(e.metadata?e.metadata.type:void 0,e.columnName),i=this.roles.allRolesWithPreference(r?r.extendedType:void 0,e.projections,e.preferDrillableRoles,e.useStrict),n=e.targetRole?[e.targetRole]:i,a=0,o=n;a<o.length;a++)for(var s=o[a],l=0,u=t;l<u.length;l++){var c=u[l],p=c.checkRoleCompatibility(e,s,i);if(p)return p}},e.prototype.getExistingTargetRoleForHierarchyLevelIfAny=function(e,t){var r=t.get(e);return r},e.prototype.orderByRolePreferences=function(e,t){for(var r=this.roles.defns,i=0,n=t.length,a=0,o=r.length;a<o;a++){var s=r[a].preferredTypes;if(!_.isEmpty(s))for(var l=i;l<n;l++){var u=t[l],c=u.getMetadata(e);if(c){var p=c.type;if(p)for(var f=0,d=s.length;f<d;f++)if(p.extendedType===m.fromDescriptor(s[f]).extendedType){t.splice(l,1),t.splice(i,0,u),i++;break}}}}},e.prototype.getNumberRangesForRoles=function(e){var t,r=_.map(this.roles.defns,(function(e){return e.name}));t=e instanceof h?e.projections:e;for(var i={},n=0,a=r;n<a.length;n++){var o=a[n];i[o]={min:1/0,max:0}}for(var s=_.filter(this.roleMappings,(function(e){return e.projectionsAreCompatible({projections:t,roleNames:r,preferDrillableRoles:!0,ignoreMin:!0})})),l=0,u=s;l<u.length;l++)for(var c=u[l],f=c.getCondition(),d=0,m=r;d<m.length;d++){var o=m[d],v=f&&f[o],g=void 0;g=v?{min:p.max(v.min,0),max:p.min(v.max,1/0)}:{min:0,max:1/0};var y=i[o];y.min=Math.min(g.min,y.min),y.max=Math.max(g.max,y.max)}for(var b=0,C=_.values(i);b<C.length;b++){var y=C[b];y.min=Math.min(y.min,y.max)}return i},e.prototype.getNonLatLongCategoricalRoles=function(){for(var e=this.capabilities,t=e.dataViewMappings,r=[],i=0,n=t;i<n.length;i++){var a=n[i];a.categorical&&l.visitCategoricalCategories(a.categorical.categories,{visitRole:function(e){r.push(e)}})}var o=this.getLatLongRoleNames(),s=_.filter(r,(function(e){return!_.contains(o,e)}));return s},e.prototype.getLatLongRoleNames=function(){var e=this.capabilities;return _.chain(e.dataRoles).filter((function(e){if(!_.isEmpty(e.preferredTypes))return _.some(e.preferredTypes,(function(e){return t(e)}))})).map((function(e){return e.name})).value()},e.prototype.hasPreferredTypes=function(){return _.any(this.capabilities.dataRoles,(function(e){return!_.isEmpty(e.preferredTypes)}))},e})(),g=(function(){function e(e,t,r,i){this.roles=e,this.geoTaggingService=t,this.condition=i,this.drillableRoles=r}return e.prototype.getCondition=function(){return this.condition},e.prototype.checkRoleCompatibility=function(e,t,r){if(e.metadata){var i=this.roles.withName(t);if(i&&this.exprIsCompatible(i,e.metadata,u.getPropertyCount(t,e.projections)+1,e.preferDrillableRoles)){if(!this.projectionsAreCompatible({projections:e.projections,roleNames:_.without(r,t),preferDrillableRoles:e.preferDrillableRoles,ignoreMin:!1}))return;return i}}},e.prototype.getValueType=function(e,t){if(e&&null==e.categoryString){var r=t&&this.geoTaggingService.getFieldType(t);null!=r&&(e=m.fromPrimitiveTypeAndCategory(e.primitiveType,r))}return e},e.prototype.projectionsAreCompatible=function(e){for(var t=0,r=e.roleNames;t<r.length;t++){var i=r[t],n=this.roles.withName(i);if(!n)return!1;var a=u.getPropertyCount(i,e.projections);if(!this.isCardinalityValid({count:a,roleName:n.name,preferDrillableRoles:e.preferDrillableRoles,ignoreMin:e.ignoreMin}))return!1}return!0},e.prototype.exprIsCompatible=function(e,t,i,n){if(!this.isCardinalityValid({count:i,roleName:e.name,preferDrillableRoles:n,ignoreMin:!1}))return!1;var a=e.kind;if(1===t.kind){if(a===r.VisualDataRoleKind.Grouping)return!1}else if(a===r.VisualDataRoleKind.Measure)return!1;var o=e.requiredTypes;return!(o&&!m.isCompatibleTo(t.type,o))},e.prototype.isRoleDrillable=function(e){return _.contains(this.drillableRoles,e)&&(!this.condition[e]||void 0===this.condition[e].max||1===this.condition[e].max)},e.prototype.isCardinalityValid=function(e){if(this.condition&&(!e.preferDrillableRoles||!this.isRoleDrillable(e.roleName))){var t=this.condition[e.roleName];return!t||null==u.validateRange(e.count,t,e.ignoreMin)}return!0},e})(),y=(function(){function e(e){this.defns=e}return e.prototype.withName=function(e){return s.findItemWithName(this.defns,e)},e.prototype.allRolesWithPreference=function(e,t,r,i){var n=this,a=_.map(this.defns,(function(e){return e.name}));return this.promoteAndPenalize(a,(function(t){return n.getTypeWeightForRole(e,t.preferredTypes)}),i),this.promoteAndPenalize(a,(function(e){return n.getProjectionWeightForRole(e,t,r)})),a},e.prototype.promoteAndPenalize=function(t,r,i){for(var n=0,a=0,o=this.defns;a<o.length;a++){var s=o[a],l=r(s);if(null!=l){var u=t.splice(t.indexOf(s.name),1)[0];l!==e.penalize||i?l===e.promote&&t.splice(n++,0,u):t.push(u)}}},e.prototype.getTypeWeightForRole=function(t,r){if(r){for(var i=e.penalize,n=0,a=r;n<a.length;n++){var o=a[n],s=m.fromDescriptor(o).extendedType;if(t===s){i=e.promote;break}}return i}},e.prototype.getProjectionWeightForRole=function(t,r,i){var n=r[t.name];if(!i&&n&&t.kind!==powerbi.VisualDataRoleKind.Measure)return e.penalize},e.penalize=-1,e.promote=1,e})();return{create:function(e,t){if(e&&!_.isEmpty(e.dataRoles)){for(var r=e.dataViewMappings,i=new y(e.dataRoles),n=[],a=0,o=r;a<o.length;a++){var s=o[a],l=s.conditions;if(_.isEmpty(l))n.push(new g(i,t,c.getDrillableRoles(e)));else for(var u=0,p=l;u<p.length;u++){var f=p[u];n.push(new g(i,t,c.getDrillableRoles(e),f))}}return new v(e,i,e.objects,n)}},dataRoleWrapper:function(e){return new y(e)},isValueTypeDescriptorLatLong:t}}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new z(e.dataReaders,e.displayNameService,e.plugin,e.pluginOps,e.sortService,e.filterGenerator,e.aggrOps,e.featureSwitchService,e.transformPluginService,e.telemetryService)}function n(e,t){if(_.isEmpty(t))return{queryForTransformActions:e,internalToPublicSelectNameMappingsByRole:{}};for(var r=e.clone(),i=0,n=t;i<n.length;i++){var a=n[i];if(a.selectExprAdded){var o=r.defn.select(),s=a.selectExprAdded;o[s.selectIndex]=s.namedSQExpr,r.defn=r.defn.select(o)}else if(a.projectionQueryRefChanged){var s=a.projectionQueryRefChanged,l=r.projections[s.role];l.replaceQueryRef(s.oldQueryRef,s.newInternalQueryRef)}else a.aggregatesAdded}var u=_.reduce(t,(function(e,t){var r=t.projectionQueryRefChanged;if(r){var i=e[r.role];i||(i={},e[r.role]=i),i[r.newInternalQueryRef]=r.oldQueryRef}return e}),{});return{queryForTransformActions:r,internalToPublicSelectNameMappingsByRole:u}}function a(e,t,r,i,a,c,p,f,d,h,m,g,y,b){var C={};f&&(C.objects=f),d&&(C.splits=d);var x={options:e,transforms:C,warnings:m},S=n(i,h),w=S.queryForTransformActions,E=S.internalToPublicSelectNameMappingsByRole,F=w.defn.select(),P=w.defn.orderBy(),V=w.projections;if(b){var D=b.where();if(_.any(D,(function(e){return e.condition&&!_.isEmpty(e.condition.validate(t,c))})))return x.error=new B("Broken_Filters"),x}if(V){var R=[],T={},N=void 0;for(var M in V){var I=T[M]=[],O=V[M];_.isEmpty(O.activeProjectionRefs)||(N||(N={}),N[M]=_.map(O.activeProjectionRefs,(function(e){return{queryRef:e}})));for(var A=0,k=O.all();A<k.length;A++){var z=k[A],q=v.indexWithName(F,z.queryRef);R.push({queryRef:z.queryRef,format:z.format,queryIndex:q,roleName:M,displayName:z.displayName}),I.push(q)}}C.selects=[];for(var U,L=[],Q=w.defn.transforms(),H=!_.isEmpty(Q),G=function(e,i){var n=s(R,e),o=F[e],u=void 0,f=y&&y[o.name];if(!H||f){if(f&&(o=f),!_.isEmpty(o.expr.validate(t,c)))return L.push(o.expr),"continue";var d=o.expr.getMetadata(t);u={type:d.type,expr:o.expr};var h=j.getKpiMetadata(o.expr,t);h&&(u.kpi=h);var m=_.find(n,(function(e){return e.queryRef===o.name&&e.displayName}));u.displayName=m?m.displayName:a.getDisplayName(o.expr,t,p,o.name,r);var v=n[0];if(v){var g=v.format||d.format;g&&(u.format=g)}}else u={expr:o.expr,displayName:o.name};u.roles||(u.roles={});for(var b=0,x=n;b<x.length;b++){var S=x[b];S&&S.roleName&&(u.roles[S.roleName]=!0)}U=o.name,u.queryName=_.chain(Object.keys(u.roles)).map((function(e){return E[e]&&E[e][U]})).filter(_.isString).value()[0]||U;var w=l(P,o.expr);if(w!==-1){var V=P[w];u.sort=V.direction,u.sortOrder=w}var D=j.getDefaultValue(o.expr,t);if(D){u.defaultValue={value:D};var T=o.expr.getKeyColumns(t);u.defaultValue.identityFieldsValues=j.getDefaultValues(T,t)}var N=j.getAggregateBehavior(o.expr,t);1===N&&(u.discourageAggregationAcrossGroups=!0);var M=j.getParameterMetadata(o.expr,t);M&&(u.parameter=M),C.selects.push(u)},W=0,K=F.length;W<K;W++)G(W,K);if(h)for(var X=0,J=h;X<J.length;X++){var $=J[X];$.aggregatesAdded&&u(C.selects,$.aggregatesAdded)}C.roles={ordering:T},N&&(C.roles.activeItems=N,o(C,g)),x.error=B.create(L,t)}return x}function o(e,t){var r=e&&e.roles,i=r&&r.activeItems;if(i)for(var n in i)for(var a=i[n],o=0,s=a;o<s.length;o++){var l=s[o];l.suppressConcat=_.contains(t,l.queryRef)}}function s(e,t){return _.chain(e).compact().filter((function(e){return e.queryIndex===t})).value()}function l(e,t){return _.findIndex(e,(function(e){return N.equals(e.expr,t)}))}function u(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n.queryName===t.originalQueryRef){var a={},o=t.aggregates;o.min&&(a.min=c(o.min)),o.max&&(a.max=c(o.max)),n.aggregateSources=a;break}}var s=t.aggregates;p(e,s.min),p(e,s.max)}function c(e){return{index:e.index}}function p(e,t){if(t){var r=t.index;e[r]||(e[r]={displayName:"",queryName:t.queryName,expr:t.expr})}}function f(t,r){var i,n=[];switch(t.name){case e.visuals.plugins.map.name:var a=_.filter(r,(function(e){return"Category"===e.roleName&&e.code===w.conditionRangeTooLarge})),o=_.filter(r,(function(e){return"X"===e.roleName&&e.code===w.conditionKindExpectedGrouping})),s=_.filter(r,(function(e){return"Y"===e.roleName&&e.code===w.conditionKindExpectedGrouping}));_.isEmpty(a)?_.isEmpty(o)&&_.isEmpty(s)||(i="DataViewMappingError_LatLongAggregateWithNoLocation"):i="DataViewMappingError_LocationAndLatLongGroup"}if(!i&&1===_.size(r)){var l=r[0];switch(l.code){case w.conditionRangeTooLarge:i="DataViewMappingError_ConditionRangeTooLarge";break;case w.conditionRangeTooSmall:i="DataViewMappingError_ConditionRangeTooSmall";break;case w.conditionKindExpectedMeasure:i="DataViewMappingError_ConditionKindExpectedMeasure";break;case w.conditionKindExpectedGrouping:i="DataViewMappingError_ConditionKindExpectedGrouping"}n=[l.roleName]}if(i){var u=e.common.localize.format(i,n);return{code:i,getDetails:function(){return{displayableErrorInfo:[],message:u}}}}}function d(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];t&&t.allowBinnedLineSample===!1&&h(n),t&&t.allowOverlappingPointsSample===!1&&m(n)}}function h(e){var t=e.categorical;if(t&&t.dataReductionAlgorithm&&t.dataReductionAlgorithm.binnedLineSample&&(t.dataReductionAlgorithm=void 0,t.categories&&(t.categories.dataReductionAlgorithm={sample:{}}),t.values)){var r=t.values;r.group&&(r.group.dataReductionAlgorithm={top:{}})}}function m(e){var t=e.categorical,r=e.matrix;if(t&&t.dataReductionAlgorithm&&t.dataReductionAlgorithm.overlappingPointsSample){var i=t.dataReductionAlgorithm.overlappingPointsSample.count;
t.dataReductionAlgorithm={sample:{}},i&&(t.dataReductionAlgorithm.sample.count=i)}else if(r&&r.rows&&r.rows.dataReductionAlgorithm&&r.rows.dataReductionAlgorithm.overlappingPointsSample){var i=r.rows.dataReductionAlgorithm.overlappingPointsSample.count;r.rows.dataReductionAlgorithm={sample:{}},i&&(r.rows.dataReductionAlgorithm.sample.count=i)}}var v=jsCommon.ArrayExtensions,g=e.ClientErrorStrings,y=e.data.CompiledDataViewMapping,b=e.data.DataBoundObjectQueryExtender,C=e.data.DataReaderUtils,x=e.explore.contracts.DataSource,S=e.DataViewMapping,w=e.DataViewAnalysis.DataViewMappingMatchErrorCode,E=e.data.DataViewObjectDefinitions,F=e.data.DataViewObjectDescriptors,P=e.data.services.DataViewObjectSerializer,V=e.data.DataViewRoleWildcard,D=e.data.FieldExprPattern,R=e.data.ScalarKeyUtils,T=e.data.SemanticQuery,N=e.data.SQExpr,M=e.data.SQExprBuilder,I=e.data.SQExprConverter,j=e.data.SQExprUtils,O=jsCommon.StringExtensions,A=t.util.VisualContainerUtils;r.createVisualQueryGenerator=i;var k,z=(function(){function r(e,t,r,i,n,a,o,s,l,u){this.dataReaders=e,this.displayNames=t,this.visualPluginService=r,this.pluginOps=i,this.sortService=n,this.filterGenerator=a,this.aggrOps=o,this.featureSwitchService=s,this.transformPluginService=l,this.telemetryService=u}return r.prototype.shouldExecute=function(e,t){if(!e||_.isEmpty(t))return!1;var r=e.visualType,i=this.visualPluginService.capabilities(r);if(!i||this.pluginOps.isQueryDisabled(r,i))return!1;var n=this.getQueryGenerator(t,e);return!!n&&(null==e.query?b.needsToExtend(T.create(),i.objects,e.objects):this.pluginOps.isQueryVisual(r))},r.prototype.execute=function(e){var t=e.config,i=e.dataSources;if(!_.isEmpty(i)){var n=C.findTypes(i,t.query&&t.query.defn);if(!_.isEmpty(n)){var o=this.dataReaders.queryGenerator(n),s=this.getCompileMappingsResult(t,t&&t.visualType,e.schema,o,e.additionalFilters,e.dataViewMappingsOverride),l=this.dataReaders.queryExtensionLookup(i);if(s){if(s.error)return{options:null,error:s.error};var u=s.compiled;if(u){var c;if(u.query&&u.query.defn&&!_.isEmpty(u.query.defn.select())&&!_.isEmpty(u.query.defn.transforms())){c={};for(var p=0,f=u.query.defn.select();p<f.length;p++){var d=f[p];N.isTransformOutputRoleRef(d.expr)||(c[d.name]=d)}}var h=this.getVisualCapabilities(e.config.visualType),m=r.compileFilters(e.additionalFilters,h),v=this.generateQuery(o,e.schema,u,h.dataRoles,h.filterMappings,m.dataFilter,m.highlightFilter,e.restartToken,e.dataWindow,null,l),g=v.result,y=v.query,b=e.additionalFilters?e.additionalFilters.queryRefsForSingleItemDrillFilters:void 0,w=this.dataReaders.readerType(n);if(w){var E=x.queried(e.dataSources,y.defn),F={type:w,query:{dataSources:x.dataReaderDataSources(E),command:g.command,cacheResponseOnServer:e.cacheResponseOnServer,allowCache:e.allowCache,allowClientSideFilters:this.getAllowClientSideFiltersOrDefault(e,h),ignoreViewportForCache:e.ignoreViewportForCache},perfId:e.config.visualType};return this.featureSwitchService.featureSwitches.dataViewTargeted&&(F.kinds=S.targetDataViewKinds(u.mappings)),a(F,e.schema,t.columnProperties,y,this.displayNames,this.aggrOps,h,u.objectDefinitions,g.splits,g.queryRewrites,s.warnings,b,c,m.dataFilter)}}}}}},r.prototype.executeForFlattenedQuery=function(e,t){var i=e.config,n=this.getQueryGenerator(e.dataSources,i);if(n){var a=this.getCompileMappingsResult(i,i&&i.visualType,e.schema,n,e.additionalFilters,e.dataViewMappingsOverride);if(a&&!a.error){var o=a.compiled;if(o){var s=this.getVisualCapabilities(e.config.visualType),l=r.compileFilters(e.additionalFilters,s);return this.generateFlattenedQuery(n,e.schema,o,s.dataRoles,s.filterMappings,l.dataFilter,l.highlightFilter,e.restartToken,e.dataWindow,t)}}}},r.prototype.getQueryGenerator=function(e,t){if(!_.isEmpty(e)){var r=t.query,i=C.findTypes(e,r&&r.defn);if(i)return this.dataReaders.queryGenerator(i)}},r.prototype.getVisualCapabilities=function(e){if(e){var t=this.visualPluginService.getPlugin(e);return t&&t.capabilities}},r.prototype.getCompileMappingsResult=function(t,r,i,n,a,o){if(t&&r&&i){var s=this.visualPluginService.getPlugin(r);if(s){var l,u=this.getVisualCapabilities(r),c=o||u.dataViewMappings,p=t.query,d=u.sorting?u.sorting.implicit:null,h=p?A.createRoleKindByQueryRef(p):{};if(c&&p){var m=e.DataViewAnalysis.chooseDataViewMappings(p.projections,c,h,u.objects,t.objects);if(!m.supportedMappings){var v=f(s,m.mappingErrors);if(v)return{error:v,compiled:null};var g=e.data.QueryProjectionsByRole.clone(p.projections);for(var y in g){var b=g[y];b.activeProjectionRefs=_.map(b.activeProjectionRefs,(function(t){return"select"+e.obfuscate(t)}));for(var C=0,x=b.all();C<x.length;C++)x[C]?x[C]={queryRef:"select"+e.obfuscate(x[C].queryRef)}:x[C]=null}var S=new B("ClientError_NoSupportedDataViewMappingFound");return S.addDebugInfo("VisualType",r),S.addDebugInfo("QueryProjectionsByRole",JSON.stringify(g)),this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorError,r,JSON.stringify(S.getDetails(e.common.localize).debugErrorInfo)),{error:S,compiled:null}}l=this.compileMappingsWithProperties(r,i,p,m.supportedMappings,h,u.dataRoles,u,t.queryOptions,t.columnProperties,t.objects,s.customizeQuery,d,n,a)}else l=this.compileNoMappingsWithProperties(i,p,h,c,u.dataRoles,u.objects,t.objects);var w=[];if(l){w.push.apply(w,q.validateAndAdjustRolesIfNecessary(l.mappings,l.query,i,this.displayNames,u)||[]),w.push.apply(w,U.validateAndAdjustHighlightIfNecessary(a)||[]);for(var E=0,F=w;E<F.length;E++){var P=F[E];this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorWarning,P.code)}}return{compiled:l,warnings:w}}}},r.compileFilters=function(e,t){var r,i;return e&&(i=e.dataFilter,r=e.highlightFilter),{dataFilter:i,highlightFilter:r}},r.prototype.getAllowClientSideFiltersOrDefault=function(e,t){if(_.isBoolean(e.allowClientSideFilters))return e.allowClientSideFilters;var r=!!F.findSelfFilter(t.objects);return r},r.prototype.compileMappingsWithProperties=function(r,i,n,a,o,s,l,u,c,p,f,h,m,v){_.isEmpty(n.defn.transforms())&&(n=t.TransformGeneratorUtils.addTransforms(p,a,n,this.transformPluginService,l));var g=e.data.compileDataView({mappings:a,queryDefn:n.defn,queryProjections:n.projections,schema:i,objectDescriptors:l.objects,objectDefinitions:p,roles:s});if(f){var y=this.getSorts(g);f({dataViewMappings:g,preferHigherDataVolume:this.featureSwitchService.featureSwitches.preferHigherDataVolume});var C=this.getSorts(g);n=this.updateSorts(n,y,C)}d(g,u),n=t.TransformGeneratorUtils.removeUnsupportedTransforms(this.transformPluginService,n,g),n=this.sortService.applyImplicitSort(n,h),n=this.sortService.ensureValidSorting({query:n,schema:i,visualType:r,objectDefns:p,columnProperties:c});var x=k.setProperties(i,g,n,p,l.objects),S=x.modifiedObjectDefinitions,w=x.addedScalarKeys;S=this.setFilteredToUniqueValueProperties(v,m,i,g,n,S,l.objects);var E,F,P=this.getQueryRefsByRole(n,s),V=b.extend(n.defn,i,l.objects,S,P,n.projections,o);if(V){E=new t.contracts.VisualQuery(V.queryDefn,n.projections),F=V.additionalProjections;for(var D=0,R=w;D<R.length;D++){var T=R[D],N=E.defn.selectNameOf(T.expr);T.roleItem.scalarKeyInfo||(T.roleItem.scalarKeyInfo={}),T.roleItem.scalarKeyInfo.scalarKeyQueryName=N}}return{query:E||n,mappings:g,additionalProjections:F,objectDefinitions:S}},r.prototype.getSorts=function(e){for(var t=[],r=0,i=e;r<i.length;r++){for(var n=i[r],a=[],o=0,s=n.metadata.columns;o<s.length;o++){var l=s[o];l.sort&&a.push({queryName:l.queryName,sort:l.sort,sortOrder:l.sortOrder})}t.push(a)}return t},r.prototype.updateSorts=function(e,r,i){if(_.isEqual(r,i))return e;for(var n=[],a=e.defn.select(),o=0,s=i;o<s.length;o++)for(var l=s[o],u=_.sortBy(l,(function(e){return e.sortOrder})),c=0,p=u;c<p.length;c++){var f=p[c],d=a.withName(f.queryName);n.push({direction:f.sort,expr:d.expr})}return new t.contracts.VisualQuery(e.defn.orderBy(n),e.projections)},r.prototype.getQueryRefsByRole=function(e,t){var r={};if(_.isEmpty(t))return r;for(var i=0,n=t;i<n.length;i++){var a=n[i],o=e.tryGetExprs(a.name);r[a.name]=_.map(o,(function(t){return e.defn.selectNameOf(t)}))}return r},r.prototype.setFilteredToUniqueValueProperties=function(e,t,r,i,n,a,o){var s=this;if(!e||!e.dataFilter)return a;for(var l,u=n.defn.select(),c=e.dataFilter.where(),p=e.queryRefsForSingleItemDrillFilters,f=0,d=i;f<d.length;f++){var h=d[f];h&&h.categorical&&h.categorical.categories&&y.visitCategoricalCategories(h.categorical.categories,{visitRole:function(e,i){if(!_.isEmpty(e.items))for(var n=0,o=e.items;n<o.length;n++){var f=o[n],d=f.queryName;if(f.filteredToUniqueValueProperty&&_.contains(p,d)){var h=u.withName(d),m=s.isFilteredToUniqueValues(h.expr,c,r,t);m&&(l||(l=a?E.clone(a):{}),s.setFilteredToUniqueValueProperty(m,f,l))}}}})}return l||a},r.prototype.isFilteredToUniqueValues=function(e,r,i,n){if(!n||!n.hasAmbiguousEqualitySemantics)return!0;for(var a=e.getKeyColumns(i),o=!1,s=0,l=a;s<l.length;s++){var u=l[s],c=t.FilterUtils.getFiltersForColumn(r,u);if(!_.isEmpty(c)){o=!0;for(var p=0,f=c;p<f.length;p++){var d=f[p],h=_.flatten(t.FilterUtils.getFilterValues(d,u));if(_.any(h,(function(e){return!N.isConstant(e)||n.hasAmbiguousEqualitySemantics(e)})))return!1}}}return o},r.prototype.setFilteredToUniqueValueProperty=function(e,t,r){var i=t.filteredToUniqueValueProperty,n=M.boolean(e),a={metadata:t.queryName};E.setValue(r,i,a,n)},r.prototype.compileNoMappingsWithProperties=function(r,i,n,a,o,s,l){if(!i&&_.isEmpty(a)){i=new t.contracts.VisualQuery(T.create(),{});var u=this.getQueryRefsByRole(i,o),c=b.extend(i.defn,r,s,l,u,i.projections,n);if(c){var p=new t.contracts.VisualQuery(c.queryDefn,i.projections),f=c.additionalProjections,d=e.data.compileDataView({mappings:[{table:{rows:{for:{in:"*"}}}}],queryDefn:i.defn,queryProjections:i.projections,schema:r,objectDescriptors:s,objectDefinitions:l,roles:o});return{query:p||i,mappings:d,additionalProjections:f,objectDefinitions:l}}}},r.prototype.generateQuery=function(e,t,r,i,n,a,o,s,l,u,c){var p=this.getQueryGeneratorOptions(t,r,i,n,a,o,s,l,u,c),f=e.execute(p);return{result:f,query:r.query}},r.prototype.generateFlattenedQuery=function(e,t,r,i,n,a,o,s,l,u){var c=this.getQueryGeneratorOptions(t,r,i,n,a,o,s,l,u);return e.executeForQueryOnly?e.executeForQueryOnly(c):c.query},r.prototype.getQueryGeneratorOptions=function(e,r,i,n,a,o,s,l,u,c){var p=r.query,f=t.TransformGeneratorUtils.rewriteTransform(this.transformPluginService,p,i,this.getQueryRefsByRole(r.query,i),r.additionalProjections,r.mappings),d=this.filterGenerator.resolveFilterTargets(e,f,i,n,a),h=u?u(d):d;return{query:h,queryExtensionLookup:c,mappings:r.mappings,additionalProjections:r.additionalProjections,highlightFilter:o,restartToken:s,dataWindow:l,highVolumeOverride:this.featureSwitchService&&this.featureSwitchService.featureSwitches.highVolume}},r})();!(function(t){function r(e,t,r,n,a){for(var o,s=[],l=0,u=t;l<u.length;l++){var c=u[l];y.visitMapping(c,{visitRole:function(t,l){if(t.items)for(var u=0,c=t.items;u<c.length;u++){var p=c[u];if(p.scalarKeyInfo&&p.scalarKeyInfo.scalarKeyMinProperty){if(!o)if(n){var f=P.serializeObjects(n,a);o=P.deserializeObjects(f,a)}else o={};s.push(i(e,r,t,p,o))}}}})}return{modifiedObjectDefinitions:o||n,addedScalarKeys:s}}function i(t,r,i,n,a){var o=n.scalarKeyInfo.scalarKeyMinProperty;e.contract.check(n.scalarKeyInfo.hasScalarKey,"Scalar key requested when not available");var s=r.defn.select().withName(n.queryName).expr,l=M.aggregate(R.getScalarKeyExpr(s,t),3),u={data:[V.fromRoles([i.role])]};return E.setValue(a,o,u,l),{roleItem:n,expr:l}}t.setProperties=r})(k||(k={})),r.getDataViewMappingErrorFromFailures=f;var q,B=(function(){function t(t,r){this.messageId="VisualContainer_FailedToLoadVisual",this.displayableErrorInfo=[{errorInfoKey:"",errorInfoValue:""}],this.errorCode=t,"Missing_References"===t?(this.displayableErrorInfo[0].errorInfoKey="Missing_References_Details_Title",this.displayableErrorInfo[0].errorInfoValue=r,this.detailsMessageFormat="Missing_References_Details_Message",this.messageId="Missing_References_Message"):"Broken_Filters"===t?(this.displayableErrorInfo[0].errorInfoKey="ServiceError_CannotLoadVisual",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("Broken_Filters_Details_Message"),this.messageId="Broken_Filters_Message"):"ClientError_NoSupportedDataViewMappingFound"===t&&(this.displayableErrorInfo[0].errorInfoKey="VisualDisplayError_Title",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("ClientError_NoSupportedDataViewMappingFound_Message"),this.messageId="ClientError_NoSupportedDataViewMappingFound_Message")}return t.create=function(e,r){if(!_.isEmpty(e)){for(var i=[],n=0,a=e;n<a.length;n++){var o=a[n],s=I.asFieldPattern(o),l=D.toFieldExprEntityItemPattern(s),u=D.getPropertyName(s);s.hierarchy&&(u=s.hierarchy.name),s.hierarchyLevel&&(u=s.hierarchyLevel.name+"."+s.hierarchyLevel.level);var c="("+l.entity+") "+u,p=r.schema(l.schema),f=p&&p.findProperty(l.entity,u);f&&f.errorMessage&&(c+=": "+f.errorMessage),i.push(c)}return new t("Missing_References",i.join(", "))}},Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!0,configurable:!0}),t.prototype.addDebugInfo=function(e,t){this.debugErrorInfo||(this.debugErrorInfo=[]),this.debugErrorInfo.push({errorInfoKey:e,errorInfoValue:t})},t.prototype.getDetails=function(e){var t=e.get(this.displayableErrorInfo[0].errorInfoKey),r=this.displayableErrorInfo[0].errorInfoValue;this.detailsMessageFormat&&(r=O.format(e.get(this.detailsMessageFormat),r));var i={message:e.get(this.messageId),displayableErrorInfo:[{errorInfoKey:t,errorInfoValue:r}],debugErrorInfo:(n=[{errorInfoKey:g.ClientErrorCode,errorInfoValue:this.code}]).concat.apply(n,this.debugErrorInfo)};return i;var n},t})();!(function(e){function t(e,t,i,n,a){for(var o=new r(t.defn,i,n,a),s=0,l=e;s<l.length;s++){var u=l[s];y.visitMapping(u,o)}return o.warnings}e.validateAndAdjustRolesIfNecessary=t;var r=(function(){function e(e,t,r,i){this.displayNameService=r,this.incompatibleExprInfo=[];for(var n=0,a=e.select();n<a.length;n++){var o=a[n],s=I.asFieldPattern(o.expr);s&&s.percentOfGrandTotal&&this.incompatibleExprInfo.push({basePropertyName:D.getPropertyName(s),fieldDisplayName:this.displayNameService.getQualifiedDisplayName(o.expr,t,i)})}this.warnings=[]}return e.prototype.visitRole=function(e){e.showAll&&this.incompatibleExprInfo.length>0&&(e.showAll=!1,this.warnings.push(new i(this.incompatibleExprInfo)))},e})(),i=(function(){function e(e){this.errorInfos=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"ShowAllDiabledWarning"},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t=e.get("ShowAllDisabledWarning_Value"),r=_.map(this.errorInfos,(function(e){return e.fieldDisplayName})).join(", "),i={message:e.get("ShowAllDisabledWarning_Message"),displayableErrorInfo:[{errorInfoKey:e.get("ShowAllDiabledWarning_ErrorInfoKey"),errorInfoValue:O.format(t,r)}]};return i},e})()})(q||(q={}));var U;!(function(t){function r(t){if(t&&t.highlightFilter){var r=_.find(t.highlightFilter.where(),(function(t){return 3===e.data.FilterKindDetector.run(t.condition)}));if(r)return t.highlightFilter=void 0,[new i]}}t.validateAndAdjustHighlightIfNecessary=r;var i=(function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"HighlightWithTOPNDisabledWarning"},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t={message:e.get("HighlightWithTOPNDisabledWarning_Message"),displayableErrorInfo:[{errorInfoKey:e.get("HighlightWithTOPNDisabledWarning_ErrorInfoKey"),errorInfoValue:e.get("HighlightWithTOPNDisabledWarning_Value")}]};return t},e})()})(U||(U={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new a(e,t)}var n=t.util.VisualContainerUtils;r.createVisualRelationshipService=i;var a=(function(){function t(e,t){this.visualPluginService=e,this.pluginOps=t}return t.prototype.relationship=function(e,t,r){var i=_.filter(e.relationships,(function(e){return e.source===t&&e.target===r}));if(i)return i[0]},t.prototype.relationshipFilterAction=function(t,r,i,n){var a=this.relationship(t,r,i);if(a&&this.supportsFilterActionTarget(r,i,a.type))return a.type;if(i&&i.config&&i.config.singleVisual){var o=i.config.singleVisual,s=o.visualType,l=this.visualPluginService.capabilities(s),u=o.query;if(l&&u){var c=this.visualPluginService.getPlugin(s);if(c&&c.isCrossFilteredByDefault){var p=o.objects,f={mappings:l.dataViewMappings,queryDefn:u.defn,queryProjections:u.projections,schema:n,objectDescriptors:l.objects,objectDefinitions:p,roles:l.dataRoles},d=e.data.compileDataView(f),h={dataViewMappings:d};if(c.isCrossFilteredByDefault(h))return 3}}}return 0},t.prototype.supportsFilterActionTarget=function(t,r,i){var a=n.getVisualType(r),o=n.getVisualType(t);if(!_.isEmpty(o)&&!_.isEmpty(a)){var s=this.visualPluginService.capabilities(a),l=this.pluginOps.isQueryVisual(a),u=!s||s.supportsHighlight;switch(i){case 1:return l;case 2:return u&&o!==e.visuals.plugins.slicer.name;case 3:return l||u}}return!1},t.prototype.supportsAnyFilterAction=function(e){var t=n.getVisualType(e);if(_.isEmpty(t)||!this.pluginOps.isQueryVisual(t))return!1;var r=this.visualPluginService.capabilities(t);return!r||r.supportsSelection!==!1},t.prototype.defaultFilterAction=function(e,t){return this.supportsFilterActionTarget(e,t,2)?2:this.supportsFilterActionTarget(e,t,1)?1:void 0},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new s(e,t,r,i)}var i=e.data.SemanticFilter,n=e.data.SemanticQuery,a=e.data.services.SemanticQuerySerializer,o=e.data.SQExprBuilder;t.createHostFiltersService=r;var s=(function(){function e(e,t,r,i){this.conceptualSchemaProxy=e,this.dataProxyFactory=t,this.promiseFactory=r,this.eventBridge=i,this.filtersDictionary={}}return e.prototype.getHostAvailableCategories=function(e,t){var r=this;return this.conceptualSchemaProxy.get(e).then((function(e){var i=_.filter(e.schemas,(function(e){return!e.isExtensionSchema})),n=_.flatten(_.map(i,(function(e){return e.entities}))),a=_.flatten(_.map(n,(function(e){return e.properties}))),o=_.filter(t,(function(e){return 1===r.typeWithinSchemaCount(a,e)}));if(o.length>0){var s={categories:o};return s}return{categories:[]}}))},e.prototype.typeWithinSchemaCount=function(e,t){var r=_.filter(e,(function(e){return e.type.extendedType===t.extendedType}));return r.length},e.prototype.addOrUpdateHostFilters=function(e,t,r){var i=this;return this.conceptualSchemaProxy.get(t).then((function(n){return i.promiseFactory.all(_.map(e,(function(e){return i.addOrUpdateHostFilter(t,n,e,r)})))}))},e.prototype.removeHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];void 0!==this.filtersDictionary[i]&&delete this.filtersDictionary[i]}},e.prototype.selectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.filtersDictionary[i];n&&(n.selected=!0)}},e.prototype.deselectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.filtersDictionary[i];n&&(this.filtersDictionary[i].selected=!1)}},e.prototype.applySelectedHostFilters=function(){this.eventBridge.publishToChannel(t.events.visualContainerChanged,{affectContainer:function(){return!0},allowCache:!0})},e.prototype.getSelectedHostFilters=function(){var e=[];for(var t in this.filtersDictionary){var r=this.filtersDictionary[t];r.selected&&e.push(r.filterContainer)}return{filters:e}},e.prototype.addOrUpdateHostFilter=function(e,t,r,a){if(r.type&&r.value){for(var s=r.value.toString(),l={hostFilterValue:{value:s,type:r.type},filterValue:s,filterKey:r.type.categoryString,filterCanExecute:!1,filterReturnNonEmptyResults:!1},u=[],c=_.filter(t.schemas,(function(e){return!e.isExtensionSchema})),p=0,f=c;p<f.length;p++)for(var d=f[p],h=0,m=d.entities;h<m.length;h++)for(var v=m[h],g=0,y=v.properties;g<y.length;g++){var b=y[g];b.type.extendedType===r.type.extendedType&&u.push({schema:d,entity:v,property:b})}if(1===u.length){var C=u[0].schema,x=u[0].entity,S=u[0].property,w=o.entity(C.name,x.name),E=o.columnRef(w,S.name),F=r.alternativeValues?r.alternativeValues.concat(r.value):[r.value],P=o.inValues([E],_.map(F,(function(e){return[o.typedConstant(e,r.type)]}))),V=i.fromSQExpr(P),D={name:l.filterKey,expression:w,filter:V};if(l.filterCanExecute=!0,this.filtersDictionary[l.filterKey]={filterContainer:D,selected:!1},a){var R=n.create().addSelect(E).addSemanticFilter(V);if(R)return this.testHostFilterForNonEmptyResults(e,l,R)}}return this.promiseFactory.resolve(l)}},e.prototype.testHostFilterForNonEmptyResults=function(e,t,r){if(t.filterCanExecute&&r&&e){var i=_.compact(_.map(e,(function(e){return e.dsr}))),n={type:"dsr",query:{dataSources:i,command:{Commands:[{SemanticQueryDataShapeCommand:{Query:a.serializeQuery(r)}}]},allowCache:!0,cacheResponseOnServer:!0}},o=this.dataProxyFactory.create();return o.execute(n).then((function(e){return e.dataReaderResult.dataView.table.rows.length>0&&(t.filterReturnNonEmptyResults=!0),t}),(function(){return t}))}this.promiseFactory.reject()},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{translate:_.noop}}e.createDaxTranslator=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return{getTemplates:_.noop}}e.createDaxTemplateService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){var r=new o(e,t);return r}var i=e.data.SemanticFilter,n=e.data.SQExprConverter,a=e.data.SQExprUtils;t.createAnalyzedFilter=r;var o=(function(){function t(e,t){this.filter=e.filter,this.isNotFilter=!1,this.analyze(e,t)}return t.prototype.analyze=function(t,r){if(!i.isAnyFilter(this.filter)){var o=t.fieldSQExprs,s=i.isDefaultFilter(this.filter);if(this.filter&&!s){var l=n.asScopeIdsContainer(this.filter,o);l&&(this.isNotFilter=l.isNot,this.selectedIdentities=l.scopeIds)}if(this.defaultValue=this.getDataViewDefaultValue(t.dataView,t.defaultValuePropertyId),this.defaultValue&&!r&&(this.filter||(this.filter=i.getDefaultValueFilter(o),s=!0),s)){var u=e.data.createDataViewScopeIdentity(a.getDataViewScopeIdentityComparisonExpr(o,this.defaultValue.identityFieldsValues));this.isNotFilter=!1,this.selectedIdentities=[u]}}},t.prototype.getDataViewDefaultValue=function(t,r){if(t&&t.metadata&&!_.isEmpty(t.metadata.columns))return e.DataViewObjects.getValue(t.metadata.columns[0].objects,r)},t})();t.FilterAnalyzer=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.FilterKindDetector,i=e.data.SQScopedEvalExpr,n=(function(){function t(e){this.options=e}return t.prototype.resolveSemanticQuery=function(e){return e?e.where(this.resolveFilters(e.where()),e.from()):null},t.prototype.resolveFilters=function(e){var t=this;return e?_.map(e,(function(e){return t.resolveFilter(e)})):null},t.prototype.resolveFilter=function(e){if(!e)return null;if(e.target)return e;if(e.condition){var t=r.run(e.condition);switch(t){case 0:return this.resolveColumnFilter(e);case 2:return this.resolveExistsFilter(e);case 1:return this.resolveMeasureFilter(e);case 3:return this.resolveTopNFilter(e);default:return}}},t.prototype.resolveColumnFilter=function(e){return{condition:e.condition}},t.prototype.resolveMeasureFilter=function(e){var t=null;this.options.mappings&&this.options.mappings.measureFilter&&(t=this.options.mappings.measureFilter.targetRoles),t||(t=this.getDefaultMeasureFilterTargetRoles());var r,i,n=e.condition;if(t){for(var o=0,s=t;o<s.length;o++){var l=s[o],u=this.options.queryProjections[l];if(u)for(var c=0,p=u.all();c<p.length;c++){var f=p[c],d=this.options.select.filter((function(e){return e.name===f.queryRef})),h=d[0].expr,m=d[0].name,v=h.getMetadata(this.options.schema),g=r&&r[m];v&&1!==v.kind&&!g&&(i||(i=[],r={}),i.push(h),r[m]=!0)}}n=a.rewrite(n,t)}return{target:i,condition:n}},t.prototype.resolveExistsFilter=function(e){return e},t.prototype.resolveTopNFilter=function(e){return{condition:e.condition}},t.prototype.getDefaultMeasureFilterTargetRoles=function(){var t=this.options.dataRoles?this.options.dataRoles.filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping||t.kind===e.VisualDataRoleKind.GroupingOrMeasure})):[];return t.map((function(e){return e.name}))},t})();t.VisualFilterMappingResolver=n;var a=(function(t){function r(e){var r=t.call(this)||this;return r.filterTargetRoles=e,r}return __extends(r,t),r.rewrite=function(e,t){var i=new r(t);return e.accept(i)},r.prototype.visitScopedEval=function(t){var r=this,n=_.filter(t.scope,(function(t){return!e.data.SQExpr.isRoleRef(t)||_.contains(r.filterTargetRoles,t.role)}));return n.length===t.scope.length?t:new i(t.expression,n)},r})(e.data.SQExprRewriter)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){var i=t.capabilities(e);return!(!i||!r.isQueryVisual(e))&&(!i.disableVisualDetails&&_.any(i.dataViewMappings,(function(e){return e.categorical||e.matrix||e.table||e.tree})))}function r(t,r){var i,n,a=r||1;return 1===a?(i=t.width-2*e.DetailVisualBorder,n=t.height-e.DetailVisualBorder):(i=t.width-e.DetailVisualBorder,n=t.height-2*e.DetailVisualBorder),{width:Math.max(i,0),height:Math.max(n,0),scale:t.scale}}e.DetailVisualBorder=10,e.supportsVisualDetails=t,e.getDetailVisualViewport=r})(t=e.DetailVisualUtils||(e.DetailVisualUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(t,r,i,n,o){if(!t)return i;var s=[],l=o.objects,u=function(e){var r=l[e],n=function(n){if(r.properties[n].type.queryTransform){var o=_.filter(t[e],(function(e){return a(e,i)}));s.push.apply(s,_.map(o,(function(t){return{objectName:e,propertyName:n,object:t}})))}};for(var o in r.properties)n(o)};for(var c in l)u(c);if(_.isEmpty(s))return i;for(var p=i.clone(),f=0,m=s;f<m.length;f++){var v=m[f],g=d.getValue(t,{objectName:v.objectName,propertyName:v.propertyName},v.object.selector);if(!g)return i;if(g.algorithm!==h.name||_.any(r,e.DataViewMapping.isForecastDefined)){var y=n.getTransformPlugin(g.algorithm);p.addTransform(y,g.parameters,o)}}return p}function n(t,r,i){var n=r.defn.transforms();if(_.isEmpty(n))return r;for(var a=r.clone(),o=0,s=n;o<s.length;o++){var l=s[o];if(l.algorithm===e.data.transforms.plugins.Forecast.name&&!_.any(i,e.DataViewMapping.isForecastDefined)){var u=t.getTransformPlugin(l.algorithm);a.removeTransform(u,l.name)}}return a}function a(e,t){if(!e.selector||!_.isString(e.selector.metadata))return!0;var r=t.projections;if(!r)return!1;for(var i in r){var n=r[i];if(n){var a=n.all();if(a)for(var o=0,s=a;o<s.length;o++){var l=s[o];if(l.queryRef===e.selector.metadata)return!0}}}return!1}function o(e,t,r,i,n,a){var o=t.defn.transforms();if(_.isEmpty(o))return t;var c=t.defn.select();if(_.isEmpty(c))return t;for(var p=u(t,r,i,n),f=p.transformSelects,d=p.topLevelSelects,h=[],g=0;g<o.length;g++){var y=o[g],C=e.getTransformPlugin(y.algorithm),x="input"+g,S="output"+g,w={algorithm:y.algorithm,name:y.name,input:{parameters:y.input.parameters,table:{name:x,columns:s(f,i,r,C,a)}},output:{table:{name:S,columns:l(f,x,t.projections)}}};f=_.map(w.output.table.columns,(function(e){var t=v.columnRef(v.transformTableRef(S),e.expression.name);return{name:e.expression.name,expr:t}})),h.push(w)}var E,F=_.last(h),P=t.defn.orderBy();F&&!_.isEmpty(P)&&(E=_.map(P,(function(e){var t=_.find(c,(function(t){return m.equals(t.expr,e.expr)})),r=v.columnRef(v.transformTableRef(F.output.table.name),t.name);return{direction:e.direction,expr:r}})));var V=t.defn.transforms(h);if(!_.isEmpty(d))for(var D=function(e){var t=_.findIndex(c,(function(t){return t.name===e.name}));f.splice(t,0,e)},R=0,T=d;R<T.length;R++){var N=T[R];D(N)}return V=V.select(f),E&&(V=V.orderBy(E)),new b(V,t.projections)}function s(e,t,r,i,n){var a=_.filter(e,(function(e){return!m.isTransformOutputRoleRef(e.expr)})),o=c(n),s=Object.keys(t);return _.map(a,(function(e){var n=_.find(s,(function(r){return _.contains(t[r],e.name)}));if(!n)return{role:"X",expression:e};var a=_.find(r,(function(e){return e.name===n}));return{role:o&&0===a.cartesianKind?void 0:p(e.expr,i,a),expression:e}}))}function l(e,t,r){for(var i={},n=0,a=e;n<a.length;n++){var o=a[n];m.isTransformOutputRoleRef(o.expr)||(i[o.name]=!0)}return _.map(e,(function(e){var n,a,o;if(m.isTransformOutputRoleRef(e.expr)){var s=void 0;for(var l in r){var u=r[l].all();_.any(u,(function(t){return t.queryRef===e.name}))&&(s=l)}n=s,a=e.expr,o=y.findUniqueName(i,e.name)}else a=v.columnRef(v.transformTableRef(t),e.name),o=e.name;return{role:n,expression:{name:o,expr:a}}}))}function u(e,t,r,i){for(var n=[],a=[],o=e.defn.select(),s=function(t){if(m.isTransformOutputRoleRef(t.expr))return n.push(t),"continue";var o=Object.keys(r),s=_.filter(o,(function(e){return _.contains(r[e],t.name)}));if(!_.isEmpty(s)){for(var l=!1,u=0,c=s;u<c.length;u++){var p=c[u];if(!e.projections[p].activeProjectionRefs||_.contains(e.projections[p].activeProjectionRefs,t.name)){n.push(t),l=!0;break}}return l||a.push(t),"continue"}if(!_.isEmpty(i)){var f=_.find(i,(function(e){return e.queryName===t.name}));f&&f.selector&&f.selector.data?n.push(t):a.push(t)}},l=0,u=o;l<u.length;l++){var c=u[l];s(c)}return{transformSelects:n,topLevelSelects:a}}function c(e){for(var t=!1,r=0,i=e;r<i.length;r++){var n=i[r],a=n.categorical;if(a){var o=n.categorical.categories;_.isEmpty(o)||f.visitCategoricalCategories(o,{visitRole:function(e){_.any(e.items,(function(e){return e.scalarKeyInfo&&e.scalarKeyInfo.scalarKeyMinProperty}))&&(t=!0)}})}if(t)break}return t}function p(e,t,r){var i=_.find(t.inputRoles,(function(t){var i=t.visualDataRoleMatching;return!i||(void 0===i.cartesianKind||i.cartesianKind===r.cartesianKind)&&((void 0===i.matchGrouping||i.matchGrouping!==g.isMeasure(e))&&((void 0===i.matchMeasure||i.matchMeasure===g.isMeasure(e))&&(!i.skipJoinPredicateNone||0!==r.joinPredicate)))}));if(i)return i.name}var f=e.data.CompiledDataViewMapping,d=e.data.DataViewObjectDefinitions,h=e.data.transforms.plugins.Forecast,m=e.data.SQExpr,v=e.data.SQExprBuilder,g=e.data.SQExprUtils,y=jsCommon.StringExtensions,b=t.contracts.VisualQuery;r.addTransforms=i,r.removeUnsupportedTransforms=n,r.rewriteTransform=o})(r=t.TransformGeneratorUtils||(t.TransformGeneratorUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.invalidSortExprIndex=-1,e.DefaultSchemaName=void 0,e.ExplorationSchemaName="extension",e.DefaultBaseThemeName="CY17SU10";var t;!(function(e){function t(){return{color:e.DefaultCanvasBackgroundColor,transparency:e.DefaultCanvasBackgroundTransparency}}e.DefaultCanvasWidth=960,e.DefaultCanvasHeight=720,e.DefaultCanvasBackgroundColor="#FFFFFF",e.DefaultCanvasBackgroundTransparency=0,e.DefaultWidescreenWidth=1280,e.DefaultWidescreenHeight=720,e.DefaultCortanaWidth=296,e.DefaultCortanaHeight=592,e.DefaultLetterWidth=816,e.DefaultLetterHeight=1056,e.getDefaultCanvasBackground=t})(t=e.ExploreCanvasConstants||(e.ExploreCanvasConstants={}))})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("Explore/services/explorationState",["require","exports"],(function(e,t){function r(e,t,r,i,n,a){return new x(e,t,r,i,n,a)}function i(e,t){if(!_.isEmpty(e)){for(var r={},i=0,a=e;i<a.length;i++){var l=a[i];o(l,t)?(r.exprIdentifiedMerges||(r.exprIdentifiedMerges=[]),r.exprIdentifiedMerges.push(n(l))):s(l)?(r.typeIdentifiedMerges||(r.typeIdentifiedMerges=[]),r.typeIdentifiedMerges.push(n(l))):(_.isEmpty(l.name)&&(l.name=v.getNextFilterName(e)),
r.nameIdentifiedMerges||(r.nameIdentifiedMerges={}),r.nameIdentifiedMerges[l.name]=n(l))}if(!_.isEmpty(r))return r}}function n(e){return{name:e.name,type:e.type,filter:e.filter,expression:e.expression,restatement:e.restatement,howCreated:e.howCreated}}function a(e){return{name:e.name,type:e.type,filter:e.filter,expression:e.expression,restatement:e.restatement,howCreated:e.howCreated}}function o(e,t){return!!e.expression}function s(e){return 3===e.howCreated||4===e.howCreated}Object.defineProperty(t,"__esModule",{value:!0});var l=powerbi,u=l.data,c=l.explore,p=c.contracts,f=jsCommon.ArrayExtensions,d=u.DataViewObjectDefinitions,h=u.DataViewObjectDescriptors,m=l.DataViewObjectProperty,v=c.FilterUtils,g=u.SemanticFilter,y=u.SQExpr,b=p.VisualContainer,C=c.util.VisualContainerUtils;t.create=r,t.convertToFilterContainerState=n;var x=(function(){function e(e,t,r,i,n,a){this.filterGenerator=e,this.plugins=t,this.visualPluginOps=r,this.dataSources=i,this.conceptualSchemaProxy=n,this.aggrOps=a}return e.prototype.capture=function(e){return __awaiter(this,void 0,l.Promise,(function(){var t,r,n,a,o;return __generator(this,(function(s){switch(s.label){case 0:return t=e.sections[e.activeSectionIndex],n={activeSection:t.name,filters:i(e.filters,2)},o={},a=t.name,[4,this.captureSection(t)];case 1:return n.sections=(o[a]=s.sent(),o),r=n,[2,r]}}))}))},e.prototype.captureSection=function(e){return __awaiter(this,void 0,l.Promise,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:return r={filters:i(e.filters,1)},[4,this.captureVisualContainers(e.visualContainers)];case 1:return r.visualContainers=n.sent(),t=r,[2,t]}}))}))},e.prototype.captureVisualContainers=function(e){return __awaiter(this,void 0,l.Promise,(function(){var t,r,n,a,o,s,l,u,c,p,f,d;return __generator(this,(function(h){switch(h.label){case 0:t={},r=0,n=e,h.label=1;case 1:return r<n.length?(a=n[r],(o=a.config.singleVisual)?(u=(l=_).union,c=[a.filters],[4,this.getAdditionalVisualFiltersToCapture(a)]):[3,3]):[3,4];case 2:s=u.apply(l,c.concat([h.sent()])),p={filters:i(s,0),singleVisual:{visualType:o.visualType,objects:this.captureVisualObjects(o.visualType,o.objects)}},f=a.visibility,null!=f&&0!==f&&(p.visibility=f),b.isHidden(o)&&(p.singleVisual.hidden=!0),d=o.query,d&&d.defn&&(p.singleVisual.orderBy=d.defn.orderBy()),d&&d.projections&&(p.singleVisual.activeProjections=this.captureActiveProjections(d)),t[a.name]=p,h.label=3;case 3:return r++,[3,1];case 4:return[2,t]}}))}))},e.prototype.captureActiveProjections=function(e){var t,r=e.defn.select();for(var i in e.projections){var n=e.projections[i],a=n.activeProjectionRefs;if(!_.isEmpty(a)){var o=_.map(a,(function(e){return r.withName(e).expr}));t||(t={}),t[i]=o}}return t},e.prototype.captureVisualObjects=function(e,t){var r=this.plugins.capabilities(e),i=null;if(!r||!r.objects)return{};var n=h.findFilterOutput(r.objects),a={};for(var o in r.objects){var s=r.objects[o];for(var l in s.properties){var u=s.properties[l];if(u.filterState||n&&o===n.objectName&&l===n.propertyName){var c={objectName:o,propertyName:l},p=d.getValue(t,c,i);p&&d.setValue(a,c,i,p)}}}var f={};return _.isEmpty(a)||(f.merge=a),f},e.prototype.apply=function(e,t,r){return __awaiter(this,void 0,l.Promise,(function(){var i,n,a,o,s,l,u;return __generator(this,(function(c){switch(c.label){case 0:return i={visualContainers:[]},this.applyActiveSection(e.activeSection,t,i),[4,this.applyFilters(e.filters,t,2,i,r.clearUnmatchedFilters,[])];case 1:c.sent(),n=[];for(a in e.sections)n.push(a);o=0,c.label=2;case 2:return o<n.length?(s=n[o],(l=f.findItemWithName(t.sections,s))?(u=e.sections[s],[4,this.applySection(u,l,i,r)]):[3,4]):[3,5];case 3:c.sent(),c.label=4;case 4:return o++,[3,2];case 5:return[2,i]}}))}))},e.prototype.applyActiveSection=function(e,t,r){if(e!==t.sections[t.activeSectionIndex].name){var i=f.indexWithName(t.sections,e);i>=0&&(t.activeSectionIndex=i,r.activeSection=!0)}},e.prototype.applyFilters=function(e,t,r,i,n,a){return __awaiter(this,void 0,l.Promise,(function(){var o,s,l,u,c;return __generator(this,(function(p){switch(p.label){case 0:return o=!1,s=[],l={nameIdentifiedMerges:_.clone(e&&e.nameIdentifiedMerges||{}),exprIdentifiedMerges:(e&&e.exprIdentifiedMerges||[]).slice(),typeIdentifiedMerges:(e&&e.typeIdentifiedMerges||[]).slice()},[4,this.applyRemainingFilters(l,t,0===r,s,a)];case 1:if(o=p.sent()||o,n&&t.filters)for(u=t.filters.length-1;u>=0;u--)c=t.filters[u],_.contains(s,c)||(2===c.howCreated?t.filters.splice(u,1):c.filter=void 0,o=!0);return o&&this.setMinimumFilterScope(i,r),[2,o]}}))}))},e.prototype.applyRemainingFilters=function(e,t,r,i,n){return __awaiter(this,void 0,l.Promise,(function(){var a;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.applyMatchingFilterByName(e,t,i)];case 1:return a=o.sent(),[4,this.applyMatchingFilterByExpr(e,t,r,i)];case 2:return a=o.sent()||a,a=this.applyMatchingFilterByType(e,t,i)||a,a=this.applyDrillFilters(e,t,i,n)||a,[2,a]}}))}))},e.prototype.applyMatchingFilterByName=function(e,t,r){return __awaiter(this,void 0,l.Promise,(function(){var i,n,o,s;return __generator(this,(function(l){if(_.isEmpty(e)||_.isEmpty(e.nameIdentifiedMerges)||_.isEmpty(t.filters))return[2,!1];i=!1,n=[],o=function(o){var s=e.nameIdentifiedMerges[o],l=_.findIndex(t.filters,(function(e,t){return e.howCreated===s.howCreated&&!_.contains(r,e)&&e.name===o}));l!==-1&&(g.isSameFilter(t.filters[l].filter,s.filter)||(t.filters[l]=a(s),i=!0),n.push(o),r.push(t.filters[l]))};for(s in e.nameIdentifiedMerges)o(s);return n.forEach((function(t){delete e.nameIdentifiedMerges[t]})),[2,i]}))}))},e.prototype.applyMatchingFilterByExpr=function(e,t,r,i){return __awaiter(this,void 0,l.Promise,(function(){var n,o,s,l,u,c,p;return __generator(this,(function(f){switch(f.label){case 0:if(_.isEmpty(e)||_.isEmpty(e.exprIdentifiedMerges))return[2,!1];n=!1,o=!1,l=e.exprIdentifiedMerges.slice(),c=function(){var c,f,d,h,m,v,b,x,S,x,w,x,S;return __generator(this,(function(E){switch(E.label){case 0:return c=u.howCreated,2===c?(l.splice(0,1),[2,"continue"]):(f=_.remove(l,(function(e){return e===u||e.howCreated===c&&y.equals(e.expression,u.expression)})),d=[],(t.filters||[]).forEach((function(e,t){e.howCreated===c&&!_.contains(i,e)&&y.equals(e.expression,u.expression)&&d.push(t)})),_.isEmpty(d)&&r&&0===c?u.filter?[3,1]:(_.remove(e.exprIdentifiedMerges,u),_.remove(f,u),[3,4]):[3,4]);case 1:return o?[3,3]:(o=!0,[4,p.conceptualSchemaProxy.get(p.dataSources.get())]);case 2:h=E.sent(),s=C.getAutoVisualFilterContainers(t,p.visualPluginOps,p.filterGenerator,h,p.aggrOps),E.label=3;case 3:m=_.find(s,(function(e){return y.equals(e.expression,u.expression)})),m&&((t.filters||(t.filters=[])).push(m),d.push(t.filters.length-1)),E.label=4;case 4:if(d.length>0){for(v=Math.min(f.length,d.length);f.length>v&&(b=_.remove(f,(function(e){return _.isEmpty(e.filter)})),_.remove(e.exprIdentifiedMerges,b),!_.isEmpty(b)););for(x=0;x<v;x++)S=d[x],g.isSameFilter(t.filters[S].filter,f[x].filter)||(t.filters[S].filter=f[x].filter,n=!0),i.push(t.filters[S]);for(x=v;x<f.length;x++)w=a(f[x]),(t.filters||(t.filters=[])).push(w),i.push(w),n=!0;for(x=v;x<d.length;x++)S=d[x],t.filters[S].filter=void 0,n=!0;e.exprIdentifiedMerges=_.difference(e.exprIdentifiedMerges,f)}return[2]}}))},p=this,f.label=1;case 1:return(u=_.first(l))?[5,c()]:[3,3];case 2:return f.sent(),[3,1];case 3:return[2,n]}}))}))},e.prototype.applyDrillFilters=function(e,t,r,i){var n=!1;if(_.isEmpty(i)||_.isEmpty(e)||_.isEmpty(e.exprIdentifiedMerges))return n;for(var o=[],s=function(e){if(2!==e.howCreated)return"continue";var s=_.find(i,(function(t){return y.equals(e.expression,t)}));if(!s)return"continue";var l=_.find(t.filters,(function(t){return 2===t.howCreated&&!_.contains(r,t)&&y.equals(t.expression,e.expression)}));if(l)g.isSameFilter(l.filter,e.filter)||(l.filter=e.filter,n=!0),r.push(l);else{var u=a(e);(t.filters||(t.filters=[])).push(u),r.push(u),n=!0}o.push(e)},l=0,u=e.exprIdentifiedMerges;l<u.length;l++){var c=u[l];s(c)}return e.exprIdentifiedMerges=_.difference(e.exprIdentifiedMerges,o),n},e.prototype.applyMatchingFilterByType=function(e,t,r){var i=!1;if(_.isEmpty(e)||_.isEmpty(e.typeIdentifiedMerges))return i;for(var n=[],o=function(e){var o=_.find(t.filters,(function(t){return t.howCreated===e.howCreated&&!_.contains(r,t)}));if(o)o.filter=e.filter,r.push(o);else{var s=a(e);(t.filters||(t.filters=[])).push(s),r.push(s)}n.push(e),i=!0},s=0,l=e.typeIdentifiedMerges;s<l.length;s++){var u=l[s];o(u)}return e.typeIdentifiedMerges=_.difference(e.typeIdentifiedMerges,n),i},e.prototype.applySection=function(e,t,r,i){return __awaiter(this,void 0,l.Promise,(function(){var n,a,o,s,l,u,c;return __generator(this,(function(p){switch(p.label){case 0:return[4,this.applyFilters(e.filters,t,1,r,i.clearUnmatchedFilters,[])];case 1:p.sent(),n=0,a=t.visualContainers,p.label=2;case 2:return n<a.length?(o=a[n],s=o.name,l=e.visualContainers&&e.visualContainers[s],u=!1,null==l?[3,4]:[4,this.applyVisualState(l,o,r,i)]):[3,8];case 3:return u=p.sent()||u,[3,6];case 4:return i.clearUnmatchedFilters?(c={},[4,this.applyVisualState(c,o,r,i)]):[3,6];case 5:u=p.sent()||u,p.label=6;case 6:u&&!_.contains(r.visualContainers,o)&&r.visualContainers.push(o),p.label=7;case 7:return n++,[3,2];case 8:return[2]}}))}))},e.prototype.applyVisualState=function(e,t,r,i){return __awaiter(this,void 0,l.Promise,(function(){var n,a,o,s,l,u,c,p,f,d;return __generator(this,(function(h){switch(h.label){case 0:return n=!1,a=this.plugins.capabilities(t.config.singleVisual.visualType),o=e.singleVisual,s=o&&o.objects,a&&a.objects?[4,this.applyObjects(t.config.singleVisual,s,a.objects,r)]:[3,2];case 1:n=h.sent()||n,h.label=2;case 2:return l=o&&o.orderBy,n=this.applySort(t.config.singleVisual,l)||n,u=o&&o.activeProjections,c=this.applyActiveProjections(t.config.singleVisual,u),n=c||n,p=this.collectValidDrillExprs(t.config.singleVisual),[4,this.applyFilters(e.filters,t,0,r,i.clearUnmatchedFilters,p)];case 3:return n=h.sent()||n,f=e.visibility,null!=f&&(r.visibility={visual:t,mode:f}),d=o&&o.hidden,n=this.applyHidden(!!d,t)||n,[2,n]}}))}))},e.prototype.applyHidden=function(e,t){var r=t.config.singleVisual;return e!==b.isHidden(r)&&(b.setHidden(r,e),!0)},e.prototype.collectValidDrillExprs=function(e){var t=e.query;if(!t)return[];var r=t.defn.select();if(_.isEmpty(r))return[];var i=[];for(var n in t.projections)for(var a=t.projections[n],o=a.activeProjectionRefs||[],s=0;s<o.length-1;s++){var l=o[s],u=r.withName(l);i.push(u.expr)}return i},e.prototype.applyActiveProjections=function(e,t){var r=e.query;if(!r)return!1;var i=r.defn.select(),n=this.plugins.capabilities(e.visualType),a=n&&n.drilldown&&n.drilldown.roles||[],o=!1,s={},l=function(e){if(!_.contains(a,e))return"continue";var n=t[e];s[e]||(s[e]=[]);var l=r.projections[e];if(!l)return o=!0,"continue";var u=l.all();if(_.isEmpty(u))return o=!0,"continue";if(n.length>u.length)return o=!0,"continue";if(1===n.length){var c=n[0],p=_.find(u,(function(e){var t=i.withName(e.queryRef);return y.equals(t.expr,c)}));if(!p)return o=!0,"continue";s[e].push(p.queryRef)}else for(var f=0;f<n.length;f++){var d=n[f],h=u[f],m=i.withName(h.queryRef);y.equals(m.expr,d)?s[e].push(h.queryRef):o=!0}};for(var u in t)l(u);if(o)for(var u in r.projections)s[u]=[];var c=!1;for(var u in r.projections)if(_.contains(a,u)){var p=r.projections[u],d=s[u];if(_.isEmpty(d)){var h=p.all();_.isEmpty(h)||(d=[_.first(h).queryRef])}f.sequenceEqual(p.activeProjectionRefs,d,(function(e,t){return e===t}))||(p.activeProjectionRefs=d,c=!0)}return c},e.prototype.applySort=function(e,t){var r=e.query;if(!r)return!1;var i=r.defn.orderBy()||[];return t||(t=[]),!f.sequenceEqual(i,t,u.SQUtils.sqSortDefinitionEquals)&&(r.orderBy(t),!0)},e.prototype.applyObjects=function(e,t,r,i){return __awaiter(this,void 0,l.Promise,(function(){var n,a,o,s,l,u,c,p,f,v,g,y,b,C,x,S,w,E,F,P,V,D,R,v,E;return __generator(this,(function(T){switch(T.label){case 0:if(n=e.objects||{},a=h.findFilterOutput(r),s=t&&t.merge,l=this.getVisualPropertiesToRemove(e.visualType,n,s),_.isEmpty(s))return[3,9];u=s,c=[];for(p in u)c.push(p);f=0,T.label=1;case 1:if(!(f<c.length))return[3,9];v=c[f],g=0,y=u[v],T.label=2;case 2:if(!(g<y.length))return[3,8];b=y[g],C=d.ensure(n,v,b.selector),x=[];for(S in b.properties)x.push(S);w=0,T.label=3;case 3:return w<x.length?(E=x[w],F=b.properties[E],d.propertiesAreEqual(C.properties[E],F)?[3,6]:a&&m.propertyIdentifiersEqual(a,{objectName:v,propertyName:E})?[4,this.isFilterValid(F,e)]:[3,5]):[3,7];case 4:if(!T.sent())return l.push({object:a.objectName,property:a.propertyName,selector:null}),[3,6];this.setMinimumFilterScope(i,1),T.label=5;case 5:C.properties[E]=F,o=!0,e.objects||(e.objects=n),T.label=6;case 6:return w++,[3,3];case 7:return g++,[3,2];case 8:return f++,[3,1];case 9:if(!_.isEmpty(l))for(P=0,V=l;P<V.length;P++)D=V[P],R=D.selector,v=D.object,E=D.property,d.deleteProperty(n,v,R,E)&&(o=!0,a&&m.propertyIdentifiersEqual(a,{objectName:v,propertyName:E})&&this.setMinimumFilterScope(i,1));return[2,o]}}))}))},e.prototype.getVisualPropertiesToRemove=function(e,t,r){var i=this.plugins.capabilities(e),n=null;if(!i||!i.objects)return[];var a=h.findFilterOutput(i.objects),o=[];for(var s in i.objects){var l=i.objects[s];for(var u in l.properties){var c=l.properties[u];if(c.filterState||a&&m.propertyIdentifiersEqual(a,{objectName:s,propertyName:u})){var p={objectName:s,propertyName:u},f=d.getValue(r,p,n),v=d.getValue(t,p,n);v&&!f&&o.push({object:s,property:u,selector:n})}}}return o},e.prototype.isFilterValid=function(e,t){return __awaiter(this,void 0,l.Promise,(function(){var r,i,n;return __generator(this,(function(a){switch(a.label){case 0:return r=t.query,r?[4,this.conceptualSchemaProxy.get(this.dataSources.get())]:[2,!1];case 1:return i=a.sent(),n=new S(r.defn,i),e.rewrite(n),[2,n.valid]}}))}))},e.prototype.setMinimumFilterScope=function(e,t){return e.filterScope?void(e.filterScope=Math.max(t,e.filterScope)):void(e.filterScope=t)},e.prototype.getAdditionalVisualFiltersToCapture=function(e){return __awaiter(this,void 0,l.Promise,(function(){var t,r,i,n,a,o,s;return __generator(this,(function(l){switch(l.label){case 0:return t=[],[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:for(r=l.sent(),i=C.getAutoVisualFilterContainers(e,this.visualPluginOps,this.filterGenerator,r,this.aggrOps)||[],n=function(r){_.find(e.filters,(function(e){return y.equals(e.expression,r.expression)}))||t.push(r)},a=0,o=i;a<o.length;a++)s=o[a],n(s);return[2,t]}}))}))},e})(),S=(function(e){function t(t,r){var i=this;return i=e.call(this)||this,i.valid=!0,i.query=t,i.schema=r,i}return __extends(t,e),t.prototype.visitColumnRef=function(e){return this.valid=this.valid&&this.exprInSelects(e),e},t.prototype.exprInSelects=function(e){if(this.query.selectNameOf(e))return!0;for(var t=this.query.select(),r=0,i=t;r<i.length;r++){var n=i[r],a=n.expr.getKeyColumns(this.schema);if(_.any(a,(function(t){return y.equals(e,t)})))return!0}return!1},t})(u.SQExprRewriter)}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new a(e,t,r)}var n=t.util.VisualContainerUtils;r.createVisibilityService=i;var a=(function(){function t(e,t,i){var n=this;this.telemetryService=e,this.eventBridge=t,this.selectionService=i,this.eventBridge=t,this.selectionService=i,t.createChannelSubscriptionManager().subscribe(r.events.selectionChanged,(function(){return n.updatePopOutMode()}))}return t.prototype.get=function(e){var t=this.item;if(t)return e||(e=11),e&t.visibility?t.visualContainer:void 0},t.prototype.set=function(e,t,i){if(void 0===i&&(i=!0),0===t)return void this.clear(!0,i);r.selectionUtils.selectVisualContainer(e,this.selectionService);var n=new o(e,t);o.equals(n,this.item)||(this.clear(!1,!1),this.setMode(n,t,i),this.item=n,this.raiseEvent())},t.prototype.clear=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this.item&&(this.setMode(this.item,0,t),this.item=void 0,e&&this.raiseEvent())},t.prototype.isSeeDataMode=function(e){return e&&(2===e||8===e)},t.prototype.updatePopOutMode=function(){var e=r.selectionUtils.getDefaultSelectedVisualInSingleOrMultiCase(this.selectionService);e&&null!=e.visibility&&0!==e.visibility?this.set(e,e.visibility,!1):this.clear(!0,!1)},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(r.events.visibilityChanged)},t.prototype.setMode=function(t,r,i){var a=t.visualContainer;!i||2!==a.visibility&&2!==r||this.telemetryService.logEvent(e.telemetry.EXToggleSeeData,n.getVisualType(a),2===r),a.visibility=r},t})(),o=(function(){function e(e,t){this.visual=e,this.mode=t}return Object.defineProperty(e.prototype,"id",{get:function(){if(this.visual)return this.visual.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualContainer",{get:function(){return this.visual},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{get:function(){return this.mode},enumerable:!0,configurable:!0}),e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.id===t.id&&e.visualContainer===t.visualContainer&&e.visibility===t.visibility)},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new o(e)}var n=e.data.DataViewObjectDescriptors,a=t.util.VisualContainerUtils;r.createVisualPluginOps=i;var o=(function(){function t(e){this.plugins=e}return t.prototype.canEdit=function(t,r){var i=this.plugins.capabilities(t),n=i&&i.advancedEditModeSupport;switch(n){case 1:return!0;case 2:return r;default:return t===e.visualHost.EsriVisual||t===e.visualHost.SandDanceVisual}},t.prototype.dataViewKinds=function(t,r){if(t){var i=this.plugins.capabilities(t);if(i){var n=i.dataViewMappings,o=e.DataViewMapping.targetDataViewKinds(n);if(r){var s=a.createRoleKindByQueryRef(r),l=e.DataViewAnalysis.chooseDataViewMappings(r.projections,n,s);o=e.DataViewMapping.targetDataViewKinds(l.supportedMappings)}return o?(1&o&&(o|=2),o):void 0}}},t.prototype.supportsFocusMode=function(e){var t=this.plugins.capabilities(e);return t&&t.dataViewMappings&&!t.disableFocusMode},t.prototype.isSupportedVisual=function(e){var t=a.getVisualType(e);return!!t&&!!this.plugins.getPlugin(t)},t.prototype.canConvertVisual=function(e){if(!e)return!1;var t=a.getVisualType(e);return!!t&&(this.isQueryVisual(t)&&!a.hasGroupByItemsInQuery(e))},t.prototype.canFormatVisual=function(e){return!!e&&!a.hasGroupByItemsInQuery(e)},t.prototype.isQueryVisual=function(e){var t=this.plugins.capabilities(e);return!t||!this.isQueryDisabled(e,t)&&null!=t.dataViewMappings},t.prototype.isQueryDisabled=function(t,r){return!!e.visualHost.utils.shouldDisableVisual(t,e.common.localize.shouldDisableMap())||(r&&e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings)?!this.plugins.isScriptVisualQueryable():void 0)},t.prototype.supportVisualSearch=function(e){var t=this.plugins.capabilities(e);return!(!t||!this.isQueryVisual(e))&&!!n.findSelfFilter(t.objects)},t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return new n(e)}var i=e.explore.contracts.createDataSourceArray;t.createDataSourceSerializer=r;var n=(function(){function e(e){this.explorationSerializer=e}return e.prototype.deserializeDataSources=function(e){var t=this;if(e)return i(_.map(e,(function(e){return t.deserializeDataSource(e)})))},e.prototype.deserializeDataSource=function(e){if(e){var t={id:e.id,name:e.name};return e.type&&(t.type=e.type),e.packageId&&(t.packageId=e.packageId),e.extends&&(t.extends=e.extends),e.dsr&&(t.dsr=this.deserializeExecuteSemanticQueryDataSource(e.dsr)),e.exploration&&(t.exploration=this.deserializeExplorationDataReaderDataSource(e.exploration)),t}},e.prototype.deserializeExecuteSemanticQueryDataSource=function(e){if(e){var t={schemaName:e.schemaName};return e.vsName&&(t.vsName=e.vsName),e.dbName&&(t.dbName=e.dbName),e.modelId&&(t.modelId=e.modelId),t}},e.prototype.deserializeExplorationDataReaderDataSource=function(e){if(e){var t=this.explorationSerializer.deserializeModelExtensions(e.modelExtensions);return{extends:e.extends,schemaName:e.schemaName,getModelExtensions:function(){return t}}}},e.prototype.serializeDataSources=function(e){var t=this;if(e)return _.map(e,(function(e){return t.serializeDataSource(e)}))},e.prototype.serializeDataSource=function(e){if(e){var t={id:e.id,name:e.name};return e.type&&(t.type=e.type),e.packageId&&(t.packageId=e.packageId),e.extends&&(t.extends=e.extends),e.dsr&&(t.dsr=this.serializeExecuteSemanticQueryDataSource(e.dsr)),e.exploration&&(t.exploration=this.serializeExplorationDataReaderDataSource(e.exploration)),t}},e.prototype.serializeExecuteSemanticQueryDataSource=function(e){if(e){var t={schemaName:e.schemaName};return e.vsName&&(t.vsName=e.vsName),e.dbName&&(t.dbName=e.dbName),e.modelId&&(t.modelId=e.modelId),t}},e.prototype.serializeExplorationDataReaderDataSource=function(e){if(e)return{extends:e.extends,schemaName:e.schemaName,modelExtensions:this.explorationSerializer.serializeModelExtensions(e.getModelExtensions())}},e})();t.DataSourceSerializer=n})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(e){return{activeSection:e.activeSection,filters:i(e.filters),sections:_.mapValues(e.sections,a)}}function i(e){if(e){var t={};return e.byName&&(t.nameIdentifiedMerges=_.mapValues(e.byName,n)),e.byExpr&&(t.exprIdentifiedMerges=_.map(e.byExpr,n)),e.byType&&(t.typeIdentifiedMerges=_.map(e.byType,n)),t}}function n(e){return{name:e.name,type:E.FilterType[e.type],filter:e.filter?V.deserializeFilter(e.filter):void 0,expression:e.expression?V.deserializeExpr(e.expression):void 0,restatement:e.restatement,howCreated:e.howCreated,precedence:e.precedence}}function a(e){return{filters:i(e.filters),visualContainers:_.mapValues(e.visualContainers,o)}}function o(e){var t=s(e.singleVisual);return{filters:i(e.filters),singleVisual:t,visibility:p(e.singleVisual.display)}}function s(e){var t={visualType:e.visualType,objects:u(e.objects)};return e.orderBy&&(t.orderBy=V.deserializeSortDefinitions(e.orderBy,null)),e.activeProjections&&(t.activeProjections=l(e.activeProjections)),e.display&&"hidden"===e.display.mode&&(t.hidden=!0),t}function l(e){var t;for(var r in e){var i=e[r];_.isEmpty(i)||(t||(t={}),t[r]=_.map(i,(function(e){return V.deserializeExpr(e)})))}return t}function u(e){var t={},r=null;return e.merge&&(t.merge=P.deserializeObjects(e.merge,r)),e.remove&&(t.remove=_.map(e.remove,c)),t}function c(e){return{object:e.object,property:e.property,selector:P.deserializeSelector(e.selector)}}function p(e){if(e&&e.mode)switch(e.mode){case"maximize":var t=e.maximizedOptions&&e.maximizedOptions.dataTable;switch(t){case"accessible":return 8;case"normal":return 2;default:return 1}case"spotlight":return 4}}function f(e){return{version:F.v1_0,activeSection:e.activeSection,filters:d(e.filters),sections:_.mapValues(e.sections,m)}}function d(e){if(e){var t={};return e.nameIdentifiedMerges&&(t.byName=_.mapValues(e.nameIdentifiedMerges,h)),e.exprIdentifiedMerges&&(t.byExpr=_.map(e.exprIdentifiedMerges,h)),e.typeIdentifiedMerges&&(t.byType=_.map(e.typeIdentifiedMerges,h)),t}}function h(e){return{name:e.name,type:null!=e.type?E.FilterType[e.type]:void 0,filter:e.filter?V.serializeFilter(e.filter):void 0,expression:e.expression?V.serializeExpr(e.expression):void 0,restatement:e.restatement,howCreated:e.howCreated}}function m(e){return{filters:d(e.filters),visualContainers:_.mapValues(e.visualContainers,v)}}function v(e){return{filters:d(e.filters),singleVisual:g(e.singleVisual,e.visibility)}}function g(e,t){var r={visualType:e.visualType,objects:b(e.objects)};return e.orderBy&&(r.orderBy=V.serializeSortDefinitions(e.orderBy,!0)),e.activeProjections&&(r.activeProjections=y(e.activeProjections)),e.hidden?r.display={mode:"hidden"}:t&&(r.display=x(t)),r}function y(e){var t;for(var r in e){var i=e[r];_.isEmpty(i)||(t||(t={}),t[r]=_.map(i,(function(e){return V.serializeExpr(e)})))}return t}function b(e){var t={},r=null;return e.merge&&(t.merge=P.serializeObjects(e.merge,r)),e.remove&&(t.remove=_.map(e.remove,C)),t}function C(e){return{object:e.object,property:e.property,selector:P.serializeSelector(e.selector)||null}}function x(e){switch(e){case 1:return{mode:"maximize"};case 2:return{mode:"maximize",maximizedOptions:{dataTable:"normal"}};case 8:return{mode:"maximize",maximizedOptions:{dataTable:"accessible"}};case 4:return{mode:"spotlight"}}}var S=e,w=S.explore,E=w.contracts,F=w.services.upgrade.ExplorationStateVersions,P=S.data.services.DataViewObjectSerializer,V=S.data.services.SemanticQuerySerializer;t.deserialize=r,t.serialize=f,t.serializeFilterContainer=h})(r=t.ExplorationState||(t.ExplorationState={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));;"use strict";var __extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}})(),__awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(o,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function s(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,n&&(a=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,n=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],n=0}finally{o=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__assign=this&&this.__assign||Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},powerbi;!(function(e){var t;!(function(t){function i(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y,w,S,b,C,x,M){var D=t.CustomerAction(f,m,y,w,S,b,C,x,M),F=ie(D.info,{reportGuid:i,originalReportGuid:r,appGuid:o,isDirectQuery:n,isCancelled1:a,isOnPrem:s,source:l,isUsageMetrics:c,groupObjectId:u,visualTypesAndCounts:p,tags:d,isReadonlyGroup:h,permissions:v,scrubUserInfo:g}),E={name:"PBI.EX.OpenExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({reportGuid:F.reportGuid,originalReportGuid:F.originalReportGuid,appGuid:F.appGuid,isDirectQuery:F.isDirectQuery,isCancelled1:F.isCancelled1,isOnPrem:F.isOnPrem,source:he[F.source],visualTypesAndCounts:F.visualTypesAndCounts,permissions:F.permissions},{isUsageMetrics:F.isUsageMetrics,groupObjectId:F.groupObjectId,tags:F.tags,isReadonlyGroup:F.isReadonlyGroup,scrubUserInfo:F.scrubUserInfo},D.formatted())},info:F,loggers:t.EXOpenExplorationLoggers};return E}function r(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{reportGuid:i,sectionIndex:r}),g={name:"PBI.EX.RefreshReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({reportGuid:v.reportGuid,sectionIndex:v.sectionIndex},null,h.formatted())},info:v,loggers:t.EXRefreshReportLoggers};return g}function o(i,r,o,n,a,s,l,c,u,p){var d=t.CustomerAction(r,o,n,a,s,l,c,u,p),h=ie(d.info,{isSaveAs:i}),v={name:"PBI.EX.SaveExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({isSaveAs:h.isSaveAs},null,d.formatted())},info:h,loggers:t.EXSaveExplorationLoggers};return v}function n(i,r,o,n,a,s,l,c,u,p,d){var h=t.Verbose(o,n,a,s,l,c,u,p,d),v=ie(h.info,{sourceVisualType:i,targetVisualType:r}),g={name:"PBI.EX.InteractionVisualConversion",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({sourceVisualType:v.sourceVisualType,targetVisualType:v.targetVisualType},null,h.formatted())},info:v,loggers:t.EXInteractionVisualConversionLoggers};return g}function a(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{sourceVisualType:i,isInlineHierarchyEnabled:r}),g={name:"PBI.EX.InteractionExpand",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({sourceVisualType:v.sourceVisualType,isInlineHierarchyEnabled:v.isInlineHierarchyEnabled},null,h.formatted())},info:v,loggers:t.EXInteractionExpandLoggers};return g}function s(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{sourceVisualType:i,isDrillDown:r}),g={name:"PBI.EX.InteractionDrill",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({sourceVisualType:v.sourceVisualType,isDrillDown:v.isDrillDown},null,h.formatted())},info:v,loggers:t.EXInteractionDrillLoggers};return g}function l(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{sourceVisualType:i,targetExprKind:r}),g={name:"PBI.EX.DrillToDetails",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({sourceVisualType:v.sourceVisualType,targetExprKind:oe[v.targetExprKind]},null,h.formatted())},info:v,loggers:t.EXDrillToDetailsLoggers};return g}function c(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(a,s,l,c,u,p,d,h,v),f=ie(g.info,{filterType:i,filterScopeType:r,fieldKind:o,drillToDetailsMode:n}),m={name:"PBI.EX.AddFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({filterType:ae[f.filterType],filterScopeType:ne[f.filterScopeType],fieldKind:oe[f.fieldKind],drillToDetailsMode:f.drillToDetailsMode},null,g.formatted())},info:f,loggers:t.EXAddFilterLoggers};return m}function u(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{isVisualFilter:i,filterType:r}),g={name:"PBI.EX.FilterPaneAdvancedFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({isVisualFilter:v.isVisualFilter,filterType:v.filterType},null,h.formatted())},info:v,loggers:t.EXFilterPaneAdvancedFilterAppliedLoggers};return g}function p(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(a,s,l,c,u,p,d,h,v),f=ie(g.info,{isTop:i,itemCount:r,atGrain:o,onVisualMeasure:n}),m={name:"PBI.EX.FilterPaneTopNFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({isTop:f.isTop,itemCount:f.itemCount,atGrain:f.atGrain,onVisualMeasure:f.onVisualMeasure},null,g.formatted())},info:f,loggers:t.EXFilterPaneTopNFilterAppliedLoggers};return m}function d(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(s,l,c,u,p,d,h,v,g),m=ie(f.info,{relativeQualifier:i,duration:r,relativeUnit:o,includeToday:n,isCalendarPeriod:a}),y={name:"PBI.EX.FilterPaneRelativeDateFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({relativeQualifier:ge[m.relativeQualifier],duration:m.duration,relativeUnit:fe[m.relativeUnit],includeToday:m.includeToday,isCalendarPeriod:m.isCalendarPeriod},null,f.formatted())},info:m,loggers:t.EXFilterPaneRelativeDateFilterAppliedLoggers};return y}function h(i){var r={message:i},o={name:"PBI.EX.LoadFilterError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({message:r.message},null)},info:r,loggers:t.EXLoadFilterErrorLoggers};return o}function v(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{source:i,visualType:r}),g={name:"PBI.EX.CreateVisual",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({source:se[v.source],visualType:v.visualType},null,h.formatted())},info:v,loggers:t.EXCreateVisualLoggers};return g}function g(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f){var m=t.Verbose(l,c,u,p,d,h,v,g,f),y=ie(m.info,{source:i,targetVisualType:r,fieldKind:o,drillToDetailsMode:n,success:a,quickMeasureTemplateName:s}),w={name:"PBI.EX.AddField",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({source:le[y.source],targetVisualType:y.targetVisualType,fieldKind:oe[y.fieldKind],drillToDetailsMode:y.drillToDetailsMode,success:y.success,quickMeasureTemplateName:y.quickMeasureTemplateName},null,m.formatted())},info:y,loggers:t.EXAddFieldLoggers};return w}function f(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.Verbose(a,s,l,c,u,p,d,h,v),f=ie(g.info,{loadType:i,onPrem:r,loadTypeWarnings:o,whereVisualIsLoaded:n}),m={name:"PBI.EX.VisualFirstLoad",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({loadType:ce[f.loadType],onPrem:f.onPrem,loadTypeWarnings:ue[f.loadTypeWarnings],whereVisualIsLoaded:f.whereVisualIsLoaded},null,g.formatted())},info:f,loggers:t.EXVisualFirstLoadLoggers};return m}function m(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{original:i,target:r}),g={name:"PBI.EX.ChangeQuickCalc",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({original:v.original,target:v.target},null,h.formatted())},info:v,loggers:t.EXChangeQuickCalcLoggers};return g}function y(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(n,a,s,l,c,u,p,d,h),g=ie(v.info,{visualType:i,diverging:r,userValueSpecified:o}),f={name:"PBI.EX.SetConditionalFormatting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({visualType:g.visualType,diverging:g.diverging,userValueSpecified:g.userValueSpecified},null,v.formatted())},info:g,loggers:t.EXSetConditionalFormattingLoggers};return f}function w(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.Verbose(n,a,s,l,c,u,p,d,h),g=ie(v.info,{visualType:i,userValueSpecified:r,fromPropertyPane:o}),f={name:"PBI.EX.SetDataBars",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({visualType:g.visualType,userValueSpecified:g.userValueSpecified,fromPropertyPane:g.fromPropertyPane},null,v.formatted())},info:g,loggers:t.EXSetDataBarsLoggers};return f}function S(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(a,s,l,c,u,p,d,h,v),f=ie(g.info,{totalVisuals:i,numberOfScriptVisuals:r,visualIds:o,userLicense:n}),m={name:"PBI.EX.ExplorationRefresh",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({totalVisuals:f.totalVisuals,numberOfScriptVisuals:f.numberOfScriptVisuals,visualIds:f.visualIds,userLicense:f.userLicense},null,g.formatted())},info:f,loggers:t.EXExplorationRefreshLoggers};return m}function b(i,r,o,n,a,s,l,c,u){var p=t.CustomerAction(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.SnapshotEmbedCreate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXSnapshotEmbedCreateLoggers};return h}function C(i,r,o,n,a,s,l,c,u){var p=t.CustomerAction(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.PublicEmbedCreate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXPublicEmbedCreateLoggers};return h}function x(i,r,o,n,a,s,l,c,u){var p=t.CustomerAction(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.SnapshotEmbedDelete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXSnapshotEmbedDeleteLoggers};return h}function M(i,r,o,n,a,s,l,c,u){var p=t.CustomerAction(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.SnapshotEmbedUpdate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXSnapshotEmbedUpdateLoggers};return h}function D(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(n,a,s,l,c,u,p,d,h),g=ie(v.info,{fileName:i,resourcePackageId:r,resourcePackageName:o}),f={name:"PBI.EX.ImportCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({fileName:g.fileName,resourcePackageId:g.resourcePackageId,resourcePackageName:g.resourcePackageName},null,v.formatted())},info:g,loggers:t.EXImportCustomVizLoggers};return f}function F(i,r,o,n,a,s,l,c,u,p){var d=t.CustomerAction(r,o,n,a,s,l,c,u,p),h=ie(d.info,{customVisualName:i}),v={name:"PBI.EX.DeleteCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({customVisualName:h.customVisualName},null,d.formatted())},info:h,loggers:t.EXDeleteCustomVizLoggers};return v}function E(i,r,o,n,a,s,l,c,u,p){var d=t.CustomerAction(r,o,n,a,s,l,c,u,p),h=ie(d.info,{whereVisualIsLoaded:i}),v={name:"PBI.EX.EnableCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({whereVisualIsLoaded:h.whereVisualIsLoaded},null,d.formatted())},info:h,loggers:t.EXEnableCustomVizLoggers};return v}function V(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(n,a,s,l,c,u,p,d,h),g=ie(v.info,{sourceVisualType:i,targetVisualType:r,filterAction:o}),f={name:"PBI.EX.VisualRelationshipOverride",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({sourceVisualType:g.sourceVisualType,targetVisualType:g.targetVisualType,filterAction:g.filterAction},null,v.formatted())},info:g,loggers:t.EXVisualRelationshipOverrideLoggers};return f}function P(i,r,o,n,a,s,l,c,u){var p=t.CustomerAction(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.CodePaneUserRunScript",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXCodePaneUserRunScriptLoggers};return h}function T(i,r,o,n,a,s,l,c,u){var p=t.CustomerAction(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.CodePaneUserEditScriptWithExternalIDE",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXCodePaneUserEditScriptWithExternalIDELoggers};return h}function A(i,r,o,n,a,s,l,c,u){var p=t.CustomerAction(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.CodePaneUserOpenOptionsDialog",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXCodePaneUserOpenOptionsDialogLoggers};return h}function I(i,r){var o={launchExternalIDEFailureType:i,message:r},n={name:"PBI.EX.CodePaneLaunchExternalIDEFailed",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({launchExternalIDEFailureType:pe[o.launchExternalIDEFailureType],message:o.message},null)},info:o,loggers:t.EXCodePaneLaunchExternalIDEFailedLoggers};return n}function k(i,r,o,n,a,s,l,c,u){var p=t.CustomerAction(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.CodePaneLaunchExternalIDESucceeded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXCodePaneLaunchExternalIDESucceededLoggers};return h}function L(i,r){var o={warningKey:i,message:r},n={name:"PBI.EX.CodePaneShowWarning",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({warningKey:o.warningKey,message:o.message},null)},info:o,loggers:t.EXCodePaneShowWarningLoggers};return n}function R(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m){var y=t.CustomerAction(c,u,p,d,h,v,g,f,m),w=ie(y.info,{visualType:i,source:r,isPartialResult:o,dest:n,isPremiumUser:a,isDrillToDetailsMode:s,dataType:l}),S={name:"PBI.EX.ExportVisualData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({visualType:w.visualType,source:re[w.source],isPartialResult:w.isPartialResult,dest:w.dest,isPremiumUser:w.isPremiumUser,isDrillToDetailsMode:w.isDrillToDetailsMode,dataType:w.dataType},null,y.formatted())},info:w,loggers:t.EXExportVisualDataLoggers};return S}function _(i,r,o,n,a,s,l,c,u,p,d,h,v){var g=t.CustomerAction(a,s,l,c,u,p,d,h,v),f=ie(g.info,{countTotalVisuals:i,countScriptVisuals:r,visualIds:o,userLicense:n}),m={name:"PBI.EX.LoadReportWithScriptVis",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({countTotalVisuals:f.countTotalVisuals,countScriptVisuals:f.countScriptVisuals,visualIds:f.visualIds,userLicense:f.userLicense},null,g.formatted())},info:f,loggers:t.EXLoadReportWithScriptVisLoggers};return m}function O(i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y){var w=t.Verbose(u,p,d,h,v,g,f,m,y),S=ie(w.info,{reportId:i,reportGuid:r,sectionIndex:o,sectionGuid:n,groupObjectId:a,isReadonlyGroup:s,permissions:l,scrubUserInfo:c}),b={name:"PBI.ExploreHost.ChangeReportPage",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({reportId:S.reportId,reportGuid:S.reportGuid,sectionIndex:S.sectionIndex,permissions:S.permissions},{sectionGuid:S.sectionGuid,groupObjectId:S.groupObjectId,isReadonlyGroup:S.isReadonlyGroup,scrubUserInfo:S.scrubUserInfo},w.formatted())},info:S,loggers:t.ExploreHostChangeReportPageLoggers};return b}function B(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{reportId:i,numberOfVisualsRemoved:r}),g={name:"PBI.EX.RemoveMobileCanvasVisuals",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({reportId:v.reportId,numberOfVisualsRemoved:v.numberOfVisualsRemoved},null,h.formatted())},info:v,loggers:t.EXRemoveMobileCanvasVisualsLoggers};return g}function z(i,r,o,n,a,s,l,c,u,p){var d=t.Verbose(r,o,n,a,s,l,c,u,p),h=ie(d.info,{reportGuid:i}),v={name:"PBI.EX.LoadReportContainer",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({reportGuid:h.reportGuid},null,d.formatted())},info:h,loggers:t.EXLoadReportContainerLoggers};return v}function N(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.Verbose(n,a,s,l,c,u,p,d,h),g=ie(v.info,{reportGuid:i,isDirectQuery:r,isOnPrem:o}),f={name:"PBI.EX.InitExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({reportGuid:g.reportGuid,isDirectQuery:g.isDirectQuery,isOnPrem:g.isOnPrem},null,v.formatted())},info:g,loggers:t.EXInitExplorationLoggers};return f}function H(i,r,o,n,a,s,l,c,u){var p=t.Verbose(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.LoadExplorationVisuals",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXLoadExplorationVisualsLoggers};return h}function U(i,r,o,n,a,s,l,c,u){var p=t.Verbose(i,r,o,n,a,s,l,c,u),d=ie(p.info,{}),h={name:"PBI.EX.LoadExplorationSchema",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:d,loggers:t.EXLoadExplorationSchemaLoggers};return h}function $(i,r,o,n,a,s,l,c,u,p){var d=t.Verbose(r,o,n,a,s,l,c,u,p),h=ie(d.info,{visualType:i}),v={name:"PBI.EX.RenderExplorationVisual",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({visualType:h.visualType},null,d.formatted())},info:h,loggers:t.EXRenderExplorationVisualLoggers,logRatio:.01};return v}function G(i,r,o,n,a,s,l,c,u,p){var d=t.Verbose(r,o,n,a,s,l,c,u,p),h=ie(d.info,{reportGuid:i}),v={name:"PBI.EX.FetchExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({reportGuid:h.reportGuid},null,d.formatted())},info:h,loggers:t.EXFetchExplorationLoggers};return v}function j(i,r,o,n,a,s,l,c,u,p,d,h){var v=t.CustomerAction(n,a,s,l,c,u,p,d,h),g=ie(v.info,{sourceLayout:i,targetLayout:r,viewMode:o}),f={name:"PBI.EX.ChangeCanvasLayout",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({sourceLayout:t.CanvasLayout[g.sourceLayout],targetLayout:t.CanvasLayout[g.targetLayout],viewMode:de[g.viewMode]},null,v.formatted())},info:g,loggers:t.EXChangeCanvasLayoutLoggers};return f}function Q(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(s,l,c,u,p,d,h,v,g),m=ie(f.info,{numberOfClusters:i,visualType:r,numberOfMeasures:o,numberOfDimensions:n,numberOfFilters:a}),y={name:"PBI.EX.Clustering.AddClustering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({numberOfClusters:m.numberOfClusters,visualType:m.visualType,numberOfMeasures:m.numberOfMeasures,numberOfDimensions:m.numberOfDimensions,numberOfFilters:m.numberOfFilters},null,f.formatted())},info:m,loggers:t.EXClusteringAddClusteringLoggers};return y}function W(i,r,o,n,a,s,l,c,u,p,d,h,v,g){var f=t.CustomerAction(s,l,c,u,p,d,h,v,g),m=ie(f.info,{updatedName:i,updatedDescription:r,updatedClusterNames:o,updatedNumberOfClusters:n,newNumberOfClusters:a}),y={name:"PBI.EX.Clustering.EditClustering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({updatedName:m.updatedName,updatedDescription:m.updatedDescription,updatedClusterNames:m.updatedClusterNames,updatedNumberOfClusters:m.updatedNumberOfClusters,newNumberOfClusters:m.newNumberOfClusters},null,f.formatted())},info:m,loggers:t.EXClusteringEditClusteringLoggers};return y}function q(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{entryPoint:i,numberOfSelects:r}),g={name:"PBI.EX.QuickMeasures.OpenDialog",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({entryPoint:ve[v.entryPoint],numberOfSelects:v.numberOfSelects},null,h.formatted())},info:v,loggers:t.EXQuickMeasuresOpenDialogLoggers};return g}function X(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{selectedQuickMeasure:i,connectionType:r}),g={name:"PBI.EX.QuickMeasures.DialogResult",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({selectedQuickMeasure:v.selectedQuickMeasure,connectionType:v.connectionType},null,h.formatted())},info:v,loggers:t.EXQuickMeasuresDialogResultLoggers};return g}function K(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{selectedQuickMeasure:i,isLast:r}),g={name:"PBI.EX.QuickMeasures.OnMeasureChange",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({selectedQuickMeasure:v.selectedQuickMeasure,isLast:v.isLast},null,h.formatted())},info:v,loggers:t.EXQuickMeasuresOnMeasureChangeLoggers};return g}function Y(i,r,o,n,a,s,l,c,u,p){var d=t.CustomerAction(r,o,n,a,s,l,c,u,p),h=ie(d.info,{entryPoint:i}),v={name:"PBI.EX.Drillthrough.GotoTarget",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({entryPoint:me[h.entryPoint]},null,d.formatted())},info:h,loggers:t.EXDrillthroughGotoTargetLoggers};return v}function J(i,r,o,n,a,s,l,c,u,p,d){var h=t.CustomerAction(o,n,a,s,l,c,u,p,d),v=ie(h.info,{type:i,countOfCurrentPageDrillthroughFilters:r}),g={name:"PBI.EX.Drillthrough.FilterUpdate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({type:ye[v.type],countOfCurrentPageDrillthroughFilters:v.countOfCurrentPageDrillthroughFilters},null,h.formatted())},info:v,loggers:t.EXDrillthroughFilterUpdateLoggers};return g}function Z(i,r,o,n,a,s,l,c,u,p){var d=t.CustomerAction(r,o,n,a,s,l,c,u,p),h=ie(d.info,{visualType:i}),v={name:"PBI.EX.RefreshHostData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ee(),formatted:function(){return e.extendFormatted({visualType:h.visualType},null,d.formatted())},info:h,loggers:t.EXRefreshHostDataLoggers};return v}var ee,te=jsCommon.Utility,ie=jsCommon.UnionExtensions.mergeUnionType;ee=te?te.generateGuid:Function.prototype;var re;!(function(e){e[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report"})(re=t.ExportVisualSource||(t.ExportVisualSource={}));var oe;!(function(e){e[e.Entity=0]="Entity",e[e.ColumnRef=1]="ColumnRef",e[e.MeasureRef=2]="MeasureRef",e[e.Aggregation=3]="Aggregation",e[e.PropertyVariationSource=4]="PropertyVariationSource",e[e.Hierarchy=5]="Hierarchy",e[e.HierarchyLevel=6]="HierarchyLevel",e[e.Other=7]="Other"})(oe=t.FieldKind||(t.FieldKind={}));var ne;!(function(e){e[e.Visual=0]="Visual",e[e.Section=1]="Section",e[e.Exploration=2]="Exploration"})(ne=t.FilterScopeType||(t.FilterScopeType={}));var ae;!(function(e){e[e.Categorical=0]="Categorical",e[e.Range=1]="Range",e[e.Advanced=2]="Advanced",e[e.Passthrough=3]="Passthrough",e[e.Visual=4]="Visual",e[e.TopN=5]="TopN",e[e.Include=6]="Include",e[e.Exclude=7]="Exclude",e[e.RelativeDate=8]="RelativeDate"})(ae=t.FilterType||(t.FilterType={}));var se;!(function(e){e[e.CheckboxTickedInFieldList=0]="CheckboxTickedInFieldList",e[e.DraggedToCanvas=1]="DraggedToCanvas",e[e.VisualTypeIconClicked=2]="VisualTypeIconClicked",e[e.DraggedToFieldWell=3]="DraggedToFieldWell",e[e.InsertVisualButton=4]="InsertVisualButton",e[e.WhatIfParameterControl=5]="WhatIfParameterControl"})(se=t.HowVisualWasCreated||(t.HowVisualWasCreated={}));var le;!(function(e){e[e.CheckboxTickedInFieldList=0]="CheckboxTickedInFieldList",e[e.DraggedToVisual=1]="DraggedToVisual",e[e.DraggedToFieldWell=2]="DraggedToFieldWell"})(le=t.HowFieldWasAddedToVisual||(t.HowFieldWasAddedToVisual={}));var ce;!(function(e){e[e.NoCache=0]="NoCache",e[e.Cache=1]="Cache",e[e.StaleCache=2]="StaleCache"})(ce=t.VisualInitialLoadType||(t.VisualInitialLoadType={}));var ue;!(function(e){e[e.None=0]="None",e[e.CacheMissing=1]="CacheMissing",e[e.JsonParseFailed=2]="JsonParseFailed",e[e.DsrReadFailed=3]="DsrReadFailed",e[e.DataObjectNull=4]="DataObjectNull",e[e.DsrHasOdataError=5]="DsrHasOdataError",e[e.DataTransformsMissing=6]="DataTransformsMissing"})(ue=t.VisualInitialLoadTypeWarning||(t.VisualInitialLoadTypeWarning={}));var pe;!(function(e){e[e.LaunchIDEFail=0]="LaunchIDEFail",e[e.GenerateQueryFail=1]="GenerateQueryFail"})(pe=t.LaunchExternalIDEFailureType||(t.LaunchExternalIDEFailureType={}));var de;!(function(e){e[e.View=0]="View",e[e.Edit=1]="Edit"})(de=t.ViewMode||(t.ViewMode={}));var he;!(function(e){e[e.Normal=0]="Normal",e[e.EmailSubscription=1]="EmailSubscription"})(he=t.OpenExplorationSource||(t.OpenExplorationSource={}));var ve;!(function(e){e[e.FieldWell=0]="FieldWell",e[e.FieldList=1]="FieldList"})(ve=t.QuickMeasureEntryPoint||(t.QuickMeasureEntryPoint={}));var ge;!(function(e){e[e.Last=0]="Last",e[e.Current=1]="Current",e[e.Next=2]="Next"})(ge=t.RelativeDateQualifier||(t.RelativeDateQualifier={}));var fe;!(function(e){e[e.Day=0]="Day",e[e.Week=1]="Week",e[e.CalendarWeek=2]="CalendarWeek",e[e.Month=3]="Month",e[e.CalendarMonth=4]="CalendarMonth",e[e.Year=5]="Year",e[e.CalendarYear=6]="CalendarYear"})(fe=t.RelativeDateUnit||(t.RelativeDateUnit={}));var me;!(function(e){e[e.ContextMenu=0]="ContextMenu",e[e.ModeOn=1]="ModeOn"})(me=t.DrillthroughEntryPoint||(t.DrillthroughEntryPoint={}));var ye;!(function(e){e[e.Add=0]="Add",e[e.Delete=1]="Delete"})(ye=t.DrillthroughFilterUpdateType||(t.DrillthroughFilterUpdateType={})),t.EXOpenExploration=i,t.EXRefreshReport=r,t.EXSaveExploration=o,t.EXInteractionVisualConversion=n,t.EXInteractionExpand=a,t.EXInteractionDrill=s,t.EXDrillToDetails=l,t.EXAddFilter=c,t.EXFilterPaneAdvancedFilterApplied=u,t.EXFilterPaneTopNFilterApplied=p,t.EXFilterPaneRelativeDateFilterApplied=d,t.EXLoadFilterError=h,t.EXCreateVisual=v,t.EXAddField=g,t.EXVisualFirstLoad=f,t.EXChangeQuickCalc=m,t.EXSetConditionalFormatting=y,t.EXSetDataBars=w,t.EXExplorationRefresh=S,t.EXSnapshotEmbedCreate=b,t.EXPublicEmbedCreate=C,t.EXSnapshotEmbedDelete=x,t.EXSnapshotEmbedUpdate=M,t.EXImportCustomViz=D,t.EXDeleteCustomViz=F,t.EXEnableCustomViz=E,t.EXVisualRelationshipOverride=V,t.EXCodePaneUserRunScript=P,t.EXCodePaneUserEditScriptWithExternalIDE=T,t.EXCodePaneUserOpenOptionsDialog=A,t.EXCodePaneLaunchExternalIDEFailed=I,t.EXCodePaneLaunchExternalIDESucceeded=k,t.EXCodePaneShowWarning=L,t.EXExportVisualData=R,t.EXLoadReportWithScriptVis=_,t.ExploreHostChangeReportPage=O,t.EXRemoveMobileCanvasVisuals=B,t.EXLoadReportContainer=z,t.EXInitExploration=N,t.EXLoadExplorationVisuals=H,t.EXLoadExplorationSchema=U,t.EXRenderExplorationVisual=$,t.EXFetchExploration=G,t.EXChangeCanvasLayout=j,t.EXClusteringAddClustering=Q,t.EXClusteringEditClustering=W,t.EXQuickMeasuresOpenDialog=q,t.EXQuickMeasuresDialogResult=X,t.EXQuickMeasuresOnMeasureChange=K,t.EXDrillthroughGotoTarget=Y,t.EXDrillthroughFilterUpdate=J,t.EXRefreshHostData=Z})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=jsCommon.DateExtensions,r=(function(){function e(e,t,i){this.op=e,this.onOperatorChanged(),this.isCalendarShown=!1,this.value=new o(t,i)}return Object.defineProperty(e.prototype,"operator",{get:function(){return this.op},set:function(e){this.op!==e&&(this.op=e,this.onOperatorChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueRequired",{get:function(){return this.valRequired},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){return e.visit(this)},e.empty=function(){return new e(0)},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.operator===t.operator&&o.equals(e.value,t.value))},e.prototype.onOperatorChanged=function(){this.valRequired=t.OperatorHelper.getValueRequired(this.operator),this.valRequired||(this.value=void 0)},e})();t.Condition=r;var o=(function(){function e(e,t){null!=e&&(e instanceof Date&&(this.dateValue=e),this.value=e,this.formatter=t,this.stringValue=this.formatter?this.formatter.format(this.value):this.value.toString()),this.initialTime=this.dateValue,this.dateValue||(this.initialTime=new Date,this.initialTime.setHours(0,0,0,0))}return Object.defineProperty(e.prototype,"isDate",{get:function(){return null!=this.dateValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasValue",{get:function(){return null!=this.dateValue||!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(this.stringValue)},enumerable:!0,configurable:!0}),e.prototype.isValidDate=function(){return this.isDate&&(!_.isString(this.value)||null!==i.parseIsoDate(this.value))},Object.defineProperty(e.prototype,"timePickerValue",{get:function(){return this.dateValue||this.initialTime},set:function(e){this.dateValue=e},enumerable:!0,configurable:!0}),e.equals=function(t,i){return t=t||null,i=i||null,t===i||!t==!i&&(e.compareDateTimeValue(t,i)&&t.stringValue===i.stringValue)},e.compareDateTimeValue=function(e,t){var i=e.dateValue?e.dateValue.valueOf():0,r=t.dateValue?t.dateValue.valueOf():0;return i===r},e})();t.ConditionValue=o;var n=(function(){function i(e){this.field=e,this.conditions=[],this.operators=[],this.logicalOperator=2,this.logicalAndOperator=0,this.logicalOrOperator=1}return i.prototype.toSQExpr=function(e){var i=this.field,r=i.getMetadata(e);if(r){var o=r.type;return t.FilterCardConverter.toSQExpr(i,o,this.conditions,this.logicalOperator)}},i.prototype.getRestatement=function(e){return t.RestatementHelper.fromCondition(this.conditions,this.logicalOperator,e)},i.prototype.areConditionsValid=function(e){var i=this.conditions;if(_.isEmpty(i))return!1;for(var r=0,o=i.length;r<o;r++){var n=i[r];if(null!=n.operator&&0!==n.operator){if(n.value&&n.value.hasValue){if(t.OperatorHelper.getValueRequired(n.operator)&&n.value&&!n.value.hasValue)return!1;
if(e&&!this.isConditionValid(e,n))return!1}}else if(r<o-1)return!1}return!0},i.prototype.loadOperators=function(e,i){var r=this.field;if(_.isEmpty(r.validate(e,i))){var o=r.getMetadata(e);this.operators=t.OperatorHelper.getFilterOperators(o.type)}},i.prototype.ensureConditions=function(){var e=this.operators;this.conditions||(this.conditions=[]);var t=this.conditions;for(_.isEmpty(this.conditions)&&!_.isEmpty(e)&&t.push(new r(e[0].value));t.length<2;)this.logicalOperator=0,t.push(r.empty())},i.prototype.isConditionValid=function(i,r){if(!i)return!1;var o=r.value;if(o&&o.isDate&&!o.isValidDate())return!1;var n=this.field,a=e.FilterUtils.getValueType(n,i);return!!a&&t.FilterCardConverter.isConditionValid(n,a,r)},i})();t.AdvFilterCard=n})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=jsCommon.Lazy,o=e.data.SQAndExpr,n=e.data.SQCompareExpr,a=e.data.SQConstantExpr,s=e.data.SQContainsExpr,l=e.data.SQDateSpanExpr,c=e.data.SQExpr,u=e.data.SQExprBuilder,p=e.data.SQNotExpr,d=e.data.SQOrExpr,h=e.data.SQStartsWithExpr,v=jsCommon.StringExtensions,g=/[0-9]*\.?[0-9]+%/;!(function(e){function t(e,t,i){return e.accept(new y(t,i))}function i(e,t,i,r){void 0===r&&(r=0);for(var o,n=new w(e,t,r),a=0,s=i;a<s.length;a++){var l=s[a];null!=l.operator&&0!==l.operator&&(o=l.accept(n))}return o}function r(e,t,i){var r=new w(e,t,(void 0)),o=i.accept(r);return null!=o}e.createAdvFilter=t,e.toSQExpr=i,e.isConditionValid=r})(i=t.FilterCardConverter||(t.FilterCardConverter={}));var f;!(function(i){function r(e,t,i){for(var r,o=new S(t,i),n=0,a=e;n<a.length;n++){var s=a[n];null!=s.operator&&0!==s.operator&&(r=s.accept(o))}return r}function o(t,i,r){var o,n=t.length;if(n>0){for(var a=[],s=0,c=t;s<c.length;s++){var u=c[s];a.push(l(u))}o=e.visuals.valueFormatter.formatListOr(a),o=i?v.format(e.common.localize.get("FilterRestatement_NotEqual"),o):v.format(e.common.localize.get("FilterRestatement_Equal"),o)}return o}function n(e,i,r){for(var n=[],a=0,s=e;a<s.length;a++){var l=s[a];n.push(t.RestatementHelper.getLabelFromScopeId(l,r))}return o(n,i)}function a(t,i){var r=e.data.SQExprConverter.getFirstComparandValue(t);return i?i.format(r):r}function s(t){if(null!=t)return v.format(e.common.localize.get("FilterRestatement_IsDefault"),l(t))}function l(e){return null===e?null:_.isString(e)?e:e.displayName?e.displayName:"function"!=typeof e||"object"!=typeof e?e:void 0}i.fromCondition=r,i.fromLabels=o,i.fromDataViewScopeIdentities=n,i.getLabelFromScopeId=a,i.fromDefault=s})(f=t.RestatementHelper||(t.RestatementHelper={}));var m;!(function(t){function i(e){return 11!==e&&12!==e&&0!==e}function o(e){return e.text?a.getValue():e.integer||e.numeric?s.getValue():e.dateTime?n.getValue():void 0}var n=new r(function(){var t=[];return t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan_DT")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual_DT")}),t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan_DT")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual_DT")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),a=new r(function(){var t=[];return t.push({value:5,label:e.common.localize.get("FilterOperator_Contains")}),t.push({value:6,label:e.common.localize.get("FilterOperator_DoesNotContain")}),t.push({value:7,label:e.common.localize.get("FilterOperator_StartsWith")}),t.push({value:8,label:e.common.localize.get("FilterOperator_DoesNotStartWith")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),s=new r(function(){var t=[];return t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t});t.getValueRequired=i,t.getFilterOperators=o})(m=t.OperatorHelper||(t.OperatorHelper={}));var y=(function(e){function i(t,i){var r=e.call(this)||this;return r.context={isNegative:!1,allowNot:!0,logicalOperator:2},r.formatter=t,r.field=i,r}return __extends(i,e),i.prototype.visitColumnRef=function(e){if(null==this.field||c.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitGroupRef=function(e){if(null==this.field||c.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitMeasureRef=function(e){return this.createFilterCard(e)},i.prototype.visitAggr=function(e){return this.createFilterCard(e)},i.prototype.visitArithmetic=function(e){return this.createFilterCard(e)},i.prototype.visitHierarchyLevel=function(e){return this.createFilterCard(e)},i.prototype.visitEntity=function(e){return this.createFilterCard(e)},i.prototype.visitAnd=function(e){var t=this.context,i=t.isNegative?1:0;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitOr=function(e){var t=this.context,i=t.isNegative?0:1;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitCompare=function(e){var i=this.context,r=this.getFilterOperator(e,i.isNegative);if(void 0!==r&&0!==r){i.condition=new t.Condition(this.getFilterOperator(e,i.isNegative));var o=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)&&(e.right instanceof a||e.right instanceof l)){var n=this.filter;return n.conditions.push(this.context.condition),n.conditions.length>1&&2===n.logicalOperator&&(n.logicalOperator=0),i.allowNot=o,i.condition=null,n}}},i.prototype.visitNot=function(e){var t=this.context,i=e.arg;if((i instanceof n||t.allowNot&&(i instanceof o||i instanceof d||i instanceof s||i instanceof h||i instanceof p))&&(t.isNegative=!t.isNegative,e.arg.accept(this)))return t.isNegative=!t.isNegative,this.filter},i.prototype.visitConstant=function(e){if(this.context.condition){var i=this.context.condition;return 0!==e.type.primitiveType&&(i.value=new t.ConditionValue(e.value,this.formatter)),this.filter}},i.prototype.visitDateSpan=function(e){if(5===e.unit){var t=this.context,i=t.allowNot;t.allowNot=!1;var r=e.arg.accept(this);return t.allowNot=i,r}},i.prototype.visitContains=function(e){var i=this.context;i.condition=new t.Condition(i.isNegative?6:5);var r=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),i.allowNot=r,o}},i.prototype.visitStartsWith=function(e){var i=this.context;i.condition=new t.Condition(i.isNegative?8:7);var r=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),i.allowNot=r,o}},i.prototype.getFilterOperator=function(e,t){switch(e.comparison){case 3:return t?3:1;case 4:return t?4:2;case 1:return t?1:3;case 2:return t?2:4;case 0:return e.right instanceof a&&0===e.right.type.primitiveType?t?12:11:t?10:9}},i.prototype.createFilterCard=function(e){return this.filter||(this.filter=new t.AdvFilterCard(e),this.filter.logicalOperator=this.context.logicalOperator),this.filter},i})(e.data.DefaultSQExprVisitor),w=(function(){function t(e,t,i){this.propertyExpr=e,this.dataType=t,this.logicalOperator=i}return t.prototype.visit=function(e){var t=this.expandExpr(e);return t&&(this.result?0===this.logicalOperator?this.result=u.and(this.result,t):1===this.logicalOperator&&(this.result=u.or(this.result,t)):this.result=t),this.result},t.prototype.expandExpr=function(e){var t,i=11!==e.operator&&12!==e.operator;if(i&&(t=this.getValueExpr(e)),t||!i)switch(e.operator){case 9:return u.compare(0,this.propertyExpr,t);case 10:return u.not(u.compare(0,this.propertyExpr,t));case 11:return u.compare(0,this.propertyExpr,u.nullConstant());case 12:return u.not(u.compare(0,this.propertyExpr,u.nullConstant()));case 5:return u.contains(this.propertyExpr,t);case 6:return u.not(u.contains(this.propertyExpr,t));case 7:return u.startsWith(this.propertyExpr,t);case 8:return u.not(u.startsWith(this.propertyExpr,t));case 3:return u.compare(1,this.propertyExpr,t);case 4:return u.compare(2,this.propertyExpr,t);case 1:return u.compare(3,this.propertyExpr,t);case 2:return u.compare(4,this.propertyExpr,t)}},t.prototype.getValueExpr=function(t){var i=this.dataType;if(t.value){var r=t.value.stringValue;if((i.integer||i.numeric)&&r){var o=e.formattingService.parseFloat(r);if(isNaN(o))return;return r.match(g)&&(o/=100),2===i.primitiveType?u.decimal(o):u.double(o)}if(i.text&&r)return u.text(r);if(i.dateTime){var n=t.value.dateValue;if(n)return u.dateSpan(5,u.dateTime(n))}}},t})(),S=(function(){function t(t,i){0===t?this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundAnd"):1===t&&(this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundOr")),this.formatter=i}return t.prototype.visit=function(e){var t=this.conditionToString(e);if(t)return _.isEmpty(this.result)?this.result=t:this.result=v.format(this.logicalOperatorResourceId,this.result,t),this.result},t.prototype.conditionToString=function(t){var i=t.value;if(!m.getValueRequired(t.operator)||i&&i.hasValue){var r;switch(i&&(r=this.formatter?this.formatter.format(i.value||i.stringValue):i.stringValue),t.operator){case 9:return v.format(e.common.localize.get("FilterRestatement_Equal"),r);case 10:return v.format(e.common.localize.get("FilterRestatement_NotEqual"),r);case 3:return i.isDate?v.format(e.common.localize.get("FilterRestatement_GreaterThan_DT"),r):v.format(e.common.localize.get("FilterRestatement_GreaterThan"),r);case 4:return i.isDate?v.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual_DT"),r):v.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual"),r);case 1:return i.isDate?v.format(e.common.localize.get("FilterRestatement_LessThan_DT"),r):v.format(e.common.localize.get("FilterRestatement_LessThan"),r);case 2:return i.isDate?v.format(e.common.localize.get("FilterRestatement_LessThanOrEqual_DT"),r):v.format(e.common.localize.get("FilterRestatement_LessThanOrEqual"),r);case 5:return v.format(e.common.localize.get("FilterRestatement_Contains"),r);case 6:return v.format(e.common.localize.get("FilterRestatement_DoesNotContain"),r);case 7:return v.format(e.common.localize.get("FilterRestatement_StartWith"),r);case 8:return v.format(e.common.localize.get("FilterRestatement_DoesNotStartWith"),r);case 11:return e.common.localize.get("FilterOperator_IsBlank");case 12:return e.common.localize.get("FilterOperator_IsNotBlank");default:return""}}},t})()})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.common.utils.ColorUtility,o=e.explore.contracts,n=jsCommon.CssConstants.createClassAndSelector,a=jsCommon.CssConstants,s=e.data.DataViewObjectDefinitions,l=e.data.DataViewObjectEvaluator,c=e.explore.constants.ExploreCanvasConstants,u=e.visualHost.ResourcePackageReferenceResolver;!(function(t){function i(e,i,r,o){var n=(e.outerViewport.width-e.canvasOptions.scrollbarOffset)/e.viewModel.width;i.scrollTop(0).scrollLeft(0);var s=i.find(t.DisplayAreaNameSelector.selector),l=e.viewModel.width*n,u=n<c.DisplayAreaHeightAdditionMinimumScale?n+c.DisplayAreaHeightScaleAddtion:n,p=e.viewModel.height*u+o,d="",h="";if(e.canvasViewStyle=0,p>=e.outerViewport.height?(e.canvasViewStyle|=1,i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.autoValue)):(e.canvasViewStyle|=2,d=-(l/2)+"px",h=-(p/2)+"px",i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue)),e.adjustScaleForLayout){var v=e.adjustScaleForLayout({x:n,y:n});if(v.x!==n||v.y!==n){var f=Math.min(v.x,v.y),m=f/n;l*=m,p=(p-o)*m+o,n=f}}r.setCanvasScaleFactor(n),g(e,l,p),s.attr("class",t.DisplayAreaNameSelector.class+" "+w(e)),s.css({marginLeft:d,marginTop:h,width:l+"px",height:p+"px"})}function p(e,i,r,o,n){var s=i.find(t.DisplayAreaNameSelector.selector),l=(e.outerViewport.width-e.canvasOptions.scrollbarOffset)/e.viewModel.width,c=o.getConfig(),u=c.displayOptions.hideTileMenu?e.outerViewport.height:e.outerViewport.height-n,p=u/e.viewModel.height,d=Math.min(l,p);if(e.adjustScaleForLayout){var h=e.adjustScaleForLayout({x:d,y:d});h.x===d&&h.y===d||(d=Math.min(h.x,h.y))}i.scrollTop(0).scrollLeft(0);var v=e.viewModel.width*d,f=e.viewModel.height*d+n;e.canvasViewStyle=0,e.canvasViewStyle|=4,i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue),r.setCanvasScaleFactor(d),g(e,v,f),s.attr("class",t.DisplayAreaNameSelector.class+" "+w(e)),s.css({marginLeft:-(v/2)+"px",marginTop:-(f/2)+"px",width:v+"px",height:f+"px"})}function d(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector);n.removeAttr(a.styleAttribute),e.canvasViewStyle=8,r.setCanvasScaleFactor(1),g(e,e.outerViewport.width,e.outerViewport.height),i.css(a.overflowXProperty,a.hiddenValue).css(a.overflowYProperty,a.hiddenValue),n.attr("class",t.DisplayAreaNameSelector.class+" "+w(e))}function h(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector),s=i.find(E.selector),l=s&&s.length>0;e.canvasViewStyle=0;var u="",p="",d=e.viewModel.width,h=e.viewModel.height+o,v=l?c.PhoneAuthoringViewportWidth:d,f=l?c.PhoneAuthoringViewportHeight:h;v>e.outerViewport.width?(e.canvasViewStyle|=512,i.css(a.overflowXProperty,a.autoValue)):(e.canvasViewStyle|=256,u=-1*(v/2)+"px",i.css(a.overflowXProperty,a.hiddenValue)),f>e.outerViewport.height?(e.canvasViewStyle|=128,i.css(a.overflowYProperty,a.autoValue)):(e.canvasViewStyle|=64,p=-1*(f/2)+"px",i.css(a.overflowYProperty,a.hiddenValue)),u.length>0&&p.length>0?e.canvasViewStyle|=32:e.canvasViewStyle|=16,n.css({width:v+"px",height:f+"px",top:"",left:"",marginTop:p,marginLeft:u}),r.setCanvasScaleFactor(1),g(e,d,h);var m=w(e);n.attr("class",t.DisplayAreaNameSelector.class+" "+m),l&&s.attr("class",E.class+" "+m)}function v(e,i,r,o){var n=i.find(t.DisplayAreaNameSelector.selector);e.canvasViewStyle=0,e.canvasViewStyle|=512,e.canvasViewStyle|=128,e.canvasViewStyle|=16,e.viewModel.width>=e.outerViewport.width?i.css(a.overflowXProperty,a.autoValue):i.css(a.overflowXProperty,a.hiddenValue),e.viewModel.height>=e.outerViewport.height?i.css(a.overflowYProperty,a.autoValue):i.css(a.overflowYProperty,a.hiddenValue),r.setCanvasScaleFactor(1);var s=e.viewModel.width,l=e.viewModel.height+o;n.css({width:s+"px",height:l+"px"}),g(e,s,l),n.attr("class",t.DisplayAreaNameSelector.class+" "+w(e))}function g(e,t,i){var r={width:t,height:i};r.width>0&&r.height>0&&(e.forceSyncSizeUpdates?e.size=r:e.$evalAsync((function(){return e.size=r})))}function f(t,i,n,a,u,p,d,h,v,g){if(h.getCurrentLayoutCapabilities().canShowCanvasBackground()){var f=s.getObjectDefinition(n,"background",null);if(t.background&&f||(t.background=c.getDefaultCanvasBackground()),t.hasPopOut)t.background.color=c.DefaultCanvasBackgroundColor,t.background.transparency=0,t.background.image=null;else if(f){var w=l.run(e.data.createStaticEvalContext(),o.Section.objectDescriptors.background,f.properties);w&&null!==w.color||(t.background.color=c.DefaultCanvasBackgroundColor,t.background.image=null),w&&(t.background.color=e.DataViewObject.getFillColorByPropertyName(w,"color",c.DefaultCanvasBackgroundColor),t.background.transparency=e.DataViewObject.getValue(w,"transparency",c.DefaultCanvasBackgroundTransparency),t.background.image=w.image)}var S=t.background.image,b=f?f.properties.image:null,C=b&&e.data.SQExpr.isResourcePackageItem(b.url);C?y(t,S,b.url,f,u,p,d,g):m(t,t.background,S,S?S.url:"",t.hasPopOut,g)}else{var x=c.getDefaultCanvasBackground();t.background=x,m(t,x,null,"",t.hasPopOut,g)}v&&v.getConfig().displayOptions.extendBackgroundToWholeCanvas?i.css({"background-color":r.hexToRGBString(t.background.color,(100-t.background.transparency)/100)}):i.css({"background-color":""})}function m(t,i,o,n,a,s){var l=o&&o.scaling;t.imageFitClass=l,t.imageSource=o&&n,t.imageStyle=l===e.visuals.imageScalingType.normal?{transform:"scale("+s.getCanvasScaleFactor()+")"}:{},t.backgroundStyle={opacity:a?1:(100-i.transparency)/100,"background-color":r.hexToRGBString(i.color)}}function y(t,i,r,o,n,a,s,l){var c=a.getCurrentExploration();if(c){var p=t.viewModel.contract;u.loadAndResolveFromSQExpr(r,c.resourcePackages,n,s).then((function(n){var a=o.properties.image;p===t.viewModel.contract&&a&&e.data.SQExpr.equals(a.url,r)&&m(t,t.background,i,n.value||"",t.hasPopOut,l)}))}}function w(e){var t="";return e.useResponsiveLayout&&(t+=" responsive"),e.disableAnimations&&(t+=" disableAnimations"),8===(8&e.canvasViewStyle)&&(t+=" fitToScreen"),4===(4&e.canvasViewStyle)&&(t+=" fitToPage"),1===(1&e.canvasViewStyle)&&(t+=" fitToWidthOrigin"),2===(2&e.canvasViewStyle)&&(t+=" fitToWidthCentered"),256===(256&e.canvasViewStyle)&&(t+=" actualSizeAlignCenter"),512===(512&e.canvasViewStyle)&&(t+=" actualSizeAlignLeft"),64===(64&e.canvasViewStyle)&&(t+=" actualSizeAlignMiddle"),128===(128&e.canvasViewStyle)&&(t+=" actualSizeAlignTop"),32===(32&e.canvasViewStyle)&&(t+=" actualSizeCentered"),16===(16&e.canvasViewStyle)&&(t+=" actualSizeOrigin"),t.trim()}function S(e){return e&&e.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()?0:c.AutoLayoutVisualVCHeader}function b(e,t,r){if(e.viewModel&&e.viewModel.contract){var o=r.canvasScale.getDisplayOption(),n=S(r.formFactor);switch(o){case 2:i(e,t,r.canvasScale,n);break;case 1:p(e,t,r.canvasScale,r.viewModeState,n);break;case 3:h(e,t,r.canvasScale,n);break;case 4:v(e,t,r.canvasScale,n);break;case 0:d(e,t,r.canvasScale,n);break;default:d(e,t,r.canvasScale,n)}}}function C(e,t){V=e.css(a.overflowXProperty),P=e.css(a.overflowYProperty),e.css(a.overflowXProperty,t),e.css(a.overflowYProperty,t)}function x(e){e.css(a.overflowXProperty,V),e.css(a.overflowYProperty,P)}function M(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function D(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function F(e){return e.width===c.DefaultCortanaWidth&&e.height===c.DefaultCortanaHeight}t.DisplayAreaNameSelector=n("displayArea"),t.VisualContainerHostSelector=n("visualContainerHost"),t.VisualBackgroundContainerSelector=n("visualBackgroundContainer"),t.VisualBackgroundImageSelector=n("visualBackgroundImage"),t.DefaultVisualPosition={x:100,y:100,width:300,height:300};var E=n("canvasBackdrop"),V="",P="";t.fitToWidth=i,t.fitToPage=p,t.fitToScreen=d,t.displayInActualSize=h,t.displayInActualSizeTopLeft=v,t.updateCanvasSize=g,t.updateAndApplyCanvasBackground=f,t.convertDisplayOptionToStyle=w,t.getAutoLayoutVisualVCHeader=S,t.applyFitOption=b,t.storeOverflowValuesAndChange=C,t.restoreOverflowValues=x,t.visualPositionToRect=M,t.rectToVisualPosition=D,t.isCortanaPageSize=F})(i=t.CanvasDisplayUtility||(t.CanvasDisplayUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions,n=e.explore.services.RegisteredResourceReferences;!(function(r){function a(e,t){return _.filter(e.visualContainers,(function(e){return e.isSelected}))}function s(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.contract===t)return o}}function l(e,t){for(var i=[],r=t.getSelectedElements(),o=0,n=r;o<n.length;o++){var a=n[o];a.visualContainer&&i.push(e.serializeVisualContainer(a.visualContainer))}return i}function c(e,t){for(var i=[],r=e.getSelectedElements(),o=0,a=r;o<a.length;o++){var s=a[o],l=s.visualContainer&&s.visualContainer.config&&s.visualContainer.config.singleVisual&&s.visualContainer.config.singleVisual.objects;n.addObjectsReferences(l,t,i)}return i}function u(e,t,i){e=Math.max(0,e-t/2);var r=e+t-i;return r>0&&(e-=r),e}function p(e,r,n,a,s,l,c){if(e){for(var u=[],p=0,d=e.length;p<d;++p){var h=a.deserializeVisualContainer(e[p],!0,i.VisualContainerUtils.uniqueName(r.contract.visualContainers)),g=c.getCurrentLayout(),f=h.layouts.withId(g);h.layouts=o.extendWithId([f]);for(var m=f.position;v(m,r);){m.x+=10,m.y+=10;var y=0;if(m.x+m.width>r.width&&(m.x=Math.max(r.width-m.width,0),y++),m.y+m.height>r.height&&(m.y=Math.max(r.height-m.height,0),y++),2===y)break}r.contract.visualContainers.push(h);var w=t.viewModels.ViewModelFactory.convertVisualContainer(n,r.contract,h,g);w&&(r.visualContainers.push(w),u.push(h))}t.services.selectionUtils.selectVisualContainers(u,s);for(var S=0,b=u;S<b.length;S++){var h=b[S];l.applyFilterOutput(h)}}}function d(t,r,o,n,a){if(t.expr)n.addVisualContainer({expr:t.expr,visualType:t.visualType,targetRole:t.targetRole,dataSources:o,allowAggregate:!0},r).then((function(r){a.logEvent(e.telemetry.EXCreateVisual,h(t.telemetrySource),i.VisualContainerUtils.getVisualType(r))}));else{var s=n.addEmptyVisualContainer(r,t.visualType);a.logEvent(e.telemetry.EXCreateVisual,h(t.telemetrySource),i.VisualContainerUtils.getVisualType(s))}}function h(t){switch(t){case 0:return e.telemetry.HowVisualWasCreated.CheckboxTickedInFieldList;case 3:return e.telemetry.HowVisualWasCreated.DraggedToFieldWell;case 1:return e.telemetry.HowVisualWasCreated.DraggedToCanvas;case 2:return e.telemetry.HowVisualWasCreated.VisualTypeIconClicked;case 4:return e.telemetry.HowVisualWasCreated.InsertVisualButton;case 5:return e.telemetry.HowVisualWasCreated.WhatIfParameterControl}}function v(e,t){return _.any(t.visualContainers,(function(t){return t.position.x===e.x&&t.position.y===e.y}))}function g(e,i,r){var o=e.visualContainers.slice().sort(m),n=t.services.selectionUtils.getSelectedVisual(i);if(n){var a=s(e.visualContainers,n);if(a){var l=_.indexOf(o,a);switch(r){case 1:o.push(o.splice(l,1)[0]);break;case 2:o.unshift(o.splice(l,1)[0]);break;case 3:l<o.length-1&&jsCommon.ArrayExtensions.swap(o,l+1,l);break;case 4:l>0&&jsCommon.ArrayExtensions.swap(o,l-1,l)}}}for(var c=0,u=o.length;c<u;c++){var p=o[c];p.position.z=c,p.updateViewState()}}function f(e,i){var r=t.services.selectionUtils.getSelectedVisual(i);if(r)for(var o=_.max(e,(function(e){return e.position.z})),n=o instanceof t.viewModels.VisualContainer?(o.position.z||0)+1:1,a=s(e,r),l=0,c=e;l<c.length;l++){var u=c[l];u.zIndexOverride=u===a?n:null,u.updateViewState()}else for(var p=0,d=e;p<d.length;p++){var u=d[p];u.zIndexOverride=null,u.updateViewState()}}function m(e,t){var i=e.position.z||0,r=t.position.z||0;return i<r?-1:i>r?1:0}function y(e,t,i){var r={x:e.x*t.x,y:e.y*t.y,z:e.z,width:e.width*t.x,height:e.height*t.y,angle:e.angle};if(i===!0){var o=Math.round(r.x),n=Math.round(r.y),a=Math.round(r.x+r.width),s=Math.round(r.y+r.height),l={x:o,y:n,z:r.z,width:a-o,height:s-n,angle:e.angle};r=l}return r}function w(e,t){return{x:e.x/t.x,y:e.y/t.y,z:e.z,width:e.width/t.x,height:e.height/t.y,angle:e.angle}}function S(e,t){return{left:e.left*t.x,top:e.top*t.y,width:e.width*t.x,height:e.height*t.y}}function b(e,t){return{left:e.left/t.x,top:e.top/t.y,width:e.width/t.x,height:e.height/t.y}}function C(e){if(!e||_.isEmpty(e.visualContainers))return 0;var t=_.chain(e.visualContainers).map((function(e){return e.position&&e.position.z||0})).max().value();return t+1}r.getSelectedCanvasVisualContainers=a,r.findVisualContainerViewModel=s,r.serializeSelection=l,r.getSelectionResources=c,r.checkBoundaryForCharts=u,r.duplicateVisuals=p,r.addVisualContainerToCanvas=d,r.rearrangeVisualsOrder=g,r.moveSelectedItemToFront=f,r.convertToScaledPosition=y,r.convertFromScaledPosition=w,r.convertToScaledRect=S,r.convertFromScaledRect=b,r.getZIndexForNewVisual=C})(r=i.CanvasVisualsUtility||(i.CanvasVisualsUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.visuals.GradientUtils,o=e.data.SQExprBuilder;!(function(t){function i(){return{diverging:!1,minColor:"#FD625E",midColor:"#F5D33F",maxColor:"#01B8AA",nullStrategy:e.NullStrategy.asZero,nullColor:"#FF7F48"}}function n(e,t){var i=a(e,t);if(i&&i.solid&&i.solid.color){var o=i.solid.color;if(o&&o.rule){var n=o.rule;return r.getGradientSettings(n)}}}function a(t,i){return e.VisualObjectRepetition.getDefinition(t,i)}function s(e,t){return void 0!==a(e,t)}function l(t){return c(t,i(),e.ValueType.fromPrimitiveTypeAndCategory(3))}function c(t,i,r){var n,a={color:o.text(i.minColor)},s=i.minValue;null!=s&&(n=u(s,r));var l,c;if(i.diverging){l={color:o.text(i.midColor)};var p=i.midValue;null!=p&&(c=u(p,r))}var d,h={color:o.text(i.maxColor)},v=i.maxValue;null!=v&&(d=u(v,r));var g,f=i.nullStrategy,m=i.nullColor,y={};return g=i.diverging?y.linearGradient3={min:a,mid:l,max:h}:y.linearGradient2={min:a,max:h},n&&(g.min.value=n),c&&(g.mid.value=c),d&&(g.max.value=d),f&&(g.nullColoringStrategy={strategy:o.text(f)},f===e.NullStrategy.specificColor&&m&&(g.nullColoringStrategy.color=o.text(m))),{solid:{color:o.fillRule(t,y)}}}function u(e,t){if(t.integer){var i=Math.round(e);return o.integer(i)}return 2===t.primitiveType?o.decimal(e):o.double(e)}t.getDefaultColorScalesSettings=i,t.getGradientSettings=n,t.getDefinition=a,t.isColorScalesApplied=s,t.createDefaultFillDefinition=l,t.createFillDefinition=c})(i=t.ConditionalFormattingUtil||(t.ConditionalFormattingUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.SQExprBuilder;!(function(t){function i(e,i){var r=a(e.objects,i);if(!r)return t.DefaultDataBarsSettings;var o,n=r.minValue;n&&(o=n.value);var s,l=r.maxValue;l&&(s=l.value);var c={solid:{color:r.positiveColor.solid.color.value}},u={solid:{color:r.negativeColor.solid.color.value}},p={solid:{color:r.axisColor.solid.color.value}};return{minValue:o,maxValue:s,positiveColor:c,negativeColor:u,axisColor:p,reverseDirection:r.reverseDirection.value,hideText:r.hideText.value}}function o(){return n(t.DefaultDataBarsSettings,e.ValueType.fromPrimitiveTypeAndCategory(12))}function n(t,i){var o;void 0!==t.minValue&&(o=l(t.minValue,i));var n;return void 0!==t.maxValue&&(n=l(t.maxValue,i)),{minValue:o,maxValue:n,positiveColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.positiveColor.solid.color),negativeColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.negativeColor.solid.color),axisColor:e.fillDefinitionHelpers.createSolidFillDefinition(t.axisColor.solid.color),reverseDirection:r.boolean(t.reverseDirection),hideText:r.boolean(t.hideText)}}function a(t,i){return e.VisualObjectRepetition.getDefinition(t,i)}function s(e,t){return void 0!==a(e,t)}function l(e,t){if(t.integer){var i=Math.round(e);return r.integer(i)}return 2===t.primitiveType?r.decimal(e):r.double(e)}t.DefaultDataBarsSettings={positiveColor:{solid:{color:"#01B8AA"}},negativeColor:{solid:{color:"#FD625E"}},axisColor:{solid:{color:"#333333"}},reverseDirection:!1,hideText:!1},t.getDataBarsSettings=i,t.createDefaultDataBarsDefinition=o,t.createDataBarsDefinition=n,t.getDefinition=a,t.isDataBarsApplied=s})(i=t.DataBarsUtil||(t.DataBarsUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Field="field",e.Bookmark="bookmark",e.Sections="sections",e.VisualContainerThumbnail="visual-container-thumbnail"})(t=e.DragDropTypes||(e.DragDropTypes={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){if(!e)return!1;var t=e.displayableErrorInfo;return!_.isEmpty(t)&&(!_.isEmpty(t[0].errorInfoKey)&&!_.isEmpty(t[0].errorInfoValue))}function i(e){return e in r?r[e]:0}var r={BlockedCustomVisual:1,ScriptVisualsNotEnabled:1,UnapprovedCustomVisual:1,CvApiVersionNotSupported:1};e.hasAdditionalErrorInfo=t,e.getErrorOverlayType=i})(t=e.ErrorDetailsUtility||(e.ErrorDetailsUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.handled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent);var i=t.handled;return void 0!==i&&i===!0}},e.markAsHandled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent),t.handled=!0}},e})();e.EventBubblingUtility=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){return!!i.isTrustedVisual(e)&&_.any(t.sections,(function(t){return _.any(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e}))}))}function i(e,t){for(var i=[],r=0,o=e.sections;r<o.length;r++)for(var n=o[r],a=0,s=n.visualContainers;a<s.length;a++){var l=s[a],c=l.config.singleVisual.visualType;c&&t.isTrustedVisual(c)&&i.push(c)}return t.getConsentAndLoadVisuals(i)}e.explorationContainsTrustedVisual=t,e.acquireTrustedVisuals=i})(t=e.ExplorationTrustedVisualUtil||(e.ExplorationTrustedVisualUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.explore.services.FormatPainter;!(function(e){function i(e,i,o,n,a,s,l,c){return{deleteSelection:function(){e.exploration&&e.exploration.exploreCanvas&&n.deleteSelectedVisuals(e.exploration.exploreCanvas)},deserializeAndDuplicateData:function(r){e.exploration&&e.exploration.exploreCanvas&&t.CanvasVisualsUtility.duplicateVisuals(r,e.exploration.exploreCanvas,e.exploration.contract,i,o,s,l)},serializeSelection:function(){return t.CanvasVisualsUtility.serializeSelection(i,o)},getSelectionResources:function(){return t.CanvasVisualsUtility.getSelectionResources(o,e.exploration.contract.resourcePackages)},deserializeVisualContainer:function(e){return i.deserializeVisualContainer(e,!0)},copyVisualFormat:function(){return r.copyFormatVisualConfig(o,a)},pasteVisualFormat:function(e){var t=r.pasteFormatVisualConfig(o,a,c,e);t&&n.raiseVisualContainerChanged(t)}}}e.createClipboardHandler=i})(i=t.ExploreClipboardHandlerUtility||(t.ExploreClipboardHandlerUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this._scope=e,this._eventBridge=t}return t.prototype.addColumn=function(e){this.raiseFieldListActionEvent(10,e)},t.prototype.addMeasure=function(e){this.raiseFieldListActionEvent(7,e)},t.prototype.addHierarchy=function(e){this.raiseFieldListActionEvent(8,e)},t.prototype.addHierarchyLevel=function(e,t,i){var r={action:9,fieldExpr:e,newHierarchyLevel:{hierarchy:t,index:i}};this.raiseEvent(r)},t.prototype.setGroups=function(e){this.raiseEvent({action:11,property:e})},t.prototype.editGroups=function(e){this.raiseEvent({action:12,property:e})},t.prototype.editClustering=function(e){this.raiseEvent({action:13,fieldExpr:e})},t.prototype.newQuickCalc=function(e){this.raiseEvent({action:14,fieldExpr:e})},t.prototype.collapseAll=function(){this.raiseFieldListActionEvent(15)},t.prototype.delete=function(e){this.raiseFieldListActionEvent(4,e)},t.prototype.moveUp=function(e){this.raiseFieldListActionEvent(5,e)},t.prototype.moveDown=function(e){this.raiseFieldListActionEvent(6,e)},t.prototype.expandAll=function(){this.raiseFieldListActionEvent(16);
},t.prototype.select=function(e){this.raiseFieldListActionEvent(3,e)},t.prototype.toggleHidden=function(e){this.raiseFieldListActionEvent(0,e)},t.prototype.unHideAll=function(){this.raiseFieldListActionEvent(2)},t.prototype.viewHidden=function(){this.raiseFieldListActionEvent(1)},t.prototype.raiseFieldListActionEvent=function(e,t){var i={action:e,fieldExpr:t};this.raiseEvent(i)},t.prototype.raiseEvent=function(t){this._eventBridge.publishBubbling(this._scope,e.viewModels.FieldListEvents.fieldListAction,t)},t})();t.FieldListActionEventPublisher=i})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){switch(e){case 1:return new a;case 2:return new s;default:return new n(t)}}var o=e.data.SQExprBuilder;i.createFieldListExprGenerator=r;var n=(function(){function e(e){this.groupingDesignStateService=e}return e.prototype.fieldExpr=function(e){if(void 0!==e.kind){if(0===e.kind){if(t.utils.GroupUtils.isGroupOrClusteringColumn(e.entity.name,e.contract,this.groupingDesignStateService)){var i=o.entity(e.entity.contractSchema.name,e.entity.name),r=t.utils.GroupUtils.getGroupedColumnsFromMetadata(e.contract.column.groupingMetadata,i);return o.fieldExpr({groupingColumn:{schema:e.schema.name,entity:e.entity.name,name:e.name,groupedColumns:r}})}return o.fieldExpr({column:{schema:e.schema.name,entity:e.entity.name,name:e.name}})}if(1===e.kind)return o.fieldExpr({measure:{schema:e.schema.name,entity:e.entity.name,name:e.name}})}},e})(),a=(function(){function e(){}return e.prototype.fieldExpr=function(e){return o.fieldExpr({hierarchy:{name:e.name,schema:e.entity.contractSchema.name,entity:e.entity.name}})},e})(),s=(function(){function e(){}return e.prototype.fieldExpr=function(e){return o.fieldExpr({hierarchyLevel:{schema:e.entity.contractSchema.name,entity:e.entity.name,name:e.parent.name,level:e.name}})},e})()})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(){}return t.getDefaultVisualPlugin=function(t){return t&&t.featureSwitches&&t.featureSwitches.pivotTableVisualEnabled?e.visuals.plugins.tableEx:e.visuals.plugins.table},t})();t.FieldWellUtility=i})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions,n=t.viewModels.FilterCardConverter,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprUtils,u=e.data.TopNFilterPattern;!(function(i){function r(t,i){if(t){var r=t.from(),n=t.conditions();if(!_.isEmpty(n)){for(var a,c=new d,h=[],v=0,g=n;v<g.length;v++){var f=g[v],m=u.extractParametersFromCondition(t.from(),f);if(m)s(h,m.fieldBeingFiltered,r,f,i);else{var y=e.data.RelativeDateFilterPattern.extractParametersFromCondition(f);if(y)s(h,y.field,r,f,i);else{var w=f.accept(c);if(w)a=a?p.merge(a,w):w;else{var S=o(f);if(!S)return;s(h,S,r,f,i)}}}}if(a)for(var b=0,C=a;b<C.length;b++){var x=C[b],M=_.map(x.values,(function(e){return[e]})),D=l.inValues([x.fieldExpr],M),F=x.isNot?l.not(D):D;s(h,x.fieldExpr,r,F,i)}return h}}}function o(e){var t=n.createAdvFilter(e);if(t)return t.field}function s(e,i,r,o,n){var s=0;e.push({expression:i,filter:a.fromSQFromAndSQExpr(r,o),name:null,type:t.FilterUtils.getDefaultFilterType(i,n,s),howCreated:s,expanded:!1})}i.fromSemanticFilter=r})(r=i.FilterContainerBuilder||(i.FilterContainerBuilder={}));var p;!(function(e){function t(e,t){for(var i=[],r=function(r,o){var n=_.map(e.values,(function(e){return e[r]}));i.push({fieldExpr:e.args[r],isNot:t,values:c.concatUnique([],n)})},o=0,n=e.args.length;o<n;o++)r(o,n);return i}function i(e,t){for(var i,r=o.copy(e),n=0,a=t;n<a.length;n++){i=a[n];var l=_.findIndex(r,(function(e){return s.equals(e.fieldExpr,i.fieldExpr)}));if(l!==-1){var u=r[l];u.values=c.concatUnique(u.values,i.values)}else r.push(i)}return r}e.fromInExpr=t,e.merge=i})(p=i.FieldExprAndValues||(i.FieldExprAndValues={}));var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitIn=function(e){return p.fromInExpr(e)},t.prototype.visitNot=function(t){return t&&t.arg&&10===t.arg.kind?p.fromInExpr(t.arg,!0):e.prototype.visitNot.call(this,t,void 0)},t.prototype.visitAnd=function(e){var t=e.left.accept(this),i=e.right.accept(this);if(t&&i)return p.merge(t,i)},t})(e.data.DefaultSQExprVisitor);i.SemanticFilterConditionVisitor=d})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=$(document.activeElement);return t.is(e)||t.closest(e).length>0}e.isFocusInTree=t})(t=e.FocusUtility||(e.FocusUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i=[];if(!e||!t)return i;for(var r=0,o=e;r<o.length;r++){var n=o[r];i.push(t(n))}return i}function i(){return{type:1}}e.getMenuItems=t,e.createSeparator=i})(t=e.MenuItemUtility||(e.MenuItemUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.util.CanvasDisplayUtility,n=t.constants.ExploreCanvasConstants;e.explore.contracts;!(function(i){function r(t){for(var i=[],r=0,o=t;r<o.length;r++){var n=o[r];i.push({value:n.value.toString(),displayName:e.explore.viewModels.ViewModelFactory.getDisplayName(n.displayName)})}return i}function a(){for(var t=e.visuals.valueFormatter.getDisplayUnits(e.DisplayUnitSystemType.DataLabels),i=[],r=0,o=t;r<o.length;r++){var n=o[r];i.push({displayName:n.title,value:n.value.toString()})}return i}function s(e,r){if(0===e.displayOption)return i.PageSizeTypes.Dynamic;if(e.width===t.constants.ExploreCanvasConstants.DefaultCanvasWidth&&e.height===n.DefaultCanvasHeight)return i.PageSizeTypes.Standard;if(e.width===t.constants.ExploreCanvasConstants.DefaultWidescreenWidth&&e.height===n.DefaultWidescreenHeight)return i.PageSizeTypes.Widescreen;if(o.isCortanaPageSize(e)){var a=r.getCurrentExploration(),s=r.getCurrentSection(),l=t.PodUtils.findPodIndexForSectionName(a,s.name);return l!==-1&&a.pods[l].cortanaEnabled?i.PageSizeTypes.Cortana:i.PageSizeTypes.Custom}return e.width===t.constants.ExploreCanvasConstants.DefaultLetterWidth&&e.height===n.DefaultLetterHeight?i.PageSizeTypes.Letter:i.PageSizeTypes.Custom}function l(e){return i.PageSizeTypesToSectionSize[e]}i.PageSizeTypes={Dynamic:"Dynamic",Standard:"Standard",Widescreen:"Widescreen",Cortana:"Cortana",Letter:"Letter",Custom:"Custom"},i.PageSizeTypesToSectionSize=(c={},c[i.PageSizeTypes.Dynamic]={displayOption:0,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},c[i.PageSizeTypes.Standard]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},c[i.PageSizeTypes.Widescreen]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultWidescreenWidth,height:t.constants.ExploreCanvasConstants.DefaultWidescreenHeight},c[i.PageSizeTypes.Cortana]={displayOption:3,width:t.constants.ExploreCanvasConstants.DefaultCortanaWidth,height:t.constants.ExploreCanvasConstants.DefaultCortanaHeight},c[i.PageSizeTypes.Letter]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultLetterWidth,height:t.constants.ExploreCanvasConstants.DefaultLetterHeight},c[i.PageSizeTypes.Custom]={displayOption:3,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},c),i.getDisplayNames=r,i.getDisplayUnits=a,i.getPageSizeType=s,i.getDefaultSectionSize=l;var c})(r=i.PropertyPaneUtils||(i.PropertyPaneUtils={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.container=e,this.context={pendingGeocodingCount:0}}return e.prototype.newQuery=function(){var e=0!==this.context.pendingGeocodingCount;this.context={pendingGeocodingCount:0},e&&this.container.onStopGeocoding()},e.prototype.hasPendingGeocoding=function(){return this.context.pendingGeocodingCount>0},e.prototype.wrapGeocoder=function(e){return{geocode:this.wrapAsyncGeocoderMethod(e,e.geocode),geocodeBoundary:this.wrapAsyncGeocoderMethod(e,e.geocodeBoundary),geocodePoint:this.wrapAsyncGeocoderMethod(e,e.geocodePoint),tryGeocodeImmediate:function(t){return e.tryGeocodeImmediate(t)},tryGeocodeBoundaryImmediate:function(t,i,r,o,n,a){return e.tryGeocodeBoundaryImmediate(t,i,r,o,n,a)}}},e.prototype.wrapAsyncGeocoderMethod=function(e,t){var i=this;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];var n=i.context,a=t.apply(e,r);1===++n.pendingGeocodingCount&&i.container.onStartGeocoding();var s=function(){n===i.context&&--n.pendingGeocodingCount<=0&&i.container.onStopGeocoding()};return a.then(s,s),a}},e})();e.QueryGeocodingTracker=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){return e?i.get(e):t.reject()}function i(e,t){Object.defineProperty(e,"dataSources",{get:function(){return t.get()},set:function(e){return t.set(e)}})}e.getSchemaPromise=t,e.defineDataSourcesOnScopeLegacy=i})(t=e.ScopeUtils||(e.ScopeUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m){return new U(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m)}function o(t,i,r){var o=_.filter(r.filters,(function(e){return 5===e.howCreated}));t.logEvent(e.telemetry.EXDrillthroughFilterUpdate,i,o.length)}function n(e,t,i,r){var o=e.getMetadata(t);if(o.type.geography)return M.name;var n=T.asFieldPattern(e);if(i&&n){var a=n.column||n.groupingColumn,l=a&&a.name,c=n.hierarchyLevel&&n.hierarchyLevel||n.columnHierarchyLevelVariation&&n.columnHierarchyLevelVariation.level;if(c){var u=c.level;if(i.isGeographic(u))return M.name;var p=k.getConceptualHierarchyLevel(t,c.schema,c.entity,c.name,u);l=p&&p.column&&p.column.name}if(l&&i.isGeographic(l))return M.name}var d=n.column,v=d&&t.schema(d.schema).findProperty(d.entity,d.name).column;return v&&v.parameterMetadata&&1===v.defaultAggregate?E.name:s(e,o,t)?h.name:r&&r.pivotTableVisualEnabled?O.name:R.name}function a(e,t){var i=e.getMetadata(t);if(s(e,i,t))return 2}function s(e,t,i){return 1===t.kind||t.type.numeric&&!I.discourageAggregation(e,i)}function l(t){switch(t.kind){case 0:return e.telemetry.FieldKind.Entity;case 2:return e.telemetry.FieldKind.ColumnRef;case 3:return e.telemetry.FieldKind.MeasureRef;case 4:return e.telemetry.FieldKind.Aggregation;case 5:return e.telemetry.FieldKind.PropertyVariationSource;case 6:return e.telemetry.FieldKind.Hierarchy;case 7:return e.telemetry.FieldKind.HierarchyLevel;default:return e.telemetry.FieldKind.Other}}function c(t){switch(t){case C.Advanced:return e.telemetry.FilterType.Advanced;case C.Categorical:return e.telemetry.FilterType.Categorical;case C.Passthrough:return e.telemetry.FilterType.Passthrough;case C.Range:return e.telemetry.FilterType.Range;case C.Visual:return e.telemetry.FilterType.Visual}}function u(t){switch(t){case 2:return e.telemetry.FilterScopeType.Exploration;case 1:return e.telemetry.FilterScopeType.Section;case 0:return e.telemetry.FilterScopeType.Visual}}var p=jsCommon.ArrayExtensions,d=e.visuals.plugins.basicShape,h=e.visuals.plugins.clusteredColumnChart,v=e.explore.constants,g=e.data.DataViewObjectDefinition,f=e.data.DataViewObjectDefinitions,m=e.data.DataViewObjectDescriptors,y=e.data.DataViewRoleWildcard,w=e.telemetry.DrillthroughFilterUpdateType,S=e.explore.util.DrillUtils,b=t.services.events,C=t.contracts.FilterType,x=e.explore.util.HierarchyUtils,M=e.visuals.plugins.map,D=t.services.selectionUtils,F=e.data.SemanticFilter,E=e.visuals.plugins.slicer,V=e.data.SQExpr,P=e.data.SQExprBuilder,T=e.data.SQExprConverter,A=e.data.SQExprHierarchyToHierarchyLevelConverter,I=e.data.SQExprUtils,k=e.data.SQHierarchyExprUtils,L=e.data.SQScopedEvalExpr,R=e.visuals.plugins.table,O=e.visuals.plugins.tableEx,B=e.visuals.controls.internal.TablixObjects,z=e.explore.contracts.VisualContainer,N=e.explore.util.VisualContainerUtils,H=t.contracts.VisualQuery;i.createVisualAuthoringOperations=r;var U=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y){this.visualPluginService=e,this.pluginOps=i,this.displayNameService=r,this.telemetry=o,this.explorationNavigationService=n,this.selectionService=a,this.geotaggingAnalyzerService=s,this.explorationSerializer=l,this.eventBridge=c,this.featureSwitchService=u,this.sortService=p,this.visualRelationshipService=d,this.drill=h,this.filterGenerator=v,this.aggrOps=g,this.resourceRegistration=f,this.formFactorProvider=m,this.localizationService=y,this.core=t.services.createVisualAuthoringCore(e,s,g,u)}return r.prototype.addFieldToVisual=function(t,i,r,o){if(!r)return!1;var n=r.config.singleVisual,a=n.query,s=this.visualPluginService.capabilities(n.visualType),c=this.addHierarchyLevelToExistingHierarchiesInVisual(t,s,r.config,i)||this.addExpressionToVisualWithoutAggregation(t,r,s,i)||this.addExpressionToVisualForcingAggregation(t,r,s,i)||this.addExpressionToVisual(t,r,s,i),u=i.getConceptualProperty(t),p=u&&u.measure&&u.measure.template&&u.measure.template.name;return c?(this.ensureValidDrillMode(r),this.ensureDefaultFilterAndRaiseEvent(t,r,!1),void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,N.getVisualType(r),l(i),N.hasGroupByItemsInQuery(r),!0,p),!0):(r.config.singleVisual.query=a,void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,N.getVisualType(r),l(i),N.hasGroupByItemsInQuery(r),!1,p),!1)},r.prototype.addFieldInRole=function(t,i,r,o,n){var a=this.getVisualDataRole(o,r);if(!a)return!1;var s;this.shouldPreferGroupToAggregate(t,i,o,a)||(i=this.createExprWithAggregate(i,t,!0,a),s=!0);var c=this.canHierarchyLevelJoinExistingGroup(t,o.config.singleVisual.query,r,i,n),u=this.getTargetRoleAndExpressionsForAdd(t,o,i,r),p=s||c?i:u&&u.expressions,d={expr:p,schema:t,targetRole:r,targetIndex:n},h=i.getConceptualProperty(t),v=h&&h.measure&&h.measure.template&&h.measure.template.name;return this.core.add(d,o.config)?(this.ensureValidDrillMode(o),this.ensureDefaultFilterAndRaiseEvent(t,o,!1),this.telemetry.logEvent(e.telemetry.EXAddField,e.telemetry.HowFieldWasAddedToVisual.DraggedToFieldWell,N.getVisualType(o),l(i),N.hasGroupByItemsInQuery(o),!0,v),!0):(this.telemetry.logEvent(e.telemetry.EXAddField,e.telemetry.HowFieldWasAddedToVisual.DraggedToFieldWell,N.getVisualType(o),l(i),N.hasGroupByItemsInQuery(o),!1,v),!1)},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=(t.config.singleVisual.query.tryGetExprs(i)||[]).slice(r,r+o);if(_.isEmpty(n))return!1;var a=n[0];if(V.isHierarchyLevel(a)){var s=a.arg,l=k.expandExpr(e,s);if(_.isArray(l)){var c=l.length;if(o<c){for(var u=t.config.singleVisual.query,p=!1,d=0;d<c;d++)if(!V.equals(u.tryGetExpr(i,r+d),l[d])){if(!this.core.add({expr:l[d],schema:e,targetRole:i,targetIndex:r+d},t.config))break;p=!0}return p&&this.raiseVisualContainerChanged(t),p}}}return!1},r.prototype.removeField=function(e,t){var i=D.getSelectedVisuals(this.selectionService),r=k.expandExpr(t,e,!0),o=this.removeFieldImpl(e,i);return _.isArray(r)&&(o=this.removeFieldImpl(r,i)||o),o},r.prototype.removeProjection=function(e){var t=D.getSelectedVisual(this.selectionService);return!!t&&this.invokeRemoveOnSelectedVisuals(e,[t])},r.prototype.removeInvalidExpressions=function(e,t){var i=t.config.singleVisual;if(!i||!i.query)return!1;for(var r=[],o=0,n=i.query.defn.select();o<n.length;o++){var a=n[o],s=a.expr;_.isEmpty(s.validate(e,this.aggrOps))||r.push(s)}for(var l=0,c=r;l<c.length;l++){var u=c[l];this.removeFiltersWithExpr(u,t)}return this.removeFieldImpl(r,[t]),!0},r.prototype.moveProjection=function(e,t,i,r,o,n){var a=D.getSelectedVisual(this.selectionService);if(!a)return!1;var s;if(t!==i){var l=this.getVisualDataRole(a,i),c=x.getHierarchyReplacementExpressions(a.config,t,r,n,l);if(_.isEmpty(c))return!1;s=c}var u={sourceRole:t,targetRole:i,sourceIndex:r,targetIndex:o,sourceCount:n,replacementExpressions:s,schema:e,allowPartialReplace:!0},p=a.config.singleVisual.query,d=S.getDrillFilterRemovalInfoList(p,u,1);if(this.core.replace(u,a.config)){this.ensureValidDrillState(a,d),this.raiseVisualContainerChanged(a);var h=a.config.singleVisual.query,v=h.tryGetExpr(i,o);return this.logReportMeasureMoveTelemetry(e,a,t,i,v),!0}return!1},r.prototype.drillDownLevel=function(t,i,r){if(i){var o=N.getVisualType(i),n=this.telemetry.startEvent(e.telemetry.EXInteractionExpand,o,2===r),a=i.config.singleVisual,s=this.visualPluginService.capabilities(a.visualType),l=S.getDrillableRoles(s),c=_.isEmpty(t)?_.first(l):t;if(c){var u=this.core.changeActiveProjection(c,a,r);if(u)return this.raiseVisualContainerChanged(i),void n.resolve()}n.reject()}},r.prototype.replaceProjection=function(e,t,i,r,o){var n=D.getSelectedVisual(this.selectionService);if(!n)return!1;var a={sourceRole:i,targetRole:i,sourceIndex:r,targetIndex:r,sourceCount:1,replacementExpressions:[t],schema:e};return!!this.core.replace(a,n.config)&&(this.ensureValidDrillMode(o),this.resetSearchProperties(o),this.ensureDefaultFilterAndRaiseEvent(e,o,!1),!0)},r.prototype.drillDown=function(t,i,o,n){var a=N.getVisualType(o),s=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,a,!0);this.filterGenerator.clearCrossHighlight(this.explorationNavigationService.getCurrentSection());var l=o.config.singleVisual;if(l.clearSelectedDataPoints(),_.isEmpty(i)||_.isEmpty(i[0].dataMap))return!1;o.filters||(o.filters=[]);var c=i[0].dataMap,u=l.query,p=this.visualPluginService.capabilities(l.visualType),d=n||_.first(S.getDrillableRoles(p)),h=u.projections[d].activeProjectionRefs,v=_.filter(c,(function(e,t){return _.contains(h,t)}));if(!_.isEmpty(v)){var g=u.currentDrillMode(d)||2,f=this.core.changeActiveProjection(d,l,g),m=u.projections[d],y=m.activeProjectionRefs;if(f&&_.isEqual(f,y)){for(var w=0,b=v;w<b.length;w++){var C=b[w];this.core.addDrillFilter(t,o.filters,u,h,r.chooseRepetitionSelectorForDrill(C))}return this.raiseVisualContainerChanged(o),s.resolve(),!0}}return s.reject(),!1},r.chooseRepetitionSelectorForDrill=function(e){if(e=p.ensureArray(e),1===e.length)return e[0];for(var t,i=0,r=e;i<r.length;i++){var o=r[i];t||(t=o),o.key.length>t.key.length&&(t=o)}return t},r.prototype.drillUp=function(t,i){if(i){var r=N.getVisualType(i),o=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,r,!1),n=i.config.singleVisual,a=n.query,s=this.visualPluginService.capabilities(i.config.singleVisual.visualType),l=S.getDrillableRoles(s),c=_.isEmpty(t)?_.first(l):t;if(c){var u=this.core.changeActiveProjection(c,n,1);if(!_.isEmpty(u)){var p=_.last(u),d=a.defn.select().withName(p).expr;return this.core.removeDrillFilter(i.filters,d),this.raiseVisualContainerChanged(i),void o.resolve()}}o.reject()}},r.prototype.drillToDetails=function(t,i,r,o,n){var a=!1;if(_.any(r)&&(a=V.isAggregation(_.first(r))&&1===r.length||_.all(r,(function(e){return V.isMeasure(e)}))),a){var s=z.clone(n,this.explorationSerializer);this.addDrillToDetailsFilters(i,s,o);var c={name:t,config:{singleVisual:s.config.singleVisual},layouts:n.layouts,filters:s.filters};if(c.config.singleVisual.visualType!==e.visuals.plugins.tableEx.name){var u=this.convert(i,c,e.visuals.plugins.tableEx.name);if(!u)return}c.config.singleVisual.stylePresetName="Default";var p=c.config.singleVisual.objects={};f.setValue(p,B.PropTotalTableExTotals,void 0,P.boolean(!1));for(var d=c.config.singleVisual.query,h=0,v=r;h<v.length;h++){var g=v[h],m=g.getTargetEntity();V.isAggregation(g)?(this.removeAggregatesAndMeasures(i,c,!1),this.addDetailTableProperties(i,m,c),d.defn=d.defn.addGroupBy(m)):(this.addDetailTableProperties(i,m,c,!0),this.removeAggregatesAndMeasures(i,c,!0));var y={expr:P.removeAggregate(g),direction:2};this.sortService.addSort(d,[y]);var w=N.getVisualType(n);this.telemetry.logEvent(e.telemetry.EXDrillToDetails,w,l(g))}return c}},r.prototype.removeAggregatesAndMeasures=function(e,t,i){for(var r=t.config.singleVisual.query,o=r.defn.select(),n=0,a=o;n<a.length;n++){var s=a[n],l=s.expr;if(I.isMeasure(l)&&i===!1||V.isAggregation(l)&&i===!0){var c=r.getRoleNameForExpr(l),u=p.indexWithName(r.defn.select(),s.name);r.removeAggregate(c,u,e)}V.isMeasure(l)&&i===!1&&r.removeExpr(l,!1)}},r.prototype.addDetailTableProperties=function(e,t,i,r){for(var o=i.config.singleVisual.query,n=I.getConceptualEntity(t,e),a=o.defn.select(),s=0,l=a;s<l.length;s++){var c=l[s],u=c.expr,p=u.getTargetEntity();if(!_.isEqual(t,p)){var d=I.isRelatedOneToOne(e,t,p);if(!d){var h=I.isRelatedToMany(e,p,t);h||o.removeExpr(u,!1)}}}for(var v=n.properties,g=0,f=v;g<f.length;g++){var m=f[g];if(!m.hidden&&(1!==m.kind&&!m.type.integer&&!m.type.numeric||r)&&(!m.type.dateTime||!m.column||_.isEmpty(m.column.variations))){var y=void 0;y=1===m.kind?P.measureRef(t,m.name):P.columnRef(t,m.name);var w=o.defn.selectNameOf(y);w||this.addFieldToVisual(e,y,i)}}},r.prototype.setAggregate=function(e,t,i,r,o){var n={role:t,index:i,newAggregate:r,schema:e};return!!this.core.setAggregate(n,o.config)&&(this.raiseVisualContainerChanged(o),!0)},r.prototype.removeAggregate=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removeAggregate(o,r.config)&&(this.raiseVisualContainerChanged(r),!0)},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.setPercentOfGrandTotal(o,r.config)&&(this.ensureValidDrillMode(r),this.raiseVisualContainerChanged(r),!0)},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removePercentOfGrandTotal(o,r.config)&&(this.raiseVisualContainerChanged(r),!0)},r.prototype.setPercentOfRoleTotal=function(e,t,i,r,o){var n={roleRefs:t,role:i,index:r,schema:e};return!!this.core.setPercentOfRoleTotal(n,o.config)&&(this.ensureValidDrillMode(o),this.raiseVisualContainerChanged(o),!0)},r.prototype.removePercentOfRoleTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removePercentOfRoleTotal(o,r.config)&&(this.raiseVisualContainerChanged(r),!0)},r.prototype.setVariation=function(e,t,i,r,o,n){if(n=n||1,o<0)return!1;for(var a=[],s=0;s<n;s++)if(a[s]=t.config.singleVisual.query.tryGetExpr(r,o+s),!a[s])return!1;var l=[i];if(V.isHierarchy(i)&&(l=A.convert(i,e),!l))return!1;var c=this.getVisualDataRole(t,r),u=x.getHierarchyReplacementExpressions(t.config,r,o,n,c,l);if(_.isEmpty(u))return!1;var p=u,d={sourceRole:r,targetRole:r,sourceIndex:o,targetIndex:o,sourceCount:a.length,replacementExpressions:p,schema:e,allowPartialReplace:!0},h={count:a.length,index:o,role:r},v=S.getDrillFilterRemovalInfoList(t.config.singleVisual.query,h,0),g=this.core.replace(d,t.config);return g&&(this.ensureValidDrillState(t,v),this.raiseVisualContainerChanged(t)),g},r.prototype.toggleShowAll=function(e,t){t&&(this.core.toggleShowAll(e,t.config),this.raiseVisualContainerChanged(t))},r.prototype.createVisualContainerConfig=function(e,t){return this.createVisualContainerConfigCore(t,e)},Object.defineProperty(r.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),r.prototype.addDrillToDetailsFilters=function(e,t,i){if(!_.isEmpty(i)&&i[0]&&!_.isEmpty(i[0].dataMap)){var o=N.getVisualQuery(t);if(o){var n=[];if(o.projections)for(var a in o.projections)_.isEmpty(o.projections[a].activeProjectionRefs)||n.push(o.projections[a].activeProjectionRefs);var s=i[0].dataMap;t.filters=t.filters||[];var l;for(l in s){var c=_.find(n,(function(e){return _.contains(e,l)}));this.core.addDrillToDetailsFilter(e,t.filters,o,c||[l],r.chooseRepetitionSelectorForDrill(s[l]))}}}},r.prototype.findCompatibleRole=function(r,o,n){var a=o.config.singleVisual,s=a.query||new H(e.data.SemanticQuery.create(),{}),l=this.visualPluginService.capabilities(a.visualType),c=s&&s.projections;if(l&&c){var u=e.requireSync("Explore/services/visualCapabilitiesHelper").create(l,this.geotaggingAnalyzerService);return u&&u.findCompatibleRole({queryProjections:c,schema:r,expr:n,roleToExprMap:new t.utils.SQExprToRoleDictionary(i.HierarchyUtils.hierarchyLevelComparer),preferDrillableRoles:!1})}},r.prototype.getMaxNumberOfExpressionsAllowedInRole=function(t,i,r){var o=i.config.singleVisual,n=o.query||new H(e.data.SemanticQuery.create(),{}),a=this.visualPluginService.capabilities(o.visualType),s=n&&n.projections;if(a&&s){var l=e.requireSync("Explore/services/visualCapabilitiesHelper").create(a,this.geotaggingAnalyzerService),c=S.getDrillableRoles(a);if(_.contains(c,r))return Number.MAX_VALUE;var u=l.getNumberRangesForRoles(n),p=u[r];if(p&&p.max)return p.max}return 0},r.prototype.getTargetRoleAndExpressionsForAdd=function(e,t,i,r){var o=i;if(k.isHierarchyOrVariation(e,i)&&(o=k.expandExpr(e,i),_.isArray(o))){var n=o;if(!r){var a=this.findCompatibleRole(e,t,n[0]);a&&(r=a.name)}if(r){var s=this.getMaxNumberOfExpressionsAllowedInRole(e,t,r);s!==Number.MAX_VALUE&&(o=1===s&&V.isColumn(i)?i:V.isHierarchy(i)||V.isColumn(i)?n.slice(0,s):n.slice(n.length-s,n.length))}}return{targetRole:r,expressions:o}},r.prototype.addExpressionToVisualWithoutAggregation=function(t,i,r,o){var n=r&&e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings),a=this.getTargetRoleAndExpressionsForAdd(t,i,o);return a.targetRole&&r.dataRoles[a.targetRole]!==e.VisualDataRoleKind.Measure||(a.expressions instanceof Array&&(a.expressions=o),n||this.shouldPreferGroupToAggregate(t,o,i)||(a.expressions=this.createExprWithAggregate(a.expressions,t,!1))),this.core.add({expr:a.expressions,schema:t,targetRole:a.targetRole},i.config)},r.prototype.addExpressionToVisualForcingAggregation=function(e,t,i,r){var o=this.createExprWithAggregate(r,e,!0);return this.core.add({expr:o,schema:e},t.config)},r.prototype.addExpressionToVisual=function(e,t,i,r){return this.core.add({expr:r,schema:e},t.config)},r.prototype.createVisualContainerConfigCore=function(e,t){var i,r=e.expr,o=r instanceof Array;!e.allowAggregate||o||this.shouldPreferGroupToAggregate(t,r)||(r=this.createExprWithAggregate(r,t,!1));var s=o?r[0]:r,l=e.visualType||n(s,t,this.geotaggingAnalyzerService,this.featureSwitches),c=a(s,t),u={expr:i?e.expr:r,schema:t,visualType:l},p=this.core.create(u);return null!=c&&p&&this.sortService.addSort(p.singleVisual.query,[{expr:s,direction:c}]),p},r.prototype.addVisualContainerImageFromData=function(e,t,i){var r="data:image/png;base64,"+t,o=this.resourceRegistration.add(i,100,r);this.addVisualContainerImage(e,o)},r.prototype.addVisualContainerImage=function(t,i){var o={singleVisual:{visualType:"image",objects:{general:[{properties:{imageUrl:i}}]}}},n=e.Prototype.inherit(t);n.position=r.getPositionForAddedVisual(t.exploreCanvas,t.position),this.createVisualFromConfig(n,o)},r.prototype.addVisualContainerBasicShape=function(t,i){var o=e.Prototype.inherit(t);o.position=r.getPositionForAddedVisual(t.exploreCanvas,t.position);var n={singleVisual:{visualType:d.name,objects:{general:[{properties:{shapeType:P.text(i)}}]}}},a=this.createVisualFromConfig(o,n);this.telemetry.logEvent(e.telemetry.EXCreateVisual,e.telemetry.HowVisualWasCreated.InsertVisualButton,N.getVisualType(a))},r.prototype.applyConfigOptions=function(e,t){return e.visualLink&&(t.singleVisual.visualLink=e.visualLink),t},r.prototype.addVisualContainer=function(e,t,i,o){o=r.getPositionForAddedVisual(i,o),t.expr=k.expandExpr(e,t.expr);var n=this.createVisualContainerConfig(e,t);if(n)return this.createVisualFromConfig({exploreCanvas:i,position:o},n)},r.prototype.addEmptyVisualContainer=function(e,t,i){i=r.getPositionForAddedVisual(e,i);var o={singleVisual:{visualType:t}};return this.createVisualFromConfig({exploreCanvas:e,position:i},o)},r.prototype.addVisualContainerFromConfig=function(e,t,i){var o=r.getPositionForAddedVisual(i,null);return this.createVisualFromConfig({exploreCanvas:i,position:o},e,t)},r.prototype.createVisualFilters=function(e,i,r){for(var o=t.viewModels.ViewModelFactory.createVisualFilters(e,r,this.displayNameService,this.visualPluginService,this.pluginOps,this.filterGenerator,this.aggrOps,this.localizationService),n=0,a=o;n<a.length;n++){var s=a[n];s.updateFilterProperties(r,this.visualPluginService,this.aggrOps),s.canVisualize()&&(s.isInvalid()||this.createFilterVisualContainerConfig(s.contract,i,r))}return o},r.prototype.addFilter=function(i,r,n,a,s){if(!t.FilterUtils.canAdd(r,i,n,s,this.pluginOps,this.filterGenerator,this.featureSwitchService))return!1;var p=s?5:1,d=t.FilterUtils.getDefaultFilterType(r,i,p),h={name:t.FilterUtils.getNextFilterName(n.container.filters),expression:r,type:d,expanded:!0,howCreated:p};e.data.SQExprUtils.isMeasure(r)||this.createFilterVisualContainerConfig(h,a,i),t.FilterUtils.add(n.container,h);var v={filter:h,changeType:1,scope:n};this.eventBridge.publishToChannel(b.filterContainerChanged,v);var g=D.getSelectedVisual(this.selectionService);return I.isMeasure(r)?this.telemetry.logEvent(e.telemetry.EXAddFilter,c(d),u(n.scopeType),l(r),N.hasGroupByItemsInQuery(g)):s&&o(this.telemetry,w.Add,n.container),!0},r.prototype.removeFilter=function(e,t){return this.removeFilterImpl(e,t)},r.prototype.createFilterVisualContainerConfig=function(t,i,r){var o=t.expression;if(!V.isTransformOutputRoleRef(o)){var n=I.discourageAggregation(o,r),a=T.asFieldPattern(o),s=a.column||a.groupingColumn||a.hierarchyLevel,l={expr:o,dataSources:i,allowAggregate:!1,visualType:e.visuals.plugins.slicer.name};if(!I.isMeasure(o)){var c=this.createVisualContainerConfigCore(l,r);if(c){var u=c.singleVisual.objects;u||(c.singleVisual.objects=u={});var p=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,d=e.visuals.slicerProps.selection.singleSelect,h=e.visuals.slicerProps.header.show,g=e.visuals.slicerProps.data.mode,m=5!==t.howCreated,w=5===t.howCreated;f.setValue(u,g,null,P.text(e.visuals.slicerMode.basic)),f.setValue(u,p,null,P.boolean(m)),f.setValue(u,d,null,P.boolean(w)),f.setValue(u,h,null,P.boolean(!1));var S=e.visuals.slicerProps.items.textSize;if(f.setValue(u,S,null,P.integer(v.smallFontSizeInPoint)),!n&&s){var b=P.entity(s.schema,s.entity,s.entityVar),C=P.aggregate(b,2),x=e.visuals.slicerProps.general.count,M=c.singleVisual.query.getRoleNameForExpr(o),D={data:[y.fromRoles([M])]};f.setValue(u,x,D,C)}var E=0===t.howCreated&&!F.isDefaultFilter(t.filter);if(this.ensureDefaultFilterApplied(r,c.singleVisual,E)&&null==t.filter){var A=a.column||a.groupingColumn?o.getKeyColumns(r):[o];t.filter=F.getDefaultValueFilter(A)}t.config=c}}}},r.prototype.raiseVisualContainerChanged=function(e,i,r){var o=this.explorationNavigationService.getCurrentSection();this.eventBridge.publishToChannel(t.services.events.visualContainerChanged,{affectContainer:i?N.filterAffects(e,o,this.visualRelationshipService,r):N.contractEqualityComparator(e)})},r.prototype.convert=function(i,r,o){var n=N.getVisualType(r),a=this.telemetry.startEvent(e.telemetry.EXInteractionVisualConversion,n,o),s=r.config.singleVisual.query;if(s){this.resetSearchProperties(r);var l=t.contracts.SingleVisualConfig.clone(r.config.singleVisual),c=this.core.convert({schema:i,source:l,target:o});if(!c)return a.reject();r.config.singleVisual=l,a.resolve();var u=this.visualPluginService.capabilities(n),p=this.filterGenerator.tryGetFilterPropertyIdentifier(u);if(!p){var d=this.visualPluginService.capabilities(o);p=this.filterGenerator.tryGetFilterPropertyIdentifier(d)}this.ensureValidDrillMode(r),this.ensurePercentRoleTotal(r,o),this.ensureDefaultFilterAndRaiseEvent(i,r,!1,p);var h=r.filters;return _.isEmpty(h)||t.FilterUtils.supportsVisualFilters(r,this.pluginOps,this.filterGenerator)||(r.filters=[]),c}return r.config.singleVisual.visualType=o,a.resolve(),this.raiseVisualContainerChanged(r),!0},r.prototype.setOrderBy=function(e,t){
e.config.singleVisual.query.orderBy(t),this.raiseVisualContainerChanged(e)},r.prototype.removeOrderBy=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];e.config.singleVisual.query.removeOrderBy(o)}this.raiseVisualContainerChanged(e)},r.prototype.deleteVisualRelationships=function(e,t){_.remove(e.relationships,(function(e){return e.source===t||e.target===t}))},r.prototype.addProperty=function(e,t,i,r){var o=e.config.singleVisual,n=o.objects;n||(o.objects=n={}),f.setValue(n,t,i,r)},r.prototype.removeProperty=function(e,t,i){var r=e.config.singleVisual.objects;f.deleteProperty(r,t.objectName,i,t.propertyName)},r.prototype.setVisualRelationship=function(e,t,i,r){if(t!==i){e.relationships=e.relationships||[];var o=this.visualRelationshipService.relationship(e,t,i);if(o)o.type=r;else{var n=(_.contains(e.visualContainers,t),_.contains(e.visualContainers,i),{source:t,target:i,type:r});e.relationships.push(n)}}},r.prototype.persistProperties=function(e,t){var i=!1,o=t.objects||{},n=this.visualPluginService.capabilities(t.visualType),a=n?n.objects:void 0;if(e.replace)for(var s=0,l=e.replace;s<l.length;s++){var c=l[s],u=f.ensure(o,c.objectName,c.selector),p={};for(var d in c.properties)g.isValidPropertyName(d)&&(p[d]=r.encodePropertyValue(c,d,a));f.allPropertiesAreEqual(u.properties,p)||(i=!0,u.properties=p)}if(e.merge)for(var h=0,v=e.merge;h<v.length;h++){var c=v[h],u=f.ensure(o,c.objectName,c.selector);for(var d in c.properties)if(g.isValidPropertyName(d)){var m=r.encodePropertyValue(c,d,a);f.propertiesAreEqual(u.properties[d],m)||(i=!0,u.properties[d]=m)}}if(e.remove)for(var y=0,w=e.remove;y<w.length;y++){var c=w[y],u=f.getObjectDefinition(o,c.objectName,c.selector);if(u)for(var d in c.properties)g.isValidPropertyName(d)&&u.properties.hasOwnProperty(d)&&(delete u.properties[d],i=!0)}if(e.removeObject)for(var S=0,b=e.removeObject;S<b.length;S++){var c=b[S];f.getObjectDefinition(o,c.objectName,c.selector)&&(i=f.deleteObjectDefinition(o,c.objectName,c.selector)||i)}return!!i&&(t.objects=o,!0)},r.prototype.ensureValidDrillState=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];this.core.removeDrillFilter(e.filters,o.expr);var n=e.config.singleVisual.query,a=n.projections[o.roleName];if(a){var s=_.last(a.activeProjectionRefs);if(null!=s){var l=n.defn.select().withName(s).expr;this.core.removeDrillFilter(e.filters,l)}}}this.ensureValidDrillMode(e)},r.prototype.ensureValidDrillMode=function(e){var t=e.drillMode;(1===t&&0===this.drill.getSupportedDrillDirections(e)||2===t&&!this.drill.canDrillToDetails(e))&&this.drill.setDrillMode(e,0)},r.prototype.ensurePercentRoleTotal=function(e,r){var o=this.visualPluginService.capabilities(r);if(!o.dataRoleTotals){var n=new $,a=new t.schemaRewriterUtils.VisualQueryExprRewriter(n),s=new i.VisualContainerRewriter([a]);i.traverseVisualContainer(e,s,this.visualPluginService)}},r.prototype.getVisualDataRole=function(e,t){var i=N.getDataRolesForVisual(e,this.visualPluginService);if(!_.isEmpty(i))return p.findItemWithName(i,t)},r.prototype.removeFieldImpl=function(e,t){return this.invokeRemoveOnSelectedVisuals({expr:e,ignoreAggregates:!0},t)},r.prototype.removeFilterImpl=function(e,t){if(!t||!t.container||!t.container.filters)return!1;for(var i={filter:e,changeType:0,scope:t},r=0;r<t.container.filters.length;r++)if(t.container.filters[r]===e)return t.container.filters.splice(r,1),this.eventBridge.publishToChannel(b.filterContainerChanged,i),5===e.howCreated&&o(this.telemetry,w.Delete,t.container),!0;return!1},r.prototype.removeFiltersWithExpr=function(e,t){var i=t.filters;if(!i)return!1;for(var r,o=i.length-1;o>=0;o--){var n=i[o];V.equals(n.expression,e)&&(r=this.removeFilterImpl(n,{scopeType:0,container:t}))}return r},r.prototype.invokeRemoveOnSelectedVisuals=function(e,t){for(var i=!1,r=t.length-1;r>-1;r--){var o=t[r],n=o.config.singleVisual.query,a=S.getDrillFilterRemovalInfoList(n,e,0);this.removeExpressionsFromVisual(e,o.config)&&(this.ensureValidDrillState(o,a),this.isEmptyQueryVisual(o)?this.eventBridge.publishToChannel(b.deleteVisualContainer,o):this.raiseVisualContainerChanged(o),i=!0)}return i},r.prototype.isEmptyQueryVisual=function(t){var i=t.config.singleVisual;if(i&&this.pluginOps.isQueryVisual(i.visualType)&&i.query&&0===i.query.defn.select().length){var r=this.visualPluginService.capabilities(i.visualType);if(r){var o=e.ScriptResultUtil.extractScriptResultFromVisualConfig(r.dataViewMappings,i.objects);return!(o&&!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(o.source))}return!1}return!1},r.prototype.removeExpressionsFromVisual=function(e,t){for(var i=e.count||1,r=0;r<i;r++)if(!this.core.remove(e,t))return!1;return!0},r.prototype.createVisualFromConfig=function(e,i,r){i=this.applyConfigOptions(e,i);var o=this.formFactorProvider.getCurrentLayout(),n=e.exploreCanvas,a={name:N.uniqueName(n.contract.visualContainers),config:i,filters:r||[],layouts:jsCommon.ArrayExtensions.extendWithId([{id:o,position:e.position}])};n.contract.visualContainers.push(a);var s=this.explorationNavigationService.getCurrentExploration(),l=t.viewModels.ViewModelFactory.convertVisualContainer(s,n.contract,a,o);if(l)return n.visualContainers.push(l),e.select!==!1&&D.selectVisualContainer(a,this.selectionService),a},r.prototype.createExprWithAggregate=function(e,t,i,r){if(I.discourageAggregation(e,t))return e;var o=this.getPreferredAggregate(t,e,r);return this.aggrOps.createExprWithAggregate(e,t,i,r?r.requiredTypes:null,o)},r.getPositionForAddedVisual=function(e,t){if(!t)return r.getDefaultVisualContainerPosition(e);if(null!=t.z)return t;var o=_.cloneDeep(t);return o.z=i.CanvasVisualsUtility.getZIndexForNewVisual(e),o},r.getDefaultVisualContainerPosition=function(e){return{height:0,width:0,x:0,y:0,z:i.CanvasVisualsUtility.getZIndexForNewVisual(e)}},r.prototype.shouldPreferGroupToAggregate=function(t,i,r,o){if(this.isRoleOrExprLatLong(t,i,o)&&o&&o.kind===e.VisualDataRoleKind.GroupingOrMeasure){if(r){var n=N.getVisualQuery(r);if(n&&n.projections)for(var a=this.visualPluginService.capabilities(r.config.singleVisual.visualType),s=e.requireSync("Explore/services/visualCapabilitiesHelper").create(a,this.geotaggingAnalyzerService),l=s.getNonLatLongCategoricalRoles(),c=0,u=l;c<u.length;c++){var p=u[c];if(n.projections[p])return!1}}return!0}return o&&o.kind!==e.VisualDataRoleKind.Measure},r.prototype.getPreferredAggregate=function(e,t,i){if(this.isRoleOrExprLatLong(e,t,i))return 1},r.prototype.isRoleOrExprLatLong=function(t,i,r){var o=e.requireSync("Explore/services/visualCapabilitiesHelper").isValueTypeDescriptorLatLong;if(r){var n=r.preferredTypes,a=_.isEmpty(n)?void 0:n[0];if(o(a))return!0}var s=i.getMetadata(t),l=s?s.type:void 0;if(o(l))return!0;if(l){var c=T.asFieldPattern(i),u=c.column||c.columnAggr||c.groupingColumnAggr||c.groupingColumnAggr||c.measure;if(u){var p=u&&this.geotaggingAnalyzerService.getFieldType(u.name);if(null!=p){var d=e.ValueType.fromPrimitiveTypeAndCategory(l.primitiveType,p);if(o(d))return!0}}}return!1},r.prototype.canHierarchyLevelJoinExistingGroup=function(e,t,i,r,o){var n=t&&t.projections[i];if(V.isHierarchyLevel(r)&&n&&n.all().length>0){var a=r,s=n.all(),l=k.expandExpr(e,a.arg),c=_.isNumber(o)?o-1:s.length-1;if(c>=0&&k.areHierarchyLevelsOrdered(l,t.tryGetExpr(i,c),a))return!0;if(_.isNumber(o)&&o<s.length&&k.areHierarchyLevelsOrdered(l,a,t.tryGetExpr(i,o)))return!0}return!1},r.prototype.addHierarchyLevelToExistingHierarchiesInVisual=function(e,t,i,r){var o=!1,n=x.getOptionsToAddHierarchyLevelToExistingHierarchies(e,t,i.singleVisual.query,r);if(n)for(var a=0,s=n;a<s.length;a++){var l=s[a];o=this.core.add(l,i)||o}return o},r.prototype.ensureDefaultFilterAndRaiseEvent=function(e,t,i,r){var o=t.config.singleVisual;if(this.ensureDefaultFilterApplied(e,o,i))this.eventBridge.publishToChannel(b.visualContainerChanged,{affectContainer:function(e){return!0}});else{var n=void 0;if(r&&o.objects){var a=r&&f.getValue(o.objects,r,null);n=null!=a}this.raiseVisualContainerChanged(t,n,e)}},r.prototype.ensureDefaultFilterApplied=function(e,t,i){var r=t.query.getUniqueQueryRefs();if(0===r.length)return!1;var o=t.query.defn.select().withName(r[0]).expr,n=I.getDefaultValue(o,e),a=this.visualPluginService.capabilities(t.visualType),s=a?a.objects:null;if(!n)return this.clearDefaultValueAndFilter(t,o,s),!1;var l=m.findDefaultValue(s);if(!l)return this.clearDefaultValueAndFilter(t,o,s),!1;if(i)return!1;t.objects||(t.objects={});var c,u=T.asFieldPattern(o);c=u.column||u.groupingColumn?o.getKeyColumns(e):o;var p=m.findFilterOutput(s),d=F.getDefaultValueFilter(c);return f.setValue(t.objects,p,null,d),!0},r.prototype.clearDefaultValueAndFilter=function(e,t,i){if(e.objects){var r=m.findFilterOutput(i);if(r){var o=f.getValue(e.objects,r,null);F.isDefaultFilter(o)&&f.deleteProperty(e.objects,r.objectName,null,r.propertyName)}}},r.prototype.resetSearchProperties=function(e){var t=N.getObjectDefinitions(e);if(t){var i=N.getVisualCapabilities(e,this.visualPluginService),r=this.filterGenerator.tryGetSelfFilterEnabledProperty(i);r&&f.deleteProperty(t,r.objectName,null,r.propertyName);var o=this.filterGenerator.tryGetSelfFilterProperty(i);o&&f.deleteProperty(t,o.objectName,null,o.propertyName)}},r.prototype.logReportMeasureMoveTelemetry=function(t,i,r,o,n){if(r!==o){var a=n&&n.getTargetEntity();if(a&&a.schema===v.ExplorationSchemaName){var s=n.getConceptualProperty(t);if(s){var l=this.getVisualDataRole(i,r),c=this.getVisualDataRole(i,o),u=JSON.stringify(l.requiredTypes),p=JSON.stringify(c.requiredTypes);u!==p&&this.telemetry.logEvent(e.telemetry.EXReportMeasureMoveRoleKind,e.PrimitiveTypeStrings[s.type.primitiveType],u,p)}}}},r.encodePropertyValue=function(e,t,i){var r,o=e.properties[t];return i&&i[e.objectName]&&i[e.objectName].properties[t]&&(r=i[e.objectName].properties[t].type),f.encodePropertyValue(o,r||{})},r})(),$=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.visitScopedEval=function(e){return new L(e.expression,[])},t})(e.data.SQExprRewriter);i.getVisualDefaultType=n,i.getVisualDefaultSort=a})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{deleteVisualRelationships:_.noop,getFilters:function(){return{dataFilter:null}},getVisualRelationshipFilterAction:function(){return 0},selectDataPoint:_.noop,setVisualRelationshipFilterAction:_.noop,clearHighlight:_.noop}}e.createQueryVisualHostServices=t})(t=e.VisualHostServicesUtil||(e.VisualHostServicesUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t){var i=[{name:"AccessibilityInfo",blockType:2,consumerHostFlags:299},{name:"AdvancedFilter",blockType:1,consumerHostFlags:299},{name:"BoxGrid",syncModule:"ExploreUI/components/boxGrid/boxGrid",blockType:2,consumerHostFlags:3},{name:"CanvasLayout",blockType:1,consumerHostFlags:299},{name:"CanvasLayoutItem",blockType:1,consumerHostFlags:299},{name:"CanvasVisualError",blockType:1,consumerHostFlags:299},{name:"CanvasVisualErrorOverlay",blockType:2,consumerHostFlags:299},{name:"CanvasVisualHeaderIcon",blockType:1,consumerHostFlags:299},{name:"Carousel",blockType:1,consumerHostFlags:299},{name:"ConditionalFormattingDialog",blockType:2,consumerHostFlags:811},{name:"ConvertTableDialog",blockType:1,consumerHostFlags:521},{name:"DatabarsDialog",blockType:2,consumerHostFlags:811},{name:"DateTimePicker",blockType:2,consumerHostFlags:11},{name:"DeleteVisualWarningDialog",blockType:1,consumerHostFlags:299},{name:"DetailVisual",blockType:1,consumerHostFlags:299},{name:"DisplayOptionFilter",dependencies:["localizationService"],blockType:4,consumerHostFlags:299},{name:"DotGrid",blockType:2,consumerHostFlags:11},{name:"EmbedModalDialog",blockType:1,consumerHostFlags:299},{name:"EsriConsentDialog",blockType:1,consumerHostFlags:299},{name:"Exploration",blockType:1,consumerHostFlags:299},{name:"ExplorationAppBar",blockType:1,consumerHostFlags:299},{name:"ExplorationFooter",blockType:2,consumerHostFlags:299},{name:"ExplorationHost",blockType:1,consumerHostFlags:299},{name:"ExplorationNavigationTab",dependencies:["platformCapabilities"],blockType:1,consumerHostFlags:299},{name:"ExplorationPaginator",blockType:1,consumerHostFlags:299},{name:"ExplorationStatusBar",blockType:1,consumerHostFlags:299},{name:"ExploreCanvas",dependencies:["telemetryService","overlayService","visualHostTooltip"],blockType:1,consumerHostFlags:299},{name:"FieldList",blockType:1,consumerHostFlags:811},{name:"FieldListEntity",blockType:1,consumerHostFlags:811},{name:"FieldListProperty",blockType:1,consumerHostFlags:811},{name:"Filter",blockType:1,consumerHostFlags:299},{name:"FilterPane",blockType:1,consumerHostFlags:299},{name:"FilterVisual",blockType:1,consumerHostFlags:299},{name:"FocusGroup",dependencies:["focus"],blockType:1,consumerHostFlags:811},{name:"IncludeExcludeFilter",blockType:2,consumerHostFlags:299},{name:"MobileVisualizationPane",blockType:2,consumerHostFlags:33},{name:"ImportVisualErrorDialog",blockType:1,consumerHostFlags:299},{name:"ImportVisualWarningDialog",blockType:1,consumerHostFlags:299},{name:"ModelingContextChanger",blockType:1,consumerHostFlags:299},{name:"PbiValidate",blockType:1,consumerHostFlags:299},{name:"PenAnnotation",blockType:2,consumerHostFlags:299},{name:"PropertyPaneTextBox",dependencies:["localizationService"],blockType:1,consumerHostFlags:811},{name:"RelativeDateFilter",blockType:2,consumerHostFlags:299},{name:"SelectionBox",blockType:1,consumerHostFlags:299},{name:"TableViewDialog",blockType:2,consumerHostFlags:523},{name:"TaskPane",blockType:1,consumerHostFlags:299},{name:"TopNFilter",blockType:2,consumerHostFlags:299},{name:"VirtualList",blockType:1,consumerHostFlags:299},{name:"VisualContainer",blockType:1,consumerHostFlags:299},{name:"VisualContainerContextMenu",blockType:1,consumerHostFlags:299},{name:"VisualContainerDrill",blockType:2,consumerHostFlags:299},{name:"VisualContainerDrillToggle",blockType:2,consumerHostFlags:299},{name:"VisualContainerRelationshipFilters",blockType:2,consumerHostFlags:299},{name:"VisualContainerHeader",blockType:2,consumerHostFlags:299},{name:"VisualContainerOptionsMenu",blockType:2,consumerHostFlags:299},{name:"VisualContainerPinButton",blockType:2,consumerHostFlags:299},{name:"VisualContainerPopOutBar",blockType:1,consumerHostFlags:299},{name:"VisualizationPane",blockType:1,consumerHostFlags:299},{name:"VisualWatermark",dependencies:["$templateCache","visualPlugin"],blockType:1,consumerHostFlags:299}];e.common.registerBuildingBlocksForHost(t,i,{componentsTarget:"powerbi.explore.components",componentsMap:e.explore.components,directivesTarget:"powerbi.explore.directives",directivesMap:e.explore.directives,filtersTarget:"powerbi.explore.filters",filtersMap:e.explore.filters})}var r=e.explore.services;angular.module("powerbi.explore.controllers",[]),angular.module("powerbi.explore.directives",[]),angular.module("powerbi.explore.components",[]),angular.module("powerbi.explore.filters",[]);var o=["powerbi.common","powerbi.explore.controllers","powerbi.explore.directives","powerbi.explore.components","powerbi.explore.filters","powerbi.visualHost"];angular.module("powerbi.explore",o).config(["dataReaderProviderProvider",function(t){t.registerExplorationDataReaderExtension=e.explore.dataReaderPlugins.registerExplorationDataReaderExtension}]).config(["lazyProvider",function(e){var t=e.factories;t.fieldWellViewModelFactory={source:{javascript:"ExploreUIShell/viewModels/fieldWellViewModelFactory"},ng:["aggrOps","displayNameService","featureSwitchService","geoTaggingAnalyzerService","promiseFactory"],fn:function(e,t,i,r,o,n){return e.create(t,i,r,o,n)}},t.instantEmail={source:{javascript:"PowerBISidePanes/services/instantEmailService"},ng:["taskPaneSliderService"],fn:function(e,t){return e.create(t)}}}]).config(["lazySyncProvider",function(t){var i=t.factories;i.linguisticSchemaProxy={ng:["promiseFactory"],fn:function(t,i){return t("Explore/proxies/linguisticSchemaProxy").create(i,e.common.httpService)}},i.insightsCache={fn:function(e){return e("Insights/services/insightsCache").create()}}}]).factory("displayNameService",["aggrOps","featureSwitchService","localizationService",function(t,i,r){var o=r,n={aggregateDisplayNames:{Sum:o.get("DisplayName_Sum"),Avg:o.get("DisplayName_Avg"),Count:o.get("DisplayName_Count"),Min:o.get("DisplayName_Min"),Max:o.get("DisplayName_Max"),CountNonNull:o.get("DisplayName_CountNonNull"),Median:o.get("DisplayName_Median"),StandardDeviation:o.get("DisplayName_StandardDeviation"),Variance:o.get("DisplayName_Variance"),DateMin:o.get("DisplayName_DateMin"),DateMax:o.get("DisplayName_DateMax"),StringMin:o.get("DisplayName_StringMin"),StringMax:o.get("DisplayName_StringMax")},showValueAsDisplayNames:{PercentOfGrandTotal:o.get("DisplayName_QuickCalc_PercentOfGrandTotal"),PercentOfGrandTotalTooltip:o.get("DisplayName_QuickCalc_PercentOfGrandTotalTooltip"),PercentileExclusive:o.get("DisplayName_QuickCalc_PercentileExclusive"),PercentileInclusive:o.get("DisplayName_QuickCalc_PercentileInclusive")},qualifiedDisplayNameTemplate:o.get("Field_Tooltip"),stringResourceProvider:o};return e.explore.services.createDisplayNameService(n,t,i)}]).factory("visualPlugin",["asyncFeatureSwitchService","mapControlFactory","promiseFactory","resourceLoader","visualSandbox",function(t,i,r,o,n){return e.explore.services.createExplorationVisualPluginService(t,r,o,i,n)}]).factory("transformPluginService",[function(){return e.data.transforms.createTransformPluginService()}]).factory("explorationSerializer",["visualPlugin","featureSwitchService","telemetryService",function(t,i,r){return e.explore.services.createExplorationSerializer(t,r)}]).factory("reportTileService",["promiseFactory","explorationProxy","$timeout",function(t,i,r){return e.explore.services.createReportTileService(t,i,r)}]).factory("explorationProxy",["promiseFactory","explorationSerializer","telemetryService","featureSwitchService",function(t,i,r,o){return e.explore.proxies.createExplorationProxy(t,e.common.httpService,i,r,o)}]).factory("layoutInsertionHelper",(function(){return e.explore.services.createLayoutInsertionHelper()})).factory("federatedSchemaValidator",["localizationService",function(t){return e.explore.services.createFederatedSchemaValidator(t)}]).factory("geoTaggingAnalyzerService",["localizationService",function(t){return e.requireSync("VisualsCommon/services/geoTaggingAnalyzerService").create((function(e){return t.get(e)}))}]).factory("daxParserService",(function(){return e.explore.services.createDaxParserService()})).factory("cultureService",(function(){return e.explore.services.createCultureService()})).factory("uiBlockingService",["promiseFactory",function(t){return e.explore.services.createUIBlockingService(t)}]).factory("embedProxy",["promiseFactory","localizationService",function(i,r){return t.proxies.createEmbedProxy(e.common.httpService,i,r)}]).factory("networkAvailability",[function(){return e.common.createNetworkAvailabilityService()}]).factory("visualStylePreset",(function(){return e.visualHost.services.createVisualStylePresetService()})).factory("visualHostTooltip",["$timeout","featureSwitchService",function(t,i){return e.explore.services.createVisualHostTooltipService(t,i.featureSwitches.touchScreenOptimizedTooltips)}]).directive("datepickerPopup",(function(){return{restrict:"EAC",require:"ngModel",link:function(e,t,i,r){r.$formatters.shift()}}})).factory("subscription",["taskPaneSliderService","userInfo","localizationService",function(t,i,r){return e.explore.services.createSubscriptionPaneService(t,i,r)}]).factory("visualConsent",["promiseFactory","telemetryService",function(t,i){return e.visualHost.createVisualConsentService(t,i)}]).factory("trustedVisual",["promiseFactory","telemetryService","visualConsent","approvedResourceService","visualSandbox","resourceLoader",function(t,i,r,o,n,a){return e.visualHost.createTrustedVisualService(t,i,r,o,n,a)}]).factory("focus",["$rootElement","modalDialogService",function(t,i){return e.explore.services.createFocusService(t,i)}]).run(["lazyScopedFactories",function(e){e.clustering={source:{javascript:"ExploreUI/services/clustering"},ng:["conceptualSchemaProxy","errorService","explorationSerializer","localizationService","modalDialogService","promiseFactory","telemetryService"],scoped:["clusteringState","groupingDesignStateService","modelChangeHandler","visualAuthoring","visualPlugin"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d){return e.create(t,null,l,c,p,d,i,o,u,n,a,s,r)}},e.drillthrough={source:{javascript:"ExploreActions/services/drillthrough"},ng:["conceptualSchemaProxy"],scoped:["dataSources","explorationNavigation"],fn:function(e,t,i,r){return e.create(t,i,r)}},e.insightsAnalysisService={source:{javascript:"Insights/services/insightsAnalysisService"},ng:["displayNameService","localizationService","featureSwitchService"],scoped:["visualPluginOps","visualPlugin"],fn:function(e,t,i,r,o,n){return e.create(t,o,i,r,n)}},e.explorationState={source:{javascript:"Explore/services/explorationState"},ng:["aggrOps","conceptualSchemaProxy"],scoped:["dataSources","filterGenerator","visualPlugin","visualPluginOps"],fn:function(e,t,i,r,o,n,a){return e.create(o,n,a,r,i,t)}},e.explorationStateManager={source:{javascript:"ExploreUI/services/explorationStateManager"},scoped:["explorationNavigation","eventBridge","visibility"],scopedModular:["explorationState"],fn:function(e,t,i,r,o){return e.create(o,t,i,r)}},e.bookmark={source:{javascript:"ExploreUIShell/services/bookmarkService"},ng:["localizationService","$rootScope"],scoped:["explorationNavigation","viewModeState","undoRedo"],scopedModular:["explorationStateManager"],fn:function(e,t,i,r,o,n,a){return e.create(i,a,r,t,o,n)}}}]).run(["lazyScopedSyncFactories",function(e){e.drillToDetails={ng:["aggrOps","conceptualSchemaProxy","displayNameService","explorationSerializer","geoTaggingAnalyzerService","featureSwitchService","localizationService","$rootScope","$timeout","telemetryService"],scoped:["drill","eventBridge","explorationNavigation","filterGenerator","visibility","resourceRegistration","selection","sort","undoRedo","visualPlugin","visualPluginOps","visualRelationship","formFactor"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y,w,S,b,C,x){return e("ExploreUI/services/drillToDetails").create(i,o,S,b,n,w,a,m,h,g,l,c,d,r,u,y,C,p,v,t,f,s,x)}},e.quickCalcService={ng:["aggrOps","conceptualSchemaProxy","modalDialogService","promiseFactory","telemetryService","explorationSerializer"],scoped:["dataSources","modelAuthoring","modelChangeHandler","daxTemplateService","visualAuthoring"],fn:function(e,t,i,r,o,n,a,s,l,c,u,p){return e("ExploreUI/services/quickCalc").create(t,i,s,a,r,l,c,o,u,p,n)}}}]).run(["scopedProvider",function(i){i.register("dataSources",{fn:function(){return r.createDataSourcesService()}}).register("canvasScale",{services:["overlayService"],scopedServices:["explorationNavigation","formFactor","visibility","viewModeState"],fn:function(e,t,i,o,n){return r.createCanvasScaleService(t,i,o,n,e)}}).register("uiComponent",{services:["$compile","promiseFactory","moduleLoader"],fn:function(t,i,r){return e.explore.services.createUIComponentService(t,r,i)}}).register("eventBridge",{fn:function(){return e.common.createEventBridge()}}).register("includeExcludeService",{services:["localizationService","telemetryService"],scopedServices:["eventBridge","undoRedo"],fn:function(e,i,r,o){return t.services.createIncludeExcludeService(r,e,o,i)}}).register("explorationNavigation",{services:["explorationProxy"],scopedServices:["$scope","eventBridge","selection","formFactor"],fn:function(t,i,r,o,n){return e.explore.services.createExplorationNavigationService(t,r,i,o,n)}}).register("servicePauser",{fn:function(){return e.explore.services.createServicePauser()}}).register("formFactor",{services:["$timeout","telemetryService"],scopedServices:["eventBridge","selection","servicePauser","viewModeState"],fn:function(e,t,i,o,n,a){return r.createFormFactorProvider(i,o,n,e,a,t)}}).register("viewModeState",{fn:function(){return e.explore.services.createViewModeState()}}).register("colorPicker",{fn:function(){return e.common.createColorPickerService()}}).register("drill",{services:["featureSwitchService"],scopedServices:["eventBridge","visualPlugin","visualPluginOps"],fn:function(e,t,i,o){return r.createDrillService(t,i,o,e)}}).register("groupAuthoring",{services:["telemetryService"],fn:function(t){return e.explore.services.createDisabledGroupAuthoringService(t)}}).register("selection",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSelectionService(t)}}).register("visibility",{services:["telemetryService"],scopedServices:["eventBridge","selection"],fn:function(t,i,r){return e.explore.services.createVisibilityService(t,i,r)}}).register("deleteVisual",{services:["$rootScope","telemetryService"],scopedServices:["eventBridge","visualPlugin","undoRedo"],fn:function(t,i,r,o,n){return e.exploreui.services.createDeleteVisualService(r,t,i,o,n)}}).register("importVisual",{services:["$rootScope","errorService","localFileService","localizationService","modalDialogService","notificationToast","promiseFactory","telemetryService","upload"],scopedServices:["eventBridge","visualPlugin"],fn:function(t,i,r,o,n,a,s,l,c,u,p){return e.exploreui.services.createImportVisualService(t,i,r,o,n,a,s,l,c,u,p)}}).register("visualRelationship",{scopedServices:["visualPlugin","visualPluginOps"],fn:function(t,i){return e.explore.services.createVisualRelationshipService(t,i)}}).register("visualPluginOps",{scopedServices:["visualPlugin"],fn:function(t){return e.explore.services.createVisualPluginOps(t)}}).register("undoRedo",{services:["$rootScope","logger"],scopedServices:["eventBridge","registeredResourceReferences"],fn:function(t,i,r,o){return e.explore.services.createUndoRedoService(t,r,i,o)}}).register("clipboard",{services:["visualStylePreset","$rootScope","promiseFactory"],scopedServices:["eventBridge","visibility","undoRedo","servicePauser","registeredResourceReferences"],fn:function(t,i,r,o,n,a,s,l){return s.register(e.explore.services.createClipboardService(o,n,a,t,i,l,r))}}).register("hostFiltersService",{services:["conceptualSchemaProxy","singleExecutableDataProxyFactory","promiseFactory"],scopedServices:["eventBridge"],fn:function(t,i,r,o){return e.explore.services.createHostFiltersService(t,i,r,o)}}).register("visualPlugin",{services:["asyncFeatureSwitchService","mapControlFactory","promiseFactory","visualSandbox"],scopedServices:["resourceLoader"],fn:function(t,i,r,o,n){return e.explore.services.createExplorationVisualPluginService(t,r,n,i,o)}}).register("sort",{services:["displayNameService","featureSwitches"],scopedServices:["visualPlugin"],fn:function(t,i,r){return e.explore.services.createSortService(t,i,r)}}).register("scriptVisuals",{services:["featureSwitchService","localizationService","userInfo","embedModeService"],scopedServices:["visualPlugin"],fn:function(t,i,r,o,n){return e.explore.services.createScriptVisualsService(n,t,i,r,o)}}).register("filterGenerator",{services:["aggrOps","telemetryService"],scopedServices:["eventBridge","hostFiltersService","visualPlugin","visualRelationship","scriptVisuals"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createFilterGenerator(r,n,t,a,o,i,s)}}).register("visualQueryGenerator",{services:["aggrOps","dataReaderProvider","displayNameService","featureSwitchService","transformPluginService","telemetryService"],scopedServices:["filterGenerator","visualPlugin","visualPluginOps","sort"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createVisualQueryGenerator({dataReaders:i,displayNameService:r,featureSwitchService:o,plugin:l,pluginOps:c,sortService:u,aggrOps:t,filterGenerator:s,transformPluginService:n,telemetryService:a})}}).register("visualAuthoring",{services:["conceptualSchemaProxy","displayNameService","explorationSerializer","telemetryService","promiseFactory","geoTaggingAnalyzerService","featureSwitchService","aggrOps","visualHostTooltip","localizationService"],scopedServices:["drill","eventBridge","undoRedo","explorationNavigation","resourceRegistration","selection","sort","visualPlugin","visualPluginOps","visualRelationship","filterGenerator","formFactor"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y,w,S,b,C){return e.explore.services.createVisualAuthoring(y,w,t,i,o,v,f,a,r,d,n,h,s,m,S,p,b,l,c,g,C,u)}}).register("layoutAuthoring",{services:["explorationSerializer","telemetryService"],scopedServices:["eventBridge","explorationNavigation","formFactor","undoRedo","selection"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createLayoutAuthoring(t,i,r,a,o,n,s)}}).register("canvasKeyHandler",{services:["explorationSerializer"],scopedServices:["selection","clipboard","undoRedo","viewModeState","visualAuthoring","eventBridge","visibility","formFactor","layoutAuthoring"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createCanvasKeyHandlerService(r,i,t,n,o,a,s,l,c,u)}}).register("modelChangeHandler",{services:["conceptualSchemaProxy","dataProxy","lazySync","pbiLazyLoad","promiseFactory"],scopedServices:["$scope","dataSources","eventBridge","undoRedo","visualPlugin"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createModelChangeHandler(t,i,a,s,l,c,u,n,r,o)}}).register("modelAuthoring",{services:["promiseFactory","telemetryService","modalDialogService","localizationService","daxParserService","explorationSerializer","cultureService","uiBlockingService"],scopedServices:["modelChangeHandler","explorationNavigation"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d){return e.explore.services.createModelAuthoringService(t,i,c,r,o,u,p,d,n,a,s,l)}}).register("clusteringState",{fn:function(){return e.explore.services.createClusteringStateService()}}).register("groupingDesignStateService",{fn:function(){return e.explore.services.createGroupingDesignStateService()}}).register("groupQueryService",{services:["conceptualSchemaProxy","promiseFactory","singleExecutableDataProxyFactory"],scopedServices:["filterGenerator","visualQueryGenerator"],fn:function(e,i,r,o,n){return t.services.createGroupQueryService(r,o,e,n,i)}}).register("schemaItemActivation",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSchemaItemActivationService(t)}}).register("shell",{fn:function(){return e.explore.services.createShellService()}}).register("pinVisual",{services:["conceptualSchemaProxy","displayNameService","singleExecutableDataProxyFactory","featureSwitchService","resourcePackagesService"],scopedServices:["visualQueryGenerator","visualPlugin"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createPinVisualService(t,i,r.create(),o,n,a,s)}}).register("explorationCapabilities",{fn:function(){return e.explore.services.createExplorationCapabilitiesService()}}).register("extensionsService",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createExtensionsService(t)}}).register("embed",{services:["$location","promiseFactory","explorationSerializer","conceptualSchemaProxy","dataProxy","displayNameService","activeGroupId"],scopedServices:["visualQueryGenerator","visualPlugin","filterGenerator"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createEmbedService(t,i,r,o,l,n,c,a,u,s)}}).register("exportVisualData",{services:["aggrOps","conceptualSchemaProxy","singleExecutableDataProxyFactory","geoTaggingAnalyzerService","featureSwitchService","promiseFactory","displayNameService","localizationService"],scopedServices:["visualPlugin","visualQueryGenerator"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createExportVisualDataService(c,u,r.create(),i,t,o,n,a,s,l)}}).register("resourcePublishing",{fn:function(t){return e.explore.services.createResourcePublishingService()}}).register("resourceRegistration",{scopedServices:["explorationNavigation","resourcePublishing"],fn:function(t,i){return e.explore.services.createResourceRegistrationService(t,i);
}}).register("registeredResourceReferences",{services:["promiseFactory","explorationSerializer"],scopedServices:["resourceLoader","explorationNavigation","resourceRegistration"],fn:function(e,t,i,o,n){return r.createRegisteredResourceReferenceService(e,i,o,t,n)}}).register("filterRestatement",{services:["conceptualSchemaProxy","promiseFactory","dataProxy"],scopedServices:["filterGenerator","visualQueryGenerator"],fn:function(t,i,r,o,n){return e.explore.services.createFilterRestatementService(t,o,i,r,n)}}).register("daxTranslator",{fn:function(){return e.explore.services.createDaxTranslator()}}).register("daxTemplateService",{services:["conceptualSchemaProxy","displayNameService","localizationService"],scopedServices:["daxTranslator","dataSources","lazyScoped"],fn:function(t,i,r,o,n,a){return e.explore.services.createDaxTemplateService({daxTranslator:o,conceptualSchemaProxy:t,dataSources:n,displayNameService:i,localizationService:r,lazyScoped:a})}}).register("visualValidator",{services:["featureSwitchService","localizationService","trustedVisual"],scopedServices:["visualPlugin","scriptVisuals","shell"],fn:function(t,i,r,o,n,a){return e.explore.services.createVisualValidatorService(t,o,n,a,i,r)}}).register("showValueAsService",{services:["localizationService","promiseFactory","telemetryService"],scopedServices:["undoRedo","visualAuthoring","visualPlugin"],fn:function(t,i,r,o,n,a){return e.explore.services.createShowValueAsService(t,i,r,o,n,a)}}).register("visualContainerContextMenuFactory",{services:["conceptualSchemaProxy","dropdown","featureSwitchService","localizationService","promiseFactory","telemetryService"],scopedServices:["dataSources","drill","extensionsService","lazyScopedSync","eventBridge","explorationCapabilities","explorationNavigation","filterGenerator","groupAuthoring","includeExcludeService","lazyScoped","viewModeState","visibility","visualAuthoring"],fn:function(t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y,w,S){return e.explore.services.createVisualContainerContextMenuFactoryService(t,s,l,c,u,i,p,d,h,r,g,f,m,o,w,n,S,y,v,a)}})}]),t.registerBuildingBlocksForHost=i})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.TransformElementResizeStartEventName="TransformElementResizeStart",e.TransformElementResizeMoveEventName="TransformElementResizeMove",e.TransformElementResizeEndEventName="TransformElementResizeEnd",e.TransformElementDragStartEventName="TransformElementDragStart",e.TransformElementDragMoveEventName="TransformElementDragMove",e.TransformElementDragEndEventName="TransformElementDragEnd",e.TransformElementNudgeEventName="TransformElementNudge",e.scrollCarouselToEndEventName="scrollCarouselToEnd",e.explorationLoadedEventName="explorationLoaded",e.pinVisualContainerEventName="pinVisualContainer",e.trustedVisualConsentStateChangedEventName="trustedVisualConsentStateChanged",e.invalidVisualContainerId=-1,e.explorationNextPageEvent="explorationNextPage",e.explorationPreviousPageEvent="explorationPreviousPage",e.insertSectionEvent="insertSectionEvent",e.renameSectionEvent="renameSectionEvent",e.deleteSectionEvent="deleteSectionEvent",e.switchSectionEvent="switchSectionEvent",e.updateNavButtonEvent="updateNavButtonEvent",e.exploreCanvasVisualRendered="exploreCanvasVisualRendered",e.ConnectionSetupLimit=4,e.smallFontSizeInPoint=9;var t;!(function(e){e.AutoLayoutVisualPadding=10,e.AutoLayoutVisualVCHeader=20,e.AutoLayoutVisualSkittlesRightPadding=30,e.AutoLayoutMaxSpaceHeight=300,e.AutoLayoutMaxSpaceWidth=300,e.ResponsiveLayoutMaxWidthBreakpoint=500,e.ScrollbarOffset=15,e.DisplayAreaHeightAdditionMinimumScale=.9,e.DisplayAreaHeightScaleAddtion=.02,e.ExploreCanvasPadding=8,e.PhoneAuthoringViewportHeight=558,e.PhoneAuthoringViewportWidth=324,e.PhonePortraitRowCount=20,e.PhonePortraitCanvasHeight=1200})(t=e.ExploreCanvasConstants||(e.ExploreCanvasConstants={}))})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.ExploreUIShellModule={name:"powerbi.exploreUIShell",dependency:{javascript:"ExploreUIShell/module",css:["exploreUIShell"]}},e.ExploreUIDialogsModule={name:"powerbi.explore.dialogs",dependency:{javascript:"ExploreUIDialogs/module",css:["exploreUIDialogs"]}}})(t=e.modules||(e.modules={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,i=jsCommon.EnumExtensions;!(function(e){e[e.Rectangle=0]="Rectangle",e[e.Oval=1]="Oval",e[e.Line=2]="Line",e[e.Triangle=3]="Triangle",e[e.Arrow=4]="Arrow"})(t=e.Shape||(e.Shape={}));var r;!(function(e){function r(e,t,i,r,o,n){var a=[{text:e.get("ReportAppBar_ViewFitToPage"),description:e.get("ReportAppBar_ViewFitToPageDescription"),action:12,itemClass:"pbi-glyph-fittopage2",type:DropDownMenuItemType.Item,disabled:!1,selected:1===o},{text:e.get("ReportAppBar_ViewFitToWidth"),description:e.get("ReportAppBar_ViewFitToWidthDescription"),action:11,itemClass:"pbi-glyph-fittowidth",type:DropDownMenuItemType.Item,disabled:!1,selected:2===o},{text:e.get("ReportAppBar_ViewActualSize"),description:e.get("ReportAppBar_ViewActualSizeDescription"),action:10,itemClass:"pbi-glyph-actualsize",type:DropDownMenuItemType.Item,disabled:!1,selected:3===o}];return r&&(a.push({action:null,type:DropDownMenuItemType.Separator}),a.push({text:e.get("ReportAppBar_ShowGrid"),description:e.get("ReportAppBar_ShowGridDescription"),action:13,itemClass:"pbi-glyph-showgrid",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:t.getShowGridlines()}),a.push({text:e.get("ReportAppBar_SnapToGrid"),description:e.get("ReportAppBar_SnapToGridDescription"),action:14,itemClass:"pbi-glyph-snaptogrid",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:t.getSnapToGrid()})),(i.featureSwitches.reportBookmarks||i.featureSwitches.canvasItemsPane||n)&&(a.push({action:null,type:DropDownMenuItemType.Separator}),i.featureSwitches.canvasItemsPane&&a.push({text:e.get("ReportAppBar_Selection"),description:e.get("ReportAppBar_Selection"),action:16,itemClass:"pbi-glyph-show",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:!1}),(i.featureSwitches.reportBookmarks||n)&&a.push({text:e.get("ReportAppBar_Bookmarks"),description:e.get("ReportAppBar_Bookmarks"),action:15,itemClass:"pbi-glyph-bookmark",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:!1})),a}function o(e,t){return[{text:e.get("ReportAppBar_EditReportInWebApp"),description:e.get("ReportAppBar_EditReportInWebAppDescription"),action:17,itemClass:"pbi-glyph-powerbi-service",type:DropDownMenuItemType.Item,tooltip:e.get("ReportAppBar_EditReportInWebAppDescription")},{text:e.get("ReportAppBar_EditReportInDesktop"),description:e.get("ReportAppBar_EditReportInDesktopDescription"),action:18,itemClass:"pbi-glyph-powerbi",type:DropDownMenuItemType.Item,disabled:!t,tooltip:t?e.get("ReportAppBar_EditReportInDesktopDescription"):e.get("ReportAppBar_DisabledEditReportInDesktopTooltip")}]}function n(e){var t=e.localizationService;return[{text:t.get("ReportAppBar_SaveToDashboard"),description:t.get("ReportAppBar_SaveToDashboardDescription"),action:0,itemClass:"pbi-glyph-save",show:e.showSave,tooltip:t.get("ReportAppBar_SaveToDashboardDescription")},{text:t.get("ReportAppBar_SaveAs"),description:t.get("ReportAppBar_SaveAsDescription"),action:1,itemClass:"pbi-glyph-saveas",show:e.showSaveAs,tooltip:t.get("ReportAppBar_SaveAsDescription")},{text:t.get("ReportAppBar_Print"),description:t.get("ReportAppBar_PrintDescription"),action:5,itemClass:"pbi-glyph-print",show:e.showPrint,tooltip:t.get("ReportAppBar_PrintDescription")},{text:t.get("ReportAppBar_SnapshotEmbed"),description:t.get("ReportAppBar_SnapshotEmbedDescription"),action:2,itemClass:"pbi-glyph-publishtoweb",show:e.showEmbed,tooltip:t.get("ReportAppBar_SnapshotEmbedDescription")},{text:t.get("ReportAppBar_SharePointEmbed"),description:t.get("ReportAppBar_SharePointEmbedDescription"),action:3,itemClass:"pbi-glyph-sharepoint",show:e.showSharepointEmbed},{text:t.get("ReportAppBar_Diagnostics"),description:t.get("ReportAppBar_DiagnosticsDescription"),action:6,itemClass:"pbi-glyph-code",show:e.showDiagnostics,tooltip:t.get("ReportAppBar_DiagnosticsDescription")},{text:t.get("ReportAppBar_PowerPoint"),description:t.get("ReportAppBar_PowerPointDescription"),action:7,itemClass:"pbi-glyph-powerpoint",show:e.showPowerPoint,tooltip:t.get("ReportAppBar_PowerPointDescription")},{text:t.get("ReportAppBar_DownloadReport"),description:t.get("ReportAppBar_DownloadReportDescription"),action:8,itemClass:"pbi-glyph-download2",show:e.showDownloadReport,disabled:!e.canDownloadReport,tooltip:e.canDownloadReport?t.get("ReportAppBar_DownloadReportDescription"):t.get("ReportAppBar_DisabledDownloadReportTooltip")}]}function a(e){return[{text:e.get("VisualContainer_SeeData_Enable"),action:19,itemClass:"pbi-glyph-seedata",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDownLevel"),description:e.get("DrillDownLevel_ToolTip"),action:20,itemClass:"pbi-glyph-expand",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDownLevelGrouped"),description:e.get("DrillDownLevelGrouped_ToolTip"),action:21,itemClass:"pbi-glyph-inline-drill",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillUp"),description:e.get("DrillUp_ToolTip"),action:22,itemClass:"pbi-glyph-drillup",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDown"),description:e.get("DrillDown_ToolTip"),action:23,itemClass:"pbi-glyph-drilldowndisabled",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("Drillthrough"),description:e.get("Drillthrough_ToolTip"),action:24,itemClass:"pbi-glyph-drillthrough",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillToDetails"),description:e.get("DrillToDetails_ToolTip"),action:25,itemClass:"pbi-glyph-drilltodetail",type:DropDownMenuItemType.Item,disabled:!0,selected:!1}]}function s(e){return[l(e.get("ReportAppBar_ShapeRectangle"),e.get("ReportAppBar_ShapeRectangleDescription"),"shapeRectangle",t.Rectangle),l(e.get("ReportAppBar_ShapeOval"),e.get("ReportAppBar_ShapeOvalDescription"),"shapeOval",t.Oval),l(e.get("ReportAppBar_ShapeLine"),e.get("ReportAppBar_ShapeLineDescription"),"shapeLine",t.Line),l(e.get("ReportAppBar_ShapeTriangle"),e.get("ReportAppBar_ShapeTriangleDescription"),"shapeTriangle",t.Triangle),l(e.get("ReportAppBar_ShapeArrow"),e.get("ReportAppBar_ShapeArrowDescription"),"shapeArrow",t.Arrow)]}function l(e,r,o,n){return{text:e,description:r,action:26,itemClass:"displayOption "+o,type:DropDownMenuItemType.Item,param:i.toString(t,n).toLowerCase()}}function c(e){return[{text:e.get("ReportAppBar_Left"),description:e.get("Align_Left"),action:27,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Center"),description:e.get("Align_Center"),action:28,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Right"),description:e.get("Align_Right"),action:29,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Top"),description:e.get("Align_Top"),action:30,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Middle"),description:e.get("Align_Middle"),action:31,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Bottom"),description:e.get("Align_Bottom"),action:32,itemClass:"alignAction",type:DropDownMenuItemType.Item}]}function u(e){return[{text:e.get("ReportAppBar_Horizontal"),description:e.get("ReportAppBar_HorizontalDescription"),action:33,itemClass:"distributeAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Vertical"),description:e.get("ReportAppBar_VerticalDescription"),action:34,itemClass:"distributeAction",type:DropDownMenuItemType.Item}]}function p(e,t,i,r,o){var n=[];return o&&n.push({text:e.get("Report_GenerateQRCode"),action:37,type:DropDownMenuItemType.Item}),t.isAnalyzeInExcelSupported(i,r)&&n.push({text:e.get("ReportAppBar_AnalyzeInExcelMenuItem_Text"),action:35,type:DropDownMenuItemType.Item}),i.featureSwitches.staticExportReportEnabled&&n.push({text:e.get("ReportAppBar_ExportAsImage"),action:36,type:DropDownMenuItemType.Item}),n}e.createViewMenuActions=r,e.createEditReportMenuActions=o,e.createFileMenuActions=n,e.createExploreMenuActions=a,e.createShapeMenuActions=s,e.createAlignmentMenuActions=c,e.createDistributeMenuActions=u,e.createReportMoreOptionsMenuItems=p})(r=e.ExplorationAppBarViewModelFactory||(e.ExplorationAppBarViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t="accessibility-info-collapsed",i=".accessibility-info",r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["$element","localizationService"]}},e.prototype.$onInit=function(){var e=this;this.container=this.services.$element.find(i),this.container.on("focusin",(function(){e.show()})),this.container.on("focusout",(function(){e.hide()}))},e.prototype.skipToContent=function(){this.hide(),this.onClose&&this.onClose()},e.prototype.hide=function(){this.container.addClass(t)},e.prototype.show=function(){this.container.removeClass(t)},e})();e.AccessibilityInfoController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.AccessibilityInfo={templateUrl:"components/accessibilityInfo/accessibilityInfo.html",bindings:{onClose:"<"},controller:e.common.createController(t.controllers.AccessibilityInfoController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("ExploreUI/components/boxGrid/boxGridController",(function(e){var t=.5,i=-1;return (function(){function e(e,t){this.scope=e}return e.prototype.getRows=function(){var e=this.viewModel&&this.viewModel.rowCount;if(e)return this.rows&&this.rows.length===e||(this.rows=_.range(e)),this.rows},e.prototype.getColumns=function(){var e=this.viewModel&&this.viewModel.columnCount;if(e)return this.columns&&this.columns.length===e||(this.columns=_.range(e)),this.columns},e.getSvgSize=function(e,t){return e&&t?2*e.margin+t*(e.size+e.gutter)-e.gutter:0},e.getBoxLocation=function(e,i){return e?e.margin+i*(e.size+e.gutter)+t:0},e.getBoxSize=function(e){return e?e.size+i:0},e.prototype.getSvgWidth=function(){return this.viewModel?e.getSvgSize(this.viewModel.layout&&this.viewModel.layout.horizontal,this.viewModel.columnCount):0},e.prototype.getSvgHeight=function(){return this.viewModel?e.getSvgSize(this.viewModel.layout&&this.viewModel.layout.vertical,this.viewModel.rowCount):0},e.prototype.getBoxX=function(t){return this.viewModel?e.getBoxLocation(this.viewModel.layout&&this.viewModel.layout.horizontal,t):0},e.prototype.getBoxWidth=function(){return this.viewModel?e.getBoxSize(this.viewModel.layout&&this.viewModel.layout.horizontal):0},e.prototype.getBoxY=function(t){return this.viewModel?e.getBoxLocation(this.viewModel.layout&&this.viewModel.layout.vertical,t):0},e.prototype.getBoxHeight=function(){return this.viewModel?e.getBoxSize(this.viewModel.layout&&this.viewModel.layout.vertical):0},e})()})),powerbi.define("ExploreUI/components/boxGrid/boxGrid",(function(e){return{templateUrl:"components/boxGrid/boxGrid.html",bindings:{viewModel:"<"},controller:powerbi.common.createController(e("ExploreUI/components/boxGrid/boxGridController"))}}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.util.ConditionalFormattingUtil,r=e.visuals.DataColorPalette,o=e.visuals.GradientUtils,n=(function(){function e(e,t){var r=this;this.defaultGradientSettings=i.getDefaultColorScalesSettings(),this.services=t,this.updateGradientNullColor=function(e){e||(e=r.defaultGradientSettings.nullColor),r.viewModel.gradientSettings.nullColor=e},this.updateGradientMinColor=function(e){e||(e=r.defaultGradientSettings.minColor),r.viewModel.gradientSettings.minColor=e,r.updateGradientBar()},this.updateGradientMaxColor=function(e){e||(e=r.defaultGradientSettings.maxColor),r.viewModel.gradientSettings.maxColor=e,r.updateGradientBar()},this.updateGradientMidColor=function(e){e||(e=r.defaultGradientSettings.midColor),r.viewModel.gradientSettings.midColor=e,r.updateGradientBar()}}return e.prototype.$onInit=function(){this.viewModel.dataColors&&this.services.colorPicker.setDataColors(new r(this.viewModel.dataColors))},e.createOptions=function(){return{additionalServices:["modalDialogService"],scopedDependencies:["colorPicker"]}},e.prototype.selectedOptionsChange=function(e){var t=this.viewModel.gradientSettings,i=e.id;switch(i){case 0:break;case 1:t.minValue=void 0;break;case 3:t.midValue=void 0;break;case 2:t.maxValue=void 0}},e.prototype.updateGradientBar=function(){this.viewModel.gradientBarValue=o.getGradientBarColors(this.viewModel.gradientSettings)},e.prototype.updateDiverging=function(){this.viewModel.gradientSettings.diverging=!this.viewModel.gradientSettings.diverging,this.updateGradientBar()},e.prototype.apply=function(){this.viewModel.gradientSettings.nullStrategy=this.viewModel.nullStrategyOption.stringValue;var e={gradientSettings:this.viewModel.gradientSettings,minimumSelectedId:this.viewModel.minimumSelectedOption&&this.viewModel.minimumSelectedOption.id,centerSelectedId:this.viewModel.centerSelectedOption&&this.viewModel.centerSelectedOption.id,maximumSelectedId:this.viewModel.maximumSelectedOption&&this.viewModel.maximumSelectedOption.id};this.services.modalDialogService.close(e)},e.prototype.cancel=function(){this.services.modalDialogService.close()},e})();t.ConditionalFormattingDialogController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ConditionalFormattingDialog={templateUrl:"components/conditionalFormattingDialog/conditionalFormattingDialog.html",bindings:{viewModel:"<"},controller:e.common.createController(t.controllers.ConditionalFormattingDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=t.util.ConditionalFormattingUtil,n=e.data,a=e.visuals.GradientUtils;!(function(t){function i(e,t,i,o,n,a){var s={viewModel:r(e,t,i,n,a)};return{dialogName:"ConditionalFormattingDialog",definitionTemplateCachePath:"components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",bindings:s,dialogCssClass:"conditionalFormattingDialog"}}function r(e,t,i,r,d){var h=t&&t.config&&t.config.singleVisual&&t.config.singleVisual.objects,v=o.getGradientSettings(h,r)||o.getDefaultColorScalesSettings(),g=a.getGradientBarColors(v),f={dialogTitle:n.getDisplayName(r.propertyDescriptor.displayName,e),dialogDescription:n.getDisplayName(r.propertyDescriptor.description,e),baseExprDisplayName:i,gradientSettings:v,gradientBarValue:g,colorPickerType:{fill:{solid:{color:!0}}},minimumSelectOptions:u(e),centerSelectOptions:c(e),maximumSelectOptions:l(e),nullStrategyOptions:p(e),dataColors:d};return s(f),f}function s(t){switch(void 0!==t.gradientSettings.minValue?t.minimumSelectedOption=t.minimumSelectOptions[1]:t.minimumSelectedOption=t.minimumSelectOptions[0],void 0!==t.gradientSettings.maxValue?t.maximumSelectedOption=t.maximumSelectOptions[1]:t.maximumSelectedOption=t.maximumSelectOptions[0],void 0!==t.gradientSettings.midValue?t.centerSelectedOption=t.centerSelectOptions[1]:t.centerSelectedOption=t.centerSelectOptions[0],t.gradientSettings.nullStrategy){case e.NullStrategy.noColor:t.nullStrategyOption=t.nullStrategyOptions[0];break;case e.NullStrategy.specificColor:t.nullStrategyOption=t.nullStrategyOptions[2];break;default:t.nullStrategyOption=t.nullStrategyOptions[1]}}function l(e){return[{id:2,value:e.get("ConditionalFormattingDialog_HighestValue"),disableInput:!0},d(e)]}function c(e){return[{id:3,value:e.get("ConditionalFormattingDialog_MiddleValue"),disableInput:!0},d(e)]}function u(e){return[{id:1,value:e.get("ConditionalFormattingDialog_LowestValue"),disableInput:!0},d(e)]}function p(t){return[{id:0,value:t.get("ConditionalFormattingDialog_FormatNull_NoFormat"),disableInput:!0,stringValue:e.NullStrategy.noColor},{id:1,value:t.get("ConditionalFormattingDialog_FormatNull_AsZero"),disableInput:!0,stringValue:e.NullStrategy.asZero},{id:2,value:t.get("ConditionalFormattingDialog_FormatNull_SpecificColor"),disableInput:!1,stringValue:e.NullStrategy.specificColor}]}function d(e){return{id:0,value:e.get("ConditionalFormattingDialog_Number"),disableInput:!1}}t.createDialog=i,t.createConditionalFormattingDialogViewModel=r})(r=i.ConditionalFormattingDialogViewModelFactory||(i.ConditionalFormattingDialogViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.viewModels.ConditionalFormattingDialogViewModelFactory,o=t.util.ConditionalFormattingUtil,n=e.data.SQExprBuilder,a=t.util.VisualContainerUtils,s=(function(){function t(e,t,i,r,o,n){this.localizationService=e,this.modalDialogService=t,this.promiseFactory=i,this.telemetryService=r,this.visualAuthoring=o,this.colorPickerService=n}return t.prototype.show=function(t,i,r,o,n){var a=this,s={exprDisplayName:i,expr:r,repetition:n,schema:o,selectName:t.config.singleVisual.query.defn.selectNameOf(r),visual:t},l=this.createDialogDefinition(s),c=this.promiseFactory.defer(),u=this.modalDialogService.showHostModalDialog(l);return c.promise.catch((function(){return u.reject()})),u.then((function(e){e&&a.setConditionalFormatting(s,e),c.resolve(null)})),e.RejectablePromise(c)},t.prototype.createDialogDefinition=function(e){var t={viewModel:r.createConditionalFormattingDialogViewModel(this.localizationService,e.visual,e.exprDisplayName,e.repetition,this.colorPickerService&&this.colorPickerService.getDataColors().getAllColors())};return{dialogName:"ConditionalFormattingDialog",definitionTemplateCachePath:"components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",bindings:t}},t.prototype.setConditionalFormatting=function(t,i){var r=i.gradientSettings,s=t.expr,l=n.selectRef(t.selectName),c=s.getMetadata(t.schema).type,u=o.createFillDefinition(l,r,c);this.visualAuthoring.addColorScales(t.visual,t.repetition,u);var p=0===i.minimumSelectedId||0===i.centerSelectedId||0===i.maximumSelectedId;this.telemetryService.logEvent(e.telemetry.EXSetConditionalFormatting,a.getVisualType(t.visual),r.diverging,p)},t})();i.ConditionalFormattingDialogBuilder=s})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.DataBarsUtil,o=e.visuals.DataColorPalette,n=(function(){function e(e,t){var i=this;this.services=t,this.updatePositiveColor=function(e){e||(e=r.DefaultDataBarsSettings.positiveColor.solid.color),i.viewModel.positiveColor.solid.color=e},this.updateNegativeColor=function(e){e||(e=r.DefaultDataBarsSettings.negativeColor.solid.color),i.viewModel.negativeColor.solid.color=e},this.updateAxisColor=function(e){e||(e=r.DefaultDataBarsSettings.axisColor.solid.color),i.viewModel.axisColor.solid.color=e}}return e.prototype.$onInit=function(){this.viewModel.dataColors&&this.services.colorPicker.setDataColors(new o(this.viewModel.dataColors))},e.createOptions=function(){return{additionalServices:["modalDialogService"],scopedDependencies:["colorPicker"]}},e.prototype.getDataBarsSettings=function(){return{axisColor:this.viewModel.axisColor,hideText:this.viewModel.hideText,maxValue:0===this.viewModel.maximumSelectedOption.id?this.viewModel.maxValue:void 0,minValue:0===this.viewModel.minimumSelectedOption.id?this.viewModel.minValue:void 0,positiveColor:this.viewModel.positiveColor,negativeColor:this.viewModel.negativeColor,reverseDirection:1===this.viewModel.barDirectionOption.id}},e.prototype.apply=function(){var e={dataBars:this.getDataBarsSettings()};this.services.modalDialogService.close(e)},e.prototype.cancel=function(){this.services.modalDialogService.close()},e})();i.DataBarsDialogController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DatabarsDialog={templateUrl:"components/dataBarsDialog/dataBarsDialog.html",bindings:{viewModel:"<"},controller:e.common.createController(t.controllers.DataBarsDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i,r=e.util.DataBarsUtil;!(function(e){function t(e,t,s,c,u){var p=r.getDataBarsSettings(t.config.singleVisual,c),d={fieldDisplayName:s,colorPickerType:{fill:{solid:{color:!0}}},minimumSelectOptions:a(e),maximumSelectOptions:n(e),barDirectionOptions:l(e),axisColor:p.axisColor,hideText:p.hideText,maxValue:p.maxValue,minValue:p.minValue,positiveColor:p.positiveColor,negativeColor:p.negativeColor,reverseDirection:p.reverseDirection,dataColors:u};return i(p,d),o(p,d),d}function i(e,t){void 0!==e.minValue?t.minimumSelectedOption=t.minimumSelectOptions[1]:t.minimumSelectedOption=t.minimumSelectOptions[0],void 0!==e.maxValue?t.maximumSelectedOption=t.maximumSelectOptions[1]:t.maximumSelectedOption=t.maximumSelectOptions[0]}function o(e,t){e.reverseDirection?t.barDirectionOption=t.barDirectionOptions[1]:t.barDirectionOption=t.barDirectionOptions[0]}function n(e){return[{id:2,value:e.get("ConditionalFormattingDialog_HighestValue"),disableInput:!0},s(e)]}function a(e){return[{id:1,value:e.get("ConditionalFormattingDialog_LowestValue"),disableInput:!0},s(e)]}function s(e){return{id:0,value:e.get("ConditionalFormattingDialog_Number"),disableInput:!1}}function l(e){return[{id:0,value:e.get("DataBarsDialog_BarDirection_LeftToRight")},{id:1,value:e.get("DataBarsDialog_BarDirection_RightToLeft")}]}e.createDataBarsDialogViewModel=t})(i=t.DataBarsDialogViewModelFactory||(t.DataBarsDialogViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.viewModels.DataBarsDialogViewModelFactory,o=t.util.DataBarsUtil,n=t.util.VisualContainerUtils,a=(function(){function t(e,t,i,r,o,n){this.localizationService=e,this.modalDialogService=t,this.promiseFactory=i,this.telemetryService=r,this.visualAuthoring=o,this.colorPickerService=n}return t.prototype.show=function(t,i,r,o,n,a){var s=this,l={fieldDisplayName:i,fieldExpr:r,repetition:n,schema:o,visual:t,fromPropertyPane:a},c=this.createDialogDefinition(l),u=this.promiseFactory.defer(),p=this.modalDialogService.showHostModalDialog(c);return u.promise.catch((function(){return p.reject()})),p.then((function(e){e&&s.setDataBars(l,e),u.resolve(null)})),e.RejectablePromise(u)},t.prototype.createDialogDefinition=function(e){var t={viewModel:r.createDataBarsDialogViewModel(this.localizationService,e.visual,e.fieldDisplayName,e.repetition,this.colorPickerService&&this.colorPickerService.getDataColors().getAllColors())};return{dialogName:"DataBarsDialog",definitionTemplateCachePath:"components/dataBarsDialog/dataBarsDialogDefinition.html",bindings:t}},t.prototype.setDataBars=function(t,i){var r=t.fieldExpr.getMetadata(t.schema).type,a=o.createDataBarsDefinition(i.dataBars,r);this.visualAuthoring.addDataBars(t.visual,t.repetition,a),this.telemetryService.logEvent(e.telemetry.EXSetDataBars,n.getVisualType(t.visual),void 0!==i.dataBars.minValue||void 0!==i.dataBars.maxValue,t.fromPropertyPane)},t})();i.DataBarsDialogBuilder=a})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.moduleConfig={name:"ui.bootstrap",dependency:{javascript:"angular-ui-datetimepicker"}},this.services=t}return e.createOptions=function(){return{additionalServices:["overlayService"]}},e.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){if(_.isNumber(e.ngModel.$viewValue)){var t=new Date(e.ngModel.$viewValue);"Invalid Date"!==t.toString()?e.ngModel.$setViewValue(t):e.ngModel.$setViewValue(void 0)}else void 0===e.ngModel.$viewValue?(e.textVal=void 0,e.dateVal=void 0,e.inputInvalid=!1):e.inputInvalid||(e.dateVal=e.ngModel.$viewValue,e.textVal=e.ngModel.$viewValue.toLocaleDateString()+" "+e.ngModel.$viewValue.toLocaleTimeString())}},e.prototype.$onChanges=function(e){e&&e.validators&&void 0!==this.textVal&&this.validateTextInput()},e.prototype.dateSelected=function(){this.inputInvalid=!1,this.textVal=this.dateVal.toLocaleDateString()+" "+this.dateVal.toLocaleTimeString(),this.ngModel.$setViewValue(this.dateVal),this.services.overlayService.hideAllDropdowns()},e.prototype.dateTextUpdated=function(){this.validateTextInput(),this.inputInvalid||this.ngModel.$setViewValue(this.dateVal)},e.prototype.validateTextInput=function(){if(this.textVal){var e=new Date(this.textVal);this.inputInvalid="Invalid Date"===e.toString()||e<this.validators.min||e>this.validators.max,this.inputInvalid||(this.dateVal=e)}else this.textVal=void 0,this.dateVal=void 0,this.inputInvalid=!1},e})();e.DateTimePickerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DateTimePicker={templateUrl:"components/dateTimePicker/dateTimePicker.html",bindings:{placeholder:"<",validators:"<"},require:{ngModel:"ngModel"},controller:e.common.createController(t.controllers.DateTimePickerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.DotGrid={templateUrl:"components/dotGrid/dotGrid.html",bindings:{viewModel:"<"},controller:["$scope","$element",function(t,i){return new e.DotGridController(t,i)}]};var t;!(function(e){function t(e,t){return e===t||e&&t&&e.UnitLength===t.UnitLength&&e.UnitDivisions===t.UnitDivisions}function i(t,i){var r=$("<canvas></canvas>").attr({width:t.UnitLength,height:i.UnitLength}).get(0),o=r.getContext("2d");o.fillStyle=e.dotColor;for(var n=0;n<t.UnitDivisions;++n){var a=Math.round(n*t.UnitLength/t.UnitDivisions);o.fillRect(a,0,1,1)}for(var n=1;n<i.UnitDivisions;++n){var s=Math.round(n*i.UnitLength/i.UnitDivisions);o.fillRect(0,s,1,1)}return r}function r(t,i){var r=t/(i/e.CanvasLayout.UnitLength);r=Math.floor(r);var o=_.find(a,(function(t){return 1===t||r/t>=e.MinimumUnitDivisionLength}));return{UnitLength:r,UnitDivisions:o}}function o(e,t){return{x:n(e.x,t.width),y:n(e.y,t.height)}}function n(t,i){var r=e.getLayoutForScreen(t*i,i),o=r.UnitLength/e.CanvasLayout.UnitLength,n=e.getLayoutForScreen(o*i,i),a=n.UnitLength/e.CanvasLayout.UnitLength;return a}e.sameLayout=t,e.dotColor="#333",e.drawGridUnit=i,e.CanvasLayout={UnitLength:96,UnitDivisions:12};var a=[12,6,4,3,2,1];e.MinimumUnitDivisionLength=8,e.getLayoutForScreen=r,e.adjustScaleForGrid=o})(t=e.DotGridComponent||(e.DotGridComponent={}))})(t=e.components||(e.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.components.DotGridComponent,r=(function(){function e(e,t){this.background=t.find(".background")}return e.prototype.$onInit=function(){this.viewModel&&this.onViewModelChange()},e.prototype.$onChanges=function(e){e.viewModel&&this.onViewModelChange()},e.prototype.onViewModelChange=function(){var e=i.drawGridUnit(this.viewModel.layoutX,this.viewModel.layoutY),t=e.toDataURL("image/png");this.background.css("background-image","url("+t+")")},e})();t.DotGridController=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){
var t;!(function(t){var i=e.services.events,r=(function(){function t(t,r){var o=this;this.services=r,this.services.eventBridge.createChannelSubscriptionManager().subscribe(i.renameSection,(function(e,t){return o.renameSection(t)})),this.exploreUIShellConfig=e.modules.ExploreUIShellModule}return t.createOptions=function(){return{additionalServices:["lazySync"],scopedDependencies:["eventBridge","formFactor","undoRedo","viewModeState"]}},t.prototype.isBookmarkView=function(){return this.services.viewModeState.getViewState().bookmarkView},t.prototype.createSection=function(){this.services.eventBridge.publishToChannel(i.createSection)},t.prototype.isEditMode=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canAddRemoveSections()},t.prototype.getModeString=function(){return this.isEditMode()?"editing":0===this.services.viewModeState.getMode()?"reading":void 0},t.prototype.renameSection=function(t){var r=this,o=this.viewModel.exploration.contract;this.services.undoRedo.register("RenameNavigationTab",(function(){var n=o.sections[t.sectionIndex].name;e.SectionUtils.renameSection(r.viewModel,t.sectionNewName,t.sectionIndex),e.PodUtils.updateLinguisticPrimaryName(o,n,t.sectionNewName,r.services.lazySync("linguisticSchemaProxy")).then((function(){var e={sectionName:t.sectionNewName,sectionIndex:t.sectionIndex};r.services.eventBridge.publishToChannel(i.sectionNameChanged,e)}))}))},t})();t.ExplorationFooterController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.ExplorationFooter={templateUrl:"components/explorationFooter/explorationFooter.html",bindings:{viewModel:"<"},controller:e.common.createController(e.explore.controllers.ExplorationFooterController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.services.events,r=e.common.dialog.MessageDialogBuilder,o=(function(){function e(e,t){this.services=t,this.messageDialogBuilder=new r(t.modalDialogService)}return e.createOptions=function(){return{additionalServices:["modalDialogService","localizationService"],scopedDependencies:["eventBridge","explorationNavigation","formFactor","layoutAuthoring"]}},e.prototype.$onInit=function(){var e=this;this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.viewport={width:106,height:106},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(i.canvasChanged,(function(){return e.updateVisuals()})).subscribe(i.formFactorChanged,(function(){return e.updateVisuals()})),this.updateVisuals()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.clearAllVisualsFromCanvasPressed=function(){var e=this;return this.messageDialogBuilder.show("ClearAllVisualsConfirmDialog",{titleText:this.services.localizationService.get("RemoveAllVisuals_Title"),messageText:this.services.localizationService.get("RemoveAllVisuals_MessageContent"),okButtonText:this.services.localizationService.get("RemoveAllVisuals_OKText"),cancelButtonText:this.services.localizationService.get("RemoveAllVisuals_CancelText")}).then((function(t){if(0===t){var i=e.services.explorationNavigation.getCurrentSection(),r=e.services.explorationNavigation.getCurrentExploration();e.services.layoutAuthoring.removeLayoutFromSection(i,1,r)}}))},e.prototype.updateVisuals=function(){var e=this.services.explorationNavigation.getCurrentSection(),t=this.services.formFactor.getCurrentLayout();this.visuals=e.visualContainers.filter((function(e){return!e.layouts.withId(t)}))},e})();t.MobileVisualizationPaneController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.MobileVisualizationPane={templateUrl:"components/mobileVisualizationPane/mobileVisualizationPane.html",bindings:{},controller:e.common.createController(t.controllers.MobileVisualizationPaneController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=jsCommon.EnumExtensions,r=e.explore.services.events,o=(function(){function e(e,t){var i=this;this.isExpanded=!1,this.services=t,this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})),this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1}}return e.createOptions=function(){return{scopedDependencies:["includeExcludeService","eventBridge","visualAuthoring"]}},e.prototype.$onInit=function(){this.updateViewModel()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.expand=function(){this.isExpanded=!this.isExpanded},e.prototype.deleteFilter=function(e){var t=this.filterViewModel.getFilterContainerScope();this.services.visualAuthoring.removeFilter(this.filterViewModel.contract,t),e.stopPropagation()},e.prototype.delete=function(e,t,i){return 1===this.viewModel.points.length?void this.deleteFilter(e):(this.viewModel.points.splice(i,1),this.services.includeExcludeService.updateFilterContainer(this.filterViewModel,this.viewModel),void e.stopPropagation())},e.prototype.updateViewModel=function(){var e=this.filterViewModel.contract;this.viewModel=this.services.includeExcludeService.buildViewModel(e.filter,e.type)},e.prototype.onFilterContainerChanged=function(e){e.filter===this.filterViewModel.contract&&i.hasFlag(e.changeType,2)&&this.updateViewModel()},e})();t.IncludeExcludeFilterController=o})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.IncludeExcludeFilter={templateUrl:"components/includeExcludeFilter/includeExcludeFilter.html",controller:e.common.createController(t.IncludeExcludeFilterController),bindings:{filterViewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.annotations=e}return e.prototype.clear=function(){this.annotations=[]},e.prototype.length=function(){return this.annotations.length},e.prototype.removeAt=function(e){this.annotations.splice(e,1)},e.prototype.getAnnotation=function(e){return this.annotations[e]},e.prototype.takeAll=function(){return _.take(this.annotations,this.annotations.length)},e.prototype.push=function(e){this.annotations.push(e)},e.prototype.eraseAnnotations=function(e,t){var i=this.annotations.length;return _.remove(this.annotations,(function(i){return i.polygon.lineIntersectionPoint(e,t)})),i-this.annotations.length},e})();e.AnnotationsList=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.viewModels.AnnotationsList,r=e.explore.services.events,o=e.visuals.shapes.Polygon,n="pen",a=5,s=10,l=(function(){function e(e,t){var i=this;this.services=t,this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionChanged,(function(){return i.invalidateAnnotations()})).subscribe(r.clearAnnotations,(function(){return i.clearAnnotations()})),this.pensAnnotationsDataHelper=new c,this.penAnnotationDrawer=new u(this.services.$element);var o=function(e){i.onPointerDown(e)},n=function(e){i.onPointerMove(e)},a=function(e){i.onPointerUp(e)};interact.on("pointerdown",o),interact.on("pointermove",n),interact.on("pointerup",a),e.$on("$destroy",(function(){interact.off("pointerdown",o),interact.off("pointermove",n),interact.off("pointerup",a),i.clearAnnotationsFromExploration()})),this.resetViewModel()}return e.createOptions=function(){return{scopedDependencies:["eventBridge","explorationNavigation","layoutAuthoring","viewModeState"],additionalServices:["$element"]}},e.prototype.eraseAnnotations=function(e,t){this.viewModel.annotationsList.eraseAnnotations(t,e)>0&&(this.penAnnotationDrawer.redrawAnnotations(this.viewModel),this.persistOnSection(this.viewModel.annotationsList.takeAll()))},e.prototype.onPointerDown=function(e){if(e.pointerType===n){this.penAnnotationDrawer.validateRectPos(this.viewModel.annotationsList.length());var t=this.penAnnotationDrawer.convertToCanvasPosition(e.pageX,e.pageY),i=this.isEraseEvent(e)?2:1;switch(this.pensAnnotationsDataHelper.createPenAnnotationData(e.pointerId,i),i){case 1:this.pensAnnotationsDataHelper.addPoint(e.pointerId,t),this.viewModel.currentAnnotations[e.pointerId]=this.createPenAnnotationCurve(e.pointerId);break;case 2:this.erasePrevPoint=t,this.eraseAnnotations(t,this.erasePrevPoint)}}},e.prototype.onPointerMove=function(e){if(e.pointerType===n){var t=this.penAnnotationDrawer.convertToCanvasPosition(e.pageX,e.pageY),i=this.pensAnnotationsDataHelper.getAnnotationMode(e.pointerId);switch(i){case 1:this.pensAnnotationsDataHelper.addPoint(e.pointerId,t);var r=this.viewModel.currentAnnotations[e.pointerId];r&&(r.polygon=this.createPolygon(e.pointerId)),this.drawAnnotationAddedPoints(r);break;case 2:this.eraseAnnotations(t,this.erasePrevPoint),this.erasePrevPoint=t}}},e.prototype.onPointerUp=function(e){if(e.pointerType===n){var t=this.pensAnnotationsDataHelper.getAnnotationMode(e.pointerId);switch(t){case 1:var i=this.viewModel.currentAnnotations[e.pointerId];i&&(i.polygon.polygonPoints.length>=s&&(this.viewModel.annotationsList.push(i),this.persistOnSection(this.viewModel.annotationsList.takeAll())),delete this.viewModel.currentAnnotations[e.pointerId])}this.pensAnnotationsDataHelper.remove(e.pointerId)}},e.prototype.drawAnnotationAddedPoints=function(e){var t=e.polygon.polygonPoints,i=t.length;i<s||(i===s?this.penAnnotationDrawer.drawAnnotation(e):this.penAnnotationDrawer.drawLine(t[i-2],t[i-1]))},e.prototype.resetViewModel=function(e){void 0===e&&(e=[]),this.viewModel={currentAnnotations:[],annotationsList:new i(e)},this.pensAnnotationsDataHelper.clear()},e.prototype.clearAnnotationsFromExploration=function(){for(var e=this.services.explorationNavigation.getCurrentExploration(),t=0,i=e.sections;t<i.length;t++){var r=i[t];this.services.layoutAuthoring.updateSectionPenAnnotations(r,[])}},e.prototype.isEraseEvent=function(e){return e.button===a||!e.isPrimary&&0===e.pressure},e.prototype.persistOnSection=function(e){var t=this.services.explorationNavigation.getCurrentSection();this.services.layoutAuthoring.updateSectionPenAnnotations(t,e)},e.prototype.getAnnotationsFromSection=function(){var e=this.services.explorationNavigation.getCurrentSection();return e.penAnnotations||[]},e.prototype.clearAnnotations=function(){this.persistOnSection([]),this.invalidateAnnotations()},e.prototype.invalidateAnnotations=function(){var e=this.getAnnotationsFromSection();this.resetViewModel(e),this.penAnnotationDrawer.redrawAnnotations(this.viewModel)},e.prototype.createPenAnnotationCurve=function(e){var t=this.services.viewModeState.getConfig();return{polygon:this.createPolygon(e),lineWidth:t.penProperties.lineWidth,strokeStyle:t.penProperties.strokeStyle,opacity:t.penProperties.opacity}},e.prototype.createPolygon=function(e){for(var t=[],i=0,r=this.pensAnnotationsDataHelper.getPoints(e);i<r.length;i++){var n=r[i];t.push(n.x),t.push(n.y)}return new o(new Float64Array(t))},e})();t.PenAnnotationController=l;var c=(function(){function e(){this.pensAnnotationsData=[]}return e.prototype.getAnnotationMode=function(e){return this.pensAnnotationsData[e]?this.pensAnnotationsData[e].penAnnotationMode:0},e.prototype.createPenAnnotationData=function(e,t){this.pensAnnotationsData[e]={pointerId:e,penAnnotationMode:t,points:[]}},e.prototype.addPoint=function(e,t){this.pensAnnotationsData[e]&&this.pensAnnotationsData[e].points.push(t)},e.prototype.remove=function(e){delete this.pensAnnotationsData[e]},e.prototype.getPoints=function(e){return this.pensAnnotationsData[e]?this.pensAnnotationsData[e].points:[]},e.prototype.clear=function(){this.pensAnnotationsData=[]},e})(),u=(function(){function e(e){this.rect=e.children(0)[0],this.rectContext=this.rect.getContext("2d")}return e.prototype.validateRectPos=function(e){this.loadCanvasClientRects(),0!==e||this.rect.width===Math.floor(this.rectPosition.width)&&this.rect.height===Math.floor(this.rectPosition.height)||(this.rect.width=this.rectPosition.width,this.rect.height=this.rectPosition.height)},e.prototype.drawLine=function(e,t){this.rectContext.moveTo(e.x,e.y),this.rectContext.lineTo(t.x,t.y),this.rectContext.stroke()},e.prototype.loadCanvasClientRects=function(){this.rectPosition=this.rect.getBoundingClientRect(),this.canvasLeft=this.rectPosition.left,this.canvasTop=this.rectPosition.top},e.prototype.redrawAnnotations=function(e){this.loadCanvasClientRects(),this.rectContext.clearRect(0,0,this.rectPosition.width,this.rectPosition.height);for(var t=0,i=this.getAnnotations(e);t<i.length;t++){var r=i[t];this.drawAnnotation(r)}},e.prototype.getAnnotations=function(e){var t=e.annotationsList.takeAll(),i=[];for(var r in e.currentAnnotations)i.push(e.currentAnnotations[r]);return t.concat(i)},e.prototype.drawAnnotation=function(e){this.rectContext.beginPath(),this.setupNewPath(e);var t=e.polygon.polygonPoints;this.rectContext.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;i++)this.rectContext.lineTo(t[i].x,t[i].y);this.rectContext.stroke()},e.prototype.setupNewPath=function(e){this.rectContext.lineWidth=e.lineWidth,this.rectContext.strokeStyle=e.strokeStyle,this.rectContext.globalAlpha=e.opacity,this.rectContext.lineCap="round",this.rectContext.lineJoin="round"},e.prototype.convertToCanvasPosition=function(e,t){return{x:e-this.canvasLeft,y:t-this.canvasTop}},e})()})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PenAnnotation={templateUrl:"components/penAnnotation/penAnnotation.html",controller:e.common.createController(t.controllers.PenAnnotationController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Background="background",e.Border="border",e.CategoryAxis="categoryAxis",e.ConditionalFormatting="conditionalFormatting",e.General="general",e.Gradient="gradient",e.Labels="labels",e.LockAspect="lockAspect",e.StylePreset="stylePresetName",e.Title="title",e.VisualLink="visualLink",e.ValueAxis="valueAxis"})(t=e.PropertyCardNames||(e.PropertyCardNames={}));var i;!(function(e){e.Position="position",e.RevertToDefault="revertToDefault",e.SecPosition="secPosition",e.Slider="slider",e.Show="show",e.StylePresetName="name",e.TextArea="textarea"})(i=e.PropertySliceNames||(e.PropertySliceNames={}));var r;!(function(e){e.X="x",e.Y="y",e.Width="width",e.Height="height",e.AltText="altText",e.AllowBinnedLineSample="allowBinnedLineSample",e.AllowOverlappingPointsSample="allowOverlappingPointsSample"})(r=e.GeneralPropertyNames||(e.GeneralPropertyNames={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.contracts.FilterType,o=e.data.RelativeDateFilterPattern,n=(function(){function i(t,i){var r=this;this.scope=t,this.services=i,this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.filterContainerChanged,(function(e,t){return r.onFilterContainerChanged(t)}))}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","undoRedo","visualAuthoring","visualPlugin"]}},i.prototype.$onInit=function(){this.initializeViewModel(this.viewModel.contract)},i.prototype.initializeViewModel=function(e){var i=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var n=o.extractParametersFromSemanticFilter(e.filter),a=e.expression||n&&n.field,s=n&&n.options;i.vm=new t.viewModels.RelativeDateFilterViewModel(a,i.services.localizationService,s),i.viewModel.updateFilterProperties(r,i.services.visualPlugin,i.services.aggrOps),i.viewModel.updateViewState(),n?i.updateRestatement():(i.filterForm.$setDirty(),e.filter||i.clearRestatement())}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.applyFilter=function(){var e=this;if(this.canApplyFilter()){this.viewModel.contract.type=r.RelativeDate;var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){e.services.undoRedo.register("ApplyRelativeDateFilter",(function(){var i=e.vm.getRelativeDateRangeOptions();e.logFilterAppliedTelemetry(i,(function(){var r=o.buildSemanticFilter({field:e.vm.dateField,options:i});e.services.visualAuthoring.updateFilter(e.viewModel.getFilterContainerScope().container,e.viewModel.contract,r),e.viewModel.useDefaultFilter=!1,e.filterForm.$setPristine(),e.updateRestatement(),e.services.eventBridge.publishBubbling(e.scope,t.viewModels.FilterEvents.filterChanged,{filter:e.viewModel.contract,changeType:2,scope:e.viewModel.getFilterContainerScope()})}))}))}))}},i.prototype.canApplyFilter=function(){return this.viewModel&&!this.viewModel.cardType.invalid&&this.vm&&this.vm.relativeUnit&&this.vm.relativeQualifier&&(this.vm.duration>0||this.vm.relativeQualifier.value===e.data.RelativeDateQualifier.Current)&&this.filterForm&&this.filterForm.$dirty&&this.filterForm.$valid},i.prototype.logFilterAppliedTelemetry=function(t,i){var r=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneRelativeDateFilterApplied,t.relativeQualifier,t.duration,t.relativeUnit,t.includeToday,o.isCalendarPeriod(t.relativeUnit));try{i(),r.resolve()}catch(e){throw r.reject(),e}},i.prototype.onFilterContainerChanged=function(e){e.filter===this.viewModel.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,10)&&this.initializeViewModel(e.filter)},i.prototype.updateRestatement=function(){this.viewModel.setRestatement(this.vm.getRestatement())},i.prototype.clearRestatement=function(){this.viewModel.setRestatement(void 0)},i})();i.RelativeDateFilterController=n})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.RelativeDateFilter={templateUrl:"components/relativeDateFilter/relativeDateFilter.html",controller:e.common.createController(t.RelativeDateFilterController),bindings:{viewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.data.RelativeDateFilterPattern,r=e.data.RelativeDateRangeHelper,o=e.data.RelativeDateQualifier,n=e.data.RelativeDateUnit,a={relativeQualifier:o.Last,duration:30,relativeUnit:n.Day,includeToday:!0},s=(function(){function e(e,t,i){void 0===i&&(i=a),this.dateField=e,this.duration=i.duration,this.includeToday=i.includeToday,this.populateRelativeQualifiers(t,i.relativeQualifier),this.populateRelativeUnits(t,i.relativeUnit)}return e.prototype.populateRelativeQualifiers=function(e,t){this.relativeQualifiers=[{value:o.Last,text:e.get("RelativeDateQualifier_Last")},{value:o.Current,text:e.get("RelativeDateQualifier_Current")},{value:o.Next,text:e.get("RelativeDateQualifier_Next")}],this.relativeQualifier=_.find(this.relativeQualifiers,(function(e){return e.value===t}))},e.prototype.populateRelativeUnits=function(e,t){this.relativeUnitsAll=[{value:n.Day,text:e.get("RelativeDateUnit_Days")},{value:n.Week,text:e.get("RelativeDateUnit_Weeks")},{value:n.CalendarWeek,text:e.get("RelativeDateUnit_CalendarWeeks")},{value:n.Month,text:e.get("RelativeDateUnit_Months")},{value:n.CalendarMonth,text:e.get("RelativeDateUnit_CalendarMonths")},{value:n.Year,text:e.get("RelativeDateUnit_Years")},{value:n.CalendarYear,text:e.get("RelativeDateUnit_CalendarYears")}],this.relativeUnitsCurrent=[{value:n.Day,text:e.get("RelativeDateUnit_Day")},{value:n.Week,text:e.get("RelativeDateUnit_Week")},{value:n.Month,text:e.get("RelativeDateUnit_Month")},{value:n.Year,text:e.get("RelativeDateUnit_Year")}],this.relativeUnit=_.find(this.relativeUnitsAll,(function(e){return e.value===t}))},e.prototype.isDurationApplicable=function(){return this.relativeQualifier.value!==o.Current},e.prototype.isIncludeTodayApplicable=function(){return this.relativeQualifier.value!==o.Current&&!i.isCalendarPeriod(this.relativeUnit.value)},e.prototype.onRelativeQualifierChanged=function(){if(this.relativeQualifier.value===o.Current){var e=this.relativeUnit.value;switch(this.relativeUnit.value){case n.CalendarWeek:e=n.Week;break;case n.CalendarMonth:e=n.Month;break;case n.CalendarYear:e=n.Year}this.relativeUnit=_.find(this.relativeUnitsAll,(function(t){return t.value===e}))}},e.prototype.getDurationMax=function(){return r.getDurationMax(this.relativeQualifier.value,this.relativeUnit.value)},e.prototype.getRestatement=function(){var e=this.getRelativeDateRangeOptions();return r.getRestatement(e)},e.prototype.getRelativeDateRangeOptions=function(){return{duration:this.duration,includeToday:this.includeToday,relativeQualifier:this.relativeQualifier.value,relativeUnit:this.relativeUnit.value}},e})();t.RelativeDateFilterViewModel=s})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.close=function(){this.services.modalDialogService.close()},e})();e.TableViewDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.TableViewDialog={templateUrl:"components/tableViewDialog/tableViewDialog.html",bindings:{titleKey:"<",columnNames:"<",tableValues:"<"},controller:e.common.createController(t.controllers.TableViewDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.modalDialogService=e}return e.prototype.show=function(e,t,i){var r={columnNames:t,tableValues:i,titleKey:e},o={dialogName:"TableViewDialog",definitionTemplateCachePath:"components/tableViewDialog/tableViewDialogDefinition.html",bindings:r};return this.modalDialogService.showHostModalDialog(o)},e})();e.TableViewDialogBuilder=t})(t=e.dialogs||(e.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=270,i=(function(){function e(e,t){this.services=t,this.showErrorMessage=!0}return e.createOptions=function(){return{}},e.prototype.$onInit=function(){this.updateErrorOverlayVisibility(this.viewport),this.isFixButtonVisible=this.errorInfo&&(1===this.viewMode&&0!==this.errorInfo.fixableError||0===this.viewMode&&3===this.errorInfo.fixableError)},e.prototype.$onChanges=function(e){e.viewport&&this.updateErrorOverlayVisibility(this.viewport)},e.prototype.updateErrorOverlayVisibility=function(e){e&&(this.showErrorMessage=e.width>=t)},e})();e.CanvasVisualErrorOverlayController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.CanvasVisualErrorOverlay={templateUrl:"components/canvasVisualErrorOverlay/canvasVisualErrorOverlay.html",bindings:{errorInfo:"<",viewMode:"<",viewport:"<",showErrorDetails:"&",fixErrors:"&"},controller:e.common.createController(t.controllers.CanvasVisualErrorOverlayController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.data.FieldExprPattern,n=t.contracts.FilterType,a=e.data.SQExprBuilder,s=e.data.SQExprConverter,l=e.data.SQExprUtils,c=e.data.TopNFilterPattern,u=e.explore.util.VisualContainerUtils,p=(function(){function p(t,i){var o=this;this.scope=t,this.services=i,this.dropConfig={accept:r.Field},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.filterContainerChanged,(function(e,t){return o.onFilterContainerChanged(t)}))}return p.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","dropdown","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","undoRedo","visualAuthoring","visualPlugin"]}},p.prototype.$onInit=function(){this.initializeViewModel(this.viewModel.contract),this.checkDisabled()},p.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},p.prototype.applyFilter=function(){var r=this;if(this.canApplyFilter()){this.viewModel.contract.type=n.TopN;var o,a,s=this.viewModel.contract.expression,l=this.vm.orderByField,p=this.viewModel.visualContainer;if(p){var d=u.getVisualQuery(p);if(d){var h=d.defn.select();o=_.any(h,(function(t){return e.data.SQExpr.equals(t.expr,s,!0,!0)})),a=_.any(h,(function(t){return e.data.SQExpr.equals(t.expr,l,!0,!0)}))}}var v=this.vm.targetType.type===i.TopNFilterType.Top,g=this.vm.itemCount,f=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneTopNFilterApplied,v,g,o,a),m=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(m).then((function(e){r.services.undoRedo.register("ApplyTopNFilter",(function(){var e=c.buildFilterFromParameters({fieldBeingFiltered:s,isTop:v,itemCount:g,orderByField:l,aggregate:r.vm.selectedAggregate});r.services.visualAuthoring.updateFilter(r.viewModel.getFilterContainerScope().container,r.viewModel.contract,e);var i={filter:r.viewModel.contract,changeType:2,scope:r.viewModel.getFilterContainerScope()};return r.viewModel.useDefaultFilter=!1,r.updateRestatement(),r.topNFilterForm.$setPristine(),r.services.eventBridge.publishBubbling(r.scope,t.viewModels.FilterEvents.filterChanged,i),f.resolve(),!0}))}))}},p.prototype.canApplyFilter=function(){return this.checkDisabled(),!this.viewModel.cardType.invalid&&this.vm&&this.vm.itemCount>0&&null!=this.vm.orderByField&&this.topNFilterForm.$dirty&&this.topNFilterForm.$valid},p.prototype.dropFilterTarget=function(){var e=this,t=this.services.dragDataService.getDragContext();if(t&&t.field){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=t.field,n=l.isMeasure(o)?o:a.aggregate(o,e.services.aggrOps.defaultAggregate(o,r,!0));e.isValidOrderByExpr(n)&&i.TopNFilterViewModelFactory.updateOrderByField(e.vm,n,r,e.services.displayNameService,e.services.localizationService,e.services.aggrOps)&&e.topNFilterForm.$setDirty()}))}},p.prototype.getDropAction=function(){var e=this.services.promiseFactory.defer(),t=0;if(!this.viewModel.cardType.invalid){var i=this.services.dragDataService.getDragContext();if(i&&i.field){var r=i.field;this.isValidOrderByExpr(r)&&(t=1)}}return e.resolve(t),e.promise},p.prototype.removeOrderBy=function(){i.TopNFilterViewModelFactory.removeOrderByField(this.vm),this.topNFilterForm.$setDirty()},p.prototype.selectAggregate=function(e){var t=this;if(e!==this.vm.selectedAggregate){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){i.TopNFilterViewModelFactory.updateAggregate(t.vm,e,r,t.services.displayNameService,t.services.localizationService)&&t.topNFilterForm.$setDirty()}))}},p.prototype.showContextMenu=function(e){var t=this;this.services.dropdown.showContextMenu(this.vm.availableAggregates,{x:e.pageX,y:e.pageY},(function(e){return t.selectAggregate(e.aggregate)}),!1)},p.prototype.checkDisabled=function(){var t=this,i=this.viewModel.getFilterContainerScope().container;this.viewModel.cardType.invalid=_.any(i.filters,(function(i){return i!==t.viewModel.contract&&e.data.TopNFilterPattern.extractParametersFromFilter(i.filter)}))},p.prototype.isValidOrderByExpr=function(e){var t=s.asFieldPattern(e);return!!(l.isMeasure(e)||o.getProperty(t)||t.hierarchyLevel)},p.prototype.onFilterContainerChanged=function(e){e.filter===this.viewModel.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,10)&&this.initializeViewModel(e.filter),this.checkDisabled()},p.prototype.initializeViewModel=function(e){var t=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=e&&e.filter&&c.extractParametersFromFilter(e.filter);t.vm=i.TopNFilterViewModelFactory.createViewModel(o,r,t.services.localizationService,t.services.displayNameService,t.services.aggrOps),t.updateRestatement(),t.viewModel.updateFilterProperties(r,t.services.visualPlugin,t.services.aggrOps),t.viewModel.updateViewState()}))},p.prototype.updateRestatement=function(){this.viewModel.setRestatement(this.vm.getRestatement(this.services.localizationService))},p})();i.TopNFilterController=p})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.TopNFilter={templateUrl:"components/topNFilter/topNFilter.html",controller:e.common.createController(t.TopNFilterController),bindings:{viewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=jsCommon.StringExtensions,o=e.visuals.valueFormatter;!(function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"})(i=t.TopNFilterType||(t.TopNFilterType={}));var n=(function(){function e(e,t,i){this.filterTypes=e,this.targetType=t,this.itemCount=i}return e.prototype.getRestatement=function(e){if(null!=this.itemCount){var t=o.format(this.itemCount,"#,###"),n=this.orderByDisplayName,a=this.targetType.type===i.Top;return n?r.format(e.get(a?"FilterRestatement_TopNBy":"FilterRestatement_BottomNBy"),t,n):r.format(e.get(a?"FilterRestatement_TopN":"FilterRestatement_BottomN"),t)}},e})();t.TopNFilterViewModel=n})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.TopNFilterPattern;!(function(r){function s(e,t,i,r,o){var n=a.extractParametersFromFilter(e);if(n)return l(n,t,i,r,o)}function l(e,t,r,o,n){var a=!e||e.isTop?i.TopNFilterType.Top:i.TopNFilterType.Bottom,s=v(r),l=new i.TopNFilterViewModel(s,_.find(s,(function(e){return e.type===a})),e&&e.itemCount);return e&&u(l,e.orderByField,t,o,r,n),l}function c(e){e.orderByField=null,e.availableAggregates=null,e.selectedAggregate=null,e.orderByDisplayName=null}function u(e,t,i,r,n,a){return!o.equals(t,e.orderByField)&&(e.orderByField=t,e.availableAggregates=h(t,i,a,n),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,null,null,null,{includeVariationSource:!0}),e.selectedAggregate=o.isAggregation(t)?t.func:null,d(e),!0)}function p(e,t,i,r,o){return e.selectedAggregate!==t&&(e.orderByField=n.setAggregate(e.orderByField,t),e.selectedAggregate=t,d(e),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,null,null,null,{includeVariationSource:!0}),!0)}function d(e){for(var t=0,i=e.availableAggregates.items;t<i.length;t++){var r=i[t];r.checked=r.key.aggregate===e.selectedAggregate}}function h(i,r,o,n){return{items:t.viewModels.MenuItemFactory.createAggregateMenuItems(i,r,o,!1,e.VisualDataRoleKind.Measure,[])}}function v(e){return[{type:i.TopNFilterType.Top,text:e.get("TopNFilter_Top")},{type:i.TopNFilterType.Bottom,text:e.get("TopNFilter_Bottom")}]}r.createViewModelFromSemanticFilter=s,r.createViewModel=l,r.removeOrderByField=c,r.updateOrderByField=u,r.updateAggregate=p,r.getAvailableAggregates=h})(r=i.TopNFilterViewModelFactory||(i.TopNFilterViewModelFactory={}))})(i=t.components||(t.components={}));
})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function r(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y){this.conceptualSchemaProxy=e,this.dataSources=t,this.drill=i,this.extensionsService=r,this.lazySyncScoped=o,this.dropdown=n,this.eventBridge=a,this.explorationCapabilities=s,this.explorationNavigation=l,this.featureSwitchService=c,this.groupAuthoring=u,this.includeExcludeService=p,this.lazyScoped=d,this.localizationService=h,this.visibility=v,this.visualAuthoring=g,this.viewModeState=f,this.filterGenerator=m,this.telemetryService=y,this.updateItemsCallId=0}return r.prototype.create=function(t,i,r,o){return __awaiter(this,void 0,e.Promise,(function(){var e,n,a;return __generator(this,(function(s){switch(s.label){case 0:return this.setProperties(t,i,r,o),[4,this.getItems()];case 1:return e=s.sent(),n=this.explorationCapabilities.getCapabilities(),a=n&&n.shouldUseMenuScrollbars,this.dropdown.showContextMenu(e,o,this.select.bind(this),!1,void 0,a),[2]}}))}))},r.prototype.createForDrillthrough=function(t,i,r){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(o){switch(o.label){case 0:return _.isEmpty(i)?[2]:(this.setProperties(t,i,void 0,r),[4,this.getItems(!0)]);case 1:return e=o.sent(),this.dropdown.showContextMenu(e,r,this.select.bind(this),!1),[2]}}))}))},r.prototype.setProperties=function(e,t,i,r){this.visualContainer=e,this.selectors=t,this.roles=i,this.position=r},r.prototype.getItems=function(t){return void 0===t&&(t=!1),__awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f;return __generator(this,(function(m){switch(m.label){case 0:return this.updateItemsCallId++,e={visualContainer:this.visualContainer,section:this.explorationNavigation.getCurrentSection(),exploration:this.explorationNavigation.getCurrentExploration(),selectors:this.selectors},t?(i={forDrillthroughOnly:!0,canDrillToDetails:!1,canSeeData:!1,drillDirections:0,enableGroupAuthoring:!1,enableIncludeExclude:!1,enableInsightsExplore:!1,enableDrillthrough:this.drill.canDrillthrough(this.visualContainer),selectionContext:e,schema:void 0},[2,this.createItems(i)]):(r=this.updateItemsCallId,o=this.drill.getSupportedDrillDirections(this.visualContainer,_.first(this.roles)),n=this.drill.canDrillToDetails(this.visualContainer,this.selectors),a=this.visualContainer&&2!==this.visualContainer.visibility&&this.drill.canSeeData(this.visualContainer),s=this.explorationCapabilities.getCapabilities(),l=!1,c=!1,u=!1,p=this.dataSources.get(),d={canDrillToDetails:n,canSeeData:a,drillDirections:o,enableGroupAuthoring:l,enableIncludeExclude:c,enableInsightsExplore:u,enableDrillthrough:this.drill.canDrillthrough(this.visualContainer),selectionContext:e,schema:void 0},p?[4,this.conceptualSchemaProxy.get(p)]:[3,2]);case 1:return h=m.sent(),d.schema=h,this.isLastUpdateItemsCall(r)?(this.featureSwitchService.featureSwitches.includeExcludeEnabled&&!_.isEmpty(this.selectors)&&null!=this.selectors[0].dataMap&&(v=this.featureSwitchService.featureSwitches,d.enableIncludeExclude=this.includeExcludeService.isIncludeExcludeSupported(this.visualContainer,h,v.negatedTuplesFiltering)),this.featureSwitchService.featureSwitches.enableGroupAuthoring&&!this.pendingGroupOperation&&(g=h.schema(void 0),f=(g&&g.capabilities&&g.capabilities.supportsGrouping)!==!1,d.enableGroupAuthoring=f&&this.groupAuthoring.visual.canGroup(this.visualContainer,this.selectors,h)),this.featureSwitchService.featureSwitches.insightsExplore&&s&&s.insights&&(d.enableInsightsExplore=_.any(h.schemas,(function(e){return!e.isExtensionSchema&&e.capabilities.supportsInsights}))),[2,this.createItems(d)]):[2];case 2:return[2,this.createItems(d)]}}))}))},r.prototype.createItems=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.resetUpdateItemsCallCount(),[4,i.VisualContainerContextMenuViewModelFactory.createMenuItems(t,this.localizationService,this.lazyScoped,this.filterGenerator,this.extensionsService)];case 1:return[2,e.sent()]}}))}))},r.prototype.select=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:switch(i=t.action){case 1:return[3,1];case 0:return[3,2];case 2:return[3,3];case 3:return[3,4];case 4:return[3,5];case 5:return[3,6];case 6:return[3,7];case 7:return[3,8];case 8:return[3,9];case 9:return[3,10];case 10:return[3,11];case 11:return[3,14]}return[3,15];case 1:return this.drillDown(),[3,16];case 2:return this.drillUp(),[3,16];case 3:return this.drillDownLevel(3),[3,16];case 4:return this.drillDownLevel(2),[3,16];case 5:return this.drillToDetails(),[3,16];case 6:return this.seeData(),[3,16];case 7:return this.createGroup(),[3,16];case 8:return this.includeExcludeService.setFilter(3,this.selectors,this.visualContainer),[3,16];case 9:return this.includeExcludeService.setFilter(4,this.selectors,this.visualContainer),[3,16];case 10:return this.runInsightsAnalysis(t.data.insightsAnalysisData),[3,16];case 11:return[4,this.lazyScoped("drillthrough")];case 12:return r=a.sent(),o=r.getApplyStateInfo(t.data.drillthroughActionData),this.telemetryService.logEvent(e.telemetry.EXDrillthroughGotoTarget,t.data.drillthroughEntryPoint),[4,this.lazyScoped("explorationStateManager")];case 13:return n=a.sent(),n.apply(o.state,o.options),[3,16];case 14:return this.executeCustomCommand(t),[3,16];case 15:a.label=16;case 16:return[2]}}))}))},r.prototype.isLastUpdateItemsCall=function(e){return this.updateItemsCallId===e},r.prototype.resetUpdateItemsCallCount=function(){this.updateItemsCallId=0},r.prototype.drillUp=function(){this.visualAuthoring.drillUp(_.first(this.roles),this.visualContainer)},r.prototype.drillDownLevel=function(e){this.visualAuthoring.drillDownLevel(_.first(this.roles),this.visualContainer,e)},r.prototype.seeData=function(){this.visibility.set(this.visualContainer,2)},r.prototype.drillToDetails=function(){if(!_.isEmpty(this.selectors)){var e=this.dataSources.get();this.lazySyncScoped("drillToDetails").drillToDetails(this.selectors,this.visualContainer,e)}},r.prototype.drillDown=function(){_.isEmpty(this.selectors)||this.visualAuthoring.drillDown(this.selectors,this.visualContainer,this.dataSources.get(),_.first(this.roles))},r.prototype.createGroup=function(){var e=this;if(!this.pendingGroupOperation){this.pendingGroupOperation=!0;var t=this.dataSources.get();this.conceptualSchemaProxy.get(t).then((function(i){return e.groupAuthoring.visual.group(e.visualContainer,e.selectors,!0,t,i)})).finally((function(){e.pendingGroupOperation=!1}))}},r.prototype.runInsightsAnalysis=function(e){var i=this,r={exploration:this.explorationNavigation.getCurrentExploration(),analysisDefinition:e.analysisDefinition,insightQueryTransform:e.insightQueryTransform,description:e.description,dataSources:this.dataSources.get(),isReadOnly:0===this.viewModeState.getMode(),addVisual:function(e){i.eventBridge.publishToChannel(t.services.events.addInsightContainer,{visualContainer:e})},lazyLoadConfig:{name:"powerbi.insights",namespace:"powerbi.insights",dependency:{javascript:"insights",css:["insights"]}}};this.dropdown.showMenu({args:r},"insightsExplore.html",{position:this.position,showInsideVisibleArea:!0,showIndicator:!0,hideExistingOverlays:!0})},r.prototype.executeCustomCommand=function(e){var t=e.command;this.extensionsService.executeCustomCommand(this.visualContainer.name,t.name)},r})();i.VisualContainerContextMenu=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.telemetry.DrillthroughEntryPoint,o=jsCommon.EnumExtensions,n=e.explore.util.MenuItemUtility;!(function(t){function i(t,i,o,n,c){return __awaiter(this,void 0,e.Promise,(function(){var e,u;return __generator(this,(function(p){switch(p.label){case 0:return t.forDrillthroughOnly?[4,s(r.ModeOn,t.selectionContext.section.name,t.selectionContext.selectors,o,i)]:[3,2];case 1:return e=p.sent(),[3,4];case 2:return[4,a(t,i,o,n,c)];case 3:e=p.sent(),p.label=4;case 4:return _.isEmpty(e)&&(u=l("VisualContainer_ContextMenu_NoAvailableActions",null,i),u.disabled=!0,e.push(u)),[2,{items:e}]}}))}))}function a(t,i,a,u,p){return __awaiter(this,void 0,e.Promise,(function(){var e,d,h,v,g,f,m,y,w,S,b,C,x,M,D,F,E,V,P,T;return __generator(this,(function(A){switch(A.label){case 0:return e=[],d=o.hasFlag(t.drillDirections,4),h=o.hasFlag(t.drillDirections,2),v=d||h,g=o.hasFlag(t.drillDirections,1),f=t.canDrillToDetails,m=t.canSeeData,y=t.enableGroupAuthoring,w=t.enableIncludeExclude,S=t.enableDrillthrough,v&&e.push(l("DrillDown",1,i)),f&&e.push(l("DrillToDetails",4,i)),v&&(e.push(c()),d&&e.push(l("DrillDownLevel",2,i)),h&&e.push(l("DrillDownLevelGrouped",3,i))),g&&(v||_.isEmpty(e)||e.push(c()),e.push(l("DrillUp",0,i))),m&&(_.isEmpty(e)||e.push(c()),e.push(l("VisualContainer_SeeData_Enable",5,i))),y&&!_.isEmpty(e)&&e.push(c()),y&&e.push(l("VisualContainer_Group",6,i)),w&&(_.isEmpty(e)||e.push(c()),e.push(l("VisualContainer_ContextMenu_Include",7,i)),e.push(l("VisualContainer_ContextMenu_Exclude",8,i))),S?[4,s(r.ContextMenu,t.selectionContext.section.name,t.selectionContext.selectors,a,i)]:[3,2];case 1:b=A.sent(),_.isEmpty(b)||(_.isEmpty(e)||e.push(c()),e.push(l("Drillthrough",void 0,i,b))),A.label=2;case 2:return t.schema&&t.enableInsightsExplore?[4,a("insightsAnalysisService")]:[3,4];case 3:if(C=A.sent(),x=u.calculateVisualContainerFilter(t.selectionContext.exploration,t.selectionContext.section,t.selectionContext.visualContainer,t.schema),M=C.getOptions(t.selectionContext.visualContainer,x,t.selectionContext.selectors,t.schema),!_.isEmpty(M)){for(D=[],F=0,E=M;F<E.length;F++)V=E[F],D.push(l("",9,i,void 0,V.question,{insightsAnalysisData:V}));e.push(c()),e.push(l("VisualContainer_ContextMenu_Analyze",9,i,D))}A.label=4;case 4:return P=p?p.getCommandExtension():[],_.isEmpty(P)||(T=_.filter(P,(function(e){return e.extend&&e.extend.visualContextMenu})),_.isEmpty(T)||(e=e.concat(n.getMenuItems(T,(function(e){var t=e.extend.visualContextMenu.title||e.title;return l("",11,i,null,t,null,e)}))))),[2,e]}}))}))}function s(t,i,r,o,n){return __awaiter(this,void 0,e.Promise,(function(){var e,a,s;return __generator(this,(function(c){switch(c.label){case 0:return _.isEmpty(r)||_.isEmpty(i)?[2,[]]:[4,o("drillthrough")];case 1:return e=c.sent(),[4,e.getDrillthroughActions(i,r)];case 2:return a=c.sent(),s=_.map(a,(function(e){return l(void 0,10,n,void 0,e.actionDisplayName,{drillthroughActionData:e,drillthroughEntryPoint:t})})),[2,s]}}))}))}function l(e,t,i,r,o,n,a){var s={action:t,data:n,command:a};return{key:s,text:o||i.get(e),type:0,children:r}}function c(){return{type:1}}t.createMenuItems=i})(i=t.VisualContainerContextMenuViewModelFactory||(t.VisualContainerContextMenuViewModelFactory={}))})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.events,o=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["drill","eventBridge","visualAuthoring","visualPlugin"]}},t.prototype.$onInit=function(){var e=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.visualContainerChanged,(function(t,i){e.updateDrillableRoles(),e.updateDrillMode(i)})),this.updateDrillableRoles(),this.updateDrillModeCore()},t.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},t.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(this.getActiveRoleName(),this.visual.contract)},t.prototype.drillDownLevel=function(){this.services.visualAuthoring.drillDownLevel(this.getActiveRoleName(),this.visual.contract,3)},t.prototype.drillDownLevelGrouped=function(){this.services.visualAuthoring.drillDownLevel(this.getActiveRoleName(),this.visual.contract,2)},t.prototype.canDrill=function(){return this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup||this.canDrillUp},t.prototype.canDrillOnMoreThanOneRole=function(){return this.drillableRoles.length>1},t.prototype.onRoleChanged=function(){this.updateDrillModeCore()},t.prototype.drillLevelTitle=function(){var e=this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup?this.services.localizationService.get("DrillDownLevel_ToolTip"):this.services.localizationService.get("DrillDownLevelDisabled_ToolTip");return e},t.prototype.drillLevelGroupedTitle=function(){var e=this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup?this.services.localizationService.get("DrillDownLevelGrouped_ToolTip"):this.services.localizationService.get("DrillDownLevelDisabled_ToolTip");return e},t.prototype.updateDrillMode=function(e){e&&e.affectContainer(this.visual.contract)&&this.updateDrillModeCore()},t.prototype.updateDrillableRoles=function(){this.drillableRoles=[];var t=this.services.visualPlugin.capabilities(this.visual.contract.config.singleVisual.visualType);if(t)for(var i=e.explore.util.DrillUtils.getDrillableRoles(t),r=0,o=i;r<o.length;r++){var n=o[r];(this.canDrillDownWithCurrentGroupOnRole(n)||this.canDrillDownWithoutCurrentGroupOnRole(n)||this.canDrillUpOnRole(n))&&this.drillableRoles.push({name:n,value:this.services.localizationService.get("Drill_Role_"+n)})}if(_.isEmpty(this.drillableRoles))this.activeRole=void 0;else{var a=this.getActiveRoleName();_.find(this.drillableRoles,(function(e){return a===e.name}))||(this.activeRole=this.drillableRoles[0])}},t.prototype.canDrillDownWithCurrentGroupOnRole=function(e){return this.services.drill.canDrillByDirection(this.visual.contract,2,e)},t.prototype.canDrillDownWithoutCurrentGroupOnRole=function(e){return this.services.drill.canDrillByDirection(this.visual.contract,4,e)},t.prototype.canDrillUpOnRole=function(e){return this.services.drill.canDrillByDirection(this.visual.contract,1,e)},t.prototype.getActiveRoleName=function(){return this.activeRole?this.activeRole.name:null},t.prototype.updateDrillModeCore=function(){var e=this.getActiveRoleName();this.canDrillDownWithCurrentGroup=this.canDrillDownWithCurrentGroupOnRole(e),this.canDrillDownWithoutCurrentGroup=this.canDrillDownWithoutCurrentGroupOnRole(e),this.canDrillUp=this.canDrillUpOnRole(e)},t})();i.VisualContainerDrillController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerDrill={templateUrl:"components/visualContainerDrill/visualContainerDrill.html",bindings:{visual:"<"},controller:e.common.createController(t.controllers.VisualContainerDrillController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t,i){switch(e){case 1:return t.canDrillByDirection(i,2)||t.canDrillByDirection(i,4)||t.canDrillByDirection(i,1);case 3:return t.canDrillthrough(i);case 2:return t.canDrillToDetails(i);case 0:return!0;default:return!1}}var r=e.services.events,o=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["drill","eventBridge","visualAuthoring"]}},e.prototype.$onInit=function(){var e=this;this.updateDrillState(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.visualContainerChanged,(function(t,i){i&&i.affectContainer(e.visual.contract)&&e.updateDrillState()}))},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.toggleDrillDown=function(){this.isDrillDownEnabled=this.isDrillDownEnabled===!1,this.services.drill.setDrillMode(this.visual.contract,this.isDrillDownEnabled?1:0)},e.prototype.updateDrillState=function(){if(!this.visual)return this.canDrillDown=!1,void(this.isDrillDownEnabled=!1);var e=this.visual.contract,t=this.services.drill;this.canDrillDown=i(1,t,e);var r=e.drillMode,o=!1;1!==r||this.canDrillDown?null==r||0===r||i(r,t,e)||(o=!0):o=!0,o&&this.services.drill.setDrillMode(e,0),this.isDrillDownEnabled=t.isDrillModeEnabled(e,1),this.title=1===this.visual.contract.drillMode?this.services.localizationService.get("DrillMode_ToolTip"):this.services.localizationService.get("DrillDown_ToolTip")},e})();t.VisualContainerDrillToggleController=o})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerDrillToggle={templateUrl:"components/visualContainerDrillToggle/visualContainerDrillToggle.html",bindings:{visual:"<"},controller:e.common.createController(t.controllers.VisualContainerDrillToggleController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.selectionUtils,o=e.explore.util.VisualContainerUtils,n=(function(){function e(e,t){this.services=t,this.menuId=e.$id.toString()}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["selection","undoRedo","viewModeState","visibility","visualPluginOps","visualRelationship"]}},e.prototype.canPopOut=function(){return!(this.visual.isPoppedOut||!this.services.visualPluginOps.supportsFocusMode(o.getVisualType(this.visual.contract)))},e.prototype.popOutVisualContainer=function(){this.services.visibility.set(this.visual.contract,1)},e.prototype.getSeeDataLayoutTitle=function(){return 2===this.visual.contract.detailVisualLayout?this.services.localizationService.get("VisualContainer_SeeData_HorizontalLayoutButton"):this.services.localizationService.get("VisualContainer_SeeData_VerticalLayoutButton")},e.prototype.toggleSeeDataLayout=function(){var e=this.visual.contract,t=e.detailVisualLayout||1;this.services.undoRedo.register("ToggleSeeDataLayout",(function(){1===t?e.detailVisualLayout=2:e.detailVisualLayout=1})),this.visual.updateViewState()},e.prototype.canSetVisualRelationshipFilterAction=function(){if(!this.services.viewModeState.getConfig().showRelationships||1!==this.services.selection.getSelectedElements().length)return!1;var e=r.getSelectedVisual(this.services.selection);return!!this.services.visualRelationship.supportsAnyFilterAction(e)&&!r.isVisualContainerSelected(this.visual.contract,this.services.selection)},e})();i.VisualContainerHeaderController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerHeader={templateUrl:"components/visualContainerHeader/visualContainerHeader.html",bindings:{visual:"<",menuOptions:"<",disablePin:"<",showWarningDetails:"&",showTransformWarningDetails:"&",showInfoDetails:"&",onVisualContainerChanged:"&"},controller:e.common.createController(t.controllers.VisualContainerHeaderController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.visualHost.ResourcePackageReferenceResolver,r=e.explore.contracts.VisualContainer,o=e.explore.util.VisualContainerUtils,n=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","explorationSerializer","localizationService","promiseFactory"],scopedDependencies:["dataSources","explorationNavigation","filterGenerator","pinVisual","resourceLoader","viewModeState","visualPlugin"]}},e.prototype.pinVisualContainer=function(e){var t,r=this,o=this.services.dataSources.get(),n=this.visual;this.services.conceptualSchemaProxy.get(o).then((function(e){t=r.visual.hostServices.getFilters(r.services.filterGenerator,e)})).then((function(){return r.resolveResourceReferences(n.contract)})).then((function(e){return r.services.pinVisual.pinVisualContainer(o,e,t,n.baseThemeName,n.themeName,i.getRegisteredResourcePackage(r.services.explorationNavigation.getCurrentExploration().resourcePackages))})),e&&e.stopPropagation&&e.stopPropagation()},e.prototype.canPin=function(){if(!this.visual)return!1;if(o.hasGroupByItemsInQuery(this.visual.contract))return!1;var e=!1,t=this.visual.readOnlyState.visual.type;return e=this.services.pinVisual.canPinVisualType(t),this.services.viewModeState.getConfig().supportsPinning&&e&&!this.visual.showWatermark},e.prototype.showPin=function(){return this.visual&&this.visual.options.showPin},e.prototype.getPinTileTitle=function(){var e=this.visual.options.disablePin?this.services.localizationService.get("PinTile_NotSupportedTitle"):this.services.localizationService.get("PinVisual_ToolTip");return e},e.prototype.resolveResourceReferences=function(e){var t=this,n=this.services.promiseFactory.defer(),a=o.getVisualType(e),s=o.getObjectDefinitions(e),l=this.services.explorationNavigation.getCurrentExploration(),c=this.services.visualPlugin.capabilities(a),u=c&&c.objects;return i.loadAndResolveFromDataViewObjects(s,u,l.resourcePackages,this.services.resourceLoader,this.services.promiseFactory,!0).then((function(i){var o=r.clone(e,t.services.explorationSerializer);o.config.singleVisual.objects=i,n.resolve(o)})),n.promise},e})();t.VisualContainerPinButtonController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerPinButton={templateUrl:"components/visualContainerPinButton/visualContainerPinButton.html",bindings:{visual:"<",disablePin:"<"},controller:e.common.createController(t.controllers.VisualContainerPinButtonController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.events,o=t.services.selectionUtils,n=e.explore.util.VisualContainerUtils,a=(function(){function i(e,t){this.services=t}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","telemetryService"],scopedDependencies:["dataSources","eventBridge","selection","viewModeState","visualAuthoring","visualRelationship"]}},i.prototype.$onInit=function(){var e=this;this.loadVisualRelationshipFilterAction(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){return e.loadVisualRelationshipFilterAction()}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.setVisualRelationshipFilterAction=function(i,r){i&&i.stopPropagation&&i.stopPropagation();var a=o.getSelectedVisual(this.services.selection);this.visual.hostServices.setVisualRelationshipFilterAction(a,this.visual.contract,r,this.services.visualAuthoring),this.services.telemetryService.logEvent(e.telemetry.EXVisualRelationshipOverride,n.getVisualType(a),n.getVisualType(this.visual.contract),t.contracts.VisualRelationshipFilterActionUtil.toString(r)),this.filterAction=r,this.onVisualContainerChanged()},i.prototype.loadVisualRelationshipFilterAction=function(){var e=this,t=o.getSelectedVisual(this.services.selection);if(t){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){var r=e.visual.hostServices.getVisualRelationshipFilterAction(t,e.services.visualRelationship,i);0===r&&(r=e.services.visualRelationship.defaultFilterAction(t,e.visual.contract)),e.filterAction=r}))}},i.prototype.supportsVisualRelationshipFilterAction=function(e){var t=o.getSelectedVisual(this.services.selection);return this.services.visualRelationship.supportsFilterActionTarget(t,this.visual.contract,e)},i})();i.VisualContainerRelationshipFiltersController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerRelationshipFilters={templateUrl:"components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",bindings:{visual:"<",onVisualContainerChanged:"&"},controller:e.common.createController(t.controllers.VisualContainerRelationshipFiltersController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.explore.util.MenuItemUtility,a=t.services.selectionUtils,s=t.util.VisualContainerUtils,l=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dropdown","featureSwitchService","overlayService"],scopedDependencies:["dataSources","drill","eventBridge","extensionsService","filterGenerator","visibility","selection","undoRedo","visualAuthoring","visualPlugin"]}},t.prototype.$onInit=function(){var e=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){return e.onSelectionChanged()})),this.onSelectionChanged(),this.initCustomMenuItems()},t.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},t.prototype.exportVisualData=function(){var e=this,t=this.visual.readOnlyState.visual,i=t&&t.data&&t.data.dataViewSource,r=t&&t.dataTransforms,n=this.visual.contract.config.singleVisual,a=this.visual.visualTitle,s=null!=a?a.text:"",l=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(l).then((function(t){e.services.eventBridge.publishToChannel(o.exportVisualData,{dataViewSource:i,visualConfig:n,visualTitle:s,transformActions:r,additionalFilters:e.visual.hostServices.getFilters(e.services.filterGenerator,t)})})).finally((function(){e.services.overlayService.hideAllDropdowns()}))},t.prototype.toggleSort=function(e,t){this.services.overlayService.hideAllDropdowns();var i={sortableField:e,sortDirection:t};this.services.eventBridge.publishBubbling(this.visualContainerController.scope,o.toggleSortVisualContainer,i)},t.prototype.toggleSearch=function(){var t=this,i=this.visual.contract.config.singleVisual;i.objects||(i.objects={});var o=s.getVisualCapabilities(this.visual.contract,this.services.visualPlugin),n=this.services.filterGenerator.tryGetSelfFilterEnabledProperty(o);if(n){var a=r.getValue(i.objects,n,null),l=a&&a.value||!1;this.services.undoRedo.register("ToggleSearchVisualContainer",(function(){if(l){r.deleteProperty(i.objects,n.objectName,null,n.propertyName);var a=t.services.filterGenerator.tryGetSelfFilterProperty(o);a&&r.deleteProperty(i.objects,a.objectName,null,a.propertyName)}else r.setValue(i.objects,n,null,e.data.SQExprBuilder.boolean(!0));t.services.visualAuthoring.raiseVisualContainerChanged(t.visual.contract)}))}this.services.overlayService.hideAllDropdowns()},Object.defineProperty(t.prototype,"isSearchOn",{get:function(){var e=this.visual.contract.config.singleVisual;if(!e||!e.objects)return!1;var t=s.getVisualCapabilities(this.visual.contract,this.services.visualPlugin);if(!t)return!1;var i=this.services.filterGenerator.tryGetSelfFilterEnabledProperty(t);if(!i)return!1;var o=r.getValue(e.objects,i,null);return o&&o.value||!1},enumerable:!0,configurable:!0}),t.prototype.deleteVisualContainer=function(){var e=this;this.services.undoRedo.register("DeleteVisualContainer",(function(){e.services.eventBridge.publishToChannel(o.deleteVisualContainer,e.visual.contract)}))},t.prototype.seeData=function(){this.services.visibility.set(this.visual.contract,2)},t.prototype.getClusters=function(){this.services.eventBridge.publishBubbling(this.visualContainerController.scope,o.getClusters,{})},t.prototype.getSpatialClusters=function(){this.services.eventBridge.publishBubbling(this.visualContainerController.scope,o.getClusters,{useSpatialClustering:!0})},t.prototype.toggleSpotlight=function(){4===this.visual.contract.visibility?this.services.visibility.clear():this.services.visibility.set(this.visual.contract,4)},Object.defineProperty(t.prototype,"isSpotlightOn",{get:function(){return 4===this.visual.contract.visibility},enumerable:!0,configurable:!0}),t.prototype.enterAdvancedEditMode=function(){this.services.eventBridge.publishBubbling(this.visualContainerController.scope,o.changeEditMode,1),this.services.overlayService.hideAllDropdowns()},t.prototype.executeCustomCommand=function(e){this.services.extensionsService.executeCustomCommand(this.visual.contract.name,e)},t.prototype.initCustomMenuItems=function(){if(this.customMenuItems=[],this.services.featureSwitchService.featureSwitches.customCommands){var e=this.services.extensionsService.getCommandExtension();if(!_.isEmpty(e)){var t=_.filter(e,(function(e){return e.extend.visualOptionsMenu}));_.isEmpty(t)||(this.customMenuItems=n.getMenuItems(t,(function(e){return{text:e.extend.visualOptionsMenu.title||e.title,icon:e.extend.visualOptionsMenu.icon||e.icon,key:e.name,type:0}})))}}},t.prototype.showOptionsMenu=function(e){var t=this,i=this.services.dropdown,r=function(t){t(),i.hideAll(),e.stopPropagation()};this.menuOptions.canSeeData=this.services.drill.canSeeData(this.visual.contract)&&!this.services.visibility.isSeeDataMode(this.visual.contract.visibility);var o={actualSortDirection:function(){return t.visual.readOnlyState.actualSortDirection},menuOptions:function(){return t.menuOptions},isSearchOn:function(){return t.isSearchOn},isSpotlightOn:function(){return t.isSpotlightOn},toggleSearch:function(){return r((function(){return t.toggleSearch()}))},toggleSort:function(e){return r((function(){return t.toggleSort(e)}))},toggleSpotlight:function(){return r((function(){return t.toggleSpotlight()}))},enterAdvancedEditMode:function(){return r((function(){return t.enterAdvancedEditMode()}))},exportVisualData:function(){return r((function(){return t.exportVisualData()}))},deleteVisualContainer:function(){return r((function(){return t.deleteVisualContainer()}))},getClusters:function(){return r((function(){return t.getClusters()}))},getSpatialClusters:function(){return r((function(){return t.getSpatialClusters()}))},seeData:function(){return r((function(){return t.seeData()}))},executeCustomCommand:function(e){return r((function(){return t.executeCustomCommand(e)}))},getCustomMenuItems:function(){return t.customMenuItems}};i.showMenu(o,"visualContainerOptionsMenu.html",this.getMenuProperties(e)),e.stopPropagation()},t.prototype.getMenuProperties=function(e){return{anchorElement:$(e.currentTarget),preferLeft:!1,showInsideVisibleArea:!0,horizontal:!1}},t.prototype.onSelectionChanged=function(){this.visual&&this.visual.contract&&(this.isSelected=a.isVisualContainerSelected(this.visual.contract,this.services.selection))},t})();i.VisualContainerOptionsMenuController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerOptionsMenu={templateUrl:"components/visualOptionsMenu/visualContainerOptionsMenu.html",bindings:{visual:"<",menuOptions:"<",menuId:"<"},require:{visualContainerController:"^visualContainer"},controller:e.common.createController(t.controllers.VisualContainerOptionsMenuController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.DateExtensions,o=(jsCommon.DOMConstants,t.services.events),n=t.contracts.FilterType,a=e.data.SemanticFilter,s=e.common.directives.TooltipAnchorElementType,l=(function(){function i(e,t){this.scope=e,this.services=t,this.initialize()}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","overlayService","telemetryService","localizationService","tooltipService"],scopedDependencies:["dataSources","eventBridge","undoRedo","visualAuthoring","visualPlugin"]}},i.prototype.initialize=function(){var i=this;this.scope.moduleConfig={name:"ui.bootstrap",dependency:{javascript:"angular-ui-datetimepicker"}},this.getConceptualSchema().then((function(e){
var r=i.scope;i.advFilterCard=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(r.viewModel.contract),r.advFilterCard=i.advFilterCard,r.applyFilter=function(){return i.applyFilter()},r.handleFocusedInputChanged=function(e,t){return i.handleFocusedInputChanged(e,t)},r.handleInputBlur=function(){return i.handleInputBlur()},r.isDirty=!1,r.markDirty=function(){return i.scope.isDirty=!0},r.clearDirty=function(){return i.scope.isDirty=!1},r.validateFilterInput=function(e){return i.validateFilterInput(e)},r.dateOptions={showWeeks:!1},r.dateSelected=function(e){return i.dateSelected(e)},r.timeSelected=function(e){return i.timeSelected(e)},r.dateTextUpdateComplete=function(e){return i.dateTextUpdateComplete(e)},r.dateTextUpdated=function(e){return i.dateTextUpdated(e)},r.keyUp=function(e){return i.onKeyUp(e)},r.tooltipConfig={tooltipLocalizeTitle:"AdvancedFilter_InvalidTooltip",tooltipAnchorElementSelector:"input[type='text']:first",tooltipAnchorElementType:s.Sibling},i.updateRestatement(),i.updateModel(e);var n=i.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)}));r.$on("$destroy",(function(){return n.unsubscribeAll()}))})).catch((function(){return i.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Conceptual schema could not be found.")}))},i.prototype.updateModel=function(t){var i=this;if(this.advFilterCard.loadOperators(t,this.services.aggrOps),!this.advFilterCard.operators)return void this.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Filter operators failed to load.");var r=this.advFilterCard.field,o=r.getMetadata(t);o&&(this.advFilterCard.isDateTime=!!o.type.dateTime),this.advFilterCard.ensureConditions();var n=this.advFilterCard.conditions,a=this.scope;a.viewModel.updateFilterProperties(t,this.services.visualPlugin,this.services.aggrOps);for(var s=0,l=n;s<l.length;s++){var c=l[s];c&&c.value&&(c.value.formatter=this.scope.viewModel.formatter)}a.viewModel.updateViewState(),a.canApplyFilter=function(){return i.canApplyFilter(t)}},i.prototype.applyFilter=function(){var i=this,r=this.scope.viewModel;r.contract.type=n.Advanced;var o=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneAdvancedFilterApplied,r.isVisualFilter,t.contracts.FilterType.Advanced);this.getConceptualSchema().then((function(e){i.services.undoRedo.register("ApplyAdvancedFilter",(function(){if(!i.canApplyFilter(e))return o.reject(),!1;var n,s=i.advFilterCard.toSQExpr(e),l=i.scope.viewModel;s?(i.services.visualAuthoring.updateFilter(l.getFilterContainerScope().container,l.contract,a.fromSQExpr(s)),n=2):(i.services.visualAuthoring.updateFilter(l.getFilterContainerScope().container,l.contract,void 0),n=10);var c={filter:r.contract,changeType:n,scope:r.getFilterContainerScope()};return i.scope.clearDirty(),i.scope.viewModel.useDefaultFilter=!1,i.updateRestatement(),i.services.eventBridge.publishBubbling(i.scope,t.viewModels.FilterEvents.filterChanged,c),o.resolve(),!0}))}),o.reject())},i.prototype.validateFilterInput=function(e){var t=this;this.getConceptualSchema().then((function(i){e.value&&e.value.value&&!t.advFilterCard.isConditionValid(i,e)?e.isInvalid=!0:(e.isInvalid=!1,t.services.tooltipService.hideTooltip())}))},i.prototype.handleFocusedInputChanged=function(e,t){this.validateFilterInput(t)},i.prototype.handleInputBlur=function(){this.services.tooltipService.hideTooltip()},i.prototype.dateSelected=function(e){this.services.overlayService.hideAllDropdowns(),e.value.dateValue&&(e.value.value=e.value.dateValue),this.scope.markDirty()},i.prototype.timeSelected=function(e){if(e.value.value&&e.value.value instanceof Date){var t=e.value.timePickerValue.getHours(),i=e.value.timePickerValue.getMinutes();e.value.dateValue=e.value.value=new Date(e.value.value.setHours(t,i))}else e.value.value=e.value.dateValue=e.value.timePickerValue;this.scope.markDirty()},i.prototype.dateTextUpdateComplete=function(e){var t=e.value;_.isString(t.value)&&(t.value=t.dateValue)},i.prototype.dateTextUpdated=function(e){var t=e.value,i=r.parseIsoDate(t.value);i&&(t.dateValue=i)},i.prototype.updateRestatement=function(){if(!this.scope.viewModel.useDefaultFilter&&this.scope.viewModel.contract.type===n.Advanced){var e=this.scope.viewModel;e.setRestatement(this.advFilterCard.getRestatement(e.formatter))}},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(e)},i.prototype.onFilterContainerChanged=function(e){var i=this.scope.viewModel;if(e.filter===i.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)){var r=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(e.filter);this.advFilterCard.conditions=r.conditions,this.updateRestatement(),this.advFilterCard.ensureConditions()}},i.prototype.canApplyFilter=function(e){return this.scope.isDirty&&!this.scope.viewModel.readOnlyState.disabled&&this.advFilterCard.areConditionsValid(e)},i.prototype.onKeyUp=function(e){var t=this;e.preventDefault();var i=e.keyCode||e.which;13===i&&this.scope.$applyAsync((function(){return t.applyFilter()}))},i})();i.AdvancedFilterController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function r(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}var o=e.util.CanvasVisualsUtility,n=(function(){function e(e,t){this.items=[],this.services=t}return e.createOptions=function(){return{scopedDependencies:["canvasScale"]}},e.prototype.registerLayoutItem=function(e){this.items.push(e)},e.prototype.unregisterLayoutItem=function(e){_.pull(this.items,e)},e.prototype.dragEnd=function(e,t,i){this.canProcess(e)&&e.dragEnd(t,this.getNormalizedPosition(e,i))},e.prototype.dragStart=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.dragStart(t,i))},e.prototype.nudge=function(e,t,i,r){this.canProcess(e)&&e.nudge(t,this.getNormalizedPosition(e,i,r))},e.prototype.resizeStart=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.resizeStart(t,i))},e.prototype.resizeMove=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.resizeMove(t,i))},e.prototype.resizeEnd=function(e,t,i){this.canProcess(e)&&e.resizeEnd(t,this.getNormalizedPosition(e,i))},e.prototype.setStrategy=function(e){this.strategy=e},e.prototype.setCanvasSize=function(e){this.canvasSize=e},e.prototype.getDropPosition=function(e,t,i){var r=i;if(!r){var o=this.services.canvasScale.getCanvasScaleFactor();r={x:o,y:o}}var n=this.strategy.getNearestDropPosition({item:null,allItems:this.items,rawItemPosition:{left:e,top:t,width:0,height:0},canvasSize:this.canvasSize,canvasScale:r});return n},e.prototype.getIntermediateDimensions=function(e,t){if(this.strategy.isEnforcedForIntermediateStates()){var o=i(this.getScaledPosition(e,t));return r(this.strategy.getHostRectFromScaled(o))}return t},e.prototype.getScaledPosition=function(e,t,n){var a=e.getScale(),s={x:!_.isFinite(t.x),y:!_.isFinite(t.y),width:!_.isFinite(t.width),height:!_.isFinite(t.height)},l=e.getPosition(),c=o.convertToScaledPosition(l,a,!1);if(s.x||s.y||s.width||s.height){var u=this.strategy.getHostRectFromScaled(i(c));t=__assign({},t),s.x&&(t.x=u.left),s.y&&(t.y=u.top),s.width&&(t.width=u.width),s.height&&(t.height=u.height)}var p=i(t),d=this.strategy.getNearestValidPosition({item:e,allItems:this.items,canvasSize:this.canvasSize,canvasScale:a,rawItemPosition:p,nudge:n});return d?r(d):c},e.prototype.getNormalizedPosition=function(e,t,n){var a=this.getScaledPosition(e,t,n),s=o.convertFromScaledRect(i(a),e.getScale());return r(s)},e.prototype.canProcess=function(e){return!!e&&!e.isSuspended()&&_.contains(this.items,e)},e})();t.CanvasLayoutController=n})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){var n=i(e,o);return{width:l(r,n.width,o.colSpacing),height:l(t,n.height,o.rowSpacing)}}function i(e,t){var i=t.cols,r=t.rows,o=t.rowSpacing,n=t.colSpacing,a=n*(i+1),s=o*(r+1),l=Math.floor((e.width-a)/i),c=Math.floor((e.height-s)/r);return{width:l,height:c}}function r(e,t,r){for(var o=i(e,t),n=t.cols,a=t.rows,s=t.rowSpacing,l=t.colSpacing,c=r.width,u=r.height,p=o.width,d=o.height,h=Math.ceil(c/(p+l)),v=Math.ceil(u/(d+s)),g=[],f=0,m=0;m<=a-v;++m){f+=s;for(var y=0,w=0;w<=n-h;++w)y+=l,g.push({left:y,top:f,width:c,height:u}),y+=p;f+=d}return g}function o(e,t,i,r){return[n(t,e,r),i]}function n(e,t,r){var o=i(t,e),n=e.rowSpacing,l=e.colSpacing,c=o.width,u=o.height;return{left:a(r.left,c,l),top:a(r.top,u,n),width:s(r.width,c,l),height:s(r.height,u,n)}}function a(e,t,i){var r=e+t/2;r-=1;var o=Math.floor(r/(t+i));return c(o,t,i)}function s(e,t,i){var r=e+t/2+i,o=Math.floor(r/(t+i));return o=Math.max(1,o),l(o,t,i)}function l(e,t,i){return e*t+Math.max(0,e-1)*i}function c(e,t,i){return e*t+e*i+i}e.getSpanSize=t,e.getCellSize=i,e.getAllSlots=r,e.getAllResizeSlots=o})(t=e.CanvasLayoutGrid||(e.CanvasLayoutGrid={}))})(t=e.canvas||(e.canvas={}))})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r;!(function(i){function r(e,t,i){var r=_.chain(i).without(t).map((function(e){return a.visualPositionToRect(e.getPosition())})).value();return _.remove(e,(function(e){return _.any(r,(function(t){return o(t,e)}))})),e}function o(e,t){return!(t.left>=e.left+e.width||e.left>=t.left+t.width||t.top>=e.top+e.height||e.top>=t.top+t.height)}function n(e,t){return l.getDistance(c.getCentroid(e),c.getCentroid(t))}var a=t.util.CanvasDisplayUtility,s=t.util.CanvasVisualsUtility,l=e.visuals.shapes.Point,c=e.visuals.shapes.Rect,u=(function(){function e(e,t){void 0===t&&(t={width:3,height:3}),this.options=e,this.defaultNewCellSize=t}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=c.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=c.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(e){var t=e.rawItemPosition,i=this.options.offset;i&&(t=c.add(e.rawItemPosition,i));var r,o=s.convertFromScaledRect(t,e.canvasScale),l=!1;e.item&&(r=a.visualPositionToRect(e.item.getPosition()),l=o.width!==r.width||o.height!==r.height);var u,p;if(l)u=this.getAvailableResizeRects(e.item,e.allItems,e.canvasSize,r,o),p=u[0];else{if(u=this.getAvailableRects(e.item,e.allItems,e.canvasSize,o),_.isEmpty(u))return;p=_.min(u,(function(e){return n(e,o)}))}return s.convertToScaledRect(p,e.canvasScale)},e.prototype.getNearestDropPosition=function(e){var t=c.getCentroid(e.rawItemPosition);this.options.offset&&(t.x-=this.options.offset.left,t.y-=this.options.offset.top),t.x/=e.canvasScale.x,t.y/=e.canvasScale.y;var r=this.defaultNewCellSize.width,o=this.defaultNewCellSize.height,a=function(){var a=i.CanvasLayoutGrid.getSpanSize(e.canvasSize,r,o,s.options),l={left:t.x-a.width/2,top:t.y-a.height/2,width:a.width,height:a.height},u=s.getAvailableRects(e.item,e.allItems,e.canvasSize,l);return _.isEmpty(u)||(_.remove(u,(function(e){return!c.containsPoint(e,t)})),_.isEmpty(u))?(--r,void--o):{value:_.min(u,(function(e){return n(e,l)}))}},s=this;do{var l=a();if("object"==typeof l)return l.value}while(r>=1&&o>=1)},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e.prototype.getAvailableRects=function(e,t,o,n){var a=i.CanvasLayoutGrid.getAllSlots(o,this.options,n);return r(a,e,t)},e.prototype.getAvailableResizeRects=function(e,t,o,n,a){var s=i.CanvasLayoutGrid.getAllResizeSlots(o,this.options,n,a);return r(s,e,t)},e})();i.CanvasLayoutGridStrategy=u,i.isIntersecting=o})(r=i.canvas||(i.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.explore.util.CanvasVisualsUtility,o=e.visuals.shapes.Rect,n=(function(){function e(e){this.offset=e}return e.prototype.getScaledRectFromHost=function(e){return o.add(e,this.offset)},e.prototype.getHostRectFromScaled=function(e){return o.subtract(e,this.offset)},e.prototype.getNearestValidPosition=function(e){return o.add(e.rawItemPosition,this.offset)},e.prototype.getNearestDropPosition=function(e){var t=e.rawItemPosition.left+e.rawItemPosition.width/2,o=e.rawItemPosition.top+e.rawItemPosition.height/2;t-=this.offset.left,o-=this.offset.top,t/=e.canvasScale.x,o/=e.canvasScale.y;var n=i.DefaultVisualPosition.width,a=i.DefaultVisualPosition.height;return{left:r.checkBoundaryForCharts(t,n,e.canvasSize.width),top:r.checkBoundaryForCharts(o,a,e.canvasSize.height),width:n,height:a}},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e})();t.DefaultLayoutStrategy=n})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.explore.components.DotGridComponent,o=e.visuals.shapes.Rect,n=e.common.controllers.TransformNudgeDirection,a=(function(){function e(e){this.options=e}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=o.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=o.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(t){var i=o.add(t.rawItemPosition,this.options.offset),r=t.canvasScale;if(t.nudge&&t.item){var a=t.item.getPosition(),s=a.x,l=a.y;t.nudge.direction===n.Left||t.nudge.direction===n.Right?s=e.applyNudge(s,this.options.layoutX.UnitDivisions,t.nudge.direction===n.Left,t.nudge.bigNudge):t.nudge.direction!==n.Up&&t.nudge.direction!==n.Down||(l=e.applyNudge(l,this.options.layoutY.UnitDivisions,t.nudge.direction===n.Up,t.nudge.bigNudge)),i.left=s*r.x,i.top=l*r.y}var c=this.getNearestUnscaledGridRect(i,r);return{left:c.left*r.x,top:c.top*r.y,width:c.width*r.x,height:c.height*r.y}},e.applyNudge=function(e,t,i,o){e=Math.round(e);var n=o?r.CanvasLayout.UnitLength:r.CanvasLayout.UnitLength/t,a=n*(i?Math.floor:Math.ceil)(e/n);return a===e&&(a+=i?-n:n),a},e.prototype.getNearestDropPosition=function(e){var t=o.getCentroid(e.rawItemPosition);t.x-=this.options.offset.left,t.y-=this.options.offset.top;var r={left:t.x-i.DefaultVisualPosition.width/2,top:t.y-i.DefaultVisualPosition.height/2,width:i.DefaultVisualPosition.width,height:i.DefaultVisualPosition.height};return r=this.getNearestUnscaledGridRect(r,e.canvasScale)},e.prototype.getNearestUnscaledGridRect=function(t,i){var r=this.getNearestUnscaledGridPoint({x:t.left,y:t.top},i),o=this.getNearestUnscaledGridPoint({x:t.left+t.width,y:t.top+t.height},i),n=this.options.limits;if(n){var a=e.limitAdjustment(r.x,o.x,n.left,n.width);0!==a&&(r.x+=a,o.x+=a);var s=e.limitAdjustment(r.y,o.y,n.top,n.height);0!==s&&(r.y+=s,o.y+=s)}return{left:r.x,top:r.y,width:o.x-r.x,height:o.y-r.y}},e.limitAdjustment=function(e,t,i,r){if(e<i)return i-e;var o=i+r;return t>o?o-t:0},e.prototype.getNearestUnscaledGridPoint=function(t,i){return{x:e.getNearestUnscaledGridCoordinate(this.options.layoutX,t.x,i.x),y:e.getNearestUnscaledGridCoordinate(this.options.layoutY,t.y,i.y)}},e.getNearestUnscaledGridCoordinate=function(e,t,i){var o=t/i,n=r.CanvasLayout.UnitLength/e.UnitDivisions,a=Math.round(o/n);return a*n},e.prototype.isEnforcedForIntermediateStates=function(){return!0},e})();t.DotGridLayoutStrategy=a})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.ErrorDetailsUtility,o=e.explore.services.events,n=e.data.SQExprUtils,a=e.explore.services,s=jsCommon.TraceType,l="Sampled",c=(function(){function i(e,t){this.scope=e,this.services=t}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","errorService","featureSwitchService","modalDialogService","telemetryService"],scopedDependencies:["dataSources","eventBridge","selection","visualAuthoring"]}},i.prototype.showErrorDetails=function(){var e=this.scope.viewModel;this.logErrorAndShowDialog(e.errorInfo,e.readOnlyState.visual.type,2!==e.errorInfo.source,!0)},i.prototype.showWarningDetails=function(){var e=this.scope.viewModel,t={details:e.warningInfo.details,code:e.warningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1,!0)},i.prototype.showTransformWarningDetails=function(){var e=this.scope.viewModel,t={details:e.transformWarningInfo.details,code:e.transformWarningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1,!0)},i.prototype.showInfoDetails=function(){var e=this.scope.viewModel,t={details:e.visualInfo.details,code:e.visualInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1,!1)},i.prototype.clearError=function(){var e=this.scope.viewModel;e.errorInfo=void 0,e.warningInfo=void 0,e.transformWarningInfo=void 0,e.visualInfo=void 0},i.prototype.showErrorOverlay=function(t,i,o,n){var a=this.scope.viewModel,s=a.readOnlyState.visual.type;if(this.services.telemetryService.logEvent(e.telemetry.VisualError,i,s,void 0,t.message),!a.errorInfo||a.errorInfo.code!==i){var l=r.getErrorOverlayType(i),c=this.shouldHideSeeDetails(i),u=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0),p=this.getFixableErrorKind(i,this.services.featureSwitchService.featureSwitches.enableTableToTableRelationship&&u&&u.canEdit);a.errorInfo={details:t,code:i,fixableError:p,hideSeeDetails:c,overlayType:l,requestId:o,source:n}}},i.prototype.showWarningIcon=function(e,t){var i=this.scope.viewModel,r=i.readOnlyState.visual.type;this.logVisualWarning(r,t,e.message),i.warningInfo||(i.warningInfo={details:e,code:t})},i.prototype.showTransformWarningIcon=function(e,t,i){var r=this.scope.viewModel,o=r.readOnlyState.visual.type,n=i?t.concat("|").concat(l):t;this.logVisualWarning(o,n,e.message),r.transformWarningInfo||(r.transformWarningInfo={details:e,code:t})},i.prototype.showInfoIcon=function(e,t){var i=this.scope.viewModel,r=i.readOnlyState.visual.type;this.logVisualWarning(r,t,e.message),i.visualInfo||(i.visualInfo={details:e,code:t})},i.prototype.fixErrors=function(){var t=this.scope.viewModel;switch(t.errorInfo.fixableError){case 1:a.selectionUtils.selectVisualContainer(t.contract,this.services.selection),this.services.visualAuthoring.removeInvalidExpressions(t.contract,this.services.dataSources.get());break;case 2:var i=n.getActiveTablesNames(t.contract.config.singleVisual.query.defn);this.services.eventBridge.publishToChannel(o.missingTableRelationship,{tables:i});break;case 3:this.removeBrokenFilters();break;case 4:this.services.eventBridge.publishToChannel(e.explore.services.events.showEnableScriptVisualsDialog);break;case 0:}},i.prototype.removeBrokenFilters=function(){var e=this,t=this.scope.viewModel,i=t.contract.filters,r={scopeType:0,container:t.contract};this.services.conceptualSchemaProxy.get(this.services.dataSources.get()).then((function(t){for(var o=0,n=i;o<n.length;o++){var a=n[o];a.filter&&!_.isEmpty(a.filter.validate(t,e.services.aggrOps))&&e.services.visualAuthoring.removeFilter(a,r)}}))},i.prototype.generateShowMoreErrorDetails=function(t){var i=[],o=t.message,n=e.common.localize.get("ServiceError_CannotLoadVisual");if(r.hasAdditionalErrorInfo(t)&&(n=t.displayableErrorInfo[0].errorInfoKey,o=t.displayableErrorInfo[0].errorInfoValue,t.displayableErrorInfo.length>1))for(var a=1;a<t.displayableErrorInfo.length;a++)i.push(t.displayableErrorInfo[a]);var s={title:n,message:o,displayableErrorInfo:i,debugErrorInfo:t.debugErrorInfo};return s},i.prototype.getFixableErrorKind=function(e,t){switch(e){case"Missing_References":return 1;case"InvalidUnconstrainedJoin":return t?2:0;case"Broken_Filters":return 3;case"ScriptVisualsNotEnabled":return 4;default:return 0}},i.prototype.shouldHideSeeDetails=function(e){return 1===r.getErrorOverlayType(e)},i.prototype.logErrorAndShowDialog=function(e,i,r,o){var n,a,l=this.generateShowMoreErrorDetails(e.details),c=e.code;if(r?(n="VisualErrorSeeDetails_"+c+"_"+i,a=s.Error):(n="VisualWarningSeeDetails_"+c+"_"+i,a=s.Warning),o){var u={title:l.title,displayableErrorInfo:l.displayableErrorInfo,debugErrorInfo:l.debugErrorInfo,level:a};e.details&&e.details.helpLink&&(u.helpLink=e.details.helpLink),e.requestId&&(u.requestId=e.requestId),this.services.errorService.error(l.message,n,u)}else{var p=new t.dialogs.LearnMoreDialogBuilder(this.services.modalDialogService);p.show("VisualContainerInfo",l.title,l.message,"PBI_Button_Label_Close",e.details.helpLink)}},i.prototype.logVisualWarning=function(t,i,r){this.services.telemetryService.logEvent(e.telemetry.VisualWarning,t,void 0,!1,e.telemetry.ErrorSource.PowerBI,i,r)},i})();i.CanvasVisualErrorController=c})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.ErrorDetailsUtility,o=(function(){function t(t,i){var r=this;this.services=i,this.tooltipConfigManager={getTooltipConfig:function(){return{tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft,tooltipDelay:100,tooltipDescription:r.getWarningMessage()}}}}return t.createOptions=function(){return{additionalServices:["localizationService"]}},t.prototype.isClickable=function(){var e=this.details;return!!e&&(!_.isEmpty(e.message)||this.hasAdditionalErrorInfo(e))},t.prototype.hasAdditionalErrorInfo=function(e){return r.hasAdditionalErrorInfo(e)},t.prototype.getWarningMessage=function(){var e=this.details;if(!e)return"";var t=this.hasAdditionalErrorInfo(e)?e.message+" "+this.services.localizationService.get("VisualContainer_ClickToSeeMore"):e.message;return t},t})();i.CanvasVisualHeaderIconController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.showDialog=function(e,t,i){var r=e.$new(!0);r.onGotIt=function(){i(!1),r.closeDialog()};var o={dialogName:void 0,isDismissable:!0,scope:r,template:"<convert-table-dialog></convert-table-dialog>",dialogCssClass:"convertTableDialog",closeOnEsc:!0};t.showLegacyWebModalDialog(o)},e})();e.ConvertTableDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.deleteVisual=function(){return t.deleteVisual()},this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.deleteVisual=function(){this.closeDialog(),this.scope.deleteVisualService.deleteCustomVisuals(this.scope.explorationContract,this.scope.customVisuals)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.DeleteVisualWarningDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.data.SQExprBuilder,a=e.visuals.controls.internal.TablixObjects,s=e.explore.util.VisualContainerUtils,l=(function(){function i(e,i){var r=this;this.scope=e,this.services=i,this.dataProxy=this.services.singleExecutableDataProxyFactory.create(),this.visualDataProxyService=t.services.createExploreVisualDataProxyService(this.dataProxy,this.services.filterGenerator),this.queryVisualHostServices=this.createQueryVisualHostServices(),this.spinnerService=t.services.createDetailVisualSpinnerService(e,i.eventBridge),this.initialize(),this.scope.$on("$destroy",(function(){r.subscriptionManager&&r.subscriptionManager.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","featureSwitchService","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","visibility","visualPlugin","visualAuthoring","visualQueryGenerator"]}},i.prototype.initialize=function(){var e=this;if(!this.initializeVisual())var t=this.scope.$watch("viewModel",(function(i){e.initializeVisual()&&t()}))},i.prototype.initializeVisual=function(){var i=this;if(!this.scope.viewModel||!this.scope.viewModel.parentContract)return!1;var r=this.scope.viewModel.parentContract,n=this.scope.viewModel.visual;return n.visualPlugin=this.services.visualPlugin,n.interactivityOptions={isInteractiveLegend:!1,selection:!1},n.type=2===r.visibility?e.visuals.plugins.pivotTable.name:e.visuals.plugins.accessibleTable.name,n.hostServices=e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return i.persistProperties(e)},e.getLocalizedString=function(e){return i.services.localizationService.get(e)},e.getViewMode=function(){return 1},e.loadMoreData=function(){i.runQuery(!1,!1,!0)}})),this.initializeDetailVisualContract(n.type),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerChanged,(function(e,t){t&&i.scope.viewModel.parentContract&&t.affectContainer(i.scope.viewModel.parentContract)&&i.runQuery(!1)})).subscribe(o.filterContainerChanged,(function(e,t){0===t.scope.scopeType&&t.scope.container!==i.scope.viewModel.parentContract||i.runQuery(!1)})),this.runQuery(!0),!0},i.prototype.initializeDetailVisualContract=function(e){this.detailVisualContract={name:this.scope.viewModel.parentContract.name,config:{singleVisual:{visualType:e}},layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:{x:0,y:0,width:0,height:0}}])};var t={};r.setValue(t,a.PropSubTotalsPivotTableRowSubtotals,null,n.boolean(!1)),r.setValue(t,a.PropSubTotalsPivotTableColumnSubtotals,null,n.boolean(!1)),this.detailVisualContract.config.singleVisual.objects=t},i.prototype.persistProperties=function(e){var t=this.detailVisualContract.config.singleVisual,i=_.isArray(e)?{replace:e}:e;this.services.visualAuthoring.persistProperties(i,t,!0)&&this.runQuery(!1,!0)},i.prototype.runQuery=function(e,t,i){var r=this;if(void 0===i&&(i=!1),this.scope.viewModel&&this.scope.viewModel.parentContract){var o=this.scope.viewModel.parentContract,n=this.services.dataSources.get();n&&o.config&&o.config.singleVisual&&(i&&!this.visualDataProxyService.canLoadMore()||(this.spinnerService.startSpinner(),this.services.conceptualSchemaProxy.get(n).then((function(o){var a=r.scope.viewModel.parentContract,s={dataSources:n,schema:o,config:a.config.singleVisual,hostServices:r.queryVisualHostServices,visualQueryGenerator:r.services.visualQueryGenerator,isLoadMore:i,preferCurrentData:t};return r.visualDataProxyService.runQuery(s).then((function(t){return r.onDataChanged(t,e,i)}),(function(t){return r.clearData("Query error",e)}))}),(function(t){return r.clearData("Conceptual schema error",e)})).finally((function(){return r.spinnerService.stopSpinner()}))))}},i.prototype.clearData=function(e,t){var i=this.scope.viewModel,r={dataView:{metadata:{columns:[]},matrix:{rows:{root:{children:[],childIdentityFields:[]},levels:[]},columns:{root:{children:[]},levels:[]},valueSources:[]}},dataViewSource:null};i.visual.dataTransforms={},i.visual.data=r,i.hasData=!1},i.prototype.onDataChanged=function(i,r,o){var n;if(n=i?{dataView:i&&i.dataReaderResult?i.dataReaderResult.dataView:null,dataViewSource:i&&i.dataViewSource?i.dataViewSource:null}:this.scope.viewModel.visual.data){var a=n.dataView;if(a&&!a.matrix){var l="No matrix data view";return void this.clearData(l,r)}var c=s.isSegment(n.dataView);c&&(n.isFirstSegment=c),o&&(a=this.scope.viewModel.visual.data.dataView,e.data.segmentation.DataViewMerger.mergeDataViews(a,n.dataView),n.dataView=a);var u;if(null!=a){var p=this.visualDataProxyService.lastExecutedQuery(),d=s.getDataRolesForVisual(this.scope.viewModel.parentContract,this.services.visualPlugin),h=_.map(d,(function(e){return e.name}));if(u=t.util.MatrixVisualDataViewConverter.generate(a,p.transforms.selects,h,p.transforms.roles&&p.transforms.roles.ordering,this.services.featureSwitchService),!u)return void this.clearData("Failed to generate data view transform actions",r);u.objects=this.detailVisualContract.config.singleVisual.objects}this.scope.viewModel.visual.dataTransforms=u,this.scope.viewModel.visual.data=n,this.scope.viewModel.hasData=!0}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateDetailVisualFilter(r.getCurrentExploration(),r.getCurrentSection(),i.scope.viewModel.parentContract,t,1)}}))},i})();i.DetailVisualController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){var r=this;this.services=i,this.scope=t,this.errorService=this.services.errorService,this.modalDialog=this.errorService.control(),this.scope.acceptTermsOfService=function(){return r.notifyConsentChanged(!0)},this.scope.rejectTermsOfService=function(){return r.notifyConsentChanged(!1)},this.scope.learnMoreLink=e.models.EsriLearnMoreUrl,this.scope.byClickingText=this.services.localizationService.format("EsriConsentDialog_ByClicking",['<a href="https://go.microsoft.com/fwlink/?LinkID=826322" target="_blank">'+this.services.localizationService.get("Terms")+"</a>",'<a href="https://go.microsoft.com/fwlink/?LinkID=826323" target="_blank">'+this.services.localizationService.get("PrivacyPolicy")+"</a>"])}return t.createOptions=function(){return{additionalServices:["errorService","localizationService"]}},t.createAndShowEsriConsentDialog=function(t,i,r,o){var n=t.defer(),a=i.$new(!0);a.errorService=r,a.esriConsentDialogCallback=function(t){n.promise.then((function(){return i.$emit(e.explore.constants.trustedVisualConsentStateChangedEventName)})),n.resolve(t)};var s={dialogName:void 0,isDismissable:!0,scope:a,template:"<esri-consent-dialog></esri-consent-dialog>",dialogCssClass:"esriConsentDialog"};return o.showLegacyWebModalDialog(s),n.promise},t.prototype.notifyConsentChanged=function(e){this.closeDialog(),this.scope.esriConsentDialogCallback(e)},t.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},t})();t.EsriConsentDialogController=i})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.FocusManager,r=(function(){function e(e,t){var i=this;this.services=t,this.scope=e,this.scope.isMasterFormFactor=function(){return 0===t.formFactor.getCurrentLayout()},this.scope.isMobileLayoutAuthoring=function(){return 0!==t.formFactor.getCurrentLayout()&&1===t.viewModeState.getMode()},this.scope.focusVisualContainer=function(){return i.focusVisualContainer()}}return e.createOptions=function(){return{additionalServices:["$element","focus"],scopedDependencies:["formFactor","viewModeState"]}},e.prototype.focusVisualContainer=function(){var e=this;this.services.timeout((function(){i.focusChild(e.services.$element.get(0))}))},e.prototype.$onInit=function(){!this.scope.shouldSetFocus||this.scope.canvasOptions&&this.scope.canvasOptions.disableFocusOnExploreCanvas||this.services.$element.focus(),this.services.focus.startListening()},e.prototype.$onDestroy=function(){
this.services.focus.stopListening()},e})();t.ExplorationController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.constants,r=e.explore.services.events,o=(function(){function t(t,o){var n=this;this.scope=t,this.scope.viewModel.isTabEditable=!1,this.services=o,this.scope.viewModeState=this.services.viewModeState,this.scope.eventBridge=this.services.eventBridge,this.scope.renameSection=function(e){return n.renameSection(e,n.scope.tabIndex)},this.scope.changeSection=function(e){return n.changeSection(e,n.scope.tabIndex)},this.scope.deleteSection=function(e){return n.deleteSection(e,n.scope.tabIndex)},this.scope.selectMenuItem=function(e){return n.selectMenuItem(e)},this.scope.beginEditSection=function(){return n.beginEditSection()},this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionNameChanged,(function(e,t){n.scope.viewModel.selected&&n.scope.$emit(i.renameSectionEvent)})),this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionChanged,(function(e,t){n.scope.viewModel.selected&&n.scope.$emit(i.updateNavButtonEvent)})),this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){n.scope.viewModel.isTabEditable=!1,n.scope.$emit(i.renameSectionEvent)})),this.scope.$watch("isOnlyTab",(function(){n.scope.isOnlyTab?n.scope.dropdownItems=n.scope.viewModel.menuItems.slice(0,2):n.scope.dropdownItems=n.scope.viewModel.menuItems}))}return t.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["eventBridge","viewModeState"]}},t.prototype.beginEditSection=function(){this.scope.viewModel.isTabEditable=!0,this.scope.toggleDraggable(!1),this.scope.$emit(i.renameSectionEvent)},t.prototype.renameSection=function(e,t){if(!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)){var i={sectionNewName:e,sectionIndex:t};this.services.eventBridge.publishToChannel(r.renameSection,i),this.scope.toggleDraggable(!0)}},t.prototype.deleteSection=function(e,t){this.services.eventBridge.publishToChannel(r.deleteSectionInitiated,{sectionIndex:t,supportMinervaDialog:this.scope.supportsMinervaDialog}),e&&e.stopPropagation&&e.stopPropagation()},t.prototype.changeSection=function(e,t){this.scope.viewModel.selected||(this.services.eventBridge.publishBubbling(this.scope,r.switchSection,t),e&&e.stopPropagation&&e.stopPropagation())},t.prototype.selectMenuItem=function(e){switch(e.action){case 0:this.services.eventBridge.publishToChannel(r.duplicateSection,this.scope.tabIndex);break;case 1:this.beginEditSection();break;case 2:this.deleteSection(null,this.scope.tabIndex)}},t})();t.ExplorationNavigationTabController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.overridePosition||e.position;return{height:t.height,width:t.width,top:t.y,left:t.x}}function o(t){return 0!==t.contract.visibility?e.common.constants.MaxSupportedZIndexValue:t.position.z}var n=e.explore.util.CanvasDisplayUtility,a=e.explore.controllers.canvas.CanvasLayoutGrid,s=i.canvas.CanvasLayoutGridStrategy,l=t.util.CanvasVisualsUtility,c=e.common.constants,u=i.canvas.DefaultLayoutStrategy,p=e.explore.components.DotGridComponent,d=i.canvas.DotGridLayoutStrategy,h=e.explore.util.DragDropTypes,v=e.common.directives.DragDropUtils,g=e.explore.constants.ExploreCanvasConstants,f=e.explore.services.events,m=e.visuals.shapes.Rect,y=e.explore.util.VisualContainerUtils;i.CursorClass={Brush:"brush-cursor"};var w={width:0,height:0},S=0,b=0,C=(function(){function C(i,r){var o=this;this.uiScale=C.DefaultNoUiScale,this.isDraggingVisual=!1,this.scope=i,this.model=i.viewModel,this.services=r,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(i),this.scope.displayOptionServices={canvasScale:this.services.canvasScale,viewModeState:this.services.viewModeState,formFactor:this.services.formFactor},this.viewModeState=this.services.viewModeState,this.scope.clearSelection=function(e){o.scope.viewModel&&o.scope.viewModel.preventSelectionClearing||t.util.EventBubblingUtility.handled(e)||(o.services.selection.clearSelection(),o.services.overlayService.hideAllDropdowns(),o.services.clipboard.clearFormatData())},this.showDotGrid=r.settingsService.getShowGridlines(),this.snapToDotGrid=r.settingsService.getSnapToGrid(),this.scope.keyDown=function(e){return o.onKeyDown(e)},this.scope.swipeHorizontally=function(e){return o.onHorizontalSwipe(e)},this.scope.drop=function(e,t){return o.drop(e,t)},this.scope.dropConfig={accept:h.Field+" "+h.VisualContainerThumbnail},this.scope.getExploreCanvasClass=function(){return o.getExploreCanvasClass()},this.scope.shouldDisableZoom=function(){return o.shouldDisableZoom()},this.scope.canPinch=function(){return o.canPinch()},this.scope.canSwipe=function(){return o.canSwipe()},this.scope.isCanvasBackdropVisible=function(){return o.isCanvasBackdropVisible()},this.scope.showBoxGrid=function(){return o.services.formFactor.getCurrentLayoutCapabilities().canShowLayoutGrid()&&1===o.services.formFactor.getCurrentLayout()},this.scope.showDotGrid=function(){return o.showDotGrid&&o.services.formFactor.getCurrentLayoutCapabilities().canShowLayoutGrid()&&0===o.services.formFactor.getCurrentLayout()},this.scope.snapToDotGrid=function(){return o.snapToDotGrid&&0===o.services.formFactor.getCurrentLayout()},this.scope.adjustScaleForLayout=function(e){return o.adjustScaleForLayout(e)},this.scope.shouldDisableScroll=function(){return o.shouldDisableScroll()},this.subscribeToEvents(),this.scope.$watch("size",(function(e){if(e){var i=o.services.canvasScale.getDisplayOption();o.scope.useResponsiveLayout=e.width<=t.constants.ExploreCanvasConstants.ResponsiveLayoutMaxWidthBreakpoint&&o.scope.viewModel&&o.scope.viewModel.contract&&0===i,o.updateSize(),o.updateAndApplyCanvasBackground(),o.services.eventBridge.publishToChannel(f.canvasSizeChangedEvent)}})),this.updateCanvasLayoutSize(),this.updateLayoutStrategy(),this.scope.$watch("viewModel.contract.objects",(function(e){o.updateAndApplyCanvasBackground()}),!0),this.scope.$watchCollection("viewModel.visualContainers",(function(){o.scaleVisualContainersToCanvas(o.uiScale),o.scope.viewModel&&o.services.lazyScoped("loadProgressNotification").then((function(e){e.register(o),e.reset()}))})),this.scope.canvasOptions||(this.scope.canvasOptions={autoLayoutVisualPadding:t.constants.ExploreCanvasConstants.AutoLayoutVisualPadding,scrollbarOffset:t.constants.ExploreCanvasConstants.ScrollbarOffset}),this.services.lazyScoped("loadProgressNotification").then((function(e){e.register(o)}))}return C.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dragDataService","layoutInsertionHelper","$element","featureSwitchService","lazySync","telemetryService","overlayService","dropdownMenuService","promiseFactory","settingsService"],scopedDependencies:["canvasScale","canvasKeyHandler","canvasScale","clipboard","dataSources","eventBridge","explorationNavigation","formFactor","layoutAuthoring","visibility","resourceLoader","selection","undoRedo","viewModeState","visualAuthoring","visualQueryGenerator","lazyScoped"]}},C.prototype.isScrollablePhoneAuthoring=function(){return 0!==this.services.formFactor.getCurrentLayout()&&1===this.services.viewModeState.getMode()},C.prototype.shouldTrackLoadProgress=function(){var e=!1,t=this.scope.viewModel&&this.scope.viewModel.visualContainers.length>0;if(t){var i=this.services.dataSources.get();if(i)for(var r=0,o=this.scope.viewModel.visualContainers;r<o.length;r++){var n=o[r];if(this.services.visualQueryGenerator.shouldExecute(n.contract.config.singleVisual,i)){e=!0;break}}}return e},C.prototype.cancelTracking=function(e){var t=this.scope.viewModel&&this.scope.viewModel.visualContainers.length>0;if(t)for(var i=0,r=this.scope.viewModel.visualContainers;i<r.length;i++){var o=r[i];o.showProgressBar&&(o.errorInfo={details:{message:e,displayableErrorInfo:null},fixableError:0,code:"VisualLoadingCanceled",hideSeeDetails:!0})}this.services.lazyScoped("loadProgressNotification").then((function(e){e.cancelTracking()}))},C.prototype.onHorizontalSwipe=function(e){var i=this.isNextSection(e)?t.constants.explorationNextPageEvent:t.constants.explorationPreviousPageEvent;this.scope.$root.$emit(i,t.services.SectionNavigationAction.Swipe)},C.prototype.subscribeToEvents=function(){var i=this,r=this.services.eventBridge.createChannelSubscriptionManager().subscribe(f.selectionChanged,(function(){return i.onSelectionChanged()})).subscribe(f.explorationLoaded,(function(){return i.onExplorationLoaded()})).subscribe(f.explorationUnloaded,(function(e,t){return i.onExplorationUnloaded()})).subscribe(f.canvasDisplayChanged,(function(e,t){return i.applyFitOption(t)})).subscribe(f.canvasDimensionChanged,(function(e,t){return i.updateCanvasDimension(t)})).subscribe(f.align,(function(e,t){return i.alignVisuals(t)})).subscribe(f.visibilityChanged,(function(){return i.onPopOutModeChanged()})).subscribe(f.clipboardDataUpdated,(function(){return i.onClipboardDataUpdated()})).subscribe(f.formFactorChanged,(function(){return i.onFormFactorChanged()})).subscribe(f.sectionLayoutRemoved,(function(){return i.onSectionLayoutRemoved()})).subscribe(f.deleteVisualContainer,(function(e,t){return i.services.visualAuthoring.deleteVisualContainer(t,i.scope.viewModel)}));this.scope.$watch((function(){return i.services.settingsService.getShowGridlines()}),(function(){return i.onShowGridlinesChanged()})),this.scope.$watch((function(){return i.services.settingsService.getSnapToGrid()}),(function(){return i.onSnapToGridChanged()}));var o=this.scope.$on(e.common.constants.visualCancelLoadEventName,(function(e,t){return i.cancelTracking(t)}));this.scope.$on("$destroy",(function(){o(),r.unsubscribeAll()})),this.scopeEventManager.subscribe(t.constants.TransformElementDragStartEventName,(function(e,t){i.onDragStartPosition={x:t.x,y:t.y,width:t.width,height:t.height},i.isDraggingVisual=!0})).subscribe(t.constants.TransformElementDragMoveEventName,(function(e,t){i.moveSelectedContainersWrapper(e,t)})),this.services.eventBridge.subscribeToBubbling(this.scope,f.removeVisualContainerFromLayout,(function(e,t){i.services.layoutAuthoring.removeLayoutFromVisualContainer(i.scope.viewModel,t),e.stopPropagation&&e.stopPropagation()}))},C.prototype.onSectionLayoutRemoved=function(){var e=this.services.formFactor.getCurrentLayout();_.remove(this.model.visualContainers,(function(t){return!t.contract.layouts.withId(e)})),this.services.eventBridge.publishToChannel(f.canvasChanged)},C.prototype.onShowGridlinesChanged=function(){this.showDotGrid=this.services.settingsService.getShowGridlines(),this.scope.applyFitOption()},C.prototype.onSnapToGridChanged=function(){this.snapToDotGrid=this.services.settingsService.getSnapToGrid(),this.updateLayoutStrategy()},C.prototype.applyFitOption=function(e){this.services.canvasScale.setDisplayOption(e),this.scope.applyFitOption()},C.prototype.moveSelectedContainersWrapper=function(e,t){var i=this,r=this.services.selection.getSelectedElements().length>1&&this.services.formFactor.getCurrentLayoutCapabilities().canMoveMultipleVisuals();r&&(this.isDraggingVisual?(this.isDraggingVisual=!1,this.services.undoRedo.register("MoveSelectedVisualContainers",(function(){i.moveSelectedContainers(e,t)}))):this.moveSelectedContainers(e,t))},C.prototype.alignVisuals=function(e){var t={width:this.model.width,height:this.model.height};this.services.layoutAuthoring.alignSelectedVisuals(e.alignmentType,t,l.getSelectedCanvasVisualContainers(this.scope.viewModel,this.services.selection)),this.scope.$broadcast(c.VisualSelectionOrPositionChangedEventName)},C.prototype.moveSelectedContainers=function(e,t){for(var i=this.onDragStartPosition,r={x:i.x-t.x,y:i.y-t.y,width:0,height:0},o=l.convertFromScaledPosition(r,this.uiScale),n=0,a=this.model.visualContainers;n<a.length;n++){var s=a[n];if(s.isSelected){var c=_.cloneDeep(s.position);c.x-=o.x,c.y-=o.y,this.services.layoutAuthoring.moveVisualContainer(s,c)}}i.x=t.x,i.y=t.y},C.prototype.updateCanvasDimension=function(e){var i=this;this.services.undoRedo.register("UpdateCanvasDimension",(function(){i.scope.viewModel.contract.size=e;var r=i.services.explorationNavigation.getCurrentExploration(),o=i.services.explorationNavigation.getCurrentSection(),a=n.isCortanaPageSize(e);t.PodUtils.setCortanaEnabled(r,o.name,a,i.services.lazySync("linguisticSchemaProxy"))}))},C.prototype.onPopOutModeChanged=function(){this.scope.hasPopOut=!!this.services.visibility.get(),this.updateSizeAndFitOption(),this.updateAndApplyCanvasBackground()},C.prototype.onFormFactorChanged=function(){this.services.overlayService.hideAllDropdowns(),this.updateSizeAndFitOption(),this.updateLayoutStrategy(),this.updateAndApplyCanvasBackground()},C.prototype.updateAndApplyCanvasBackground=function(){if(this.scope.viewModel){var e=this.scope.viewModel.contract.objects;n.updateAndApplyCanvasBackground(this.scope,this.services.$element,e,this.services.featureSwitchService,this.services.resourceLoader,this.services.explorationNavigation,this.services.promiseFactory,this.services.formFactor,this.scope.displayOptionServices.viewModeState,this.services.canvasScale)}},C.prototype.updateSizeAndFitOption=function(){var e=this.scope.viewModel;e&&(this.scope.applyFitOption(),this.updateSize())},C.prototype.updateLayoutStrategy=function(){var e,i=this.services.formFactor.getCurrentLayout(),r=this.services.formFactor.getCurrentLayoutCapabilities(),o=t.viewModels.VisualContainer.getVisualBodyOffset(r);switch(i){case 1:var n=t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout;e=new s({rows:n.rowCount,cols:n.columnCount,rowSpacing:b,colSpacing:S});break;default:if(this.scope&&this.scope.snapToDotGrid&&this.scope.snapToDotGrid()){var a=void 0,l=void 0,c=this.scope.dotGridViewModel,h=this.scope.canvasLayoutSize;c?(a=c.layoutX,l=c.layoutY):(a=p.getLayoutForScreen(this.uiScale.x*h.width,h.width),l=p.getLayoutForScreen(this.uiScale.y*h.height,h.height));var v={layoutX:a,layoutY:l,offset:o,limits:{left:0,top:0,width:h.width,height:h.height}};e=new d(v)}else e=new u(o)}this.scope.layoutStrategy=e,this.updateGridLayout()},C.prototype.adjustScaleForLayout=function(e){return this.scope.showDotGrid()?p.adjustScaleForGrid(e,this.scope.canvasLayoutSize):e},C.prototype.updateGridLayout=function(){this.model&&(this.updateBoxGridLayout(),this.updateDotGridLayout())},C.prototype.updateDotGridLayout=function(){var e=this.scope.canvasLayoutSize,t=this.scope.dotGridViewModel,i=!t,r=p.getLayoutForScreen(this.uiScale.x*e.width,e.width),o=t&&t.layoutX;i||(i=!p.sameLayout(r,o));var n=p.getLayoutForScreen(this.uiScale.y*e.height,e.height),a=t&&t.layoutY;i||(i=!p.sameLayout(n,a)),i&&(this.scope.dotGridViewModel={layoutX:r,layoutY:n})},C.prototype.updateBoxGridLayout=function(){var e,i=t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout;switch(this.services.formFactor.getCurrentLayout()){case 1:var r={rows:i.rowCount,cols:i.columnCount,rowSpacing:b,colSpacing:S},o=a.getCellSize({width:this.model.width,height:this.model.height},r);e={columnCount:i.columnCount,rowCount:i.rowCount,layout:{horizontal:{margin:S,gutter:S,size:o.width},vertical:{margin:b,gutter:b,size:o.height}}};break;default:e=void 0}this.scope.boxGridLayout=e},C.prototype.autoLayoutVisualVCHeader=function(){return n.getAutoLayoutVisualVCHeader(this.services.formFactor)},C.prototype.updateSize=function(){var e=this.scope.size;if(this.model=this.scope.viewModel,e&&this.model){var t=this.services.canvasScale.getDisplayOption();if(0===t){var i=this.services.viewModeState.getConfig(),r=i.displayOptions.hideTileMenu?e.height:e.height-this.autoLayoutVisualVCHeader(),o=e.width-2*g.ExploreCanvasPadding;this.uiScale={x:o/this.model.width,y:r/this.model.height}}else{var n=this.services.canvasScale.getCanvasScaleFactor();this.uiScale={x:n,y:n}}this.scaleVisualContainersToCanvas(this.uiScale),this.updateCanvasLayoutSize(),this.updateLayoutStrategy()}},C.prototype.updateCanvasLayoutSize=function(){var e=this.scope.viewModel;e?this.scope.canvasLayoutSize={width:e.width,height:e.height}:this.scope.canvasLayoutSize=w,this.updateGridLayout()},C.prototype.scaleVisualContainersToCanvas=function(e){var i=this;if(this.model=this.scope.viewModel,this.model){for(var r=this.model.visualContainers,o=this.services.visibility.get(),n=this.services.canvasScale.getDisplayOption(),a=this.scope.viewModel.contract.size&&3!==n&&0!==n,s=0,l=r;s<l.length;s++){var c=l[s];if(c.uiScale=e,c.enableVisualScaling=a,!c.isPositioned){var u=this.getEmptyRawCanvasSpaces();u.z=r.length,this.services.layoutAuthoring.moveVisualContainer(c,u)}o?this.setVisualContainerSizeForPopOutMode(c):this.scope.useResponsiveLayout||(c.overridePosition=null,c.updateViewState()),this.scope.canvasOptions.disableDeferredRendering&&(c.allowDeferredRendering=!1)}if(this.scope.useResponsiveLayout&&!o)for(var p=0,d=_.sortBy(r,(function(e){return e.position.y*i.model.width+e.position.x})),h=0,v=d;h<v.length;h++){var c=v[h],g=c.getScaledPosition();p+=20,c.overridePosition={width:this.scope.size.width-2*t.constants.ExploreCanvasConstants.AutoLayoutVisualSkittlesRightPadding,height:g.height,x:t.constants.ExploreCanvasConstants.AutoLayoutVisualSkittlesRightPadding,y:p},p+=Math.round(g.height),c.updateViewState()}}},C.prototype.setVisualContainerSizeForPopOutMode=function(e){if(e.isPoppedOut){var i=this.services.formFactor.getCurrentLayoutCapabilities(),r=t.viewModels.VisualContainer.getVisualBodyOffset(i),o=this.scope.size.height,n=this.scope.size.width,a=this.services.canvasScale.getDisplayOption();if(0!==a){var s=this.services.canvasScale.getCanvasScaleFactor();o=this.scope.viewModel.height*s-r.height,n=this.scope.viewModel.width*s-r.width}e.overridePosition={width:n,height:o,x:-r.left,y:-r.top},e.updateViewState()}},C.prototype.onSelectionChanged=function(){this.scope.canvasOptions.disableFocusOnExploreCanvas||this.getFocusOnClearSelection(),this.updateZIndexOnSelectionChanged()},C.prototype.onExplorationLoaded=function(){this.updateAndApplyCanvasBackground(),this.applyFitToPageIfAny()},C.prototype.applyFitToPageIfAny=function(){var e=this,t=jsCommon.QueryStringUtil.getQueryStringValue("loadFitToPage");t&&this.services.timeout((function(){e.applyFitOption(1)}),0,!1)},C.prototype.onExplorationUnloaded=function(){this.services.dropdownMenuService.hideMenu(),this.scope.suspendSizeUpdates&&this.scope.suspendSizeUpdates()},C.prototype.isCanvasBackdropVisible=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canShowCanvasBackdrop()},C.prototype.getFocusOnClearSelection=function(){var e=this.services.selection;_.isEmpty(e.getSelectedElements())&&(this.scope.hasFocus=!0)},C.prototype.updateZIndexOnSelectionChanged=function(){this.scope.viewModel&&l.moveSelectedItemToFront(this.scope.viewModel.visualContainers,this.services.selection)},C.prototype.getEmptyRawCanvasSpaces=function(){if(this.scope.size){var e={x:0,y:0,width:this.model.width,height:this.model.height},i=_.map(this.model.visualContainers,(function(e){var t=e.position;return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}})),r=this.services.layoutInsertionHelper.getEmptySpaces(e,i);if(r.length>0){var o=r[0];o.height=Math.min(o.height,t.constants.ExploreCanvasConstants.AutoLayoutMaxSpaceHeight),o.width=Math.min(o.width,t.constants.ExploreCanvasConstants.AutoLayoutMaxSpaceWidth);var a=this.scope.canvasOptions.autoLayoutVisualPadding,s=this.autoLayoutVisualVCHeader();return o.x+=a,o.y+=s,o.width-=2*a,o.height-=2*a,o}}return n.DefaultVisualPosition},C.prototype.drop=function(e,i){var r=this,o=this.services.dragDataService.getDragContext();if(o){var a={left:0,top:0};if(e.target){var s=$(e.target).find(n.VisualContainerHostSelector.selector);s&&(a=s.offset())}var c,u=e.pageX-a.left,p=e.pageY-a.top,d=this.services.canvasScale.getDisplayOption();if(0===d&&(c=this.uiScale),o.field){var h=this.services.formFactor.getCurrentLayoutCapabilities(),g=t.viewModels.VisualContainer.getVisualBodyOffset(h),f=u,m=p;this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(m-=g.top);var y=c;if(!y){var w=this.services.canvasScale.getCanvasScaleFactor();y={x:w,y:w}}var S=f/y.x,b=m/y.y;if(v.tryFindChildDropTarget(i.draggable,(function(){return r.getVisualContainerFromCoordinate(S,b)})))return}var C=this.scope.layout.getDropPosition(u,p,c);if(C){var x=n.rectToVisualPosition(C);if(o.field)x.z=l.getZIndexForNewVisual(this.scope.viewModel),this.addVisual(o.field,x);else if(o.source){var M=o.source;this.services.layoutAuthoring.addLayoutToVisualContainer(this.scope.viewModel,M,x)}}}},C.prototype.getVisualContainerFromCoordinate=function(e,t){var i={x:e,y:t},n=this.scope.viewModel.visualContainers,a=_.filter(n,(function(e){return m.containsPoint(r(e),i)}));if(!_.isEmpty(a)){var s=_.max(a,(function(e){return o(e)}));return s.contract}},C.prototype.addVisual=function(t,i){var r=this,o=this.services.dataSources.get();o&&this.services.visualAuthoring.addVisualContainer({expr:t,dataSources:o,allowAggregate:!0},this.scope.viewModel,i).then((function(t){r.services.telemetryService.logEvent(e.telemetry.EXCreateVisual,e.telemetry.HowVisualWasCreated.DraggedToCanvas,y.getVisualType(t))}))},C.prototype.onKeyDown=function(e){return this.services.canvasKeyHandler.onKeyDown(e,this.scope.viewModel)},C.prototype.isNextSection=function(e){var t=1===e.direction;return t},C.prototype.onClipboardDataUpdated=function(){this.updateCanvasCursor()},C.prototype.updateCanvasCursor=function(){var e=this.services.clipboard.canPasteFormat();this.setCursorClass(e?i.CursorClass.Brush:void 0)},C.prototype.setCursorClass=function(e){this.scope.customCursorClass=e},C.prototype.shouldDisableZoom=function(){return this.viewModeState.getConfig().touchOptions.disableTouchZoom},C.prototype.getExploreCanvasClass=function(){var e=[];return this.scope.disableAnimations&&e.push("disableAnimations"),this.scope.useResponsiveLayout&&e.push("responsive"),this.services.visibility.get(4)?e.push("hasSpotlight"):this.services.visibility.get()&&e.push("popOut"),this.scope.customCursorClass&&e.push(this.scope.customCursorClass),this.shouldDisableZoom()&&e.push("disableTouchZoom"),this.isScrollablePhoneAuthoring()&&e.push("scrollablePhoneAuthoring"),e.join(" ")},C.prototype.canSwipe=function(){var e=this.services.viewModeState.getConfig();return e.touchOptions.isCanvasSwipeable},C.prototype.canPinch=function(){return!(this.viewModeState&&this.viewModeState.getConfig().touchOptions.disableCanvasPinch)},C.prototype.shouldDisableScroll=function(){return this.viewModeState.getConfig().touchOptions.disableCanvasScrollOnSelectedVisual},C.DefaultNoUiScale={x:1,y:1},C})();i.ExploreCanvasController=C})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.models.ArtifactType,o=e.common.models.CollapsiblePaneExpandedWidth,n=(e.common.constants,e.explore.services.events),a=t.viewModels.ExplorationAppBarViewModelFactory,s=e.common.dialogs.FeatureNotSupportedDialogBuilder,l=e.explore.services.selectionUtils,c=jsCommon.StringExtensions,u=(function(){function i(t,i){var r=this;this.services=i,this.scope=t,this.viewModeState=this.services.viewModeState,this.shapeMenuActions=a.createShapeMenuActions(this.services.localizationService),this.alignActions=a.createAlignmentMenuActions(this.services.localizationService),this.distributeActions=a.createDistributeMenuActions(this.services.localizationService),this.services.featureSwitchService.featureSwitches.pauseQueriesEnabled&&(this.canPause=!0),this.scope.$on("destroy",(function(){r.modalDialogPromise&&r.modalDialogPromise.pending&&r.modalDialogPromise.reject("explorationAppBarController destroyed")})),this.scope.$watch((function(){return r.services.viewModeState.getMode()}),(function(e){r.onViewModeChanged(e)}));var o=this.services.eventBridge.createChannelSubscriptionManager().subscribe(n.visibilityChanged,(function(){r.isPopOutMode=!!r.services.visibility.get()})).subscribe(n.canvasChanged,(function(){var e=r.services.explorationNavigation.getCurrentSection();r.isTransientPage=e.transient})),s=this.services.rootScope.$on(e.common.constants.onReportChangedEventName,(function(e,t){r.pinnedToReportPage&&(r.pinReportPage(),r.pinnedToReportPage=!1)}));this.scope.$on("$destroy",(function(){o.unsubscribeAll(),s()}))}return i.createOptions=function(){return{additionalServices:["applicationOptions","activeGroupId","dropdown","localizationService","modalDialogService","embedProxy","embed","explorationSerializer","featureSwitchService","errorService","checkUnsavedService","reportTileService","telemetryService","$window","analyzeInExcel","powerBIDesktopLauncher","overlayService","auditing","downloadReport","subscription","userInfo","settingsService","taskPaneSliderService","emailSubscriptionService","lazy"],scopedDependencies:["canvasScale","eventBridge","viewModeState","explorationNavigation","explorationCapabilities","visibility","drill","selection","visualAuthoring"]}},i.prototype.onViewModeChanged=function(e){var t=1===e;t?this.scope.$emit("EditMode"):t||(this.scope.$emit("ViewMode"),this.viewModeState.updateConfig((function(e){e.showRelationships&&(e.showRelationships=!1)})))},i.prototype.getMoreOptionsMenuActions=function(){return a.createReportMoreOptionsMenuItems(this.services.localizationService,this.services.analyzeInExcel,this.services.featureSwitchService,this.viewModel.reportPermission,this.canGenerateQR())},i.prototype.isSnapshotAllowed=function(){var e=this.services.featureSwitchService.featureSwitches,t=e.snapshotEmbedEnabled||e.anonymousEmbeddingEnabled,i=this.viewModel,r=i&&i.canEdit&&i.canWrite,o=this.viewModel.exploration,n=o&&o.contract,a=n&&void 0!==n.reportId,s=n&&n.modelExtensions,l=i.datasetModel,c=l&&l.contract,u=l&&l.cloudRlsEnabled,p=c&&c.originalModelId,d=c&&c.onPremModelConnectionString,h=this.services.featureSwitchService.featureSwitches.publishToWebEnabled,v=this.services.activeGroupId.isReadOnly,g=this.services.explorationCapabilities.getCapabilities().disableSnapshot,f=this.isUsageMetricsReport();return t&&!v&&r&&a&&!s&&!p&&!d&&h&&!u&&!g&&!f},i.prototype.isSharePointEmbedAllowed=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=this.services.featureSwitchService.featureSwitches.sharePointEmbedEnabled&&!e.disableSharePointEmbed,i=this.services.userInfo.isPremiumUser,r=this.viewModel.exploration,o=r&&r.contract&&r.contract.report&&void 0!==r.contract.report.objectId;return t&&i&&o&&!this.isUsageMetricsReport()},i.prototype.isExportToPowerPointAllowed=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.services.explorationCapabilities.getCapabilities(),i=e.exportReportToPowerPointEnabled&&e.exportToPowerPointEnabled&&!t.disableExportToPowerPoint,r=this.viewModel.exploration,o=r&&r.contract&&void 0!==r.contract.reportId;return i&&o&&!this.isUsageMetricsReport()},i.prototype.canDuplicatePage=function(){var e=this.viewModeState.getMode();return 1===e&&this.viewModel.canWrite&&!this.isPopOutMode&&!this.isTransientPage},i.prototype.canPinPage=function(){var e=this.viewModel;return e&&e.canWrite&&e.exploration&&e.exploration.contract.reportId&&!this.isTransientPage},i.prototype.pinPageDisabled=function(){var e=this.viewModel;return e&&!e.canCopy&&!e.canEdit},i.prototype.showPinPage=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=!e.disablePin;return t},i.prototype.canGenerateQR=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=!e.disableQRGeneration;return t&&this.viewModel&&this.viewModel.exploration&&void 0!==this.viewModel.exploration.contract.reportId&&!this.isUsageMetricsReport()},i.prototype.getFileMenuActions=function(){for(var e=this.createFileMenuActions(),t=0,i=e;t<i.length;t++){var r=i[t];if(2===r.action&&(r.show=this.isSnapshotAllowed()),3===r.action&&(r.show=this.isSharePointEmbedAllowed()),7===r.action&&(r.show=this.isExportToPowerPointAllowed()),1===r.action){var o=this.viewModel.datasetModel&&this.viewModel.datasetModel.contract&&this.viewModel.datasetModel.contract.contentProviderId;if(o){var n=this.services.localizationService,a=void 0;103===o?a=n.get("ReportAppBar_DashboardsKeyword"):102===o&&(a=n.get("ReportAppBar_ReportsKeyword")),a&&(r.description=n.format("ReportAppBar_SaveAsDescriptionForUsageMetrics",[a]))}}}return e},i.prototype.onEmbed=function(){var i=this.scope.$new(!0),r=this.viewModel.exploration.contract.reportId,o=this.services.explorationNavigation.getCurrentSection(),n=this.viewModel.displayName+" - "+o.displayName,a={reportSections:[o.id]},s={name:n,reportId:r,culture:e.common.cultureInfo,size:{height:this.viewModel.exploration.contract.height,width:this.viewModel.exploration.contract.width},version:e.build,metadata:JSON.stringify(a)},l=this.services.embedProxy.getLiveEmbedsForReport(r);i.viewModel=t.viewModels.ViewModelFactory.createEmbedModalDialog(this.services.localizationService,this.services.embed,this.viewModel.exploration,s,l,this.viewModel.exploration.contract.sections);var c=_.filter(i.viewModel.embedTab.sections,(function(e){return e.contract.name===o.name}))[0];i.viewModel.embedTab.selectedSection=c;var u={containerCssClass:"small embedContainer",dialogCssClass:"embedDialog",dialogName:null,template:"<embed-modal-dialog></embed-modal-dialog>",scope:i};this.services.modalDialogService.showLegacyWebModalDialog(u)},i.prototype.onSharepointEmbed=function(){var i=this.scope.$new(!0),r={name:this.viewModel.displayName,reportId:null,culture:e.common.cultureInfo,size:{height:this.viewModel.exploration.contract.height,width:this.viewModel.exploration.contract.width},version:e.build,metadata:null};i.viewModel=t.viewModels.ViewModelFactory.createSharepointEmbedModalDialog(this.viewModel.exploration,r);var o={containerCssClass:"embedContainer",dialogCssClass:"spEmbedDialog",dialogName:null,template:"<embed-modal-dialog></embed-modal-dialog>",scope:i};this.services.modalDialogService.showLegacyWebModalDialog(o)},i.prototype.insertTextbox=function(){this.services.eventBridge.publishToChannel(n.createTextbox)},i.prototype.showSwitchMode=function(){return!this.services.explorationCapabilities.getCapabilities().disableSwitchMode},i.prototype.showReportMoreOptionsMenu=function(){return!this.services.explorationCapabilities.getCapabilities().disableMoreOptions&&!!this.viewModel.reportPermission},i.prototype.fileMenuActionSelected=function(e){if(!e.disabled)switch(e.action){case 0:this.save();break;case 1:this.saveAs();break;case 2:this.onEmbed();break;case 3:this.onSharepointEmbed();break;case 5:this.print();break;case 6:this.showDiagnosticInfo();break;case 7:this.exportToPowerPoint();break;case 8:this.downloadReport()}},i.prototype.createFileMenuActions=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.viewModeState.getMode(),i=this.services.explorationCapabilities.getCapabilities(),r={localizationService:this.services.localizationService,showSave:!i.disableSave&&1===t,showSaveAs:!i.disableSaveAs&&this.viewModel&&this.viewModel.canEdit,showPrint:e.printingEnabled!==!1&&!i.disablePrint,showEmbed:!1,showSharepointEmbed:!1,showPowerPoint:!1,showDiagnostics:this.services.applicationOptions.diagnostics,showDownloadReport:e.downloadReportEnabled&&e.exportDataEnabled&&this.viewModel&&this.viewModel.canEdit&&!i.disableDownload,canDownloadReport:this.viewModel&&this.viewModel.isReportFromPbix};return a.createFileMenuActions(r)},i.prototype.showDiagnosticInfo=function(){if(this.viewModel.exploration&&this.viewModel.exploration.contract){var e=this.services.rootScope.$new(),t=this.services.explorationSerializer.serializeExploration(this.viewModel.exploration.contract),i=c.stringifyAsPrettyJSON(t),r={dialogName:"",isDismissable:!0,scope:e,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"monotype",notificationText:i};this.services.modalDialogService.showLegacyWebModalDialog(r);
}},i.prototype.alignActionSelected=function(e){switch(e.action){case 27:this.align(0);break;case 28:this.align(1);break;case 29:this.align(2);break;case 30:this.align(3);break;case 31:this.align(4);break;case 32:this.align(5)}},i.prototype.distributeActionSelected=function(e){switch(e.action){case 33:this.align(6);break;case 34:this.align(7)}},i.prototype.align=function(e){var t={alignmentType:e};this.services.eventBridge.publishToChannel(n.align,t)},i.prototype.print=function(){window.print(),this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsPrint,e.telemetry.PrintType.Report);var t=this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.reportId;this.services.auditing.auditEvent(t,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.printReport)},i.prototype.save=function(){var e={overrideSaveRouting:this.services.explorationCapabilities.getCapabilities().overrideSaveRouting};this.services.eventBridge.publishBubbling(this.scope,n.saveExploration,e)},i.prototype.saveAs=function(){var e={overrideSaveRouting:this.services.explorationCapabilities.getCapabilities().overrideSaveRouting,saveAsWithoutPrompt:this.isUsageMetricsReport()};this.services.eventBridge.publishBubbling(this.scope,n.saveAsExploration,e)},i.prototype.refresh=function(){if(this.viewModel.exploration&&this.viewModel.exploration.contract){var t=this.viewModel.exploration.contract;t.report&&this.services.telemetryService.logEvent(e.telemetry.EXRefreshReport,t.report.objectId,t.activeSectionIndex)}this.services.eventBridge.publishBubbling(this.scope,n.refreshExploration)},i.prototype.edit=function(){this.services.eventBridge.publishToChannel(n.requestViewModeChange,1)},i.prototype.stopEditing=function(){this.services.eventBridge.publishToChannel(n.requestViewModeChange,0)},i.prototype.navigateBack=function(){this.services.$window.history.back()},i.prototype.exportToPowerPoint=function(){this.services.eventBridge.publishBubbling(this.scope,n.exportToPowerPoint)},i.prototype.viewMenuActionSelected=function(e){if(null!=e.action)if(13===e.action)this.services.settingsService.setShowGridlines(!this.services.settingsService.getShowGridlines());else if(14===e.action)this.services.settingsService.setSnapToGrid(!this.services.settingsService.getSnapToGrid());else if(15===e.action)this.viewModel.bookmarksPane.isPaneVisible=!e.checked;else if(16===e.action)this.viewModel.canvasItemsPane.isPaneVisible=!e.checked;else{var t=void 0;switch(e.action){case 9:t=0;break;case 10:t=3;break;case 11:t=2;break;case 12:t=1}this.services.eventBridge.publishToChannel(n.canvasDisplayChanged,t)}},i.prototype.editReportMenuActionSelected=function(e){if(this.services.overlayService.hideAllDropdowns(),!e.disabled)switch(e.action){case 17:this.edit();break;case 18:var t=this.services.activeGroupId.activeGroupObjectId,i=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report&&this.viewModel.exploration.contract.report.objectId;t&&i&&this.services.powerBIDesktopLauncher(i,t)}},i.prototype.isEditInDesktopEnabled=function(){return this.services.featureSwitchService.featureSwitches.editInDesktopEnabled},i.prototype.shapeMenuActionSelected=function(e){this.services.eventBridge.publishToChannel(n.createBasicShape,{shapeType:e.param})},i.prototype.togglePlayPause=function(){this.services.eventBridge.publishBubbling(this.scope,n.pauseQueriesChanged)},i.prototype.showRelatedContentPane=function(){var e={id:this.viewModel.exploration.contract.report.objectId,artifactType:r.Report,displayName:this.viewModel.exploration.contract.report.displayName,readOnly:this.viewModel&&!this.viewModel.canCopy&&!this.viewModel.canEdit};this.services.taskPaneSliderService.expandPane(17,o.Default,e)},i.prototype.showSendInstantEmailPane=function(){var e=this;this.services.lazy("instantEmail").then((function(t){var i=e.services.explorationNavigation,r=i.getCurrentExploration();e.expandInstantEmailPane(t,r,r.report,i.getCurrentSection())}))},i.prototype.expandInstantEmailPane=function(e,t,i,r){e.expandPaneForInstantReportEmail({currentSection:r,report:i,sections:t.sections,modelId:t.dataSources[0].id})},i.prototype.showSubscriptionPane=function(){var t=this,i=this.services.explorationNavigation,r=this.viewModel.datasetModel;if(r.getPermissions()===e.common.contracts.Permissions.CopyOnWrite&&!this.isEmailSubscriptionForAppsEnabled())return void(this.modalDialogPromise=new s(this.services.modalDialogService).show("ModalDialog_EmailSubscriptionUnSupportedContentPackTitle",this.services.featureSwitchService.featureSwitches.appsEnabled?"ModalDialog_EmailSubscriptionUnSupportedContentPackOrAppMessage":"ModalDialog_EmailSubscriptionUnSupportedContentPackMessage","https://go.microsoft.com/fwlink/?linkid=836808"));var o=i.getCurrentExploration();o.report?this.services.subscription.expandPaneForReportSubscription({currentSection:i.getCurrentSection(),report:o.report,sections:o.sections,modelId:o.dataSources[0].id}):i.getCurrentExplorationAsync().then((function(e){t.services.subscription.expandPaneForReportSubscription({currentSection:i.getCurrentSection(),report:e.report,sections:o.sections,modelId:o.dataSources[0].id})}))},i.prototype.isEmailSubscriptionEnabled=function(){return!(1===this.viewModeState.getMode()||!this.services.featureSwitchService.featureSwitches.emailSubscriptionEnabled)&&!this.isUsageMetricsReport()&&this.services.emailSubscriptionService.supportsEmailSubscription},i.prototype.isInstantEmailEnabled=function(){return this.services.featureSwitchService.featureSwitches.instantEmail},i.prototype.isViewRelatedContentEnabled=function(){var e=this.services.explorationCapabilities.getCapabilities(),t=!e.disableViewRelatedContent;return 1!==this.viewModeState.getMode()&&t&&!this.isUsageMetricsReport()},i.prototype.canOpenEditReport=function(){return this.showSwitchMode()&&!this.viewModeState.getMode()&&this.viewModel.canEdit&&!this.isEditInDesktopEnabled()&&!this.isUsageMetricsReport()},i.prototype.showEditReportDisabled=function(){return 0===this.viewModeState.getMode()&&(this.viewModel.canEdit===!1||this.viewModel.canCopy)&&!this.isUsageMetricsReport()},i.prototype.canOpenUsageMetricsReport=function(){return this.services.featureSwitchService.featureSwitches.usageMetricsEnabled&&this.services.userInfo.isPremiumUser&&this.viewModel.canEdit&&this.viewModel.exploration&&this.viewModel.exploration.contract&&_.isNumber(this.viewModel.exploration.contract.id)&&!this.isUsageMetricsReport()&&0===this.viewModeState.getMode()},i.prototype.openUsageMetricsReport=function(){var t=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report;this.services.rootScope.$emit(e.common.constants.openUsageMetricsReport,t,this.services.activeGroupId.activeGroupObjectId)},i.prototype.showPinReportPageDialog=function(){var t=this;if(this.viewModel.canCopy)return void this.scope.$emit(e.common.constants.onReportPersonalizedEventName,this.viewModel.exploration.contract.reportId);if(1===this.viewModeState.getMode()&&this.services.checkUnsavedService.userHasUnsavedWork){var i=this.services.errorService.control(),r=this.services.localizationService.get("PinLiveReport_UnsavedTitle"),o=this.services.localizationService.get("PinLiveReport_UnsavedChangesMessage"),n=[new InJs.ModalDialogAction(this.services.localizationService.get("PinLiveReport_SaveAndPin"),function(e,r){t.save(),i.hideDialog(),t.pinnedToReportPage=!0}),new InJs.ModalDialogAction(this.services.localizationService.get("PinLiveReport_GoBack"),function(e,t){i.hideDialog()})];i.showPrompt(r,o,n,!0)}else this.pinReportPage()},i.prototype.pinReportPage=function(){var t=this.services.explorationNavigation.getCurrentSection();if(t){var i={exploration:this.viewModel.exploration,section:t,reportId:this.viewModel.exploration.contract.reportId,modelId:this.viewModel.datasetModel.id,packageId:this.viewModel.datasetModel.packageId};this.services.rootScope.$emit(e.common.constants.pinReportPageToDashboard,i)}},i.prototype.duplicateReportPage=function(){var e=this.services.explorationNavigation.getCurrentSection(),i=t.SectionUtils.findSectionIndexForSection(this.viewModel.exploration.contract,e);this.services.eventBridge.publishToChannel(n.duplicateSection,i)},i.prototype.showDatasetErrorDetails=function(){if(this.viewModel.datasetModel){var e=this.services.localizationService;this.services.errorService.error(e.get("InternalSystemErrorMessage"),"ExplorationAppBar_DatasetError",{title:e.get("InternalSystemErrorTitle")})}},i.prototype.toggleVisualInteractions=function(){this.services.eventBridge.publishToChannel(n.visualRelationshipsModeChanged)},i.prototype.reportMoreOptionsMenuSelected=function(t){switch(t.action){case 35:this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsAnalyzeInExcel,"Report More Options Menu",this.viewModel.datasetModel.contentProviderId,this.viewModel.datasetModel.contract.modelFeatures,this.viewModel.datasetModel.dbName),this.services.analyzeInExcel.startAnalyzeInExcel(this.viewModel.datasetModel);var i=this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.reportId;this.services.auditing.auditEvent(i,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.analyzeInExcel);break;case 37:this.services.eventBridge.publishBubbling(this.scope,n.generateReportQR);break;case 36:this.services.eventBridge.publishBubbling(this.scope,n.exportAsImage)}},i.prototype.exploreMenuActionSelected=function(e){if(!e.disabled)switch(e.action){case 19:this.toggleSeeDataMode();break;case 20:this.drillDownLevel(3);break;case 21:this.drillDownLevel(2);break;case 22:this.drillUp();break;case 23:this.setDrillMode(1);break;case 24:this.setDrillMode(3);break;case 25:this.setDrillMode(2)}},i.prototype.isUsageMetricsReport=function(){return this.viewModel.options&&this.viewModel.options.isUsageMetricsReport},i.prototype.isEmailSubscriptionForAppsEnabled=function(){var e=this.services.featureSwitchService.featureSwitches;return e.appEmailSubscription&&e.appPublishDiffing},i.prototype.getExploreMenuActions=function(){for(var e=a.createExploreMenuActions(this.services.localizationService),t=this.getSelectedVisual(),i=this.services.explorationCapabilities.getCapabilities().disableExploreActions,r=0,o=e;r<o.length;r++){var n=o[r];switch(n.action){case 19:var s=this.services.visibility.get();n.selected=s&&this.services.visibility.isSeeDataMode(s.visibility),n.disabled=i||!this.services.drill.canSeeData(t);break;case 20:n.disabled=i||!this.services.drill.canDrillByDirection(t,4);break;case 21:n.disabled=i||!this.services.drill.canDrillByDirection(t,2);break;case 23:var l=this.services.drill.isDrillModeEnabled(t,1);n.selected=l;var c=this.services.drill.canDrillByDirection(t,4),u=this.services.drill.canDrillByDirection(t,1);n.disabled=i||!c&&!u;break;case 24:var p=this.services.drill.isDrillModeEnabled(t,3);n.selected=p,n.disabled=i||!this.services.drill.canDrillthrough(t);break;case 22:n.disabled=i||!this.services.drill.canDrillByDirection(t,1);break;case 25:var d=this.services.drill.isDrillModeEnabled(t,2);n.selected=i||d,n.disabled=i||!this.services.drill.canDrillToDetails(t)}}return e},i.prototype.toggleSeeDataMode=function(){var e=this.services.visibility.get()||this.getSelectedVisual();if(e){var t=e.visibility;2===t||8===t?this.services.visibility.clear():this.services.visibility.set(e,2)}},i.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(null,this.getSelectedVisual())},i.prototype.drillDownLevel=function(e){this.services.visualAuthoring.drillDownLevel(null,this.getSelectedVisual(),e)},i.prototype.setDrillMode=function(e){var t=this.getSelectedVisual();if(t){var i=t.drillMode,r=i===e?0:e;this.services.drill.setDrillMode(t,r)}},i.prototype.getFileMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getFileMenuActions(),menuActionSelected:this.fileMenuActionSelected,templateName:"appBarFileMenu.html"}},i.prototype.getViewMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getViewMenuActions(),menuActionSelected:this.viewMenuActionSelected,templateName:"appBarViewMenu.html"}},i.prototype.getEditReportMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getEditReportMenuActions(),menuActionSelected:this.editReportMenuActionSelected,templateName:"appBarEditReportMenu.html"}},i.prototype.getExploreMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,disableAnimation:!0,preferLeft:!1},menuActions:this.getExploreMenuActions(),menuActionSelected:this.exploreMenuActionSelected,templateName:"appBarExploreMenu.html"}},i.prototype.getMoreOptionsMenuProperties=function(e){return{displayOptions:{anchorElement:e,blurNeeded:!1,preferLeft:!0},menuActions:this.getMoreOptionsMenuActions(),menuActionSelected:this.reportMoreOptionsMenuSelected,templateName:"appBarMoreOptionsMenu.html"}},i.prototype.showMenu=function(e,t){var i=this,r=this.services.dropdown,o=function(t,i){t(i),r.hideAll(),e.stopPropagation()},n=t.bind(this)($(e.currentTarget)),a={menuActionSelected:function(e){return o(n.menuActionSelected.bind(i),e)},getMenuActions:function(){return n.menuActions},getMode:function(){return i.viewModeState.getMode()}};r.showMenu(a,n.templateName,n.displayOptions)},i.prototype.getSelectedVisual=function(){return l.getSelectedVisual(this.services.selection)},i.prototype.getDisplayOption=function(){return this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.exploreCanvas&&this.viewModel.exploration.exploreCanvas.contract&&this.viewModel.exploration.exploreCanvas.contract.size&&this.viewModel.exploration.exploreCanvas.contract.size.displayOption},i.prototype.getViewMenuActions=function(){for(var e=this.getDisplayOption(),t=this.services.explorationNavigation.getCurrentExploration(),i=t&&!_.isEmpty(t.bookmarks),r=a.createViewMenuActions(this.services.localizationService,this.services.settingsService,this.services.featureSwitchService,1===this.viewModeState.getMode(),this.getDisplayOption(),i),o=0,n=r;o<n.length;o++){var s=n[o];9===s.action&&(s.selected=0===e),12===s.action&&(s.selected=1===e),11===s.action&&(s.selected=2===e),10===s.action&&(s.selected=3===e),13===s.action&&(s.checked=this.services.settingsService.getShowGridlines()),14===s.action&&(s.checked=this.services.settingsService.getSnapToGrid()),15===s.action&&(s.checked=this.viewModel.bookmarksPane.isPaneVisible),16===s.action&&(s.checked=this.viewModel.canvasItemsPane.isPaneVisible)}return r},i.prototype.getEditReportMenuActions=function(){return a.createEditReportMenuActions(this.services.localizationService,this.viewModel&&this.viewModel.isReportFromPbix)},i.prototype.downloadReport=function(){var e=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report;if(e){var t=e.objectId,i=e.displayName;if(t&&i){var r={id:t,filename:c.normalizeFileName(i)};this.services.downloadReport.downloadReport(r)}}},i})();i.ExplorationAppBarController=u})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.services.SectionNavigationAction,n=(function(){function i(t,i){var o=this;this.scope=t,this.services=i,this.services.eventBridge.setBubblingScope(t).subscribe(r.switchSection,(function(e,t){return o.onSwitchSection(e,t)})).subscribe(r.reorderSection,(function(e,t){return o.onReorderSection(e,t)})).subscribe(r.visualConversion,(function(e,t){return o.onVisualConversion(t)})).subscribe(r.undo,(function(e,t){return i.undoRedo.undo()})).subscribe(r.redo,(function(e,t){return i.undoRedo.redo()}));var n=this.services.rootScope.$on(e.explore.constants.explorationNextPageEvent,(function(e,t){return o.switchToAdjacentSection(!0,t)})),a=this.services.rootScope.$on(e.explore.constants.explorationPreviousPageEvent,(function(e,t){return o.switchToAdjacentSection(!1,t)})),s=this.services.rootScope.$on(e.explore.constants.deleteSectionEvent,(function(e,t){return o.onDeleteSection(e,t)})),l=this.services.rootScope.$on(e.explore.constants.insertSectionEvent,(function(e,t){return o.onInsertSection(e,t)})),c=this.services.rootScope.$on(e.explore.constants.switchSectionEvent,(function(e,t){return o.onSwitchSection(e,t)})),u=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.podParameterChanged,(function(e,t){return o.onPodParameterChanged(t)})).subscribe(r.createSection,(function(e,t){return o.onCreateSection(e,t)})).subscribe(r.duplicateSection,(function(e,t){return o.onDuplicateSection(e,t)})).subscribe(r.deleteSection,(function(e,t){return o.onDeleteSection(e,t)}));t.$on(e.common.constants.scopeDestroyEventName,(function(){n(),a(),s(),l(),c(),u.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["explorationSerializer","lazySync","localizationService","telemetryService","featureSwitchService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","formFactor","lazyScoped","selection","undoRedo","visualAuthoring","visualPlugin"]}},i.prototype.switchToAdjacentSection=function(e,t){if(void 0===t&&(t=o.Unknown),this.scope.viewModel.exploration){var i=this.scope.viewModel.sectionStatus&&this.scope.viewModel.sectionStatus.currentSectionNumber;if(null==i)return;var r=i+(e?1:-1),n=this.scope.viewModel.exploration.sections.length;(r<0||r===n)&&(r=n-Math.abs(r)),this.services.explorationNavigation.updateActiveSection(r,!0)}},i.prototype.onSwitchSection=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return t.stopPropagation&&t.stopPropagation(),this.scope.viewModel.exploration&&this.services.explorationNavigation.updateActiveSection(i,!0),[2]}))}))},i.prototype.onCreateSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("CreateSection",(function(){var e=i?i.size:void 0;t.SectionUtils.createSection(r.scope.viewModel,r.services.selection,r.services.explorationNavigation,r.services.localizationService,e)})),e.stopPropagation&&e.stopPropagation())},i.prototype.onDuplicateSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("DuplicateSection",(function(){var e=r.scope.viewModel,o=r.services,n=t.SectionUtils.duplicateSection(e,o.explorationSerializer,i,o.localizationService);t.PodUtils.duplicatePod(e.exploration.contract,n,i,o.lazySync("linguisticSchemaProxy")).then((function(){t.SectionUtils.insertSection(e,n,o.selection,o.explorationNavigation)}))})),e.stopPropagation&&e.stopPropagation())},i.prototype.onDeleteSection=function(e,t){var i=this;if(this.scope.viewModel.exploration){var r=this.scope.viewModel.exploration.contract;t.userAction?this.services.undoRedo.register("DeleteSection",(function(){i.deleteSection(r,t.targetSectionIndex)})):this.deleteSection(r,t.targetSectionIndex)}e.stopPropagation&&e.stopPropagation()},i.prototype.deleteSection=function(e,i){t.PodUtils.deletePod(e,e.sections[i].name,this.services.lazySync("linguisticSchemaProxy")),t.SectionUtils.deleteSection(this.scope.viewModel,i,this.services.selection,this.services.explorationNavigation)},i.prototype.onInsertSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("InsertSection",(function(){t.SectionUtils.insertSection(r.scope.viewModel,i,r.services.selection,r.services.explorationNavigation)})),e.stopPropagation&&e.stopPropagation())},i.prototype.onReorderSection=function(e,i){var r=this;this.services.undoRedo.register("ReorderSection",(function(){return t.SectionUtils.reorderSection(r.scope.viewModel,i.originalIndex,i.targetIndex)})),this.scope.$apply()},i.prototype.onVisualConversion=function(e){var t=this;this.services.undoRedo.register("VisualConversion",(function(){return t.services.visualAuthoring.convert(e.visualContainer,t.services.dataSources.get(),e.newVisualType).then((function(){e.actionAfterConversion&&e.actionAfterConversion()}))}))},i.prototype.onPodParameterChanged=function(e){var i=this,r=this.scope.viewModel.exploration.contract;if(r){var o=this.services.explorationNavigation.getCurrentSection();this.services.undoRedo.register("PodParameterChanged",(function(){switch(e.type){case 0:t.PodUtils.addParameter(r,o.name,e.filterName);break;case 1:case 2:t.PodUtils.deleteParameter(r,o.name,e.filterName,i.services.lazySync("linguisticSchemaProxy"))}}))}},i})();i.ExplorationHostController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.services.events,r=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.prev=function(){return i.prev()},this.scope.next=function(){return i.next()},this.scope.getSelectedPageIndex=function(){return i.getSelectedPageIndex()}}return e.createOptions=function(){return{scopedDependencies:["eventBridge"]}},e.prototype.prev=function(){var e=this.getSelectedPageIndex();if(void 0!==e){var t=e-1;t>-1&&this.services.eventBridge.publishBubbling(this.scope,i.switchSection,t)}},e.prototype.next=function(){var e=this.getSelectedPageIndex();if(void 0!==e){var t=e+1;t<this.scope.viewModel.exploration.sections.length&&this.services.eventBridge.publishBubbling(this.scope,i.switchSection,t)}},e.prototype.getSelectedPageIndex=function(){if(this.scope.viewModel.exploration)for(var e=this.scope.viewModel.exploration.sections,t=e.length-1;t>=0;--t)if(e[t].selected)return t},e})();t.ExplorationPaginatorController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.data.FieldExprPattern,n=e.explore.util.HierarchyUtils,a=e.explore.util.ModelAuthoringUtility,s=t.services.selectionUtils,l=(e.data.SQColumnRefExpr,e.data.SQExpr),c=e.data.SQExprBuilder,u=e.data.SQExprConverter,p=jsCommon.StringExtensions,d=(function(){function i(e,i){var o=this;this.scope=e,this.services=i,this.scope.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.scope.$on(t.constants.explorationLoadedEventName,(function(){return o.explorationLoaded()}));var n=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.modelChanged,(function(e,t){return o.explorationLoaded(t)})).subscribe(r.selectionChanged,(function(){return o.updateChecked()})).subscribe(r.visualContainerChanged,(function(){return o.updateChecked()})).subscribe(r.selectionChanged,(function(){return o.unselect()})).subscribe(r.modelingContextChanged,(function(){return o.unselect()}));this.services.eventBridge.subscribeToBubbling(e,t.viewModels.FieldListEvents.fieldListAction,(function(e,t){return o.processFieldListAction(e,t)})),this.scope.$on("$destroy",(function(){return n.unsubscribeAll()})),this.scope.unselect=function(){return o.unselect()},this.scope.onSearchStringChanged=function(){return o.onSearchStringChanged()},this.scope.showContextMenu=function(e){return o.showContextMenu(e)},this.explorationLoaded()}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dropdown","errorService","featureSwitchService","modalDialogService","promiseFactory","$timeout"],scopedDependencies:["dataSources","eventBridge","groupingDesignStateService","groupAuthoring","lazyScoped","lazyScopedSync","modelAuthoring","modelChangeHandler","selection","shell","schemaItemActivation","visualAuthoring","visualPlugin"]}},i.prototype.onDestroy=function(){this.modalDialogPromise&&this.modalDialogPromise.pending&&this.modalDialogPromise.reject("fieldListController destroyed")},i.prototype.explorationLoaded=function(e){var t=this,i=this.services.dataSources.get();return i?void this.services.conceptualSchemaProxy.get(i).then((function(r){return t.loadModel(r,i,e)})):void this.clearModel()},i.prototype.clearModel=function(){this.loadModel(null)},i.prototype.loadModel=function(e,i,r){var n=this,a=this.services.featureSwitchService.featureSwitches.showNonUserEntitiesEnabled,s=this.scope.fieldListConfig.disableEditing;this.scope.viewModel=t.viewModels.FieldListViewModelMerger.mergeModel(this.scope.viewModel,e,this.scope.fieldListConfig.viewModelFactory,r,a,s);var l=this.getConceptualModel();l&&(l.showHidden=this.services.shell.canShowHiddenSchemaItem(),l.showCheckboxes=this.services.shell.canToggleSchemaItems()),this.updateChecked(),this.updateUnsupportedProperties();var c=t.viewModels.FieldListViewModelOperations.applyModelChanges(l,this.services.schemaItemActivation,r);if(c){var u=o.toFieldExprEntityItemPattern(c),p=c.column||c.columnAggr||c.groupingColumn||c.groupingColumnAggr||c.measure,d=p?p.name:void 0;this.services.$timeout((function(){return n.scope.scrollToItem(u.entity,d)}),0,!1)}},i.prototype.updateUnsupportedProperties=function(){var e=this.getConceptualModel();e&&t.viewModels.FieldListViewModelOperations.updateSupportedProperties(e)},i.prototype.updateChecked=function(){var e=this.getConceptualModel();if(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.hasCheckedProperties=!1;for(var n=0,a=r.properties;n<a.length;n++){var c=a[n];c.checked=!1,c.hasCheckedChildren=!1}}var p=s.getSelectedVisual(this.services.selection);if(p&&p.config.singleVisual&&p.config.singleVisual.query&&p.config.singleVisual.query.defn)for(var d=p.config.singleVisual.query.defn.select(),h=0,v=d;h<v.length;h++){var c=v[h];if(!l.isTransformOutputRoleRef(c.expr)){var g=u.asFieldPattern(c.expr),f=o.toFieldExprEntityItemPattern(g);if(g){var m=g.hierarchyLevel||g.hierarchyLevelAggr;if(m){var y=e.findHierarchies(f.entity,m.name,m.schema);if(y)for(var w=0,S=y;w<S.length;w++){var b=S[w];b.checked=!0,b.entity.hasCheckedProperties=!0,this.updateCheckedStateForAncestors(b);for(var C=0,x=b.hierarchyLevels;C<x.length;C++){var M=x[C];M.name===m.level&&(M.checked=!0,this.updateCheckedStateForAncestors(M))}}}else{var D=g.columnHierarchyLevelVariation?g.columnHierarchyLevelVariation.source.name:o.getPropertyName(g),F=e.findFields(f.entity,D,f.schema)||e.findKpiMeasures(f.entity,D,f.schema);if(F)for(var E=0,V=F;E<V.length;E++){var P=V[E];P.checked=!0,P.entity.hasCheckedProperties=!0,this.updateCheckedStateForAncestors(P)}}}}}}},i.prototype.updateCheckedStateForAncestors=function(e){e&&e.parent&&(e.parent.hasCheckedChildren=!0,this.updateCheckedStateForAncestors(e.parent))},i.prototype.unselect=function(){if(!this.scope.fieldListConfig.alwaysHasActiveItem){var e=this.getConceptualModel();if(!e)return;for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.selected=!1;for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.selected=!1}}this.services.schemaItemActivation.clearActiveItem()}},i.prototype.showContextMenu=function(e){var t=this.getConceptualModel();if(t){var i=t.getMenuItems();this.services.dropdown.showContextMenu(i,{x:e.pageX,y:e.pageY},this.onMenuItemSelected.bind(this),!1)}},i.prototype.onMenuItemSelected=function(e){var t;switch(e.action){case 2:t=1;break;case 3:t=2;break;case 14:t=15;break;case 15:t=16;break;default:return}var i={action:t};this.processFieldListAction(null,i)},i.prototype.processFieldListAction=function(e,i){var r,s=this.getConceptualModel();if(s){var l,p;i.fieldExpr&&(p=u.asFieldPattern(i.fieldExpr),l=o.toFieldExprEntityItemPattern(p));var d=s.name;switch(s.canEdit||(d=t.constants.ExplorationSchemaName),i.action){case 0:var h=t.viewModels.FieldListViewModelOperations.toggleHide(s,i.fieldExpr);h&&!s.showHidden&&this.unselect(),a.hide(i.fieldExpr,h,this.services.modelAuthoring);break;case 4:a.deleteItem(i.fieldExpr,this.services.modelAuthoring);var v=t.ScopeUtils.getSchemaPromise(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy);this.services.groupAuthoring.telemetry.logGroupsDeleteTelemetry(v,i.fieldExpr,this.services.groupingDesignStateService);break;case 5:r=n.findHierarchyLevelIndex(s.contract,i.fieldExpr),null!=r&&a.move(i.fieldExpr,r-1,this.services.modelAuthoring);break;case 6:r=n.findHierarchyLevelIndex(s.contract,i.fieldExpr),null!=r&&a.move(i.fieldExpr,r+1,this.services.modelAuthoring);break;case 1:t.viewModels.FieldListViewModelOperations.toggleShowHidden(s),this.services.shell.setShowHiddenSchemaItem(s.showHidden);break;case 2:t.viewModels.FieldListViewModelOperations.unhideAll(s);var g=c.entity(d,"");a.hide(g,!1,this.services.modelAuthoring);break;case 7:a.createMeasure(c.entity(d,l.entity),this.services.modelAuthoring);break;case 8:a.createHierarchy([i.fieldExpr],this.services.modelAuthoring);break;case 9:a.createHierarchyLevel(i.fieldExpr,i.newHierarchyLevel.hierarchy,i.newHierarchyLevel.index,this.services.modelAuthoring);break;case 10:a.createCalculatedColumn(c.entity(s.name,l.entity),this.services.modelAuthoring);break;case 11:this.showGroupsDialog(i.property,!0);break;case 12:this.showGroupsDialog(i.property,!1);break;case 13:this.showEditClusteringDialogAsync(p);break;case 14:this.showQuickCalcDialog(i.fieldExpr);break;case 15:t.viewModels.FieldListViewModelOperations.collapseOrExpandAllEntities(s,!1);break;case 16:t.viewModels.FieldListViewModelOperations.collapseOrExpandAllEntities(s,!0)}e&&e.stopPropagation&&e.stopPropagation()}},i.prototype.onSearchStringChanged=function(){var e=this.getConceptualModel();if(e){var t=_.trim(this.scope.searchString);if(_.isEmpty(t))for(var i=0,r=e.entities;i<r.length;i++){var o=r[i];o.isShownInSearch=void 0;for(var n=0,a=o.properties;n<a.length;n++){var s=a[n];s.isShownInSearch=void 0}}else for(var l=0,c=e.entities;l<c.length;l++){for(var o=c[l],u=p.containsIgnoreCase(o.displayName,t),d=0,h=o.properties;d<h.length;d++){var s=h[d];s.isShownInSearch=this.isSearchHit(s,t)||u,2===s.fieldType&&this.setHierarchyShownInSearch(s,t)}o.isShownInSearch=u||_.any(o.properties,(function(e){return e.isShownInSearch}))}}},i.prototype.setHierarchyShownInSearch=function(e,t){for(var i=0,r=e.hierarchyLevels;i<r.length;i++){var o=r[i];o.isShownInSearch=this.isSearchHit(o,t)||e.isShownInSearch}e.isShownInSearch=_.any(e.hierarchyLevels,(function(e){return e.isShownInSearch}))},i.prototype.showGroupsDialog=function(e,t){var i={schema:e.entity.contractSchema.name,entity:e.entity.name,name:t?null:e.name,sourcePropertyName:t?e.name:null,valueType:e.type,groupingMetadata:t?null:e.contract.column.groupingMetadata};this.services.groupAuthoring.dialog.showDialog(i)},i.prototype.showEditClusteringDialogAsync=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.services.lazyScoped("clustering")];case 1:return e=i.sent(),this.modalDialogPromise=e.editClustering(t,this.services.dataSources.get()),[2]}}))}))},i.prototype.showQuickCalcDialog=function(e){this.modalDialogPromise=this.services.lazyScopedSync("quickCalcService").createQuickCalc(e)},i.prototype.getConceptualModel=function(){return this.scope.viewModel&&this.scope.viewModel.schema},i.prototype.isSearchHit=function(e,i){return t.viewModels.FieldListUtils.isFieldVisible(e)&&p.containsIgnoreCase(e.displayName,i)},i})();i.FieldListController=d})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.util.FieldListActionEventPublisher,n=e.explore.util.ModelAuthoringUtility,a=t.services.schemaItemActivationUtils,s=(function(){function i(i,r){var n=this;this.scope=i,this.services=r,this.scope.toggle=function(e){return n.toggle(e)},this.scope.select=function(){return n.select()},this.scope.editLabel=function(){return n.editLabel()},this.scope.rename=function(e){return n.rename(e)},this.scope.isNameValid=function(e){return n.isNameValid(e);
},this.scope.filterProperties=function(t){return e.explore.viewModels.FieldListUtils.isFieldVisible(t)},this.scope.showContextMenu=function(e){return n.showContextMenu(e)},this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){n.scope.viewModel.isEditingLabel=!1})),this.fieldListActionEventPublisher=new o(this.scope,this.services.eventBridge),this.scope.tooltipConfigManager={getTooltipConfig:function(){return{tooltipTitle:n.getTooltipTitle()}}};var a=this.services.eventBridge.createChannelSubscriptionManager().subscribe(t.services.events.schemaItemActivationChanged,(function(){return n.schemaItemActivationChanged()}));this.scope.$on("$destroy",(function(){return a.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["dropdown","featureSwitchService"],scopedDependencies:["eventBridge","modelAuthoring","schemaItemActivation","shell"]}},i.prototype.toggle=function(e){var t=this.scope.viewModel;t.expanded=!t.expanded,this.select(),e.stopPropagation()},i.prototype.getTooltipTitle=function(){var e=this.scope.viewModel;return e.errorMessage?e.errorMessage:e.displayName},i.prototype.select=function(){var i=this.scope.viewModel.canEdit||this.services.featureSwitchService.featureSwitches.reportMeasures&&this.scope.viewModel.contractSchema.capabilities.isExtendable;if(i){var r=this.scope.viewModel,o=e.data.SQExprBuilder.entity(r.schema.name,r.name);a.setActiveSchemaItem(this.services.schemaItemActivation,o),t.viewModels.FieldListViewModelOperations.clearSelection(r.schema),r.selected=!0}},i.prototype.editTable=function(){var t=this.scope.viewModel,i=e.data.SQExprBuilder.entity(t.schema.name,t.name);this.services.shell.showEditQueriesEditor(i.entity)},i.prototype.fieldExpr=function(){var t=this.scope.viewModel;return e.data.SQExprBuilder.entity(t.contractSchema.name,t.name)},i.prototype.selectMenuItem=function(e){switch(e.action){case 4:this.editLabel();break;case 1:this.fieldListActionEventPublisher.toggleHidden(this.fieldExpr());break;case 5:this.fieldListActionEventPublisher.delete(this.fieldExpr());break;case 2:this.fieldListActionEventPublisher.viewHidden();break;case 3:this.fieldListActionEventPublisher.unHideAll();break;case 10:this.fieldListActionEventPublisher.addMeasure(this.fieldExpr());break;case 19:this.fieldListActionEventPublisher.newQuickCalc(this.fieldExpr());break;case 11:this.fieldListActionEventPublisher.addHierarchy(this.fieldExpr());break;case 13:this.fieldListActionEventPublisher.addColumn(this.fieldExpr());break;case 14:this.fieldListActionEventPublisher.collapseAll();break;case 15:this.fieldListActionEventPublisher.expandAll();break;case 6:n.refreshEntity(this.fieldExpr(),this.services.modelAuthoring);break;case 9:this.editTable();break;case 20:this.services.eventBridge.publishToChannel(r.copyTable,this.scope.viewModel.name)}},i.prototype.showContextMenu=function(e){e.stopPropagation(),this.services.dropdown.showContextMenu(this.scope.viewModel.getMenuItems(),{x:e.pageX,y:e.pageY},this.selectMenuItem.bind(this),!1)},i.prototype.editLabel=function(){this.scope.viewModel.canEdit&&(this.scope.viewModel.isEditingLabel=!0,this.scope.toggleDraggable(!1))},i.prototype.rename=function(e){this.scope.toggleDraggable(!1),this.isNameValid(e)&&n.rename(this.fieldExpr(),e,this.services.modelAuthoring)},i.prototype.isNameValid=function(e){var t=this.scope.viewModel;if(!t.schema)return!0;var i=e!==this.scope.viewModel.name,r=jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e);return i&&!r},i.prototype.schemaItemActivationChanged=function(){var e=this.services.schemaItemActivation.getActiveItem();this.scope.viewModel.selected=e&&e.entity===this.scope.viewModel.name&&e.schema===this.scope.viewModel.schema.name},i})();i.FieldListEntityController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.explore.services.events,n=e.explore.util.FieldListActionEventPublisher,a=t.util.HierarchyUtils,s=e.explore.util.ModelAuthoringUtility,l=t.services.schemaItemActivationUtils,c=t.services.selectionUtils,u=jsCommon.StringExtensions,p=e.data.SQExpr,d=e.data.SQExprConverter,h=0,v=(function(){function i(i,o){var a=this;this.scope=i,this.services=o,o.featureSwitchService.featureSwitches.hierarchyAuthoringEnabled&&o.featureSwitchService.featureSwitches.hierarchyDragDrop&&(this.dropConfig={accept:r.Field,greedy:!1}),this.services.localizationService.ensureLocalization((function(){a.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDisable:a.viewModel.isEditingLabel,tooltipTitle:a.getTooltipTitle()}}}})),this.elementId=this.createUniqueId();var s=this.scope.$watch((function(){return a.viewModel}),(function(e){a.fieldListExprGenerator=t.util.createFieldListExprGenerator(a.getExprKind(a.viewModel),a.services.groupingDesignStateService),s()})),l=this.services.eventBridge.createChannelSubscriptionManager().subscribe(t.services.events.selectionChanged,(function(){return a.updateSelection()})).subscribe(t.services.events.schemaItemActivationChanged,(function(){return a.schemaItemActivationChanged()}));this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){a.viewModel.isEditingLabel=!1})),this.scope.$on("$destroy",(function(){return l.unsubscribeAll()})),this.updateSelection(),this.fieldListActionEventPublisher=new n(this.scope,this.services.eventBridge)}return i.createOptions=function(){return{additionalServices:["dragDataService","dropdown","featureSwitchService","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","groupingDesignStateService","schemaItemActivation","explorationNavigation","selection","visualAuthoring","modelAuthoring"]}},i.prototype.drop=function(e,t,i){var r=this.services.dragDataService.getDragContext();if(r&&r.field){var o=r.field,n=this.fieldExpr();if(p.isColumn(o))p.isColumn(n)?s.createHierarchy([n,o],this.services.modelAuthoring):p.isHierarchy(n)&&s.createHierarchyLevel(o,n.hierarchy,void 0,this.services.modelAuthoring);else if(p.isHierarchyLevel(o)&&p.isHierarchy(n))s.move(o,0,this.services.modelAuthoring);else if(p.isHierarchyLevel(o)&&p.isHierarchyLevel(n)){var l=a.findHierarchyLevelIndex(this.viewModel.entity.schema.contract,o),c=a.findHierarchyLevelIndex(this.viewModel.entity.schema.contract,n),u=l>c?c:c-1;3===i&&(u+=1),s.move(o,u,this.services.modelAuthoring)}}},i.prototype.canCreateHierarchyLevelFromColumn=function(t,i){if(p.isEntity(t.arg)&&p.equals(t.arg,i.source)){var r=e.data.SQExprConverter.asFieldPattern(t),o=e.data.FieldExprPattern.toFieldExprEntityItemPattern(r),n=this.viewModel.entity.findHierarchies(t.hierarchy,o.schema);if(!_.isEmpty(n)){var a=_.first(n),s=a.hierarchyLevels,l=i.ref,c=_.find(s,(function(e){return e.contract.name===l}));return _.isEmpty(c)}}},i.prototype.getDropAction=function(e){var t=this.services.promiseFactory.defer(),i=this.services.dragDataService.getDragContext(),r=0;if(i&&this.viewModel.entity.canEdit){var o=i.field,n=this.fieldExpr();if(!_.isEmpty(o)&&!p.equals(o,n))if(p.isColumn(o)&&(p.isHierarchy(n)&&this.canCreateHierarchyLevelFromColumn(n,o)||p.isColumn(n)&&p.equals(o.source,n.source)))r=1;else{var s=this.viewModel.entity.schema.contract;if(p.isHierarchyLevel(o)&&p.isHierarchyLevel(n)&&p.equals(o.arg,n.arg)){var l=a.findHierarchyLevelIndex(s,o),c=a.findHierarchyLevelIndex(s,n);l<c&&(c-=1),1===e&&(c+=1),l!==c&&(r=0===e?2:3)}else p.isHierarchyLevel(o)&&2===this.viewModel.fieldType&&p.equals(o.arg,n)&&0!==a.findHierarchyLevelIndex(s,o)&&(r=3)}}return t.resolve(r),t.promise},i.prototype.getExprKind=function(e){switch(e.fieldType){case 2:return 1;case 3:return 2;case 0:return 0;default:return 0}},i.prototype.getTooltipTitle=function(){var e,t=this.viewModel;if(5===t.fieldType){var i=t;e=2===i.kpiType?u.format(this.services.localizationService.get("Field_Tooltip"),i.entity.displayName,i.parent.displayName):u.format(this.services.localizationService.get("Field_Kpi_Tooltip"),i.entity.displayName,i.parent.displayName,i.displayName)}else e=t.entity?u.format(this.services.localizationService.get("Field_Tooltip"),t.entity.displayName,t.displayName):t.displayName;return t.errorMessage&&(e=t.errorMessage),e},i.prototype.getPropertyStyle=function(){var e=this.viewModel,t={selected:e.selected,inactive:e.hidden&&e.showHidden,isLeaf:3===e.fieldType||5===e.fieldType,lastLeaf:this.isLastLeaf(),expanded:this.viewModel.expanded};return t[this.getFieldType()]=!0,t},i.prototype.getIndentationStyle=function(){var e=this.getIndentationLevel(),t=8*e,i={"padding-left":t+"px"};return i},i.prototype.getIndentationLevel=function(){for(var e=this.viewModel,t=1,i=e.parent;i;)t++,i=i.parent;return t},i.prototype.isLastLeaf=function(){var e=this.viewModel.fieldType,t=this.viewModel.parent;return!(3!==e&&5!==e||!t||_.last(t.children)!==this.viewModel)},i.prototype.createUniqueId=function(){return"fieldListProp_"+ ++h},i.prototype.toggle=function(){this.viewModel.checked?this.addField():this.removeField()},i.prototype.addField=function(){var t=this,i=this.fieldExpr(),r=c.getSelectedVisuals(this.services.selection);if(1===r.length){var n=r[0];if(n){var a=this.services.dataSources.get();this.services.visualAuthoring.addFieldToVisual(i,a,n,e.telemetry.HowFieldWasAddedToVisual.CheckboxTickedInFieldList).catch((function(){t.viewModel.checked=!1}))}}else this.services.eventBridge.publishToChannel(o.addVisualContainer,{expr:i,allowAggregate:!0,telemetrySource:0})},i.prototype.removeField=function(){var e=this.services.dataSources.get();this.services.visualAuthoring.removeField(e,this.fieldExpr())},i.prototype.getIconClassName=function(){var e=this.viewModel.fieldType;if(1===e)return"folder";if(3===e||5===e)return"none";if(2===e)return"hierarchy";var t=this.viewModel;if(1===t.contract.queryable)return"error";if(1===t.kind)return t.contract.measure&&t.contract.measure.kpi&&4===t.fieldType?"kpi":"measure";if(void 0!==t.contract.type&&void 0!==t.contract.type.geography)return"geoData";if(0===t.kind){var i=t.contract.column;if(i){if(i.parameterMetadata)return"parameter";if(i.groupingMetadata)return"group";if(i.calculated)return t.type&&t.type.numeric?"numericCalculatedColumn":"calculatedColumn"}if(t.idOnEntityKey)return"identity"}return t.type&&t.type.numeric&&1!==t.defaultAggregate&&this.allowAggregation()?"numeric":"none"},i.prototype.getDragContext=function(){return{field:this.fieldExpr()}},i.prototype.fieldExpr=function(){return this.fieldListExprGenerator.fieldExpr(this.viewModel)},i.prototype.updateSelection=function(){this.selectedVisualContainer=null;var e=c.getSelectedVisual(this.services.selection);e&&(this.selectedVisualContainer=e)},i.prototype.select=function(e){var i=this.viewModel.canEdit||this.services.featureSwitchService.featureSwitches.reportMeasures&&this.viewModel.entity.schema.contract.capabilities.isExtendable;if(i){var r=this.viewModel;r.selected||(t.viewModels.FieldListViewModelOperations.clearSelection(r.entity.schema),r.selected=!0);var o=this.fieldExpr();o?l.setActiveSchemaItem(this.services.schemaItemActivation,o):this.services.schemaItemActivation.clearActiveItem(),e.stopPropagation()}},i.prototype.selectMenuItem=function(e){switch(e.action){case 4:this.editLabel();break;case 0:this.addFilter();break;case 1:this.fieldListActionEventPublisher.toggleHidden(this.fieldExpr());break;case 5:this.fieldListActionEventPublisher.delete(this.fieldExpr());break;case 7:this.fieldListActionEventPublisher.moveUp(this.fieldExpr());break;case 8:this.fieldListActionEventPublisher.moveDown(this.fieldExpr());break;case 2:this.fieldListActionEventPublisher.viewHidden();break;case 3:this.fieldListActionEventPublisher.unHideAll();break;case 10:this.fieldListActionEventPublisher.addMeasure(this.fieldExpr());break;case 11:this.fieldListActionEventPublisher.addHierarchy(this.fieldExpr());break;case 12:this.fieldListActionEventPublisher.addHierarchyLevel(this.fieldExpr(),e.hierarchyName);break;case 13:this.fieldListActionEventPublisher.addColumn(this.fieldExpr());break;case 16:this.fieldListActionEventPublisher.setGroups(this.viewModel);break;case 17:this.fieldListActionEventPublisher.editGroups(this.viewModel);break;case 18:this.fieldListActionEventPublisher.editClustering(this.fieldExpr());break;case 19:this.fieldListActionEventPublisher.newQuickCalc(this.fieldExpr());break;case 14:this.fieldListActionEventPublisher.collapseAll();break;case 15:this.fieldListActionEventPublisher.expandAll()}},i.prototype.toggleExpand=function(e){var t=this.viewModel;t.expanded=!t.expanded,this.select(e),e.stopPropagation()},i.prototype.showContextMenu=function(e){e.stopPropagation(),this.services.dropdown.showContextMenu(this.viewModel.getMenuItems(),{x:e.pageX,y:e.pageY},this.selectMenuItem.bind(this),!1)},i.prototype.addFilter=function(){var e;e=this.selectedVisualContainer?{container:this.selectedVisualContainer,scopeType:0}:{container:this.services.explorationNavigation.getCurrentSection(),scopeType:1},this.services.visualAuthoring.addFilter(this.fieldExpr(),e,this.services.dataSources.get())},i.prototype.editLabel=function(){var e=this.viewModel;e.canEdit&&this.isEditableField(e.fieldType)&&(e.isEditingLabel=!0,this.scope.toggleDraggable(!1))},i.prototype.rename=function(t){this.scope.toggleDraggable(!0),this.isNameValid(t)&&e.explore.util.ModelAuthoringUtility.rename(this.fieldExpr(),t,this.services.modelAuthoring)},i.prototype.isNameValid=function(e){var t=e!==this.viewModel.name,i=u.isNullOrUndefinedOrWhiteSpaceString(e);return t&&!i},i.prototype.allowAggregation=function(){return!(this.viewModel.entity&&this.viewModel.entity.schema&&this.viewModel.entity.schema.contract&&this.viewModel.entity.schema.contract.capabilities)||!this.viewModel.entity.schema.contract.capabilities.discourageQueryAggregateUsage},i.prototype.isEditableField=function(e){return 5!==e&&(2!==e&&3!==e||this.services.featureSwitchService.featureSwitches.hierarchyAuthoringEnabled)},i.prototype.schemaItemActivationChanged=function(){var e=this.services.schemaItemActivation.getActiveItem(),t=this.fieldExpr();if(t){var i=d.asFieldPattern(t);i.column&&(this.viewModel.selected=e&&e.entity===this.viewModel.entity.name&&e.property===this.viewModel.name&&e.schema===this.viewModel.schemaName)}},i.prototype.getFieldType=function(){switch(this.viewModel.fieldType){case 0:return"property";case 1:return"displayFolder";case 4:return"kpi";case 2:return"hierarchy";case 5:return"kpiMeasure";case 3:return"hierarchyLevel";default:return"property"}},i})();i.FieldListPropertyController=v})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=t.contracts.FilterType,n=e.data.SemanticFilter,a=(function(){function i(e,i){var o=this;this.scope=e,this.services=i,this.scope.viewModel.updateViewState(),this.scope.viewModel.updateAvailableTypes(),this.scope.toggle=function(e,t){return o.toggle(e,t)},this.scope.deleteFilter=function(e,t){return o.deleteFilter(e,t)},this.scope.clearFilter=function(e,t){return o.clearFilter(e,t)},this.scope.restoreDefaultFilter=function(e,t){return o.restoreDefaultFilter(e,t)},this.scope.switchCardType=function(e,t){return o.switchCardType(e,t)},this.scope.invalidFilterTooltip=this.services.localizationService.get("Invalid_Filter_Tooltip"),this.scope.updateRequiredState=function(){return o.updateRequiredState(!0)},this.scope.viewModel.isPodEnabled()&&this.isPodParameter()&&(this.scope.viewModel.isSingleSelectionRequired=!0),this.scope.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDisable:!e.viewModel.readOnlyState.invalid,tooltipTitle:i.localizationService.get("Invalid_Filter_Tooltip")}}},this.services.eventBridge.subscribeToBubbling(e,t.viewModels.FilterEvents.filterChanged,(function(e,t){return o.onFilterChanged(e,t)})),this.scope.viewModel.chevronExpandDescription=i.localizationService.get("Chevron_ExpandDescription"),this.scope.viewModel.chevronCollapseDescription=i.localizationService.get("Chevron_CollapseDescription");var n=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.filterContainerChanged,(function(e,t){return o.onFilterContainerChanged(t)}));this.scope.$on("$destroy",(function(){return n.unsubscribeAll()})),this.initializeDefaultValue(),this.updateRequiredState(!1)}return i.createOptions=function(){return{additionalServices:["hostTypeResolutionService","$element","localizationService","featureSwitchService","telemetryService"],scopedDependencies:["eventBridge","explorationNavigation","visualAuthoring"]}},i.prototype.onFilterChanged=function(e,t){var i=this.scope.viewModel.contract.expression;this.scope.viewModel.useDefaultFilter&&(t.filter.filter=n.getDefaultValueFilter(i)),this.services.eventBridge.publishToChannel(r.filterContainerChanged,t),this.updateRestatement()},i.prototype.onFilterContainerChanged=function(e){var t=this.scope.viewModel;e.filter===t.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&this.updateRestatement()},i.prototype.toggle=function(e,t){var i=t.contract;i.expanded=!i.expanded,t.updateViewState();var o=this.scope.viewModel,n={filter:o.contract,changeType:16,scope:o.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,n)},i.prototype.clearFilter=function(e,t){if(!t.contract.filter)return void e.stopPropagation();this.scope.viewModel.clearRestatement();var i=this.scope.viewModel;this.services.visualAuthoring.clearFilter(i.getFilterContainerScope().container,i.contract);var o={filter:t.contract,changeType:10,scope:t.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,o),e.stopPropagation()},i.prototype.restoreDefaultFilter=function(e,t){var i=this.scope.viewModel,o=this.scope.viewModel.contract.expression;this.services.visualAuthoring.updateFilter(i.getFilterContainerScope().container,i.contract,n.getDefaultValueFilter(o));var a={filter:t.contract,changeType:10,scope:t.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,a),i.useDefaultFilter=!0,this.updateRestatement(),e.stopPropagation()},i.prototype.deleteFilter=function(e,t){var i=t.getFilterContainerScope();if(this.services.visualAuthoring.removeFilter(t.contract,i),this.scope.viewModel.isSingleSelectionRequired){var o={filterName:t.contract.name,type:2};this.services.eventBridge.publishToChannel(r.podParameterChanged,o)}e.stopPropagation()},i.prototype.switchCardType=function(i,r){switch(i.type){case o.Advanced:case o.Categorical:case o.TopN:case o.RelativeDate:r.switchType(i.type),r.updateViewState()}this.services.hostTypeResolutionService.getHostType()===e.common.HostType.iOSWK&&this.services.$element.find(".typeSwitchOptions").get(0).blur();var n={filter:this.scope.viewModel.contract,changeType:32,scope:this.scope.viewModel.getFilterContainerScope()};this.services.eventBridge.publishToChannel(t.services.events.filterContainerChanged,n)},i.prototype.updateRequiredState=function(e){var t=this.scope.viewModel.isSingleSelectionRequired;if(!e){var i=this.isPodParameter(),o=t;if(!!i==!!o)return}var n={filterName:this.scope.viewModel.contract.name,type:t?0:1};this.services.eventBridge.publishToChannel(r.podParameterChanged,n);var a=this.scope.viewModel;if(e&&t&&a.contract.filter){this.services.visualAuthoring.updateFilter(a.getFilterContainerScope().container,a.contract,void 0);var s={filter:a.contract,changeType:10,scope:a.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,s)}},i.prototype.isPodParameter=function(){var e=this.services.explorationNavigation.getCurrentExploration(),i=this.services.explorationNavigation.getCurrentSection(),r=this.scope.viewModel.contract.name;return!!(e&&i&&r)&&t.PodUtils.hasParameter(e,i.name,r)},i.prototype.updateRestatement=function(){var e=this.scope.viewModel;e.useDefaultFilter?e.setRestatement(t.viewModels.RestatementHelper.fromDefault(e.defaultValue.value)):e.contract.type===o.Passthrough&&(e.setRestatement(e.contract.restatement),e.updateViewState())},i.prototype.initializeDefaultValue=function(){var e=this.scope.viewModel;(e.hasDefaultValue&&!e.contract.filter||n.isDefaultFilter(e.contract.filter))&&(e.useDefaultFilter=!0,this.updateRestatement())},i})();i.FilterController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){var i,r=!1;return t===e.visualFilters?i=0:t===e.pageFilters?i=1:t===e.drillthroughFilters?(i=1,r=!0):t===e.reportFilters&&(i=2),o(i,r)}function o(e,t){return 0===e?0:1!==e||t?1===e?2:2===e?3:-1:1}var n=e.explore.util.DragDropTypes,a=e.explore.services.events,s=e.explore.util.ScriptVisualsUtil,l=t.services.selectionUtils,c=e.explore.util.VisualContainerUtils,u=(function(){function i(e,i){var r=this;this.scope=e,this.services=i;var o=this.services.explorationNavigation.getCurrentExploration();this.scope.viewModel=t.viewModels.ViewModelFactory.createFilterPane(this.services.localizationService,null!=o),this.scope.viewModeState=i.viewModeState,this.scope.dropPageFilter=function(e,t,i){return r.dropPageFilter(e,t,i)},this.scope.dropDrillthroughFilter=function(e,t,i){return r.dropDrillthroughFilter(e,t,i)},this.scope.dropReportFilter=function(e,t,i){return r.dropReportFilter(e,t,i)},this.scope.dropVisualFilter=function(e,t,i){return r.dropVisualFilter(e,t,i)},this.scope.dropConfig={accept:n.Field},this.scope.getDropAction=function(e){return r.getDropAction(e)},this.scope.isVisualFiltersVisible=function(){return r.isVisualFiltersVisible()},this.scope.isPageFiltersVisible=function(){return r.isPageFiltersVisible()},this.scope.isDrillthroughFiltersVisible=function(){return r.isDrillthroughFiltersVisible()},this.scope.isReportFiltersVisible=function(){return r.isReportFiltersVisible()};var s=this.services.eventBridge.createChannelSubscriptionManager().subscribe(a.selectionChanged,(function(){return r.updateSelection()})).subscribe(a.modelChanged,(function(){return r.onModelChanged()})).subscribe(a.canvasChanged,(function(){return r.onCanvasChanged()})).subscribe(a.explorationLoaded,(function(){return r.onModelChanged()})).subscribe(a.visualContainerChanged,(function(e,t){return r.onVisualContainerChanged(t)})).subscribe(a.explorationFiltersContainerChanged,(function(e,t){return r.onExplorationFiltersContainerChanged(t)})).subscribe(a.sectionFiltersContainerChanged,(function(e,t){return r.onSectionFiltersContainerChanged(t)})).subscribe(a.filterContainerChanged,(function(e,t){return r.onFilterContainerChanged(t)}));e.$on("$destroy",(function(){return s.unsubscribeAll()})),this.updateSelection(),this.onModelChanged()}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","featureSwitchService","localizationService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationCapabilities","explorationNavigation","scriptVisuals","selection","viewModeState","visualAuthoring","visualPlugin","visualPluginOps"]}},i.prototype.onModelChanged=function(){this.createReportFilters(),this.createPageScopeFilters()},i.prototype.onExplorationFiltersContainerChanged=function(e){e.container===this.services.explorationNavigation.getCurrentExploration()&&this.createReportFilters()},i.prototype.onSectionFiltersContainerChanged=function(e){e.container===this.services.explorationNavigation.getCurrentSection()&&this.createPageScopeFilters()},i.prototype.onCanvasChanged=function(){this.createPageScopeFilters()},i.prototype.getDropAction=function(e){var t=this.services.promiseFactory.defer(),i=this.services.dragDataService.getDragContext();return i&&i.field?t.resolve(3):t.resolve(0),t.promise},i.prototype.dropVisualFilter=function(e,t,i){var r=this.getSelectedVisual();r&&this.addFilterToScopeFromDrop(0,r,!1)},i.prototype.dropPageFilter=function(e,t,i){var r=this.services.explorationNavigation.getCurrentSection();this.addFilterToScopeFromDrop(1,r,!1)},i.prototype.dropDrillthroughFilter=function(e,t,i){if(this.services.featureSwitchService.featureSwitches.drillthrough){var r=this.services.explorationNavigation.getCurrentSection();this.addFilterToScopeFromDrop(1,r,!0)}},i.prototype.dropReportFilter=function(e,t,i){var r=this.services.explorationNavigation.getCurrentExploration();this.addFilterToScopeFromDrop(2,r,!1)},i.prototype.addFilterToScopeFromDrop=function(e,t,i){var r=this.services.dragDataService.getDragContext();if(r&&r.field){var o={scopeType:e,container:t},n=this.services.dataSources.get();i?this.services.visualAuthoring.addDrillthroughFilter(r.field,o,n):this.services.visualAuthoring.addFilter(r.field,o,n)}},i.prototype.isVisualFiltersVisible=function(){var e=this.scope.viewModeState.getMode(),t=1===e,i=0===e;return!(!t||!this.scope.viewModel.isVisualVisible)||!(!i||_.isEmpty(this.scope.viewModel.visualFilters))},i.prototype.isPageFiltersVisible=function(){return this.isPageOrReportScopeFiltersVisible(this.scope.viewModel.pageFilters)},i.prototype.isDrillthroughFiltersVisible=function(){var e=!_.isEmpty(this.scope.viewModel.drillthroughFilters),t=this.services.featureSwitchService.featureSwitches.drillthrough,i=e||t;return i&&this.isPageOrReportScopeFiltersVisible(this.scope.viewModel.drillthroughFilters)},i.prototype.isReportFiltersVisible=function(){return this.isPageOrReportScopeFiltersVisible(this.scope.viewModel.reportFilters)},i.prototype.isPageOrReportScopeFiltersVisible=function(e){if(!e)return!1;var t=this.scope.viewModeState;if(t.getConfig().alwaysPopulatePanes)return!0;var i=1===t.getMode();return!!i||!!e.length},i.prototype.updateSelection=function(){var e=this.scope.viewModel,t=this.getSelectedVisual();e.visualFilters.length=0,t&&this.services.visualPluginOps.isQueryVisual(t.config.singleVisual.visualType)?(e.isVisualVisible=!0,this.createVisualFilters()):this.scope.viewModel.isVisualVisible=!1},i.prototype.onVisualContainerChanged=function(e){if(e){var t=this.getSelectedVisual();t&&e.affectContainer(t)&&this.createVisualFilters()}},i.prototype.onFilterContainerChanged=function(e){var i=this;if(2===e.scope.scopeType){var r=this.services.explorationNavigation.getCurrentExploration();c.clearVisualContainerQueryCaches(r)}var o=this.scope.viewModel;if(1===e.changeType)this.getConceptualSchema().then((function(r){var n=i.getSelectedVisual(),a=c.getVisualCapabilities(n,i.services.visualPlugin),s=t.viewModels.FilterViewModelFactory.convertFilterContainer(e.filter,r,i.services.displayNameService,e.scope,i.services.visualPlugin,i.services.aggrOps,i.services.localizationService,a,n&&n.config.singleVisual);if(0===e.scope.scopeType&&e.scope.container===i.getSelectedVisual())o.visualFilters.push(s);else if(1===e.scope.scopeType){var l=5===e.filter.howCreated?o.drillthroughFilters:o.pageFilters;l.push(s),i.addConfigToPageOrReportFilters(l,r)}else 2===e.scope.scopeType&&(o.reportFilters.push(s),i.addConfigToPageOrReportFilters(o.reportFilters,r))}));else if(0===e.changeType){var n;switch(e.scope.scopeType){case 0:n=o.visualFilters;break;case 1:n=5===e.filter.howCreated?o.drillthroughFilters:o.pageFilters;break;case 2:n=o.reportFilters;break;default:return}for(var a=0,s=n.length;a<s;a++)if(n[a].contract===e.filter){n.splice(a,1);break}}10!==e.changeType&&1!==e.changeType&&2!==e.changeType&&0!==e.changeType||(this.updateCategoricalFiltersIfNeeded(this.scope.viewModel.visualFilters,e),this.updateCategoricalFiltersIfNeeded(this.scope.viewModel.pageFilters,e),this.updateCategoricalFiltersIfNeeded(this.scope.viewModel.drillthroughFilters,e),this.updateCategoricalFiltersIfNeeded(this.scope.viewModel.reportFilters,e)),this.logRTelemetry(e)},i.prototype.updateCategoricalFiltersIfNeeded=function(e,t){if(!_.isEmpty(e)){var i=r(this.scope.viewModel,e),n=o(t.scope.scopeType,5===t.filter.howCreated);i!==-1&&n!==-1&&n>=i&&this.updateCategoricalFilters(e,t.filter)}},i.prototype.logRTelemetry=function(t){var i=this.services.explorationNavigation,r=i.getCurrentExploration(),o=i.getCurrentSection(),n=t.scope.scopeType,a=s.getScriptVisualIds(n,r,o,this.getSelectedVisual(),this.services.scriptVisuals);if(!_.isEmpty(a)){var l=t.changeType.toString();this.services.telemetryService.logEvent(e.telemetry.EXFilterScriptVisual,l,JSON.stringify(a))}},i.prototype.updateCategoricalFilters=function(e,i){for(var r=0,o=e;r<o.length;r++){var n=o[r];if(t.FilterUtils.isCategoricalFilter(n.contract.type)&&n.contract!==i){var s={filter:n.contract,changeType:4,scope:n.getFilterContainerScope()};this.services.eventBridge.publishToChannel(a.filterContainerChanged,s)}}},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(e)},i.prototype.getSelectedVisual=function(){return l.getSelectedVisual(this.services.selection)},i.prototype.createPageScopeFilters=function(){var e=this,i=this.services.explorationNavigation.getCurrentSection(),r=this.services.explorationCapabilities.getCapabilities();return!i||r.shouldShowPageFilters&&!r.shouldShowPageFilters(i)?(this.scope.viewModel.pageFilters=null,void(this.scope.viewModel.drillthroughFilters=null)):(this.services.featureSwitchService.featureSwitches.drillthrough||(this.scope.viewModel.drillthroughFilters=null),void this.getConceptualSchema().then((function(r){var o=t.viewModels.ViewModelFactory.createFilters({scopeType:1,container:i},r,e.services.displayNameService,e.services.visualPlugin,e.services.aggrOps,e.services.localizationService,null);e.scope.viewModel.pageFilters=[],e.scope.viewModel.drillthroughFilters=[];for(var n=0,a=o;n<a.length;n++){var s=a[n];5!==s.howCreated?e.scope.viewModel.pageFilters.push(s):e.scope.viewModel.drillthroughFilters.push(s)}e.addConfigToPageOrReportFilters(o,r)})))},i.prototype.createReportFilters=function(){var e=this,i=this.services.explorationNavigation.getCurrentExploration();return i?void this.getConceptualSchema().then((function(r){e.scope.viewModel.reportFilters=t.viewModels.ViewModelFactory.createFilters({scopeType:2,container:i},r,e.services.displayNameService,e.services.visualPlugin,e.services.aggrOps,e.services.localizationService,null),e.addConfigToPageOrReportFilters(e.scope.viewModel.reportFilters,r)})):void(this.scope.viewModel.reportFilters=null)},i.prototype.addConfigToPageOrReportFilters=function(e,t){if(!_.isEmpty(e)){var i=this.services.dataSources.get();this.services.visualAuthoring.addConfigToCategoricalFilters(e,t,i)}},i.prototype.createVisualFilters=function(){var e=this;this.getConceptualSchema().then((function(t){var i=e.getSelectedVisual();i&&(e.scope.viewModel.visualFilters=e.services.visualAuthoring.createVisualFilters(i,e.services.dataSources.get(),t))}))},i})();i.FilterPaneController=u})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.explore.services,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprConverter,u=e.explore.util.VisualContainerUtils,p=e.explore.util.VisualHostServicesUtil,d=jsCommon.EnumExtensions,h=(function(){function i(e,t){var i=this;this.scope=e,this.services=t;var r=this.services.singleExecutableDataProxyFactory.create();this.visualDataProxyService=n.createExploreVisualDataProxyService(r,this.services.filterGenerator),this.crossFilteringHostService=this.createFilteringHostService();var a=this.scope.$watch("viewModel",(function(e){i.init(e),a()})),s=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})).subscribe(o.podParameterChanged,(function(e,t){return i.updateFilterConfig(t)}));this.scope.$on("$destroy",(function(){s.unsubscribeAll(),i.viewModel.setServices(void 0,i.services.visualPlugin),i.viewModel.readOnlyState.visual=void 0}))}return i.createOptions=function(){
return{additionalServices:["aggrOps","conceptualSchemaProxy","geocoder","localizationService","moduleLoader","promiseFactory","singleExecutableDataProxyFactory"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","filterRestatement","hostFiltersService","undoRedo","visualAuthoring","visualPlugin","visualQueryGenerator","visualRelationship"]}},i.prototype.init=function(i){var o=this;this.viewModel=i,this.viewModel.setServices(e.Prototype.inherit(t.services.createVisualHostServices(this.services.promiseFactory,this.services.moduleLoader,e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return o.persistProperties(e)},e.loadMoreData=function(){return o.loadMoreData()},e.promiseFactory=function(){return o.services.promiseFactory},e.analyzeFilter=function(e){return o.createAnalyzedFilter(e)},e.canSelect=function(e){return!0},e.setIdentityDisplayNames=function(e){return o.updateCachedLabel(e)},e.getIdentityDisplayNames=function(e){return o.getLabelForScopeId(e)}})),this.services.visualPlugin),this.getConceptualSchema().then((function(t){if(o.viewModel.updateFilterProperties(t,o.services.visualPlugin,o.services.aggrOps),o.viewModel.updateViewState(),o.viewModel.isSingleSelectionRequired){var i=o.viewModel.contract.config.singleVisual.objects;i||(i={});var n=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,a=e.visuals.slicerProps.selection.singleSelect;r.setValue(i,n,null,l.boolean(!1)),r.setValue(i,a,null,l.boolean(!0))}if(o.viewModel.readOnlyState.expanded)o.loadData(!1);else var s=o.scope.$watch("viewModel.readOnlyState.expanded",(function(e,t,i){e!==t&&e&&(o.loadData(!1),s())}));o.loadRestatement()}))},i.prototype.loadRestatement=function(){var e=this;this.services.filterRestatement.loadRestatement(this.services.dataSources.get(),this.viewModel.contract,this.viewModel.formatter).then((function(t){return e.viewModel.setRestatement(t)}))},i.prototype.createAnalyzedFilter=function(e){var i=this.viewModel.contract;e.filter=i.filter;var r=1!==i.howCreated&&!a.isDefaultFilter(i.filter),o=t.services.createAnalyzedFilter(e,r);return o},i.prototype.persistProperties=function(i){var r=this,o=this.viewModel;o.useDefaultFilter=!1;var n;if(i&&!_.isEmpty(i.merge)){var s=this.services.filterGenerator.tryGetFilterPropertyIdentifier(e.visuals.plugins.slicer.capabilities);n=i.merge[0].properties[s.propertyName]}if(!a.isSameFilter(o.contract.filter,n)&&(!a.isAnyFilter(o.contract.filter)||n)){var l=this.viewModel.readOnlyState.visual,c=__assign({},l.data);l.data=c,this.services.undoRedo.register("UpdateFilter",(function(){r.viewModel.contract.type=r.viewModel.readOnlyState.type,r.services.visualAuthoring.updateFilter(o.getFilterContainerScope().container,o.contract,n);var e=n?2:10,i={filter:o.contract,changeType:e,scope:o.getFilterContainerScope()};r.services.eventBridge.publishToChannel(t.services.events.filterContainerChanged,i),r.loadRestatement()}))}},i.prototype.createFilteringHostService=function(){var t=this;return e.Prototype.inherit(p.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,i){return{dataFilter:t.services.filterGenerator.calculateFilterContainerInputFilter(t.services.explorationNavigation.getCurrentExploration(),t.services.explorationNavigation.getCurrentSection(),t.viewModel.contract,i,t.viewModel.getFilterContainerScope())}}}))},i.prototype.loadMoreData=function(){this.visualDataProxyService.canLoadMore()&&this.loadData(!0)},i.prototype.loadData=function(e){var t=this;this.viewModel.isLoading=!0,this.hasQueryError=!1,this.getConceptualSchema().then((function(i){var r=t.services.dataSources.get(),o={dataSources:r,schema:i,config:t.viewModel.contract.config.singleVisual,hostServices:t.crossFilteringHostService,visualQueryGenerator:t.services.visualQueryGenerator,isLoadMore:e};return t.visualDataProxyService.runQuery(o).then((function(r){var o=t.visualDataProxyService.lastExecutedQuery();e===!0?t.onMergeMoreData(r,i,o.transforms):t.onDataChanged(r,i,o.transforms)}),(function(e){t.hasQueryError=!0})).finally((function(){t.viewModel.isLoading=!1}))}))},i.prototype.onDataChanged=function(e,t,i){var r=this.viewModel.readOnlyState.visual;if(e&&e.dataReaderResult&&r){var o={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null,dataViewSource:e&&e.dataViewSource?e.dataViewSource:null},n=u.isSegment(o.dataView);n&&(o.isFirstSegment=n),r.data=o,r.dataTransforms=i,this.viewModel.updateViewState(),this.dataLoaded=!0}},i.prototype.onMergeMoreData=function(t,i,r){var o=this.viewModel.readOnlyState.visual;if(t&&t.dataReaderResult&&o){var n=t.dataReaderResult.dataView;if(n){var a=o.data.dataView;e.data.segmentation.DataViewMerger.mergeDataViews(a,n);var s={dataView:a,dataViewSource:t&&t.dataViewSource,isFirstSegment:!1};o.data=s,o.dataTransforms=r}}},i.prototype.onFilterContainerChanged=function(i){var r=this.viewModel,o=r.readOnlyState.visual;if(i.filter===r.contract)if(d.hasFlag(i.changeType,2)){if(10===i.changeType)return o&&o.visual&&o.visual.onClearSelection(),void(r.contract.filter||r.setRestatement(t.viewModels.RestatementHelper.fromDataViewScopeIdentities([],!1,r.formatter)));a.isSameFilter(r.contract.filter,i.filter.filter)||(this.services.visualAuthoring.updateFilter(r.getFilterContainerScope().container,r.contract,i.filter.filter),null!=i.filter.filter&&this.loadData(!1))}else this.dataLoaded&&d.hasFlag(i.changeType,4)?this.loadData(!1):d.hasFlag(i.changeType,16)&&o&&o.visual&&o.visual.update({viewport:t.viewModels.FilterViewModel.DefaultVisualViewPort,type:e.VisualUpdateType.Resize,dataViews:null})},i.prototype.updateFilterConfig=function(t){if(2!==t.type){var i=this.viewModel.readOnlyState.visual;if(i&&i.data){var o=this.viewModel.isSingleSelectionRequired,n=i.dataTransforms.objects,a=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,s=e.visuals.slicerProps.selection.singleSelect;n||(n={}),r.setValue(n,a,null,l.boolean(!o)),r.setValue(n,s,null,l.boolean(o));var c={dataView:i.data.dataView,dataViewSource:i.data.dataViewSource,isFirstSegment:i.data.isFirstSegment};i.data=c}}},i.prototype.updateCachedLabel=function(t){if(!_.isEmpty(t)){var i=t[0].identity,r=i&&i.expr,o=e.data.ScopeIdentityExtractor.getKeys(r),n=this.viewModel.contract;1===o.length&&s.equals(n.expression,o[0])||(n.cachedValueItems=t,this.loadRestatement())}},i.prototype.getLabelForScopeId=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.getDisplayNameFromCache(o);n||(n={displayName:c.getFirstComparandValue(o),identity:o}),t.push(n)}return t},i.prototype.getDisplayNameFromCache=function(t){var i=this.viewModel.contract.cachedValueItems;if(!_.isEmpty(i))return _.find(this.viewModel.contract.cachedValueItems,(function(i){return e.DataViewScopeIdentity.equals(i.identity,t,!0)}))},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return e&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual?this.services.conceptualSchemaProxy.get(e):this.services.promiseFactory.reject()},i})();i.FilterVisualController=h})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.ImportVisualErrorDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.importVisual=function(){return t.importVisual()},this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.importVisual=function(){this.closeDialog(),this.scope.importVisualService.importWithDialog(this.scope.explorationContract)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.ImportVisualWarningDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.services=t,this.scope.eventBridge=this.services.eventBridge,this.scope.schemaItemActivationService=this.services.schemaItemActivation}return e.createOptions=function(){return{scopedDependencies:["eventBridge","schemaItemActivation"]}},e})();e.ModelingContextChangerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)?"":e.length>=260?t.get("ReportAppBar_SaveError_TooLong"):null}function i(e,i,r,o,n){var a=$.Deferred();n=n||i.get("ModalDialog_Save");var s=e.control();o=o||i.get("ReportAppBar_SaveAsDialogInstructions");var l='<div class="content"><div class="message instructions"></div><input type="text" class="explorationSaveAsName" /><div class="errorMessage"></div></div>',c=$(l);c.find(".message").text(o);var u=c.find(".explorationSaveAsName"),p=[new InJs.ModalDialogAction(n,function(e,t){var i=jsCommon.StringExtensions.trimWhitespace(u.val());s.hideDialog(),a.resolve(i)}),new InJs.ModalDialogAction(i.get("ModalDialog_Cancel"),function(e,t){s.hideDialog(),a.reject()})];return r=r||i.get("ReportAppBar_SaveAsDialogTitle"),s.showCustomDialog(r,c,p,(function(e){e.parent().find('input[value = "'+n+'"]').prop("disabled",!0),u.focus().on("change keyup paste mouseup",(function(r){var o=t($(r.target).val(),i);e.parent().find('input[value = "'+n+'"]').prop("disabled",null!==o),e.parent().find(".errorMessage").text(o)})).on("keyup",(function(e){13===e.which&&null===t($(e.target).val(),i)?p[0].actionCallback(null,null,null):27===e.which&&p[1].actionCallback(null,null,null)}))}),!0),a}e.validateReportName=t,e.showSaveAsDialog=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){for(var i=S.filterTransient(t),r=S.filterTransient(e),o=i.length-1;o>=0;o--){var n=i[o],a=r[o];n.id=a.id;for(var s=n.visualContainers.length-1;s>=0;s--){var l=n.visualContainers[s];l.id=a.visualContainers[s].id}}}function o(e,i,r,o,n,a){void 0===a&&(a=b.Unknown);var s=e.exploration.contract;if(i>-1&&s&&i<s.sections.length){r&&r.getSelectedElements().length>0&&r.clearSelection(),e.sectionStatus.currentSectionNumber=i;var l=s.sections[i];e.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(s,s.sections[i],n);for(var c=e.exploration.sections,u=c.length-1;u>=0;--u)c[u].selected=u===i;l.crossHighlight=void 0,o.goto(l,{action:a})}}function n(e,t,i){var r=e.exploration;r.contract.sections[i].displayName=t;var o=r.sections;o[i].displayName=t,o[i].isTabEditable=!1}function a(e,t,i,r){var o=e.exploration.contract,n=t.serializePage(o.sections[i],1),a=t.deserializePage(n);return a.name=c(o),a.displayName=r.format("DuplicateSectionName_StartingText",[a.displayName]),a}function s(e,i,r,n){i.id=void 0;var a=e.exploration.contract,s=a.sections;s.push(i),e.exploration.sections.push(t.viewModels.ViewModelFactory.convertSectionToViewModel(i)),o(e,s.length-1,r,n,0)}function l(e,t,i,r){var n=e.exploration.contract;if(t>-1&&n&&t<n.sections.length){var a=n.sections[t];n.sections.splice(t,1);var s=e.exploration.sections,l=s[t];l&&l.contract===a&&s.splice(t,1);var c=e.sectionStatus.currentSectionNumber;if(c===t){var u=t;u>=n.sections.length&&(u=n.sections.length-1),o(e,u,i,r,0)}else{var p=t>c?c:c-1;e.sectionStatus.currentSectionNumber=p,n.activeSectionIndex=p}}}function c(e){var t=_.map(e.sections,(function(e){return e.name})),i=_.zipObject(t,_.map(t,(function(){return!0})));return w.generateUniqueId(i,"ReportSection")}function u(e,t){for(var i=1,r=t.format("Explore_Section_Page",[i.toFixed()]);_.findLastIndex(e,(function(e){return e.displayName===r}))>=0;)r=t.format("Explore_Section_Page",[(++i).toFixed()]);return r}function p(e,i,r,n,a,s){var l=e.exploration.contract,p=l.sections;a||(a={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultWidescreenWidth,height:t.constants.ExploreCanvasConstants.DefaultWidescreenHeight});var d={name:c(l),displayName:u(l.sections,n),size:a,objects:s,visualContainers:[],filters:[]};p.push(d),e.exploration.sections.push(t.viewModels.ViewModelFactory.convertSectionToViewModel(p[p.length-1])),o(e,p.length-1,i,r,0)}function d(e,t){if(e&&e.sections){var i=e.sections,r=_.findIndex(i,(function(e){return e.name===t}));return r!==-1?r:void 0}}function h(e,t){if(!e||!e.sections)return-1;var i=e.sections,r=_.findIndex(i,(function(e){return e===t}));return r}function v(e,t){return e&&e.sections?y.findWithId(e.sections,t):null}function g(e,t){if(!e||!e.sections)return-1;var i=e.sections,r=_.findIndex(i,(function(e){return e.id===t}));return r}function f(e,t){for(var i=e.sections,r=0,o=i;r<o.length;r++){var n=o[r];n.displayName||(n.displayName=u(e.sections,t))}}function m(e,t,i){if(t<0||i<0)return!1;var r=!1,o=e.exploration.contract.sections,n=o[t];o.splice(t,1),o.splice(i,0,n);var a=e.exploration.sections,s=a[t];s&&s.contract===n&&(a.splice(t,1),a.splice(i,0,s),r=!0);for(var l=a.length-1;l>=0;--l)if(a[l].selected){e.sectionStatus.currentSectionNumber=l;break}return r}var y=jsCommon.ArrayExtensions,w=e.common.utils.IdUtility,S=e.explore.contracts.Section,b=e.explore.services.SectionNavigationAction;i.synchronizeSectionsIds=r,i.gotoSection=o,i.renameSection=n,i.duplicateSection=a,i.insertSection=s,i.deleteSection=l,i.createSection=p,i.findSectionIndexForSectionName=d,i.findSectionIndexForSection=h,i.findSectionById=v,i.findSectionIndexForSectionId=g,i.fillDefaultSectionDisplayNames=f,i.reorderSection=m})(i=t.SectionUtils||(t.SectionUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=8192,o=8192,n=128,a=(function(){function i(e,t){var i=this;this.scope=e,this.services=t,this.scope.eventBridge=this.services.eventBridge,this.scope.generateEmbedCode=function(){return i.generateEmbedCode()},this.scope.goToConfirmation=function(){return i.goToConfirmation()},this.scope.generateEmbedCodeAndGoToSuccess=function(){return i.generateEmbedCodeAndGoToSuccess()},this.scope.getCode=function(e){return i.getCode(e)},this.scope.showDeleteMessage=function(e){return i.showDeleteMessage(e)},this.scope.formatDate=function(e){return i.formatDate(e)},this.scope.refresh=function(e){return i.refresh(e)},this.scope.delete=function(e){return i.delete(e)},this.scope.interactiveReportEmbedEnabled=this.services.featureSwitchService.featureSwitches.anonymousEmbeddingEnabled,this.scope.updateEmbedTab=function(e){return i.updateEmbedTab(e)},this.scope.showEmbedCode=function(){return i.showEmbedCode()},this.scope.nameChanged=function(){return i.nameChanged()},this.scope.sizeChanged=function(){return i.sizeChanged()},this.scope.pagesChanged=function(e,t){return i.pagesChanged(e,t)},this.scope.updateSize=function(){return i.updateSize()},this.scope.includeShareLinkChanged=function(){return i.reset()},this.scope.setSharepointEmbedLink=function(){return i.setSharepointEmbedLink()},this.updateEmbedTypes(),this.updateSize(),this.setSharepointEmbedLink()}return i.createOptions=function(){return{additionalServices:["embedProxy","localizationService","notificationToast","telemetryService","featureSwitchService","embed","promiseFactory"],scopedDependencies:["eventBridge"]}},i.prototype.goToConfirmation=function(){this.scope.viewModel.publishState=2},i.prototype.generateEmbedCodeAndGoToSuccess=function(){var e=this,t=function(){e.scope.viewModel.publishState=3};this.generateEmbedCode(t)},i.prototype.generateEmbedCode=function(i){var r=this,o=this.scope.viewModel.embedTab;o.generating=!0;var n=o.embed,a=o.selectedSection,s=[],l=this.services.localizationService.get("Embed_EntireReport");a.contract.displayName===l&&a.contract.id===-1?(s=_.map(o.sections,(function(e){return e.contract.id})),s=_.filter(s,(function(e){return e!==-1}))):s.push(a.contract.id);var c,u={enableShareLink:o.embed.enableShareLink,ignoreExistingCache:!0},p=o.selectedEmbedType.value===t.contracts.EmbedType.Interactive?e.telemetry.EXPublicEmbedCreate:e.telemetry.EXSnapshotEmbedCreate,d=this.services.telemetryService.startEvent(p);c=o.selectedEmbedType.value===t.contracts.EmbedType.Static?this.services.embed.createEmbedReportResource(this.scope.viewModel.exploration.contract,s,u):this.services.promiseFactory.resolve(null),c.then((function(a){var l=JSON.stringify({resourceLang:e.common.localizedStrings?e.common.cultureInfo:"en-US",cultureLang:e.common.cultureInfo}),c={snapshotEmbedResource:null!=a?JSON.stringify(a):"{}",options:{name:n.contract.name,culture:l,version:e.build,type:t.contracts.SnapshotReportType,size:{height:n.contract.size.height,width:n.contract.size.width},reportId:r.scope.viewModel.exploration.contract.reportId,metadata:JSON.stringify({reportSections:s}),embedType:o.selectedEmbedType.value}};r.services.embedProxy.createEmbed(c).then((function(e){r.scope.viewModel.currentEmbed=e;var n=t.viewModels.ViewModelFactory.createEmbed(e);n.embedCode=r.services.embed.createEmbedCode(e),n.link=r.services.embed.createEmbedUri(e),o.embed=n,r.scope.viewModel.embeddedInTab.embeds.push(n),o.error.exist=!1,d.resolve(),i&&i()}),(function(e){var t=o.error;t.type="create",t.info=r.services.localizationService.get("Embed_CreateError"),t.message=e.error.message,t.requestId=e.requestId,t.activityId=e.activityId,t.exist=!0,d.reject()})).finally((function(){o.generating=!1,o.edit=!0}))}))},i.prototype.checkEnabled=function(){var e=this.scope.viewModel.embedTab;return 0===e.nameError.length&&0===e.sizeError.length},i.prototype.nameChanged=function(){var e=this.scope.viewModel.embedTab,t=e.embed.contract.name.length;0===t?e.nameError=this.services.localizationService.get("Embed_NameErrorEmpty"):t>n?e.nameError=this.services.localizationService.get("Embed_NameErrorTooLong"):e.nameError="",e.disabled=!this.checkEnabled(),this.reset()},i.prototype.pagesChanged=function(e,t){var i=this.scope.viewModel.embedTab.embed.contract.name;i=i.replace(t,e),this.reset()},i.prototype.updateEmbedTab=function(e){this.showEmbedCode()&&this.reset(),1===e&&(this.scope.viewModel.embedTab.error.exist=!1),this.scope.viewModel.viewModeState=e},i.prototype.getCode=function(e){if(e.showCode||e.refreshingData)return void(e.showCode=!1);if(e.embedCode.length<=0){var t=this.services.embed.createEmbedCode(e.contract);e.embedCode=t,e.showCode=!0}else e.showCode=!0},i.prototype.showDeleteMessage=function(e){return e.refreshingData?void(e.deleteRequest=!1):(e.deleteRequest=!0,void(e.showCode=!1))},i.prototype.formatDate=function(e){var t=e.contract.date.slice(8,27),i=new Date(Date.parse(t));return i.toLocaleDateString()},i.prototype.refresh=function(t){var i=this;t.refreshingData=!0;var r={ignoreExistingCache:!0},o=JSON.parse(t.contract.metadata),n=o.reportSections;this.services.embed.createEmbedReportResource(this.scope.viewModel.exploration.contract,n,r).then((function(r){var o={snapshotEmbedResource:JSON.stringify(r),options:{version:e.build}};i.services.embedProxy.saveSnapshotEmbed(t.contract.snapshotId,o).then((function(r){i.services.notificationToast.notify({title:i.services.localizationService.get("Embed_RefreshSuccess"),message:i.services.localizationService.format("Embed_RefreshSuccessDetail",[t.contract.name]),notificationType:e.common.NotificationToastType.Success}),t.error.exist=!1})).catch((function(e){var r=t.error;r.type="refresh",r.exist=!0,r.info=i.services.localizationService.get("Embed_RefreshError"),r.message=e.error.message,r.requestId=e.requestId,r.activityId=e.activityId})).finally((function(){t.refreshingData=!1}))}))},i.prototype.delete=function(t){var i=this;t.deleteConfirm=!0;var r=this.services.telemetryService.startEvent(e.telemetry.EXSnapshotEmbedDelete);this.services.embedProxy.deleteSnapshotEmbed(t.contract.snapshotId).then((function(){var o=i.scope.viewModel.embeddedInTab.embeds.indexOf(t);i.scope.viewModel.embeddedInTab.embeds.splice(o,1),i.services.notificationToast.notify({title:i.services.localizationService.get("Embed_DeleteSuccess"),message:i.services.localizationService.format("Embed_DeleteSuccessDetail",[t.contract.name]),notificationType:e.common.NotificationToastType.Success}),r.resolve()}),(function(e){var o=t.error;o.exist=!0,o.type="delete",o.info=i.services.localizationService.get("Embed_DeleteError"),o.message=e.error.message,o.requestId=e.requestId,o.activityId=e.activityId,r.reject(),t.deleteConfirm=!1}))},i.prototype.sizeChanged=function(){var e=this.scope.viewModel.embedTab,t=e.embed.contract.size;if(t.width<=0||t.height<=0?e.sizeError=this.services.localizationService.get("Embed_SizeErrorNegative"):t.width>r||t.height>o?e.sizeError=this.services.localizationService.get("Embed_SizeErrorTooLarge"):e.sizeError="",e.disabled=!this.checkEnabled(),this.showEmbedCode()){var i=this.services.embed.createEmbedCode(this.scope.viewModel.currentEmbed);e.embed.embedCode=i}else this.reset()},i.prototype.updateEmbedTypes=function(){},i.prototype.updateSize=function(){var e=this.scope.viewModel.embedTab,i=this.scope.viewModel.currentEmbed.size;switch(e.selectedEmbedSize.value){case t.viewModels.EmbedSize.Small:i.height=t.viewModels.EmbedSizes.small.height,i.width=t.viewModels.EmbedSizes.small.width;break;case t.viewModels.EmbedSize.Medium:i.height=t.viewModels.EmbedSizes.medium.height,i.width=t.viewModels.EmbedSizes.medium.width;break;case t.viewModels.EmbedSize.Large:i.height=t.viewModels.EmbedSizes.large.height,i.width=t.viewModels.EmbedSizes.large.width}if(e.disabled=!1,this.showEmbedCode()){var r=this.services.embed.createEmbedCode(this.scope.viewModel.currentEmbed);e.embed.embedCode=r}},i.prototype.showEmbedCode=function(){var e=this.scope.viewModel.embedTab.embed.embedCode;return this.scope.viewModel.currentEmbed&&e&&e.length>0},i.prototype.reset=function(){this.scope.viewModel.currentEmbed=null,this.scope.viewModel.embedTab.embed.embedCode=""},i.prototype.setSharepointEmbedLink=function(){var e=this.scope.viewModel.publishState;if(5===e){var t=this.scope.viewModel.embedTab,i=this.scope.viewModel.exploration.contract.report.objectId;t.embed.link=this.services.embed.createSharepointEmbedUri(i)}},i})();i.EmbedModalDialogController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.scope.toggleTaskPane=function(){return t.toggleTaskPane()}}return e.createOptions=function(){return{}},e.prototype.toggleTaskPane=function(){this.scope.viewModel.isPaneExpanded=!this.scope.viewModel.isPaneExpanded},e})();e.TaskPaneController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.constants,o=e.common.events,n=t.util.DragDropTypes,a=e.common.directives.DragDropUtils,s=e.data.dsr.DsrMessage,l=t.services.events,c=t.util.QueryGeocodingTracker,u=t.services.selectionUtils,p=e.data.Selector,d=e.data.SQExprUtils,h=e.data.SQExprConverter,v=t.util.VisualContainerUtils,g=t.contracts.VisualLink,f=e.visualHost.visualPluginServiceHelpers,m=(function(){function i(i,o){var a=this;this.lastProgressBarState={progressBarCount:0,detailVisualProgressBarCount:0,hasPendingGeocoding:!1},this.scope=i,this.services=o,this.isExplorationUnloaded=!1,this.queryExecutionServices={getDataSources:function(){return a.services.dataSources.get()},notifyStart:function(){return a.startProgressBar()},notifyEnd:function(){return a.stopProgressBar()},clearErrors:function(){return a.scope.ctrlError.clearError()},handleErrors:function(e){return a.handleQueryErrors(e)},handleWarnings:function(e,t){return a.handleWarnings(e,t)},applyUpdate:function(e,t,i){return a.handleQueryResult(e,t,i)},loadMergedData:function(e){return a.loadMergedData(e)}},this.initializeVisualContainerQueryHandler(),this.progressBarCount=0,this.detailVisualProgressBarCount=0,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(i),this.visualContainerDataSelectionService=t.services.createVisualContainerDataSelectionService(this.scope.viewModel,new e.data.DataViewQueryEngine,this.services.visualPluginOps),this.scope.getVisualContainerStyle=function(){return a.computeStyle()},this.scope.isHeaderVisible=function(){return a.isHeaderVisible()},this.scope.canRemoveFromLayout=function(){return a.canRemoveFromLayout()},this.scope.removeVisualFromLayout=function(){return a.removeVisualFromLayout()},this.scope.isPopOutBarVisible=function(){return a.isPopOutBarVisible()},this.scope.shouldRestrictTransformDraw=function(){return a.shouldRestrictTransformDraw()},this.scope.viewModeState=o.viewModeState,this.scope.viewModel.showWatermark=!1,this.scope.viewModel.options=o.explorationCapabilities.getCapabilities().visualContainerOptions,this.endLoadDefer=this.services.promiseFactory.defer(),this.scope.$watch("viewModel.errorInfo",(function(){return a.updateDetailVisualVisibility()})),this.scope.toggleSelect=function(e,t){return a.toggleSelect(e,t)},this.scope.onVisualContainerChanged=function(){return a.onVisualContainerChangedAsync()},this.setOnClearSelectedDataPoints(),this.scope.menuOptions={canDelete:!1,canExport:!1,canSort:!1,canSearch:!1,canCluster:!1,canSpatialCluster:!1,hasMoreOptions:!1,canEdit:!1,sortSetting:{defaultSortBehavior:!1,sortableFields:[]},canSeeData:!1,canSpotlight:this.services.featureSwitchService.featureSwitches.spotlight},this.sortHelper=e.explore.services.createVisualSortHelper(this.scope.menuOptions.sortSetting,this.scope.viewModel,this.services.sort,this.services.undoRedo,this.services.timeout,this.services.visualAuthoring),this.scope.hasPositionOverride=function(){return null!=a.scope.viewModel.overridePosition},this.scope.getDragRestriction=function(){return a.getDragRestrictElementRect()},this.scope.drop=function(e,t){return a.drop(e,t)},this.scope.dropConfig={accept:n.Field,greedy:!1},this.scopeEventManager.subscribe(t.constants.explorationLoadedEventName,(function(){return a.applyUpdate(!0)})),this.instanceId=jsCommon.Utility.generateGuid();var s=this.scope.viewModel.contract.config.singleVisual.visualType;this.services.visualInstanceIdTracking.associate(this.instanceId,s),this.visualHostTelemetryService=t.services.createVisualHostTelemetryService(o.telemetryService,s,this.instanceId),this.setViewModelServices(),this.scope.closePopOut=function(){a.setPopOutMode(0),2===a.services.viewModeState.getMode()&&a.services.viewModeState.setMode(1),a.scope.viewModel.setEditMode(0)},this.scope.disablePin=this.scope.viewModel.options.disablePin,this.scope.$watch("viewModel.options.disablePin",(function(){return a.updateDisablePin()})),this.resetVisualStyle(),this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.resetSortSettings(),this.scope.viewModel.updateViewState(),this.updateSelection(),this.resetPadding(),this.scopeEventManager.subscribe(t.constants.TransformElementDragStartEventName,(function(e,t){a.isSelected()||a.selectVisualContainer()})),this.scopeEventManager.subscribe(r.visualReady,(function(e){e.stopPropagation(),a.endLoadDefer.resolve(null),a.services.eventBridge.publishToChannel(l.visualContainerDataRendered,a.scope.viewModel.contract)})),this.createCanvasLayoutItemOptions(),this.subscribeToEvents();var u=this.scope.viewModel.contract,p=!u.initialLoadCompleted;u.initialLoadCompleted=!0;var d;this.services.networkAvailability.isNetworkAvailable()||(d=!0),this.scope.$applyAsync((function(){return a.onVisualContainerChangedAsync(p,d)})),this.geocodingTracker=new c({onStartGeocoding:function(){a.updateProgressBarState(),a.scope.$applyAsync()},onStopGeocoding:function(){a.updateProgressBarState(),a.scope.$applyAsync()}}),this.setTransformScopeProperties(this.scope),this.registerDomEventHandlers(),this.contextMenu=o.visualContainerContextMenuFactory.create()}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dataProxy","displayNameService","dragDataService","$element","embedModeService","errorService","explorationSerializer","featureSwitchService","geocoder","localizationService","moduleLoader","networkAvailability","overlayService","promiseFactory","singleExecutableDataProxyFactory","telemetryService","visualHostTooltip","trustedVisual","visualInstanceIdTracking"],scopedDependencies:["clipboard","dataSources","drill","eventBridge","explorationCapabilities","explorationNavigation","filterGenerator","formFactor","groupingDesignStateService","layoutAuthoring","lazyScoped","lazyScopedSync","resourceLoader","scriptVisuals","selection","shell","sort","undoRedo","uiComponent","viewModeState","visibility","visualAuthoring","visualContainerContextMenuFactory","visualPlugin","visualPluginOps","visualQueryGenerator","visualValidator"]}},i.prototype.registerDomEventHandlers=function(){var e=this,t=this.scope,i=this.services.viewModeState.getConfig().displayOptions;if(t.onDoubleClick=function(t){return e.onDoubleClick(t)},t.onVCBodyClick=function(t){return e.onVCBodyClick(t)},t.onTouchend=function(t){return e.onTouchend(t)},!i.visualMouseoverDisabled){var r=this.services.$element;r.on("mouseenter",(function(){return t.$applyAsync((function(){return e.setHover(!0)}))})),r.on("mouseleave",(function(){return t.$applyAsync((function(){return e.setHover(!1)}))}))}},i.prototype.setTransformScopeProperties=function(t){var i=this.services.formFactor.getCurrentLayoutCapabilities();t.aspectRatioOffset=e.explore.viewModels.VisualContainer.getVisualBodyOffset(i)},i.prototype.initializeVisualContainerQueryHandler=function(){this.queryHandler=t.services.createVisualContainerQueryHandler(this.queryExecutionServices,this.scope.viewModel.hostServices,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.visualPluginOps,this.services.dataProxy,this.services.networkAvailability,this.services.singleExecutableDataProxyFactory,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell)},i.prototype.computeStyle=function(){var e=this.scope.viewModel,t=this.services.viewModeState,i=this.services.viewModeState.getConfig(),r=t.getMode(),o=!this.showSelectionBorder&&0===r&&!i.displayOptions.showVisualBordersInViewMode;return{loading:!e.contract.initialLoadCompleted,selected:e.isSelected,"swipeable-blocked":e.isSelected,readMode:0===r,editMode:1===r,hideBorder:o,disableFadeout:i.displayOptions.disableFadeout,popOut:e.isPoppedOut,seeData:this.services.visibility.isSeeDataMode(this.scope.viewModel.contract.visibility),spotlight:4===e.contract.visibility,seeDataVerticalLayout:2===e.contract.detailVisualLayout,paddingDisabled:e.isPaddingDisabled,noVisualTitle:!e.visualTitleVisible(),preventVisualScrolling:this.preventInnerScroll()}},i.prototype.toggleSelect=function(e,i){var r=this;if(this.showSelectionBorder=i,e.ctrlKey&&this.isSelected()&&u.getSelectedVisuals(this.services.selection).length>1)return t.util.EventBubblingUtility.markAsHandled(e),this.services.overlayService.hideAllDropdowns(),void u.unselectVisualContainer(this.scope.viewModel.contract,this.services.selection);this.selectVisualContainer(e.ctrlKey),this.services.overlayService.hideAllDropdowns();var o=!t.util.EventBubblingUtility.handled(e),n=$(e.currentTarget);t.util.EventBubblingUtility.markAsHandled(e),
this.services.timeout((function(){o&&n.focus(),r.services.clipboard.tryPasteFormat()}))},i.prototype.setHover=function(e){this.isHovering=e},i.prototype.onDoubleClick=function(e){this.services.viewModeState.getConfig().visualDoubleClickEnabled&&this.popOutVisualContainer()},i.prototype.onVCBodyClick=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,r,o,n;return __generator(this,(function(a){switch(a.label){case 0:return this.ensureFocus(t),e=this.services.viewModeState.getMode(),0===e||1===e&&t.ctrlKey?(i=this.getVisualLink(),i&&i.show?(r=g.getType(i),r!==g.Back?[3,1]:(this.services.explorationNavigation.back(),[3,4])):[3,5]):[3,5];case 1:return r!==g.Bookmark?[3,3]:(o=i.bookmark,o?[4,this.services.lazyScoped("bookmark")]:[2]);case 2:return n=a.sent(),n.applyByName(o),[3,4];case 3:a.label=4;case 4:t.stopPropagation(),a.label=5;case 5:return[2]}}))}))},i.prototype.updateVCBodyProperties=function(){var e=this.services.viewModeState.getMode(),t=this.getVisualLink(),i=t&&t.show;this.scope.vcBodyStyle={visualLink:i};var r=null;if(i){var o=g.getType(t),n=1===e?"Visual_VisualLink_Click_EditTooltip":"Visual_VisualLink_Click_ViewTooltip",a=void 0;a=o===g.Back?this.services.localizationService.get("Visual_VisualLink_Back_Tooltip"):this.services.localizationService.get("Visual_VisualLink_Bookmark_Tooltip"),r=this.services.localizationService.format(n,[a])}this.scope.vcBodyTitle=r},i.prototype.getVisualLink=function(){var e=this.scope.viewModel.readOnlyState.visual,t=e&&this.services.visualPlugin.capabilities(e.type);if(t&&t.supportsVisualLink)return this.scope.viewModel.contract.config.singleVisual.visualLink},i.prototype.onTouchend=function(e){this.services.visualHostTooltip.visible()&&this.services.viewModeState.getConfig().touchOptions.disableTouchendOnTooltip&&e.preventDefault()},i.prototype.onContextMenu=function(e){var t=this.scope;t.viewModel.options.showContextMenu&&(t.dataRoles=e.dataRoles,t.contextMenuData=e.data,this.isSelected()||this.selectVisualContainer(),this.contextMenu.create(t.viewModel.contract,t.contextMenuData,t.dataRoles,e.position))},i.prototype.ensureFocus=function(e){t.util.FocusUtility.isFocusInTree($(e.currentTarget))&&t.util.EventBubblingUtility.markAsHandled(e)},i.prototype.setViewModelServices=function(){var i=this;this.scope.viewModel.setServices({getLocalizedString:function(e){return i.services.localizationService.get(e)},canSelect:function(e){return i.canSelect(e)},onDragStart:function(e){return i.onDragStart(e)},onContextMenu:function(e){return i.onContextMenu(e)},onSelecting:function(e){return i.onSelecting(e)},onSelect:function(e){return i.onSelect(e)},persistProperties:function(e,t){return i.persistProperties(e,t)},shouldRetainSelection:function(){return i.shouldRetainSelection()},loadMoreData:function(){return i.loadMoreData()},onCustomSort:function(e){return i.onCustomSort(e.sortDescriptors)},getViewMode:function(){return i.scope.viewModeState.getMode()},getEditMode:function(){return i.scope.viewModel.editMode},setWarnings:function(e){return i.setClientWarnings(e)},setToolbar:function(e){return i.setToolbar(e)},geocoder:function(){return i.geocodingTracker.wrapGeocoder(i.services.geocoder)},geolocation:function(){return e.visuals.services.createGeolocation()},locale:function(){return e.common.unmappedCultureInfo},promiseFactory:function(){return i.services.promiseFactory},analyzeFilter:function(e){return t.services.createAnalyzedFilter(e,!1)},setIdentityDisplayNames:_.noop,getIdentityDisplayNames:function(e){return i.getLabelForScopeId(e)},visualCapabilitiesChanged:function(){return i.visualCapabilitiesChanged()},tooltips:function(){return i.services.visualHostTooltip},telemetry:function(){return i.visualHostTelemetryService},loader:function(){return i.services.moduleLoader},getUIComponentFactory:function(){return i.services.uiComponent.getUIComponentFactory(i.scope)},applyJsonFilter:function(e,t,r,o){return i.applyJsonFilter(e,t,r,o)},instanceId:this.instanceId,refreshHostData:function(){return i.refreshHostData()}},this.services.visualPlugin,this.services.visualPluginOps,this.scope.viewModeState,this.services.formFactor,this.services.visibility,{getNextDataSegment:function(){return i.getNextDataSegment()},startProgressBar:function(){return i.startProgressBar()},stopProgressBar:function(){return i.stopProgressBar()}})},i.prototype.visualCapabilitiesChanged=function(){this.convertTo(this.scope.viewModel.readOnlyState.visual.type),this.services.eventBridge.publishToChannel(l.visualContainerChanged,{affectContainer:function(){return!0}})},i.prototype.getLabelForScopeId=function(e){return _.map(e,(function(e){return{displayName:h.getFirstComparandValue(e),identity:e}}))},i.prototype.createCanvasLayoutItemOptions=function(){var e=this,t=function(t,i){e.hideOverlays()},i=function(t,i){1===e.services.selection.getSelectedElements().length&&e.updateDimensions(t,i)},r=function(t,i){if(e.isEditable()&&!e.scope.viewModel.isPoppedOut&&1===e.services.selection.getSelectedElements().length){var r=new w(e.scope.viewModel.id,"nudge");e.updateDimensions(t,i,r),e.services.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1})}},n=function(t,i){e.hideOverlays(),e.services.eventBridge.publishToChannel(o.visualContainerResizeStart)},a=function(t,i){return e.updateVisualViewport(t,i)},s=function(t,i){e.updateDimensions(t,i),e.services.eventBridge.publishToChannel(o.visualContainerResizeEnd)},l=function(){return e.isExplorationUnloaded},c=function(){return e.getPosition(e.scope.viewModel.contract)},u=function(){return e.scope.viewModel.uiScale};this.scope.canvasLayoutItemOptions={dragEnd:i,dragStart:t,nudge:r,resizeStart:n,resizeMove:a,resizeEnd:s,isSuspended:l,getPosition:c,getScale:u}},i.prototype.subscribeToEvents=function(){var i=this,r=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualThemeChanged,(function(){return i.onVisualThemeChanged()})).subscribe(l.selectionChanged,(function(){return i.updateSelection()})).subscribe(l.visualContainerChanged,(function(e,t){t&&t.affectContainer(i.scope.viewModel.contract)&&i.onVisualContainerChangedAsync(!1,t.allowCache)})).subscribe(l.filterContainerChanged,(function(e,t){i.onFilterContainerChanged(t)})).subscribe(l.dataSelectionChanged,(function(e,t){t&&t.affectContainer(i.scope.viewModel.contract)&&i.clearDataSelection()})).subscribe(l.explorationUnloaded,(function(e,t){i.scopeEventManager.unsubscribeAll(),i.isExplorationUnloaded=!0})).subscribe(l.changeViewMode,(function(e,t){return i.onChangeViewMode(t)})).subscribe(l.visibilityChanged,(function(){var e=i.scope.viewModel.readOnlyState.visual;e.isInFocus=i.scope.viewModel.isPoppedOut,i.detailVisualProgressBarCount&&!i.services.visibility.isSeeDataMode(i.scope.viewModel.contract.visibility)&&i.clearDetailVisualProgressBar(),i.scope.viewModel.updateViewState(),v.isScriptVisual(i.scope.viewModel.contract,i.services.visualPlugin)&&i.applyUpdate()}));this.services.eventBridge.subscribeToBubbling(this.scope,t.viewModels.DetailVisualEvents.spinnerAction,(function(e,t){if(e.stopPropagation&&e.stopPropagation(),i.services.visibility.isSeeDataMode(i.scope.viewModel.contract.visibility))switch(t){case 0:i.startDetailVisualProgressBar();break;case 1:i.stopDetailVisualProgressBar()}})),this.services.eventBridge.subscribeToBubbling(this.scope,l.toggleSortVisualContainer,(function(e,t){i.sortHelper.toggleSort(t.sortableField,t.sortDirection)})),this.services.eventBridge.subscribeToBubbling(this.scope,l.getClusters,(function(t,r){return __awaiter(i,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.services.lazyScoped("clustering")];case 1:return e=t.sent(),e.createClusters(this.scope.viewModel,this.services.dataSources.get(),r.useSpatialClustering),[2]}}))}))})),this.services.eventBridge.subscribeToBubbling(this.scope,l.changeEditMode,(function(e,t){i.onChangeEditMode(t)}));var n,a=this.scope.viewModel.contract.config.singleVisual.visualType;!a||this.services.trustedVisual.canLoadVisual(a)&&this.services.visualPlugin.getPlugin(a)||(n=this.services.rootScope.$on(e.constants.reloadEmptyVisuals,(function(e,t){_.contains(t.visualTypes,a)&&(n(),i.onVisualContainerChangedAsync())}))),this.scope.$on("$destroy",(function(){r.unsubscribeAll(),n&&n(),i.scope.viewModel.contract.config.singleVisual.getCurrentVisual=void 0,i.scope.viewModel.contract.config.singleVisual.getErrorDetails=void 0,i.scope.viewModel.contract.config.singleVisual.getWarnings=void 0,i.scope.viewModel.contract.config.singleVisual.getSelectedDataPoints=void 0,i.scope.viewModel.contract.config.singleVisual.getCurrentDataViews=void 0,i.scope.viewModel.reset()}))},i.prototype.onFilterContainerChanged=function(e){if(0!==e.scope.scopeType||e.scope.container===this.scope.viewModel.contract)switch(e.changeType){case 1:case 0:null!=e.filter&&null!=e.filter.filter&&this.applyUpdate();break;case 10:case 2:this.applyUpdate()}},i.prototype.drop=function(t,i){var r=this.services.dragDataService.getDragContext();r&&r.field&&a.isDropOnExpectedTarget(i.draggable,this.scope.viewModel.contract)&&(u.selectVisualContainer(this.scope.viewModel.contract,this.services.selection),this.services.visualAuthoring.addFieldToVisual(r.field,this.services.dataSources.get(),this.scope.viewModel.contract,e.telemetry.HowFieldWasAddedToVisual.DraggedToVisual))},i.prototype.getDragRestrictElementRect=function(){var e={top:0,left:0,bottom:1,right:1};if(u.hasMultipleVisualContainerSelection(this.services.selection)){for(var t=u.getSelectedVisuals(this.services.selection),i=0,r=0,o=0,n=0,a=null,s=0,l=0,c=t.length;l<c;l++){s=l;var p=t[l],d=this.scope.viewModel.contract;if(p===d){a=this.getPosition(p);break}}if(!a)return;if(t.splice(s,1),a){for(var h=0,v=t;h<v.length;h++){var p=v[h],g=this.getPosition(p),f=a.x-g.x;i=i<f?f:i,f=g.y+g.height-(a.y+a.height),r=r<f?f:r,f=a.y-g.y,o=o<f?f:o,f=g.x+g.width-(a.x+a.width),n=n<f?f:n}e={top:0-(o>0?o/a.height:0),left:0-(i>0?i/a.width:0),bottom:1+(r>0?r/a.height:0),right:1+(n>0?n/a.width:0)}}}return e},i.prototype.setClientWarnings=function(e){if(_.isEmpty(e))return void(this.warnings=null);if(_.isArray(e)?this.warnings={warnings:e}:this.warnings=e,!_.isEmpty(this.warnings.warnings)){var t=this.warnings.warnings[0].getMessages(this.services.localizationService),i={message:t.message,displayableErrorInfo:[{errorInfoKey:t.title,errorInfoValue:t.detail}]};this.scope.ctrlError.showInfoIcon(i,this.warnings.warnings[0].code)}},i.prototype.setToolbar=function(e){this.scope.viewModel.toolbarViewModel.$element=e,this.scope.viewModel.toolbarViewModel.update(),null!=e&&this.setToolbarVisible(!0)},i.prototype.setToolbarVisible=function(e){var t=this;if(this.scope.viewModel.toolbarViewModel.$element){var i=this.services.viewModeState.getMode();if(e=e&&this.scope.viewModel.isSelected&&1===i){var r=this.services.formFactor.getCurrentLayoutCapabilities();e=r.canShowVisualToolbar()}this.scope.viewModel.toolbarViewModel.visible!==e&&this.scope.$applyAsync((function(){t.scope.viewModel.toolbarViewModel.visible=e,t.scope.viewModel.toolbarViewModel.update()}))}},i.prototype.hideOverlays=function(){this.services.overlayService.hideAllDropdowns(),this.setToolbarVisible(!1)},i.prototype.onVisualThemeChanged=function(){this.resetVisualStyle(),this.onVisualContainerChangedAsync(!1,!0)},i.prototype.shouldRunQueries=function(){return!t.contracts.VisualContainer.isHidden(this.scope.viewModel.contract.config.singleVisual)},i.prototype.onVisualContainerChangedAsync=function(e,t){var i=this;if(this.shouldRunQueries())return this.startProgressBar(),f.ensurePlugin(this.scope.viewModel.contract.config.singleVisual.visualType,this.services.visualPlugin,this.services.moduleLoader,this.services.promiseFactory).then((function(){var r=i.scope.viewModel,o=r.contract.config.singleVisual;o.getCurrentVisual=function(){return r.readOnlyState.visual.visual},o.getErrorDetails=function(){return i.getErrorDetails()},o.getWarnings=function(){return i.getWarnings()},o.getSelectedDataPoints=function(){return i.getSelectedDataPoints()},o.getCurrentDataViews=function(){return r.readOnlyState.visual.dataViews},i.setOnClearSelectedDataPoints(),i.updateVisualContainerProperties();var n=r.dataViewSource,a=i.scope.viewModel.readOnlyState.visual;n?(i.queryHandler.visualizeDataViewSource(r.contract,n,a.viewport),r.dataViewSource=null):i.services.visualQueryGenerator.shouldExecute(o,i.services.dataSources.get())?i.scope.viewModel.errorInfo||i.applyUpdate(e,!1,t):i.queryHandler.updateNonQueryVisual(r.contract,{objects:o.objects})})).finally((function(){return i.stopProgressBar()}))},i.prototype.updateVisualContainerProperties=function(){var e=this.scope.viewModel;this.scope.ctrlError.clearError();var t=this.services.visualValidator.validate(e.contract);t&&(this.scope.ctrlError.showErrorOverlay(t.details,t.code),this.updateDisablePin()),this.updateDetailVisualVisibility(),this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.resetPadding(),this.resetSortSettings(),this.updateMenuButtonsState(),this.updateVCBodyProperties(),this.scope.viewModel.errorInfo||e.updateViewState()},i.prototype.getErrorDetails=function(){if(this.scope.viewModel.errorInfo)return this.scope.viewModel.errorInfo.details},i.prototype.getWarnings=function(){return this.warnings},i.prototype.getSelectedDataPoints=function(){return this.selectedDatapoints},i.prototype.updateMenuButtonsState=function(){var e=this.scope.viewModel,t=this.services.viewModeState.getMode(),i=this.scope.menuOptions;i.canExport=this.canExport(),i.canDelete=1===t&&this.services.viewModeState.getConfig().supportsDeletion;var r=i.sortSetting;i.canSort=r.defaultSortBehavior&&r.sortableFields.length>0,i.canEdit=this.canEdit();var o=[],n=this.canSearch().then((function(e){i.canSearch=e}));o.push(n),o.push(this.canCluster().then((function(e){i.canCluster=e.canCluster,i.canSpatialCluster=e.canSpatialCluster}))),this.services.promiseFactory.all(o).then((function(){i.hasMoreOptions=e.options.showMenu&&(i.canExport||i.canDelete||i.canSort||i.canSearch||i.canCluster)}))},i.prototype.canEdit=function(){var e=v.getVisualType(this.scope.viewModel.contract),t=this.services.viewModeState.getMode(),i=this.scope.viewModel.editMode,r=this.services.formFactor.getCurrentLayout(),o=0===r&&!this.scope.viewModel.errorInfo&&this.canPopOut();return 1===t&&1!==i&&this.services.visualPluginOps.canEdit(e,o)},i.prototype.canCluster=function(){var t=this,i={canCluster:!1,canSpatialCluster:!1};if(!this.services.featureSwitchService.featureSwitches.clusteringEnabled)return this.services.promiseFactory.resolve(i);var r=this.scope.viewModel.contract.config.singleVisual,o=this.services.visualPlugin.capabilities(r.visualType);if(!o||!o.grouping||!o.grouping.cluster)return this.services.promiseFactory.resolve(i);var n=o.grouping.cluster,a=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(a).then((function(o){var a=r.query;if(!a||!a.defn||_.some(a.defn.select(),(function(e){return!d.isExprValidForClustering(e.expr)}))||v.hasGroupByItems(a))return i;var s=_.chain(a.defn.select()).map((function(e){return e.expr.getTargetEntity().schema})).uniq().value(),l=1===_.size(s)&&o.schema(s[0]).capabilities.supportsClustering;if(!l)return i;for(var c=a.projections,u=v.createRoleKindByQueryRef(r.query),p=0,h=n.conditions;p<h.length;p++){var g=h[p],f=e.DataViewAnalysis.checkForConditionErrors(c,g,u,!1);if(_.isEmpty(f))return i.canCluster=1===t.services.viewModeState.getMode(),i.canSpatialCluster=i.canCluster&&t.services.featureSwitchService.featureSwitches.spatialClusteringEnabled,i}return i}))},i.prototype.updateVisualViewport=function(e,t){e.stopPropagation();var i={width:t.width,height:t.height};this.scope.viewModel.updateVisualViewportForUserResize(i),this.setToolbarVisible(!1)},i.prototype.updateDimensions=function(e,t,i){var r=this;e.stopPropagation&&e.stopPropagation(),this.services.undoRedo.register("VisualContainerUpdateDimensions",(function(){var e=r.scope.viewModel,i={x:t.x,y:t.y,z:e.position.z,width:t.width,height:t.height,angle:t.angle};r.services.layoutAuthoring.moveVisualContainer(r.scope.viewModel,i)}),i),this.setToolbarVisible(!0)},i.prototype.convertTo=function(e){var i=this;this.services.eventBridge.publishBubbling(this.scope,l.visualConversion,{visualContainer:this.scope.viewModel.contract,newVisualType:e,actionAfterConversion:function(){i.resetSortSettings(),t.util.VisualContainerUtils.notifyVisualContainersExceptSource(i.services.eventBridge,i.scope.viewModel.contract)}})},i.prototype.getPosition=function(e){var t=e.layouts.withId(this.services.formFactor.getCurrentLayout());return t&&t.position},i.prototype.selectVisualContainer=function(e){u.selectVisualContainer(this.scope.viewModel.contract,this.services.selection,e)},i.prototype.isSelected=function(){return u.isVisualContainerSelected(this.scope.viewModel.contract,this.services.selection)},i.prototype.updateSelection=function(){var e=this.isSelected();e||(this.showSelectionBorder=!1),this.scope.viewModel.setSelected(e),this.setToolbarVisible(e),this.scope.$emit(r.VisualSelectionOrPositionChangedEventName)},i.prototype.preventInnerScroll=function(){return!this.isSelected()&&this.services.viewModeState.getConfig().touchOptions.touchEventsOnSelectedVisualOnly},i.prototype.clearDataSelection=function(){var e=this.scope.viewModel.contract.config.singleVisual;e.clearSelectedDataPoints()},i.prototype.setOnClearSelectedDataPoints=function(){var e=this,t=this.scope.viewModel.contract.config.singleVisual;t.clearSelectedDataPoints=function(){if(e.selectedDatapoints=void 0,t.getCurrentVisual){var i=t.getCurrentVisual();i&&i.onClearSelection&&i.onClearSelection()}}},i.prototype.onChangeViewMode=function(e){this.updateMenuButtonsState();var t=1===e;this.setToolbarVisible(t),0===e&&this.scope.viewModel.setEditMode(0);var i=this.scope.viewModel.readOnlyState.visual,r=i.visual;r&&(this.updateVCBodyProperties(),r.onViewModeChanged&&r.onViewModeChanged(e))},i.prototype.onChangeEditMode=function(t){var i=(this.scope.viewModel.readOnlyState.visual,this.scope.viewModel);i.setEditMode(t),this.updateMenuButtonsState();var r=v.getVisualType(i.contract),o=this.services.visualPlugin.capabilities(r);o&&2===o.advancedEditModeSupport?this.services.visibility.set(i.contract,1):r!==e.visualHost.EsriVisual&&r!==e.visualHost.SandDanceVisual||(this.services.viewModeState.setMode(2),this.services.viewModeState.updateConfig((function(e){e.alwaysPopulatePanes||(e.alwaysPopulatePanes=!0)})),this.services.visibility.set(i.contract,1))},i.prototype.popOutVisualContainer=function(){var e=this.scope.viewModel;this.services.visibility.set(e.contract,1)},i.prototype.canPopOut=function(){return this.services.visualPluginOps.supportsFocusMode(v.getVisualType(this.scope.viewModel.contract))},i.prototype.resetSortSettings=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,r,o,n,a,s;return __generator(this,(function(l){switch(l.label){case 0:return e=this.services.dataSources.get(),e?[4,this.services.conceptualSchemaProxy.get(e)]:[3,3];case 1:return t=l.sent(),[4,f.ensurePlugin(this.scope.viewModel.contract.config.singleVisual.visualType,this.services.visualPlugin,this.services.moduleLoader,this.services.promiseFactory)];case 2:l.sent(),i=this.scope.viewModel.contract.config.singleVisual,i&&i.query&&(r=this.services.visualPlugin.capabilities(i.visualType),o=i.query,r&&(n=void 0!==r.sorting&&void 0!==r.sorting.default,a=this.services.sort.getSortableFields({query:o,schema:t,visualType:i.visualType,objectDefns:i.objects,columnProperties:i.columnProperties}),this.sortHelper.resetSortSettings(a,n))),s=_.findIndex(this.scope.menuOptions.sortSetting.sortableFields,(function(e){return e.active})),s>=0&&(this.scope.viewModel.readOnlyState.actualSortDirection=this.scope.menuOptions.sortSetting.sortableFields[s].sortDirection),this.updateMenuButtonsState(),l.label=3;case 3:return[2]}}))}))},i.prototype.resetVisualStyle=function(){var e=this.services.explorationNavigation.getCurrentExploration(),t=this.scope.viewModel,i=t.readOnlyState.visual,r=e&&e.theme,o=e&&e.baseTheme;t.themeName=r,t.baseThemeName=o,i&&(i.themeName=r,i.baseThemeName=o)},i.prototype.resetPadding=function(){var e=this.scope.viewModel.contract.config.singleVisual,t=this.services.visualPlugin.capabilities(e.visualType);this.scope.viewModel.isPaddingDisabled=t&&t.suppressDefaultPadding},i.prototype.resetBackground=function(){var e=this.scope.viewModel.contract.config.singleVisual,t=e.background,i=this.scope.viewModel;t&&t.show?i.visualBackground={colorRGB:v.getVisualBackgroundRGBColor(t)}:i.visualBackground=null},i.prototype.resetAspectRatio=function(){var e=this.scope.viewModel,t=e.contract.config.singleVisual.aspectRatio;e.lockAspectRatio=!(!t||!t.show)},i.prototype.resetBorder=function(){var e=this.scope.viewModel.contract.config.singleVisual,i=e.border,r=this.scope.viewModel,o=t.viewModels.VisualBorder.getDefaultValues(),n={show:i?i.show:o.show,color:i&&i.color?i.color:o.color};r.visualBorder=n.show?new t.viewModels.VisualBorder(n):null},i.prototype.resetTitle=function(){var e=this,i=this.scope.viewModel,r=i.contract.config.singleVisual,o=this.services.visualPlugin.capabilities(r.visualType),n=this.services.dataSources.get();this.startProgressBar(),o&&!t.contracts.VisualTitle.isHidden(r.title)&&n?this.services.conceptualSchemaProxy.get(n).then((function(t){e.services.displayNameService&&(i.setVisualTitle(e.services.displayNameService.getVisualTitle(r,t,o)),i.updateViewState())})).finally((function(){e.stopProgressBar()})):(i.visualTitle=void 0,this.stopProgressBar())},i.prototype.hasMultipleScopeIds=function(e){if(!(e&&e.data&&e.data.length>0))return!1;if(e.data.length>1)return!0;if(!e.data[0])return!1;var t=e.data[0];if(!t.expr)return!1;var i=t.expr;return 8===i.kind},i.prototype.canSelect=function(i){var r,o=this,n=e.extensibility.legacy.isOldSelectEventArgs(i);if(r=n?e.extensibility.legacy.getSelectors(i):_.map(i.visualObjects,(function(e){return p.convertSelectorsByColumnToSelector(e.selectorsByColumn)})),r.length>1&&r.some((function(e){return o.hasMultipleScopeIds(e)}))){if(i.visualObjects){var a=this.scope.viewModel.contract.config.singleVisual,s=_.map(i.visualObjects,(function(e){return e.selectorsByColumn})),l=this.services.conceptualSchemaProxy.getLatestCapabilities(this.services.dataSources.get(),void 0);if(l&&l.supportsMultiTableTupleFilters)return!0;if(t.utils.GroupUtils.canGroup(s,a.query))return!0}return!1}return!0},i.prototype.onDragStart=function(e){},i.prototype.shouldRetainSelection=function(){return this.isDrillEnabled()},i.prototype.isDrillEnabled=function(){var e=this.scope.viewModel.contract,t=this.services.drill;if(e&&e.drillMode)return t.isDrillModeEnabled(e,1)||t.isDrillModeEnabled(e,2)||t.isDrillModeEnabled(e,3)},i.prototype.drill=function(e,t,i,r){var o=this.scope.viewModel.contract,n=this.services.dataSources.get();switch(o.drillMode){case 1:this.services.visualAuthoring.drillDown(t,o,n,r);break;case 2:this.services.lazyScopedSync("drillToDetails").drillToDetails(t,o,n);break;case 3:e||this.contextMenu.createForDrillthrough(o,t,i)}},i.prototype.onSelecting=function(t){if(this.isDrillEnabled()){this.services.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1});var i=_.isEmpty(t.dataRoles)?void 0:_.first(t.dataRoles);e.extensibility.legacy.isOldSelectEventArgs(t)?this.drill(!0,e.extensibility.legacy.getSelectorsByColumn(t),t.position,i):this.drill(!1,_.map(t.visualObjects,(function(e){return e.selectorsByColumn})),t.position,i),t.action=1}else t.action=0},i.prototype.onSelect=function(t){var i=e.extensibility.legacy.isOldSelectEventArgs(t);if(this.isDrillEnabled()){this.services.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1});var r=void 0;r=i?e.extensibility.legacy.getSelectorsByColumn(t):_.map(t.visualObjects,(function(e){return e.selectorsByColumn})),this.drill(!0,r,void 0)}else{var o=void 0;o=i?e.extensibility.legacy.getSelectors(t):_.map(t.visualObjects,(function(e){return p.convertSelectorsByColumnToSelector(e.selectorsByColumn)}));for(var n=0,a=o;n<a.length;n++){var s=a[n];s.data=p.filterTransformSelectorsForSelection(s.data)}var l=0!==_.size(t.visualObjects)||0!==_.size(this.selectedDatapoints);this.selectedDatapoints=t.visualObjects?_.map(t.visualObjects,(function(e){return e.selectorsByColumn})):void 0,this.scope.viewModel.hostServices.selectDataPoint(this.services.filterGenerator,o),l&&this.raiseDataPointsSelectedEvent(o)}},i.prototype.raiseDataPointsSelectedEvent=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.visualContainerDataSelectionService.getSelectedValues(o);t.push({selector:o,values:n})}var a={dataPointsDescriptions:t,visualContainer:this.scope.viewModel.contract,visualTitleText:this.scope.viewModel.visualTitle?this.scope.viewModel.visualTitle.text:null};this.services.eventBridge.publishToChannel(l.dataPointsSelected,a)},i.prototype.startProgressEvent=function(){this.progressTransitionEvent&&this.progressTransitionEvent.resolve(),this.progressTransitionEvent=this.services.telemetryService.startActivity(this.scope,e.telemetry.EXRenderExplorationVisual,this.scope.viewModel.contract&&this.scope.viewModel.contract.config&&this.scope.viewModel.contract.config.singleVisual&&this.scope.viewModel.contract.config.singleVisual.visualType)},i.prototype.endProgressEvent=function(){this.progressTransitionEvent&&(this.progressTransitionEvent.resolve(),this.progressTransitionEvent=null)},i.prototype.startDetailVisualProgressBar=function(){1===++this.detailVisualProgressBarCount&&this.updateProgressBarState()},i.prototype.stopDetailVisualProgressBar=function(){--this.detailVisualProgressBarCount<=0&&this.updateProgressBarState()},i.prototype.clearDetailVisualProgressBar=function(){this.detailVisualProgressBarCount=0,this.updateProgressBarState()},i.prototype.startProgressBar=function(){1===++this.progressBarCount&&this.updateProgressBarState()},i.prototype.stopProgressBar=function(){--this.progressBarCount<=0&&this.updateProgressBarState()},i.prototype.updateProgressBarState=function(){var e=this,t=this.lastProgressBarState,i={progressBarCount:this.progressBarCount,detailVisualProgressBarCount:this.detailVisualProgressBarCount,hasPendingGeocoding:this.geocodingTracker&&this.geocodingTracker.hasPendingGeocoding()},r=t.progressBarCount>0||t.detailVisualProgressBarCount>0,o=i.progressBarCount>0||i.detailVisualProgressBarCount>0,n=r||t.hasPendingGeocoding,a=o||i.hasPendingGeocoding;a!==n&&(a?this.services.lazyScoped("loadProgressNotification").then((function(e){e.beginLoad()})):this.endLoadDefer.promise.finally((function(){e.services.lazyScoped("loadProgressNotification").then((function(e){e.endLoad()}))})),this.scope.viewModel.showProgressBar=a),o!==r&&(o?this.startProgressEvent():this.endProgressEvent()),this.lastProgressBarState=i},i.prototype.updateDisablePin=function(){this.scope.disablePin=this.scope.viewModel.options.disablePin||this.shouldBlockPinButtonForScriptVisual()},i.prototype.shouldBlockPinButtonForScriptVisual=function(){var e=this.services.visualPlugin,t=this.scope.viewModel.contract;return v.isScriptVisual(t,e)&&this.services.viewModeState.getConfig().supportsPinning&&this.services.scriptVisuals.shouldBlockScriptVisual()},i.prototype.applyUpdate=function(e,t,i){var r=this.scope.viewModel,o=r.contract,n=r.readOnlyState.visual&&r.readOnlyState.visual.viewport,a=this.scope.viewModel.readOnlyState.visual;this.queryHandler.runQuery({contract:o,viewport:n,initialLoad:e,useVisualContainerCache:r.shouldUseCache(),preferCurrentData:t,allowCache:i,currentData:a.data,geocodingTracker:this.geocodingTracker})},i.prototype.loadMergedData=function(e){var t=this.scope.viewModel.readOnlyState.visual;t.data=e},i.prototype.handleQueryResult=function(t,i,r){var o=this.scope.viewModel.readOnlyState.visual;if(o){o.dataTransforms=i,r&&(o.dataTransforms=e.Prototype.inherit(o.dataTransforms),o.dataTransforms.objects=r),o.data=t;var n=this.scope.viewModel;n&&n.contract&&n.contract.cachedData&&n.contract.cachedData.dataUpdatedTime&&(n.lastUpdateAttemptTime=(new Date).toLocaleString())}},i.prototype.handleQueryErrors=function(t){if(t||(t=new y),!t.ignorable||t.ignorable!==!0){var i,o,n=this.scope.viewModel.readOnlyState.visual;if(t instanceof e.DsrClientError){var a=t,s=a.powerBiErrorDetails,l=a.AdditionalErrorMessages;if(s)try{var c=JSON.parse(s);o={error:c.error,showNotification:!0}}catch(e){}if(l)for(var u=0,p=l.length;u<p;u++){var d=l[u];if(d.Code&&d.Message){var h=d.Code,g=d.Message;if(h===r.serverErrors.onPremiseServiceException)try{var c=JSON.parse(g);o={error:c.error,showNotification:!0}}catch(e){}}}}var f=t.getDetails(e.common.localize);if(i){f.displayableErrorInfo.length>0&&(f.displayableErrorInfo[0].errorInfoValue=e.common.localize.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+i.code)),f.displayableErrorInfo.push({errorInfoKey:e.common.localize.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:i.code});var m=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(i);m.always((function(e){if(e&&e.displayableErrorInfo)for(var t=0,i=e.displayableErrorInfo;t<i.length;t++){var r=i[t];f.displayableErrorInfo.push(r)}}))}if(v.isScriptVisual(this.scope.viewModel.contract,this.services.visualPlugin)){var w=this.services.scriptVisuals.overrideEmbeddedErrorDetails(f);f=w||f}this.publishVisualErrorEvent(f,t.code,t.requestId,this.scope.viewModel.visualTitle&&this.scope.viewModel.visualTitle.text,o),this.scope.ctrlError.showErrorOverlay(f,t.code,t.requestId,t.source),n.data=null}},i.prototype.publishVisualErrorEvent=function(t,i,r,o,n){var a,s;if(t.debugErrorInfo)for(var c=0,u=t.debugErrorInfo;c<u.length;c++){var p=u[c];p.errorInfoKey===e.ClientErrorStrings.ErrorCode?a=p.errorInfoValue:p.errorInfoKey===e.ClientErrorStrings.ErrorDetails&&(s=p.errorInfoValue)}var d={code:n&&n.error.code||a||i,message:n&&n.error.message||s||t.message,details:[r],target:o},h={error:d,showNotification:n&&n.showNotification};this.services.eventBridge.publishBubbling(this.scope,l.reportVisualError,h)},i.prototype.handleWarnings=function(t,i){if(!_.isEmpty(t))for(var r=_.any(t,(function(t){return t instanceof e.data.dsr.DsrLimitsWarning})),o=0,n=t;o<n.length;o++){var a=n[o];a.columnNameFromIndex=function(e){var t=i.selects;return t.length<=e?null:t[e].displayName};var l=a.getDetails(e.common.localize);a instanceof e.data.dsr.DsrLimitsWarning?this.scope.ctrlError.showInfoIcon(l,a.code):a instanceof s&&a.isTransformMessage()?this.scope.ctrlError.showTransformWarningIcon(l,a.code,r):this.scope.ctrlError.showWarningIcon(l,a.code)}},i.prototype.getNextDataSegment=function(){var e=this.scope.viewModel,t=e.contract,i=e.readOnlyState.visual&&e.readOnlyState.visual.viewport;return this.queryHandler.getNextDataSegment({contract:t,viewport:i,useVisualContainerCache:e.shouldUseCache()})},i.prototype.loadMoreData=function(){var e=this.scope.viewModel,t=e.contract,i=e.readOnlyState.visual&&e.readOnlyState.visual.viewport,r=e.readOnlyState.visual.data;this.queryHandler.loadMoreData({contract:t,currentData:r,useVisualContainerCache:e.shouldUseCache(),viewport:i})},i.prototype.persistProperties=function(e,t){var i=this.scope.viewModel,r=i.contract.config.singleVisual,o=_.isArray(e)?{replace:e}:e;this.services.visualAuthoring.persistProperties(o,r,t===!0)&&(this.applyUpdate(void 0,!0),this.updateVisualContainerProperties())},i.prototype.applyJsonFilter=function(t,i,r,o){return void 0===o&&(o=0),__awaiter(this,void 0,e.Promise,(function(){var e,n,a,s,c,u,p;return __generator(this,(function(d){switch(d.label){case 0:return e=this.services.dataSources.get(),[4,this.services.moduleLoader.require({javascript:"JSONFilter/services/jsonFilterParserMin"})];case 1:return n=d.sent(),[4,n.create(this.services.promiseFactory,this.services.moduleLoader)];case 2:return a=d.sent(),[4,this.services.conceptualSchemaProxy.get(e)];case 3:return s=d.sent(),[4,a.tryCreateSemanticFilter("Filter",s,t)];case 4:return c=d.sent(),u={},u[r]=c,p={},p=0===o?{merge:[{objectName:i,properties:u,selector:void 0}]}:{remove:[{objectName:i,
properties:u,selector:void 0}]},this.persistProperties(p),this.services.eventBridge.publishToChannel(l.visualContainerChanged,{affectContainer:v.contractUnEqualityComparator(this.scope.viewModel.contract)}),[2]}}))}))},i.prototype.onCustomSort=function(e){this.sortHelper.applySortByFields(e),this.services.overlayService.hideAllDropdowns()},i.prototype.updateDetailVisualVisibility=function(){var e=this.scope.viewModel.contract,t=this.services.visibility.isSeeDataMode(e.visibility);t&&!this.services.drill.canSeeData(e)&&this.setPopOutMode(1)},i.prototype.setPopOutMode=function(e){0===e?this.services.visibility.clear():this.services.visibility.set(this.scope.viewModel.contract,e)},i.prototype.isHeaderVisible=function(){var e=this.services;if(!e.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeader())return!1;var t=e.viewModeState.getConfig().displayOptions,i=this.scope.viewModel;return!(t.hideInFocusTileMenu&&i.isPoppedOut||t.hideTileMenu||i.options.hideHeader)&&(this.isSelected()||this.isHovering)},i.prototype.canRemoveFromLayout=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canRemoveVisualFromLayout()&&!this.isHeaderVisible()},i.prototype.removeVisualFromLayout=function(){this.services.eventBridge.publishBubbling(this.scope,l.removeVisualContainerFromLayout,this.scope.viewModel.contract)},i.prototype.isPopOutBarVisible=function(){return this.scope.viewModel.isPoppedOut&&!this.scope.viewModel.options.hideHeader&&!this.services.viewModeState.getConfig().displayOptions.hideInFocusBar},i.prototype.shouldRestrictTransformDraw=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()},i.prototype.isEditable=function(){return 1===this.services.viewModeState.getMode()},i.prototype.canExport=function(){var e=!1,t=!1,i=!!this.services.viewModeState.getConfig().supportsExportData,r=this.scope.viewModel;if(null!=r){t=r.showWatermark;var o=r.contract&&r.contract.config,n=o&&o.singleVisual&&o.singleVisual.visualType;jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(n)||(e=this.services.visualPluginOps.isQueryVisual(n))}return i&&e&&!t},i.prototype.canSearch=function(){var e=this,t=this.scope.viewModel;if(t){var i=v.getVisualType(t.contract);if(this.services.visualPluginOps.supportVisualSearch(i)){var r=this.services.dataSources.get();if(r)return this.services.conceptualSchemaProxy.get(r).then((function(i){return!!v.containSearchableField(t.contract,e.services.visualPlugin,i)}))}}return this.services.promiseFactory.resolve()},i.prototype.refreshHostData=function(){var t=v.getVisualType(this.scope.viewModel.contract);this.services.telemetryService.logEvent(e.telemetry.EXRefreshHostData,t),this.services.eventBridge.publishBubbling(this.scope,l.refreshExploration)},i})();i.VisualContainerController=m;var y=(function(e){function t(){return e.call(this,"VisualDataProxyExecutionUnknownError")||this}return __extends(t,e),t})(e.UnknownClientError),w=(function(){function e(e,t){this.visualContainerId=e,this.action=t}return e.prototype.equals=function(e){return!!e&&this.action===e.action&&this.visualContainerId===e.visualContainerId},e})()})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.modules,n=e.visuals.plugins,a=t.services.selectionUtils,s=t.util.VisualContainerUtils,l=(function(){function e(e,i){var n=this;this.scope=e,this.services=i,this.scope.viewModeState=i.viewModeState,this.scope.setActiveSection=function(e){return n.setActiveSection(e)},this.scope.setActivePagePaneSection=function(e){return n.setActivePagePaneSection(e)},this.scope.toggle=function(){return n.toggle()},this.scope.exploreUIShellConfig=o.ExploreUIShellModule,this.scope.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.updateAll();var a=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){n.updateSections(),n.updateHeader(),n.updatePagePaneSections()}));this.scope.$watchGroup(["viewModeState.getMode()","viewModeState.getConfig().alwaysPopulatePanes"],(function(){return n.updateAll()})),this.scope.$on(t.constants.explorationLoadedEventName,(function(){return n.updateAll()})),this.scope.$on("$destroy",(function(){return a.unsubscribeAll()}))}return e.createOptions=function(){return{additionalServices:["featureSwitchService","localizationService"],scopedDependencies:["eventBridge","selection","viewModeState","visualPlugin","visualPluginOps"]}},e.prototype.setActiveSection=function(e){this.scope.viewModel.activeSection=e,this.updateShowHideElements()},e.prototype.setActivePagePaneSection=function(e){this.scope.viewModel.activePageSection=e,this.updateShowHideElements()},e.prototype.updateAll=function(){var e=this.scope.viewModeState.getMode();this.scope.isEditing=1===e,this.scope.populatePanes=this.scope.isEditing||this.scope.viewModeState.getConfig().alwaysPopulatePanes,this.scope.showVisualTypes=this.scope.populatePanes,this.scope.viewModel&&(this.updateShowHideElements(),this.updateSections(),this.updatePagePaneSections(),this.updateHeader())},e.prototype.updateShowHideElements=function(){var e=this.scope.viewModel.activeSection,t=this.scope.viewModel.activePageSection,i=this.scope.populatePanes,r=this.getSelectedVisual();r?this.scope.showVisualTypes=i&&this.services.visualPluginOps.canConvertVisual(r):this.scope.showVisualTypes=i,this.scope.showFieldWellOrFilters=!e&&!t||0===e||0===t,this.scope.showFieldWell=i&&(0===e||0===t),this.scope.showPropertyPane=i&&1===e,this.scope.showPagePropertyPane=i&&1===t&&!this.scope.isNonQueryVisual,this.scope.showAnalyticsPane=i&&2===e},e.prototype.updateSections=function(){var e=this.getSelectedVisual(),t=this.scope.viewModel,i=s.getVisualType(e),r=this.services.visualPluginOps,o=r.isSupportedVisual(e),n=i&&r.isQueryVisual(i);if(this.scope.isNonQueryVisual=void 0!==e&&!n,t.sections=[],!e||!o)return void this.setActiveSection(void 0);if(this.scope.isEditing&&this.scope.isNonQueryVisual)this.setActiveSection(1);else{var a=t.activeSection;void 0===a&&this.setActiveSection(0),t.sections.push({sectionType:0,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"})}r.canFormatVisual(e)&&(t.sections.push({sectionType:1,displayName:this.services.localizationService.get("VisualizationPane_Section_Format"),cssClass:"format"}),t.sections.push({sectionType:2,displayName:this.services.localizationService.get("VisualizationPane_Section_Analytics"),cssClass:"analytics"}))},e.prototype.updatePagePaneSections=function(){var e=this.getSelectedVisual(),t=this.scope.viewModel;return t.pagePaneSections=[],e?void this.setActivePagePaneSection(void 0):(void 0===t.activePageSection&&this.setActivePagePaneSection(0),t.pagePaneSections.push({sectionType:0,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"}),void t.pagePaneSections.push({sectionType:1,displayName:this.services.localizationService.get("VisualizationPane_Section_Format"),cssClass:"format"}))},e.prototype.updateHeader=function(){var e;if(this.scope.populatePanes){var t=this.getSelectedVisual();if(t){var i=t.config.singleVisual.visualType;i===n.basicShape.name?e="VisualizationPane_Shape":i===n.image.name&&(e="VisualizationPane_Image")}e=e||"VisualizationPane_Title"}else e="VisualizationPane_Filters";this.scope.viewModel.header=this.services.localizationService.get(e)},e.prototype.toggle=function(){this.scope.viewModel.isPaneExpanded=!this.scope.viewModel.isPaneExpanded},e.prototype.getSelectedVisual=function(){return a.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection)},e})();i.VisualizationPaneController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){this.modalDialogService=e}return t.prototype.show=function(){var t={bindings:void 0,definitionTemplateCachePath:"dialogs/hotkeyDialog/hotkeyDialogDefinition.html",dialogName:"HotkeyDialog",lazyModuleDependencies:[e.explore.modules.ExploreUIDialogsModule]};return this.modalDialogService.showHostModalDialog(t)},t})();t.HotkeyDialogBuilder=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){this.modalDialogService=e}return t.prototype.show=function(t,i,r,o,n){var a={config:{titleText:i,messageText:r,okButtonText:o,learnMoreLink:n}},s={dialogName:t,definitionTemplateCachePath:"dialogs/learnMoreDialog/learnMoreDialogDefinition.html",bindings:a,lazyModuleDependencies:[e.explore.modules.ExploreUIDialogsModule]};return this.modalDialogService.showHostModalDialog(s)},t})();t.LearnMoreDialogBuilder=i})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.ImportVisualErrorDialogController),this.templateUrl="views/importVisualErrorDialog.html"}return i})();i.ImportVisualErrorDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.ImportVisualWarningDialogController),this.templateUrl="views/importVisualWarningDialog.html"}return i})();i.ImportVisualWarningDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.scope={items:"=",selectedValue:"=",onSelect:"="},this.templateUrl="views/inputFields/selectionBox.html",this.link=function(e,t){function i(i){e.selectedItem=i,e.selectedValue=i.value,e.showDropdown=!1,t.focus(),e.onSelect(e.selectedValue)}function r(){if(e.selectedItem=null,e.items)for(var t=e.selectedValue,i=0,r=e.items;i<r.length;i++){var o=r[i];if(o.value===t){e.selectedItem=o;break}}}e.showDropdown=!1,e.hasHideableItems=_.any(e.items,(function(e){return void 0!==e.isHidden})),e.itemSelected=function(e){return i(e)},r();var o=e.$watch("selectedValue",(function(e,t){r()})),n=e.$on("$destroy",(function(){o(),n()}))}}return e})();e.SelectionBox=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.require="ngModel",this.restrict="E",this.scope={validators:"=",placeholder:"<",inputType:"@"},this.templateUrl="views/inputFields/propertyPaneTextBox.html",this.link=function(e,i,r,o){o.$render=function(){e.sliceValue=o.$viewValue},e.onKeydown=function(e){e.which===$.ui.keyCode.DELETE&&e.stopPropagation()},e.onChange=function(){e.inputForm&&!e.inputForm.$invalid&&o.$setViewValue(e.sliceValue)},e.getErrorMessage=function(){var i,r=e.inputForm.$error;return r&&(r.decimal||r.number?i=t.localizationService.get("Validation_NotANumber"):r.min?i=t.localizationService.get("Validation_NumberBelowMin"):r.max?i=t.localizationService.get("Validation_NumberAboveMax"):r.integer?i=t.localizationService.get("Validation_NumberNotInteger"):r.required&&(i=t.localizationService.get("Validation_Empty"))),{tooltipDescription:i,tooltipDisable:_.isEmpty(r)}}},this.localizationService=e}return e})();e.PropertyPaneTextBox=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.AdvancedFilterController),this.templateUrl="views/advancedFilter.html"}return i})();i.AdvancedFilter=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.controllers.CanvasLayoutController,o=(function(){function t(){this.restrict="A",this.controller=e.common.createController(r),this.link=function(e,t,i,r){function o(){var t=e.layoutStrategy;r.setStrategy(t)}function n(){var t=e.canvasLayoutSize;r.setCanvasSize(t)}o(),e.$watch("layoutStrategy",o),e.$watch("canvasLayoutSize",n)}}return t})();i.CanvasLayout=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(i,r,o){var n=function(e,t){return r.dragStart(o,e,t)},a=function(e,t){return r.dragEnd(o,e,t)},s=function(e,t,i){return r.nudge(o,e,t,i)},l=function(e,t){return r.resizeStart(o,e,t)},c=function(e,t){return r.resizeMove(o,e,t)},u=function(e,t){return r.resizeEnd(o,e,t)};return e.common.createScopeEventSubscriptionManager(i).subscribe(t.constants.TransformElementDragEndEventName,a).subscribe(t.constants.TransformElementDragStartEventName,n).subscribe(t.constants.TransformElementNudgeEventName,s).subscribe(t.constants.TransformElementResizeStartEventName,l).subscribe(t.constants.TransformElementResizeMoveEventName,c).subscribe(t.constants.TransformElementResizeEndEventName,u)}var o=e.common.directives.DirectiveUtils,n=(function(){function e(){var e=this;this.restrict="A",this.require="^canvasLayout",this.link=function(t,i,r,n){o.initWhenReady(t,r,"canvasLayoutItem","true",(function(){return e.initialize(t,i,r,n)}))}}return e.prototype.initialize=function(e,t,i,o){var n=e.canvasLayoutItemOptions;o.registerLayoutItem(n),e.getIntermediateDimensions=function(e){return o.getIntermediateDimensions(n,e)};var a=r(e,o,n);e.$on("$destroy",(function(){o.unregisterLayoutItem(n),a.unsubscribeAll()}))},e})();i.CanvasLayoutItem=n})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="A",this.scope=!1,this.controller=e.common.createController(t.controllers.CanvasVisualErrorController),this.controllerAs="ctrlError",this.bindToController=!0}return i})();i.CanvasVisualError=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.replace=!0,this.restrict="E",this.scope={},this.controller=e.common.createController(t.controllers.CanvasVisualHeaderIconController),this.controllerAs="$ctrl",this.bindToController={details:"=",iconType:"="},this.templateUrl="views/canvasVisualHeaderIcon.html"}return i})();i.CanvasVisualHeaderIcon=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.constants,o=41,n=35,a=250,s=(function(){function t(){var t=this;this.restrict="E",this.templateUrl="views/carousel.html",this.transclude=!0,this.replace=!0,this.scope={autoResize:"="},this.link=function(i,s){i.element=s,i.scrollPane=s.find(".carouselScrollPane"),i.previousNavButton=s.find(".carouselNavButton.previousPage"),i.nextNavButton=s.find(".carouselNavButton.nextPage");var l=i.previousNavButton,c=i.nextNavButton,u=i.scrollPane,p=!1,d=function(){return u.children()},h=function(){l.prop("disabled",!1),c.prop("disabled",!1),0===u.scrollLeft()&&l.prop("disabled",!0);var e=2;Math.abs(u.scrollLeft()+u.width()-u[0].scrollWidth)<=e&&c.prop("disabled",!0)};i.updateNavButtonVisibility=h;var v=function(e){if(e&&e.length>0){p=!0;var i=d(),r=e.position().left-t.getLeftmostScrollChildOffset(i);u.animate({scrollLeft:r},a,(function(){h(),p=!1}))}},g=function(){if(!p){var e=u.find(".selected");v(e)}};if(i.scrollToLast=function(){var e=d().last();v(e)},i.updateCarouselWidth=function(){window.setTimeout((function(){for(var e=i.element.parent().width(),t=d(),r=0,a=0,s=t.length;a<s;a++)r+=t.eq(a).outerWidth(!0);var l=r+n;e>o&&(l=Math.min(e-o,l)),i.element.width(l),h()}))},i.scrollToNext=function(){for(var e,i=d(),r=u.scrollLeft()+u.width()+t.getLeftmostScrollChildOffset(i),o=0;o<i.length;o++)if(e=i.eq(o),e.position().left+e.width()>r){v(e);break}},i.scrollToPrevious=function(){for(var e,i=d(),r=u.scrollLeft()-u.width()+t.getLeftmostScrollChildOffset(i),o=0;o<i.length;o++)if(e=i.eq(o),e.position().left>=r){v(e);break}},i.autoResize){e.common.createScopeEventSubscriptionManager(i).subscribe(r.renameSectionEvent,(function(){window.setTimeout((function(){i.updateCarouselWidth()}))}));var f=0,m=new MutationObserver(function(e){for(var t=0,r=e;t<r.length;t++){var o=r[t];if(o.addedNodes.length>0||o.removedNodes.length>0){i.updateCarouselWidth();var n=d().length;f===n-1?i.scrollToLast():0===f&&g(),f=n}}}),y={childList:!0,characterData:!0,attributes:!0};m.observe(i.scrollPane[0],y)}var w=0;i.carouselResized=function(){if(i.autoResize){var e=s.parent().width();e!==w&&(w=e,i.updateCarouselWidth(),g())}},e.common.createScopeEventSubscriptionManager(i).subscribe(r.updateNavButtonEvent,(function(){window.setTimeout((function(){h()}))}))}}return t.prototype.getLeftmostScrollChildOffset=function(e){return e.length>0?e.eq(0).position().left:0},t})();i.Carousel=s})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.templateUrl="views/convertTableDialog.html"}return e})();e.ConvertTableDialog=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.DeleteVisualWarningDialogController),this.templateUrl="views/deleteVisualWarningDialog.html"}return i})();i.DeleteVisualWarningDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.templateUrl="views/detailVisual.html",this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.DetailVisualController)}return i})();i.DetailVisual=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.EsriConsentDialogController),this.templateUrl="views/esriConsentDialog.html"}return i})();i.EsriConsentDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(i,r,s,l,c){var u={width:0,height:0};i.outerViewport=u;var p=null;i.canvasPinchStart=function(e){c&&c.hide({isTouchEvent:!0,immediately:!0}),1===e&&o.storeOverflowValuesAndChange(r,jsCommon.CssConstants.visibleValue)},i.canvasPinchEnd=function(e){1===e&&o.restoreOverflowValues(r)},r.on("touchmove",".visualContainer.selected",(function(e){i.shouldDisableScroll&&i.shouldDisableScroll()&&e.preventDefault()}));var d=function(){var e=i.onResizeViewport.width,t=i.onResizeViewport.height;i.outerViewport={width:e,height:t},e===u.width&&t===u.height||(u.width=e,u.height=t,i.forceSyncSizeUpdates?o.applyFitOption(i,r,i.displayOptionServices):window.requestAnimationFrame((function(){o.applyFitOption(i,r,i.displayOptionServices)}))),i.$emit(n.domLayoutChangedEvent)},h=_.throttle(d,a);i.canvasResized=function(){return i.forceSyncSizeUpdates?d():void h()},i.disableAnimations=!0,i.$watch("useResponsiveLayout",(function(){r.scrollTop(0)})),i.$watch("hasFocus",(function(e){e===!0&&(r.focus(),i.hasFocus=!1)})),i.$watch("viewModel.contract.size",(function(e){e&&(o.updateCanvasSize(i,e.width,e.height),o.applyFitOption(i,r,i.displayOptionServices))}));var v=null;i.$on(t.constants.explorationLoadedEventName,(function(){l&&(p=l.startActivity(i,e.telemetry.EXLoadExplorationVisuals),v&&v(),v=i.$watchCollection("viewModel.visualContainers",(function(e){e&&(0===e.length&&p&&(p.resolve(),p=null),v(),v=null)})))})),i.$on("visualContainerRepeatFinished",(function(){p&&(p.resolve(),p=null),document.activeElement||r.focus(),i.$emit(t.constants.exploreCanvasVisualRendered),i.$emit(n.domLayoutChangedEvent)})),i.applyFitOption=function(){o.applyFitOption(i,r,i.displayOptionServices),i.$emit(n.domLayoutChangedEvent)}}var o=t.util.CanvasDisplayUtility,n=e.common.constants,a=300;i.linkCanvas=r;var s=(function(){function i(i,o,n){var a=this;this.telemetryService=i,this.overlayService=o,this.visualHostTooltip=n,this.restrict="E",this.replace=!0,this.scope={viewModel:"=",disablePrint:"=",canvasOptions:"=?"},this.controller=e.common.createController(t.controllers.ExploreCanvasController),this.controllerAs="$ctrl",this.templateUrl="views/exploreCanvas.html",this.require="canvasLayout",this.link=function(e,t,i,o){e.layout=o,r(e,t,a.overlayService,a.telemetryService,a.visualHostTooltip)},this.telemetryService=i,this.overlayService=o,this.visualHostTooltip=n}return i})();i.ExploreCanvas=s})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={},this.controller=e.common.createController(t.controllers.ExplorationAppBarController),this.controllerAs="$ctrl",this.bindToController={viewModel:"="},this.templateUrl="views/explorationAppBar.html"}return i})();i.ExplorationAppBar=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.ExplorationHostController),this.templateUrl="views/explorationHost.html"}return i})();i.ExplorationHost=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.directives.DragDropUtils,o="dragover",n="section",a=".pane.sections",s=".section.dynamic",l=(function(){function i(i){var a=this;this.restrict="E",this.replace=!0,this.scope={viewModel:"=",tabIndex:"=",isOnlyTab:"<",isEditing:"="},this.controller=e.common.createController(t.controllers.ExplorationNavigationTabController),this.templateUrl="views/explorationNavigationTab.html",this.link=function(t,i,s){t.toggleDraggable=function(e){return i.draggable({disabled:!e})},t.supportsMinervaDialog=a.platformCapabilities.supportsMinervaDialog,i.droppable({accept:function(e){return"sections"===r.getDragSourceType(e)},activate:function(e,i){return t.dragoverIndex=-1},hoverClass:o,tolerance:"pointer",over:function(e,r){if(1===t.viewModeState.getMode()){var o=-1,s=a.getSections();o=i.hasClass(n)?s.index(i):Math.max(s.length-1,0),t.dragoverIndex=o,t.$apply()}},drop:function(i,r){if(1===t.viewModeState.getMode()){var o=r.draggable;if(o){var n=a.getSections(),s=n.index(o),l=t.dragoverIndex;s!==l&&s!==-1&&t.eventBridge.publishBubbling(t,e.explore.services.events.reorderSection,{originalIndex:s,targetIndex:l})}}}}),t.$on("$destroy",(function(){return i.droppable({disabled:!0}).droppable("destroy")}))},this.platformCapabilities=i}return i.prototype.getSections=function(){return $(a).find(s)},i})();i.ExplorationNavigationTab=l})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.ExplorationPaginatorController),this.templateUrl="views/explorationPaginator.html"}return i})();i.ExplorationPaginator=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",disablePrint:"=",canvasOptions:"<",shouldSetFocus:"<"},this.controller=e.common.createController(t.controllers.ExplorationController),this.templateUrl="views/exploration.html"}return i})();i.Exploration=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.directives.NgScrollbars,o=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={fieldListConfig:"<"},this.controller=e.common.createController(t.controllers.FieldListController),this.templateUrl="views/fieldList.html",this.link=function(e,t,i){t.click((function(){e.$evalAsync((function(){return e.unselect()}))})),e.$on("$destroy",(function(){return t.unbind("click")})),e.scrollToItem=function(e,i){var o=t.find(".fieldListEntityContainer").filter((function(t,i){return $(i).find(".fieldListEntity").text().trim()===e})),n=o.find(".fieldListProperty").filter((function(e,t){return $(t).text().trim()===i})),a=t.find(".scroll-wrapper .scroll-content");r.scrollVertical(a[0],n[0]||o[0])}}}return i})();i.FieldList=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={viewModel:"=",searchString:"="},this.controller=e.common.createController(t.controllers.FieldListEntityController),this.templateUrl="views/fieldListEntity.html",this.link=function(e,t,i){e.toggleDraggable=function(e){t.attr("draggable",e.toString())}}}return i})();i.FieldListEntity=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={},this.controller=e.common.createController(t.controllers.FieldListPropertyController),this.controllerAs="ctrl",this.bindToController={viewModel:"=",searchString:"="},this.templateUrl="views/fieldListProperty.html",this.link=function(e,t,i,r){e.toggleDraggable=function(e){r.viewModel.draggable&&t.draggable({disabled:!e})}}}return i})();i.FieldListProperty=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.FilterController),this.templateUrl="views/filter.html"}return i})();i.Filter=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={},this.controller=e.common.createController(t.controllers.FilterPaneController),this.templateUrl="views/filterPane.html"}return i})();i.FilterPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.bindtoController={viewModel:"="},this.controller=e.common.createController(t.controllers.FilterVisualController),this.controllerAs="$ctrl",this.templateUrl="views/filterVisual.html"}return i})();i.FilterVisual=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=(function(){function i(){this.restrict="A",this.controller=e.common.createController(t.controllers.ModelingContextChangerController),this.link=function(e,t,i){var o=e.eventBridge.createChannelSubscriptionManager().subscribe(r.schemaItemActivationChanged,(function(){e.schemaItemActivationService.getActiveItem()?t.on("click",(function(){e.eventBridge.publishToChannel(r.modelingContextChanged)})):t.off("click")}));e.$on("$destroy",(function(){return o.unsubscribeAll()}))}}return i})();i.ModelingContextChanger=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="A",this.require="ngModel",this.scope={pbiValidate:"="},this.link=function(t,i,r,o){t.pbiValidate&&(o.$validators.required=function(e,i){return null==i||!t.pbiValidate.required||""!==i},o.$validators.min=function(i,r){return e.isLargerOrEqual(r,t.pbiValidate.min)},o.$validators.max=function(i,r){return e.isLargerOrEqual(t.pbiValidate.max,r)},o.$validators.decimal=function(e,i){return null==i||!t.pbiValidate.decimal||_.isFinite(Number(i))},o.$validators.integer=function(e,i){if(null==i||!t.pbiValidate.integer)return!0;var r=Number(i);return _.isFinite(r)&&Math.floor(r)===r})}}return e.isLargerOrEqual=function(e,t){if(null==e||null==t||""===e||""===t)return!0;var i=Number(e),r=Number(t);return!_.isFinite(i)||!_.isFinite(r)||i>=r},e})();e.PbiValidate=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(t.controllers.EmbedModalDialogController),this.templateUrl="views/embedModalDialog.html"}return i})();i.EmbedModalDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",fieldListConfig:"<"},this.controller=e.common.createController(t.controllers.TaskPaneController),this.templateUrl="views/taskPane.html"}return i})();i.TaskPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.VisualContainerController),this.templateUrl="views/visualContainer.html"}return i})();i.VisualContainer=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.templateUrl="views/visualContainerPopOutBar.html"}return e})();e.VisualContainerPopOutBar=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.VisualizationPaneController),this.templateUrl="views/visualizationPane.html"}return i})();i.VisualizationPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(t,i){var r=this;this.restrict="E",this.replace=!0,this.template='<div class="watermark"></div>',this.scope={visualType:"="},this.link=function(t,i){function o(e,t,i,r){var o=e.indexOf('id="'+t),n=t.length+6,a=e.substring(o+n,e.indexOf(i)),s=a.indexOf(r),l=a.substring(0,s);return l}function n(t,i,r){t=o(t,i,"</svg>","</symbol>");var n=$(e.svgTemplate+t+"</svg>");n.appendTo(r)}function a(t,i,r,o){var a=o.getPlugin(i),s=a&&a.watermarkKey||e.defaultWatermark;r.attr(e.dataAttribute,s),n(t,s,r)}var s="views/svg/visualsWatermarks.svg",l=r.visualPlugin,c=r.templateCache.get(s),u=t.visualType;
a(c,u,i,l),t.$watch("visualType",(function(e,t){e!==t&&(i.empty(),a(c,e,i,l))}))},this.templateCache=t,this.visualPlugin=i}return e.svgTemplate='<svg id="Layer_1" x="0px" y="0px" viewBox="0 0 400 300" enable-background="new 0 0 400 300" xml:space="preserve">',e.dataAttribute="data-svg-visual-key",e.defaultWatermark="defaultWatermark",e})();e.VisualWatermark=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={initLimit:"=",totalItemsAmount:"="},this.templateUrl="views/virtualList.html",this.link=function(e,t){var i=0,r=10;e.limitItems=+e.initLimit,e.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1};var o=t.find(".virtual-list"),n=2*t.height();o.scroll((function(){var a=o.scrollTop();n||(n=2*t.height()),a+n>o.height()&&e.totalItemsAmount>=e.limitItems&&a>i&&(i=a,e.limitItems+=r,e.$digest())}))}}return e})();e.VirtualList=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i="";switch(e){case 0:i=t.get("ReportAppBar_ViewDynamic");break;case 1:i=t.get("ReportAppBar_ViewFitToPage");break;case 2:i=t.get("ReportAppBar_ViewFitToWidth");break;case 3:i=t.get("ReportAppBar_ViewActualSize")}return i}e.convert=t})(t=e.DisplayOptionFilter||(e.DisplayOptionFilter={}))})(t=e.filters||(e.filters={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this._contract=e,this._state=t}return Object.defineProperty(e.prototype,"contract",{get:function(){return this._contract},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readOnlyState",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.updateViewState=function(){this.updateViewStateCore(this._state)},e.prototype.updateViewStateCore=function(e){},e})();e.ViewModel=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.spinnerAction={name:"spinnerAction"}})(t=e.DetailVisualEvents||(e.DetailVisualEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.constants.ExploreCanvasConstants;t.FixedPhoneCanvasSettings={phoneWidth:i.PhoneAuthoringViewportWidth,phoneHeight:i.PhonePortraitCanvasHeight,phoneGridLayout:{columnCount:6,rowCount:i.PhonePortraitRowCount,layout:{horizontal:{margin:9.5,gutter:9,size:44},vertical:{margin:9.5,gutter:9,size:50}}}};var r=(function(){function e(e,t){void 0===t&&(t=0),this.selectedVisualOriginalPosition=-1,this.contract=e,this.canvasLayout=t}return Object.defineProperty(e.prototype,"width",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.width:t.FixedPhoneCanvasSettings.phoneWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.height:t.FixedPhoneCanvasSettings.phoneHeight},enumerable:!0,configurable:!0}),e})();t.ExploreCanvas=r})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){function i(){return r.createNavigationMenuItems()}t.createNavigationMenuItems=i;var r;!(function(t){function i(){return[r("Duplicate_page",0),r("Rename_page",1),r("Delete_page",2)]}function r(t,i){return{text:e.common.localize.get(t),labelClass:"itemLabel",action:i,type:DropDownMenuItemType.Item,hrefTarget:jsCommon.DOMConstants.selfValue}}t.createNavigationMenuItems=i})(r||(r={}))})(i=t.ExplorationContainerViewModelFactory||(t.ExplorationContainerViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.EnumExtensions,i=(function(){function e(e){this.contract=e,this.showCheckboxes=!0,this.entities=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return this.contract.capabilities.canEdit&&!this.disableEditing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canCreateColumn",{get:function(){return this.canEdit&&this.contract.capabilities.supportsCalculatedColumns!==!1},enumerable:!0,configurable:!0}),e.prototype.findEntity=function(e){return _.find(this.entities,(function(t){return t.name===e}))},e.prototype.findFields=function(e,t,i){var r=this.findEntity(e);if(r)return r.findFields(t,i)},e.prototype.findHierarchies=function(e,t,i){var r=this.findEntity(e);if(r)return r.findHierarchies(t,i)},e.prototype.findKpis=function(e,t,i){var r=this.findEntity(e);if(r)return r.findKpis(t,i)},e.prototype.findKpiMeasures=function(e,t,i){var r=this.findEntity(e);if(r)return r.findKpiMeasures(t,i)},e.prototype.getMenuItems=function(){return this.menuItemFactory.createSchemaMenuItems(this)},e})();e.FieldListConceptualModel=i;var r=(function(){function i(e,t,i){this.hasCheckedProperties=!1,this.contract=e,this.contractSchema=t,this.schema=i,this.properties=[],this.hierarchies=[],this.displayFolders=[]}return Object.defineProperty(i.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayName",{get:function(){return this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"errorMessage",{get:function(){return this.contract.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"calculated",{get:function(){return this.contract.calculated},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iconClassName",{get:function(){return 1===this.contract.queryable?"error":this.calculated?"calculatedTable":this.isMeasureGroup?"measureGroup":void 0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hidden",{get:function(){return t.hasFlag(this.contract.visibility,1)&&_.all(this.properties,(function(e){return!e.isExtension||e.hidden}))},set:function(e){e?this.contract.visibility=t.setFlag(this.contract.visibility,1):this.contract.visibility=t.resetFlag(this.contract.visibility,1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canEdit",{get:function(){return this.contractSchema.capabilities.canEdit&&!this.schema.disableEditing&&!e.FieldListViewModelUtils.isAbandoned(this.contract)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"private",{get:function(){return t.hasFlag(this.contract.visibility,4)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showAsVariationsOnly",{get:function(){return t.hasFlag(this.contract.visibility,2)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showHidden",{get:function(){return this.schema.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasMenu",{get:function(){return this.schema.menuItemFactory.hasEntityMenu()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canRefresh",{get:function(){return this.canEdit&&this.contract.canRefresh!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canEditEntity",{get:function(){return this.canEdit&&!this.calculated&&this.contract.canEditSource!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canDelete",{get:function(){return this.canEdit&&this.contract.canDelete!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canRename",{get:function(){return this.canEdit&&this.contract.canRename!==!1},enumerable:!0,configurable:!0}),i.prototype.findFields=function(e,t){return this.findFieldsByType(e,t,0)},i.prototype.findKpis=function(e,t){return this.findFieldsByType(e,t,4)},i.prototype.findKpiMeasures=function(e,t){return this.findFieldsByType(e,t,5)},i.prototype.findHierarchies=function(e,t){return this.findFieldsByType(e,t,2)},i.prototype.findFieldsByType=function(e,t,i){var r=[];2===i?r.push.apply(r,_.filter(this.hierarchies,(function(i){return i.name===e&&i.schema.name===t}))):r.push.apply(r,_.filter(this.properties,(function(r){return r.name===e&&r.fieldType===i&&r.schemaName===t})));for(var o=0,n=this.displayFolders;o<n.length;o++)for(var a=n[o],s=0,l=_.filter(a.getAllChildren(),(function(t){return t.name===e&&t.fieldType===i}));s<l.length;s++){var c=l[s];r.indexOf(c)<0&&r.push(c)}if(!_.isEmpty(r))return r},Object.defineProperty(i.prototype,"userEntity",{get:function(){return this.schema.showNonUserEntities||!(this.private||this.showAsVariationsOnly)},enumerable:!0,configurable:!0}),i.prototype.getMenuItems=function(){return this.schema.menuItemFactory.createEntityMenuItems(this)},i})();e.FieldListConceptualEntity=r;var o=(function(){function e(e,t,i){this.hasCheckedChildren=!1,this.contract=e,this.schema=t,this.entity=i}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schemaName",{get:function(){return this.schema.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorMessage",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return!this.parent||this.parent.expanded&&this.parent.visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.contract.hidden},set:function(e){this.contract.hidden=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showHidden",{get:function(){return this.entity.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return this.schema.capabilities.canEdit&&!this.entity.schema.disableEditing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMenu",{get:function(){return this.entity.schema.menuItemFactory.hasPropertyMenu()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExtension",{get:function(){return!1},enumerable:!0,configurable:!0}),e})();e.FieldListConceptualItem=o;var n=(function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.draggable=!0,o.fieldType=0,o}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return this.contract.column?this.contract.column.defaultAggregate:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.contract.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!!this.contract.column&&this.contract.column.idOnEntityKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorMessage",{get:function(){return this.contract.errorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return this.canEdit&&this.contract.canDelete!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canAddToFilter",{get:function(){return!this.contract.measure||!this.schema.capabilities.limitMultiColumnFiltersToQueryGroupColumns},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createPropertyMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.template=this.template,e},t})(o);e.FieldListConceptualProperty=n;var a=(function(e){function t(t,i,r){return e.call(this,t,i,r)||this}return __extends(t,e),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExtension",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createExtensionMeasureMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.template=this.template,e},t})(n);e.FieldListConceptualExtensionMeasure=a;var s=(function(e){function t(t,i,r,o){var n=this;return n=e.call(this,t.column,i,o)||this,n.hierarchyLevelContract=t,n.parent=r,n.fieldType=3,n}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return this.parent.hidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.hierarchyLevelContract.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this.hierarchyLevelContract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return this.canEdit&&this.hierarchyLevelContract.canDelete!==!1},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createHierarchyLevelMenuItems(this)},t.prototype.clone=function(e){var i=e||this.parent,r=new t(this.hierarchyLevelContract,this.schema,i,this.entity);return r.template=this.template,r},t})(n);e.FieldListConceptualHierarchyLevel=s;var l=(function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.expanded=!1,o.hierarchyLevels=[],o.draggable=!0,o.fieldType=2,o}return __extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canDelete",{get:function(){return this.canEdit&&this.contract.canDelete!==!1},enumerable:!0,configurable:!0}),t.prototype.findLevel=function(e,t){return _.find(this.hierarchyLevels,(function(t){return t.name===e}))},t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createHierarchyMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.hierarchyLevels=_.map(this.hierarchyLevels,(function(t){return t.clone(e)})),e.template=this.template,e},t})(o);e.FieldListConceptualHierarchy=l;var c=(function(e){function t(t,i,r){var o=e.call(this,t,i,r)||this;return o.expanded=!1,o.kpiMeasures=[],o.fieldType=4,o}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createKpiMenuItems(this)},t.prototype.clone=function(){var e=new t(this.contract,this.schema,this.entity);return e.kpiMeasures=_.map(this.kpiMeasures,(function(t){return t.clone(e)})),e.template=this.template,e},t})(o);e.FieldListConceptualKpi=c;var u=(function(e){function t(t,i,r,o,n,a){var s=this;return s=e.call(this,t,i,n)||this,s.kpiType=r,s.parent=o,s.locOptions=a,s.draggable=!0,s.fieldType=5,s}return __extends(t,e),Object.defineProperty(t.prototype,"displayName",{get:function(){var e;switch(this.kpiType){case 2:e=this.locOptions.KpiValueDisplayName;break;case 1:e=this.locOptions.KpiGoalDisplayName;break;case 0:e=this.locOptions.KpiStatusDisplayName;break;case 3:e=this.locOptions.KpiTrendDisplayName}return e||this.contract.displayName},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return this.entity.schema.menuItemFactory.createKpiMeasureMenuItems(this)},t.prototype.clone=function(e){var i=e||this.parent,r=new t(this.contract,this.schema,this.kpiType,i,this.entity,this.locOptions);return r.template=this.template,r},t})(n);e.FieldListConceptualKpiMeasure=u;var p=(function(e){function t(t,i,r,o,n){var a=e.call(this,t,o,n)||this;a.expanded=!1,a.parent=r,a.children=i,a.fieldType=1;for(var s=0,l=i;s<l.length;s++){var c=l[s];c.parent=a}return a}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return!_.any(this.children,(function(e){return!e.hidden}))},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMenu",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getMenuItems=function(){return{items:[]}},t.prototype.clone=function(){},t.prototype.getAllChildren=function(){for(var e=[],t=0,i=this.children;t<i.length;t++){var r=i[t];e.push(r),1===r.fieldType&&e.push.apply(e,r.getAllChildren())}return e},t})(o);e.FieldListConceptualDisplayFolder=p})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.fieldListAction={name:"fieldListAction"}})(t=e.FieldListEvents||(e.FieldListEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new s(e,t,i)}var r=e.explore.utils.GroupUtils,o=e.explore.util.HierarchyUtils;t.createFieldListMenuItemFactory=i;var n;!(function(e){function t(){return{type:1,checked:!1}}function i(e,t,i,r){return void 0===r&&(r=!1),{text:i.get(e),key:t,type:0,checked:!!r}}e.createItemSeparator=t,e.createFieldListMenuItem=i})(n=t.FieldListMenuItemViewModelGenerator||(t.FieldListMenuItemViewModelGenerator={}));var a;!(function(e){e[e.Filter=0]="Filter",e[e.HierarchyCreate=1]="HierarchyCreate",e[e.HierarchyAddTo=2]="HierarchyAddTo",e[e.Create=3]="Create",e[e.Entity=4]="Entity",e[e.Copy=5]="Copy",e[e.Edit=6]="Edit",e[e.Hidden=7]="Hidden",e[e.ExpandCollapse=8]="ExpandCollapse",e[e.Groups=9]="Groups"})(a||(a={}));var s=(function(){function e(e,t,i){this.localizationService=e,this.featureSwitchService=t,this.groupingDesignStateService=i}return e.prototype.createSchemaMenuItems=function(e){var t=this.canAuthorReportMeasuresOnSchema(e.contract);return this.createMenuItems({canViewHidden:e.canEdit||t,canUnHideAll:e.canEdit||t,canExpandCollapseAll:!0,showHidden:e.showHidden})},e.prototype.createEntityMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e);return this.createMenuItems({canDelete:e.canDelete,canRename:e.canRename,canViewHidden:e.schema.canEdit||t,canUnHideAll:e.schema.canEdit||t,canExpandCollapseAll:!0,isEntity:!0,canRefresh:e.canRefresh,canHide:e.schema.canEdit,canEditEntity:e.canEditEntity,canCreateColumn:e.schema.canCreateColumn,canCreateMeasure:e.canEdit||this.canCreateNewReportMeasureOnEntity(e),hidden:e.hidden,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e)})},e.prototype.createHierarchyMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity);return this.createMenuItems({canDelete:e.canDelete,canRename:e.canEdit,canHide:e.canEdit&&e.entity.schema.canEdit,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.createHierarchyLevelMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity),i=e.parent.contract.levels;return this.createMenuItems({canAddToFilter:!0,canDelete:e.canDelete,canRename:e.canEdit,canMoveUp:e.canEdit&&_.first(i).name!==e.hierarchyLevelContract.name,canMoveDown:e.canEdit&&_.last(i).name!==e.hierarchyLevelContract.name,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e.entity)})},e.prototype.createPropertyMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity),i=this.createMenuSections({canAddToFilter:e.canAddToFilter,canDelete:this.canDeleteProperty(e),canRename:e.canEdit,canHide:e.canEdit,canGroup:e.canEdit&&this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&0===e.kind&&r.canPropertyBeGrouped(e.contract)&&e.schema.capabilities.supportsGrouping!==!1,canEditGroups:e.canEdit&&this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&r.isGroupOrBinColumn(e.entity.name,e.contract,this.groupingDesignStateService)&&e.schema.capabilities.supportsGrouping!==!1,canEditClustering:e.canEdit&&this.featureSwitchService.featureSwitches.clusteringEnabled&&this.groupingDesignStateService&&r.isClusteringColumn(e.entity.name,e.contract,this.groupingDesignStateService)&&e.schema.capabilities.supportsGrouping!==!1,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden,canCreateQuickCalcMeasure:this.isQuickMeasureSupported(e.entity)}),o=e.entity.canEdit&&1!==e.kind;return o&&this.createHierarchyMenuSections(e,i),{items:this.getMenuItemsAndSeparators(i)}},e.prototype.canDeleteProperty=function(e){return e.canDelete&&!(e.entity&&e.entity.calculated&&e.contract.column&&!e.contract.column.calculated)},e.prototype.canCreateNewReportMeasureOnEntity=function(e){return this.canAuthorReportMeasuresOnEntity(e)&&!t.FieldListViewModelUtils.isAbandoned(e.contract)},e.prototype.canAuthorReportMeasuresOnEntity=function(e){return e.contractSchema.isExtensionSchema?e.contractSchema.capabilities.canEdit&&this.featureSwitchService.featureSwitches.reportMeasures:this.canAuthorReportMeasuresOnSchema(e.contractSchema)},e.prototype.canAuthorReportMeasuresOnSchema=function(e){return this.featureSwitchService.featureSwitches.reportMeasures&&e.capabilities.isExtendable},e.prototype.createExtensionMeasureMenuItems=function(e){return this.createPropertyMenuItems(e)},e.prototype.createKpiMenuItems=function(e){var t=this.canAuthorReportMeasuresOnEntity(e.entity);return this.createMenuItems({canDelete:e.canEdit,canRename:e.canEdit,canCreateColumn:e.entity.schema.canCreateColumn,canCreateMeasure:e.entity.canEdit||this.canCreateNewReportMeasureOnEntity(e.entity),canViewHidden:e.entity.schema.canEdit||t,canUnHideAll:e.entity.schema.canEdit||t,canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.createKpiMeasureMenuItems=function(e){return this.createMenuItems({canExpandCollapseAll:!0,hidden:e.hidden,showHidden:e.showHidden})},e.prototype.hasPropertyMenu=function(){return!0},e.prototype.hasEntityMenu=function(){return!0},e.prototype.createMenuItems=function(e){return{items:this.getMenuItemsAndSeparators(this.createMenuSections(e))}},e.prototype.createMenuSections=function(e){var t=[];return e.canAddToFilter&&this.addMenuItem(t,a.Filter,"FieldListMenuItem_AddFilter",0),e.canCreateMeasure&&this.addMenuItem(t,a.Create,"FieldListMenuItem_NewMeasure",10),e.canCreateColumn&&this.addMenuItem(t,a.Create,"FieldListMenuItem_NewColumn",13),e.canCreateQuickCalcMeasure&&this.addMenuItem(t,a.Create,"QuickCalc_NewMeasure",19),e.isEntity&&(e.canRefresh&&this.addMenuItem(t,a.Entity,"FieldListMenuItem_RefreshEntity",6),e.canEditEntity&&this.addMenuItem(t,a.Entity,"FieldListMenuItem_EditEntity",9),e.canCopyTable&&this.addMenuItem(t,a.Copy,"DataExplorerFieldListMenuItem_CopyTable",20)),e.canMoveUp&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_MoveUp",7),e.canMoveDown&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_MoveDown",8),e.canRename&&this.addMenuItem(t,a.Edit,"ItemAction_Rename",4),e.canDelete&&this.addMenuItem(t,a.Edit,"ItemAction_Delete",5),e.canHide&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_Hide",1,e.hidden),e.canHideInReportView&&this.addMenuItem(t,a.Edit,"FieldListMenuItem_HideInReportView",1,e.hidden),(e.canUnHideAll||e.canViewHidden)&&(e.canViewHidden&&this.addMenuItem(t,a.Hidden,"FieldListMenuItem_ViewHidden",2,e.showHidden),e.canUnHideAll&&this.addMenuItem(t,a.Hidden,"FieldListMenuItem_UnHideAll",3)),e.canExpandCollapseAll&&(this.addMenuItem(t,a.ExpandCollapse,"FieldListMenuItem_CollapseAll",14),this.addMenuItem(t,a.ExpandCollapse,"FieldListMenuItem_ExpandAll",15)),e.canGroup&&this.addMenuItem(t,a.Groups,"ContextMenuItem_CreateGroups",16),e.canEditGroups&&this.addMenuItem(t,a.Groups,"ContextMenuItem_EditGroups",17),e.canEditClustering&&this.addMenuItem(t,a.Groups,"Clustering_EditClusters",18),t},e.prototype.createHierarchyMenuSections=function(e,i){var r=e.contract,n=e.entity.contract.hierarchies;if(this.addMenuItem(i,a.HierarchyCreate,"FieldListMenuItem_NewHierarchy",11),!_.isEmpty(n)){var s=n.slice(0);o.sortHierarchies(s);var l=t.FieldListViewModelUtils.getHierarchyLevelDictionary(n),c=_.filter(s,(function(e){var t=l[e.name];return!(t&&t[r.name])})),u=_.map(c,(function(e){return{text:e.displayName,key:{action:12,hierarchyName:e.name},type:0,checked:!1}}));if(!_.isEmpty(u)){var p=this.addMenuItem(i,a.HierarchyAddTo,"FieldListMenuItem_AddToHierarchy",void 0);p.children=u}}return i},e.prototype.addMenuItem=function(e,t,i,r,o){void 0===o&&(o=!1);var a=n.createFieldListMenuItem(i,void 0!==r?{action:r}:void 0,this.localizationService,o);return this.addMenuItems(e,t,[a]),a},e.prototype.addMenuItems=function(e,t,i){var r=e[t];r||(r=[],e[t]=r),r.push.apply(r,i)},e.prototype.getMenuItemsAndSeparators=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];_.size(o)>0&&(t.length>0&&t.push(n.createItemSeparator()),t.push.apply(t,o))}return t},e.prototype.isQuickMeasureSupported=function(e){return this.featureSwitchService.featureSwitches.daxTemplatesEnabled&&(e.schema.canEdit||this.featureSwitchService.featureSwitches.daxTemplateForLiveConnectEnabled&&e.contractSchema.capabilities.isExtendable)},e})();t.FieldListMenuItemFactory=s})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}e.DefaultPropertyTemplate="Default",e.FolderPropertyTemplate="Folder",e.KpiPropertyTemplate="Kpi",e.HierarchyPropertyTemplate="Hierarchy",e.LeafPropertyTemplate="Leaf",e.createFieldListPropertyTemplateGenerator=t;var i=(function(){function t(){}return t.prototype.getTemplate=function(t){switch(t.fieldType){case 0:return this.getTemplateUri(e.DefaultPropertyTemplate);case 1:return this.getTemplateUri(e.FolderPropertyTemplate);case 4:return this.getTemplateUri(e.KpiPropertyTemplate);case 2:return this.getTemplateUri(e.HierarchyPropertyTemplate);case 5:case 3:return this.getTemplateUri(e.LeafPropertyTemplate);default:return this.getTemplateUri(e.DefaultPropertyTemplate)}},t.prototype.getTemplateUri=function(e){return"views/fieldListProperty"+e+".html"},t})();e.FieldListPropertyTemplateGenerator=i})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){return new i(e,t,r,o)}e.createFieldListViewModelFactory=t;var i=(function(){function t(e,t,i,r){this.menuItemFactory=e,this.propertyTemplateGenerator=t,this.localizationService=i,this.featureSwitchService=r}return Object.defineProperty(t.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),t.prototype.createModel=function(t,i,r){var o,n=t.schemas,a=e.FieldListViewModelUtils.getExtensions(n);n=e.FieldListViewModelUtils.sortExtensionSchemasAtEnd(n);for(var s=0,l=n;s<l.length;s++){var c=l[s];o=this.convertConceptualSchema(c,i,o,a,r)}return e.FieldListViewModelOperations.expandIfSingleEntity(o.entities),o},t.prototype.convertConceptualSchema=function(t,i,r,o,n){var a=this;r=r||new e.FieldListConceptualModel(t);var s=_.filter(t.entities,(function(t){return!e.FieldListViewModelUtils.isExtension(t)||e.FieldListViewModelUtils.isAbandoned(t)})),l=_.map(s,(function(e){return a.convertConceptualEntity(e,t,r,o)}));return(c=r.entities).push.apply(c,l),r.showNonUserEntities=i,r.disableEditing=n,r.menuItemFactory=this.menuItemFactory,r;var c},t.prototype.convertConceptualEntity=function(t,i,r,o){var n=this,a=new e.FieldListConceptualEntity(t,i,r);if(a.properties=[],t.properties&&!e.FieldListViewModelUtils.isExtension(t))for(var s=0,l=t.properties;s<l.length;s++){var c=l[s];c.measure&&c.measure.kpi?a.properties.push(this.convertConceptualKpi(c,i,a)):c.kpiValue||a.properties.push(this.convertConceptualProperty(c,i,a))}if(a.isMeasureGroup=e.FieldListViewModelUtils.isMeasureGroup(t.properties),a.expanded=!1,t.hierarchies&&t.hierarchies.length>0){a.hierarchies=_.map(t.hierarchies,(function(e){return n.convertConceptualHierarchy(e,i,a)}));for(var u=0,p=a.hierarchies;u<p.length;u++){var d=p[u];a.properties.push(d)}}if(!_.isEmpty(t.displayFolders)){var h;a.displayFolders=_.map(t.displayFolders,(function(e){return n.convertConceptualDisplayFolder(e,i,h,a)})),(C=a.properties).push.apply(C,a.displayFolders)}if(o){var v=e.FieldListViewModelUtils.getExtensionKey(i.name,t.name),g=o.entities[v];if(g)for(var f=0,m=g;f<m.length;f++)for(var y=m[f],w=0,S=y.entity.properties;w<S.length;w++){var c=S[w],b=this.convertConceptualExtensionMeasure(c,y.schema,a);a.properties.push(b)}}return e.FieldListViewModelUtils.sortProperties(a.properties),e.FieldListViewModelUtils.removeDuplicateProperties(a.properties,a.displayFolders),e.FieldListViewModelUtils.flattenFolders(a),e.FieldListViewModelUtils.updatePropertiesWithChildren(a),a;var C},t.prototype.convertConceptualDisplayFolder=function(e,t,i,r){for(var o={},n=0,a=r.properties;n<a.length;n++){var s=a[n];o[s.name]=s}return this.convertConceptualDisplayFolderCore(e,t,i,o,r)},t.prototype.convertConceptualDisplayFolderCore=function(t,i,r,o,n){for(var a=[],s=0,l=t.properties;s<l.length;s++){var c=l[s];if(c){var u=o[c.name];u&&a.push(u.clone())}}for(var p=0,d=t.hierarchies;p<d.length;p++){var h=d[p];if(h){var u=o[h.name];u&&a.push(u.clone())}}var v=new e.FieldListConceptualDisplayFolder(t,a,r,i,n);v.template=this.propertyTemplateGenerator.getTemplate(v);for(var g=0,f=t.displayFolders;g<f.length;g++){var m=f[g];v.children.push(this.convertConceptualDisplayFolderCore(m,i,v,o,n))}return e.FieldListViewModelUtils.sortProperties(v.children),v},t.prototype.convertConceptualHierarchy=function(t,i,r){var o=new e.FieldListConceptualHierarchy(t,i,r);o.template=this.propertyTemplateGenerator.getTemplate(o),o.hierarchyLevels=[];for(var n=0,a=t.levels;n<a.length;n++){var s=a[n];o.hierarchyLevels.push(this.convertConceptualHierarchyLevel(s,i,o))}return o},t.prototype.convertConceptualHierarchyLevel=function(t,i,r){var o=new e.FieldListConceptualHierarchyLevel(t,i,r,r.entity);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualProperty=function(t,i,r){var o=new e.FieldListConceptualProperty(t,i,r);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualExtensionMeasure=function(t,i,r){var o=new e.FieldListConceptualExtensionMeasure(t,i,r);return o.template=this.propertyTemplateGenerator.getTemplate(o),o},t.prototype.convertConceptualKpi=function(t,i,r){var o=this,n=new e.FieldListConceptualKpi(t,i,r);n.template=this.propertyTemplateGenerator.getTemplate(n);var a={};this.localizationService.ensureLocalization((function(){
a.KpiValueDisplayName=o.localizationService.get("KpiValueFieldListDisplayName"),a.KpiStatusDisplayName=o.localizationService.get("KpiStatusFieldListDisplayName"),a.KpiGoalDisplayName=o.localizationService.get("KpiGoalFieldListDisplayName"),a.KpiTrendDisplayName=o.localizationService.get("KpiTrendFieldListDisplayName")}));var s=t.measure.kpi,l=s.goal,c=s.status,u=s.trend;return n.kpiMeasures=[],n.kpiMeasures.push(this.convertConceptualKpiMeasure(t,i,2,n,r,a)),l&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(l,i,1,n,r,a)),c&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(c,i,0,n,r,a)),u&&n.kpiMeasures.push(this.convertConceptualKpiMeasure(u,i,3,n,r,a)),n},t.prototype.convertConceptualKpiMeasure=function(t,i,r,o,n,a){var s=new e.FieldListConceptualKpiMeasure(t,i,r,o,n,a);return s.template=this.propertyTemplateGenerator.getTemplate(s),s},t})()})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return _.find(e,(function(e){return!e.hidden}))&&!_.find(e,(function(e){return!e.hidden&&1!==e.kind&&2!==e.kind}))}function i(e){for(var t={entities:{}},i=0,r=e;i<r.length;i++){var a=r[i];if(n(a))for(var s=a.extends,l=0,c=a.entities;l<c.length;l++){var u=c[l];if(n(u)){var p={schema:a,entity:u},d=o(s,u.name),h=t.entities[d];h?h.push(p):(h=[p],t.entities[d]=h)}}}return t}function r(e){var t=_.where(e,(function(e){return!n(e)})),i=_.where(e,(function(e){return n(e)}));return _.union(t,i)}function o(e,t){return JSON.stringify({e:t})}function n(e){return e.hasOwnProperty("extends")}function a(e){var t=e;return t.isAbandoned}function s(e){for(var t=0,i=e.properties;t<i.length;){var r=i[t];if(r.properties)for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];i.splice(t+1,0,a),t++}t++}}function l(e){_.isEmpty(e)||e.sort(c)}function c(e,t){var i=e.displayName.toLocaleUpperCase(),r=t.displayName.toLocaleUpperCase();return i.localeCompare(r)}function u(e,t){if(!_.isEmpty(e)){var i={};p(t,i);var r=_.filter(e,(function(e){return 1!==e.fieldType&&i[e.name]}));_.isEmpty(r)||_.pull.apply(_,[e].concat(r))}}function p(e,t){if(!_.isEmpty(e)){for(var i=[],r=0,o=e;r<o.length;r++)for(var n=o[r],a=0,s=n.children;a<s.length;a++){var l=s[a];1===l.fieldType?i.push(l):t[l.name]=l}p(i,t)}}function d(e){var t=[];h(e.properties,t),e.properties=t}function h(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(t.push(o),1===o.fieldType){var n=o;h(n.children,t)}}}function v(e){var t={};if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i],n={};t[o.name]=n;for(var a=0,s=o.levels;a<s.length;a++){var l=s[a];n[l.column.name]=l}}return t}e.isMeasureGroup=t,e.getExtensions=i,e.sortExtensionSchemasAtEnd=r,e.getExtensionKey=o,e.isExtension=n,e.isAbandoned=a,e.updatePropertiesWithChildren=s,e.sortProperties=l,e.removeDuplicateProperties=u,e.flattenFolders=d,e.getHierarchyLevelDictionary=v})(t=e.FieldListViewModelUtils||(e.FieldListViewModelUtils={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(i){function r(e,t,i,r,n,a){if(e&&t||(e={schema:void 0,isLoaded:!1}),t){var s=t.schemas;_.any(s)&&(e.schema?o(e,t,n,r,i):(e.schema=i.createModel(t,n,a),e.isLoaded=!0))}return e}function o(e,i,r,o,n){var a=t.FieldListViewModelUtils.getExtensions(i.schemas);g.visitModel(e,i,a,[new f(e.schema,o),new m(n,a),new y(n,a,o),new w])}function n(e,t,i,r){t.contract=i;for(var o=i.measure.kpi,n=0,s=t.kpiMeasures;n<s.length;n++){var l=s[n],c=void 0;switch(l.kpiType){case 2:c=i;break;case 1:c=o.goal;break;case 0:c=o.status;break;case 3:c=o.trend}a(l,c)}}function a(e,t){e.contract=t}function s(e,i,r,o,n){var a={};if(!_.isEmpty(i))for(var c=0,u=i;c<u.length;c++){var p=u[c];a[p.name]=p}for(var d=0,h=r;d<h.length;d++){var v=h[d],g=v.name,p=a[g];if(p){delete a[g];var f=_.filter(p.children,(function(e){return 1===e.fieldType}));l(e,p,v),s(e,f,v.displayFolders,o,p)}else{var m=o.convertConceptualDisplayFolder(v,e.contractSchema,n,e);n?(n.children||(n.children=[]),n.children.push(m),t.FieldListViewModelUtils.sortProperties(n.children)):(e.displayFolders||(e.displayFolders=[]),e.displayFolders.push(m),e.properties.push(m))}}if(!_.isEmpty(a)){var y=_.values(a);n?_.pull.apply(_,[n.children].concat(y)):_.pull.apply(_,[e.displayFolders].concat(y))}}function l(e,t,i){var r={},o=_.filter(t.children,(function(e){return 1!==e.fieldType}));if(!_.isEmpty(o))for(var n=0,a=o;n<a.length;n++){var s=a[n];r[s.name]=s}if(!_.isEmpty(i.properties))for(var l=0,c=i.properties;l<c.length;l++){var u=c[l],p=u.name,s=r[p];if(s)delete r[p];else{var d=e.findFields(p,t.schemaName)||e.findKpis(p,t.schemaName);d&&t.children.push(d[0].clone())}}if(!_.isEmpty(i.hierarchies))for(var h=0,v=i.hierarchies;h<v.length;h++){var g=v[h],f=g.name,m=r[f];if(m)delete r[f];else{var d=e.findHierarchies(f,t.schemaName);d&&t.children.push(_.first(d).clone())}}if(!_.isEmpty(r)){var y=_.values(r);_.pull.apply(_,[t.children].concat(y))}}function c(e){var t=e.properties,i=_.filter(t,(function(e){return 1===e.fieldType}));_.isEmpty(i)||_.pull.apply(_,[t].concat(i)),e.displayFolders&&t.push.apply(t,e.displayFolders)}function u(e){return!!e.measure&&!!e.measure.kpi}function p(e){return!!e.kpiValue}function d(e,t,i,r,o){if(!_.isEmpty(e)){var n=_.filter(e,(function(e){return e.propertyRename&&e.propertyRename.after===t}));_.isEmpty(n)||(t=n[0].propertyRename.before)}return r.findFieldsByType(t,i,o)}var h=e.explore.util.HierarchyUtils,v=e.data.contracts.SchemaChangeType.ObjectTypeEnum;i.mergeModel=r;var g;!(function(e){function i(e,i,o,n){for(var a,s=t.FieldListViewModelUtils.sortExtensionSchemasAtEnd(i.schemas),l=0,c=s;l<c.length;l++){var u=c[l];if(!t.FieldListViewModelUtils.isExtension(u))for(var p=0,d=n;p<d.length;p++){var h=d[p];a=h.visitModel(a,u)}for(var v=0,g=u.entities;v<g.length;v++){var f=g[v];t.FieldListViewModelUtils.isExtension(f)&&!t.FieldListViewModelUtils.isAbandoned(f)||r(u,f,o,n)}if(!t.FieldListViewModelUtils.isExtension(u))for(var m=0,y=n;m<y.length;m++){var h=y[m];a=h.modelVisited(a,u)}}}function r(e,i,r,c){for(var h,v=0,g=c;v<g.length;v++){var f=g[v];h=f.visitEntity(h,e,i)}if(!t.FieldListViewModelUtils.isExtension(i))for(var m=0,y=i.properties;m<y.length;m++){var w=y[m];t.FieldListViewModelUtils.isExtension(w)||(u(w)?a(e,w,c):p(w)?s(e,w,c):o(e,w,c))}var S=r.entities[t.FieldListViewModelUtils.getExtensionKey(e.name,i.name)];if(S)for(var b=0,C=S;b<C.length;b++)for(var x=C[b],M=0,D=x.entity.properties;M<D.length;M++){var w=D[M];n(x.schema,w,c)}for(var F=0,E=i.hierarchies;F<E.length;F++){var V=E[F];l(e,V,c)}for(var P=0,T=c;P<T.length;P++){var f=T[P];h=f.entityVisited(h,i)}for(var A=0,I=i.displayFolders;A<I.length;A++){var k=I[A];d(e,k,c)}}function o(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitProperty(r,e,t)}}function n(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitExtensionMeasure(r,e,t)}}function a(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitKpi(r,e,t)}}function s(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitKpiMeasure(r,e,t)}}function l(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitHierarchy(r,e,t)}for(var s=0,l=t.levels;s<l.length;s++){var u=l[s];c(e,u,i)}}function c(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitHierarchyLevel(r,e,t)}}function d(e,t,i){for(var r,o=0,n=i;o<n.length;o++){var a=n[o];r=a.visitDisplayFolder(r,e,t)}for(var s=0,l=t.displayFolders;s<l.length;s++){var c=l[s];d(e,c,i)}}e.visitModel=i})(g||(g={}));var f=(function(){function e(e,t){this.fieldListConceptualModel=e,t&&(this.schemaChanges=t.changes,this.entityRenameChanges=_.filter(this.schemaChanges,(function(e){return e.entityRename})))}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel},e.prototype.visitEntity=function(e,i,r){return this.fieldListConceptualEntity=this.getFieldListConceptualEntity(r),this.fieldListConceptualEntity&&t.FieldListViewModelUtils.isAbandoned(this.fieldListConceptualEntity.contract)!==t.FieldListViewModelUtils.isAbandoned(r)&&(this.fieldListConceptualEntity=null),this.propertyRenameChanges=this.fieldListConceptualEntity&&_.filter(this.schemaChanges,(function(e){return e.propertyRename&&e.propertyRename.entity===r.name&&e.propertyRename.objectType!==v.Hierarchy})),this.hierarchyRenameChanges=this.fieldListConceptualEntity&&_.filter(this.schemaChanges,(function(e){return e.propertyRename&&e.propertyRename.entity===r.name&&e.propertyRename.objectType===v.Hierarchy})),this.fieldListConceptualEntity},e.prototype.visitProperty=function(e,t,i){if(this.fieldListConceptualEntity){var r=d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,0);return _.filter(r,(function(e){return!e.isExtension}))}},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity){var r=d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,0);return _.filter(r,(function(e){return e.isExtension}))}},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualHierarchies=this.fieldListConceptualEntity&&d(this.hierarchyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,2),_.isEmpty(this.fieldListConceptualHierarchies))this.fieldListConceptualHierarchies=null,this.existingLevels=null;else{this.existingLevels={};for(var r=_.first(this.fieldListConceptualHierarchies).hierarchyLevels,o=0,n=r;o<n.length;o++){var a=n[o];this.existingLevels[a.name]=a}}return this.fieldListConceptualHierarchies},e.prototype.visitHierarchyLevel=function(e,t,i){var r=this;if(!_.isEmpty(this.fieldListConceptualHierarchies)){var o=i.name,n=_.first(this.fieldListConceptualHierarchies),a=_.filter(this.schemaChanges,(function(e){return e.hierarchyLevelRename&&e.hierarchyLevelRename.entity===r.fieldListConceptualEntity.contract.name&&e.hierarchyLevelRename.hierarchy===n.contract.name&&e.hierarchyLevelRename.after===o}));return _.isEmpty(a)||(o=_.first(a).hierarchyLevelRename.before),this.existingLevels[o]}},e.prototype.visitKpi=function(e,t,i){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,4)},e.prototype.visitKpiMeasure=function(e,t,i){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,5)},e.prototype.visitDisplayFolder=function(e,t,i){return this.fieldListConceptualEntity?d(this.propertyRenameChanges,i.name,t.name,this.fieldListConceptualEntity,1):e},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e},e.prototype.getFieldListConceptualEntity=function(e){var t=e.name;if(!_.isEmpty(this.entityRenameChanges)){var i=_.filter(this.entityRenameChanges,(function(t){return t.entityRename&&t.entityRename.after===e.name}));_.isEmpty(i)||(t=i[0].entityRename.before)}return this.fieldListConceptualModel.findEntity(t)},e})(),m=(function(){function e(e,t){this.fieldListViewModelFactory=e,this.extensions=t}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel=e,e&&(e.contract=t),e},e.prototype.visitEntity=function(e,t,i){return this.fieldListConceptualEntity=e,e&&(e.contract=i),this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e},e.prototype.visitProperty=function(e,t,i){if(e)for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitExtensionMeasure=function(e,t,i){if(e)for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitHierarchy=function(e,t,i){if(e){for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}this.fieldListConceptualHierarchies=e;for(var a=0,s=this.fieldListConceptualHierarchies;a<s.length;a++){var l=s[a];l.hierarchyLevels=[]}}return e},e.prototype.visitHierarchyLevel=function(e,t,i){if(e){e.contract=i.column,e.hierarchyLevelContract=i;for(var r=0,o=this.fieldListConceptualHierarchies;r<o.length;r++){var n=o[r];n.hierarchyLevels.push(e)}}return e},e.prototype.visitKpi=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var a=o[r];n(this.fieldListConceptualEntity,a,i,this.fieldListConceptualEntity.contract)}return e},e.prototype.visitKpiMeasure=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];n.contract=i}return e},e.prototype.visitDisplayFolder=function(e,t,i){return e},e})(),y=(function(){function e(e,t,i){this.fieldListViewModelFactory=e,this.extensions=t,i&&(this.modelSchemaChanges=i.changes)}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel=e,this.schema=t,e},e.prototype.visitEntity=function(e,i,r){if(this.fieldListConceptualEntity=e,this.fieldListConceptualModel&&!e){var o=this.fieldListViewModelFactory.convertConceptualEntity(r,i,this.fieldListConceptualModel,this.extensions);this.fieldListConceptualModel.entities.push(o)}return this.sortedHierarchies=r.hierarchies.slice(0),h.sortHierarchies(this.sortedHierarchies),this.hierarchyLevelDictionary=this.fieldListConceptualModel.canEdit&&t.FieldListViewModelUtils.getHierarchyLevelDictionary(r.hierarchies),this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e&&s(this.fieldListConceptualEntity,this.fieldListConceptualEntity.displayFolders,t.displayFolders,this.fieldListViewModelFactory,null),e},e.prototype.visitProperty=function(e,t,i){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualProperty(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(r)}return e},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualExtensionMeasure(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(r)}return e},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualHierarchies=e,this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualHierarchy(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.hierarchies||(this.fieldListConceptualEntity.hierarchies=[]),this.fieldListConceptualEntity.hierarchies.push(r),this.fieldListConceptualEntity.properties.push(r),this.expandHierarchyIfJustCreated(r),e=[r]}return e},e.prototype.visitHierarchyLevel=function(e,t,i){if(!_.isEmpty(this.fieldListConceptualHierarchies)&&!e){var r=_.first(this.fieldListConceptualHierarchies);e=this.fieldListViewModelFactory.convertConceptualHierarchyLevel(i,t,r);for(var o=0,n=this.fieldListConceptualHierarchies;o<n.length;o++){var a=n[o];a.hierarchyLevels.push(e)}}return e},e.prototype.visitKpi=function(e,t,i){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var r=this.fieldListViewModelFactory.convertConceptualKpi(i,t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(r),e=[r]}return e},e.prototype.visitKpiMeasure=function(e,t,i){return e},e.prototype.visitDisplayFolder=function(e,t,i){return e},e.prototype.expandHierarchyIfJustCreated=function(e){var t=this;_.any(this.modelSchemaChanges,(function(i){var r=i.hierarchyCreate&&i.hierarchyCreate.entity===t.fieldListConceptualEntity.contract.name&&i.hierarchyCreate.name===e.name;return r}))&&(e.expanded=!0)},e})(),w=(function(){function e(){}return e.prototype.visitModel=function(e,t){this.fieldListConceptualModel=e,this.existingEntities=[];for(var i=0,r=this.fieldListConceptualModel.entities;i<r.length;i++){var o=r[i];this.existingEntities.push(o)}return e},e.prototype.visitEntity=function(e,t,i){if(this.fieldListConceptualEntity=e,e){if(_.pull(this.existingEntities,e),this.existingHierarchies=[],this.fieldListConceptualEntity.hierarchies)for(var r=0,o=this.fieldListConceptualEntity.hierarchies;r<o.length;r++){var n=o[r];this.existingHierarchies.push(n)}this.existingProperties=[];for(var a=0,s=this.fieldListConceptualEntity.properties;a<s.length;a++){var l=s[a];this.existingProperties.push(l)}}return this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,i){return _.pull.apply(_,[this.fieldListConceptualModel.entities].concat(this.existingEntities)),t.FieldListViewModelOperations.expandIfSingleEntity(this.fieldListConceptualModel.entities),e},e.prototype.entityVisited=function(e,i){return e&&(_.pull.apply(_,[this.fieldListConceptualEntity.hierarchies].concat(this.existingHierarchies)),_.pull.apply(_,[this.fieldListConceptualEntity.properties].concat(this.existingProperties)),c(this.fieldListConceptualEntity),t.FieldListViewModelUtils.sortProperties(this.fieldListConceptualEntity.properties),t.FieldListViewModelUtils.removeDuplicateProperties(this.fieldListConceptualEntity.properties,this.fieldListConceptualEntity.displayFolders),t.FieldListViewModelUtils.flattenFolders(this.fieldListConceptualEntity),t.FieldListViewModelUtils.updatePropertiesWithChildren(this.fieldListConceptualEntity)),e},e.prototype.visitProperty=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e.prototype.visitExtensionMeasure=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e.prototype.visitHierarchy=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n),_.pull(this.existingHierarchies,n)}return e},e.prototype.visitHierarchyLevel=function(e,t,i){return e},e.prototype.visitKpi=function(e,t,i){if(!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e.prototype.visitKpiMeasure=function(e,t,i){return e},e.prototype.visitDisplayFolder=function(e,t,i){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var r=0,o=e;r<o.length;r++){var n=o[r];_.pull(this.existingProperties,n)}return e},e})()})(i=t.FieldListViewModelMerger||(t.FieldListViewModelMerger={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.services.schemaItemActivationUtils,a=e.data.SQExprBuilder;!(function(e){function t(e){return e.supported&&(!e.hidden||e.showHidden)}e.isFieldVisible=t})(r=i.FieldListUtils||(i.FieldListUtils={}));var s;!(function(t){function i(e,t,i){var r=f(i);if(r)return l(e,r),n.setActiveSchemaItem(t,r),r}function r(e,t){for(var i=0,r=e.entities;i<r.length;i++){var o=r[i];o.expanded=t;for(var n=0,a=o.properties;n<a.length;n++){var s=a[n];2!==s.fieldType&&4!==s.fieldType&&1!==s.fieldType||(s.expanded=t)}}}function s(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n.entity){var a=t.findEntity(n.entity);a&&(a.expanded=!0)}}function l(e,i){s(e,i),t.updateSelection(e,i)}function c(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n&&n.entity)if(o.hasFieldExprName(r)){var a=t.findFields(n.entity,o.getPropertyName(r),n.schema);if(a){for(var s=0,l=a;s<l.length;s++){var c=l[s];c.hidden=!c.hidden}return _.first(a).hidden}}else if(r.hierarchy){var u=t.findHierarchies(n.entity,o.getHierarchyName(r),n.schema);if(u){for(var p=0,d=u;p<d.length;p++){var h=d[p];h.hidden=!h.hidden}return _.first(u).hidden}}else{var v=t.findEntity(n.entity);if(v)return v.hidden=!v.hidden,v.hidden}}function u(e){e.showHidden=!e.showHidden}function p(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.canEdit&&r.hidden&&(r.hidden=!1);for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.canEdit&&a.hidden&&(a.hidden=!1)}}}function d(e){for(var t=0,i=e.entities;t<i.length;t++)for(var r=i[t],o=0,n=r.properties;o<n.length;o++){var a=n[o],s=a;s.supported=!(s.type&&s.type.binary)}}function h(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.selected=!1;for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.selected=!1}}}function v(i,r){t.clearSelection(i);var n=e.data.SQExprConverter.asFieldPattern(r);if(n){var a=o.toFieldExprEntityItemPattern(n);if(a.entity)if(o.hasFieldExprName(n)){var s=i.findFields(a.entity,o.getPropertyName(n),a.schema);if(s)for(var l=0,c=s;l<c.length;l++){var u=c[l];u.selected=!0}}else{var p=i.findEntity(a.entity);p&&(p.selected=!0)}}}function g(e){var t=_.filter(e,(function(e){return e.userEntity&&!e.hidden}));1===t.length&&(t[0].expanded=!0)}function f(e){if(null!=e&&!_.isEmpty(e.changes)){var t=_.filter(e.changes,(function(e){return e.newMeasureCreated||e.newCalculatedColumnCreated||e.measureMove||e.newCalculatedTableCreated||e.newBins||e.newGroups}));if(1===t.length){var i,r,o,n,s=t[t.length-1];return s.newMeasureCreated?(i=s.newMeasureCreated.schema,r=s.newMeasureCreated.entity,n=s.newMeasureCreated.measureDefinition.name,a.measureRef(a.entity(i,r),n)):s.newCalculatedColumnCreated?(i=s.newCalculatedColumnCreated.schema,r=s.newCalculatedColumnCreated.entity,o=s.newCalculatedColumnCreated.name,a.columnRef(a.entity(i,r),o||n)):s.newCalculatedTableCreated?(i=s.newCalculatedTableCreated.schema,r=s.newCalculatedTableCreated.entity,a.entity(i,r)):s.measureMove?(i=s.measureMove.schema,r=s.measureMove.destination,n=s.measureMove.property,a.measureRef(a.entity(i,r),n)):s.newBins?(i=s.newBins.schema,r=s.newBins.entity,o=s.newBins.name,a.columnRef(a.entity(i,r),o)):s.newGroups?(i=s.newGroups.schema,r=s.newGroups.entity,o=s.newGroups.name,a.columnRef(a.entity(i,r),o)):void 0}}}t.applyModelChanges=i,t.collapseOrExpandAllEntities=r,t.expandEntity=s,t.expandEntityAndSelect=l,t.toggleHide=c,t.toggleShowHidden=u,t.unhideAll=p,t.updateSupportedProperties=d,t.clearSelection=h,t.updateSelection=v,t.expandIfSingleEntity=g})(s=i.FieldListViewModelOperations||(i.FieldListViewModelOperations={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=e.explore.utils.GroupUtils,a=e.data.SQExprBuilder,s=e.data.SQExprUtils,l=e.data.SQHierarchyExprUtils,c=e.explore.util.VisualContainerUtils;!(function(i){function r(e,t,i,r,n,a,s){var l=new v(e,n,a,t,i,r,s);return o.visit(e,l)}function u(e){return{type:0}}function p(e,t,i,r,n,a,s,l,c){return{items:o.visit(e.expr,new g(e,t,i,r,n,a,s,l,c))}}function d(e,t){var i=e.getConceptualProperty(t);return i&&1===i.kind}var h="Aggregate_";i.createAggregateMenuItems=r;var v=(function(){function i(e,t,i,r,o,n,a){this.sqExpr=e,this.dataRoleKind=t,this.requiredTypes=i,this.schema=r,this.aggrOps=o,this.hasHierarchyLevels=n,this.property=a}return i.prototype.visitEntity=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnHierarchyLevelVariation=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitEntityAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchy=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevel=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevelAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitMeasure=function(e){return[]},i.prototype.visitPercentOfGrandTotal=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItemsForPercentOfTotal(t)},i.prototype.visitPercentOfRoleTotal=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItemsForPercentOfTotal(t)},i.prototype.visitPercentile=function(e){return[]},i.prototype.visitSelectRef=function(e){return[]},i.prototype.visitFilteredEval=function(e){var t=a.fieldExpr(e.baseExpr);return this.createMenuItems(t)},i.prototype.createMenuItemsForPercentOfTotal=function(e){var t=a.removeAggregate(e).getMetadata(this.schema);if(!t)return[];var i=t.type,r=i.text||i.dateTime||i.duration?[3,4]:[];return this.createMenuItems(e,r)},i.prototype.createMenuItems=function(t,i){void 0===i&&(i=[]);var r=[];if(!this.hasHierarchyLevels&&_.isEmpty(t.validate(this.schema,this.aggrOps))&&!s.discourageAggregation(t,this.schema)){var o=this.dataRoleKind===e.VisualDataRoleKind.Grouping,n=this.dataRoleKind===e.VisualDataRoleKind.GroupingOrMeasure,a=o?[]:this.aggrOps.getSupportedAggregates(t,this.schema,this.requiredTypes);a=_.difference(a,i),n&&!d(t,this.schema)&&r.push(this.createRemoveAggregateMenuItem());for(var l=0,c=a;l<c.length;l++){var u=c[l];r.push(this.createAggregateMenuItem(u))}}return r},i.prototype.createAggregateMenuItem=function(i){var r=u(this.property);r.key={action:2,aggregate:i};var o=a.removeAggregate(this.sqExpr).getMetadata(this.schema),n=t.services.getAggregateKey(i,o);return r.text=e.common.localize.get(h+n),r},i.prototype.createRemoveAggregateMenuItem=function(){var t=u(this.property);return t.key={action:1},t.text=e.common.localize.get("FieldWell_RemoveAggregate"),t},i.prototype.visitTransformOutputRoleRef=function(e){return[]},i})(),g=(function(){function t(e,t,i,r,o,n,a,s,l){this.property=e,this.bucket=t,this.dataRole=i,this.schema=r,this.aggrOps=o,this.visual=n,this.featureSwitchService=a,this.groupingDesignStateService=s,this.showValueAsService=l,this.featureSwitchService.featureSwitches.fieldAlias&&this.property.isEditableField?this.menuItems=[this.createDeleteMenuItem(),this.createRenameMenuItem()]:this.menuItems=[this.createDeleteMenuItem()]}return t.prototype.visitEntity=function(e){return this.menuItems},t.prototype.visitColumn=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitColumnAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumn=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumnAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.source.schema),this.addQuickCalcMenuItem(e.source.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitEntityAggr=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitHierarchy=function(e){return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addShowAllMenuItem(_.first(this.property.hierarchyLevels).expr),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevel=function(e){var t=this.property.expr;return this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevelAggr=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitMeasure=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.addShowValueAsMenuItem(e.schema),this.addQuickCalcMenuItem(e.schema),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitPercentile=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItems(t),this.menuItems},t.prototype.visitSelectRef=function(e){return[]},t.prototype.visitTransformOutputRoleRef=function(e){return[]},t.prototype.visitPercentOfGrandTotal=function(e){return this.addPercentTotalMenuItems(e.baseExpr)},t.prototype.visitPercentOfRoleTotal=function(e){return this.addPercentTotalMenuItems(e.baseExpr)},t.prototype.visitFilteredEval=function(e){return this.addFilteredEvalMenuItems()},t.prototype.addFilteredEvalMenuItems=function(){return this.addAggregateMenuItems(),this.menuItems},t.prototype.addPercentTotalMenuItems=function(e){var t=a.fieldExpr(e);this.addConditionalFormattingMenuItems(t),this.addAggregateMenuItems(),this.addShowValueAsMenuItem(o.getSchema(e)),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels);var i=o.getProperty(e);return i&&this.addVariationsMenuItems(i),this.menuItems},t.prototype.addAggregateMenuItems=function(){var e=r(this.property.expr,this.schema,this.aggrOps,!_.isEmpty(this.property.hierarchyLevels),this.dataRole.kind,this.dataRole.requiredTypes,this.property);_.isEmpty(e)||(this.menuItems.push(this.createSeparatorMenuItem()),(t=this.menuItems).push.apply(t,e));var t},t.prototype.addConditionalFormattingMenuItems=function(e){if(!_.isEmpty(this.property.conditionalFormattingRepetitions)){var t=e.getMetadata(this.schema);if(t){var i=1===t.kind&&t.type.numeric,r=c.hasGroupByItems(this.visual.query);i&&!r&&(this.menuItems.push(this.createSeparatorMenuItem()),this.addSetConditionalFormattingMenuItem(),this.addRemoveConditionalFormattingMenuItem())}}},t.prototype.addSetConditionalFormattingMenuItem=function(){if(!_.isEmpty(this.property.conditionalFormattingRepetitions)){var t=u(this.property);t.text=e.common.localize.get("FieldWell_ConditionalFormatting"),this.menuItems.push(t);for(var i=t.children=[],r=0,o=this.property.conditionalFormattingRepetitions;r<o.length;r++){var n=o[r];i.push(this.createConditionalFormattingMenuItem(n.propertyDescriptor.displayName,12,n))}}},t.prototype.addRemoveConditionalFormattingMenuItem=function(){var t=this.property.conditionalFormattingRepetitions;if(!_.isEmpty(t)){var i=u(this.property);i.text=e.common.localize.get("FieldWell_RemoveConditionalFormatting"),this.menuItems.push(i);for(var r=[],o=!1,n=this.visual&&this.visual.objects,a=0,s=t;a<s.length;a++){var l=s[a],c=n&&null!=e.VisualObjectRepetition.getDefinition(n,l);r.push(c),o=o||c}if(!o)return void(i.disabled=!0);var p=i.children=[];p.push(this.createConditionalFormattingMenuItem(e.data.createDisplayNameGetter("FieldWell_ConditionalFormatting_All"),13));for(var d=0,h=t.length;d<h;d++){var l=t[d],v=this.createConditionalFormattingMenuItem(l.propertyDescriptor.displayName,14,l);v.disabled=!r[d],p.push(v)}}},t.prototype.createConditionalFormattingMenuItem=function(t,i,r){var o=u(this.property);return o.key={action:i,conditionalFormattingRepetition:r},o.text=e.data.getDisplayName(t,e.common.localize),o},t.prototype.addShowAllMenuItem=function(t){var i=s.isMeasure(t);c.hasGroupByItems(this.visual.query)||(this.dataRole.kind===e.VisualDataRoleKind.Grouping||this.dataRole.kind===e.VisualDataRoleKind.GroupingOrMeasure&&!i)&&(this.menuItems.push(this.createSeparatorMenuItem()),
this.menuItems.push(this.createShowAllMenuItem()))},t.prototype.addHierarchiesMenuItems=function(e){if(!_.isEmpty(e)){var t=_.first(e),i=l.expandExpr(this.schema,t.expr.arg);i instanceof Array&&i.length===e.length||this.bucket.supportsMultipleItems&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createRestoreHierarchyMenuItem()))}},t.prototype.addShowValueAsMenuItem=function(t){if(_.isEmpty(this.property.hierarchyLevels)&&this.property.expr.getConceptualProperty(this.schema)){var i=this.schema.schema(t),r=i&&i.capabilities.supportsScopedEval;if(this.featureSwitchService.featureSwitches.quickCalc&&!c.hasGroupByItems(this.visual.query)&&r&&this.dataRole.kind!==e.VisualDataRoleKind.Grouping){var o=this.property.expr,n=this.showValueAsService.createShowValueAsMenuItems(o,this.schema,this.visual.visualType);_.isEmpty(n)||(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createShowValueAsMenuItem(n)))}}},t.prototype.addQuickCalcMenuItem=function(e){if(this.property.expr.getConceptualProperty(this.schema)){var t=this.schema.schema(e),i=t&&t.capabilities.canEdit&&!t.isExtensionSchema;(this.featureSwitchService.featureSwitches.daxTemplatesEnabled&&i||this.featureSwitchService.featureSwitches.daxTemplateForLiveConnectEnabled&&this.canAuthorReportMeasuresOnSchema(t))&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createQuickCalcMenuItem()))}},t.prototype.canAuthorReportMeasuresOnSchema=function(e){return e.capabilities.isExtendable||e.isExtensionSchema},t.prototype.addVariationsMenuItems=function(t){var i=a.fromColumn(t),r=i.getConceptualProperty(this.schema);if(r){var o=r.column;if(o&&!_.isEmpty(o.variations)){for(var n=a.entity(t.schema,t.entity),s=this.createVariationMenuItem(r.displayName,i),l=[],c=0,u=o.variations;c<u.length;c++){var p=u[c];if(p.navigationProperty&&p.navigationProperty.targetEntity){var d=p.navigationProperty.targetEntity;if(this.dataRole.kind!==e.VisualDataRoleKind.Measure)for(var h=_.filter(d.hierarchies,(function(e){return!e.hidden})),v=0,g=h;v<g.length;v++){var f=g[v],m=a.hierarchy(a.propertyVariationSource(n,p.name,r.name),f.name);l.push(this.createVariationMenuItem(f.name,m))}for(var y=a.entity(n.schema,d.name),w=_.filter(d.properties,(function(e){return!e.hidden})),S=0,b=w;S<b.length;S++){var C=b[S],x=a.columnRef(y,C.name);l.push(this.createVariationMenuItem(C.displayName,x))}}}if(!_.isEmpty(l)){this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(s),(M=this.menuItems).push.apply(M,l);var M}}}},t.prototype.addGroupsMenuItems=function(e){var t=this.schema.schema(e.schema),i=(t&&t.capabilities.canEdit&&t.capabilities.supportsGrouping)!==!1;if(i){var r=this.featureSwitchService.featureSwitches.enableGroupAuthoring,o=this.featureSwitchService.featureSwitches.clusteringEnabled;if(r||o){var a=[],s=this.property.expr.getConceptualProperty(this.schema);!n.canExprBeGrouped(this.schema,this.property.expr)||this.property.hierarchyLevels&&this.property.hierarchyLevels.length>0||a.push(this.createGroupsMenuItem()),n.isGroupOrBinColumn(e.entity,s,this.groupingDesignStateService)&&a.push(this.createEditGroupsMenuItem()),n.isClusteringColumn(e.entity,s,this.groupingDesignStateService)&&a.push(this.createEditClusteringMenuItem()),a.length>0&&(this.menuItems.push(this.createSeparatorMenuItem()),(l=this.menuItems).push.apply(l,a))}var l}},t.prototype.createShowValueAsMenuItem=function(t){var i=u(this.property);i.key={action:4};var r="FieldWell_ShowValueAs";return i.text=e.common.localize.get(r),i.children=t,i},t.prototype.createQuickCalcMenuItem=function(){var t=u(this.property);t.key={action:6};var i="QuickCalc_NewMeasure";return t.text=e.common.localize.get(i),t},t.prototype.createGroupsMenuItem=function(){var t=u(this.property);return t.key={action:8},t.text=e.common.localize.get("ContextMenuItem_CreateGroups"),t},t.prototype.createEditGroupsMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("ContextMenuItem_EditGroups"),t.key={action:9},t},t.prototype.createEditClusteringMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("Clustering_EditClusters"),t.key={action:10},t},t.prototype.createRestoreHierarchyMenuItem=function(){var t=u(this.property);return t.text=e.common.localize.get("FieldWell_RestoreHierarchy"),t.key={action:11},t},t.prototype.createVariationMenuItem=function(e,t){var i=u(this.property);return i.text=e,i.key={action:7,variationExpr:t},i},t.prototype.createShowAllMenuItem=function(){var t=u(this.property);return t.key={action:3},t.text=e.common.localize.get("FieldWell_ShowAll"),t},t.prototype.createDeleteMenuItem=function(){var t=u(this.property);return t.key={action:0},t.text=e.common.localize.get("FieldWell_Remove"),t},t.prototype.createSeparatorMenuItem=function(){var e=u(this.property);return e.type=1,e},t.prototype.createRenameMenuItem=function(){var e=u(this.property);return e.key={action:15},e.text="Rename",e},t})();i.createDropDownItems=p})(r=i.MenuItemFactory||(i.MenuItemFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.filterChanged={name:"filterChanged"}})(t=e.FilterEvents||(e.FilterEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.contracts.FilterType,o=e.data.SQExprUtils,n=e.explore.util.VisualContainerUtils,a=(function(i){function a(e,t){var r=i.call(this,e,{expanded:!1,canToggleSingleSelect:!1,availableTypes:[],type:e.type})||this;return r.id=a.counter++,r.restatement="",r.displayName="",r.containerScope=t,r.howCreated=0,r}return __extends(a,i),a.prototype.setServices=function(e,t){this.visualHostServices=e,this.visualPlugin=t},a.prototype.isInvalid=function(){return this.invalid},Object.defineProperty(a.prototype,"isVisualFilter",{get:function(){return this.containerScope&&0===this.containerScope.scopeType},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasDefaultValue",{get:function(){return this.defaultValue&&(1===this.howCreated||5===this.howCreated)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canDeleteManually",{get:function(){return 1===this.howCreated||5===this.howCreated||this.readOnlyState.invalid},enumerable:!0,configurable:!0}),a.prototype.getFilterContainerScope=function(){return this.containerScope},a.prototype.setRestatement=function(e){this.contract.type===this.readOnlyState.type&&(this.restatement=e)},a.prototype.clearRestatement=function(){this.restatement=""},a.prototype.getRestatement=function(){return this.restatement},Object.defineProperty(a.prototype,"visualContainer",{get:function(){if(this.isVisualFilter)return this.containerScope.container},enumerable:!0,configurable:!0}),a.prototype.updateFilterProperties=function(e,i,r){if(this.contract.expression){var a=this.contract.expression;this.isMeasure=o.isMeasure(a),this.discourageAggregation=o.discourageAggregation(a,e),this.valueType=t.FilterUtils.getValueType(a,e),this.formatter=t.FilterUtils.getFormatter(a,e),this.defaultValue=o.getDefaultValue(a,e);var s=5===this.howCreated;s||(s=1===o.getAggregateBehavior(a,e)),s&&(this.isSingleSelectionRequired=!0,this.disableSelectionModeToggle=!0)}var l=this.containerScope.container;this.hasGroupingScope=l&&n.hasGrouping(l,e),this.invalid=!_.isEmpty(t.FilterUtils.validate(this.contract,e,r)),this.disabled=t.FilterUtils.shouldDisableFilter(this.contract,e,l,r,i)},a.prototype.switchType=function(e){this.readOnlyState.type=e},a.prototype.canVisualize=function(){var e=this.contract;return e.expression&&e.type!==r.Passthrough&&!this.isMeasure},a.prototype.updateViewStateCore=function(t){var i=this.contract,o=!this.invalid;if(t.disabled=this.disabled,t.expanded=i.expanded&&o,t.invalid=!o,_.any(this.availableTypes,(function(e){return e.type===r.Categorical}))&&!t.visual&&i.config){var n=i.config.singleVisual;n&&this.visualHostServices&&this.visualPlugin&&(t.visual={viewport:a.DefaultVisualViewPort,type:e.visuals.plugins.slicer.name,dataTransforms:{objects:n.objects},hostServices:this.visualHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin})}t.canToggleSingleSelect=5!==this.howCreated&&!!(!t.disabled&&this.isPodEnabled()&&t.expanded&&t.visual&&t.visual.data)},a.prototype.updateAvailableTypes=function(){var t=this.readOnlyState.type;if(t===r.Passthrough)return void(this.availableTypes=[]);var i=[];this.valueType&&!this.valueType.bool&&i.push({type:r.Advanced,label:e.common.localize.get("FilterPane_Advanced")}),this.isMeasure||(i.push({type:r.Categorical,label:e.common.localize.get("FilterPane_Basic")}),this.valueType&&this.valueType.dateTime&&i.push({type:r.RelativeDate,label:e.common.localize.get("FilterPane_RelativeDate")}),this.isVisualFilter&&i.push({type:r.TopN,label:e.common.localize.get("FilterPane_TopN")})),this.availableTypes=i,this.cardType=_.find(i,(function(e){return e.type===t}))},a.prototype.isPodEnabled=function(){return this.containerScope&&1===this.containerScope.scopeType&&t.FilterUtils.isCategoricalFilter(this.readOnlyState.type)},a.DefaultVisualViewPort={width:146,height:180,scale:1},a.counter=0,a})(i.ViewModel);i.FilterViewModel=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.contracts.FilterType,a=e.data.SQExprConverter;!(function(r){function s(e,t,r,o,a,s,l,c,u){var g;switch(e.type){case n.TopN:g=h(e,c,o,t,r,u);break;case n.Advanced:case n.Categorical:g=d(e,c,o,t,r,u);break;case n.RelativeDate:g=v(e,c,o,t,r,u);break;case n.Passthrough:g=p(e,c,o,t,r);break;case n.Include:case n.Exclude:g=new i.FilterViewModel(e,o);break;default:g=h(e,c,o,t,r,u)||v(e,c,o,t,r,u)||d(e,c,o,t,r,u)||p(e,c,o,t,r)}return g.howCreated=e.howCreated,g.updateFilterProperties(t,a,s),g}function l(e){var t;if(e.filter){var r=e.filter.conditions(),o=r[0];o&&(t=i.FilterCardConverter.createAdvFilter(o,null,e.expression))}return!t&&e.expression&&(t=new i.AdvFilterCard(e.expression)),t}function c(e,t,i,r,n,s,l){var c=a.asFieldPattern(e),u={includeVariationSource:!0};return i.getDisplayName(e,t,r,n,0===l?s:void 0,u)||(c?o.getFieldExprName(c):void 0)}function u(e,t,i,r){return i.getQualifiedDisplayName(e,t,r)}function p(e,t,r,o,a){null==e.type&&(e.type=n.Passthrough);var s=new i.FilterViewModel(e,r),l=e.restatement;if((!l||""===l)&&e.filter){var c={includeFieldNamesInFilter:!0};l=a.getFilterRestatement(e.filter.where()[0],o,t,c),s.tooltip=a.getQualifiedFilterRestatement(e.filter.where()[0],o,t,c)}return s.setRestatement(l),s}function d(e,r,o,a,s,p,d){var h=l(e);if(h){e.expression||(e.expression=h.field),null==e.type&&(e.type=t.FilterUtils.getDefaultFilterType(e.expression,a,e.howCreated)),null==e.type&&(e.type=n.Categorical);var v,g,f=e.expression,m=new i.FilterViewModel(e,o);return p&&(v=p.query&&p.query.defn.selectNameOf(f),g=p.columnProperties),m.displayName=c(f,a,s,r,v,g,o.scopeType),m.tooltip=u(f,a,s,r),m}}function h(t,i,r,o,a,s){var l=e.data.TopNFilterPattern.extractParametersFromFilter(t.filter);return l&&g(t,n.TopN,l.fieldBeingFiltered),f(t,n.TopN,r,o,a,i,s)}function v(t,i,r,o,a,s){var l=e.data.RelativeDateFilterPattern.extractParametersFromSemanticFilter(t.filter);return l&&g(t,n.RelativeDate,l.field),f(t,n.RelativeDate,r,o,a,i,s)}function g(e,t,i){e.type=t,e.expression=i}function f(e,t,r,o,n,a,s){if(e.type===t&&e.expression){var l=new i.FilterViewModel(e,r),p=s&&s.query?s.query.defn.selectNameOf(e.expression):void 0,d=s?s.columnProperties:void 0;return l.displayName=c(e.expression,o,n,a,p,d,r.scopeType),l.tooltip=u(e.expression,o,n,a),l}}r.convertFilterContainer=s,r.extractAdvFilterCard=l})(r=i.FilterViewModelFactory||(i.FilterViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this.kind=e,this.name=i.format(t,r)}return e})();e.ShowValueAsCalculation=t;var i=(function(e){function t(t){return e.call(this,void 0,"ShowValueAs_Calculation_None",t)||this}return __extends(t,e),t})(t);e.ShowValueAsNoCalculation=i;var r=(function(e){function t(t){return e.call(this,0,"ShowValueAs_Calculation_PercentOfGrandTotal",t)||this}return __extends(t,e),t})(t);e.ShowValueAsPercentOfGrandTotalCalculation=r;var o=(function(e){function t(t,i,r){var o=e.call(this,1,"ShowValueAs_Calculation_PercentOfRoleTotal",t,r)||this;return o.roles=i,o}return __extends(t,e),t})(t);e.ShowValueAsPercentOfRoleTotalCalculation=o})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.Custom=3]="Custom"})(t=e.EmbedSize||(e.EmbedSize={})),e.EmbedSizes={small:{height:510,width:680},medium:{height:600,width:800},large:{height:700,width:933}}})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.common.models.ApplyStyle,n=jsCommon.ArrayExtensions,a=e.visuals.plugins,s=e.data.SQExpr,l=jsCommon.StringExtensions,c=e.explore.util.VisualContainerUtils;!(function(r){function u(){return{exploration:null,options:null,taskPane:d(),visualizationPane:h(),sectionStatus:{currentSectionNumber:-1,isEditing:!1},isNavPaneCollapsed:!0,bookmarksPane:{isPaneVisible:!1},canvasItemsPane:{isPaneVisible:!1}}}function p(e){return{contract:e,selected:!1,displayName:e.displayName,menuItems:i.ExplorationContainerViewModelFactory.createNavigationMenuItems()}}function d(){return{isPaneExpanded:!0}}function h(){return{sections:[],activeSection:0,pagePaneSections:[],activePageSection:0,isPaneExpanded:!1}}function v(e){return{visuals:e}}function g(e){var t=_.filter(e,(function(e){return e.custom}));return y(t)}function f(t,i){var r=e.common.localize;switch(t){case a.table.name:return{class:"table",title:r.get("Table_ToolTip")};case a.matrix.name:return{class:"matrix",title:r.get("Matrix_ToolTip")};case a.pivotTable.name:return{class:"matrix",title:r.get("Matrix_ToolTip")};case a.tableEx.name:return{class:"table",title:r.get("Table_ToolTip")};case a.scatterChart.name:return{class:"scatterChart",title:r.get("ScatterChart_ToolTip")};case a.barChart.name:return{class:"barChart",title:r.get("BarChart_ToolTip")};case a.clusteredBarChart.name:return{class:"clusteredBarChart",title:r.get("ClusteredBarChart_ToolTip")};case a.hundredPercentStackedBarChart.name:return{class:"hundredPercentStackedBarChart",title:r.get("HundredPercentStackedBarChart_ToolTip")};case a.ribbonChart.name:return{class:"ribbonChart",title:r.get("RibbonChart_ToolTip")};case a.columnChart.name:return{class:"columnChart",title:r.get("ColumnChart_ToolTip")};case a.clusteredColumnChart.name:return{class:"clusteredColumnChart",title:r.get("ClusteredColumnChart_ToolTip")};case a.dataDotClusteredColumnComboChart.name:return{class:"dataDotClusteredColumnComboChart",title:r.get("DataDotClusteredColumnComboChart_ToolTip")};case a.dataDotStackedColumnComboChart.name:return{class:"dataDotStackedColumnComboChart",title:r.get("DataDotStackedColumnComboChart_ToolTip")};case a.hundredPercentStackedColumnChart.name:return{class:"hundredPercentStackedColumnChart",title:r.get("HundredPercentStackedColumnChart_ToolTip")};case a.realTimeLineChart.name:case a.lineChart.name:return{class:"lineChart",title:r.get("LineChart_ToolTip")};case a.areaChart.name:return{class:"areaChart",title:r.get("AreaChart_ToolTip")};case a.stackedAreaChart.name:return{class:"stackedAreaChart",title:r.get("StackedAreaChart_ToolTip")};case a.lineClusteredColumnComboChart.name:return{class:"lineClusteredColumnComboChart",title:r.get("LineClusteredColumnComboChart_ToolTip")};case a.lineStackedColumnComboChart.name:return{class:"lineStackedColumnComboChart",title:r.get("LineStackedColumnComboChart_ToolTip")};case a.pieChart.name:return{class:"pieChart",title:r.get("PieChart_ToolTip")};case a.treemap.name:return{class:"treemap",title:r.get("Treemap_ToolTip")};case a.sunburst.name:return{class:"sunburst",title:r.get("Sunburst_ToolTip")};case a.map.name:return{class:"map",title:r.get("Map_ToolTip")};case a.filledMap.name:return{class:"filledMap",title:r.get("FilledMap_ToolTip")};case a.shapeMap.name:return{class:"shapeMap",title:r.get("ShapeMap_ToolTip")};case a.funnel.name:return{class:"funnel",title:r.get("Funnel_ToolTip")};case a.gauge.name:return{class:"gauge",title:r.get("Gauge_ToolTip")};case a.multiRowCard.name:return{class:"multiRowCard",title:r.get("MultiRowCard_ToolTip")};case a.card.name:return{class:"card",title:r.get("Card_ToolTip")};case a.waterfallChart.name:return{class:"waterfallChart",title:r.get("WaterfallChart_ToolTip")};case a.slicer.name:return{class:"slicer",title:r.get("Slicer_ToolTip")};case a.donutChart.name:return{class:"donutChart",title:r.get("DonutChart_ToolTip")};case a.kpi.name:return{class:"kpi",title:r.get("kpi_Tooltip")};case a.scriptVisual.name:return{class:"scriptVisual",title:r.get("ScriptVisual_ToolTip")};case a.realTimeLineChart.name:return{class:"lineChart",title:r.get("LineChart_ToolTip")};case a.debugVisual.name:return{class:"debugVisual",title:r.get("DebugVisual_ToolTip")};case a.textbox.name:return{class:null,title:r.get("Textbox")};case a.basicShape.name:return{class:null,title:r.get("BasicShape_ToolTip")};default:if(i&&i.isTrustedVisual(t)){var o=i.getVisualTypeOptions(t);if(o)return{class:o.class,title:o.titleKey?r.get(o.titleKey):t,watermarkKey:o.watermarkKey}}return}}function m(e,t){var i=f(e.name,t);return i||{class:e.class,title:e.name}}function y(t,i){for(var r=[],o=e.common.localize,n=0,a=t;n<a.length;n++){var s=a[n],l={plugin:s,enabled:!0,active:!1,menuItems:[]},c=m(s,i);if(l.class=c.class,l.title=c.title,c.watermarkKey&&(s.watermarkKey=c.watermarkKey),s.custom){l.title=s.displayName||s.name.match(/([A-z]+)/g)[0];var u=w(o.get("DeleteVisual_ContextMenu"),0);l.menuItems.push(u)}r.push(l)}return r}function w(e,t){return{text:e,hasGlyph:!1,labelClass:"visualContextMenu itemLabel",action:t,type:DropDownMenuItemType.Item,checked:!1,hrefTarget:jsCommon.DOMConstants.selfValue}}function S(e,t,i){i.hostServices={deleteVisualRelationships:function(e,i){return i.deleteVisualRelationships(t,e)},getFilters:function(r,o){return r.calculateVisualContainerFilter(e,t,i.contract,o)},getVisualRelationshipFilterAction:function(e,r,o){return r.relationshipFilterAction(t,e,i.contract,o)},selectDataPoint:function(r,o){r.setFilterOnSelectData(e,o,t,i.contract)},setVisualRelationshipFilterAction:function(e,i,r,o){return o.setVisualRelationship(t,e,i,r)},clearHighlight:function(e){e.clearCrossHighlight(t)}}}function b(e,t,i){var r,o=_.map(e.sections,p),n=e.sections;if(n&&n.length>0){var a=void 0!==i?i:0;if(a<n.length){r=C(e,n[a],t);for(var s=n.length-1;s>=0;--s)o[s].selected=s===a}}return{contract:e,sections:o,exploreCanvas:r}}function C(e,t,r){var o=new i.ExploreCanvas(t,r);if(t.visualContainers&&(o.visualContainers=n.extendWithId(_(t.visualContainers).map((function(e){return x(e,r)})).filter((function(e){return!!e})).value()),!_.isEmpty(o.visualContainers)))for(var a=o.visualContainers,s=0,l=a;s<l.length;s++){var c=l[s];S(e,t,c)}return o}function x(e,t){void 0===t&&(t=0);var r=new o,n=e.layouts.withId(t);if(n){var a=n.position;return r.position({y:a.y,x:a.x}),r.zIndex(a.z||0),r.viewport({height:a.height,width:a.width}),new i.VisualContainer(e,r,t)}}function M(e,t,i,r){var o=x(i,r);if(o)return S(e,t,o),o}function D(t){return e.data.getDisplayName(t,e.common.localize)}function F(){return{schema:null,isLoaded:!1}}function E(e,t){return void 0===t&&(t=!0),{isVisualVisible:!1,reportFilters:t?[]:null,pageFilters:[],drillthroughFilters:[],visualFilters:[],activeFilterPane:void 0,addFilterLabel:e.get("FieldDropZone_Watermark"),addDrillthroughFilterLabel:e.get("FieldDropZone_Drillthrough_Watermark")}}function V(e,r,o,n,a,l,u,p){for(var d=e.filters||[],h=[],v={container:e,scopeType:0},g=t.util.VisualContainerUtils.getAutoVisualFilterContainers(e,a,l,r,u),f=function(t){var a=i.FilterViewModelFactory.convertFilterContainer(t,r,o,v,n,u,p,c.getVisualCapabilities(e,n),e.config.singleVisual);if(h.push(a),g){var l=_.findIndex(g,(function(e){return s.equals(e.expression,t.expression)}));l===-1?0===t.howCreated&&(a.howCreated=t.howCreated=1):(1===t.howCreated&&(a.howCreated=t.howCreated=0),g.splice(l,1))}},m=0,y=d;m<y.length;m++){var w=y[m];f(w)}if(g)for(var S=0,b=g;S<b.length;S++){var C=b[S],x=i.FilterViewModelFactory.convertFilterContainer(C,r,o,v,n,u,p,c.getVisualCapabilities(e,n),e.config.singleVisual);x.howCreated=C.howCreated,h.push(x)}return h.sort(L),h}function P(t,r,o,n,a,s,l){var c=[];if(!t||!t.container||!t.container.filters)return c;for(var u=0,p=t.container.filters;u<p.length;u++){var d=p[u];d.name||(d.name=e.explore.FilterUtils.getNextFilterName(t.container.filters));var h=i.FilterViewModelFactory.convertFilterContainer(d,r,o,t,n,a,s,l,null);c.push(h)}return c.sort(L),c}function T(r,o,n,a,s,l){var c={name:i.EmbedSizes.medium.width+" x "+i.EmbedSizes.medium.height+" px",value:i.EmbedSize.Medium},u=r.get("Embed_CopyEmbedCode"),d=r.get("Embed_DeleteReportSnapshot"),h=[{name:r.get("Embed_EmbedType_Interactive"),value:t.contracts.EmbedType.Interactive},{name:r.get("Embed_EmbedType_Static"),value:t.contracts.EmbedType.Static}],v={currentEmbed:a,exploration:n,embedTab:{embed:I(a),sections:_.map(l,p),selectedSection:null,selectedEmbedSize:c,sizes:[{name:i.EmbedSizes.small.width+" x "+i.EmbedSizes.small.height+" px",value:i.EmbedSize.Small},c,{name:i.EmbedSizes.large.width+" x "+i.EmbedSizes.large.height+" px",value:i.EmbedSize.Large}],embedTypes:h,selectedEmbedType:h[0],edit:!1,generating:!1,disabled:!1,nameError:"",sizeError:"",error:{exist:!1,showDetails:!1}},embeddedInTab:{embeds:[],loaded:!1,localizedCopyEmbedCodeTitle:u,localizedDeleteReportSnapshotTitle:d},viewModeState:0,publishState:0},g=r.get("Embed_EntireReport");return v.embedTab.sections.push({displayName:g,contract:{id:-1,displayName:g,name:g,size:{displayOption:0,width:e.explore.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:e.explore.constants.ExploreCanvasConstants.DefaultCanvasHeight},visualContainers:[]},selected:!1}),s.then((function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];v.embeddedInTab.embeds.push(I(n))}if(v.embeddedInTab.loaded=!0,e.length>0){var a=e[0];a.size.height=i.EmbedSizes.medium.height,a.size.width=i.EmbedSizes.medium.width,v.currentEmbed=a;var s=I(a);s.embedCode=o.createEmbedCode(a),s.link=o.createEmbedUri(a),v.embedTab.embed=s,v.publishState=4}else v.publishState=1})),v}function A(e,t){var r={name:i.EmbedSizes.medium.width+" x "+i.EmbedSizes.medium.height+" px",value:i.EmbedSize.Medium},o={currentEmbed:t,exploration:e,embedTab:{embed:I(t),sections:null,selectedSection:null,selectedEmbedSize:r,sizes:void 0,embedTypes:null,selectedEmbedType:null,edit:!1,generating:!1,disabled:!1,nameError:"",sizeError:"",error:{exist:!1,showDetails:!1}},embeddedInTab:void 0,viewModeState:0,publishState:5};return o}function I(e){return{contract:e,showCode:!1,deleteRequest:!1,deleteConfirm:!1,refreshingData:!1,embedCode:"",enableShareLink:!0,error:{exist:!1,showDetails:!1}}}function k(e){var t=_.map(e,(function(e){return l.replaceAll(e,R,O)}));return t.join(R)}function L(e,t){var i=e.displayName?-1:1,r=t.displayName?-1:1;if(i!==r)return i-r;var o=e.displayName||e.getRestatement()||"",n=t.displayName||t.getRestatement()||"";return o.localeCompare(n)}var R="-",O="\\"+R;r.createExplorationContainer=u,r.convertSectionToViewModel=p,r.createTaskPane=d,r.createVisualizationPane=h,r.createVisualTypesContainer=v,r.getCustomVisualTypes=g,r.getVisualTypeInfoByName=f,r.getVisualTypeInfo=m,r.getAvailableVisualTypes=y,r.convertExploration=b,r.convertSectionToExploreCanvas=C,r.convertVisualContainerStandalone=x,r.convertVisualContainer=M,r.getDisplayName=D,r.createFieldList=F,r.createFilterPane=E,r.createVisualFilters=V,r.createFilters=P,r.createEmbedModalDialog=T,r.createSharepointEmbedModalDialog=A,r.createEmbed=I,r.createUniqueId=k})(r=i.ViewModelFactory||(i.ViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){e&&(this.color=e.color,this.visible=e.show)}return Object.defineProperty(t.prototype,"thickness",{get:function(){return t.Width},enumerable:!0,configurable:!0}),t.prototype.getBorderStyle=function(){if(this.visible)return t.Width+"px "+t.Style+" "+e.common.utils.ColorUtility.hexToRGBString(this.color)},t})();t.VisualBorder=i,(function(e){function t(){return{color:e.DefaultColor,show:e.DefaultShow}}e.Width=1,e.Style="solid",e.DefaultColor="#000",e.DefaultShow=!1,e.getDefaultValues=t})(i=t.VisualBorder||(t.VisualBorder={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.CssConstants,o=t.util.DetailVisualUtils,n=(jsCommon.DOMConstants,jsCommon.KeyUtils),a=e.explore.util.VisualContainerUtils,s=(function(s){function l(e,t,i){var r=s.call(this,e,{style:t,titleStyle:null,visualViewportStyle:null,popOutBarTitle:"",popOutBarSubtitle:""})||this;return r.uiScale={x:1,y:1},r.availableVisuals=[],r.toolbarViewModel={visible:!1,$element:null,update:_.noop},r.currentCanvasLayout=i,r.currentEditMode=0,r}return __extends(l,s),l.getVisualBodyOffset=function(e){return e.canShowVisualContainerHeaderInset()?{top:0,height:0,width:0,left:0}:{top:this.VisualContainerHeaderHeight,height:-this.VisualContainerHeaderHeight,width:0,left:0}},Object.defineProperty(l.prototype,"id",{get:function(){return this.contract.id},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"position",{get:function(){var e=this.currentCanvasLayout;return this.contract.layouts.withId(e).position},set:function(e){var t=this.currentCanvasLayout,i=this.contract.layouts.withId(t);i.position=e},enumerable:!0,configurable:!0}),l.prototype.getScaledPosition=function(){return this.convertToScaledPosition(this.position)},Object.defineProperty(l.prototype,"editMode",{get:function(){return this.currentEditMode},enumerable:!0,configurable:!0}),l.prototype.setEditMode=function(t){this.currentEditMode=t;var i=this.readOnlyState.visual;this.updateVisual(i,i.viewport,e.VisualUpdateType.ViewMode)},Object.defineProperty(l.prototype,"isPositioned",{get:function(){var e=this.position;return 0!==e.width&&0!==e.height},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isPoppedOut",{get:function(){var e=this.contract.visibility;return null!=e&&0!==e&&4!==e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isHidden",{get:function(){return t.contracts.VisualContainer.isHidden(this.contract.config.singleVisual)},enumerable:!0,configurable:!0}),l.prototype.visualTitleVisible=function(){var e=this.contract.config.singleVisual,i=e.title,r=i&&i.text,o=this.visualPlugin&&this.visualPlugin.capabilities(e.visualType);return!t.contracts.VisualTitle.isHidden(i)&&o&&(!o.suppressDefaultTitle||o.suppressDefaultTitle&&r)&&""!==r&&!this.isPoppedOut&&this.viewModeState&&!this.viewModeState.getConfig().displayOptions.hideVisualBodyTitle},l.prototype.setServices=function(e,t,i,r,o,n,a){this.visualHostServices=e,this.visualAdapterHostServices=a,this.visualPlugin=t,this.visualPluginOps=i,this.viewModeState=r,this.formFactor=o,this.visibility=n},l.prototype.setSelected=function(e){this.isSelected=e},l.prototype.handleKeyDown=function(t){var i=this.contract.config.singleVisual.visualType;if(122===t.keyCode&&t.altKey&&t.shiftKey)return void this.visibility.set(this.contract,8);if(i===e.visuals.plugins.textbox.name&&0!==this.viewModeState.getMode()&&!n.isArrowKey(t.keyCode)&&!n.isNudgeModifierKey(t.keyCode)&&27!==t.keyCode&&9!==t.keyCode){var r=this.readOnlyState.visual.visual,o=r.unwrap?r.unwrap():r;return o.focus()}},l.prototype.setVisualTitle=function(e){this.visualTitle=e;var t="",i="";e&&(e.titleComponents&&e.titleComponents.title?t=e.titleComponents.title:e.text&&(t=e.text),e.titleComponents&&e.titleComponents.subtitle&&(i=e.titleComponents.subtitle)),this.readOnlyState.popOutBarTitle=t,this.readOnlyState.popOutBarSubtitle=i},l.prototype.setTooltip=function(){var e=a.getVisualType(this.contract),t=this.visualPlugin&&this.visualPlugin.getPlugin(e);if(t){var r=i.ViewModelFactory.getVisualTypeInfo(t);e=r.title}var o=this.visualTitle,n=o&&o.text||"",s=this.contract.config.singleVisual.altText||"";this.tooltip=n+" "+e+" "+s},l.prototype.updateVisualViewportForUserResize=function(t){var i=this.readOnlyState.visual;this.enableVisualScaling?(t.width/=this.uiScale.x,this.visualBorder&&(t.width-=2*this.visualBorder.thickness),t.height-=l.VisualContainerHeaderHeight,t.height/=this.uiScale.y,this.visualBorder&&(t.height-=2*this.visualBorder.thickness)):t.height-=l.VisualContainerHeaderHeight;var r=this.getVisualViewport(t.width,t.height,1);i&&this.updateVisual(i,r,e.VisualUpdateType.Resize,1),this.hasDetailVisual()&&this.updateVisual(this.readOnlyState.detailVisual.visual,r,e.VisualUpdateType.Resize,1),this.applyVisualBodyStyle(this.readOnlyState,t)},l.prototype.shouldUseCache=function(){return this.contract.id&&!this.options.disableQueryCacheUpdates},l.prototype.adjustForVisualContainerHeader=function(e,t){this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(e.y+=t,e.height-=t)},l.prototype.convertToScaledPosition=function(e){var i=t.util.CanvasVisualsUtility.convertToScaledPosition(e,this.uiScale,!0);return this.adjustForVisualContainerHeader(i,-l.VisualContainerHeaderHeight),i},l.prototype.reset=function(){this.readOnlyState.visual&&(this.readOnlyState.visual.data=void 0,this.readOnlyState.visual.dataTransforms=void 0)},l.prototype.updateViewStateCore=function(t){var r=this.contract,n=this.position,a=this.overridePosition||this.convertToScaledPosition(n),s=e.Prototype.inherit(a);if(this.enableVisualScaling?this.overridePosition?(s.height-=l.VisualContainerHeaderHeight,s.height/=this.uiScale.y,s.width/=this.uiScale.x):(s=e.Prototype.inherit(n),this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()&&(s.height-=l.VisualContainerHeaderHeight/this.uiScale.y)):s.height-=l.VisualContainerHeaderHeight,this.visualBorder&&(s.width-=2*this.visualBorder.thickness,s.height-=2*this.visualBorder.thickness),this.isPoppedOut&&(!this.options||!this.options.hideHeader)){var c=i.VisualContainer.PopOutBarHeight;this.enableVisualScaling&&(c/=this.uiScale.y),s.height-=c}var u=this.getVisualViewport(s.width,s.height,this.uiScale.x),p=r.config.singleVisual;if(p){this.showWatermark=!1;var d=p.visualType;if(this.readOnlyState&&this.readOnlyState.visual&&this.visualPluginOps&&(this.readOnlyState.visual.visualRequiresData=this.visualPluginOps.isQueryVisual(d)),p.query){var h=p.query.defn;if(h){var v=h.orderBy();t.actualSortDirection=v&&v.length?v[0].direction:void 0}}else this.visualPluginOps&&this.visualPluginOps.isQueryVisual(d)&&"debugVisual"!==d&&(this.showWatermark=!0);t.visual?(t.visual.type!==p.visualType&&(t.visual.data=null),t.visual.type=d,t.visual.stylePresetName=p.stylePresetName):this.visualHostServices&&(t.visual={viewport:u,type:d,dataTransforms:{objects:p.objects},hostServices:this.visualHostServices,visualAdapterHostServices:this.visualAdapterHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0,isVisualInteractive:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin,themeName:this.themeName,baseThemeName:this.baseThemeName}),this.hasDetailVisual()?t.detailVisual||(t.detailVisual={parentContract:this.contract,
visual:{viewport:o.getDetailVisualViewport(u,this.contract.detailVisualLayout),themeName:this.themeName,baseThemeName:this.baseThemeName,allowInvalidDataView:!0,hostServices:null},hasData:!1}):t.detailVisual=null,this.setViewport(t,u)}t.style.position({x:a.x,y:a.y}),t.style.viewport({width:a.width,height:a.height}),null==this.zIndexOverride?t.style.zIndex(n.z||0):t.style.zIndex(this.zIndexOverride),t.style.rotate(n.angle||0),t.style.apply(),this.applyTitleStyle(t),this.applyVisualBodyStyle(t,s),this.setTooltip(),this.toolbarViewModel.update(),this.availableVisuals=this.visualPlugin?this.visualPlugin.getVisuals():[]},l.prototype.getAdjustedVisualScale=function(){var e=this.getScaledPosition(),t=this.position.width;return e.width/t},l.prototype.applyVisualBodyStyle=function(t,i){var r=this.getAdjustedVisualScale();t.visualViewportStyle||(t.visualViewportStyle=new e.common.models.ApplyStyle);var o=a.getVisualStyleAttributes(i,this.enableVisualScaling?r:void 0,this.visualBackground&&this.visualBackground.colorRGB,this.visualBorder&&this.visualBorder.getBorderStyle());t.visualViewportStyle.addAttributes(o),t.visualViewportStyle.apply()},l.prototype.applyTitleStyle=function(t){var i={};if(this.visualTitleVisible()){i[r.visibilityProperty]=r.visibleValue;var o=this.contract.config.singleVisual.title;if(o){i[r.textAlignProperty]=o.alignment?o.alignment:"",i[r.backgroundColorProperty]=o.background?o.background:"",i[r.colorProperty]=o.fontColor?o.fontColor:"";var n=a.getTitleFontSize(o);i[r.fontSizeProperty]=n,i[r.fontFamilyProperty]=o.fontFamily||"",i[r.heightProperty]=a.getTitleHeight(o)}}else i[r.visibilityProperty]=r.hiddenValue;t.titleStyle||(t.titleStyle=new e.common.models.ApplyStyle),t.titleStyle.addAttributes(i),t.titleStyle.apply()},l.prototype.setViewport=function(e,t){e.visual&&this.setVisualViewport(e.visual,t),this.hasDetailVisual()&&this.setVisualViewport(e.detailVisual.visual,o.getDetailVisualViewport(t,this.contract.detailVisualLayout))},l.prototype.setVisualViewport=function(e,t){e&&t&&(e.viewport.height===t.height&&e.viewport.width===t.width&&e.viewport.scale===this.uiScale.x||(e.viewport=t,e.viewport.scale=this.enableVisualScaling?this.uiScale.x:1))},l.prototype.getVisualViewport=function(e,t,r){var o=this.isPaddingDisabled?0:i.VisualContainer.VisualContainerPaddingRight+i.VisualContainer.VisualContainerPaddingLeft,n=this.isPaddingDisabled?0:i.VisualContainer.VisualContainerPaddingTop+i.VisualContainer.VisualContainerPaddingBottom,s=0;this.visualTitleVisible()&&(s=a.getTitleHeight(this.contract.config.singleVisual.title));var l=e-o,c=t-n-s;if(this.hasDetailVisual()){var u=this.contract.detailVisualLayout||1;1===u?(c-=n,c/=2):(l-=o,l/=2)}return{width:Math.max(l,0),height:Math.max(c,0),scale:r}},l.prototype.updateVisual=function(e,t,i,r){if(e&&t){var o=e.visual;o&&o.update({viewport:t,suppressAnimations:!0,dataViews:e.dataViews,type:i,resizeMode:r,viewMode:this.visualHostServices.getViewMode(),editMode:this.editMode})}},l.prototype.hasDetailVisual=function(){return 2===this.contract.visibility||8===this.contract.visibility},l.VisualContainerHeaderHeight=20,l.VisualContainerPaddingTop=5,l.VisualContainerPaddingRight=5,l.VisualContainerPaddingBottom=5,l.VisualContainerPaddingLeft=5,l.PopOutBarHeight=40,l})(i.ViewModel);i.VisualContainer=s})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s){return new a(t,i,r,o,n,s)}function o(e,t,i){var r=_.find(t.visualContainers,(function(e){return e.contract===i}));if(r)return _.pull(t.visualContainers,r),_.remove(i.layouts,(function(t){return t.id===e})).length>0}var n=e.telemetry;i.createLayoutAuthoring=r;var a=(function(){function e(e,t,i,r,o,n){this.telemetryService=e,this.eventBridge=t,this.undoRedoService=i,this.explorationNavigation=r,this.formfactorProvider=o,this.selectionService=n}return e.prototype.addLayoutToVisualContainer=function(e,r,o){var n=this;this.undoRedoService.register("AddLayoutToVisualContainer",(function(){var a=n.formfactorProvider.getCurrentLayout();r.layouts.push({id:a,position:o});var s=t.viewModels.ViewModelFactory.convertVisualContainer(n.explorationNavigation.getCurrentExploration(),e.contract,r,a);e.visualContainers.push(s),n.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.removeLayoutFromSelectedVisuals=function(e){var t=this;this.undoRedoService.register("RemoveLayoutFromSelectedVisuals",(function(){for(var r=_.map(t.selectionService.getSelectedElements(),(function(e){return e.visualContainer})),n=t.formfactorProvider.getCurrentLayout(),a=0,s=r;a<s.length;a++){var l=s[a];o(n,e,l)}t.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.removeLayoutFromVisualContainer=function(e,t){var r=this;this.undoRedoService.register("RemoveLayoutFromVisualContainer",(function(){var n=r.formfactorProvider.getCurrentLayout();o(n,e,t),r.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.removeLayoutFromSection=function(e,t,r){var o=this,a=0,s=e.visualContainers;this.undoRedoService.register("RemoveLayoutsFromVisualContainers",(function(){for(var e=0,r=s;e<r.length;e++){var n=r[e];_.remove(n.layouts,(function(e){return e.id===t})).length>0&&a++}o.eventBridge.publishToChannel(i.events.sectionLayoutRemoved)})),1===t&&this.telemetryService.logEvent(n.EXRemoveMobileCanvasVisuals,r.reportId,a)},e.prototype.updateSectionPenAnnotations=function(e,t){e.penAnnotations=t},e.prototype.updateExplorationActiveSectionIndex=function(e){var i=e.exploration,r=t.SectionUtils.findSectionIndexForSectionName(i,e.section);if(!(r&&i&&i.sections&&i.sections[r].transient)){i.activeSectionIndex=r;var o=i.sections[r],a=o?o.objectId:void 0;this.telemetryService.logEvent(n.ExploreHostChangeReportPage,i.reportId,e.reportGUID,r,a,e.groupObjectId,e.isReadonlyGroup,e.reportPermissions,e.scrubUserInfo)}},e.prototype.moveVisualContainer=function(e,t){e.position=t,e.updateViewState();var r=e.contract;this.eventBridge.publishToChannel(i.events.visualContainerPositionChanged,{affectContainer:function(e){return e===r}})},e.prototype.moveVisualContainersHelper=function(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i],n=o.position;t(n),this.moveVisualContainer(o,n)}},e.prototype.alignSelectedVisuals=function(e,t,i){1===i.length?this.alignSingleVisualContainer(e,t,i[0]):this.alignMultipleVisualContainers(e,t,i)},e.prototype.alignMultipleVisualContainers=function(t,i,r){var o=this;this.undoRedoService.register("AlignMultipleVisualContainers",(function(){var n=_.map(r,(function(e){return e.position}));switch(t){case 3:var a=_.min(_.map(n,(function(e){return e.y})));o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(a,t.height,i)}));break;case 4:var s=_.sum(n,(function(e){return e.y+e.height/2})),l=s/n.length;o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(l-t.height/2,t.height,i)}));break;case 5:var c=_.max(_.map(n,(function(e){return e.y+e.height})));o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(c-t.height,t.height,i)}));break;case 0:var u=_.min(_.map(n,(function(e){return e.x})));o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(u,t.width,i)}));break;case 1:var p=_.sum(n,(function(e){return e.x+e.width/2})),d=p/n.length;o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(d-t.width/2,t.width,i)}));break;case 2:var h=_.max(_.map(n,(function(e){return e.x+e.width})));o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(h-t.width,t.width,i)}));break;case 6:o.distributeSpace(r,n,!0,i);break;case 7:o.distributeSpace(r,n,!1,i)}}))},e.prototype.alignSingleVisualContainer=function(e,t,i){var r=this;this.undoRedoService.register("AlignSingleVisualContainer",(function(){var o=i.position;switch(e){case 3:r.moveVisualContainersHelper([i],(function(e){return e.y=0}));break;case 4:case 7:var n=t.height/2-o.height/2;r.moveVisualContainersHelper([i],(function(e){return e.y=n}));break;case 5:var a=t.height-o.height;r.moveVisualContainersHelper([i],(function(e){return e.y=a}));break;case 0:r.moveVisualContainersHelper([i],(function(e){return e.x=0}));break;case 1:case 6:var s=t.width/2-o.width/2;r.moveVisualContainersHelper([i],(function(e){return e.x=s}));break;case 2:var l=t.width-o.width;r.moveVisualContainersHelper([i],(function(e){return e.x=l}))}}))},e.prototype.distributeSpace=function(t,i,r,o){for(var n=r?"x":"y",a=r?"width":"height",s=r?e.clampXValue:e.clampYValue,l=_.min(_.map(i,(function(e){return e[n]}))),c=_.max(_.map(i,(function(e){return e[n]+e[a]}))),u=_.reduce(i,(function(e,t){return e-t[a]}),c-l),p=u/(t.length-1),d=_.sortBy(t,(function(e){return e.position[n]})),h=l,v=0,g=d;v<g.length;v++){var f=g[v],m=f.position;m[n]=s(h,m[a],o),h+=m[a]+p,this.moveVisualContainer(f,m)}},e.clampXValue=function(e,t,i){return e<0?0:t+e>i.width?i.width-t:e},e.clampYValue=function(e,t,i){return e<0?0:t+e>i.height?i.height-t:e},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s,l,c,u,p,d,h,v,g,f,m,y,w,S,b,C){return new a(i,o,n,e,t,s,l,c,u,p,d,h,r,v,g,f,m,y,w,S,b,C)}var o=e.data.DataViewObjectDefinitions,n=e.visuals.plugins.textbox;i.createVisualAuthoring=r;var a=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y,w,S,b,C){this.schemaProxy=e,this.telemetry=i,this.explorationNavigationService=r,this.visualPluginService=o,this.visualPluginOps=n,this.selectionService=a,this.geotaggingAnalyzerService=s,this.explorationSerializer=l,this.eventBridge=c,this.promiseFactory=u,this.undoRedoService=p,this.featureSwitchService=d,this.displayNameService=h,this.sortService=v,this.visualRelationshipService=g,this.drill=f,this.filterGenerator=m,this.aggrOps=y,this.visualHostTooltip=w,this.resourceRegistration=S,this.formFactorProvider=b,this.localizationService=C,this.visualAuthoringOperations=t.util.createVisualAuthoringOperations(this.visualPluginService,this.visualPluginOps,this.displayNameService,this.telemetry,this.explorationNavigationService,this.selectionService,this.geotaggingAnalyzerService,this.explorationSerializer,this.eventBridge,this.featureSwitchService,this.sortService,this.visualRelationshipService,this.drill,this.filterGenerator,this.aggrOps,this.resourceRegistration,this.formFactorProvider,this.localizationService)}return r.prototype.addFieldToVisual=function(e,t,i,r){var o=this;return this.registerUndoableAction(t,(function(t){return o.visualAuthoringOperations.addFieldToVisual(t,e,i,r)}),"AddFieldToVisual")},r.prototype.addFieldInRole=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(i,(function(i){return n.visualAuthoringOperations.addFieldInRole(i,e,t,r,o)}),"AddFieldInRole")},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(e,(function(e){return n.visualAuthoringOperations.expandHierarchy(e,t,i,r,o)}),"ExpandHierarchy")},r.prototype.removeField=function(e,t){var i=this;return this.registerUndoableAction(e,(function(e){return i.visualAuthoringOperations.removeField(t,e)}),"RemoveField")},r.prototype.removeProjection=function(e){var t=this;return this.undoRedoService.register("RemoveProjection",(function(){return t.visualAuthoringOperations.removeProjection(e)}))},r.prototype.removeInvalidExpressions=function(e,t){var i=this;return this.registerUndoableAction(t,(function(t){return i.visualAuthoringOperations.removeInvalidExpressions(t,e)}),"RemoveInvalidExpressions")},r.prototype.moveProjection=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(n,(function(n){return a.visualAuthoringOperations.moveProjection(n,e,t,i,r,o)}),"MoveProjection")},r.prototype.drillDownLevel=function(e,t,i){var r=this;this.undoRedoService.register("DrillDownLevel",(function(){return r.visualAuthoringOperations.drillDownLevel(e,t,i)}))},r.prototype.replaceProjection=function(e,i,r,o,n){var a=this;return this.undoRedoService.register("ReplaceProjection",(function(){return a.schemaProxy.get(n).then((function(n){var s=a.filterGenerator.supportsFilterOutput(o),l=a.visualAuthoringOperations.replaceProjection(n,e,i,r,o);return l&&s&&t.util.VisualContainerUtils.notifyVisualContainersExceptSource(a.eventBridge,o),l}))}))},r.prototype.drillDown=function(e,t,i,r){var o=this;return this.registerUndoableAction(i,(function(i){return o.visualAuthoringOperations.drillDown(i,e,t,r)}),"DrillDown")},r.prototype.drillUp=function(e,t){var i=this;this.undoRedoService.register("DrillUp",(function(){return i.visualAuthoringOperations.drillUp(e,t)}))},r.prototype.setAggregate=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(o,(function(o){return n.visualAuthoringOperations.setAggregate(o,e,t,i,r)}),"SetAggregate")},r.prototype.removeAggregate=function(e,t,i,r){var o=this;return this.registerUndoableAction(r,(function(r){return o.visualAuthoringOperations.removeAggregate(r,e,t,i)}),"RemoveAggregate")},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.setPercentOfGrandTotal(r,e,t,i)}))},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.removePercentOfGrandTotal(r,e,t,i)}))},r.prototype.setPercentOfRoleTotal=function(e,t,i,r,o){var n=this;return this.getSchemaAndExecuteAction(o,(function(o){return n.visualAuthoringOperations.setPercentOfRoleTotal(o,e,t,i,r)}))},r.prototype.removePercentOfRoleTotal=function(e,t,i,r){var o=this;return this.getSchemaAndExecuteAction(r,(function(r){return o.visualAuthoringOperations.removePercentOfRoleTotal(r,e,t,i)}))},r.prototype.toggleShowAll=function(e,t){this.visualAuthoringOperations.toggleShowAll(e,t)},r.prototype.setVariation=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(e,(function(e){return a.visualAuthoringOperations.setVariation(e,t,i,r,o,n)}),"SetVariation")},r.prototype.createVisualContainerConfig=function(e){var t=this;return this.schemaProxy.get(e.dataSources).then((function(i){return t.visualAuthoringOperations.createVisualContainerConfig(i,e)}))},r.prototype.addVisualContainerImage=function(e,t,i,r,o,n){var a=this;this.undoRedoService.register("AddVisualContainerImage",(function(){return a.visualAuthoringOperations.addVisualContainerImageFromData({exploreCanvas:e,position:n},t,o)}))},r.prototype.addVisualContainerDrillthroughBackButton=function(i){this.visualAuthoringOperations.addVisualContainerBasicShape({exploreCanvas:i,position:{x:0,y:0,width:100,height:40},visualLink:{show:!0,type:t.contracts.VisualLink.Back},select:!1},e.visuals.basicShapeType.arrowButton)},r.prototype.addVisualContainerBasicShape=function(e,t,i){var r=this;this.undoRedoService.register("AddVisualContainerBasicShape",(function(){return r.visualAuthoringOperations.addVisualContainerBasicShape({exploreCanvas:e,position:i},t)}))},r.prototype.addVisualContainerTextbox=function(e,t){return this.addEmptyVisualContainer(e,n.name,t)},r.prototype.addVisualContainer=function(e,t,i){var r=this;return this.undoRedoService.register("AddVisualContainer",(function(){return r.schemaProxy.get(e.dataSources).then((function(o){return r.visualAuthoringOperations.addVisualContainer(o,e,t,i)}))}))},r.prototype.addVisualContainerFromConfig=function(e,t,i){var r=this;return this.undoRedoService.register("AddVisualContainerFromConfig",(function(){return r.visualAuthoringOperations.addVisualContainerFromConfig(e,t,i)}))},r.prototype.addEmptyVisualContainer=function(e,t,i){var r=this;return this.undoRedoService.register("AddEmptyVisualContainer",(function(){return r.visualAuthoringOperations.addEmptyVisualContainer(e,t,i)}))},r.prototype.copyVisual=function(e,t,i){var r=this.explorationSerializer.deserializeVisualContainer(e);r.id=100;var o=this.formFactorProvider.getCurrentLayout(),n=r.layouts.withId(o),a=n.position;return n.position={height:a.height,width:a.width,x:Math.max(0,t?t-a.width/2:0),y:Math.max(0,i?i-a.height/2:0),z:a.z},r},r.prototype.addConfigToCategoricalFilters=function(e,t,i){var r=_.filter(e,(function(e){return!e.isInvalid()&&e.canVisualize()}));if(r)for(var o=0,n=r;o<n.length;o++){var a=n[o];this.createFilterVisualContainerConfig(a.contract,i,t)}},r.prototype.createVisualFilters=function(e,t,i){return this.visualAuthoringOperations.createVisualFilters(e,t,i)},r.prototype.addFilter=function(e,t,i){var r=this;return this.registerUndoableAction(i,(function(o){return r.visualAuthoringOperations.addFilter(o,e,t,i,!1)}),"AddFilter")},r.prototype.addDrillthroughFilter=function(e,t,i){var r=this;return this.registerUndoableAction(i,(function(o){return r.visualAuthoringOperations.addFilter(o,e,t,i,!0)}),"AddDrillthroughFilter")},r.prototype.removeFilter=function(e,t){var i=this;return this.undoRedoService.register("RemoveFilter",(function(){return i.visualAuthoringOperations.removeFilter(e,t)}))},r.prototype.clearFilter=function(e,t){var i=this;return this.undoRedoService.register("ClearFilter",(function(){return i.updateFilter(e,t,void 0)}))},r.prototype.updateFilter=function(e,t,i){t.filter=i;var r=t.config&&t.config.singleVisual;if(r){var n=this.visualPluginService.capabilities(r.visualType),a=this.filterGenerator.tryGetFilterPropertyIdentifier(n);a&&(r.objects||(r.objects={}),null==i?o.deleteProperty(r.objects,a.objectName,null,a.propertyName):o.setValue(r.objects,a,null,i))}null==e.filters&&(e.filters=[]),_.indexOf(e.filters,t)===-1&&e.filters.push(t)},r.prototype.createFilterVisualContainerConfig=function(e,t,i){return this.visualAuthoringOperations.createFilterVisualContainerConfig(e,t,i)},r.prototype.raiseVisualContainerChanged=function(e){this.visualAuthoringOperations.raiseVisualContainerChanged(e)},r.prototype.convert=function(e,t,i){var r=this;return this.schemaProxy.get(t).then((function(t){return r.visualAuthoringOperations.convert(t,e,i)?r.promiseFactory.resolve():r.promiseFactory.reject()}))},r.prototype.setOrderBy=function(e,t){e.config.singleVisual.query.orderBy(t),this.raiseVisualContainerChanged(e)},r.prototype.removeOrderBy=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];e.config.singleVisual.query.removeOrderBy(o)}this.raiseVisualContainerChanged(e)},r.prototype.addColorScales=function(e,t,i){var r=this;this.undoRedoService.register("Set Color Scales",(function(){return r.visualAuthoringOperations.addProperty(e,t.propertyId,t.selector,i),r.raiseVisualContainerChanged(e),!0}))},r.prototype.removeColorScales=function(e,t){var i=this;this.undoRedoService.register("Removing Color Scales",(function(){return i.visualAuthoringOperations.removeProperty(e,t.propertyId,t.selector),i.raiseVisualContainerChanged(e),!0}))},r.prototype.addDataBars=function(e,t,i){var r=this;this.undoRedoService.register("Set Data Bars",(function(){return r.visualAuthoringOperations.addProperty(e,t.propertyId,t.selector,i),r.raiseVisualContainerChanged(e),!0}))},r.prototype.removeDataBars=function(e,t){var i=this;this.undoRedoService.register("Removing Data Bars",(function(){return i.visualAuthoringOperations.removeProperty(e,t.propertyId,t.selector),i.raiseVisualContainerChanged(e),!0}))},r.prototype.removeConditionalFormattingAll=function(e,t){var i=this;this.undoRedoService.register("Removing All Conditional Formatting",(function(){if(!_.isEmpty(t))for(var r=0,o=t;r<o.length;r++){var n=o[r];i.visualAuthoringOperations.removeProperty(e,n.propertyId,n.selector)}return i.raiseVisualContainerChanged(e),!0}))},r.prototype.persistProperties=function(e,t,i){var r=this,o=function(){return r.visualAuthoringOperations.persistProperties(e,t)};return i?o():this.undoRedoService.register("VisualContainerPersistProperties",o)},r.prototype.deleteSelectedVisuals=function(e){for(var t=_.map(this.selectionService.getSelectedElements(),(function(e){return e.visualContainer})),i=!1,r=0,o=t;r<o.length;r++){var n=o[r];n&&(i=this.deleteVisualContainerInternal(n,e)||i)}i&&(this.notifyVisualContainersAndClearSelection(t,e),this.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1}))},r.prototype.deleteVisualContainer=function(e,t){this.deleteVisualContainerInternal(e,t)&&this.notifyVisualContainersAndClearSelection([e],t)},r.prototype.deleteVisualContainers=function(e,t){var i=this,r=t.sections.filter((function(e){return e.selected}))[0],o=[];t.contract.sections.forEach((function(t){t.name===r.contract.name?e.forEach((function(e){_.any(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e.config.singleVisual.visualType}))&&o.push(e)})):e.forEach((function(e){_.remove(t.visualContainers,(function(t){return e.config.singleVisual.visualType===t.config.singleVisual.visualType})),i.visualAuthoringOperations.deleteVisualRelationships(t,e)}))})),o.length>0&&(o.forEach((function(e){i.deleteVisualContainer(e,t.exploreCanvas)})),this.notifyVisualContainersAndClearSelection(o,t.exploreCanvas))},r.prototype.deleteVisualRelationships=function(e,t){this.visualAuthoringOperations.deleteVisualRelationships(e,t)},r.prototype.setVisualRelationship=function(e,t,i,r){var o=this;this.undoRedoService.register("SetVisualRelationship",(function(){return o.visualAuthoringOperations.setVisualRelationship(e,t,i,r)}))},r.prototype.setDisplayNameAlias=function(e,t,i){var r=this,o=t.config.singleVisual;this.undoRedoService.register("SetColumnName",(function(){o.columnProperties||(o.columnProperties={});var n=o.columnProperties,a=n[e];a?a.displayName=i:n[e]={displayName:i},r.raiseVisualContainerChanged(t)}))},r.prototype.registerUndoableAction=function(e,t,i){var r=this;return this.undoRedoService.register(i,(function(){return r.getSchemaAndExecuteAction(e,(function(e){return t(e)}))}))},r.prototype.getSchemaAndExecuteAction=function(e,t){var i=this;return this.schemaProxy.get(e).then((function(e){return t(e)?i.promiseFactory.resolve():i.promiseFactory.reject()}))},r.prototype.notifyVisualContainersAndClearSelection=function(e,t){var r=this;t.contract.crossHighlight&&_.any(e,(function(e){return e===t.contract.crossHighlight.sourceVisualContainer}))?this.filterGenerator.clearCrossHighlight(t.contract):_.any(e,(function(e){return r.filterGenerator.supportsFilterOutput(e)}))&&this.eventBridge.publishToChannel(i.events.visualContainerChanged,{affectContainer:function(e){return!0}}),this.selectionService.clearSelection()},r.prototype.deleteVisualContainerInternal=function(t,i){if(t){var r=e.explore.util.CanvasVisualsUtility.findVisualContainerViewModel(i.visualContainers,t);if(r){this.visualAuthoringOperations.deleteVisualRelationships(i.contract,t);var o=i.visualContainers.indexOf(r);i.visualContainers.splice(o,1);var n=i.contract,a=n.visualContainers.indexOf(t);return n.visualContainers.splice(a,1),!0}}},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s,l,c,u){return new a(e,t,r,o,n,s,l,c,u)}var o=(jsCommon.DOMConstants,e.explore.util.CanvasVisualsUtility),n=t.services.selectionUtils;i.createCanvasKeyHandlerService=r;var a=(function(){function e(e,t,i,r,o,n,a,s,l){this.clipboardService=e,this.selectionService=t,this.viewModeState=i,this.undoRedoService=r,this.visualAuthoring=o,this.eventBridge=n,this.visibilityService=a,this.formFactor=s,this.layoutAuthoring=l}return e.prototype.onKeyDown=function(e,t){var i=e.which;if(27===i)return this.onClearSelection(e),this.onClearFormatPainterData(e),this.preventStopAndReturnFalse(e);if(this.isSaveEvent(e))return this.onSave(),this.preventStopAndReturnFalse(e);var r=this.formFactor.getCurrentLayoutCapabilities();if(0!==this.viewModeState.getMode()){if(this.isDeleteEvent(e))return r.canRemoveVisualFromLayout()?this.onRemoveFromLayout(e,t):r.canDelete()&&this.onDelete(e,t),this.preventStopAndReturnFalse(e);if(this.isCtrlOrMeta(e))switch(i){case 65:return this.onSelectAll(e,t),this.preventStopAndReturnFalse(e);case 67:return r.canCutCopyPaste()&&this.onCopy(e),this.preventStopAndReturnFalse(e);case 88:return r.canCutCopyPaste()&&this.onCut(e),this.preventStopAndReturnFalse(e);case 86:return r.canCutCopyPaste()&&this.onPaste(e),this.preventStopAndReturnFalse(e);case 89:return this.onRedo(),this.preventStopAndReturnFalse(e);case 90:return this.onUndo(),this.preventStopAndReturnFalse(e)}else if(r.canPassUnhandledKeysToSelectedVisual())return this.allowSelectedVisualContainerToHandle(e,t)}else if(r.canPassUnhandledKeysToSelectedVisual())return this.allowSelectedVisualContainerToHandle(e,t)},e.prototype.allowSelectedVisualContainerToHandle=function(e,t){var i=n.getSelectedVisual(this.selectionService);if(i){var r=o.findVisualContainerViewModel(t.visualContainers,i);if(r)return r.handleKeyDown(e)}},e.prototype.preventStopAndReturnFalse=function(e){return e.originalEvent&&(e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()),!1},e.prototype.onUndo=function(){this.undoRedoService.undo()},e.prototype.onRedo=function(){this.undoRedoService.redo()},e.prototype.onCopy=function(e){this.canCopyOrCut()&&this.clipboardService.copy()},e.prototype.onCut=function(e){this.canCopyOrCut()&&this.clipboardService.cut()},e.prototype.onPaste=function(e){this.clipboardService.paste()},e.prototype.onRemoveFromLayout=function(e,t){this.layoutAuthoring.removeLayoutFromSelectedVisuals(t)},e.prototype.onDelete=function(e,t){var i=this;this.undoRedoService.register("CanvasKeyDelete",(function(){i.visualAuthoring.deleteSelectedVisuals(t)}))},e.prototype.onClearSelection=function(e){this.selectionService.clearSelection()},e.prototype.onClearFormatPainterData=function(e){this.clipboardService.clearFormatData()},e.prototype.onSelectAll=function(e,t){var i=_.map(t.visualContainers,(function(e){return e.contract}));n.selectVisualContainers(i,this.selectionService)},e.prototype.onSave=function(){this.eventBridge.publishToChannel(i.events.saveKeyPressedEvent)},e.prototype.isSaveEvent=function(e){return this.isOnlyCtrlOrMeta(e)&&83===e.which},e.prototype.isDeleteEvent=function(e){return!e.ctrlKey&&46===e.which},e.prototype.canCopyOrCut=function(){return!this.visibilityService.get()},e.prototype.isCtrlOrMeta=function(e){var t=e.ctrlKey,i=e.metaKey;return e&&(t&&!i||!t&&i)},e.prototype.isOnlyCtrlOrMeta=function(e){return this.isCtrlOrMeta(e)&&!e.altKey&&!e.shiftKey},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o,n){return new i(e,t,r,o,n)}e.createCanvasScaleService=t;var i=(function(){function e(e,t,i,r,o){this.explorationNavigation=e,this.formFactorProvider=t,this.visibility=i,this.viewModeState=r,this.overlayService=o,this.m_scale=1}return e.prototype.setCanvasScaleFactor=function(e){this.m_scale=e},e.prototype.getCanvasScaleFactor=function(){return this.m_scale},e.prototype.getDisplayOption=function(){var e=this.formFactorProvider.getCurrentLayout();if(1===e&&1===this.viewModeState.getMode())return 3;var t=!!this.visibility.get();if(t)return 0;var i=this.explorationNavigation.getCurrentSection();if(i)return i.size.displayOption},e.prototype.setDisplayOption=function(e){var t=this.explorationNavigation.getCurrentSection();t&&(this.overlayService.hideAllDropdowns(),t.size.displayOption=e)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new o(e,t,i,r)}i.createConnectionSetupService=r;var o=(function(){function i(e,t,i,r){this.conceptualSchemaProxy=e,this.dataProxy=t,this.visualAuthoring=i,this.visualQueryGenerator=r}return i.prototype.setup=function(i,r){var o=this;void 0===r&&(r=t.constants.ConnectionSetupLimit);var n=1,a="undefined";i&&i.length>0&&(a=i[0].name),r>t.constants.ConnectionSetupLimit&&(r=t.constants.ConnectionSetupLimit),this.conceptualSchemaProxy.get(i).then((function(t){var s=t.schema(a),l=s.capabilities;if(!l||!l.discourageQueryAggregateUsage)for(var c=s.entities,u=0,p=c;u<p.length;u++){var d=p[u];if(n>r)break;for(var h=0,v=d.properties;h<v.length;h++){var g=v[h];if(n>r)break;n++;var f=e.data.SQExprBuilder.fieldExpr({column:{schema:a,entity:d.name,name:g.name}});o.visualAuthoring.createVisualContainerConfig({expr:f,dataSources:i,allowAggregate:!0}).then((function(e){var r=o.visualQueryGenerator.execute({config:e.singleVisual,dataSources:i,schema:t,additionalFilters:null});r&&r.options&&r.options.query&&(r.options.query.allowCache=!1,o.dataProxy.execute(r.options).then((function(){}),(function(){})))}))}}}))},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,n){return new o(e,t,i,r,n)}var r=e.explore.services.events;t.createDeleteVisualService=i;var o=(function(){function t(e,t,i,r,o){this.eventBridge=e,this.$rootScope=t,this.telemetryService=i,this.visualPluginService=r,this.undoRedoService=o}return t.prototype.deleteCustomVisuals=function(t,i){var o=this;this.undoRedoService.register("DeleteCustomVisual",(function(){i.forEach((function(i){o.telemetryService.logEvent(e.telemetry.EXDeleteCustomViz,i.name),o.visualPluginService.removePlugin(i.name),_.remove(t.resourcePackages,(function(e){return e.name===i.name})),o.eventBridge.publishToChannel(r.deleteCustomVisual,{visual:i})})),o.eventBridge.publishToChannel(r.visualPluginsChanged)}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t){return new r(e,t)}t.createDetailVisualSpinnerService=i;var r=(function(){function t(e,t){this.scope=e,this.eventBridge=t}return t.prototype.startSpinner=function(){this.eventBridge.publishBubbling(this.scope,e.viewModels.DetailVisualEvents.spinnerAction,0)},t.prototype.stopSpinner=function(){this.eventBridge.publishBubbling(this.scope,e.viewModels.DetailVisualEvents.spinnerAction,1)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new c(e,t,i,r)}var o=e.explore.util.DrillUtils,n=jsCommon.EnumExtensions,a=t.util.DetailVisualUtils,s=e.visuals.plugins,l=t.util.VisualContainerUtils;i.createDrillService=r;var c=(function(){function t(e,t,i,r){this.eventBridge=e,this.visualPlugin=t,this.visualPluginOps=i,this.featureSwitchService=r}return t.prototype.getSupportedDrillDirections=function(e,t){var i=this.getProjections(e);if(!i)return 0;var r=t;if(_.isEmpty(r)){var n=e.config.singleVisual,a=this.visualPlugin.capabilities(n.visualType);if(!a)return 0;var s=o.getDrillableRoles(a);r=_.first(s)}var l=i[r];if(l&&l.activeProjectionRefs){var c=0,u=l.all();if(1===u.length)return c;var p=l.activeProjectionRefs,d=this.findActiveProjectionIndexInQueryCollection(u,p);return _.isEmpty(p)||d+p.length===u.length||(this.canDrillDownLevel(e,2,r)&&(c|=2),this.canDrillDownLevel(e,3,r)&&(c|=4)),!_.isEmpty(l.activeProjectionRefs)&&(0!==d||p.length>1)&&(c|=1),c}return 0},t.prototype.setDrillMode=function(e,t){e&&e.drillMode!==t&&(e.drillMode=t,this.raiseDrillModeChanged(e,t))},t.prototype.canSeeData=function(e){if(!(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query))return!1;var t=l.getVisualType(e),i=e.config.singleVisual,r=i.getErrorDetails&&!!i.getErrorDetails();return!r&&a.supportsVisualDetails(t,this.visualPlugin,this.visualPluginOps)},t.prototype.canDrillToDetails=function(t,i){if(!t)return!1;var r=l.getVisualQuery(t);if(!r)return!1;var o=l.getVisualType(t);if(o===s.lineChart.name||o===s.areaChart.name||o===s.stackedAreaChart.name)return!1;var n=l.getVisualCapabilities(t,this.visualPlugin);if(!n||n.supportsSelection===!1)return!1;var a=_(l.getSelectExprs(t)).filter((function(t){return e.data.SQExpr.isAggregation(t.expr)})).map((function(e){return e.name})).value();if(_.isEmpty(a))return!1;if(!_.isEmpty(i)&&!_.contains(a,_.first(_.first(i).metadata)))return!1;var c=n.dataRoles;if(_.isEmpty(c))return!1;for(var u=_(c).filter((function(t){return t.kind===e.VisualDataRoleKind.Measure&&0!==t.joinPredicate;
})).map((function(e){return e.name})).value(),p=0,d=0,h=u;d<h.length;d++){var v=h[d],g=r.projections[v];if(!_.isEmpty(g)){if(p++,p>1)return!1;var f=g.all(),m=_.some(f,(function(e){return!_.contains(a,e.queryRef)}));if(m)return!1}}return 0!==p},t.prototype.canDrillByDirection=function(e,t,i){if(!e)return!1;var r=this.getSupportedDrillDirections(e,i);return!!r&&n.hasFlag(r,t)},t.prototype.canDrillthrough=function(e){return!!e&&!!this.featureSwitchService.featureSwitches.drillthrough},t.prototype.isDrillModeEnabled=function(e,t){return!!e&&e.drillMode===t},t.prototype.canDrillDownLevel=function(t,i,r){var o=l.getVisualQuery(t);if(!o)return!1;var n=l.getVisualCapabilities(t,this.visualPlugin);if(!n)return!1;if(!r)return!1;var a=o.projections[r],s=a.getLastActiveQueryReference();if(!s)return!1;for(var c=_.findIndex(a.all(),(function(e){return e.queryRef===s})),u=function(n){var s=a.all()[n],l=o.defn.select().withName(s.queryRef).expr;if(0===_.filter(t.filters,(function(t){return 2===t.howCreated&&e.data.SQExpr.equals(l,t.expression)})).length)return{value:o.currentDrillMode(r)===i}},p=0;p<c;p++){var d=u(p);if("object"==typeof d)return d.value}return!0},t.prototype.getProjections=function(e){return e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.projections},t.prototype.findActiveProjectionIndexInQueryCollection=function(e,t){if(!_.isEmpty(t))for(var i=0;i<e.length;i++){for(var r=i,o=0;o<t.length&&r<e.length&&t[o]===e[r].queryRef;)o++,r++;if(o===t.length)return i}return-1},t.prototype.raiseDrillModeChanged=function(e,t){var r={visualContainer:e};this.eventBridge.publishToChannel(i.events.drillModeChanged,r)},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.common.EventChannelType;!(function(e){e.visualCustomCommand={type:r.Visual,name:"visualCustomCommand"}})(i=t.events||(t.events={}))})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}e.createExplorationCapabilitiesService=t;var i=(function(){function e(){this.options={showAppBar:!0,showTaskPane:!0,showVisualizationPane:!0,showNavContentPane:!0,visualContainerOptions:{showMenu:!0,showPin:!0,showContextMenu:!0,disablePin:!1,disableQueryCacheUpdates:!1},showBackButtonOnAppBar:!1}}return e.prototype.setCapabilities=function(e){_.merge(this.options,e)},e.prototype.getCapabilities=function(){return this.options},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new i(e)}e.createExtensionsService=t;var i=(function(){function t(e){this.eventBridge=e}return t.prototype.setExtensions=function(e){this.extensions=e},t.prototype.getExtensions=function(){return this.extensions},t.prototype.getCommandExtension=function(){return this.extensions?_.map(this.extensions,"command"):[]},t.prototype.executeCustomCommand=function(t,i){this.eventBridge.publishToChannel(e.events.visualCustomCommand,{visualName:t,command:i})},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o){return new l(e,t,i,o,r)}var o=e.data.SemanticFilter,n=e.data.SQExprConverter,a=e.data.SQExprUtils,s=e.explore.util.VisualHostServicesUtil;i.createFilterRestatementService=r;var l=(function(){function i(e,t,i,r,o){this.conceptualSchemaProxy=e,this.filterGenerator=t,this.promiseFactory=i,this.visualQueryGenerator=r,this.dataProxy=o}return i.prototype.loadRestatement=function(e,i,r){var n=this,s=i.filter;return!s||o.isAnyFilter(s)?this.promiseFactory.resolve(null):this.conceptualSchemaProxy.get(e).then((function(l){if(o.isDefaultFilter(s)){var c=a.getDefaultValue(i.expression,l);return t.viewModels.RestatementHelper.fromDefault(c?c.value:"")}return n.loadRestatementForSQExpr(l,i,e,r)}))},i.prototype.loadRestatementForSQExpr=function(e,t,i,r){var o=t.expression,n=o.hasGroupOnKeys(e);return n?this.loadRestatementForSQExprWithGroupOnKeys(e,t,i):this.promiseFactory.resolve(this.getRestatementForSimpleSQExpr(e,t,r))},i.prototype.getRestatementForSimpleSQExpr=function(e,i,r){var o=this.getSelectedScopeIdsContainerFromFilter(e,i);return o&&t.viewModels.RestatementHelper.fromDataViewScopeIdentities(o.scopeIds,o.isNot,r)},i.prototype.loadRestatementForSQExprWithGroupOnKeys=function(e,i,r){var o,n,a=this.getSelectedScopeIdsContainerFromFilter(e,i);if(a&&(o=a.isNot,n=a.scopeIds),_.isEmpty(n))return this.promiseFactory.resolve(null);var s=i.cachedValueItems;return _.isEmpty(s)||s.length!==n.length?this.runQueryToGetRestatement(e,i,o,n,r):this.promiseFactory.resolve(t.viewModels.RestatementHelper.fromLabels(s,o))},i.prototype.runQueryToGetRestatement=function(i,r,o,n,a,l){var c=r.config&&r.config.singleVisual;if(!a||!c)return this.promiseFactory.resolve(null);var u=e.DataViewScopeIdentity.filterFromIdentity(n,!1),p=e.Prototype.inherit(s.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){return{dataFilter:u}}})),d={dataSources:a,schema:i,config:c,additionalFilters:p.getFilters(this.filterGenerator,i)},h=this.visualQueryGenerator.execute(d);return h.error?this.promiseFactory.resolve(null):this.dataProxy.execute(h.options).then((function(e){for(var i=e.dataReaderResult.dataView,n=i&&i.categorical&&i.categorical.categories[0],a=n&&n.values?n.values.length:0,s=[],c=0;c<a;c++){var u=n.identity&&n.identity[c],p=n.values&&n.values[c],d=l?l.format(p):p;s.push({displayName:d,identity:u})}return r.cachedValueItems=s,t.viewModels.RestatementHelper.fromLabels(s,o)}))},i.prototype.getSelectedScopeIdsContainerFromFilter=function(e,t){var i=t.expression.getKeyColumns(e);if(i){var r=t.filter;return r?n.asScopeIdsContainer(r,i):void 0}},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n){return new a(e,t,i,r,o,n)}var o=jsCommon.FreezeUtility,n=e.common.helpers.TelemetryHelper;i.createFormFactorProvider=r;var a=(function(){function r(e,t,i,r,o,n){this.canvasLayout=0,this.canvasLayoutCapabilities=this.initializeLayoutCapabilities(),this.eventBridge=e,this.selection=t,this.servicePauser=i,this.timeout=r,this.viewModeState=o,this.telemetry=n}return r.prototype.getCurrentLayout=function(){return this.canvasLayout},r.prototype.changeFormFactor=function(r,o){var a=this;if(this.canvasLayout!==r){this.telemetry.logEvent(e.telemetry.EXChangeCanvasLayout,n.getTelemetryCanvasLayout(this.canvasLayout),n.getTelemetryCanvasLayout(r),this.getTelemetryViewMode(this.viewModeState.getMode())),this.selection.clearSelection(),this.setCurrentLayout(r);var s=o.exploration.contract,l=s.activeSectionIndex;o.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(s,s.sections[l],this.canvasLayout),this.updateViewModeState();var c={layout:r};this.timeout((function(){return a.eventBridge.publishToChannel(i.events.formFactorChanged,c)}))}},r.prototype.getCurrentLayoutCapabilities=function(){return this.canvasLayoutCapabilities[this.canvasLayout]},r.prototype.setCurrentLayout=function(e){this.canvasLayout=e,0===this.canvasLayout?this.servicePauser.resume():this.servicePauser.pause()},r.prototype.updateViewModeState=function(){var e=this.getCurrentLayoutCapabilities();this.viewModeState.updateConfig((function(t){t.displayOptions.showMobilePane=e.canShowMobileVisualizationPane()}))},r.prototype.initializeLayoutCapabilities=function(){var e=this,t=function(){return 1===e.viewModeState.getMode()},i=function(){return 0===e.viewModeState.getMode()},r=(n={},n[0]={canMoveMultipleVisuals:_.noopTrue,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopFalse,canShowCodePane:_.noopTrue,canShowVisualContainerHeader:_.noopTrue,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopFalse,canShowLayoutGrid:t,canRemoveVisualFromLayout:_.noopFalse,canCutCopyPaste:_.noopTrue,canDelete:_.noopTrue,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:t,canShowVisualToolbar:t},n[1]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:t,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:i,canShowVisualContainerHeaderInset:_.noopTrue,canShowMobileVisualizationPane:t,canShowLayoutGrid:t,canRemoveVisualFromLayout:t,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopFalse,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},n[2]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopTrue,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:_.noopFalse,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopTrue,canShowLayoutGrid:_.noopFalse,canRemoveVisualFromLayout:_.noopTrue,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopFalse,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},n);return o.deepFreeze(r),r;var n},r.prototype.getTelemetryViewMode=function(t){switch(t){case 0:return e.telemetry.ViewMode.View;case 1:return e.telemetry.ViewMode.Edit}},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o){return new s(e,t,i,r,o)}var r=e.visuals.plugins.multiRowCard,o=e.data.SemanticQuery,n=e.explore.util.VisualHostServicesUtil,a=e.explore.contracts.VisualQuery;t.createGroupQueryService=i;var s=(function(){function i(e,t,i,r,o){this.conceptualSchemaProxy=i,this.visualQueryGenerator=r,this.promiseFactory=o,this.singleExecutableDataProxyFactory=e,this.filterGenerator=t,this.reset()}return i.prototype.getValuesForColumn=function(t,i,r){var s=this,l=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(c){var u=new a(o.create(),{});u.add(t,"Values"),s.runQueryImpl({dataSources:i,schema:c,config:{visualType:e.visuals.plugins.table.name,query:u},hostServices:n.createQueryVisualHostServices(),visualQueryGenerator:s.visualQueryGenerator,isLoadMore:r,preferCurrentData:!r,allowCache:!1,isInitialLoad:!r}).then((function(e){s.lastResult=e?{table:e.dataReaderResult.dataView.table,canLoadMore:s.dataProxy.canLoadMore()}:s.lastResult,l.resolve(s.lastResult)}),(function(e){l.reject(e)}))}),(function(e){l.reject(e.clientError)})),l.promise},i.prototype.getAggregatesForColumn=function(e,t){var i=this,s=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(t).then((function(l){var c=new a(o.create(),{}),u=r.capabilities.dataRoles[0].name;c.add(e,u),c.setAggregate(u,0,3,l),c.add(e,u),c.setAggregate(u,1,4,l),c.add(e,u),c.setAggregate(u,2,5,l),i.runQueryImpl({dataSources:t,schema:l,config:{visualType:r.name,query:c},hostServices:n.createQueryVisualHostServices(),visualQueryGenerator:i.visualQueryGenerator,isLoadMore:!1,preferCurrentData:!1,allowCache:!1}).then((function(e){var t,i=e.dataReaderResult.dataView.table,r=i&&i.rows;if(r&&r.length>0){var o=r[0];t=o?{min:{formatString:i.columns[0].format,value:o[0]},max:{formatString:i.columns[1].format,value:o[1]},count:o[2]}:void 0}s.resolve(t)}),(function(e){s.reject(e)}))}),(function(e){s.reject(e.clientError)})),s.promise},i.prototype.reset=function(){this.conceptualSchemaProxy.clearCache(),this.dataProxy=t.createExploreVisualDataProxyService(this.singleExecutableDataProxyFactory.create(),this.filterGenerator)},i.prototype.runQueryImpl=function(e){return this.dataProxy.runQuery(e)},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n,a,l,c,u,p){return new s(u,o,e,r,t,n,l,p,c,i,a)}var r=e.explore.services.events,o=e.explore.util.ResourcePackageUtils;t.createImportVisualService=i;var n="/powerbi/content/visual",a=".pbiviz",s=(function(){function t(e,t,i,r,o,n,a,s,l,c,u){this.eventBridge=e,this.modalDialogService=t,this.$rootScope=i,this.localizationService=r,this.errorService=o,this.notificationToast=n,this.telemetryService=a,this.visualPluginService=s,this.upload=l,this.localFileService=c,this.promiseFactory=u}return t.prototype.importWithDialog=function(e){var t=this,i=this.promiseFactory.defer();i.promise.then((function(i){return t.handleImport(e,i)})),this.localFileService.chooseLocalFile(i,a)},t.prototype.handleImport=function(t,i){var r=this,o=e.common.httpService.powerbiRequestOptions();o.retryCount=0,o.headers[e.common.constants.uploadFileSizeHeaderName]=i.size.toString(),this.notifyWhenLoadingCustomVisual("ImportCustomVisualLoadingTitle",0,"ImportCustomVisualLoadingMessage");var a=this.telemetryService.startEvent(e.telemetry.EXImportCustomViz,i.name,-1,"");this.upload.post(n,[i],o).then((function(e){var i=e.data;null==i.type&&(i.type=0);for(var o=0,n=i.items;o<n.length;o++){var s=n[o];null==s.type&&(s.type=0)}r.import(t,i),a.event.info.resourcePackageId=i.id,a.event.info.resourcePackageName=i.name,a.resolve()}),(function(e){r.showImportErrorDialog();var t=e&&e.error?e.error.code:"-1",i={errorCode:"Import of custom visual failed -> code: "+t};a.reject(i)}))},t.prototype.showImportErrorDialog=function(){var e=this.$rootScope.$new();e.errorService=this.errorService;var t={dialogName:this.localizationService.get("ImportVisual_ErrorDialogHeader"),isDismissable:!0,scope:e,template:"<import-visual-error-dialog></import-visual-error-dialog>",dialogCssClass:"importVisualError"};this.modalDialogService.showLegacyWebModalDialog(t)},t.prototype.import=function(e,t){var i=this;return this.visualPluginService.ensurePlugins([t],!0).then((function(){o.ensureResourcePackages(e),_.remove(e.resourcePackages,(function(e){return e.name===t.name})),e.resourcePackages.push(t),i.eventBridge.publishToChannel(r.addCustomVisual,t),i.eventBridge.publishToChannel(r.visualPluginsChanged),i.notificationToast.hide(i.toastNotificationId),i.toastNotificationId=void 0}))},t.prototype.notifyWhenLoadingCustomVisual=function(t,i,r){var o=this;this.localizationService.ensureLocalization((function(){o.toastNotificationId=o.notificationToast.notify({title:o.localizationService.get(t),message:o.localizationService.get(r),notificationType:e.common.NotificationToastType.Loading})}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new h(e,t,i,r)}var o=e.explore.contracts.FilterType,n=e.data.Selector,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprUtils,u=e.visuals.valueFormatter,p=e.data.VariationRewriter,d=e.explore.util.VisualContainerUtils;i.createIncludeExcludeService=r;var h=(function(){function r(e,t,i,r){this.eventBridge=e,this.localizationService=t,this.undoRedoService=i,this.telemetry=r}return r.prototype.setFilter=function(r,a,s){var l=this,c=_.map(a,(function(e){return n.convertSelectorsByColumnToSelector(e)})),u=_.find(s.filters,(function(e){return e.howCreated===r})),p=2;u||(u={howCreated:r,name:t.FilterUtils.getNextFilterName(s.filters),type:3===r?o.Include:o.Exclude},p=1);var h=u.filter;h=3===r?this.getIncludeFilter(c):this.getExcludeFilter(h,c),this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){u.filter=h;var o={container:s,scopeType:0};1===p&&(t.FilterUtils.add(o.container,u),l.telemetry.logEvent(e.telemetry.EXAddFilter,3===r?e.telemetry.FilterType.Include:e.telemetry.FilterType.Exclude,e.telemetry.FilterScopeType.Visual,e.telemetry.FieldKind.Entity,d.hasGroupByItemsInQuery(s)));var n={filter:u,changeType:p,scope:o};l.eventBridge.publishToChannel(i.events.filterContainerChanged,n)}))},r.prototype.buildViewModel=function(e,t){for(var i=e?e.where():[],r=[],o=0,n=i;o<n.length;o++){var a=n[o],s=a.condition,l=new v;s.accept(l),r.push.apply(r,l.dataPoints)}return{points:r,filter:e,restatement:this.getRestatement(t,r.length)}},r.prototype.updateFilterContainer=function(e,t){var r=this,o=e.contract,n=o.type,a=this.buildFilter(t,n);this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){var t=e.getFilterContainerScope();o.filter=a;var n={filter:o,changeType:2,scope:t};r.eventBridge.publishToChannel(i.events.filterContainerChanged,n)}))},r.prototype.isIncludeExcludeSupported=function(e,t,i){if(e&&e.config&&e.config.singleVisual){var r=e.config.singleVisual,o=r.query;if(o){if(i&&t){var n=t.schema(void 0);if(n&&n.capabilities&&n.capabilities.supportsMultiTableTupleFilters)return!0}for(var a=o.defn.select(),l=void 0,u=0,d=a;u<d.length;u++){var h=d[u],v=h.expr;if(!c.isMeasure(v)){v=p.run(v,t);var g=v.getTargetEntity();if(l){if(!s.equals(l,g))return!1}else l=g}}return!0}}return!1},r.prototype.buildFilter=function(t,i){for(var r,n=t.points[0],a=l.inValues(n.columns,[n.values]),s=1;s<t.points.length;s++)n=t.points[s],r=l.inValues(n.columns,[n.values]),a=l.or(a,r);return i===o.Exclude&&(a=l.not(a)),e.data.SemanticFilter.fromSQExpr(a)},r.prototype.getRestatement=function(e,t){var i=null;return i=e===o.Include?this.localizationService.get("FilterPane_Include"):this.localizationService.get("FilterPane_Exclude"),i+" ("+t+")"},r.prototype.getIncludeFilter=function(t){var i=n.filterExprsFromSelectors(t);return e.DataViewScopeIdentity.filterFromExprs(i,!1)},r.prototype.getExcludeFilter=function(t,i){var r=n.filterExprsFromSelectors(i);if(t){var o=_.find(t.where(),(function(e){return 16===e.condition.kind}));if(o){for(var s=o.condition,c=s.arg,u=0,p=r;u<p.length;u++){var d=p[u],h=e.data.ScopeIdentityExtractor.getInExpr(d);c=l.or(c,h)}return c=l.not(c),a.fromSQExpr(c)}}return e.DataViewScopeIdentity.filterFromExprs(r,!0)},r})();i.IncludeExcludeService=h;var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dataPoints=[],t}return __extends(t,e),t.prototype.visitNot=function(e){e.arg.accept(this)},t.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitIn=function(e){for(var t=[],i=e.args,r=0;r<e.values.length;r++){var o=e.values[r];t.push({values:o,columns:i,text:this.getDataPointText(i,o),expr:e,index:r})}(n=this.dataPoints).push.apply(n,t);var n},t.prototype.getDataPointText=function(e,t){for(var i="",r=0;r<e.length;r++){var o=t[r],n=e[r];i+=u.format(o.value)+" ("+n.ref+") - "}return i=i.slice(0,i.length-3)},t})(e.data.DefaultSQExprVisitor)})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){var e=250,t=250;return new i(e,t)}e.createLayoutInsertionHelper=t;var i=(function(){function e(e,t){this.emptySpaceMinWidth=e,this.emptySpaceMinHeight=t}return e.prototype.getEmptySpaces=function(e,t){for(var i=this.getNonOverlapingRects(e,t),r=this.filterWithMinimumWidth(i),o=[],n=0,a=r;n<a.length;n++){var s=a[n],l=this.extendRect(s,i);l.height>=this.emptySpaceMinHeight&&o.push(l)}return o},e.prototype.extendRect=function(e,t){for(var i,r=!1,o=0,n=t;o<n.length;o++){var a=n[o];if(a!==e){var s=!1,l=!1;if(this.doIntersect(a,e)&&(s=a.y+a.height===e.y,l=a.y===e.y+e.height),!(a.width<e.width))if(l){var c={x:e.x,y:e.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}else if(s){var c={x:e.x,y:a.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}}}return r?this.extendRect(i,t):e},e.prototype.getIntersectingRectangle=function(e,t){var i=Math.max(e.x,t.x),r=Math.min(e.x+e.width,t.x+t.width),o=Math.max(e.y,t.y),n=Math.min(e.y+e.height,t.y+t.height);return i<=r&&o<=n?{x:i,y:o,width:r-i,height:n-o}:null},e.prototype.doIntersect=function(e,t){return!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y)},e.prototype.filterWithArea=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>0&&o.height>0&&t.push(o)}return t},e.prototype.filterWithMinimumWidth=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>=this.emptySpaceMinWidth&&t.push(o)}return t},e.prototype.splitRectangleOnIntersection=function(e,t){var i=this.getIntersectingRectangle(e,t);return i?this.filterWithArea([{x:e.x,y:e.y,width:e.width,height:i.y-e.y},{x:e.x,y:i.y+i.height,width:e.width,height:e.y+e.height-(i.y+i.height)},{x:e.x,y:i.y,width:i.x-e.x,height:i.height},{x:i.x+i.width,y:i.y,width:e.x+e.width-(i.x+i.width),height:i.height}]):[e]},e.prototype.getNonOverlapingRects=function(e,t){if(!t.length)return[];for(var i=[e],r=0,o=t;r<o.length;r++){for(var n=o[r],a=[],s=0,l=i;s<l.length;s++){var c=l[s];a=a.concat(this.splitRectangleOnIntersection(c,n))}i=a}return i},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a){return new l(e,t,i,o,n,a)}var o=jsCommon.ArrayExtensions,n=e.data.QueryProjectionsByRole,a=e.data.dsr.transformDataQueryToSemanticQueryDataShapeCommand,s=t.util.VisualContainerUtils;i.createPinVisualService=r;var l=(function(){function t(e,t,i,r,o,n){this.conceptualSchemaProxy=e,this.displayNameService=t,this.dataProxy=i,this.resourcePackagesService=r,this.visualQueryGenerator=o,this.visualPlugin=n}return t.prototype.getPinData=function(e,t,i,r,o,n,a,l,c,u){var p,d=e.config.singleVisual;if(u&&!this.hasRegisteredResourcePackageReferences(u,l,d)&&(u=void 0),a){var h=a.options.query.command,v=s.describeForPinning(this.displayNameService,c,d.query,d.columnProperties,this.visualPlugin.capabilities(d.visualType),o?o.filterMetadata:null),g=v.queryMetadata;p={dataTransforms:a.transforms,dataViewSource:n?n.dataViewSource:null,baseThemeName:r,elements:v.visualElements,query:h,queryMetadata:g,themeName:l,tileLayoutType:t,visualContainer:e};var f=e.config.singleVisual.title;f&&f.text?p.tileHeading=f.text:this.setPinDataHeadings(n,g,p)}else p={dataViewSource:{data:void 0},baseThemeName:r,themeName:l,tileLayoutType:t,visualContainer:e};var m=this.gatherModelExtensions(i);return m&&(p.modelExtensions=m),this.addResourcePackageIdsToPinData(d.visualType,p,u)},t.prototype.gatherModelExtensions=function(e){var t=_.find(e,(function(e){return"exploration"===e.type}));if(t){var i=t.exploration;if(i)return i.getModelExtensions()}},t.prototype.setPinDataHeadings=function(t,i,r){var o,n,a,s=t&&t.dataViewSource&&t.dataViewSource.data.descriptor;if(s){var l=new e.data.dsr.QueryDescription(i,s);o=l.getMeasureRestatements(),n=l.getFilterRestatements(),a=l.getGroupRestatements()}else{for(var c=[],u=[],p=0,d=i.Select;p<d.length;p++){var h=d[p];3===h.Type||1===h.Type?c.push(h.Restatement):4!==h.Type&&2048!==h.Type||u.push(h.Restatement)}u.length>0&&(a=u),c.length>0&&(o=c)}o?r.tileHeading=this.joinList(o):a&&(r.tileHeading=this.joinList(a)),n&&(r.tileFilterDetails=this.joinList(n)),o&&a&&(r.tileSubDisplay=e.common.localize.format("TileHeadings_By",[this.joinList(a)]))},t.prototype.joinList=function(t){return t.join(e.common.localize.get("ListJoin_Separator"))},t.prototype.pinVisualContainer=function(t,i,r,o,n,s){var l=this,c=i.config.singleVisual,u=c.visualType,p=this.handler,d=u===e.visuals.plugins.image.name?e.common.contracts.TileLayoutType.Full:e.common.contracts.TileLayoutType.Default;this.conceptualSchemaProxy.get(t).then((function(h){var v;if(l.visualQueryGenerator.shouldExecute(c,t)){var g=e.common.GridLayoutConstants.getDefaultGridItemViewport(e.common.GridLayoutConstants.getMediumLandscapeGridItem());v=l.visualQueryGenerator.execute({config:c,dataSources:t,schema:h,additionalFilters:r,dataWindow:g,ignoreViewportForCache:!0,allowClientSideFilters:!1})}if(v){var f=v.options.query.command,m=a(f);l.modifyPinnedVisualDataShapeBinding(m.Binding,c.query,h,u),l.dataProxy.execute(v.options).then((function(e){var a=l.getPinData(i,d,t,o,r,e,v,n,h,s);p&&p.pinVisual(a)}),(function(){}))}else{var y=l.getPinData(i,d,t,o,null,null,null,n,null,s);p&&p.pinVisual(y)}}))},t.prototype.canPinVisualType=function(t){return null!=t&&null!=this.visualPlugin.getPlugin(t)&&t!==e.visuals.plugins.slicer.name&&t!==e.visuals.plugins.basicShape.name},t.prototype.setHandler=function(e){this.handler=e},t.prototype.modifyPinnedVisualDataShapeBinding=function(e,i,r,a){if(e){var s=this.visualPlugin.capabilities(a);if(t.isTableOrMatrix(a))return e.DataReduction||(e.DataReduction={}),void(e.DataReduction.Primary={Window:{Count:100}});if(t.supportsScalarCategoryAxis(s)){var l=i.projections,c=i.defn.select();if(e.DataReduction&&(e.DataReduction.Primary&&e.DataReduction.Primary.BinnedLineSample||e.DataReduction.Intersection&&e.DataReduction.Intersection.BinnedLineSample))return;if(!l||_.isEmpty(c))return;var u="Category",p=n.getRole(l,u);if(!p||_.isEmpty(p.all()))return;var d=p.getLastActiveQueryReference()||p.all()[0].queryRef,h=o.findItemWithName(c,d);if(!h)return;var v=h.expr.getMetadata(r);v&&0===v.kind&&v.type.dateTime&&(e.DataReduction||(e.DataReduction={}),e.DataReduction.Primary={Bottom:{}})}}},t.prototype.hasRegisteredResourcePackageReferences=function(e,t,i){return!(!e||_.isEmpty(e.items))&&!(!t||!_.find(e.items,(function(e){return e.name===t})))},t.prototype.addResourcePackageIdsToPinData=function(e,t,i){var r=[];if(this.visualPlugin.isCustomVisual(e)){var o=this.resourcePackagesService.getPackage(e);o&&r.push(o.id)}return i&&r.push(i.id),_.isEmpty(r)||(t.resourcePackageIds=_.uniq(r)),t},t.supportsScalarCategoryAxis=function(e){return e.objects&&e.objects.categoryAxis&&e.objects.categoryAxis.properties&&void 0!==e.objects.categoryAxis.properties.axisType},t.isTableOrMatrix=function(t){var i=e.visuals.plugins;return t===i.table.name||t===i.matrix.name||t===i.tableEx.name||t===i.pivotTable.name},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(){return{canShowHiddenSchemaItem:_.noopFalse,canToggleSchemaItems:_.noopTrue,setShowHiddenSchemaItem:_.noop,areScriptVisualsApproved:_.noopTrue,approveScriptVisuals:function(){e.contract.fail("ShellService.approveScriptVisuals is not available in ExploreUI view")},showBookmarksPane:_.noop,showEditQueriesEditor:_.noop,showCanvasItemsPane:_.noop}}t.createShellService=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n){return new u(e,t,i,r,o,n)}var o=e.data.FieldExprPattern,n=t.viewModels.ShowValueAsNoCalculation,a=t.viewModels.ShowValueAsPercentOfGrandTotalCalculation,s=t.viewModels.ShowValueAsPercentOfRoleTotalCalculation,l=e.data.SQExprConverter,c=e.data.SQExprUtils;i.createShowValueAsService=r;var u=(function(){function t(e,t,i,r,o,n){this.localizationService=e,this.promiseFactory=t,this.telemetryService=i,this.undoRedo=r,this.visualAuthoring=o,this.visualPlugin=n}return t.prototype.createShowValueAsMenuItems=function(t,i,r){var c=o.getSchema(l.asFieldPattern(t));if(!i.schema(c).capabilities.supportsScopedEval)return[];var u=[];if(this.aggregateSupportsShowValueAs(t,i)){var p=new n(e.common.localize);u.push(this.showValueAsMenuItemBuilder(p));var d=new a(e.common.localize);u.push(this.showValueAsMenuItemBuilder(d));var h=this.visualPlugin.capabilities(r),v=h&&h.dataRoleTotals;if(!_.isEmpty(v))for(var g=0,f=v;g<f.length;g++){var m=f[g],y=new s(this.localizationService,m.roles,e.data.getDisplayName(m.displayName,this.localizationService));u.push(this.showValueAsMenuItemBuilder(y))}}return u},t.prototype.applyShowValueAs=function(t,i,r){var o=this;this.undoRedo.register("applying quick calc "+r.kind,(function(){return o.removeShowValueAs(t,i).then((function(){switch(r.kind){case void 0:return o.promiseFactory.resolve();case 0:return o.visualAuthoring.setPercentOfGrandTotal(t.visualDataRole.name,t.roleIndex,t.visual,t.dataSources);case 1:return o.visualAuthoring.setPercentOfRoleTotal(r.roles,t.visualDataRole.name,t.roleIndex,t.visual,t.dataSources);default:return o.promiseFactory.reject()}})).then((function(){return o.telemetryService.logEvent(e.telemetry.EXChangeQuickCalc,o.showValueAsKindToTelemetryId(i.kind),o.showValueAsKindToTelemetryId(r.kind)),o.promiseFactory.resolve()}))}))},t.prototype.showValueAsMenuItemBuilder=function(e){var t={type:0};return t.key={action:5,showValueAs:e},t.text=e.name,t},t.prototype.aggregateSupportsShowValueAs=function(e,t){var i=e.getMetadata(t);return i&&i.type&&i.type.numeric&&c.isMeasure(e)},t.prototype.removeShowValueAs=function(e,t){var i;switch(t.kind){case void 0:i=this.promiseFactory.resolve();break;case 0:i=this.visualAuthoring.removePercentOfGrandTotal(e.visualDataRole.name,e.roleIndex,e.visual,e.dataSources);break;case 1:i=this.visualAuthoring.removePercentOfRoleTotal(e.visualDataRole.name,e.roleIndex,e.visual,e.dataSources);break;default:i=this.promiseFactory.reject()}return i},t.prototype.showValueAsKindToTelemetryId=function(e){switch(e){case void 0:return"None";case 0:return"PercentOfGrandTotal";case 1:return"PercentOfRoleTotal"}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new o(e)}var r=e.common.models.CollapsiblePaneExpandedWidth;t.createSubscriptionPaneService=i;var o=(function(){function e(e){this.taskPaneSliderService=e}return e.prototype.expandPaneForReportSubscription=function(e,t){this.taskPaneSliderService.isPaneExpanded()||(this.info={reportInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(15,r.Small))},e.prototype.expandPaneForDashboardSubscription=function(e,t){this.info={dashboardInfo:e},this.currentSubscriptionGUID=t,this.taskPaneSliderService.expandPane(15,r.Small)},e.prototype.collapseSubscriptionPane=function(){this.taskPaneSliderService.isPaneExpanded()&&(this.taskPaneSliderService.collapsePane(),this.currentSubscriptionGUID=void 0)},e.prototype.getInfo=function(){return this.info},e.prototype.getCurrentSubscriptionGUID=function(){return this.currentSubscriptionGUID},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new a(e,t,i)}var r="uicomponents",o="ColorPicker",n={javascript:"uiComponents"};t.createUIComponentService=i;var a=(function(){function e(e,t,i){this.$compile=e,this.moduleLoader=t,this.promiseFactory=i}return e.prototype.getUIComponentFactory=function(e){return new s(e,this.$compile,this.moduleLoader,this.promiseFactory)},e})(),s=(function(){function t(e,t,i,r){this.$scope=e,this.$compile=t,this.moduleLoader=i,this.promiseFactory=r}return t.prototype.createColorPicker=function(t,i,a){return __awaiter(this,void 0,e.Promise,(function(){var s,l=this;return __generator(this,(function(c){return s=this.promiseFactory.defer(),this.moduleLoader.require(n).then((function(){var n=e[r][o],c=new n(l.$scope,l.$compile,t,i,a);s.resolve(c)})),[2,s.promise]}))}))},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new n}function i(){return{supportsPinning:void 0,supportsDeletion:void 0,enablePenAnnotation:!1,visualDoubleClickEnabled:!1,displayOptions:{canShowCanvasWatermark:!1,showVisualBordersInViewMode:!1,hideVisualizationPane:!1,hideVisualBodyTitle:!1,hideTileMenu:!1,hideNavigationPane:!1,disableFadeout:!1,showMobilePane:!1,hideInFocusBar:!1,hideInFocusTileMenu:!1,visualMouseoverDisabled:!1,hideCanvasSwipeHandles:!1,extendBackgroundToWholeCanvas:!1},touchOptions:{deselectVisualOnCanvasScroll:!1,disableCanvasScrollOnSelectedVisual:!1,disableTouchZoom:!1,isCanvasSwipeable:!1,swipeOnlyFromEdge:!1,swipeEdgeThreshold:void 0,touchEventsOnSelectedVisualOnly:!1,disableCanvasPinch:!1,disableTouchendOnTooltip:!1},penProperties:{strokeStyle:r.DefaultPenStrokeStyle,
lineWidth:r.DefaultPenLineWidth,opacity:r.DefaultPenOpacity}}}var r,o=jsCommon.FreezeUtility;!(function(e){e.DefaultPenStrokeStyle="#939598",e.DefaultPenLineWidth=20,e.DefaultPenOpacity=1})(r=e.annotations||(e.annotations={})),e.createViewModeState=t;var n=(function(){function e(){this.config=i(),this.freeze(),this.state={}}return e.prototype.getViewState=function(){return this.state},e.prototype.getConfig=function(){return this.frozenConfig},e.prototype.updateConfig=function(e){e&&(e(this.config),this.freeze())},e.prototype.getMode=function(){return this.mode},e.prototype.setMode=function(e){this.mode=e},e.prototype.freeze=function(){var e=_.cloneDeep(this.config);o.deepFreeze(e),this.frozenConfig=e},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,u,p,d,h,v,g,f,m,y,w,S){return new c(e,t,i,r,o,n,a,s,l,u,p,h,d,v,g,f,m,y,w,S)}var o=(e.data,e.data.segmentation.DataViewMerger),n=e.data.services.DataViewTransformActionsSerializer,a=e.data.dsr,s=e.visualHost.ResourcePackageReferenceResolver,l=t.util.VisualContainerUtils;i.createVisualContainerQueryHandler=r;var c=(function(){function r(e,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y,w,S){this.queryExecutionServices=e,this.hostServices=i,this.promiseFactory=r,this.conceptualSchemaProxy=o,this.featureSwitchService=n,this.visualQueryGenerator=s,this.visualPlugin=l,this.embedModeService=d,this.filterGenerator=v,this.scriptVisuals=g,this.displayNameService=f,this.explorationNavigation=m,this.resourceLoader=y,this.eventBridge=w,this.shell=S,this.visualDataProxyExecutionService=t.services.createVisualDataProxyExecutionService(r,o,n,a,s,l,c,u,t.services.createExploreVisualDataProxyService(h.create(),v),p,this.embedModeService)}return r.prototype.runQuery=function(e){var t=this,i=this.queryExecutionServices.getDataSources(),r=e.contract;if(!this.shouldBlockVisualQuery(r)&&this.visualQueryGenerator.shouldExecute(r.config.singleVisual,i)){var o;!e.initialLoad&&this.hostServices&&this.conceptualSchemaProxy.get(i).then((function(a){if(o=t.visualDataProxyExecutionService.generateQuery({dataSources:i,schema:a,config:r.config.singleVisual,hostServices:t.hostServices,visualQueryGenerator:t.visualQueryGenerator,isLoadMore:!1,isInitialLoad:e.initialLoad,allowCache:e.allowCache,preferCurrentData:e.preferCurrentData,viewport:e.viewport}),o&&!o.error&&r.cachedData){r.cachedData.dataUpdatedTime=void 0;var s=t.visualPlugin.capabilities(r.config.singleVisual.visualType);r.cachedData.transformsObject=n.serializeDataViewTransformActions(o.transforms,s.objects),r.cachedData.queryObject=o.options.query.command,r.cachedData.dataObject=void 0}}));var a=this.visualDataProxyExecutionService.runQuery({dataSources:i,contract:r,viewport:e.viewport,hostServices:this.hostServices,initialLoad:e.initialLoad,useVisualContainerCache:e.useVisualContainerCache,preferCurrentData:e.preferCurrentData,allowCache:e.allowCache,generatedQuery:o}),s=r.config.singleVisual.visualType,l=r.config.singleVisual.objects,c=this.loadResourcePackageReferences(s,l);e.geocodingTracker&&e.geocodingTracker.newQuery(),this.queryExecutionServices.notifyStart();var u=!1;a.previewPromise.then((function(e){e&&!u&&t.resolveResourcePackageReferences(s,e.dataProxyQuery.transforms.objects).then((function(i){t.handleQueryResult(r,e.result,e.dataProxyQuery,i)}))})),a.finalPromise.then((function(i){c.then((function(){var o;i&&(o={updateContractCache:!0,updateServerCache:i.updateServerVisualContainerCache},t.resolveResourcePackageReferences(s,i.dataProxyQuery.transforms.objects).then((function(n){t.handleQueryResult(r,i&&i.result,i.dataProxyQuery,n,o,e.currentData)})))}))}),(function(e){t.queryExecutionServices.handleErrors(e)})).finally((function(){u=!0,t.queryExecutionServices.notifyEnd()}))}},r.prototype.loadMoreData=function(e){var t=this;this.queryExecutionServices.notifyStart(),this.getNextDataSegment(e).then((function(i){i&&t.mergeMoreData(i.result,i.dataProxyQuery,e.currentData)})).finally((function(){t.queryExecutionServices.notifyEnd()}))},r.prototype.getNextDataSegment=function(e){var t=this,i=this.promiseFactory.defer();return this.visualDataProxyExecutionService.canLoadMoreData()?this.visualDataProxyExecutionService.loadMoreData({dataSources:this.queryExecutionServices.getDataSources(),contract:e.contract,hostServices:this.hostServices,viewport:e.viewport,useVisualContainerCache:e.useVisualContainerCache}).then((function(e){t.handleLoadMoreDataWarnings(e&&e.result,e&&e.dataProxyQuery),i.resolve(e)}),(function(e){t.queryExecutionServices.handleErrors(e),i.reject(e)})):i.reject("Cannot load more data"),i.promise},r.prototype.mergeMoreData=function(e,t,i){var n=r.getDataProxyQueryExecutionResultWarnings(e,t),a=e?e.dataReaderResult.dataView:null;if(a){var s=i.dataView;o.mergeDataViews(s,a);var l={dataView:s,dataViewSource:e&&e.dataViewSource,isFirstSegment:!1};_.isEmpty(n)||(l.warnings=n),this.queryExecutionServices.loadMergedData(l)}},r.prototype.visualizeDataViewSource=function(e,t,i){var r=this,o=a.read(31,t.data,this.featureSwitchService.featureSwitches.cellLevelFormatting),n=o.error;if(n)return void this.queryExecutionServices.handleErrors(n);var s=this.queryExecutionServices.getDataSources(),l=e&&e.config&&e.config.singleVisual;s&&l&&this.conceptualSchemaProxy.get(s).then((function(n){var a=r.visualQueryGenerator.execute({config:l,dataSources:s,schema:n,additionalFilters:r.hostServices.getFilters(r.filterGenerator,n),restartToken:o.restartToken,dataWindow:i});if(a){var c=r.promiseFactory.defer();c.resolve(a.options),r.handleQueryResult(e,{dataViewSource:t,dataReaderResult:o},{transforms:a.transforms,error:a.error,warnings:a.warnings,options:c.promise},null,{updateContractCache:!0})}}))},r.prototype.updateNonQueryVisual=function(e,t){var i=this,r={dataView:null,dataViewSource:null};if(t){var o=e.config.singleVisual.visualType,n=e.config.singleVisual.objects;this.queryExecutionServices.notifyStart(),this.resolveResourcePackageReferences(o,n).then((function(e){i.queryExecutionServices.applyUpdate(r,t,e)})).finally((function(){i.queryExecutionServices.notifyEnd()}))}else this.queryExecutionServices.applyUpdate(r,t,null)},r.prototype.updateContractCache=function(t,i,r){var o=this;if(!t)return this.promiseFactory.reject(null);var n=this.queryExecutionServices.getDataSources();if(!n)return this.promiseFactory.reject(null);var a=t.cachedData&&t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime:null,s=i&&i.dataViewSource?i.dataViewSource.data:void 0,c=r&&r.error;return i&&i.dataReaderResult&&i.dataReaderResult.disallowPersisting&&(a=null,s=null,c=new e.IgnorableClientError),this.conceptualSchemaProxy.get(n).then((function(e){return r.options.then((function(i){var n={transforms:r.transforms,error:c,warnings:r.warnings,options:i};t.cachedData=l.createCacheEntry(o.visualPlugin,o.displayNameService,s,n,e,t.config.singleVisual,o.filterGenerator.generateFilterMetadata(t.filters),a)}))}))},r.prototype.handleQueryResult=function(e,t,o,n,a,s){var c=this;void 0===a&&(a={}),this.queryExecutionServices.clearErrors();var u=r.getDataProxyQueryExecutionResultWarnings(t,o);u&&this.queryExecutionServices.handleWarnings(u,o.transforms);var p;if(t){p={dataView:t&&t.dataReaderResult?t.dataReaderResult.dataView:null,dataViewSource:t&&t.dataViewSource?t.dataViewSource:null},u&&(p.warnings=u);var d=l.isSegment(p.dataView);d&&(p.isFirstSegment=d)}else p={dataView:s&&s.dataView,dataViewSource:s&&s.dataViewSource};if(this.queryExecutionServices.applyUpdate(p,o.transforms,n),a.updateContractCache){var h=t&&t.dataViewSource?t.dataViewSource.data:void 0,v=this.updateContractCache(e,h,o);a.updateServerCache&&v.then((function(){o.options.then((function(t){var r=e.id,o={visualContainerId:r,query:JSON.stringify(t.query.command),dataTransforms:c.getCachedTransformsString(e)};c.eventBridge.publishToChannel(i.events.newQueryCacheResultAvailable,o)}))}))}},r.prototype.handleLoadMoreDataWarnings=function(e,t){this.queryExecutionServices.clearErrors();var i=r.getDataProxyQueryExecutionResultWarnings(e,t);i&&this.queryExecutionServices.handleWarnings(i,t.transforms)},r.prototype.getCachedTransformsString=function(e){if(e.cachedData){var t=e.cachedData.transformsObject;if(t)return n.serializeTransformActions(t)}},r.prototype.shouldBlockVisualQuery=function(e){if(l.isScriptVisual(e,this.visualPlugin)&&(!this.shell.areScriptVisualsApproved()||this.scriptVisuals.shouldBlockScriptVisual())){var t=l.getVisualType(e);return this.eventBridge.publishToChannel(i.events.visualContainerQueryBlocked,{visualType:t}),!0}return!1},r.prototype.loadResourcePackageReferences=function(e,t){var i=this.visualPlugin.capabilities(e),r=i&&i.objects,o=this.explorationNavigation.getCurrentExploration();return s.loadFromDataViewObjects(t,r,o?o.resourcePackages:null,this.resourceLoader,this.promiseFactory)},r.prototype.resolveResourcePackageReferences=function(e,t){var i=this.visualPlugin.capabilities(e),r=i&&i.objects,o=this.explorationNavigation.getCurrentExploration();return s.loadAndResolveFromDataViewObjects(t,r,o?o.resourcePackages:null,this.resourceLoader,this.promiseFactory)},r.getDataProxyQueryExecutionResultWarnings=function(e,t){return t&&!_.isEmpty(t.warnings)?t.warnings:e&&e.dataReaderResult&&!_.isEmpty(e.dataReaderResult.warnings)?e.dataReaderResult.warnings:void 0},r})();i.VisualContainerQueryHandler=c})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new o(e,t,i)}var r=e.explore.util.VisualContainerUtils;t.createVisualContainerDataSelectionService=i;var o=(function(){function e(e,t,i){this.visualContainer=e,this.queryService=t,this.visualPluginOps=i}return e.prototype.getSelectedValues=function(e){var t=r.getVisualType(this.visualContainer.contract),i=r.getVisualQuery(this.visualContainer.contract),o=this.visualPluginOps.dataViewKinds(t,i);return this.queryService.query(this.getDataViews(),e,o)},e.prototype.getDataViews=function(){return this.visualContainer&&this.visualContainer.readOnlyState.visual&&this.visualContainer.readOnlyState.visual.dataViews},e})();t.VisualContainerDataSelectionService=o})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,l,c,u,p){return new s(e,t,i,r,o,n,a,l,c,u,p)}var o=e.data.services.DataViewTransformActionsSerializer,n=e.data.dsr,a=t.util.VisualContainerUtils;i.createVisualDataProxyExecutionService=r;var s=(function(){function t(e,t,i,r,o,n,a,s,l,c,u){this.promiseFactory=e,this.conceptualSchemaProxy=t,this.featureSwitchService=i,this.telemetryService=r,this.visualQueryGenerator=o,this.visualPlugin=n,this.visualPluginOps=a,this.dataProxy=s,this.visualDataProxyService=l,this.networkAvailability=c,this.embedTypeDescription=u.getEmbedTypeDescription()}return t.prototype.generateQuery=function(e){return this.visualDataProxyService.generateQuery(e)},t.prototype.runQuery=function(e){var t=this,i=this.promiseFactory.defer(),r=this.promiseFactory.defer(),o={previewPromise:i.promise,finalPromise:r.promise};return this.applyVisualCache(e,i,r).then((function(i){i&&t.runQueryImpl(e,r,!1)})),o},t.prototype.applyVisualCache=function(t,i,r){var o=this,n=this.promiseFactory.defer(),s=this.featureSwitchService.featureSwitches.embeddedEnabled,l=t.contract;if(t.useVisualContainerCache&&t.initialLoad||s){var c=a.hasOnPremDataSource(t.dataSources);this.retrieveFromVisualContainerCache(t.dataSources,l,t.viewport,t.hostServices).then((function(t){t.isFinal||s||!o.networkAvailability.isNetworkAvailable()?(i.reject(),r.resolve(t.result),n.resolve(!1),s||o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.Cache,c,e.telemetry.VisualInitialLoadTypeWarning.None,o.embedTypeDescription)):(i.resolve(t.result),n.resolve(!0),s||o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.StaleCache,c,e.telemetry.VisualInitialLoadTypeWarning.None,o.embedTypeDescription))}),(function(t){i.reject(),l.useInitialCachedQuery=!1,s?(r.reject(),n.resolve(!1)):(n.resolve(!0),o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.NoCache,c,t,o.embedTypeDescription))}))}else i.reject(),n.resolve(!0);return n.promise},t.prototype.runQueryImpl=function(e,t,i){var r=this,o=e.contract,n=e.dataSources,a=e.initialLoad&&!!e.useVisualContainerCache&&o&&!o.isInitialLoadQueryDirty;return!o||!o.config||o.useInitialCachedQuery&&a||!this.visualQueryGenerator.shouldExecute(o.config.singleVisual,n)?void t.resolve(null):void this.conceptualSchemaProxy.get(n).then((function(s){var l={dataSources:n,schema:s,config:o.config.singleVisual,hostServices:e.hostServices,visualQueryGenerator:r.visualQueryGenerator,isLoadMore:i,isInitialLoad:a,allowCache:e.allowCache,preferCurrentData:e.preferCurrentData,viewport:e.viewport,generatedQuery:e.generatedQuery};r.visualDataProxyService.runQuery(l).then((function(i){return r.loadData(i,s,o,a,e.useVisualContainerCache,t)}),(function(e){return t.reject(e)}))}),(function(e){t.reject(e?e.clientError:null)}))},t.prototype.canLoadMoreData=function(){return this.visualDataProxyService.canLoadMore()},t.prototype.loadMoreData=function(e){var t=this.promiseFactory.defer();return this.visualDataProxyService.canLoadMore()?this.runQueryImpl(e,t,!0):t.reject(),t.promise},t.prototype.loadData=function(e,t,i,r,o,n){var a=this.visualDataProxyService.lastExecutedQuery(),s=r&&o&&(this.isMissingVisualQueryOrDataTransformsContract(i)||this.isGeneratedQueryDifferentToContainerQuery(i,a)),l=this.promiseFactory.defer();l.resolve(a.options),n.resolve({result:e,dataProxyQuery:{transforms:a.transforms,error:a.error,warnings:a.warnings,options:l.promise},schema:t,updateServerVisualContainerCache:s})},t.prototype.isMissingVisualQueryOrDataTransformsContract=function(e){var t=a.getVisualType(e);return!(!t||!this.visualPluginOps.isQueryVisual(t))&&(null==e.cachedData||null==e.cachedData.query&&null==e.cachedData.queryObject||!e.cachedData.transforms)},t.prototype.isGeneratedQueryDifferentToContainerQuery=function(e,t){var i=e.cachedData;if(i&&i.query){var r=JSON.stringify(t.options.query.command);return r!==i.query}return!1},t.prototype.retrieveFromVisualContainerCache=function(t,i,r,o){if(i.cachedData&&i.cachedData.data)return this.processVisualContainerCache(t,i,r,o);var n=this.promiseFactory.defer();return n.reject(e.telemetry.VisualInitialLoadTypeWarning.CacheMissing),n.promise},t.prototype.processVisualContainerCache=function(t,i,r,s){var l,c=this,u=this.promiseFactory.defer(),p=jsCommon.GzipUtility.uncompress(i.cachedData.data);try{l=JSON.parse(p)}catch(t){return u.reject(e.telemetry.VisualInitialLoadTypeWarning.JsonParseFailed),u.promise}var d=null;try{d=n.read(31,l,this.featureSwitchService.featureSwitches.cellLevelFormatting)}catch(t){return u.reject(e.telemetry.VisualInitialLoadTypeWarning.DsrReadFailed),u.promise}if(!d)return u.reject(e.telemetry.VisualInitialLoadTypeWarning.DataObjectNull),u.promise;var h={data:l},v=a.getVisualType(i),g=this.visualPlugin.capabilities(v),f=g?g.objects:void 0,m=jsCommon.JsonExtensions.tryParseJSON(i.cachedData.transforms),y=m?o.deserializeDataViewTransformActions(m,f):void 0,w=this.promiseFactory.defer(),S={result:{dataViewSource:h,dataReaderResult:d},dataProxyQuery:{transforms:y,warnings:d.warnings?d.warnings:void 0,error:d.error,options:w.promise},schema:void 0,updateServerVisualContainerCache:!1};return d.error||!y?u.reject(d.error?e.telemetry.VisualInitialLoadTypeWarning.DsrHasOdataError:e.telemetry.VisualInitialLoadTypeWarning.DataTransformsMissing):(u.resolve({isFinal:i.useInitialCachedQuery,result:S}),i.useInitialCachedQuery&&this.conceptualSchemaProxy.get(t).then((function(e){var o=c.visualDataProxyService.generateQuery({dataSources:t,schema:e,config:i.config.singleVisual,hostServices:s,visualQueryGenerator:c.visualQueryGenerator,isLoadMore:!1,isInitialLoad:!1,allowCache:!0,viewport:r});c.dataProxy.setLocalCacheResult(o.options,l),w.resolve(o.options)}))),u.promise},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new n(e,t)}var r=jsCommon.JsonComparer,o=jsCommon.PerfTimer;t.createExploreVisualDataProxyService=i;var n=(function(){function t(t,i){this.dataProxy=t,this.promiseFactory=e.createJQueryPromiseFactory(),this.filterGenerator=i}return t.prototype.generateQuery=function(e){var t=o.start("visualQueryGenerator("+e.config.visualType+")"),i=e.visualQueryGenerator.execute({config:e.config,dataSources:e.dataSources,schema:e.schema,additionalFilters:e.hostServices.getFilters(this.filterGenerator,e.schema),restartToken:e.preferCurrentData?this.currentDataToken:this.moreDataToken,cacheResponseOnServer:e.isInitialLoad,allowCache:e.allowCache,dataWindow:e.viewport});return t(),i},t.prototype.runQuery=function(t){var i=this,o=this.promiseFactory.defer(),n=this.moreDataToken;if(t.isLoadMore||(this.moreDataToken=void 0),t.isLoadMore&&!this.moreDataToken)o.reject();else{var a=t.generatedQuery||this.generateQuery(t);if(a)if(a.error)o.reject(a.error),this.generatedQuery=void 0;else{if(!(this.generatedQuery&&t.preferCurrentData&&r.equals(a.options,this.generatedQuery.options))){var s=this.dataProxy.execute(a.options);return s.then((function(e){i.generatedQuery=a,i.currentDataToken=i.moreDataToken,i.moreDataToken=e&&e.dataReaderResult&&e.dataReaderResult.restartToken,o.resolve(e)}),(function(e){i.generatedQuery=void 0,o.reject(e)})),s}o.resolve(null),this.generatedQuery=a,this.moreDataToken=n}else this.generatedQuery=void 0,o.reject()}return e.RejectablePromise2(o)},t.prototype.canLoadMore=function(){return null!=this.moreDataToken},t.prototype.lastExecutedQuery=function(){return this.generatedQuery},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new o(e,t,i,r)}var r={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},o=(function(){function t(e,t,i,r){this.promiseFactoryValue=e,this.moduleLoader=t,this.geolocationService=i,this.geocoderService=r,this.instanceId=void 0}return t.initialize=function(i){e.visuals.valueFormatter.setLocaleOptions(t.createLocaleOptions(i)),e.visuals.TooltipManager.setLocalizedStrings(t.createTooltipLocaleOptions(i)),e.data.DataViewTransform.setLocalizationOptions(t.createDataViewTransformLocalizationOptions(i))},t.createLocaleOptions=function(e){return{null:e.get("NullValue"),true:e.get("BooleanTrue"),false:e.get("BooleanFalse"),NaN:e.get("NaNValue"),infinity:e.get("InfinityValue"),negativeInfinity:e.get("NegativeInfinityValue"),beautify:function(i){return t.beautify(e,i)},describe:function(i){return t.describeUnit(e,i)},restatementComma:e.get("FilterRestatement_Comma"),restatementCompoundAnd:e.get("FilterRestatement_CompoundAnd"),restatementCompoundOr:e.get("FilterRestatement_CompoundOr")}},t.createTooltipLocaleOptions=function(t){return{highlightedValueDisplayName:t.get(e.visuals.ToolTipComponent.highlightedValueDisplayNameResorceKey)}},t.createDataViewTransformLocalizationOptions=function(t){return{quarterPrefix:t.get(e.visuals.ForecastHelper.quarterHierarchyLevelPrefixResorceKey)}},t.prototype.getLocalizedString=function(t){return e.common.localize.get(t)},t.prototype.onDragStart=function(){},t.prototype.canSelect=function(){return!1},t.prototype.onSelecting=function(){},t.prototype.onSelect=function(){},t.prototype.onContextMenu=function(){},t.prototype.loadMoreData=function(){},t.prototype.persistProperties=function(e){},t.prototype.onCustomSort=function(e){},t.prototype.getViewMode=function(){return 0},t.prototype.getEditMode=function(){return 0},t.prototype.setWarnings=function(e){},t.prototype.setToolbar=function(e){},t.prototype.shouldRetainSelection=function(){return!1},t.prototype.geocoder=function(){return this.geocoderService},t.prototype.geolocation=function(){return this.geolocationService},t.prototype.locale=function(){return e.common.unmappedCultureInfo},t.prototype.promiseFactory=function(){return this.promiseFactoryValue},t.prototype.analyzeFilter=function(t){return e.explore.services.createAnalyzedFilter(t,!1)},t.prototype.getIdentityDisplayNames=function(e){},t.prototype.setIdentityDisplayNames=function(e){},t.prototype.tooltips=function(){},t.prototype.telemetry=function(){},t.prototype.loader=function(){return this.moduleLoader},t.prototype.getUIComponentFactory=function(){},t.prototype.applyJsonFilter=function(e,t,i,r){},t.prototype.launchUrl=function(e){},t.prototype.refreshHostData=function(){},t.beautify=function(e,t){var i=r[t];return i?e.getOptional(i)||t:t},t.describeUnit=function(e,t){var i=t===-1?"Auto":t.toString(),r=e.getOptional("DisplayUnitSystem_E"+i+"_Title"),o=t<=0?"{0}":e.getOptional("DisplayUnitSystem_E"+i+"_LabelFormat");if(r||o)return{title:r,format:o}},t})();t.VisualHostServices=o,t.createVisualHostServices=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,a){return new n(e,t,i,r,o,a)}var r=jsCommon.ArrayExtensions,o=e.data.SQExpr;t.createVisualSortHelper=i;var n=(function(){function e(e,t,i,r,o,n){this.setting=e,this.model=t,this.sort=i,this.undoRedo=r,this.timeout=o,this.visualAuthoring=n,this.sortDelay=500}return e.prototype.resetSortSettings=function(e,t){this.setting.defaultSortBehavior=t,this.setting.sortableFields=e},e.prototype.toggleSort=function(e,t){var i=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.sortPromise=this.timeout((function(){i.undoRedo.register("VisualContainerToggleSort",(function(){var r=!1;return e?(t&&(e.sortDirection=t),i.toggleSortByField(e),r=!0):void 0!==i.model.readOnlyState.actualSortDirection&&(i.sortByOrder(),r=!0),i.sortPromise=void 0,r}))}),this.sortDelay)},e.prototype.toggleDirection=function(e){return 1===e?2:1},e.prototype.sortByOrder=function(){var e=this.model.contract.config.singleVisual.query.defn.orderBy();if(!_.isEmpty(e)){for(var t=0,i=e;t<i.length;t++){var r=i[t];r.direction=this.toggleDirection(this.model.readOnlyState.actualSortDirection)}this.visualAuthoring.setOrderBy(this.model.contract,e)}},e.prototype.toggleSortByField=function(e){var t=this,i=_.map(e.exprs,(function(t){return{direction:e.sortDirection||2,expr:t.expr}})),r=this.model.contract.config.singleVisual.query;e.active?this.visualAuthoring.removeOrderBy(this.model.contract,i.map((function(e){return e.expr}))):(this.sort.resetSort(r),this.resetSortableFieldsStatus(!1,!1),this.visualAuthoring.setOrderBy(this.model.contract,i));var o=_.find(this.setting.sortableFields,(function(i){return t.compareSortableFieldExprs(e,i)}));o&&(o.active=!e.active)},e.prototype.applySortByFields=function(e){var t=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.resetSortableFieldsStatus(!1,!0);var i=this.findMatchingSortableFields(e);this.sortPromise=this.timeout((function(){t.undoRedo.register("VisualContainerApplySort",(function(){for(var e=[],r=0,o=i;r<o.length;r++)for(var n=o[r],a=0,s=n.exprs;a<s.length;a++){var l=s[a];e.push({expr:l.expr,direction:n.sortDirection})}var c=t.model.contract,u=c.config.singleVisual.query;return t.sort.resetSort(u),t.visualAuthoring.setOrderBy(c,e),t.sortPromise=void 0,!0}))}),this.sortDelay)},e.prototype.findMatchingSortableFields=function(e){var t=[],i=this.setting.sortableFields;if(_.isEmpty(i)||_.isEmpty(e))return[];for(var r=0,o=i;r<o.length;r++){for(var n=o[r],a=!1,s=null,l=function(t){var i=_.find(e,(function(e){return e.queryName===t.name}));if(!i)return a=!1,"break";if(null==s)s=i.sortDirection;else if(s!==i.sortDirection)return a=!1,"break";a=!0},c=0,u=n.exprs;c<u.length;c++){var p=u[c],d=l(p);if("break"===d)break}a&&(n.sortDirection=s,n.active=!0,t.push(n))}return t},e.prototype.areAllSortDescriptorsIncluded=function(e,t){for(var i=0,r=e;i<r.length;i++){for(var o=r[i],n=!1,a=0,s=t;a<s.length;a++){for(var l=s[a],c=0,u=l.exprs;c<u.length;c++){var p=u[c];if(p.name===o.queryName){n=!0;break}}if(n)break}if(!n)return!1}return!0},e.prototype.resetSortableFieldsStatus=function(e,t){if(this.setting.sortableFields)for(var i=0,r=this.setting.sortableFields;i<r.length;i++){var o=r[i];o.active=e,t&&(o.sortDirection=void 0)}},e.prototype.compareSortableFieldExprs=function(e,t){var i=e.exprs,n=t.exprs;return r.sequenceEqual(i,n,(function(e,t){return o.equals(e.expr,t.expr)}))},e})();t.VisualSortHelper=n})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new d(e,t,i,r)}var r=e.visuals.DefaultTooltipOptions,o=e.visuals.TouchOptimizedTooltipOptions;t.createVisualHostTooltipService=i;var n=350,a=350,s=350,l=350,c=500,u=12,p="body",d=(function(){function t(t,i,o,n){this.$timeout=t,this.touchScreenOptimized=i,this.parentContainer=o||$(p);var a=this.parentContainer.get(0);this.tooltipContainer=n||new e.visuals.TooltipContainer(a,r)}return t.prototype.show=function(e){var t=this,i=e.isTouchEvent&&this.touchScreenOptimized;this.tooltipContainer.setTooltipAppearanceOptions(i?o:r),this.clearTooltipTimeout();var a;a=this.tooltipContainer.isVisible()?16:e.isTouchEvent?s:n,this.move(e),this.delayedTooltipPromise=this.$timeout((function(){t.tooltipContainer.show(e.dataItems),t.startLongPause(e.identities)}),a)},t.prototype.move=function(e){var t=this.getClickedArea(e.coordinates,e.isTouchEvent);this.tooltipContainer.move(e.dataItems,t),this.startLongPause(e.identities)},t.prototype.hide=function(t){var i,r=this;i=t.immediately?0:t.isTouchEvent?l:a,this.clearTooltipTimeout(),this.delayedTooltipPromise=this.$timeout((function(){r.tooltipContainer.hide(),e.visuals.TooltipManager.ToolTipInstance.hide()}),i),this.longPauseDebounced&&(this.longPauseDebounced.cancel(),this.longPauseDebounced=void 0)},t.prototype.visible=function(){return this.tooltipContainer.isVisible()},t.prototype.container=function(){return this.parentContainer.get(0)},t.prototype.enabled=function(){return e.visuals.TooltipManager.ShowTooltips},t.prototype.onLongPause=function(e){this.longPauseDebounced=void 0},t.prototype.startLongPause=function(e){var t=this;this.longPauseDebounced||(this.longPauseDebounced=_.debounce((function(){return t.onLongPause(e)}),c)),this.longPauseDebounced()},t.prototype.clearTooltipTimeout=function(){null!=this.delayedTooltipPromise&&(this.$timeout.cancel(this.delayedTooltipPromise),this.delayedTooltipPromise=void 0)},t.prototype.getClickedArea=function(t,i){var r=0,o=t[0],n=t[1];if(i){r=u;var a=r/2;o=Math.max(o-a,0),n=Math.max(n-a,0)}return new e.visuals.Rect(o,n,r,r)},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new o(e,t,i)}var r=e.extensibility.convertVisualEventType;t.createVisualHostTelemetryService=i;var o=(function(){function t(e,t,i){this.telemetryService=e,this.visualType=t,this.instanceId=i}return t.prototype.trace=function(t,i){var o=r(t);if(o&&e.telemetry[o]){var n=e.telemetry[o];this.telemetryService.logEvent(n,this.visualType,this.instanceId,i)}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n){return new a(e,t,i,r,o,n)}var o=t.util.VisualContainerUtils,n=e.visualHost;i.createVisualValidatorService=r;var a=(function(){function t(e,t,i,r,o,n){this.featureSwitchService=e,this.visualPlugin=t,this.scriptVisuals=i,this.shell=r,this.localizationService=o,this.trustedVisual=n}return t.prototype.validate=function(i){if(o.isScriptVisual(i,this.visualPlugin)){var r=this.scriptVisuals.getScriptVisualErrorDetails();if(r)return{details:r,code:this.shell.areScriptVisualsApproved()?"ScriptVisualError":"ScriptVisualsNotEnabled"}}var a=o.getVisualType(i);if(a){var s=this.visualPlugin.getPlugin(a);if(s&&s.apiVersion&&!e.extensibility.visualApiVersions.some((function(e){return e.version===s.apiVersion}))){var r={message:this.localizationService.get("CustomVisualApiVersionNotSupported"),displayableErrorInfo:[]};return{details:r,code:"CvApiVersionNotSupported"}}if(this.trustedVisual.isTrustedVisual(a)){var l=this.trustedVisual.validate(a);if(l)return{details:l,code:"TrustedVisualError"}}else{if(this.visualPlugin.isCustomVisual(a)&&!this.featureSwitchService.featureSwitches.customVisuals){var r=t.buildErrorDetails(this.localizationService.get("VisualContainer_CustomVisualDisabledMessage"),this.localizationService.get("VisualContainer_CustomVisualDisabledKey"),this.localizationService.get("VisualContainer_CustomVisualDisabledValue"));return{details:r,code:"UnsupportedVisual"}}if(!this.visualPlugin.getPlugin(a)&&!this.visualPlugin.isCustomVisual(a)){var r=t.buildErrorDetails(this.localizationService.get("VisualContainer_UnableToFindVisualMessage"),this.localizationService.get("VisualContainer_UnableToFindVisualKey"),this.localizationService.get("VisualContainer_UnableToFindVisualValue"));return{details:r,code:"UnsupportedVisual"}}if(n.utils.shouldDisableVisual(a,e.common.localize.shouldDisableMap())){var r=t.buildErrorDetails(this.localizationService.get("VisualContainer_NotSupportedForLocaleMessage"),this.localizationService.get("VisualContainer_NotSupportedForLocaleKey"),this.localizationService.get("VisualContainer_NotSupportedForLocaleValue"));return{details:r,code:"NotSupportedForLocale"}}}}},t.buildErrorDetails=function(e,t,i){return{message:e,displayableErrorInfo:[{errorInfoKey:t,errorInfoValue:i}]}},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.sectionStatus.currentSectionNumber;return t<0&&e.exploration.sections.length>0&&(t=0),e.exploration.sections[t]}var o=e.explore.services.selectionUtils,n=e.visualHost.ResourcePackageReferenceResolver,a=(function(){function a(){}return a.createUndoRedoHandler=function(a,s,l,c,u,p,d,h,v,g,f){return{takeSnapshot:function(t){var i=r(a).contract.name,o=e.explore.services.selectionUtils.getSelectedVisuals(l),n=[];if(o)for(var s=a.exploration.exploreCanvas.visualContainers,v=0,g=o;v<g.length;v++)for(var f=g[v],m=0;m<s.length;m++)if(f===s[m].contract){n.push(m);break}var y,w={withVisibility:!0,withTransientPages:!0},S=c("drillToDetails").getContext();y=t&&null!=t.canvasLayout?t.canvasLayout:u&&u.getCurrentLayout();var b=p.serializeExploration(a.exploration.contract,w);return{contract:b,linguisticSchema:h.getSchema(a.exploration.contract.reportId),selectedSlide:i,selectedVisualsIndex:n,drillToDetailsState:S?S.toSnapshot(d):void 0,canvasLayout:y,getReferences:function(){var e=p.deserializeExploration(b,[],!0);return p.getReferencedRegisteredResources(e)}}},rollback:function(m){c("drillToDetails").clearContext();var y=p.deserializeExploration(m.contract,[],!0),w=p.getReferencedRegisteredResources(y);f.restoreReferences(_.map(w,(function(e){return e.name}))).then((function(){var p=d.getCurrentExploration();if(p){var f=n.getRegisteredResourcePackage(p.resourcePackages);if(!f||_.isEmpty(f.items)){var w=n.getRegisteredResourcePackage(y.resourcePackages);w&&(w.items=[])}else{var w=i.ResourcePackageUtils.ensureRegisteredResourcePackage(y);w.items=_.map(f.items,(function(e){return _.clone(e)}))}}g.removeAllCustomVisuals();var S=_.filter(y.resourcePackages,(function(e){return 0===e.type}));g.ensurePlugins(S).finally((function(){v.publishToChannel(t.services.events.visualPluginsChanged)}));var b=t.SectionUtils.findSectionIndexForSectionName(y,m.selectedSlide);a.sectionStatus.currentSectionNumber=b,a.exploration=t.viewModels.ViewModelFactory.convertExploration(y,m.canvasLayout,b),h.setSchema(y.reportId,m.linguisticSchema);var C=r(a);d.loadExploration(a.exploration.contract),
d.goto(C.contract),s((function(){var t=a.exploration.exploreCanvas.visualContainers,i=[];if(m.selectedVisualsIndex.length>0){for(var r=0,n=m.selectedVisualsIndex;r<n.length;r++){var s=n[r];t.length>s&&i.push(t[s].contract)}o.selectVisualContainers(i,l),m.drillToDetailsState&&c("drillToDetails").setContext(e.requireSync("ExploreUI/services/drillToDetails").snapshotToContext(m.drillToDetailsState,d))}else l.clearSelection();u.changeFormFactor(m.canvasLayout,a)}),0)}))}}},a})();i.ExploreUndoRedoHandlerUtility=a})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),angular.module("powerbi.explore").run(["$templateCache",function(e){e.put("components/accessibilityInfo/accessibilityInfo.html",'<div class="accessibility-info accessibility-info-collapsed"><a localize="AccessibilityInfo_Link" target="_blank" href=\'https://go.microsoft.com/fwlink/?linkid=852575\'></a><a href="javascript:void(0)" localize="AccessibilityInfo_SkipToContent" accessible-click="$ctrl.skipToContent()" role="button"></a><span tabindex="0" localize=\'AccessibilityInfo_KeyInfo\' localize-fragments><span fragment-index="0" localize=\'HotkeyDialog_Help\'></span></span></div>'),e.put("components/boxGrid/boxGrid.html",'<triggered-recompile trigger="$ctrl.viewModel"><svg class="box-grid" ng-attr-width="{{::$ctrl.getSvgWidth()}}" ng-attr-height="{{::$ctrl.getSvgHeight()}}"><g ng-repeat="row in ::$ctrl.getRows()"><rect ng-repeat="column in ::$ctrl.getColumns()" ng-attr-width="{{::$ctrl.getBoxWidth()}}" ng-attr-height="{{::$ctrl.getBoxHeight()}}" ng-attr-x="{{::$ctrl.getBoxX(column)}}" ng-attr-y="{{::$ctrl.getBoxY(row)}}"></rect></g></svg></triggered-recompile>'),e.put("components/canvasVisualErrorOverlay/canvasVisualErrorOverlay.html",'<div class="errorMessage"><div ng-switch="$ctrl.errorInfo.overlayType"><div class="glyphicon pbi-glyph-error glyph-med" ng-switch-default></div><div class="glyphicon pbi-glyph-blockedsite glyph-med" ng-switch-when="1"></div></div><div><span class="errorSpan" ng-bind="$ctrl.errorInfo.details.message" ng-show="$ctrl.showErrorMessage"/><ng-switch on="$ctrl.errorInfo.details.errorType"><a localize="VisualContainer_ShowErrorDetails" localize-tooltip="VisualContainer_ShowErrorDetails" class="errorSeeMore" href ng-click="$ctrl.showErrorDetails()" ng-if="!$ctrl.errorInfo.hideSeeDetails" ng-switch-default/><a localize="LearnMore" localize-tooltip="VisualContainer_LearnMoreLinkText" class="errorSeeMore" ng-href="{{ $ctrl.errorInfo.details.helpLink }}" target="_blank" ng-switch-when="1"/></ng-switch></div><div class="fixThisContainer"> <button class="primary" ng-show="$ctrl.isFixButtonVisible" ng-click="$ctrl.fixErrors() "><ng-switch on="$ctrl.errorInfo.fixableError"><span ng-switch-when="1" localize="Fix_This" localize-tooltip="FixReferences_ToolTip"></span><span ng-switch-when="2" localize="Fix_This" localize-tooltip="RelationshipDetection_Tooltip"></span><span ng-switch-when="3" localize="Fix_This" localize-tooltip="FixReferences_ToolTip"></span><span ng-switch-when="4" localize="VisualContainer_EnableScriptVisuals"></span></ng-switch></button></div></div>'),e.put("components/conditionalFormattingDialog/conditionalFormattingDialog.html",'<form name="conditionalFormattingForm"><dialog-frame><dialog-header><span>{{$ctrl.viewModel.dialogTitle}}</span></dialog-header><dialog-body><p class="description">{{$ctrl.viewModel.dialogDescription}}</p><section><fieldset><legend localize="ConditionalFormattingDialog_BaseValueHeader"></legend><h2 class="displayNameSelectItem" ng-bind="::$ctrl.viewModel.baseExprDisplayName"></h2></fieldset></section><section class="sectionSettings"><fieldset><legend localize="ConditionalFormattingDialog_FormatNull" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.nullStrategyOption" ng-options="element.value for element in ::$ctrl.viewModel.nullStrategyOptions track by element.id"/><color-picker class="whiteTheme" color="$ctrl.viewModel.gradientSettings.nullColor" on-change-color="$ctrl.updateGradientNullColor" type="::$ctrl.viewModel.colorPickerType" ng-style="{\'visibility\': $ctrl.viewModel.nullStrategyOption.disableInput ? \'hidden\' : \'visible\'}"></color-picker></section></fieldset></section><section class="sectionSettings"><fieldset><legend localize="ConditionalFormattingDialog_MinimumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.minimumSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.minimumSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.minimumSelectOptions track by element.id"/><color-picker class="whiteTheme" color="$ctrl.viewModel.gradientSettings.minColor" on-change-color="$ctrl.updateGradientMinColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.minimumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.minimumSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.minValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_LowestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_LowestValuePlaceHolder"/></fieldset><fieldset ng-if="$ctrl.viewModel.gradientSettings.diverging"><legend localize="ConditionalFormattingDialog_CenterHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.centerSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.centerSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.centerSelectOptions track by element.id"/><color-picker class="whiteTheme" color="$ctrl.viewModel.gradientSettings.midColor" on-change-color="$ctrl.updateGradientMidColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.centerSelectedOption.disableInput" ng-required="!$ctrl.viewModel.centerSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.midValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_MiddleValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_MiddleValuePlaceHolder"/></fieldset><fieldset><legend localize="ConditionalFormattingDialog_MaximumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.maximumSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.maximumSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.maximumSelectOptions track by element.id"/><color-picker class="whiteTheme" color="$ctrl.viewModel.gradientSettings.maxColor" on-change-color="$ctrl.updateGradientMaxColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.maximumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.maximumSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.maxValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_HighestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_HighestValuePlaceHolder"/></fieldset></section><section class="checkBoxSettings"> <input type="checkbox" id="divergingCheckbox" ng-model="$ctrl.viewModel.gradientSettings.diverging" ng-change="$ctrl.updateGradientBar()" onclick="event.stopPropagation()"/><label for="divergingCheckbox" onclick="event.stopPropagation()"/><h2 localize="ConditionalFormattingDialog_Diverging" ng-click="$ctrl.updateDiverging()"></h2></section><section class="gradientValue"><gradient-bar ng-model="$ctrl.viewModel.gradientBarValue"></gradient-bar></section></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="conditionalFormattingForm.$valid && $ctrl.apply()" class="actionButton primary" localize="OK_ButtonText"></button> <button class="cancel" autofocus localize="Cancel_ButtonText" ng-click="$ctrl.cancel()"></button></dialog-footer></dialog-frame></form>'),e.put("components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",'<conditional-formatting-dialog view-model="viewModel"></conditional-formatting-dialog>'),e.put("components/dataBarsDialog/dataBarsDialog.html",'<form name="dataBarsForm"><dialog-frame><dialog-header><span localize="Visual_ConditionalFormatting_DataBars"></span></dialog-header><dialog-body><p class="description" localize="Visual_ConditionalFormatting_DataBars_Desc"></p><section><fieldset><legend localize="ConditionalFormattingDialog_BaseValueHeader"></legend><h2 class="displayNameSelectItem" ng-bind="::$ctrl.viewModel.fieldDisplayName"></h2></fieldset></section><section class="checkBoxSettings"> <input type="checkbox" id="hideTextCheckbox" ng-model="$ctrl.viewModel.hideText" onclick="event.stopPropagation()"/><label for="hideTextCheckbox" onclick="event.stopPropagation()"/><h2 localize="DataBarsDialog_HideText" ng-click="$ctrl.viewModel.hideText = !$ctrl.viewModel.hideText"></h2></section><section class="sectionSettings"><fieldset><legend localize="ConditionalFormattingDialog_MinimumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.minimumSelectedOption" ng-options="element.value for element in ::$ctrl.viewModel.minimumSelectOptions track by element.id"/></section> <input type="number" ng-disabled="$ctrl.viewModel.minimumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.minimumSelectedOption.disableInput" ng-model="$ctrl.viewModel.minValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_LowestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_LowestValuePlaceHolder"/></fieldset><fieldset><legend localize="ConditionalFormattingDialog_MaximumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.maximumSelectedOption" ng-options="element.value for element in ::$ctrl.viewModel.maximumSelectOptions track by element.id"/></section> <input type="number" ng-disabled="$ctrl.viewModel.maximumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.maximumSelectedOption.disableInput" ng-model="$ctrl.viewModel.maxValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_HighestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_HighestValuePlaceHolder"/></fieldset></section><section class="sectionSettings"><fieldset><legend localize="DataBarsDialog_PositiveBar" localize-tooltip></legend><color-picker class="whiteTheme colorpicker-left" color="$ctrl.viewModel.positiveColor.solid.color" on-change-color="$ctrl.updatePositiveColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></fieldset><fieldset><legend localize="DataBarsDialog_BarDirection" localize-tooltip></legend> <select ng-model="$ctrl.viewModel.barDirectionOption" ng-options="element.value for element in ::$ctrl.viewModel.barDirectionOptions track by element.id"/></fieldset></section><section class="sectionSettings"><fieldset><legend localize="DataBarsDialog_NegativeBar" localize-tooltip></legend><color-picker class="whiteTheme colorpicker-left" color="$ctrl.viewModel.negativeColor.solid.color" on-change-color="$ctrl.updateNegativeColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></fieldset><fieldset><legend localize="DataBarsDialog_BarAxis" localize-tooltip></legend><color-picker class="whiteTheme" color="$ctrl.viewModel.axisColor.solid.color" on-change-color="$ctrl.updateAxisColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></fieldset></section></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="dataBarsForm.$valid && $ctrl.apply()" class="actionButton primary" localize="OK_ButtonText"></button> <button class="cancel" autofocus localize="Cancel_ButtonText" ng-click="$ctrl.cancel()"></button></dialog-footer></dialog-frame></form>'),e.put("components/dataBarsDialog/dataBarsDialogDefinition.html",'<databars-dialog view-model="viewModel"></databars-dialog>'),e.put("components/dateTimePicker/dateTimePicker.html",'<div class="datetimePicker" pbi-lazy-load-contents="$ctrl.moduleConfig"> <input type="text" class="inputFieldInSlice" ng-blur="$ctrl.dateTextUpdated()" ng-model="$ctrl.textVal" ng-class="{\'ng-invalid\': $ctrl.inputInvalid}" placeholder="{{::$ctrl.placeholder}}"/> <button class="calendar" type="button" dropdown-overlay-invoke="calendar"></button><dropdown-overlay class="calendarDropDown" dropdown-overlay-name="calendar"><datepicker class="calendar" ng-model="$ctrl.dateVal" ng-change="$ctrl.dateSelected()" onclick="event.stopPropagation()" show-weeks="false" min-date="$ctrl.validators.min" max-date="$ctrl.validators.max"></datepicker></dropdown-overlay></div>'),e.put("components/dotGrid/dotGrid.html",'<div class="container"><div class="hideEdgeDots"><div class="background"></div></div></div>'),e.put("components/explorationFooter/explorationFooter.html",'<div class="explorationNavigationContent unselectable {{$ctrl.getModeString()}}" tabindex="0" focus-group="ctrl-F6"><div class="background"></div><ul ng-if="!$ctrl.isBookmarkView()" class="pane sections" role="tablist"><carousel auto-resize="true"><li class="section static" ng-if="$ctrl.isEditMode()" ng-class="{\'selected\' : page.selected}" ng-repeat="page in $ctrl.viewModel.exploration.sections"><exploration-navigation-tab class="section dynamic" view-model="page" is-editing="true" tab-index="$index" ng-style="page.style" is-only-tab="$ctrl.viewModel.exploration.sections.length === 1"></exploration-navigation-tab></li><li class="section static" ng-if="!$ctrl.isEditMode()" ng-class="{selected : page.selected}" ng-repeat="page in $ctrl.viewModel.exploration.sections"><exploration-navigation-tab class="section dynamic" view-model="page" is-editing="false" tab-index="$index" ng-style="page.style"></exploration-navigation-tab></li></carousel><li ng-if="$ctrl.isEditMode()" class="section static create" ng-click="$ctrl.createSection()" localize-tooltip="Carousel_NewPage"><div class="thumbnail-container"><div class="thumbnail"></div></div></li></ul><ul ng-if="$ctrl.isBookmarkView()" class="pane sections" pbi-lazy-load-contents="$ctrl.exploreUIShellConfig"><bookmark-play bookmarks="$ctrl.viewModel.exploration.contract.bookmarks" selected-index="$ctrl.viewModel.exploration.contract.activeBookmarkIndex"></bookmark-play></ul></div>'),e.put("components/includeExcludeFilter/includeExcludeFilter.html",'<div class="cardHeader"><i ng-if="::$ctrl.filterViewModel.invalid" class="filterPaneIcon error"/><span class="caption trimmedTextWithEllipsis item-fill" ng-bind="$ctrl.viewModel.restatement"></span> <button class="fieldWellIcon dropDown item-auto" ng-class="$ctrl.isExpanded ? \'expand\' : \'collapse\'" ng-click="$ctrl.expand()"></button> <button class="delete glyphicon pbi-glyph-close glyph-micro item-auto" ng-click="$ctrl.deleteFilter($event, filterViewModel)" localize-tooltip="FilterPane_DeleteFilter"></button></div><div class="include-exclude-filter-items" ng-if="$ctrl.isExpanded"><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><div class="include-exclude-filter-item flex" ng-repeat="dataPoint in $ctrl.viewModel.points"><div class="smallFontSize trimmedTextWithEllipsis unselectable item-fill" ng-bind-attr="{title: dataPoint.text}" ng-bind="dataPoint.text"></div> <button type="button" class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="$ctrl.delete($event, dataPoint, $index)"></button></div></ng-scrollbars></div>'),e.put("components/mobileVisualizationPane/mobileVisualizationPane.html",'<article class="sidePane rightSidePane visualizationPane smallFontSize"><div class="paneHeader"><div class="toggleBtn"><h2 class="sidePaneHorizontalTitle unselectable sidePaneTitle largeFontSize trimmedTextWithEllipsis" localize="VisualizationPane_Title"></h2><div class="paneClearButton" ng-click="$ctrl.clearAllVisualsFromCanvasPressed()"><div class="glyphicon pbi-glyph-eraser glyph-mini"></div><h2 class="paneClearTitle unselectable smallFontSize" localize="RemoveAllVisuals_Title"></h2></div></div></div><div class="paneContents flex"><div class="sectionHost item-fill"><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><ul><visual-container-thumbnail ng-repeat="visual in $ctrl.visuals" visual="visual" viewport="$ctrl.viewport" drag="visual-container-thumbnail" drag-context="{ source: visual }"></visual-container-thumbnail></ul></ng-scrollbars></div></div></article>'),e.put("components/penAnnotation/penAnnotation.html",'<canvas class="penAnnotationCanvas"></canvas>'),e.put("components/relativeDateFilter/relativeDateFilter.html",'<form name="$ctrl.filterForm" class="relativeDateFilter" ng-submit="$ctrl.applyFilter()" ng-class="{ invalid: $ctrl.viewModel.cardType.invalid }"><h3 class="description" localize="RelativeDateFilter_ShowItems"></h3><div class="relativeDateFilterSettings"> <select class="filterInput" ng-model="$ctrl.vm.relativeQualifier" ng-change="$ctrl.vm.onRelativeQualifierChanged()" ng-options="qualifier.text for qualifier in ::$ctrl.vm.relativeQualifiers track by qualifier.value"/> <input class="filterInput" type="number" ng-if="$ctrl.vm.isDurationApplicable()" ng-model="$ctrl.vm.duration" title="{{\'1-\'+$ctrl.vm.getDurationMax()}}" ng-min="1" ng-max="$ctrl.vm.getDurationMax()"/> <select class="filterInput" ng-if="$ctrl.vm.isDurationApplicable()" ng-model="$ctrl.vm.relativeUnit" ng-options="unit.text for unit in ::$ctrl.vm.relativeUnitsAll track by unit.value"/> <select class="filterInput" ng-if="!$ctrl.vm.isDurationApplicable()" ng-model="$ctrl.vm.relativeUnit" ng-options="unit.text for unit in ::$ctrl.vm.relativeUnitsCurrent track by unit.value"/><div class="footerSection" ng-if="$ctrl.vm.isIncludeTodayApplicable()"> <input type="checkbox" id="includeTodayCheckbox" onclick="event.stopPropagation()" ng-model="$ctrl.vm.includeToday"/><label for="includeTodayCheckbox" localize="RelativeDateFilter_IncludeToday" onclick="event.stopPropagation()"/></div></div> <button type="submit" class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.canApplyFilter()"/></form>'),e.put("components/tableViewDialog/tableViewDialog.html",'<dialog-frame><dialog-header><span localize="$ctrl.titleKey"></span></dialog-header><dialog-body><section class="table" ng-if="::($ctrl.columnNames && $ctrl.columnNames.length> 0) || ($ctrl.tableValues && $ctrl.tableValues.length > 0)"><div class="tableViewDialogOverflow"><table><thead ng-if="::($ctrl.columnNames && $ctrl.columnNames.length> 0)"><tr><th ng-repeat="th in ::$ctrl.columnNames track by $index" ng-bind="::th"></th></tr></thead><tbody ng-if="::($ctrl.tableValues && $ctrl.tableValues.length> 0)"><tr ng-repeat="tr in ::$ctrl.tableValues track by $index"><td ng-repeat="td in ::tr track by $index" ng-bind="::td"></td></tr></tbody></table></div></section></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="$ctrl.close()" class="primary" localize="TableViewDialog_CloseButtonText"></button></dialog-footer></dialog-frame>'),e.put("components/tableViewDialog/tableViewDialogDefinition.html",'<table-view-dialog title-key="titleKey" column-names="columnNames" table-values="tableValues"></table-view-dialog>'),e.put("components/topNFilter/topNFilter.html",'<form name="$ctrl.topNFilterForm" class="topNFilter" ng-submit="$ctrl.applyFilter()" ng-class="{ invalid: $ctrl.viewModel.cardType.invalid }"><pbi-alert ng-if="$ctrl.viewModel.cardType.invalid" kind="\'warning\'" message-warning="\'TopNFilter_SingleTopNAllowedWarning\'"></pbi-alert><fieldset class="filterOptions" ng-disabled="$ctrl.viewModel.cardType.invalid"><legend localize="TopNFilter_ShowItems"></legend><div class="topNSelector topNInputArea flex"> <select class="item-fill topNInputBox" ng-options="filterType.text for filterType in ::$ctrl.vm.filterTypes track by filterType.text" ng-model="$ctrl.vm.targetType"/> <input class="item-fill topNInputBox" type="number" ng-pattern="/^[1-9][0-9]{0,6}$/" ng-model="$ctrl.vm.itemCount"/></div></fieldset><fieldset class="orderBy" ng-disabled="$ctrl.viewModel.cardType.invalid"><legend localize="TopNFilter_Value"></legend><div class="topNInputArea ui-droppable dropzone topNInputBox" ng-class="{filled: $ctrl.vm.orderByDisplayName}" drop="$ctrl.dropConfig" drop-handler="$ctrl.dropFilterTarget()" drop-action="$ctrl.getDropAction()"><div class="flex orderByPill" ng-if="$ctrl.vm.orderByDisplayName"><span class="displayName trimmedTextWithEllipsis item-fill" ng-bind="$ctrl.vm.orderByDisplayName"></span> <button ng-if="$ctrl.vm.availableAggregates.items.length> 0" class="fieldWellIcon dropDown item-auto" type="button" ng-click="$ctrl.showContextMenu($event)"></button><pbi-button ng-click="$ctrl.removeOrderBy()" class="removeOrderBy" kind="icon" icon-name="close" icon-size="micro"></pbi-button></div><div class="dragHereWatermark trimmedTextWithEllipsis" localize="FieldDropZone_Watermark" ng-if="!$ctrl.vm.orderByDisplayName"></div></div></fieldset> <button type="submit" class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.canApplyFilter()"/></form>'),e.put("components/visualContainerDrill/visualContainerDrill.html",'<span localize="Drill_On" ng-if="$ctrl.canDrillOnMoreThanOneRole()"></span><select focus-element ng-model="$ctrl.activeRole" ng-options="role.value for role in ::$ctrl.drillableRoles track by role.name" ng-change="$ctrl.onRoleChanged()" ng-click="$event.stopPropagation()" ng-if="$ctrl.canDrillOnMoreThanOneRole()"/> <button focus-element class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-drillup" ng-click="$ctrl.drillUp()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillUp" localize-tooltip="DrillUp_ToolTip"></button> <button focus-element aria-label="{{$ctrl.drillLevelTitle()}}" class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-expand" ng-click="$ctrl.drillDownLevel()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillDownWithoutCurrentGroup" title="{{$ctrl.drillLevelTitle()}}"></button> <button focus-element aria-label="{{$ctrl.drillLevelGroupedTitle()}}" class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-inline-drill" ng-click="$ctrl.drillDownLevelGrouped()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillDownWithCurrentGroup" title="{{$ctrl.drillLevelGroupedTitle()}}"></button>'),e.put("components/visualContainerDrillToggle/visualContainerDrillToggle.html",'<button focus-element class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-drilldowndisabled" ng-class="{\'pbi-glyph-drilldownenabled\': $ctrl.isDrillDownEnabled }" ng-click="$ctrl.toggleDrillDown()" ng-if="$ctrl.canDrillDown" title="{{$ctrl.title}}"></button>'),e.put("components/visualContainerHeader/visualContainerHeader.html",'<div class="vcHeader" focus-group=\'alt-shift-F10 scoped\'><div class="iconContainer"><canvas-visual-header-icon ng-if="$ctrl.visual.warningInfo" details="$ctrl.visual.warningInfo.details" icon-type="\'warning\'" ng-click="$ctrl.showWarningDetails()"></canvas-visual-header-icon><canvas-visual-header-icon ng-if="$ctrl.visual.transformWarningInfo" details="$ctrl.visual.transformWarningInfo.details" icon-type="\'error\'" ng-click="$ctrl.showTransformWarningDetails()" show-by-default="true"></canvas-visual-header-icon><canvas-visual-header-icon ng-if="$ctrl.visual.visualInfo" details="$ctrl.visual.visualInfo.details" icon-type="\'info\'" ng-click="$ctrl.showInfoDetails()"></canvas-visual-header-icon></div><visual-container-drill visual="::$ctrl.visual"></visual-container-drill><i class="dragGrip glyphicon pbi-glyph-gripperbarhorizontal glyph-small"></i><div class="optionsMenu"><visual-container-relationship-filters class="optionSection visualRelationshipFilters" visual="::$ctrl.visual" on-visual-container-changed="$ctrl.onVisualContainerChanged()" ng-if="$ctrl.canSetVisualRelationshipFilterAction()"></visual-container-relationship-filters><visual-container-drill-toggle class="optionSection" visual="::$ctrl.visual"></visual-container-drill-toggle><visual-container-pin-button class="optionSection" visual="::$ctrl.visual" disable-pin="$ctrl.disablePin"></visual-container-pin-button><div class="optionSection"> <button class="vcPopOutBtn" ng-click="$ctrl.popOutVisualContainer()" focus-element ng-if="$ctrl.canPopOut()" localize-tooltip="FocusModeVisual_ToolTip"><i class="glyphicon pbi-glyph-miniexpand glyph-small"></i></button> <button class="toggleSeeDataLayout" ng-click="$ctrl.toggleSeeDataLayout()" focus-element ng-if="$ctrl.visual.contract.visibility === 2" title="{{$ctrl.getSeeDataLayoutTitle()}}"><i class="glyphicon pbi-glyph-rotatevertical glyph-small" ng-class="{ \'pbi-glyph-rotatevertical\': $ctrl.visual.contract.detailVisualLayout !== 2, \'pbi-glyph-rotatehorizontal\': $ctrl.visual.contract.detailVisualLayout === 2 }"></i></button><visual-container-options-menu menu-id="::$ctrl.menuId" visual="::$ctrl.visual" menu-options="::$ctrl.menuOptions" ng-if="$ctrl.menuOptions.hasMoreOptions"></visual-container-options-menu></div></div></div>'),e.put("components/visualContainerPinButton/visualContainerPinButton.html",'<button focus-element class="vcPinBtn" ng-disabled="$ctrl.disablePin" ng-click="$ctrl.pinVisualContainer($event)" ng-show="$ctrl.showPin()" ng-if="$ctrl.canPin()" title="{{$ctrl.getPinTileTitle()}}"><i class="glyphicon pbi-glyph-pinned glyph-small"></i></button>'),e.put("components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",'<button class="glyphicon glyph-small alwaysVisible" focus-element ng-if="$ctrl.supportsVisualRelationshipFilterAction(1)" ng-class="{ \'pbi-glyph-filterfilled\': $ctrl.filterAction === 1,  \'pbi-glyph-filter\': $ctrl.filterAction !== 1}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 1)" localize-tooltip="VisualRelationships_DataFilter"></button> <button class="glyphicon glyph-small alwaysVisible" focus-element ng-if="$ctrl.supportsVisualRelationshipFilterAction(2)" ng-class="{ \'pbi-glyph-crosshighlightfilled\': $ctrl.filterAction === 2,  \'pbi-glyph-crosshighlight\': $ctrl.filterAction !== 2}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 2)" localize-tooltip="VisualRelationships_HighlightFilter"></button> <button class="glyphicon glyph-small alwaysVisible" focus-element ng-if="$ctrl.supportsVisualRelationshipFilterAction(3)" ng-class="{ \'pbi-glyph-disablefilled\': $ctrl.filterAction === 3, \'pbi-glyph-disable\': $ctrl.filterAction !== 3}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 3)" localize-tooltip="VisualRelationships_NoFilter"></button>'),e.put("components/visualOptionsMenu/visualContainerOptionsMenu.html",'<button focus-element class="vcMenuBtn" type="button" ng-click="$ctrl.showOptionsMenu($event)" localize-tooltip="Options_Menu"><i class="glyphicon pbi-glyph-more glyph-small"></i></button>'),e.put("views/advancedFilter.html",'<li class="advanced"><h3 class="description" localize="AdvancedFilter_Description"/><div ng-repeat="condition in advFilterCard.conditions"> <select class="comparisonOperator advancedControl" ng-model="condition.operator" ng-change="markDirty()" ng-disabled="viewModel.readOnlyState.disabled" ng-options="operatorInfo.value as operatorInfo.label for operatorInfo in advFilterCard.operators"/><div class="advancedControl conditionValue flex" ng-if="!advFilterCard.isDateTime" ng-show="condition.valueRequired"> <input type="text" class="item-fill" ng-model="condition.value.stringValue" ng-disabled="viewModel.readOnlyState.disabled" ng-focus="handleFocusedInputChanged($event, condition)" ng-blur="handleInputBlur()" ng-change="validateFilterInput(condition); markDirty();" fast-keyup="keyUp($event)"/><span class="errorIcon item-auto" ng-if="condition.isInvalid" tooltip tooltip-config="tooltipConfig"></span></div><section class="datetime datetimePicker" ng-if="advFilterCard.isDateTime" ng-show="condition.valueRequired" pbi-lazy-load-contents="moduleConfig"><div class="datePicker flex"> <input type="text" class="calendarInput item-fill" ng-blur="dateTextUpdateComplete(condition)" ng-change="dateTextUpdated(condition); markDirty();" ng-model="condition.value.value" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" fast-keyup="keyUp($event)"/> <button type="button" class="filterPaneIcon calendar item-auto" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" dropdown-overlay-invoke="calendar"></button><dropdown-overlay class="datetime calendarDropDown" dropdown-overlay-name="calendar"><datepicker class="calendar" ng-model="condition.value.dateValue" ng-disabled="!condition.valueRequired || viewModel.readOnlyState.disabled" ng-change="dateSelected(condition)" onclick="event.stopPropagation()" show-weeks="false"></datepicker></dropdown-overlay></div><timepicker class="timePicker" readonly-input="viewModel.readOnlyState.disabled" ng-model="condition.value.timePickerValue" ng-model-options="{ getterSetter: true }" ng-change="timeSelected(condition)"></timepicker></section><section class="logicalOperator advancedControl" ng-if="$index < (advFilterCard.conditions.length -1)"> <label class="logicalOperatorField"><input type="radio" ng-model="advFilterCard.logicalOperator" ng-value="advFilterCard.logicalAndOperator" ng-disabled="viewModel.readOnlyState.disabled" ng-change="markDirty()" ng-checked="advFilterCard.logicalOperator === advFilterCard.logicalAndOperator"/><span localize="Logical_And_Operator"/></label> <label class="logicalOperatorField"><input type="radio" ng-model="advFilterCard.logicalOperator" ng-value="advFilterCard.logicalOrOperator" ng-disabled="viewModel.readOnlyState.disabled" ng-change="markDirty()" ng-checked="advFilterCard.logicalOperator === advFilterCard.logicalOrOperator"/><span localize="Logical_Or_Operator"/></label></section></div> <button class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-click="applyFilter()" ng-disabled="!canApplyFilter()"/></li>'),e.put("views/canvasVisualHeaderIcon.html",'<button tooltip tooltip-config="$ctrl.tooltipConfigManager.getTooltipConfig()" ng-disabled="!$ctrl.isClickable()" ng-switch="$ctrl.iconType"><i class="infoIcon pbi-glyph-info glyphicon" ng-switch-when="info"></i><i class="warningIcon pbi-glyph-warning glyphicon" ng-switch-when="warning"></i><i class="errorIcon pbi-glyph-error glyphicon" ng-switch-when="error"></i></button>'),e.put("views/carousel.html",'<div class="carouselControl" fast-mouseenter="updateNavButtonVisibility()" on-resize="carouselResized()"> <button class="carouselNavButton previousPage" ng-click="scrollToPrevious()" localize-tooltip="Carousel_PreviousPages"><i class="glyphicon pbi-glyph-caretleft glyph-mini"></i></button> <button class="carouselNavButton nextPage" ng-click="scrollToNext()" localize-tooltip="Carousel_NextPages"><i class="glyphicon pbi-glyph-caretright  glyph-mini"></i></button><div class="carouselScrollPane" ng-transclude></div></div>'),e.put("views/convertTableDialog.html",'<div><div class="title" localize="ConvertTableDialog_Title"></div><div class="header" localize="ConvertTableDialog_Header"></div><div class="imageContainer"><div class="image"></div></div><div class="content"><div localize=\'ConvertTableDialog_TableDetected\'></div><br><div localize=\'ConvertTableDialog_NewFeatures\'></div><ul class="newFeatures"><li class="feature" localize="ConvertTableDialog_NewFeature1"></li><li class="feature" localize="ConvertTableDialog_NewFeature2"></li><li class="feature" localize="ConvertTableDialog_NewFeature3"></li></ul></div><a class="learnMore" href=\'https://go.microsoft.com/fwlink/?linkid=840927\' target=\'_blank\' localize="ConvertTableDialog_LearnMore"></a><div class="gotItContainer"> <button class="gotIt" localize="TutorialPopup_GotIt" ng-click="onGotIt()"></button></div></div>'),e.put("views/deleteVisualWarningDialog.html",'<div><div class="warningMessage"> {{::deleteVisualWarningText}}</div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="deleteVisual()">{{::deleteVisualButtonText}}</button> <button class="btn button" ng-click="closeDialog()" localize="DeleteVisual_Cancel"></button></div></div>'),
e.put("views/detailVisual.html",'<div class="detailVisual" role="document" focus-group aria-live="polite" ng-switch="viewModel.hasData"><visual focus-element view-model="viewModel.visual" ng-switch-when="true"></visual><div class="noDataOverlay" ng-switch-when="false"></div></div>'),e.put("views/dropdowns/appBarEditReportMenu.html",'<dropdown-overlay dropdown-overlay-name="editReportMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="dropdown-item" ng-mousedown="menuActionSelected(item); $event.stopPropagation();" ng-disabled="item.disabled"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}}"></i><div class="dropdown-label" ng-bind="::item.text"></div><div class="dropdown-description" title="{{::item.tooltip}}" ng-bind="::item.description"></div></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/appBarExploreMenu.html",'<dropdown-overlay dropdown-overlay-name="exploreMenu"><ul class="angular-dropdown explorationAppBarMenu explore active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="dropdown-item explore" ng-class="{\'selected\': item.selected}" ng-disabled="item.disabled" ng-mousedown="menuActionSelected(item); $event.stopPropagation();"><a href="" target="_blank" role="menuitem"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}} glyph-small"></i><div class="dropdown-label" ng-bind="::item.text"></div></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/appBarFileMenu.html",'<dropdown-overlay dropdown-overlay-name="fileMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" ng-if="::item.show" class="dropdown-item" ng-mousedown="menuActionSelected(item); $event.stopPropagation();" ng-disabled="item.disabled"><a href="" target="_blank" role="menuitem"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}}"></i><div class="dropdown-label" ng-bind="::item.text"></div><div class="dropdown-description" title="{{::item.tooltip}}" ng-bind="::item.description"></div></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/appBarMoreOptionsMenu.html",'<dropdown-overlay dropdown-overlay-name="reportMoreOptionsMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="dropdown-item moreOptions" ng-class="{\'selected\': item.selected}" ng-mousedown="menuActionSelected(item); $event.stopPropagation();"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><div class="dropdown-label" ng-bind="::item.text"></div></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/appBarViewMenu.html",'<dropdown-overlay dropdown-overlay-name="viewMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="themeYellowDark dropdown-item view-menu" ng-class="{\'selected\': item.selected, \'dropdown-separator\': item.type === 2}" ng-disabled="item.disabled" ng-mousedown="menuActionSelected(item); $event.stopPropagation(); $event.preventDefault() "><a href="" target="_blank" role="menuitem"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}} glyph-small"></i><div class="dropdown-label" ng-bind="::item.text"></div><pbi-toggle ng-if="item.checkbox" ng-model="item.checked" no-label on-state-text="ToggleSwitchOn" off-state-text="ToggleSwitchOff"></pbi-toggle></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/visualContainerOptionsMenu.html",'<dropdown-overlay focus-group dropdown-overlay-name="visualContainerOptionsMenu" class="vcOptionsMenu"><ul><li focus-element ng-if="menuOptions().canSearch" accessible-click="toggleSearch();" class="trimmedTextWithEllipsis toggle" ng-class="{\'selected\': isSearchOn() }" tabindex="1"><i class="itemIcon glyphicon pbi-glyph-search glyph-small"></i><span class="itemLabel trimmedTextWithEllipsis" localize="Slicer_SearchBox_Text"></span></li><li focus-element ng-if="menuOptions().canEdit" accessible-click="enterAdvancedEditMode();" class="trimmedTextWithEllipsis" tabindex="1"><i class="itemIcon glyphicon pbi-glyph-edit glyph-mini"></i><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Edit_ToolTip" localize="Edit_ToolTip"></span></li><li focus-element ng-if="menuOptions().canExport" accessible-click="exportVisualData();" class="trimmedTextWithEllipsis" tabindex="1"><i class="itemIcon glyphicon pbi-glyph-export glyph-small"></i><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="ExportData_MenuItem" localize="ExportData_MenuItem"></span></li><li focus-element ng-if="menuOptions().canSeeData" accessible-click="seeData();" class="trimmedTextWithEllipsis" tabindex="1"><i class="itemIcon glyphicon pbi-glyph-seedata glyph-small"></i><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="VisualContainer_SeeData_Enable" localize="VisualContainer_SeeData_Enable"></span></li><li focus-element ng-if="menuOptions().canDelete" accessible-click="deleteVisualContainer();" class="trimmedTextWithEllipsis" tabindex="1"><i class="itemIcon glyphicon pbi-glyph-close glyph-mini"></i><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Remove_ToolTip" localize="Remove_visual"></span></li><li focus-element ng-if="menuOptions().canCluster" accessible-click="getClusters();" class="trimmedTextWithEllipsis" tabindex="1"><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Visual_Cluster_FindGroups" localize="Visual_Cluster_FindGroups"></span></li><li focus-element ng-if="menuOptions().canSpatialCluster" accessible-click="getSpatialClusters();" class="trimmedTextWithEllipsis" tabindex="1"><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Visual_Cluster_FindGroups_Spatial" localize="Visual_Cluster_FindGroups_Spatial"></span></li><li focus-element ng-if="::menuOptions().canSpotlight" accessible-click="toggleSpotlight();" class="trimmedTextWithEllipsis toggle" ng-class="{ \'selected\': isSpotlightOn() }" tabindex="1"><i class="itemIcon glyphicon pbi-glyph-flashlight glyph-small"></i><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Spotlight" localize="Spotlight"></span></li><li class="sort toggle" ng-repeat="sortableField in menuOptions().sortSetting.sortableFields" ng-if="menuOptions().canSort" ng-class="{\'selected\': sortableField.active}" tabindex="1"> <button focus-element aria-labelledby="sortType" class="toggleSortBtn" ng-disabled="!sortableField.active || !actualSortDirection()" ng-click="toggleSort()"><ng-switch on="actualSortDirection()"><span id=\'sortType\' ng-switch-when="1" class="glyphicon pbi-glyph-atoz glyph-small" localize-tooltip="Sort_Desc"></span><span id=\'sortType\' ng-switch-when="2" class="glyphicon pbi-glyph-ztoa glyph-small" localize-tooltip="Sort_Asc"></span><span id=\'sortType\' ng-switch-default class="glyphicon pbi-glyph-atoz glyph-small" localize-tooltip="Sort_SortBy"></span></ng-switch></button><span focus-element localize="Sort_SortBy" accessible-click="toggleSort(sortableField)" class="caption itemLabel trimmedTextWithEllipsis" localize-fragments><span fragment-index="0" ng-bind="sortableField.displayName"></span></span></li><li class="trimmedTextWithEllipsis" ng-class="{\'separator\': menuItem.type === 1}" ng-repeat="menuItem in getCustomMenuItems()" tabindex="1"><ng-switch on="menuItem.type"><div ng-switch-when="0"> <span ng-if="!menuItem.icon" class="itemIcon">&nbsp;</span> <span ng-if="menuItem.icon" class="itemIcon"><img style="width: 80%; max-height: 100%" ng-src="menuItem.icon"/></span> <span focus-element class="itemLabel trimmedTextWithEllipsis" accessible-click="executeCustomCommand(menuItem.key)">{{menuItem.text || ""}}</span></div><hr ng-switch-when="1"/></ng-switch></li></ul></dropdown-overlay>'),e.put("views/embedModalDialog.html",'<div class="reportEmbed"><div ng-switch="viewModel.publishState"><div ng-switch-when="0"><span localize="Embed_ShowCodeTitle" class="title publishTitle"></span><div class="centeredSpinner" ng-show="viewModel.publishState == 0"><spinner modern></spinner></div></div><div ng-switch-when="1"><span localize="Embed_DialogTitle" class="title publishTitle"></span><div><span class="legalText regularText" localize="Embed_Warning_Public"></span><span class="legalText regularText" localize="Embed_Warning_Privacy"></span><span class="legalText regularText" localize="Embed_Warning_UpdateLiveReport"></span></div><div class="buttons"> <button localize="Embed_PublishToWeb" class="primary button embedCodeButton" ng-hide="viewModel.embedTab.generating || viewModel.embedTab.disabled || showEmbedCode()" ng-click="goToConfirmation()"></button> <button localize="Embed_PublishToWeb" class="primary button disabled embedCodeButton" ng-show="viewModel.embedTab.disabled && !showEmbedCode()"></button> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()" ng-show="viewModel.publishState==1"></button></div></div><div ng-switch-when="2"><span localize="Embed_DialogTitle" class="title publishTitle"></span><span class="legalText regularText" localize="Embed_LegalTitle"></span><span class="legalText regularText" localize="Embed_LegalText"></span><div ng-show="viewModel.embedTab.generating" class="loading"><i class="glyphicon pbi-spinner-large"></i><span localize="Embed_GeneratingEmbedCode" class="semiBoldBlackText loadingText"></span></div></div><div ng-if="viewModel.publishState == 3 || viewModel.publishState == 4"><span ng-if="viewModel.publishState == 3" localize="Embed_SuccessTitle" class="title successTitle"></span><span ng-if="viewModel.publishState == 4" localize="Embed_ShowCodeTitle" class="title successTitle"></span><span class="successLabel semiLightBlackText" localize="Embed_LinkTitle"></span> <input class="succesInputBox semiBoldBlackText" readonly ng-show="showEmbedCode()" onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.link"/><span class="successLabel semiLightBlackText" localize="Embed_EmbedCodeTitle"></span> <input class="succesInputBox semiBoldBlackText" readonly ng-show="showEmbedCode()" onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.embedCode"/><span class="semiBoldBlackText" localize="Embed_Size"></span> <select ng-change="updateSize()" ng-options="size.name for size in viewModel.embedTab.sizes" ng-model="viewModel.embedTab.selectedEmbedSize" class="sizeOptions regularBlackText"></select></div><div ng-switch-when="5"><span localize="Embed_SharepointTitle" class="title publishTitle"></span><div><span class="successLabel regularBlackText" localize="Embed_SharePointLinkTitle"></span><a href="https://go.microsoft.com/fwlink/?LinkID=825698" target="_blank"><span class="successLabel regularBlackText" localize="LearnMore"></span></a> <input class="sharePointEmbedCodeInputBox semiBoldBlackText" readonly onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.link"/></div><div class="spEmbedButtons"> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()"></button></div></div><div class="buttons"> <button localize="Embed_GenerateEmbedCode" class="button embedCodeButton actionButton" ng-hide="viewModel.embedTab.disabled || showEmbedCode() || viewModel.publishState !== 2" ng-click="generateEmbedCodeAndGoToSuccess()"></button> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()" ng-hide="viewModel.publishState==1 || viewModel.publishState==5"></button></div></div></div>'),e.put("views/esriConsentDialog.html",'<div><div class="esriDialogTitle"><div class="EsriConsentDialog_Esri" localize="EsriConsentDialog_Esri"></div><div class="EsriConsentDialog_WelcomeTo" localize="EsriConsentDialog_WelcomeTo"></div><div class="EsriConsentDialog_ArcGISMaps" localize="ArcGISMapsForPowerBI"></div></div><div class="esriDialogBody"><div class="EsriConsentDialog_GetMore" localize="EsriConsentDialog_GetMore"></div><div class="EsriConsentDialog_ByClicking" ng-bind-html="::byClickingText"></div><div class="EsriConsentDialog_LearnMore"><a ng-href="{{::learnMoreLink}}" target="_blank" localize="EsriConsentDialog_LearnMore"></a></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="acceptTermsOfService()" localize="EsriConsentDialog_OK"></button> <button class="btn button" ng-click="rejectTermsOfService()" localize="EsriConsentDialog_Cancel"></button></div></div></div>'),e.put("views/exploration.html",'\ufeff<div tabindex="0" role="application" class="exploration {{isMasterFormFactor()? \'\': \'phone-form-factor-background\'}}" toolbar-container><accessibility-info on-close="focusVisualContainer"></accessibility-info><explore-canvas view-model="viewModel.exploreCanvas" disable-print="disablePrint" canvas-options="canvasOptions" ng-class=\'{"master-form-factor": isMasterFormFactor(), "phone-form-factor": !isMasterFormFactor(), "disable-visual-interactivity": isMobileLayoutAuthoring()}\' canvas-scroll></explore-canvas></div>'),e.put("views/explorationAppBar.html",'<div class="explorationAppBarContent trimmedTextWithEllipsis unselectable"><div class="appBarSection left"><ul role="menubar"><li ng-if="$ctrl.viewModel.options.showBackButtonOnAppBar" ng-click="$ctrl.navigateBack()"><i class="glyphicon pbi-glyph-pageleft glyph-small backBtn"></i></li><li class="file-menu" ng-click="$ctrl.showMenu($event, $ctrl.getFileMenuProperties)" tabindex="0" role="menu"><span localize="ReportAppBar_FileButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li class="pageview-menu" ng-click="$ctrl.showMenu($event, $ctrl.getViewMenuProperties)" tabindex="0" localize-tooltip="ItemAction_View" ng-if="!$ctrl.isPopOutMode" role="menu"><span localize="ItemAction_View"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li localize="ReportAppBar_SwitchModeButton" ng-click="$ctrl.stopEditing()" class="switch" ng-if="$ctrl.showSwitchMode() && $ctrl.viewModeState.getMode() === 1 && $ctrl.viewModel.canWrite"></li><li localize="ReportAppBar_EditReportButton" ng-click="$ctrl.edit()" class="edit" ng-if="$ctrl.canOpenEditReport()"></li><li localize="ReportAppBar_EditReportButton" localize-tooltip="ReportAppBar_EditReportButtonSharedDisabled" class="edit-disabled" ng-if="$ctrl.showEditReportDisabled()"></li><li class="editreport-menu" ng-click="$ctrl.showMenu($event, $ctrl.getEditReportMenuProperties)" tabindex="0" ng-if="$ctrl.viewModeState.getMode() === 0 && $ctrl.viewModel.canEdit && $ctrl.isEditInDesktopEnabled()"><span localize="ReportAppBar_EditReportButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li></ul></div><div class="appBarSection right"><ul><li class="appBarDivider"></li><li class="explore" ng-click="$ctrl.showMenu($event, $ctrl.getExploreMenuProperties)" tabindex="0" localize-tooltip="ReportAppBar_ExploreTooltip" role="menu"><i class="glyphicon pbi-glyph-seedata glyph-small"></i><span localize="ReportAppBar_ExploreButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li ng-if="$ctrl.viewModeState.getMode() === 1 && !$ctrl.isPopOutMode" class="insert-textbox" ng-click="$ctrl.insertTextbox()"><i class="glyphicon pbi-glyph-inserttextbox glyph-small"></i><span localize="Textbox"></span></li><li class="insert-shape" dropdown-menu dropdown-items="$ctrl.shapeMenuActions" dropdown-class="explorationAppBarMenu" dropdown-on-item-selected="$ctrl.shapeMenuActionSelected(selected)" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.shapeMenuActions && !$ctrl.isPopOutMode"><i class="glyphicon pbi-glyph-shapes glyph-small"></i><span localize="ReportAppBar_ShapeButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li ng-click="$ctrl.toggleVisualInteractions()" class="visualInteractions" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.toggleVisualInteractions && !$ctrl.isPopOutMode" localize-tooltip="ReportAppBar_VisualInteractionsTooltip" ng-class="{ \'active\': $ctrl.viewModeState.getConfig().showRelationships }"><i class="glyphicon pbi-glyph-visualsinteraction glyph-mini"></i><span localize="ReportAppBar_VisualInteractionsButton"></span></li><li ng-click="$ctrl.refresh()" class="refresh" localize-tooltip="ReportAppBar_RefreshButton"><i class="glyphicon pbi-glyph-refresh glyph-mini" aria-hidden="true"></i><span localize="ReportAppBar_RefreshButton"></span></li><li ng-click="$ctrl.duplicateReportPage()" class="duplicate" ng-if="$ctrl.canDuplicatePage()"><i class="glyphicon pbi-glyph-chromerestore glyph-small" aria-hidden="true"></i><span localize="ReportAppBar_duplicateButton_Text"></span></li><li ng-click="$ctrl.save()" class="save" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.viewModel.canWrite"><i class="glyphicon pbi-glyph-save glyph-small" aria-hidden="true"></i><span localize="ReportAppBar_SaveReportButton"></span></li><li ng-if="$ctrl.showPinPage() && $ctrl.canPinPage()" localize-tooltip="ReportAppBar_PinPage" class="pin-report" ng-click="$ctrl.showPinReportPageDialog()"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></li><li ng-if="$ctrl.showPinPage() && $ctrl.pinPageDisabled()" localize-tooltip="PinTile_NotSupportedTitle" class="pin-disabled"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></li><li ng-if="$ctrl.canPause && !$ctrl.viewModeState.getConfig().pauseQueryExecution" class="pause" localize-tooltip="ReportAppBar_PauseQueries" ng-click="$ctrl.togglePlayPause()"><span localize="ReportAppBar_PauseQueries"></span></li><li ng-if="$ctrl.canPause && $ctrl.viewModeState.getConfig().pauseQueryExecution" class="play" localize-tooltip="ReportAppBar_ResumeQueries" ng-click="$ctrl.togglePlayPause()"><span localize="ReportAppBar_ResumeQueries"></span></li><li class="moreOptionsItem rightFloatedOptionsItem"> <button ng-if="$ctrl.showReportMoreOptionsMenu()" class="moreOptionsDashboardButton" ng-click="$ctrl.showMenu($event, $ctrl.getMoreOptionsMenuProperties)" localize-tooltip="Options_Menu"><i class="glyphicon glyph-small pbi-glyph-more"></i></button></li><li ng-if="$ctrl.isEmailSubscriptionEnabled()" class="subscription rightFloatedOptionsItem" localize-tooltip="ReportAppBar_Subscribe" ng-click="$ctrl.showSubscriptionPane()"><i class="glyphicon pbi-glyph-mail glyph-small"></i><span localize="ReportAppBar_Subscribe"></span></li><li ng-if="$ctrl.isInstantEmailEnabled()" class="subscription rightFloatedOptionsItem" localize-tooltip="ReportAppBar_SentInstantEmail" ng-click="$ctrl.showSendInstantEmailPane()"><i class="glyphicon pbi-glyph-mail glyph-small"></i><span localize="ReportAppBar_SentInstantEmail"></span></li><li ng-if="$ctrl.isViewRelatedContentEnabled()" class="related rightFloatedOptionsItem" localize-tooltip="DashboardAppBar_ViewRelated" ng-click="$ctrl.showRelatedContentPane()"><i class="glyphicon pbi-glyph-relationship glyph-small"></i><span localize="DashboardAppBar_ViewRelated"></span></li><li ng-if="$ctrl.canOpenUsageMetricsReport()" class="usageMetricsReport rightFloatedOptionsItem" localize-tooltip="UsageMetrics_Tooltip" ng-click="$ctrl.openUsageMetricsReport()"><i class="glyphicon pbi-glyph-chart glyph-small"></i><span localize="UsageMetrics_Label"></span></li></ul></div></div>'),e.put("views/explorationHost.html",'<div class="fillAvailableSpace verticalItemsContainer" ng-transclude></div>'),e.put("views/explorationNavigationTab.html",'<div drag="sections" class="thumbnail-container" ng-dblclick="beginEditSection()" accessible-click="changeSection($event)" focus-element role="tab" tabindex="0" aria-selected="{{viewModel.selected}}"><div dropdown-menu dropdown-items="dropdownItems" dropdown-on-item-selected="selectMenuItem(selected)" dropdown-on-left-click="false" dropdown-on-right-click="isEditing" dropdown-follow-mouse-position="true"><editable-label class="section-index" on-blur="renameSection(newName)" view-model="viewModel" editable="viewModel.isTabEditable && isEditing" disable-click="true"></editable-label><div class="sectionDeleteIcon" ng-if="isEditing && !isOnlyTab" ng-click="deleteSection($event)" localize-tooltip="Carousel_DeletePage">x</div></div></div>'),e.put("views/explorationPaginator.html",'<div class="paginator unselectable"><span class="prev" ng-click="prev()"></span><span class="status"><span localize="ReportPaginator_Page"></span> <span>{{getSelectedPageIndex() + 1}}</span><span localize="ReportPaginator_PageOf"></span><span ng-bind="viewModel.exploration.sections.length"></span></span><span class="next" ng-click="next()"></span></div>'),e.put("views/exploreCanvas.html",'<div class="exploreCanvas {{getExploreCanvasClass()}}" drop="dropConfig" drop-handler="drop(event, ui)" ng-click="clearSelection($event)" ng-keydown="keyDown($event)" on-resize="canvasResized()" canvas-layout pinchable="{ \'startHandler\' : \'canvasPinchStart(scale)\', \'endHandler\' : \'canvasPinchEnd(scale)\', \'scrollParentSelector\' : \'.exploration\', \'zoomDisabled\': \'shouldDisableZoom()\', \'childDisplaySelector\': \'.displayArea\' }" enable-pinch="{{canPinch()}}" swipeable="{ enabled: {{canSwipe()}}, ignoreFrom: \'.swipeable-blocked\' }" canvas-navigation="{{canSwipe()}}"><canvas-watermark canvas-view-model="viewModel"></canvas-watermark><div class="canvasBackdrop" ng-if="isCanvasBackdropVisible()"></div><div class="displayArea" explore-canvas-printer disable-print="{{::disablePrint}}"><div class="visualBackgroundContainer" ng-class="imageFitClass" ng-style="backgroundStyle"><div ng-if="imageSource" class="visualBackgroundImageContainer"> <img class="visualBackgroundImage" ng-src="{{imageSource}}" ng-style="imageStyle"/></div></div><div class="visualContainerHost" focus-group=\'ctrl-F6\'><dot-grid ng-if="showDotGrid() && dotGridViewModel" view-model="dotGridViewModel"></dot-grid><box-grid ng-if="showBoxGrid() && boxGridLayout" view-model="boxGridLayout"></box-grid><visual-container ng-repeat="visualContainer in viewModel.visualContainers" ng-if="!visualContainer.isHidden" view-model="visualContainer" ng-repeat-finish-event="visualContainerRepeatFinished"></visual-container></div><pen-annotation ng-if="$ctrl.viewModeState.getConfig().enablePenAnnotation"></pen-annotation></div></div>'),e.put("views/fieldList.html",'<section class="fieldList unselectable"><search-box filter="searchString" on-change="onSearchStringChanged()"></search-box><hr/><ng-scrollbars ng-scrollbars-config="::scrollbarsConfig" ng-right-click="showContextMenu($event)"><div ng-if="viewModel.isLoaded"><field-list-entity ng-repeat="entity in viewModel.schema.entities | orderBy:[\'!isMeasureGroup\', \'displayName\']" view-model="entity" search-string="searchString" ng-if="(!entity.hidden || entity.showHidden) && entity.isShownInSearch !== false && entity.userEntity"></field-list-entity></div><div class="centeredSpinner" ng-if="!viewModel.isLoaded"><spinner></spinner></div></ng-scrollbars></section>'),e.put("views/fieldListEntity.html",'<li class="entityContainer"><h1 ng-click="toggle($event)" ng-right-click="showContextMenu($event)" class="fieldListEntity flex smallFontSize" ng-class="{selected: viewModel.selected, inactive: viewModel.hidden && viewModel.showHidden}"><i class="caret glyphicon pbi-glyph-caretright glyph-mini smallFontSize item-auto" ng-class="{expanded : viewModel.expanded || viewModel.isShownInSearch}"/><i class="entity fieldListIcon item-auto" ng-class="viewModel.iconClassName"/><editable-label class="unselectable title item-fill" ng-class="{hasCheckedProperties: viewModel.hasCheckedProperties}" view-model="viewModel" on-blur="rename(newName)" validate="isNameValid" editable="viewModel.isEditingLabel" disable-click="true" search-string="searchString" ng-dblclick="editLabel()" tooltip tooltip-config="tooltipConfigManager.getTooltipConfig()" custom-tooltip="true"></editable-label> <i ng-if="::viewModel.hasMenu" class="menuContainer item-auto"><button class="optionsMenu" ng-click="showContextMenu($event)" localize-tooltip="Options_Menu"><span class="glyphicon pbi-glyph-more"></span></button></i></h1><div class="entityFields" ng-if="viewModel.expanded || viewModel.isShownInSearch"><ol class="entityList"><field-list-property ng-repeat="prop in viewModel.properties | filter:filterProperties" ng-if="prop.isShownInSearch || (prop.isShownInSearch !== false && prop.visible)" search-string="searchString" view-model="prop" id="{{::\'container\'+$id}}"></field-list-property><li class="lastLineBorder"/></ol></div></li>'),e.put("views/fieldListProperty.html",'<li class="fieldListProperty flex" ng-click="ctrl.select($event)" ng-right-click="ctrl.showContextMenu($event)" ng-class="ctrl.getPropertyStyle()" drag="{{::ctrl.viewModel.draggable ? \'field\' : undefined}}" drag-context="ctrl.getDragContext()" drop="{{::ctrl.dropConfig}}" drop-handler="ctrl.drop(event, ui, dropAction)" drop-action="ctrl.getDropAction(dropPosition)" drop-container-id="{{::\'container\'+$parent.$id}}" tooltip tooltip-config="ctrl.tooltipConfigManager.getTooltipConfig()" ng-style="::ctrl.getIndentationStyle()"><ng-include src="ctrl.viewModel.template"></ng-include><editable-label class="propertyText propertyContent item-fill" ng-class="{hasCheckedChildren: ctrl.viewModel.hasCheckedChildren}" view-model="ctrl.viewModel" search-string="ctrl.searchString" on-blur="ctrl.rename(newName)" editable="ctrl.viewModel.isEditingLabel" disable-click="true" ng-dblclick="ctrl.editLabel()" custom-tooltip="true"></editable-label> <i ng-if="::ctrl.viewModel.hasMenu" class="menuContainer propertyMenu item-auto"><button class="optionsMenu" ng-click="ctrl.showContextMenu($event)" localize-tooltip="Options_Menu"><span class="glyphicon pbi-glyph-more"></span></button></i></li>'),e.put("views/fieldListPropertyDefault.html",'<input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyFolder.html",'<span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyHierarchy.html",' <span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyKpi.html",'<span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><i class="fieldListIcon propertyContent item-auto {{ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyLeaf.html",'<input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/filter.html",'<li class="card unselectable" ng-switch="viewModel.readOnlyState.type"><div class="passthroughCardHeader" ng-switch-when="3"> <button type="button" class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="deleteFilter($event, viewModel)" localize-tooltip="FilterPane_DeleteFilter"></button><h2 class="passthroughRestatement unselectable trimmedTextWithEllipsis smallFontSize" ng-bind="viewModel.restatement" ng-bind-attr="{title: viewModel.tooltip}"></h2></div><include-exclude-filter ng-switch-when="6" filter-view-model="viewModel"></include-exclude-filter><include-exclude-filter ng-switch-when="7" filter-view-model="viewModel"></include-exclude-filter><div ng-switch-default><div class="filterCardTitleSection" ng-click="toggle($event, viewModel)"><div class="cardHeader" ng-attr-tooltip="viewModel.readOnlyState.invalid" tooltip-config="tooltipConfigManager.getTooltipConfig()"> <button class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="deleteFilter($event, viewModel)" localize-tooltip="FilterPane_DeleteFilter" ng-if="viewModel.canDeleteManually"></button><span ng-if="!viewModel.readOnlyState.invalid" ng-class="viewModel.readOnlyState.expanded ? \'expand\' : \'collapse\'" ng-bind-attr="{title: viewModel.readOnlyState.expanded ?  viewModel.chevronCollapseDescription : viewModel.chevronExpandDescription}"></span><h2 class="title trimmedTextWithEllipsis unselectable smallFontSize" ng-bind-attr="{title: viewModel.tooltip}"><i ng-if="viewModel.readOnlyState.invalid" class="filterPaneIcon error"/><span ng-bind="viewModel.displayName"></span><span ng-if="!viewModel.restatement" localize="FilterRestatement_All"></span></h2></div><div ng-class="{\'cardCollapsed\': !viewModel.readOnlyState.expanded && !viewModel.restatement}" class="controlPanel"> <button ng-if="!viewModel.hasDefaultValue && viewModel.restatement" class="filterPaneIcon clear largeFontSize" ng-class="{\'cardExpanded\': viewModel.readOnlyState.expanded}" ng-click="clearFilter($event, viewModel)" localize-tooltip="FilterPane_ClearFilter"></button> <button ng-if="viewModel.hasDefaultValue" class="filterPaneIcon clear largeFontSize" ng-class="{\'cardExpanded\': viewModel.readOnlyState.expanded}" ng-click="restoreDefaultFilter($event, viewModel)" localize-tooltip="FilterPane_ResetDefault"></button><h2 ng-if="viewModel.restatement" class="restatement trimmedTextWithEllipsis smallFontSize" ng-bind-attr="{title: viewModel.restatement}" ng-bind="viewModel.restatement"></h2></div></div><div ng-show="viewModel.readOnlyState.expanded"><div ng-if="viewModel.availableTypes.length> 1 && !viewModel.isSingleSelectionRequired && !viewModel.invalid"><h2 class="typeSelectTitle trimmedTextWithEllipsis smallFontSize" localize="FilterCardTypeSwitchLabel"></h2> <select class="typeSwitchOptions" ng-class="{ invalidType: viewModel.cardType.invalid }" localize="FilterCardTypeSwitchLabel" ng-options="cardType.label for cardType in ::viewModel.availableTypes track by cardType.label" ng-model="viewModel.cardType" ng-change="switchCardType(viewModel.cardType, viewModel)"/></div><ul><advanced-filter view-model="viewModel" ng-if="viewModel.cardType.type === 2"></advanced-filter><filter-visual view-model="viewModel" ng-if="(viewModel.cardType.type === 0 || viewModel.cardType.type === 4)"></filter-visual><top-n-filter view-model="viewModel" ng-if="viewModel.cardType.type === 5"></top-n-filter><relative-date-filter view-model="viewModel" ng-if="viewModel.cardType.type === 8"></relative-date-filter></ul></div><div class="cardFooter" ng-if="viewModel.readOnlyState.canToggleSingleSelect"><div class="required flex"> <input class="item-auto" type="checkbox" ng-click="updateRequiredState()" ng-model="viewModel.isSingleSelectionRequired" ng-disabled="::viewModel.disableSelectionModeToggle"><span localize="PageFilter_SingleSelectionRequired" class="label item-fill trimmedTextWithEllipsis" localize-tooltip="PageFilter_SingleSelectionRequired_Tooltip"></span></div></div></div></li>'),
e.put("views/filterPane.html",'<section class="filterPane"><div id="visualFilterContainer" ng-if="isVisualFiltersVisible()"><h3 class="header unselectable trimmedTextWithEllipsis smallFontSize" localize="FilterPane_Visual" localize-tooltip="FilterPane_VisualDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropVisualFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.visualFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.visualFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.visualFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.visualFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div><div id="pageFilterContainer" ng-if="isPageFiltersVisible()"><h3 class="header smallFontSize unselectable" localize="FilterPane_Page" localize-tooltip="FilterPane_PageDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropPageFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.pageFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.pageFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.pageFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.pageFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div><div id="drillthroughFilterContainer" ng-if="isDrillthroughFiltersVisible()"><h3 class="header smallFontSize unselectable" localize="FilterPane_Drillthrough" localize-tooltip="FilterPane_DrillthroughDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropDrillthroughFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.drillthroughFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.drillthroughFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.drillthroughFilters.length === 0 ? viewModel.addDrillthroughFilterLabel : \'\'}}"> {{viewModel.drillthroughFilters.length === 0 ? viewModel.addDrillthroughFilterLabel : \'\'}}</div></div></div><div id="exploreFilterContainer" ng-if="isReportFiltersVisible()"><h3 class="header smallFontSize unselectable" localize="FilterPane_Report" localize-tooltip="FilterPane_ReportDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropReportFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.reportFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.reportFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.reportFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.reportFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div></section>'),e.put("views/filterVisual.html",'<div class="filterVisual"><visual ng-if="$ctrl.dataLoaded" view-model="$ctrl.viewModel.readOnlyState.visual"></visual><div class="filterSpinner" ng-if="$ctrl.viewModel.isLoading && !$ctrl.dataLoaded"><spinner></spinner><span class="message" localize="FilterCard_Loading"/></div><div class="filterError" ng-if="$ctrl.hasQueryError"><i class="icon filterPaneIcon error"/><span class="message" localize="FilterCard_ErrorMessage"/></div></div>'),e.put("views/importVisualErrorDialog.html",'<div><div class="importFailMessage" localize="ImportVisual_ErrorDialogMessage"></div><div class="buttons errorButton"> <button class="btn button primary" localize="ImportVisual_Close" ng-click="closeDialog()"></button></div></div>'),e.put("views/importVisualWarningDialog.html",'<div><div class="warningMessage" localize="ImportVisual_CautionDialogMessage"></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="importVisual()" localize="ImportVisual_Import"></button> <button class="btn button" ng-click="closeDialog()" localize="ImportVisual_Cancel"></button></div></div>'),e.put("views/inputFields/propertyPaneTextBox.html",'<form name="inputForm" novalidate> <input type="{{::inputType}}" class="inputFieldInSlice" pbi-validate="validators" autocomplete="off" ng-change="onChange()" ng-model="sliceValue" ng-model-options="{ debounce: 400 }" tooltip tooltip-config="getErrorMessage()" placeholder="{{::placeholder}}" maxlength="250" name="inputField" ng-keydown="onKeydown($event)"/></form>'),e.put("views/inputFields/selectionBox.html",'<div class="popup-container-toggle" ng-click="showDropdown=!showDropdown"><div class="selection-box selection-box-position"><div class=\'selection-box-selected-block\'><span class=\'selection-box-icon\'></span><span class=\'selection-box-selected-item\' ng-bind="selectedItem.displayName"></span></div><popup-container ng-if="showDropdown" close="$parent.showDropdown=false" bind-parent-width><ul class="selection-box-menu"><li ng-repeat="item in items | filter: ( hasHideableItems ? {isHidden : false} : \'\') track by $index" class=\'selection-box-item trimmedTextWithEllipsis\' ng-click="itemSelected(item)" ng-class="{\'selected\': selectedItem === item}"><span ng-bind="item.displayName"></span></li></ul></popup-container></div></div>'),e.put("views/svg/visualsWatermarks.svg",'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 479 492" enable-background="new 0 0 479 492" xml:space="preserve"><symbol id="100stackedbar"><rect x="0" y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="74.7" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="129.8" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="184" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="241" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="20.6" fill="#D0D2D3" width="313.6" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="284.9" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="318.8" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="308.6" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="278.6" height="39"/><rect x="0" y="20.6" opacity="0.5" fill="#A6A8AB" width="211.1" height="39"/><rect x="0" y="74.7" opacity="0.5" fill="#A6A8AB" width="186.2" height="39"/><rect x="0" y="129.8" opacity="0.5" fill="#A6A8AB" width="211.1" height="39"/><rect x="0" y="184" opacity="0.5" fill="#A6A8AB" width="200" height="39"/><rect x="0" y="241" opacity="0.5" fill="#A6A8AB" width="184" height="39"/></symbol><symbol id="100stackedcolumn"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.4" x2="400" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.8" x2="400" y2="147.8"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222.3" x2="400" y2="222.3"/><rect x="19" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="83.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="147.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="211.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="275.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="339.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="19" y="104.6" fill="#D0D2D3" width="40.9" height="195.5"/><rect x="83.1" y="58" fill="#D0D2D3" width="40.9" height="242.1"/><rect x="147.1" y="94.6" fill="#D0D2D3" width="40.9" height="205.5"/><rect x="211.1" y="99.5" fill="#D0D2D3" width="40.9" height="200.6"/><rect x="275.1" y="60.6" fill="#D0D2D3" width="40.9" height="239.5"/><rect x="339.1" y="136.5" fill="#D0D2D3" width="40.9" height="163.6"/><rect x="19" y="197.6" opacity="0.5" fill="#A6A8AB" width="40.9" height="102.5"/><rect x="83.1" y="173.2" opacity="0.5" fill="#A6A8AB" width="40.9" height="126.9"/><rect x="147.1" y="192.3" opacity="0.5" fill="#A6A8AB" width="40.9" height="107.8"/><rect x="211.1" y="184.7" opacity="0.5" fill="#A6A8AB" width="40.9" height="115.4"/><rect x="275.1" y="162.3" opacity="0.5" fill="#A6A8AB" width="40.9" height="137.8"/><rect x="339.1" y="206" opacity="0.5" fill="#A6A8AB" width="40.9" height="94.1"/></symbol><symbol id="area"><rect x="0.1" fill="#F4F4F4" width="399.8" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="73.5" x2="399.8" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="147.9" x2="399.8" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="222.4" x2="399.8" y2="222.4"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.2" y1="73.5" x2="399.8" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.9" x2="399.8" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="222.4" x2="399.8" y2="222.4"/><g><g><g><polygon fill="#E1E2E3" points="345.1,93.4 287.8,77 230.6,82.1 173.9,211.9 115.1,204.3 56.9,217.5 0.1,172.3 0.1,300          399.8,300 399.8,82.3"/></g></g></g><g><polygon fill="#D0D2D3" points="115.1,206.7 175,214.5 231.8,84.9 287.3,80 344.6,96.4 399.8,85.2 399.8,81.1 344.8,92.3      288.1,76.1 287.7,76 229,81.2 172.5,210.1 114.9,202.7 57.5,215.7 0.1,170.2 0.1,175.3 56.5,220"/></g></symbol><symbol id="bar"><rect y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#D0D2D3" width="179.9" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="253.4" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="224.6" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="311.1" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="367.2" height="39"/></symbol><symbol id="kpi"><g id="Creation" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><g id="KPI-Canvas" sketch:type="MSArtboardGroup"><rect id="BG" fill="#FAFAFA" sketch:type="MSShapeGroup" x="0" y="0" width="400" height="299.441341"></rect><g id="Rectangle-20-+-Rectangle-21-+-Triangle-3" sketch:type="MSLayerGroup" transform="translate(122.000000, 123.000000)"><rect id="Rectangle-20" fill="#BABABA" sketch:type="MSShapeGroup" x="0" y="0" width="146" height="24"></rect><rect id="Rectangle-21" fill="#DDDDDD" sketch:type="MSShapeGroup" x="32" y="35" width="82" height="10"></rect><polygon id="Triangle-3" fill="#DDDDDD" sketch:type="MSShapeGroup" points="173.444444 1 186.888889 23 160 23 "></polygon></g><path d="M-2.30078125 266.449219 32.9472656 292.931641 66.9375 285.017578 100.927734 291.078125 134.900391 222.228516 167.779297 219.632812 198.302734 227.175781 242.171875 250.173828 286.412109 226.193359 316.695312 229.787109 352.632812 216.943359 425.914062 225.597656 425.914062 367.497434-34.7301703 367.497434-34.7301703 273.284528-2.30078125 266.449219Z" id="Path-2" stroke="#DDDDDD" stroke-width="2" fill="#EAEAEA" sketch:type="MSShapeGroup"></path></g></g></symbol><symbol id="card"><rect x="0" y="0.3" fill="#F4F4F4" width="400" height="299.6"/><rect x="0" y="0.3" fill="#A6A6A6" width="8" height="299.6"/><rect x="221.6" y="42.2" fill="#A6A6A6" width="139.9" height="4"/><rect x="221.6" y="109.7" fill="#A6A6A6" width="139.9" height="4"/><rect x="221.6" y="180" fill="#A6A6A6" width="141.7" height="4"/><rect x="221.6" y="249.5" fill="#A6A6A6" width="141.7" height="4"/><rect x="34.1" y="41.8" opacity="0.5" fill="#A6A8AB" width="142" height="142"/><rect x="36.1" y="249.5" fill="#A6A6A6" width="141.7" height="4"/></symbol><symbol id="clusteredBar"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.1" height="300"/><rect x="0" y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="25.1" fill="#E1E2E3" width="290.1" height="13.5"/><rect x="0" y="71.1" fill="#E1E2E3" width="338.1" height="13.5"/><rect x="0" y="103.8" fill="#E1E2E3" width="237.1" height="13.5"/><rect x="0" y="182.6" fill="#E1E2E3" width="237.1" height="13.5"/><rect x="0" y="260.8" fill="#E1E2E3" width="313.1" height="13.5"/><rect x="0" y="38.8" fill="#ACACAC" width="211.1" height="13.5"/><rect x="0" y="136.5" fill="#E1E2E3" width="284.1" height="13.5"/><rect x="0" y="215" fill="#E1E2E3" width="240.1" height="13.5"/><rect x="0" y="150.2" fill="#ACACAC" width="336.1" height="13.5"/><rect x="0" y="228.4" fill="#ACACAC" width="284.1" height="13.5"/></symbol><symbol id="clusteredColumn"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.4" x2="400" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.8" x2="400" y2="147.8"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222.3" x2="400" y2="222.3"/><rect x="43.7" y="163.6" fill="#D0D2D3" width="40.9" height="135.7"/><rect x="84.4" y="196.8" fill="#ACACAC" width="40.9" height="102.5"/><rect x="147.7" y="52.2" fill="#D0D2D3" width="40.9" height="247.1"/><rect x="315.4" y="131" fill="#D0D2D3" width="40.9" height="168.3"/><rect x="252" y="160.6" fill="#ACACAC" width="40.9" height="138.7"/><rect x="211.1" y="103.8" fill="#D0D2D3" width="40.9" height="195.5"/></symbol><symbol id="column"><rect x="0" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="73.5" x2="400" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="147.9" x2="400" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="222.4" x2="400" y2="222.4"/><rect x="19.1" y="193.3" fill="#D0D2D3" width="40.9" height="106.9"/><rect x="83.1" y="167.8" fill="#D0D2D3" width="40.9" height="132.4"/><rect x="147.1" y="187.8" fill="#D0D2D3" width="40.9" height="112.4"/><rect x="211.2" y="82.1" fill="#D0D2D3" width="40.9" height="218.1"/><rect x="275.2" y="39.9" fill="#D0D2D3" width="40.9" height="260.3"/><rect x="339.2" y="122.3" fill="#D0D2D3" width="40.9" height="177.9"/></symbol><symbol id="combo"><rect x="0" y="0.3" fill="#F4F4F4" width="399.8" height="299.7"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="73.4" x2="399.7" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="147.9" x2="399.7" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="222.3" x2="399.7" y2="222.3"/><rect x="20.4" y="189.5" fill="#D0D2D3" width="40.7" height="110.6"/><rect x="84.1" y="163.1" fill="#D0D2D3" width="40.7" height="137"/><rect x="147.9" y="183.8" fill="#D0D2D3" width="40.7" height="116.4"/><rect x="211.6" y="74.4" fill="#D0D2D3" width="40.7" height="225.8"/><rect x="275.3" y="30.7" fill="#D0D2D3" width="40.7" height="269.5"/><rect x="339" y="116.1" fill="#D0D2D3" width="40.7" height="184.1"/><polyline opacity="0.5" fill="none" stroke="#A6A8AB" stroke-width="4" stroke-miterlimit="10" points="399.3,95.6 344.1,106.8    287.4,90.5 230.7,95.6 174.6,224.8 116.4,217.1 58.8,230.3 2.4,185.2 "/></symbol><symbol id="defaultWatermark"><g><rect x="0" y="1" opacity="0.5" fill="#F4F4F4" width="400" height="300"/><path fill="#929497" d="m93.79999 69.79999v47l30.20001 36.09998c10.29999-8.59998 16.79999-21.59998 16.79999-36.09998l0 0c0-25.89999-21.09998-47-47-47z"/><path fill="#D0D2D3" d="m46.7 116.9c0 22.1 15.3 40.49999 35.6 45.7l11.39999-45.7h-47l0 0 0 0z"/><path fill="#E1E2E3" d="m93.79999 116.89999-11.39999 45.69999c3.69998.90001 7.39999 1.5 11.39999 1.5 11.5 0 22-4.09999 30.20001-11l-30.20001-36.19999z"/><path fill="#A6A8AB" d="m93.79999 69.79999c-25.99998 0-46.99998 21-46.99998 47l0 0h46.99998v-47l0 0z"/><g><polygon fill="#E1E2E3" points="200.89999389648438 193.5999755859375 167.70001220703125 185.0999755859375 134.29998779296875 187.70001220703125 101.29998779296875 254.9000244140625 67.10000610351562 251 33.30000305175781 257.79998779296875 0.1999969482421875 234.4000244140625 0.1999969482421875 300.5 399.9000244140625 300.5 399.9000244140625 187.9000244140625 349.20001220703125 182.0999755859375 314.1000061035156 194.5999755859375 286.8999938964844 191.0999755859375 242 214.5 "/></g><g><polyline fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" points="399.9000244140625 187.70001220703125 349.20001220703125 182.0999755859375 314.1000061035156 194.5999755859375 286.8999938964844 191.0999755859375 242 214.5 200.89999389648438 193.4000244140625 167.70001220703125 185 134.29998779296875 187.5999755859375 101.29998779296875 254.79998779296875 67.10000610351562 251 33.30000305175781 257.70001220703125 0.1999969482421875 234.4000244140625 "/></g><rect x="185.6" y="115.9" fill="#E1E2E3" width="20.7" height="48"/><rect x="217.8" y="104.4" fill="#E1E2E3" width="20.7" height="59.5"/><rect x="250.1" y="113.4" fill="#E1E2E3" width="20.7" height="50.5"/><rect x="282.3" y="66" fill="#E1E2E3" width="20.7" height="97.9"/><rect x="314.6" y="47" fill="#E1E2E3" width="20.7" height="116.9"/><rect x="346.8" y="84" fill="#E1E2E3" width="20.7" height="79.9"/><rect x="185.6" y="129.5" fill="#D0D2D3" width="20.7" height="34.4"/><rect x="217.8" y="121.2" fill="#D0D2D3" width="20.7" height="42.7"/><rect x="250.1" y="127.7" fill="#D0D2D3" width="20.7" height="36.1"/><rect x="282.3" y="93.7" fill="#D0D2D3" width="20.7" height="70.2"/><rect x="314.6" y="80.1" fill="#D0D2D3" width="20.7" height="83.8"/><rect x="346.8" y="106.6" fill="#D0D2D3" width="20.7" height="57.2"/><rect x="185.6" y="145.1" opacity="0.5" fill="#A6A8AB" width="20.7" height="18.7"/><rect x="217.8" y="140.7" opacity="0.5" fill="#A6A8AB" width="20.7" height="23.2"/><rect x="250.1" y="144.1" opacity="0.5" fill="#A6A8AB" width="20.7" height="19.7"/><rect x="282.3" y="125.6" opacity="0.5" fill="#A6A8AB" width="20.7" height="38.2"/><rect x="314.6" y="118.3" opacity="0.5" fill="#A6A8AB" width="20.7" height="45.6"/><rect x="346.8" y="132.7" opacity="0.5" fill="#A6A8AB" width="20.7" height="31.1"/></g></symbol><symbol id="donut"><rect x="1.3" y="0.2" fill="#F4F4F4" width="398.7" height="299.8"/><path fill="#929497" d="M200.6 55.6v94.5l60.6 72.5c20.7-17.3 33.9-43.4 33.9-72.5v0C295.1 97.9 252.8 55.6 200.6 55.6z"/><path fill="#D0D2D3" d="M106.1 150.1c0 44.3 30.5 81.4 71.6 91.7l22.9-91.7H106.1z"/><path fill="#E1E2E3" d="M200.6 150.1l-22.9 91.7c7.3 1.8 15 2.8 22.9 2.8 23.1 0 44.2-8.3 60.6-22L200.6 150.1z"/><path fill="#A6A8AB" d="M200.6 55.6c-52.2 0-94.5 42.3-94.5 94.5v0h94.5V55.6z"/><circle fill="#F4F4F4" cx="200.6" cy="151" r="53.4"/></symbol><symbol id="funnel"><rect x="1.3" y="0" fill="#F4F4F4" width="398.7" height="300"/><g><g><g><rect x="46.5" y="59.7" fill="#D0D2D3" width="317.6" height="33.9"/></g><g><rect x="82.7" y="97.9" fill="#D0D2D3" width="245.2" height="33.9"/></g><g><rect x="141.2" y="136.2" fill="#D0D2D3" width="128.3" height="33.9"/></g><g><rect x="181.2" y="174.4" fill="#D0D2D3" width="48.3" height="33.9"/></g><g><rect x="194.1" y="212.6" fill="#D0D2D3" width="23.4" height="33.9"/></g></g></g></symbol><symbol id="filledMap"><rect x="0.7" y="0" opacity="0.5" fill="#F4F4F4" width="401.4" height="302.1"/><g><defs><rect id="SVGID_1_" x="0.2" y="0" width="401.4" height="302.1"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#E1E2E3" d="M49.4-9.3l18.3 44.6-97.2 30.3c-2.2.7-3.4 3-2.7 5.2.6 1.8 2.2 2.9 4 2.9.4 0 .8-.1 1.2-.2l57.4-17.9-1.9 32.9-59.3-4c-2.3-.2-4.3 1.6-4.4 3.9-.2 2.3 1.6 4.3 3.9 4.4l59.4 4-6.3 111-50.9-26.4c-2-1.1-4.5-.3-5.6 1.8-1.1 2-.3 4.5 1.8 5.6l56.6 29.4c0 0 0 0 0 0l21.2 11-71 60c-1.1.9-1.6 2.3-1.4 3.7.2 1.4 1 2.6 2.2 3.2l62.9 31.8c.6.3 1.2.4 1.9.4 1.5 0 3-.8 3.7-2.3 1-2 .2-4.5-1.8-5.6l-57.3-29 68.8-58.1 20.9 10.9-4.6 79.7c-.1 2.3 1.6 4.2 3.9 4.4.1 0 .2 0 .2 0 2.2 0 4-1.7 4.1-3.9l4.3-76 39 20.2-41.7 53c-1.4 1.8-1.1 4.4.7 5.8.8.6 1.7.9 2.6.9 1.2 0 2.4-.5 3.3-1.6L180.7 206l54.3 26.3-44.4 89.9c-1 2.1-.2 4.5 1.9 5.6.6.3 1.2.4 1.8.4 1.5 0 3-.8 3.7-2.3l44.4-90 40.4 19.6-34.1 66.7c-1 2-.2 4.5 1.8 5.6.6.3 1.2.5 1.9.5 1.5 0 3-.8 3.7-2.3l34.2-66.8 63.2 30.6-2.9 34c-.2 2.3 1.5 4.3 3.8 4.5.1 0 .2 0 .4 0 2.1 0 3.9-1.6 4.1-3.8l2.9-34.6L400 295c2.2-.5 3.6-2.8 3-5-.5-2.2-2.8-3.6-5-3l-35.5-5.9 4.3-51H399c2.3 0 4.1-1.9 4.1-4.1 0-2.3-1.9-4.1-4.1-4.1h-48.8l-32.4-16.4 1.2-2.4c.1-.3.2-.5.3-.8l3.4-12.9 76.1 2.9c.1 0 .1 0 .2 0 2.2 0 4.1-1.8 4.1-4 .1-2.3-1.7-4.2-4-4.3l-74.2-2.8 14.3-54c14.8 3.5 31.6 5.8 50.3 5.8 3.2 0 6.4-.1 9.6-.2 2.3-.1 4.1-2 4-4.3-.1-2.3-2-4.1-4.3-4-21.6.9-40.8-1.5-57.4-5.5l4.7-17.8c14.6 3.3 27.6 4.2 37.1 4.2 9.7 0 15.8-.9 16.3-1 2.3-.3 3.8-2.5 3.5-4.7-.3-2.3-2.4-3.8-4.7-3.5-.2 0-21.4 3.1-48.3-2.7l5.8-76.7 42.9 3.3c2.3.2 4.3-1.5 4.5-3.8.2-2.3-1.5-4.3-3.8-4.5l-45.4-3.5-17.5-31.4c-1.5-1.5-3.9-1.7-5.6-.3l-62.7 64.2c-9.9-13.8-17.7-30.2-23.5-48.9-.7-2.2-3-3.4-5.2-2.7-2.2.7-3.4 3-2.7 5.2 6.5 20.9 15.2 37.9 25.2 51.6l-19.1 16.1c-2.6-1.8-33.6-24.6-44.4-76.8-.5-2.2-2.7-3.7-4.9-3.2-2.2.5-3.7 2.7-3.2 4.9.7 3.3 1.4 6.5 2.3 9.5l-80.5 25.1c-11.6-10.9-7.7-34.5-7.7-34.8.4-2.3-1.1-4.4-3.4-4.8-2.3-.4-4.4 1.1-4.8 3.4-.2 1.1-4.1 24.4 7.2 38.9l-27.8 8.7c0 0 0 0 0-.1L55.8-15.6c-.8-1.8-2.7-2.9-4.7-2.5M307.8 206.7l-7 13.6-40.7-20.2 10.9-22 16 9.2c.6.3 1.2.5 1.9.6l25.4 1-2.8 10.7-2.2 4.3M286.3 71.9c6.9 5.7 13.9 10.4 20.9 14.3-.1.2-.3.4-.4.6l-8.1 16.4c-12.3-6.2-20.8-12.1-25-15.3l12.4-15.8C286.2 72.1 286.2 72 286.3 71.9zM268.5 94.5c4.5 3.5 13.4 9.8 26.4 16.3l-42.2 85.6-46.3-23.1L268.5 94.5zM316.5 180.6l-26.2-1-15.6-9 27.7-56.2c8.3 3.8 17.9 7.4 28.8 10.4L316.5 180.6zM333.4 116.7c-10.2-2.9-19.3-6.4-27.2-9.9l8-16.3c.1-.2.1-.4.2-.6 6.4 3.1 12.7 5.5 18.7 7.4 1.7.5 3.4 1 5 1.5L333.4 116.7zM333.1-14.8l14.6 28.5-5.8 77.7c-2.1-.6-4.1-1.2-6.2-1.9-25.4-8.2-46.3-22.3-62.4-42.3L333.1-14.8zM280.2 66.5c-.2.2-.4.4-.6.6l-82.9 105.2 0 0-18.4 23.4-51.4-24.9L267 52.3C271.2 57.5 275.6 62.3 280.2 66.5zM86.8 160.6l24.9 12.1-26.9 22.7L86.8 160.6zM87.4 151.6l3-52.7 8.4-4.6 2.2 3.5v14.7c0 2.3 1.9 4.1 4.1 4.1h27.7c1.1 0 2.1-.4 2.9-1.1L165.6 87l20.7 22.7-67.6 57.1L87.4 151.6zM184.9 47.6l4 5.6-57.7 55.1h-21.9V96.6c0-.8-.2-1.6-.6-2.2l-2.6-4L184.9 47.6zM236.3 67.4l-43.7 36.9-21-23.1 25.7-24.5c1.5-1.4 1.7-3.7.5-5.4l-5.5-7.7 16.2-8.8C219.5 53.4 231.5 63.7 236.3 67.4zM204.5 27.5 90.9 89.1l3-53.3L194.9 4.3C197.7 13 201 20.7 204.5 27.5zM38.8 53l46.7-14.6-3.1 53.8-45.7-3.1L38.8 53zM29.8 212l6.5-114.6 45.7 3.1-5.8 102.2-24.4 20.6L29.8 212zM59.7 227.5l15.8-13.4L74.3 235 59.7 227.5zM126.1 261.9l-43.7-22.7 1.9-32.5 35.7-30.2 53.1 25.7L126.1 261.9zM185.9 199.3l15.2-19.3 47.9 23.8-10.4 21L185.9 199.3zM246.1 228.5l10.3-21 40.6 20.2-10.4 20.4L246.1 228.5zM294.1 251.7l12.3-24c0 0 0 0 0 0l0 0 7.7-15 33.3 16.9c.6.3 1.2.4 1.9.4h9.3l-4.3 50.8L294.1 251.7z"/></g><g><polygon fill="#A6A8AB" points="119.4,172.5 81.5,203.8 79.7,244.4 127.5,265.1 178.4,199.4 \t"/><path fill="#A6A8AB" d="M127.5 270.4c-.7 0-1.4-.1-2.1-.4l-47.8-20.7c-2-.9-3.3-2.9-3.2-5.1l1.8-40.5c.1-1.5.8-2.9 1.9-3.8l37.9-31.3c1.6-1.3 3.7-1.6 5.6-.7l59 26.9c1.5.7 2.6 2 2.9 3.5.4 1.6 0 3.2-1 4.5l-50.9 65.7C130.7 269.6 129.1 270.4 127.5 270.4zM85.2 240.9l40.7 17.6 44.3-57.1-50-22.7-33.5 27.7L85.2 240.9z"/></g><g><path fill="#A6A8AB" d="M301.3 108.4l-30.6 62.9L289 183l30.9.6 16-61.9C336 121.7 324 121 301.3 108.4z"/><path fill="#A6A8AB" d="M320 188.9C319.9 188.9 319.9 188.9 320 188.9l-31-.6c-1 0-1.9-.3-2.8-.8l-18.3-11.7c-2.3-1.5-3.1-4.4-1.9-6.8l30.6-62.9c.6-1.3 1.8-2.3 3.2-2.8 1.4-.4 2.9-.3 4.2.4 20.9 11.7 32.2 12.6 32.4 12.6 1.6.1 3 .9 4 2.2.9 1.3 1.2 2.9.9 4.4l-16 61.9C324.5 187.3 322.4 188.9 320 188.9zM290.6 177.7l25.2.5 13.5-52.3c-5.3-1.3-14-4.1-25.7-10.2l-26.1 53.6L290.6 177.7z"/></g><g><polygon fill="#A6A8AB" points="99.7,90.8 104.9,98.1 104.9,111.3 132,111.3 192.9,53.8 185.9,42.8 \t"/><path fill="#A6A8AB" d="M132 116.6h-27.1c-2.9 0-5.3-2.4-5.3-5.3V99.8l-4.3-5.9c-.9-1.2-1.2-2.8-.9-4.3.3-1.5 1.3-2.8 2.6-3.5l86.3-47.9c1.9-1 4.2-.8 5.8.5l6.9 10.9c1.2 1 1.9 2.4 2 3.9.1 1.5-.5 3-1.6 4.1l-60.8 57.5C134.7 116 133.4 116.6 132 116.6zM110.2 106h19.7l54.9-51.9-2.4-1.9-74.9 40.4 1.7 2.4c.7.9 1 2 1 3.1V106z"/></g><g><polygon fill="#A6A8AB" points="4.8,91.4 30.6,92.8 24.6,213.1 4.8,201.8 \t"/><path fill="#A6A8AB" d="M24.6 218.4c-.9 0-1.8-.2-2.6-.7L2.2 206.4c-1.7-.9-2.7-2.7-2.7-4.6V91.4c0-1.4.6-2.8 1.6-3.8 1.1-1 2.5-1.5 3.9-1.4l25.8 1.3c2.9.1 5.2 2.6 5 5.5l-5.9 120.3c-.1 1.8-1.1 3.5-2.7 4.4C26.4 218.1 25.5 218.4 24.6 218.4zM10.1 198.7l9.7 5.5L25 97.8 10.1 97V198.7z"/></g><g><polygon fill="#A6A8AB" points="240.1,229.5 255.4,202.2 301.3,225.5 287.4,251.5 \t"/><path fill="#A6A8AB" d="M287.4 256.8c-.8 0-1.5-.2-2.2-.5l-47.3-22c-1.3-.6-2.4-1.8-2.8-3.2s-.3-2.9.4-4.2l15.3-27.3c1.4-2.5 4.5-3.4 7.1-2.1l45.9 23.3c1.3.6 2.2 1.8 2.7 3.2.4 1.4.3 2.9-.4 4.1l-14 26C291.1 255.8 289.3 256.8 287.4 256.8zM247.6 227.1l37.5 17.4 9-16.7-36.5-18.5L247.6 227.1z"/></g><g><polygon fill="#A6A8AB" points="358.4,272.1 364.6,226.4 396.5,226.4 397,271.7 \t"/><path fill="#A6A8AB" d="M358.4 277.4c-1.5 0-3-.7-4-1.8-1-1.2-1.5-2.7-1.3-4.2l6.2-45.7c.4-2.6 2.6-4.6 5.3-4.6h31.9c2.9 0 5.3 2.4 5.3 5.3l.4 45.3c0 2.9-2.3 5.3-5.3 5.4L358.4 277.4C358.4 277.4 358.4 277.4 358.4 277.4zM369.2 231.7l-4.8 35 27.1-.3-.3-34.7H369.2z"/></g><g><path fill="#A6A8AB" d="M198.6 5c0 0 6.2 34.2 43.5 62.6L314 5.4 198.6 5z"/><path fill="#A6A8AB" d="M242.1 72.9c-1.1 0-2.3-.4-3.2-1.1-38.5-29.3-45.2-64.4-45.5-65.8-.3-1.6.1-3.2 1.2-4.4 1-1.2 2.5-1.9 4.1-1.9L314 .1c2.2 0 4.2 1.4 5 3.5.8 2.1.2 4.4-1.5 5.9l-71.9 62.1C244.6 72.4 243.4 72.9 242.1 72.9zM205.7 10.3c3.5 10.3 13 31.4 36.3 50.3l57.8-49.9L205.7 10.3z"/></g><g><path fill="#A6A8AB" d="M56.3 5l15 31.3 37-11.5c0 0-3.1-4.4-7.9-20.3L56.3 5z"/><path fill="#A6A8AB" d="M71.2 41.5c-2 0-3.9-1.1-4.8-3l-15-31.3c-.8-1.6-.7-3.5.3-5.1s2.6-2.5 4.4-2.5l44.1-.4c0 0 0 0 .1 0 2.3 0 4.4 1.5 5.1 3.7 4.4 14.4 7.2 18.8 7.3 18.9 1 1.4 1.2 3.1.6 4.7-.5 1.6-1.9 2.8-3.5 3.3l-37 11.5C72.3 41.5 71.8 41.5 71.2 41.5zM64.6 10.2 74 29.8l26.7-8.3c-1.2-2.7-2.6-6.5-4.3-11.7L64.6 10.2z"/></g><g><path fill="#A6A8AB" d="M397.4 21.9l-1.6 78.5c-29.3 4.7-49.9-4.7-49.9-4.7L353 17l-8.4-12h53.2L397.4 21.9z"/><path fill="#A6A8AB" d="M379.4 107c-21.2 0-35.1-6.2-35.7-6.4-2.1-.9-3.3-3.1-3.1-5.3l6.9-76.8-7.3-10.4c-1.1-1.6-1.3-3.8-.4-5.5.9-1.8 2.7-2.9 4.7-2.9h53.2c1.4 0 2.8.6 3.8 1.6 1 1 1.5 2.4 1.5 3.9L402.7 22l-1.6 78.5c-.1 2.6-1.9 4.7-4.5 5.2C391 106.6 385.2 107 379.4 107zM351.6 92.2c5 1.6 14.9 4.2 27.8 4.2 3.7 0 7.5-.2 11.2-.6l1.5-74 .3-11.4h-37.5l2.5 3.6c.7 1 1.1 2.3.9 3.5L351.6 92.2z"/></g></symbol><symbol id="gauge"><rect y="0.4" opacity="0.5" fill="#F4F4F4" width="400.1" height="299.6"/><path fill="#E1E2E3" d="M200 82.3c-73.7 0-133.4 59.7-133.4 133.4h51.6c0-45.2 36.6-81.8 81.8-81.8s81.8 36.6 81.8 81.8h51.6C333.4 142 273.7 82.3 200 82.3z"/><path fill="#A6A8AB" d="M94.4 134.3C77 156.8 66.7 185 66.7 215.7h51.6c0-18.9 6.4-36.2 17.1-50.1L94.4 134.3z"/></symbol><symbol id="line"><rect x="0.1" fill="#F4F4F4" width="399.3" height="300.2"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="73" x2="399.4" y2="73"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="147" x2="399.4" y2="147"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="220.9" x2="399.4" y2="220.9"/><g><polygon fill="#D0D2D3" points="115.1,206.7 175,214.5 231.8,84.9 287.3,80 344.6,96.4 399.8,85.2 399.8,81.1 344.8,92.3      288.1,76.1 287.7,76 229,81.2 172.5,210.1 114.9,202.7 57.5,215.7 0.1,170.2 0.1,175.3 56.5,220 \t"/></g></symbol><symbol id="map"><g><defs><rect id="SVGID_1_" x="0.9" y="0.2" width="399.1" height="299.6"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#E1E2E3" d="M54.1-9.8l19.8 48.3L-31.3 71.3c-2.4.7-3.7 3.3-2.9 5.6.6 1.9 2.4 3.2 4.3 3.2.4 0 .9-.1 1.3-.2l62.1-19.4-2 35.6-64.1-4.4c-2.5-.2-4.6 1.7-4.8 4.2-.2 2.5 1.7 4.6 4.2 4.8L31 105l-6.8 120.1-55-28.5c-2.2-1.1-4.9-.3-6.1 1.9-1.1 2.2-.3 4.9 1.9 6.1l61.3 31.8c0 0 0 0 0 0l22.9 11.9-76.8 64.9c-1.2 1-1.7 2.5-1.6 4 .2 1.5 1.1 2.8 2.4 3.5l68.1 34.4c.6.3 1.3.5 2 .5 1.6 0 3.2-.9 4-2.5 1.1-2.2.2-4.9-2-6l-62-31.4 74.4-62.9 22.7 11.8-4.9 86.3c-.1 2.5 1.8 4.6 4.2 4.7.1 0 .2 0 .3 0 2.4 0 4.3-1.8 4.5-4.2l4.7-82.2 42.2 21.9-45.2 57.3c-1.5 1.9-1.2 4.8.7 6.3.8.6 1.8 1 2.8 1 1.3 0 2.6-.6 3.5-1.7l102.9-130.5 58.8 28.5-48 97.3c-1.1 2.2-.2 4.9 2 6 .6.3 1.3.5 2 .5 1.7 0 3.2-.9 4-2.5l48-97.4 43.7 21.2-36.9 72.2c-1.1 2.2-.3 4.9 2 6 .7.3 1.4.5 2 .5 1.6 0 3.2-.9 4-2.4l37-72.3 68.4 33.1-3.1 36.8c-.2 2.5 1.6 4.6 4.1 4.9.1 0 .3 0 .4 0 2.3 0 4.3-1.8 4.5-4.1l3.2-37.5 41.3 5.7c2.4-.6 3.9-3 3.3-5.4-.6-2.4-3-3.9-5.4-3.3l-38.4-6.4 4.7-55.2h34.8c2.5 0 4.5-2 4.5-4.5s-2-4.5-4.5-4.5h-52.8l-35.1-17.8 1.4-2.6c.1-.3.3-.6.3-.9l3.7-14 82.3 3.1c.1 0 .1 0 .2 0 2.4 0 4.4-1.9 4.5-4.3.1-2.5-1.8-4.6-4.3-4.7l-80.3-3 15.5-58.4c16 3.8 34.2 6.3 54.4 6.3 3.4 0 6.9-.1 10.4-.2 2.5-.1 4.4-2.2 4.3-4.7-.1-2.5-2.2-4.4-4.7-4.3-23.3 1-44.1-1.6-62.1-6l5.1-19.3c15.8 3.6 29.9 4.5 40.2 4.5 10.5 0 17.1-1 17.7-1 2.5-.4 4.1-2.7 3.8-5.1-.4-2.5-2.7-4.1-5.1-3.8-.3 0-23.2 3.3-52.3-2.9l6.2-83 46.4 3.6c2.5.2 4.6-1.7 4.8-4.1.2-2.5-1.7-4.6-4.1-4.8L383.6 9l-18.9-34c-1.6-1.7-4.2-1.8-6.1-.4l-67.8 69.5c-10.7-15-19.2-32.6-25.5-52.9-.7-2.4-3.3-3.7-5.6-3-2.4.7-3.7 3.2-3 5.6 7 22.7 16.5 41 27.2 55.9l-20.7 17.5c-2.8-2-36.3-26.7-48-83.1-.5-2.4-2.9-4-5.3-3.5-2.4.5-4 2.9-3.5 5.3.7 3.6 1.6 7 2.5 10.3l-87.1 27.2c-12.6-11.8-8.4-37.4-8.3-37.6.4-2.4-1.2-4.8-3.6-5.2-2.5-.4-4.8 1.2-5.2 3.6-.2 1.2-4.4 26.4 7.8 42.1l-30.1 9.4c0 0 0 0 0-.1L61-16.7c-.8-2-2.9-3.1-5-2.7M333.7 223.9l-7.5 14.7-44-21.9 11.8-23.8 17.3 10c.6.4 1.3.6 2.1.6l27.4 1-3.1 11.6-2.4 4.6M310.5 78c7.4 6.2 15.1 11.3 22.6 15.4-.2.2-.3.4-.4.7l-8.8 17.8c-13.3-6.7-22.5-13.1-27-16.5l13.4-17.1C310.3 78.2 310.4 78.1 310.5 78zM291.2 102.5c4.9 3.8 14.6 10.6 28.6 17.7l-45.7 92.6L224 187.8 291.2 102.5zM343.1 195.6l-28.4-1.1-16.9-9.7 30-60.8c9 4.1 19.4 8 31.2 11.3L343.1 195.6zM361.4 126.5c-11.1-3.1-20.9-6.9-29.4-10.7l8.7-17.7c.1-.2.2-.4.2-.6 7 3.4 13.8 6 20.2 8.1 1.8.6 3.6 1.1 5.4 1.6L361.4 126.5zM361.1-15.8 376.9 15l-6.3 84c-2.2-.6-4.5-1.3-6.8-2-27.5-8.8-50.1-24.2-67.6-45.8L361.1-15.8zM303.8 72.2c-.2.2-.4.4-.6.6l-89.7 113.8 0 0-19.9 25.3-55.7-27L289.5 56.9C294.1 62.5 298.9 67.6 303.8 72.2zM94.6 174l26.9 13-29.1 24.6L94.6 174zM95.2 164.3l3.3-57.1 9.1-4.9 2.4 3.8V122c0 2.5 2 4.5 4.5 4.5h29.9c1.2 0 2.3-.4 3.1-1.2l32.3-30.9 22.4 24.6L129 180.7 95.2 164.3zM200.7 51.7l4.3 6.1-62.5 59.7h-23.7v-12.7c0-.9-.2-1.7-.7-2.4l-2.8-4.4L200.7 51.7zM256.3 73.2 209 113.1l-22.8-25L214 61.6c1.6-1.5 1.9-4 .6-5.8l-5.9-8.3 17.6-9.5C238.2 58.1 251.1 69.2 256.3 73.2zM221.9 30 99 96.7l3.3-57.7L211.5 4.9C214.6 14.3 218.1 22.7 221.9 30zM42.7 57.6l50.5-15.8L89.9 100l-49.4-3.4L42.7 57.6zM32.9 229.6l7.1-124 49.4 3.4L83 219.6l-26.4 22.3L32.9 229.6zM65.2 246.4l17.1-14.5L81 254.6 65.2 246.4zM137 283.6l-47.3-24.5 2-35.2 38.6-32.6 57.5 27.8L137 283.6zM201.8 215.9l16.5-20.9 51.8 25.8-11.2 22.8L201.8 215.9zM267 247.5l11.2-22.7 43.9 21.8-11.3 22L267 247.5zM318.9 272.6l13.3-26c0 0 0 0 0 0l0 0 8.3-16.3 36.1 18.3c.6.3 1.3.5 2 .5h10.1l-4.6 55L318.9 272.6z"/></g><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="45.5" cy="62.9" r="18.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="158.8" cy="177.3" r="12.8"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="228.2" cy="235" r="12.8"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="297.6" cy="157.2" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="20.8" cy="230.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="382.6" cy="250.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="374.7" cy="22.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="240.9" cy="111.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="182.7" cy="26" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="268.6" cy="95.6" r="13.6"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.0954" stroke-miterlimit="10" cx="63.2" cy="124.9" r="11.3"/></symbol><symbol id="matrix"><rect x="0" y="0.1" fill="#F4F4F4" width="400" height="299.9"/><rect x="0.3" y="0" fill="#E1E2E3" width="92.8" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0.5" x2="199.7" y2="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="300"/><rect x="14.7" y="46.4" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="79.7" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="114" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="148.5" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="182.3" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="215.3" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="248.6" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="281.5" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="15.2" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="0" y="0" fill="#D0D2D3" width="399.8" height="30.4"/></symbol><symbol id="multiRowCard"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><rect x="22" y="21" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="91" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="160.3" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="231" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="36.7" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="46.2" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="36.7" y="105.4" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="116.1" fill="#D0D2D3" width="46.3" height="7.7"/><rect x="36.7" y="174.7" fill="#ACACAC" width="65.8" height="7.7"/><rect x="36.7" y="185.4" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="36.7" y="245.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="256.2" fill="#D0D2D3" width="28.2" height="7.7"/><rect x="163.1" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="163.1" y="46.2" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="163.1" y="105.4" fill="#ACACAC" width="56.4" height="7.7"/><rect x="163.1" y="116.1" fill="#D0D2D3" width="46.3" height="7.7"/><rect x="163.1" y="174.7" fill="#ACACAC" width="65.8" height="7.7"/><rect x="163.1" y="185.4" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="163.1" y="245.5" fill="#ACACAC" width="39.3" height="7.7"/><rect x="163.1" y="256.2" fill="#D0D2D3" width="28.2" height="7.7"/><rect x="289.5" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="289.5" y="46.2" fill="#D0D2D3" width="75.4" height="7.7"/><rect x="289.5" y="105.4" fill="#ACACAC" width="37.7" height="7.7"/><rect x="289.5" y="116.1" fill="#D0D2D3" width="87.4" height="7.7"/><rect x="289.5" y="174.7" fill="#ACACAC" width="28.2" height="7.7"/><rect x="289.5" y="185.4" fill="#D0D2D3" width="56.4" height="7.7"/><rect x="289.5" y="245.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="289.5" y="256.2" fill="#D0D2D3" width="87.4" height="7.7"/></symbol><symbol id="pie"><rect y="0.2" fill="#F4F4F4" width="400" height="299.8"/><path fill="#929497" d="M200 55.3v94.8l60.8 72.7c20.8-17.4 34-43.5 34-72.7v0C294.8 97.7 252.3 55.3 200 55.3z"/><path fill="#D0D2D3" d="M105.2 150.1c0 44.4 30.6 81.7 71.8 92l23-92H105.2z"/><path fill="#E1E2E3" d="M200 150.1l-23 92c7.4 1.8 15.1 2.8 23 2.8 23.1 0 44.3-8.3 60.8-22.1L200 150.1z"/><path fill="#A6A8AB" d="M200 55.3c-52.3 0-94.8 42.4-94.8 94.8v0H200V55.3z"/></symbol><symbol id="scatterplot"><rect x="1.3" y="0" fill="#F4F4F4" width="398.7" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="133.9" y1="0.4" x2="133.9" y2="298"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="266.9" y1="0.4" x2="266.9" y2="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="149.8" x2="400" y2="149.8"/><circle fill="#D0D2D3" cx="74.9" cy="214.1" r="36.2"/><circle fill="#D0D2D3" cx="186" cy="94" r="12.9"/><circle fill="#D0D2D3" cx="266.9" cy="124.1" r="17.2"/><circle fill="#D0D2D3" cx="310.4" cy="193.8" r="26.3"/><circle fill="#D0D2D3" cx="214.5" cy="176.3" r="18.6"/><circle fill="#D0D2D3" cx="137" cy="150.2" r="12.9"/><circle fill="#D0D2D3" cx="346.4" cy="68.1" r="12.9"/></symbol><symbol id="shapeMap"><rect x="0.7" y="0" opacity="0.5" fill="#F4F4F4" width="401.4" height="302.1"/><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#EEEEEE" d="M379.2 0H400v10.75l-14.2-1.5c-1.672-.266-2.738-1.016-3.2-2.25L379.2 0zM218.775 0h39c7.22 18.663 16.17 35.087 26.85 49.275L261.85 68.55C243.634 49.55 229.275 26.7 218.775 0zM0 62V0h57.725L73.15 38.875 0 62zM78.175 300H1.25l55.925-47.325L80.2 264.775 78.175 300zM231.05 300h-96.475l60.575-76.7 59.575 28.851L231.05 300zM400 206.675v34.575h-18.5l-37.15-18.025 1.825-3.475 3.875-14.825L400 206.675zM400 142.875v55.05l-47.675-1.649 15.725-59.95C378.267 138.94 388.917 141.123 400 142.875zM361.275 125.875c-10.32-2.924-20.153-6.332-29.5-10.225l9.5-19.175c7.915 3.922 16.273 7.272 25.074 10.05L361.275 125.875zM326.425 238.75 281.6 217.025 293.45 193.1l17.3 9.15c1.639.954 3.472 1.454 5.5 1.5l24.4.85-3.7 14.15L326.425 238.75zM304.65 71.4 192.9 212.875l-56.4-27.3 153.325-129.75C294.472 61.398 299.414 66.59 304.65 71.4zM121.25 187.5l-30.1 25.475L93.375 174 121.25 187.5zM39.55 105.2l49.6 3.2-6.375 111.65L56.25 242.475l-24.7-12.949L39.55 105.2zM258.45 244.65l-57.976-28.101 17.075-21.625L270.4 220.5 258.45 244.65z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M369.4 0l7.024 14.975L371 99.15c-30.688-8.892-55.647-25.2-74.875-48.925L345.425 0H369.4zM400 114.05v20.15c-10.34-1.591-20.281-3.575-29.825-5.95l5-19.175C383.115 111.174 391.39 112.833 400 114.05zM333.675 0l-42.85 43.325C281.736 30.743 274.086 16.301 267.875 0H333.675zM353.45 300H304l10.05-19.1L353.45 300zM240.55 300l21.825-44.15 43.9 21.275L294.25 300H240.55zM0 212.95V102.675l30.925 1.975-7.75 120.475L0 212.95zM111.975 0H196.1l-75.025 23.725C115.636 18.07 112.603 10.162 111.975 0zM0 290.075v-67.4l49.175 25.8L0 290.075zM124.1 300H86.175l1.775-31.15 42.95 22.525L124.1 300zM392.025 300l5.225-49.85H400V300H392.025zM384.275 300H372.7l-54.75-26.525 22.524-42.875 37.551 18.226c1.563.898 3.389 1.34 5.475 1.325h6L384.275 300zM359.175 133.9l-16.25 62.05L316 195l-18.6-9.875 30.75-62.15C337.978 127.132 348.319 130.773 359.175 133.9zM295.35 96.425l15.5-19.625c7.126 5.878 14.751 11.103 22.875 15.675l-9.774 19.75C313.812 107.567 304.277 102.3 295.35 96.425zM199.925 51.6l4.575 5.9-62 59.75h-25.3l.75-11.25c-.098-2.051-.498-3.617-1.2-4.7L114.3 98 199.925 51.6zM40.075 97l2.575-39.975L93 41.1l-3.375 59.075L40.075 97zM80.75 255.325l-16.475-8.65L82.1 231.6 80.75 255.325zM136.325 284.5 88.5 259.4l2-34.9 39-33 58.075 28.125L136.325 284.5zM310.175 269.7 266.1 248.35l11.95-24.149 44.65 21.649L310.175 269.7z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#F8F8F8" d="M66.725 0h36.325c.458 11.727 3.549 20.561 9.275 26.5L81.15 36.35 66.725 0zM0 94.425V70.5l33.8-10.675L31.45 96.45 0 94.425zM400 19.825V105.1c-6.929-.898-13.62-2.106-20.075-3.625l5.351-83.225L400 19.825zM223.075 29.2l-125.3 67.925 3.35-58.6L211.05 3.775C214.647 12.659 218.656 21.134 223.075 29.2zM207.675 47.4l19.7-10.7c8.162 13.625 17.57 26 28.225 37.125l-46.875 39.65-23.3-25.825L213.5 60.6c1.147-1.6 1.364-3.2.65-4.8L207.675 47.4zM320.35 119.525l-46.399 93.8-51.3-24.851 67.675-85.7C299.695 108.996 309.704 114.579 320.35 119.525zM179.125 93.725l22.925 25.4-73.775 62.45L93.9 164.925l3.3-57.625 9.7-5.275 2.95 3.975-1 15.1c.133 3.4 1.916 5.15 5.35 5.25h28.65c1.682.015 3.099-.568 4.25-1.75L179.125 93.725z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#D9D9D9" d="M400 10.75v9.075l-14.725-1.575-5.351 83.225c6.455 1.519 13.146 2.727 20.075 3.625v8.95c-8.61-1.217-16.885-2.875-24.825-4.975l-5 19.175c9.544 2.375 19.485 4.359 29.825 5.95v8.675c-11.083-1.752-21.733-3.935-31.95-6.55l-15.725 59.95L400 197.925v8.75l-49.95-1.75-3.875 14.825-1.825 3.475 37.15 18.025H400v8.9h-2.75L392.025 300h-7.75l5.225-49.85h-6c-2.086.015-3.911-.427-5.475-1.325L340.475 230.6l-22.524 42.875L372.7 300h-19.25l-39.4-19.1L304 300h-9.75l12.025-22.875-43.9-21.275L240.55 300h-9.5l23.675-47.85L195.15 223.3 134.575 300H124.1l6.8-8.625L87.95 268.85 86.175 300h-8l2.025-35.225-23.025-12.101L1.25 300H0v-9.925l49.175-41.601L0 222.675v-9.725l23.175 12.175 7.75-120.475L0 102.675v-8.25l31.45 2.025 2.35-36.625L0 70.5V62l73.15-23.125L57.725 0h9L81.15 36.35l31.175-9.85c-5.726-5.939-8.818-14.773-9.275-26.5h8.925c.627 10.162 3.661 18.07 9.1 23.725L196.1 0h22.675c10.5 26.7 24.858 49.55 43.074 68.55l22.775-19.275c-10.68-14.188-19.63-30.612-26.85-49.275h10.1c6.211 16.301 13.861 30.743 22.95 43.325L333.675 0h11.75l-49.3 50.225C315.353 73.95 340.312 90.258 371 99.15l5.425-84.175L369.4 0h9.8l3.399 7c.462 1.234 1.528 1.984 3.2 2.25L400 10.75zM361.275 125.875l5.074-19.35c-8.801-2.778-17.159-6.128-25.074-10.05l-9.5 19.175C341.122 119.543 350.955 122.951 361.275 125.875zM359.175 133.9c-10.855-3.126-21.197-6.768-31.024-10.925l-30.75 62.15L316 195l26.925.95L359.175 133.9zM326.425 238.75l10.525-20 3.7-14.15-24.4-.85c-2.028-.046-3.861-.546-5.5-1.5l-17.3-9.15L281.6 217.025 326.425 238.75zM304.65 71.4c-5.236-4.81-10.179-10.001-14.825-15.575L136.5 185.575l56.4 27.3L304.65 71.4zM295.35 96.425c8.928 5.875 18.462 11.142 28.601 15.8l9.774-19.75c-8.124-4.572-15.749-9.797-22.875-15.675L295.35 96.425zM223.075 29.2c-4.419-8.066-8.428-16.541-12.025-25.425l-109.925 34.75-3.35 58.6L223.075 29.2zM207.675 47.4l6.476 8.4c.714 1.6.497 3.2-.65 4.8l-28.075 27.05 23.3 25.825 46.875-39.65c-10.654-11.125-20.063-23.5-28.225-37.125L207.675 47.4zM199.925 51.6 114.3 98l2.45 3.3c.703 1.083 1.103 2.649 1.2 4.7l-.75 11.25h25.3l62-59.75L199.925 51.6zM320.35 119.525c-10.646-4.946-20.654-10.529-30.024-16.75l-67.675 85.7 51.3 24.851L320.35 119.525zM179.125 93.725 147.1 124.6c-1.151 1.182-2.568 1.765-4.25 1.75H114.2c-3.434-.1-5.217-1.85-5.35-5.25l1-15.1-2.95-3.975-9.7 5.275-3.3 57.625 34.375 16.65 73.775-62.45L179.125 93.725zM40.075 97l49.55 3.175L93 41.1 42.65 57.025 40.075 97zM121.25 187.5 93.375 174l-2.225 38.975L121.25 187.5zM39.55 105.2l-8 124.325 24.7 12.949 26.525-22.425L89.15 108.4 39.55 105.2zM136.325 284.5l51.25-64.875L129.5 191.5l-39 33-2 34.9L136.325 284.5zM80.75 255.325 82.1 231.6l-17.825 15.075L80.75 255.325zM258.45 244.65l11.95-24.15-52.851-25.575-17.075 21.625L258.45 244.65zM310.175 269.7 322.7 245.85 278.05 224.2 266.1 248.35 310.175 269.7z"/></g></symbol><symbol id="slicer"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.1" height="300"/><rect x="11.8" y="17.7" fill="#D0D2D3" width="34.7" height="15.3"/><rect x="34.1" y="57" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="55" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="12.8" y="79" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="105" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="103" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="129" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="127" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="153" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="151" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="177" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="175" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="201" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="199" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="225" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="223" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="249" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="247" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="273" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="271" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="81.7" fill="#D0D2D3" width="33.8" height="7.7"/><line fill="none" stroke="#D0D2D3" stroke-miterlimit="10" x1="3.4" y1="44.3" x2="389.4" y2="44.3"/></symbol><symbol id="stackedarea"><rect id="XMLID_263_" x="0" opacity="0.5" fill="#F1F2F2" width="400" height="300"/><line id="XMLID_262_" opacity="0.5" fill="#F4F4F4" x1="0" y1="38" x2="400" y2="38"/><line id="XMLID_261_" opacity="0.5" fill="#F4F4F4" x1="0" y1="75.4" x2="400" y2="75.4"/><line id="XMLID_260_" opacity="0.5" fill="#F4F4F4" x1="0" y1="112.8" x2="400" y2="112.8"/><line id="XMLID_259_" opacity="0.5" fill="#F4F4F4" x1="0" y1="150.3" x2="400" y2="150.3"/><line id="XMLID_258_" opacity="0.5" fill="#F4F4F4" x1="400" y1="187.7" x2="0" y2="187.7"/><line id="XMLID_257_" opacity="0.5" fill="#F4F4F4" x1="0" y1="225.1" x2="400" y2="225.1"/><line id="XMLID_256_" opacity="0.5" fill="#F4F4F4" x1="0" y1="262.6" x2="400" y2="262.6"/><polygon id="XMLID_242_" fill="#A6A8AB" points="0,107.5 83.6,96.9 139.6,113 200,97.1 265.8,116.6 336,107.7 400,116.3 400,199.3\t  0,199.3 "/><polygon id="XMLID_239_" fill="#D0D2D3" points="0,157.6 60.4,153 132.4,169.6 216.9,159 279.1,177.7 334.2,162.7 400,172.5 400,253.2\t  0,253.2 "/><polygon id="XMLID_236_" fill="#E1E2E3" points="0,224.1 69.3,241.5 156,219.5 252,241.5 332,219.5 400,227.8 400,300 0,300 "/><polyline id="XMLID_138_" fill="none" stroke="#797A7A" stroke-width="4" stroke-miterlimit="10" points="0,107.5 83.6,96.9 139.6,113 200,97.1 265.8,116.6 336,107.7 400,116.3 "/><polyline id="XMLID_294_" fill="none" stroke="#929497" stroke-width="4" stroke-miterlimit="10" points="0,157.6 60.4,153 132.4,169.6 216.9,159 279.1,177.7 334.2,162.7 400,172.5 "/><polyline id="XMLID_301_" fill="none" stroke="#A6A8AB" stroke-width="4" stroke-miterlimit="10" points="0,224.1 69.3,241.5 156,219.5 252,241.5 332,219.5 400,227.8 "/></symbol><symbol id="stackedbar"><rect y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#E1E2E3" width="179.9" height="39"/><rect x="0" y="74.7" fill="#E1E2E3" width="253.4" height="39"/><rect x="0" y="129.8" fill="#E1E2E3" width="224.6" height="39"/><rect x="0" y="184" fill="#E1E2E3" width="311.1" height="39"/><rect x="0" y="241" fill="#E1E2E3" width="367.2" height="39"/><rect x="0" y="20.6" fill="#D0D2D3" width="138.7" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="195.3" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="173.1" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="239.8" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="283" height="39"/><rect x="0" y="20.6" opacity="0.5" fill="#A6A8AB" width="90.2" height="39"/><rect x="0" y="74.7" opacity="0.5" fill="#A6A8AB" width="127" height="39"/><rect x="0" y="129.8" opacity="0.5" fill="#A6A8AB" width="112.5" height="39"/><rect x="0" y="184" opacity="0.5" fill="#A6A8AB" width="155.9" height="39"/><rect x="0" y="241" opacity="0.5" fill="#A6A8AB" width="184" height="39"/></symbol><symbol id="stackedcolumn"><rect x="0.2" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="73.4" x2="400.2" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="147.9" x2="400.2" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="222.3" x2="400.2" y2="222.3"/><rect x="19.3" y="193.2" fill="#E1E2E3" width="40.9" height="106.9"/><rect x="83.3" y="167.7" fill="#E1E2E3" width="40.9" height="132.4"/><rect x="147.3" y="187.7" fill="#E1E2E3" width="40.9" height="112.4"/><rect x="211.3" y="82" fill="#E1E2E3" width="40.9" height="218.1"/><rect x="275.4" y="39.8" fill="#E1E2E3" width="40.9" height="260.3"/><rect x="339.4" y="122.3" fill="#E1E2E3" width="40.9" height="177.9"/><rect x="19.3" y="219.2" fill="#D0D2D3" width="40.9" height="80.9"/><rect x="83.3" y="199.9" fill="#D0D2D3" width="40.9" height="100.2"/><rect x="147.3" y="215.1" fill="#D0D2D3" width="40.9" height="85"/><rect x="211.3" y="129.8" fill="#D0D2D3" width="40.9" height="170.3"/><rect x="275.4" y="103.2" fill="#D0D2D3" width="40.9" height="197"/><rect x="339.4" y="165.6" fill="#D0D2D3" width="40.9" height="134.6"/><rect x="19.3" y="254" opacity="0.5" fill="#A6A8AB" width="40.9" height="46.1"/><rect x="83.3" y="243" opacity="0.5" fill="#A6A8AB" width="40.9" height="57.1"/><rect x="147.3" y="251.6" opacity="0.5" fill="#A6A8AB" width="40.9" height="48.5"/><rect x="211.3" y="206.1" opacity="0.5" fill="#A6A8AB" width="40.9" height="94.1"/><rect x="275.4" y="187.8" opacity="0.5" fill="#A6A8AB" width="40.9" height="112.3"/><rect x="339.4" y="223.4" opacity="0.5" fill="#A6A8AB" width="40.9" height="76.7"/></symbol><symbol id="table"><rect x="0" y="0" fill="#F4F4F4" width="399.8" height="265.4"/><rect x="0" y="0" fill="#D0D2D3" width="399.8" height="30.1"/><rect x="14.4" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="64.8" x2="400" y2="64.8"/><rect x="14.4" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="98.6" x2="399.3" y2="98.6"/><rect x="14.4" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="132.7" x2="400" y2="132.7"/><rect x="14.4" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="166.2" x2="400" y2="166.2"/><rect x="14.4" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="198.8" x2="400" y2="198.8"/><rect x="14.4" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="231.7" x2="400" y2="231.7"/><rect x="14.4" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="0" y="265.4" fill="#F4F4F4" width="399.3" height="34.6"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="265.4" x2="400" y2="265.4"/><rect x="14.4" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/></symbol><symbol id="tree"><rect x="204.3" y="0" fill="#E1E2E3" width="195.3" height="150"/><rect x="0" y="0" fill="#D0D2D3" width="204.3" height="150"/><rect x="0" y="150" fill="#E1E2E3" width="180.9" height="79.6"/><rect x="0" y="229.6" fill="#A6A8AB" width="180.9" height="70.4"/><rect x="180.9" y="150" fill="#F4F4F4" width="121.1" height="103.8"/><rect x="302" y="150" opacity="0.5" fill="#A6A8AB" width="97.7" height="103.8"/><rect x="180.9" y="253.8" fill="#E1E2E3" width="218.8" height="46.2"/></symbol><symbol id="waterfall"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.3" height="299.6"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.1" x2="400.2" y2="73.1"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.6" x2="400.2" y2="147.6"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222" x2="400.2" y2="222"/><rect x="75.3" y="128" fill="#D0D2D3" width="44" height="89.1"/><rect x="143.8" y="27.1" fill="#D0D2D3" width="44" height="103"/><rect x="212.3" y="27.1" fill="#D0D2D3" width="44" height="205.3"/><rect x="280.8" y="230.2" fill="#D0D2D3" width="44" height="55"/><rect x="349.2" y="283.1" fill="#D0D2D3" width="44" height="16.5"/><rect x="6.9" y="214.9" fill="#D0D2D3" width="44" height="84.7"/><rect x="50.8" y="214.9" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="119.3" y="128" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="187.8" y="27.1" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="256.3" y="230.2" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="324.7" y="283.1" fill="#D0D2D3" width="24.5" height="2.1"/></symbol><symbol id="scriptvisual"><rect x="0" y="0" fill="#F4F4F4" width="400" height="100"/><rect x="0" y="100" fill="#FFFFFF" width="400" height="100"/><rect x="0" y="200" fill="#F4F4F4" width="400" height="100"/><path fill="#E1E2E3" d="M138.8 90h-65.5v-8h65.5V90z"/><path fill="#E1E2E3" d="M22.3 81l-8.2-9.7 25.1-21.2-25.1-21.3 8.2-9.7 35.9 30.3v1.4L22.3 81z"/><path fill="#E1E2E3" d="M168.2 193.4h-14.5v-14.5h14.5V193.4z"/><path fill="#E1E2E3" d="M199.3 160.2v33.4h-16v-87.2h36.3c3 0 6 .5 9.1 1.5 3.1 1.1 5.9 2.6 8.4 4.8 2.5 2.1 4.6 4.9 6.2 8.3 1.6 3.4 2.4 7.5 2.4 12.3 0 3.6-.4 6.6-1.3 9.4-.8 2.8-2 5.1-3.5 7.2-1.5 2-3.2 3.8-5.2 5.2-1.9 1.4-4 2.5-6.2 3.3l18.5 35.1h-17.2l-16.6-33.4h-14.9V160.2zM217.2 145.5c1.4 0 2.8-.2 4.3-.5 1.5-.4 2.9-1.1 4.2-2 1.2-1 2.4-2.2 3.2-3.7.8-1.5 1.2-3.5 1.2-5.9 0-2.4-.4-4.4-1.2-5.9-.9-1.6-1.9-2.8-3.2-3.8-1.2-1-2.6-1.6-4.2-2-1.5-.4-2.9-.6-4.3-.6h-18v24.3L217.2 145.5 217.2 145.5z"/></symbol><symbol id="visioVisual"><rect x="0" y="0" width="400" height="300" style="fill:#f4f4f4"/><g transform="translate(-99.772966,-149.88962)"><rect x="345.18201" y="266.92099" transform="matrix(-0.7071,0.7071,-0.7071,-0.7071,794.8842,218.5744)" width="13.983" height="13.983" id="rect4171" style="fill:#a6a8ab"/><path d="m220 227.412 0 145.176 90.435 17.412 0-180L220 227.412Zm50.302 108.264-15.251-.554-18.794-70.533 14.875.18 11.474 48.627c.146.602.275 1.183.391 1.746.129-.618.271-1.243.421-1.871l11.512-48.217 14.851.177-19.479 70.445z" style="fill:#a6a8ab"/><path d="m338.261 306.957 0 13.912 10.435 0 0-30.709-11.029-11.029-20.274 0 0 24.348 17.391 0c1.921 0 3.477 1.555 3.477 3.478" style="fill:#a6a8ab"/><path d="m376.521 230.87-59.13 0 0 41.304 16.797 0 16.756-16.752c.336-.343.781-.513 1.229-.513.445 0 .894.17 1.236.513l17.256 17.262c.679.676.679 1.783 0 2.459l-15.014 15.021 0 34.185c0 1.923-1.556 3.479-3.479 3.479l-13.913 0 0 10.435c0 1.923-1.556 3.479-3.479 3.479l-17.391 0 0 27.392 58.797 0c2.106 0 3.812-3.193 3.812-5.299l0-129.487c.002-2.11-1.37-3.478-3.477-3.478" style="fill:#a6a8ab"/><polygon points="317.392,334.782 331.305,334.782 331.305,327.826 331.305,320.869 331.305,310.435 317.392,310.435 " style="fill:#a6a8ab"/></g></symbol><symbol id="ribbon"><rect fill="#F4F4F4" width="400" height="73"/><rect y="75.667" fill="#F4F4F4" width="400" height="73"/><rect y="227" fill="#F4F4F4" width="400" height="73"/><rect y="151.333" fill="#F4F4F4" width="400" height="73"/><path opacity="0.6" fill="none" d="M64.642 247.169c0 0 1.199.312 3.219.09C65.837 246.993 64.642 247.169 64.642 247.169z"/><path opacity="0.6" fill="none" d="M123.897 240.718c2.53.326 4.058.006 4.058.006S126.486 240.223 123.897 240.718z"/><path opacity="0.6" fill="none" d="M233.476 235.959c0 0-1.221-.088-3.23.25C232.257 236.296 233.476 235.959 233.476 235.959z"/><path opacity="0.6" fill="none" d="M170.163 240.724c0 0 1.045.24 2.791.078C171.192 240.569 170.163 240.724 170.163 240.724z"/><path opacity="0.6" fill="#D0D2D3" d="M67.861 247.259c5.631-.62 17.651-5.409 27.929-32.763-14.13-24.423-31.148-22.512-31.148-22.512H22.433v55.185h42.209C64.642 247.169 65.837 246.993 67.861 247.259z"/><path opacity="0.6" fill="#D0D2D3" d="M172.954 240.801c-1.746.163-2.791-.078-2.791-.078h-42.209c0 0-1.528.32-4.058-.006-5.385 1.03-15.622 6.374-27.599 29.532-.28.541-.559 1.073-.837 1.595.28.533.559 1.072.837 1.628 14.44 28.857 31.656 26.303 31.656 26.303h42.209c0 0 19.623 3.06 30.908-31.153l0 0C190.339 245.761 178.283 241.505 172.954 240.801z"/><path opacity="0.6" fill="#BCBEBF" d="M335.358 213.967h42.209v85.808h-42.209l-59.674 0h-42.209c0 0-17.217 2.612-31.656-29.525-.249-.554-.498-1.095-.749-1.628 8.574-25.994 22.823-31.343 29.175-32.413 2.011.087 3.23-.25 3.23-.25h42.209c0 0 21.015.295 29.437-10.848C313.543 213.967 335.358 213.967 335.358 213.967z"/><path opacity="0.6" fill="#BCBEBF" d="M67.861 247.259c-2.02.222-3.219-.09-3.219-.09H22.433v52.605h42.209c0 0 13.485 4.616 30.819-27.93C85.031 252.002 73.372 247.984 67.861 247.259z"/><path opacity="0.6" fill="#BCBEBF" d="M123.897 240.718c2.589-.495 4.058.006 4.058.006h42.209c0 0 1.029-.155 2.791.078 5.789-.539 19.302-5.515 28.139-38.431v0c-12.263-23.359-30.929-23.363-30.929-23.363h-42.209c0 0-17.577-4.662-31.633 34.056-.177.486-.354.961-.532 1.433.476.823.949 1.674 1.418 2.558C107.198 235.888 118.143 239.976 123.897 240.718z"/><path opacity="0.6" fill="#B2B2B2" d="M123.897 240.718c-5.754-.741-16.699-4.83-26.689-23.663-.469-.884-.942-1.735-1.418-2.558-10.278 27.354-22.298 32.143-27.929 32.763 5.511.725 17.17 4.743 27.6 24.585.278-.522.557-1.054.837-1.595C108.275 247.091 118.512 241.747 123.897 240.718z"/><path opacity="0.6" fill="#B2B2B2" d="M230.246 236.209c-5.541-.24-17.102-3.706-25.78-26.346-1.048-2.734-2.181-5.222-3.374-7.493v0c-8.836 32.916-22.35 37.892-28.139 38.431 5.33.703 17.386 4.959 28.117 27.82C209.644 242.627 223.894 237.279 230.246 236.209z"/><path opacity="0.6" fill="#E1E2E3" d="M335.358 129.225h42.209V24.001h-42.209c0 0-22.303-.416-31.726 21.046s-27.948 18.54-27.948 18.54h-42.209c0 0-22.044 1.959-32.816 13.804-10.772 11.845-30.497 12.829-30.497 12.829h-42.209c0 0-18.557-.045-32.423 10.911-13.156 10.395-30.89 10.395-30.89 10.395H22.433v80.459h42.209c0 0 23.238-1.338 32.227-6.606 11.174-6.547 31.086-6.372 31.086-6.372h42.209c0 0 20.992-.409 29.512-7.828 12.867-11.204 33.8-8.966 33.8-8.966h42.209c0 0 20.543 1.101 30.534-16.879S335.358 129.225 335.358 129.225z"/><path opacity="0.6" fill="#D0D2D3" d="M275.685 162.213c0 0 20.543 1.101 30.534-16.879s29.14-16.109 29.14-16.109h42.209v84.742h-42.209c0 0-21.816 0-30.237 11.143-8.421 11.143-29.437 10.848-29.437 10.848h-42.209c0 0-1.221-.088-3.23.25-5.541-.24-17.102-3.706-25.78-26.346-1.048-2.734-2.181-5.222-3.374-7.493 11.502-42.844 32.384-40.157 32.384-40.157H275.685"/><rect x="22.433" y="111.525" fill="#DDDDDD" width="42.209" height="80.459"/><rect x="22.433" y="191.984" fill="#D0D2D3" width="42.209" height="55.185"/><rect x="22.433" y="247.169" fill="#BCBEBF" width="42.209" height="52.605"/><rect x="127.955" y="90.219" fill="#DDDDDD" width="42.209" height="88.788"/><rect x="127.955" y="179.007" fill="#BCBEBF" width="42.209" height="61.717"/><rect x="127.955" y="240.724" fill="#D0D2D3" width="42.209" height="59.051"/><rect x="233.476" y="63.586" fill="#DDDDDD" width="42.209" height="98.627"/><rect x="233.476" y="162.213" fill="#D0D2D3" width="42.209" height="73.746"/><rect x="233.476" y="235.959" fill="#BCBEBF" width="42.209" height="63.816"/><rect x="335.358" y="24.001" fill="#DDDDDD" width="42.209" height="105.224"/><rect x="335.358" y="129.225" fill="#D0D2D3" width="42.209" height="84.742"/><rect x="335.358" y="213.967" fill="#BCBEBF" width="42.209" height="85.808"/></symbol></svg>'),
e.put("views/taskPane.html",'<article class="taskPane sidePane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" modeling-context-changer><div class="paneHeader"> <button class="toggleBtn" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggleTaskPane()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><h2 class="sidePaneHorizontalTitle sidePaneTitle unselectable fieldsTab largeFontSize trimmedTextWithEllipsis" ng-if="viewModel.isPaneExpanded" localize="TaskPane_Fields"></h2><div class="verticalTitle"><h2 class="largeFontSize" localize="TaskPane_Fields"></h2></div></button></div><div class="paneContents" ng-if="viewModel.isPaneExpanded"><field-list field-list-config="::fieldListConfig"></field-list></div></article>'),e.put("views/virtualList.html",'<div class="virtual-list-container"><ng-scrollbars class="virtual-list" ng-scrollbars-config="::scrollbarsConfig"><ng-transclude></ng-transclude></ng-scrollbars></div>'),e.put("views/visualContainer.html",'<div class="visualContainer unselectable" canvas-visual-error canvas-layout-item="{{!isInViewMode()}}" drop="dropConfig" drop-handler="drop(event, ui)" ng-click="toggleSelect($event, false)" double-click="onDoubleClick($event)" fast-focus="toggleSelect($event, true)" fast-touchend="onTouchend($event)" ng-class="getVisualContainerStyle()" apply-style="::viewModel.readOnlyState.style" tabindex="0" transform="{{!isInViewMode()}}" transform-restriction="parent" transform-restrict-draw="{{shouldRestrictTransformDraw()}}" auto-scroll-parent-selector=".displayArea" drag-resize-disabled="{{viewModel.disableResize || viewModeState.getMode() === 0 || hasPositionOverride()}}" toolbar-anchor focus-element aria-label="{{viewModel.tooltip}}" preserve-aspect-ratio="{{viewModel.lockAspectRatio}}"><div class="visualContainerBorder"></div><div class="visualContainerScreen"></div><toolbar-overlay ng-if="viewModel.toolbarViewModel" view-model="viewModel.toolbarViewModel"></toolbar-overlay><spinner delay="1000" class="xsmall" ng-if="viewModel.showProgressBar"></spinner><visual-container-header visual="::viewModel" menu-options="::menuOptions" disable-pin="disablePin" show-warning-details="ctrlError.showWarningDetails()" show-transform-warning-details="ctrlError.showTransformWarningDetails()" show-info-details="ctrlError.showInfoDetails()" on-visual-container-changed="onVisualContainerChanged()" ng-if="isHeaderVisible()"></visual-container-header><i class="removeFromLayout itemIcon glyphicon pbi-glyph-close glyph-mini" ng-click="removeVisualFromLayout()" ng-if="canRemoveFromLayout()"></i><visual-container-pop-out-bar ng-if="isPopOutBarVisible()"></visual-container-pop-out-bar><div class="vcBody" ng-if="!viewModel.showWatermark" apply-style="::viewModel.readOnlyState.visualViewportStyle" ng-click="onVCBodyClick($event)" ng-class="vcBodyStyle" ng-attr-title="{{vcBodyTitle}}"><div class="visualTitle preTextWithEllipsis" ng-if="viewModel.visualTitleVisible()" title="{{viewModel.visualTitle.text}}" apply-style="::viewModel.readOnlyState.titleStyle" ng-bind="viewModel.visualTitle.text"></div><visual aria-hidden="true" view-model="viewModel.readOnlyState.visual" allow-deferred-rendering="::viewModel.allowDeferredRendering"></visual><detail-visual ng-if="viewModel.contract.visibility === 2 || viewModel.contract.visibility === 8" view-model="viewModel.readOnlyState.detailVisual"></detail-visual><canvas-visual-error-overlay ng-if="viewModel.errorInfo" error-info="viewModel.errorInfo" view-mode="viewModeState.getMode()" viewport="viewModel.position" show-error-details="ctrlError.showErrorDetails()" fix-errors="ctrlError.fixErrors()"></canvas-visual-error-overlay></div><div class="vcBody" ng-if="viewModel.showWatermark" apply-style="::viewModel.readOnlyState.visualViewportStyle" ng-click="onVCBodyClick($event)" ng-class="vcBodyStyle" ng-attr-title="{{vcBodyTitle}}"><visual-watermark visual-type="viewModel.contract.config.singleVisual.visualType"></visual-watermark></div></div>'),e.put("views/visualContainerPopOutBar.html",'<ul class="popOutBar"><li> <button ng-click="closePopOut()"><i class="glyphicon iconBox pbi-glyph-chevronleftmedium glyph-small"></i><span class="menuItem" localize="VisualContainer_PopOut_BackToReportButton"></span></button></li><li class="divider"></li><li class="title trimmedTextWithEllipsis" ng-bind="viewModel.readOnlyState.popOutBarTitle" title="{{viewModel.readOnlyState.popOutBarTitle}}"></li><li class="subtitle" ng-bind="viewModel.readOnlyState.popOutBarSubtitle"></li><li class="visualLastRefreshTime" ng-if="viewModel.lastUpdateAttemptTime"><span localize="ReportAppBar_LastRefresh"></span><span class="dataUpdatedTime" ng-bind="viewModel.lastUpdateAttemptTime"></span></li></ul>'),e.put("views/visualizationPane.html",'<article class="visualizationPane sidePane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" modeling-context-changer><div class="paneHeader"> <button class="toggleBtn" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggle()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><h2 class="sidePaneHorizontalTitle unselectable sidePaneTitle largeFontSize trimmedTextWithEllipsis" ng-bind="viewModel.header" ng-show="viewModel.isPaneExpanded"></h2><h2 class="verticalTitle verticalText" ng-show="!viewModel.isPaneExpanded"><span class="collapsedVisualsTitle largeFontSize" localize="VisualizationPane_Title" ng-show="populatePanes"></span><span class="collapsedFiltersTitle largeFontSize" localize="VisualizationPane_Filters"></span></h2></button></div><div class="paneContents flex" ng-if="viewModel.isPaneExpanded"><section ng-if="showVisualTypes" class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig"><visual-types-container visual-plugin-filter="viewModel.visualPluginFilter"></visual-types-container></section><nav class="sectionHeader item-auto" ng-if="viewModel.sections.length && !isNonQueryVisual && populatePanes"><ul><li ng-repeat="section in viewModel.sections" ng-click="setActiveSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activeSection}" title="{{::section.displayName}}"><i ng-class="[\'sectionIcon\', section.cssClass]"></i></li></ul></nav><nav class="sectionHeader item-auto" ng-if="viewModel.pagePaneSections.length && populatePanes"><ul><li ng-repeat="section in viewModel.pagePaneSections" ng-click="setActivePagePaneSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activePageSection}" title="{{::section.displayName}}"><i ng-class="[\'sectionIcon\', section.cssClass]"></i></li></ul></nav><div class="sectionHost item-fill" ng-if="showFieldWellOrFilters" ng-class="{\'readOnly\' : !populatePanes}"><ng-scrollbars ng-scrollbars-config="::scrollbarsConfig"><section ng-if="showFieldWell" class="lazy-load-wrapper" pbi-lazy-load-contents="exploreUIShellConfig"><field-well></field-well></section><h3 class="sectionHeader" ng-if="showFieldWell || showVisualTypes"><span class="sectionTitle sidePaneTitle unselectable largeFontSize" localize="VisualizationPane_Filters"></span></h3><filter-pane></filter-pane></ng-scrollbars></div><section ng-if="showPropertyPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><property-pane></property-pane></section><section ng-if="showPagePropertyPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><page-property-pane></page-property-pane></section><section ng-if="showAnalyticsPane" class="lazy-load-wrapper stretch item-fill" pbi-lazy-load-contents="exploreUIShellConfig"><analytics-pane class="propertyPaneContents"></analytics-pane></section></div></article>')}]);var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=jsCommon.DOMConstants.KeyDictionary,r=(function(){function t(t){var r=this;this.focusService=t,this.restrict="A",this.link=function(t,o,n){if(!_.isEmpty(n.focusGroup)){for(var a={element:o.get(0),keycode:-1},s=n.focusGroup.split(" "),l=s[0].split("-"),c=0,u=l;c<u.length;c++){var p=u[c];switch(p){case"shift":a.shift=!0;break;case"alt":a.alt=!0;break;case"ctrl":a.ctrl=!0;break;default:var d=i[p];a.keycode=d}}s.length>1&&"scoped"===s[1]&&(a.scoped=!0),o.on(e.common.FocusEventName,(function(e){e.stopPropagation()})),r.focusService.registerShortcut(a),t.$on("$destroy",(function(){return r.focusService.unregisterShortcut(a)}))}}}return t})();t.FocusGroup=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("ExploreUI/services/clustering",["require","exports"],(function(e,t){function i(e,t,i,r,o,n,a,s,l,c,u,p,d){return{isClusteringColumn:function(e){return!1},createClusters:function(e,t,i){},editClustering:function(e,t){return null},arePartitionNameToClusterIdsMappingsEqual:function(e,t){return!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{getMetadata:function(e){return null}}}e.createClusteringStateService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("ExploreUI/services/drillToDetails",(function(e){var t=powerbi,i=t.common,r=(i.contracts,t.data),o=t.explore,n=o.constants,a=(o.contracts,o.services),s=a.events,l=o.util,c=jsCommon.ArrayExtensions,u=l.FilterContainerBuilder,p=powerbi.explore.FilterUtils,d=powerbi.explore.services.selectionUtils,h=o.SectionUtils,v=r.SQExpr,g=jsCommon.Utility,f=l.VisualContainerUtils,m=(function(){function e(e,t,i,r,o){this.sourceSection=e,this.sourceVisualContainer=t,this.targetSection=i,this.targetVisualContainer=r,this.navigationState=o}return e.prototype.toSnapshot=function(e){var t=this;if(e.getCurrentSection()===this.targetSection){var i=e.getCurrentExploration(),r=h.findSectionIndexForSection(i,this.sourceSection),o=h.findSectionIndexForSection(i,this.targetSection),n=_.findIndex(this.sourceSection.visualContainers,(function(e){return e===t.sourceVisualContainer})),a=_.findIndex(this.targetSection.visualContainers,(function(e){return e===t.targetVisualContainer}));return{sourceSectionIndex:r,sourceVisualIndex:n,targetSectionIndex:o,targetVisualIndex:a}}},e.fromSnapshot=function(t,i){if(t){var r=i.getCurrentExploration(),o=r.sections[t.sourceSectionIndex],n=o.visualContainers[t.sourceVisualIndex],a=r.sections[t.targetSectionIndex],s=a.visualContainers[t.targetVisualIndex];return new e(o,n,a,s,0)}},e})(),y=(function(){function e(e,t,i,r,o,n,a,l,c,u,p,d,h){var v=this;this.conceptualSchemaProxy=e,this.visualAuthoringOperations=t,this.undoRedo=i,this.selectionService=r,this.explorationNavigationService=o,this.explorationSerializer=n,this.visibility=a,this.rootScope=l,this.timeout=c,this.eventBridge=u,this.filterGenerator=p,this.localizationService=d,this.visualPluginService=h,this.eventBridge.createChannelSubscriptionManager().subscribe(s.canvasChanged,(function(){return v.onSectionChanged()})).subscribe(s.visibilityChanged,(function(){return v.onPopOutModeChanged()})).subscribe(s.explorationUnloaded,(function(e,t){return v.clearContext()}))}return e.prototype.drillToDetails=function(e,i,r){var o=this;if(!_.isEmpty(e)){var n=_.first(e);if(n&&!_.isEmpty(n.metadata)){var a=f.getVisualQuery(i);if(a&&a.defn){if(_.isEmpty(n.dataMap)){if(!a.projections)return;var s=f.getDataRolesForVisual(i,this.visualPluginService),l=_(s).filter((function(e){return e.kind!==t.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value();for(var c in a.projections)if(!_.isEmpty(a.projections[c])&&_.contains(l,c))return}var u=a.defn.select().withName(_.first(n.metadata));u&&v.isAggregation(u.expr)&&this.conceptualSchemaProxy.get(r).then((function(t){var r=o.visualAuthoringOperations.drillToDetails(g.generateGuid(),t,[u.expr],e,i);r&&(o.addCrossFilters(i,o.explorationNavigationService.getCurrentSection(),r,!1,t),o.drillToDetailsCore(e,i,r))}),(function(){return _.noop}))}}}},e.prototype.generateDetailsTable=function(e,t,i){var r=this.mockVisualContainer(e),o=this.visualAuthoringOperations.drillToDetails(g.generateGuid(),t,i,null,r);if(o)return o.config.singleVisual},e.prototype.clear=function(){if(this.drillToDetailsContext){this.drillToDetailsContext.navigationState=1;var e=h.findSectionIndexForSection(this.explorationNavigationService.getCurrentExploration(),this.drillToDetailsContext.sourceSection);this.rootScope.$emit(n.switchSectionEvent,e)}},e.prototype.getContext=function(){return this.drillToDetailsContext},e.prototype.setContext=function(e){this.drillToDetailsContext=e},e.prototype.clearContext=function(){this.drillToDetailsContext=null},e.prototype.hasContext=function(){return!!this.drillToDetailsContext},e.prototype.getDetailsTableTargetMeasures=function(e){var i=this.mockVisualContainer(e),r=f.getVisualQuery(i);if(r&&r.defn){var o=f.getDataRolesForVisual(i,this.visualPluginService);if(!_.isEmpty(o)){for(var n=_(o).filter((function(e){return(e.kind===t.VisualDataRoleKind.Measure||e.kind===t.VisualDataRoleKind.GroupingOrMeasure)&&0!==e.joinPredicate})).map((function(e){return e.name})).value(),a=[],s=0,l=n;s<l.length;s++){var c=l[s],u=r.projections[c];if(!_.isEmpty(u))for(var p=u.all(),d=0,h=p;d<h.length;d++){var g=h[d],m=r.defn.select().withName(g.queryRef);if(m&&v.isAggregation(m.expr))return[m.expr];m&&v.isMeasure(m.expr)&&a.push(m.expr)}}return a}}},e.prototype.mockVisualContainer=function(e){var t={name:g.generateGuid(),config:{singleVisual:e},layouts:c.createWithId(),filters:[]};return t.layouts.push({id:0,position:{x:0,y:0,width:0,height:0}}),t},e.prototype.onSectionChanged=function(){var e=this;if(this.drillToDetailsContext){this.explorationNavigationService.getCurrentSection();switch(this.drillToDetailsContext.navigationState){case 0:this.timeout((function(){d.selectVisualContainer(e.drillToDetailsContext.targetVisualContainer,e.selectionService),e.visibility.set(e.drillToDetailsContext.targetVisualContainer,1)}),0);break;case 1:var t=h.findSectionIndexForSection(this.explorationNavigationService.getCurrentExploration(),this.drillToDetailsContext.targetSection),i=this.drillToDetailsContext.sourceVisualContainer;this.drillToDetailsContext=null,this.rootScope.$emit(n.deleteSectionEvent,{targetSectionIndex:t}),this.timeout((function(){d.selectVisualContainer(i,e.selectionService),e.undoRedo.clear()}),0)}}},e.prototype.onPopOutModeChanged=function(){if(this.drillToDetailsContext){var e=this.explorationNavigationService.getCurrentSection();if(e!==this.drillToDetailsContext.sourceSection){var t=this.visibility.get();t!==this.drillToDetailsContext.targetVisualContainer&&this.clear()}}},e.prototype.drillToDetailsCore=function(e,t,i){var r=this.explorationNavigationService.getCurrentSection();if(r){var o=this.explorationSerializer.serializePage(r,1),a=this.explorationSerializer.deserializePage(o),s={name:"Drill to Details",displayName:"Drill to Details",filters:a.filters,size:a.size,visualContainers:[i],transient:!0};this.drillToDetailsContext=new m(r,t,s,i,0),this.rootScope.$emit(n.insertSectionEvent,s)}},e.prototype.addCrossFilters=function(e,t,i,r,o){var n=this.filterGenerator.getVisualContainerCrossFilters(t,e,o);if(n.dataFilters)for(var a=0,s=n.dataFilters;a<s.length;a++){var l=s[a];this.addVisualFilters(i,l,o,!1)}r&&this.addVisualFilters(i,n.highlightFilter,o,r)},e.prototype.addVisualFilters=function(e,t,i,r){var o=u.fromSemanticFilter(t,i);if(o)for(var n=0,a=o;n<a.length;n++){var s=a[n];p.add(e,s)}else{var l={name:p.getNextFilterName(e.filters),restatement:p.getNextAutoGenRestatement(e.filters,"DetailVisual_CrossFilter",this.localizationService),filter:t,howCreated:0};p.add(e,l)}},e})();return{create:function(e,t,i,r,o,n,a,s,c,u,p,d,h,v,g,f,m,w,S,b,C,x,M){var D=l.createVisualAuthoringOperations(i,r,v,g,c,s,o,t,h,a,f,m,w,S,b,C,M,x);return new y(e,D,n,s,c,t,u,p,d,h,S,x,i)},createContext:function(e,t,i,r,o){return new m(e,t,i,r,o)},snapshotToContext:m.fromSnapshot}}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t,i,r,n){return new o(e,t,i,r,n)}var r={updateUrl:!0,action:t.SectionNavigationAction.Unknown};t.createExplorationNavigationService=i;var o=(function(){function i(e,t,i,r,o){this.explorationProxy=e,this.eventBridge=t,this.scope=i,this.selection=r,this.formFactor=o,this.history=[]}return i.prototype.updateActiveSection=function(t,i,r){var o=this.scope.viewModel,n=o.exploration.contract;if(i||n.activeSectionIndex!==t){if(!r){var a=this.getCurrentSection();a&&this.history.push({name:a.name})}e.SectionUtils.gotoSection(o,t,this.selection,this,this.formFactor.getCurrentLayout())}},i.prototype.goto=function(e,i){if(i=i?_.merge({},r,i):r,this.currentSection=e,this.raiseEvent(),i.updateUrl){var o={name:e.name,displayName:e.displayName,action:i.action};this.eventBridge.publishToChannel(t.events.sectionChanged,o)}},i.prototype.back=function(){if(!_.isEmpty(this.history)){var e=this.history.pop(),t=_.findIndex(this.exploration.sections,(function(t){return t.name===e.name}));t<0||this.updateActiveSection(t,!0,!0)}},i.prototype.loadExploration=function(e){this.exploration=e,this.raiseExplorationLoadedEvent(e)},i.prototype.getCurrentSection=function(){return this.currentSection},i.prototype.getAllSections=function(){return this.exploration.sections},i.prototype.getCurrentExploration=function(){return this.exploration},i.prototype.getCurrentExplorationAsync=function(){var e=this,t={id:this.exploration.reportId};return this.explorationProxy.get(t).then((function(t){return e.exploration.report=t.report,t}))},i.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(t.events.canvasChanged)},i.prototype.raiseExplorationLoadedEvent=function(e){this.eventBridge.publishToChannel(t.events.explorationLoaded,e)},i})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),define("ExploreUI/services/explorationStateManager",["require","exports"],(function(e,t){function i(e,t,i,r){return new l(e,t,i,r)}Object.defineProperty(t,"__esModule",{value:!0});var r=powerbi,o=r.explore,n=o.services,a=n.events,s=a.explorationFiltersContainerChanged;t.create=i;var l=(function(){function e(e,t,i,r){this.state=e,this.navigation=t,this.eventBridge=i,this.visibility=r}return e.prototype.exploration=function(){return this.navigation.getCurrentExploration()},e.prototype.capture=function(){return __awaiter(this,void 0,powerbi.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e=this.exploration(),e?[4,this.state.capture(e)]:[2];case 1:return[2,t.sent()]}}))}))},e.prototype.apply=function(e,t){return __awaiter(this,void 0,powerbi.Promise,(function(){var i,r;return __generator(this,(function(o){switch(o.label){case 0:return i=this.exploration(),[4,this.state.apply(e,i,t)];case 1:return r=o.sent(),this.applyImpact(r,i),[2]}}))}))},e.prototype.applyImpact=function(e,t){if(2===e.filterScope&&(this.eventBridge.publishToChannel(s,{container:t}),this.eventBridge.publishToChannel(a.visualContainerChanged,{affectContainer:_.noopTrue})),e.activeSection)this.navigation.updateActiveSection(t.activeSectionIndex,!0);else if(1===e.filterScope){var i=this.navigation.getCurrentSection();this.eventBridge.publishToChannel(o.services.events.sectionFiltersContainerChanged,{container:i}),this.eventBridge.publishToChannel(a.visualContainerChanged,{affectContainer:function(e){return _.contains(i.visualContainers,e)}})}else 0!==e.filterScope&&_.isEmpty(e.visualContainers)||this.eventBridge.publishToChannel(a.visualContainerChanged,{affectContainer:function(t){return _.contains(e.visualContainers,t)}});e.visibility?this.visibility.set(e.visibility.visual,e.visibility.mode):this.visibility.clear()},e})()}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new n(e,t)}var r=e.common.FocusManager,o=e.explore.dialogs.HotkeyDialogBuilder;t.createFocusService=i;var n=(function(){function e(e,t){this.$element=e,this.modalDialogService=t,this.focusManager=new r(document.documentElement)}return e.prototype.startListening=function(){this.$element.on("keypress",$.proxy(this.onkeydown,this))},e.prototype.stopListening=function(){this.$element.off("keypress",this.onkeydown)},e.prototype.registerShortcut=function(e){this.focusManager.registerShortcut(e)},e.prototype.unregisterShortcut=function(e){this.focusManager.unregisterShortcut(e)},e.prototype.onkeydown=function(e){var t=String.fromCharCode(e.keyCode);if("?"===t){var i=document.activeElement;if(r.canHandleKeyEvents(e.target))return;var n=new o(this.modalDialogService);n.show().finally((function(){i&&i.nodeType===Node.ELEMENT_NODE&&i.focus()}))}},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.define("ExploreUI/services/quickCalc",(function(e){var t=powerbi,i=t.data,r=t.explore,o=(r.contracts,r.util),n=t.telemetry,a=t.RejectablePromise,s=i.services.SemanticQuerySerializer,l=i.SQExpr,c=i.SQExprUtils,u=o.VisualContainerUtils,p=(function(){function e(e,t,i,r,o,n,a,s,l,c,u){this.aggrOps=e,this.conceptualSchemaProxy=t,this.dataSources=i,this.explorationSerializer=r,this.modalDialogService=o,this.modelAuthoring=n,this.modelChangeHandler=a,this.promiseFactory=s,this.daxTemplateService=l,this.visualAuthoringService=c,this.telemetryService=u}return e.prototype.createQuickCalc=function(e,t){var r=this,o=this.promiseFactory.defer(),s=this.dataSources.get();return this.conceptualSchemaProxy.get(s).then((function(a){var p,d;if(t)p=_.sortBy(u.getSelectExprs(t.visualContainer),(function(t){return l.equals(e,t.expr)?0:1}));else if(l.isEntity(e))p=[],d=e;else{var h=e,v=h.getMetadata(a);v&&v.type.numeric&&!i.SQExprUtils.discourageAggregation(e,a)&&(h=r.aggrOps.createExprWithAggregate(e,a,!0,[{numeric:!0}])),p=[{expr:h,name:void 0}]}var g=r.telemetryService.logEvent(n.EXQuickMeasuresOpenDialog,t?n.QuickMeasureEntryPoint.FieldWell:n.QuickMeasureEntryPoint.FieldList,p.length),f=r.telemetryService.startChildEvent(g,n.EXQuickMeasuresDialogResult,void 0,void 0),m=r.getFirstEditableSchemaName(a),y=r.showQuickCalcDialog(p,d,m,g);o.promise.catch((function(){return y.reject()})),y.then((function(e){return f.event.info.connectionType=r.getConnectionType(a,m),e?r.daxTemplateService.getTemplates(m).then((function(t){var i=_.find(t,(function(t){return t.capabilities.name===e.template.name}));return i?(f.event.info.selectedQuickMeasure=i.capabilities.name,f.resolve(),r.createNewMeasure(e,i,a)):(f.event.info.selectedQuickMeasure="Cancel",f.resolve(),r.promiseFactory.reject())})):(f.event.info.selectedQuickMeasure="Cancel",f.resolve(),r.promiseFactory.reject())})).then((function(o){if(t){var n=i.SQExprBuilder.measureRef(i.SQExprBuilder.entity(o.schema,o.entity),o.measureDefinition.name);return r.visualAuthoringService.addFieldToVisual(n,s,t.visualContainer).catch((function(){return c.isMeasure(e)?r.visualAuthoringService.replaceProjection(n,t.role,t.index,t.visualContainer,s):r.promiseFactory.resolve()}))}return r.promiseFactory.resolve()})).then((function(){return o.resolve(null)})).catch((function(){return o.reject()}))})),a(o)},e.prototype.showQuickCalcDialog=function(e,t,i,r){var o=this.dataSources.get(),n=powerbi.explore.services.createDataSourceSerializer(this.explorationSerializer),a={selects:_.map(e,(function(e){return s.serializeExpr(e.expr)})),dataSources:n.serializeDataSources(o),schemaName:i,openDialogEvent:r,targetEntity:t&&s.serializeExpr(t)},l={dialogName:"DaxTemplateDialog",definitionTemplateCachePath:"components/daxTemplateDialog/daxTemplateDialogDefinition.html",bindings:{args:a},dialogCssClass:"daxTemplateDialog"};return this.modalDialogService.showHostModalDialog(l)},e.prototype.createNewMeasure=function(e,t,i){var r=this,o=this.promiseFactory.defer(),n=_.mapValues(e.parameters,(function(e){return{expression:s.deserializeExpr(e.expression)}}));return t.apply({schemaName:e.newMeasureMetadata.schema,inputValues:n}).then((function(n){var a={newQuickCalc:{schema:e.newMeasureMetadata.schema,entity:e.newMeasureMetadata.entity,name:e.newMeasureMetadata.measureName,expression:n.dax,daxTemplateName:t.capabilities.name}};r.applyAndHandleSchemaChange(a,(function(t){var n=t.changes,a=_.find(n,(function(e){return e.newMeasureCreated}));if(a){var s=r.promiseFactory.defer();return r.applyFormatting(a.newMeasureCreated,e,i).then((function(e){o.resolve(e),s.resolve(null)})),s.promise}}))})),o.promise},e.prototype.applyFormatting=function(e,t,i){var r=this,o=this.promiseFactory.defer(),n=this.getFormattingSchemaChange(t.newMeasureMetadata,e.measureDefinition.name,i);return n?this.applyAndHandleSchemaChange(n,(function(t){var i=t.changes;if(_.find(i,(function(e){return e.setFormatting||e.copyFormatting})))return o.resolve(e),r.promiseFactory.resolve()})):o.resolve(e),o.promise},e.prototype.getFormattingSchemaChange=function(e,t,i){if(null!=e.formatType){var r=this.convertFormatToFormatKind(e.formatType);if(r)return{setFormatting:{schema:e.schema,entity:e.entity,property:t,format:r}}}else if(e.formatSource){var o=this.getActualFormattingSource(e.formatSource,i);if(o)return{copyFormatting:{sourceSchema:o.schema,sourceEntity:o.entity,sourceProperty:o.property,schema:e.schema,targetEntity:e.entity,targetProperty:t}}}},e.prototype.getActualFormattingSource=function(e,t){var i=s.deserializeExpr(e);if(l.isMeasure(i)){var r=i.source.getTargetEntity();return r&&{schema:r.schema,entity:r.entity,property:i.ref}}if(l.isAggregation(i)){var o=i.arg.getTargetColumnRef(t);if(!o)return;var n=i.getMetadata(t),a=o.getMetadata(t),r=o.source.getTargetEntity();return n&&a&&r&&n.type.isCompatibleFrom(a.type)&&{schema:r.schema,entity:r.entity,property:o.ref}}},e.prototype.convertFormatToFormatKind=function(e){if(0===e)return"Percentage"},e.prototype.applyAndHandleSchemaChange=function(e,t){var i=this.modelChangeHandler.register(t);this.modelAuthoring.apply({changes:[e]}).finally((function(){return i.stopHandling()}))},e.prototype.getFirstEditableSchemaName=function(e){for(var t=0,i=e.schemas;t<i.length;t++){var r=i[t];if(r.capabilities.canEdit)return r.name}},e.prototype.getConnectionType=function(e,t){return e.schema(t).isExtensionSchema?"LiveConnect":"InternalModel"},e})();return{create:function(e,t,i,r,o,n,a,s,l,c,u){return new p(e,t,i,r,o,n,a,s,l,c,u)}}}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t,i,r,n,a,s,l,c,u,p,d,h,v,g,f,m,y,w,S){return new o(e,t,i,r,n,a,s,l,c,u,p,d,h,v,g,m,y,w,S)}var r=e.components.VisualContainerContextMenu;t.createVisualContainerContextMenuFactoryService=i;var o=(function(){function e(e,t,i,r,o,n,a,s,l,c,u,p,d,h,v,g,f,m,y){this.conceptualSchemaProxy=e,this.dataSources=t,this.drill=i,this.extensionsService=r,this.lazyScopedSync=o,this.dropdown=n,this.eventBridge=a,this.explorationCapabilities=s,this.explorationNavigation=l,this.featureSwitchService=c,this.groupAuthoring=u,this.includeExcludeService=p,this.lazyScoped=d,this.localizationService=h,this.visibility=v,this.visualAuthoring=g,this.viewModeState=f,this.filterGenerator=m,this.telemetryService=y}return e.prototype.create=function(){return new r(this.conceptualSchemaProxy,this.dataSources,this.drill,this.extensionsService,this.lazyScopedSync,this.dropdown,this.eventBridge,this.explorationCapabilities,this.explorationNavigation,this.featureSwitchService,this.groupAuthoring,this.includeExcludeService,this.lazyScoped,this.localizationService,this.visibility,this.visualAuthoring,this.viewModeState,this.filterGenerator,this.telemetryService)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));

window.parseTimeMarkers['powerbiportal.explore.bundle.min.js'].end = Date.now();
