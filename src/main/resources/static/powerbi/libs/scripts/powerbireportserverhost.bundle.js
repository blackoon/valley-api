'use strict';
"use strict";
window.parseTimeMarkers = window.parseTimeMarkers || {};
window.parseTimeMarkers['powerbireportserverhost.bundle.min.js'] = {
    nominalStart: Date.now(),
    start: Date.now()
};
var __extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}})(),powerbi;!(function(e){var t;!(function(t){function n(t){var n=t[0].toLowerCase()+t.slice(1),r=e.infonav.components[t];angular.module("powerbi.infonavbootstrap").component(n,r)}angular.module("powerbi.infonavbootstrap",["powerbi.common"]).factory("interpretHttpService",["$timeout","promiseFactory",function(e,n){return t.services.createInterpretHttpService(e,n)}]).factory("interpretProbe",["interpretHttpService","promiseFactory","$timeout","featureSwitchService",function(e,n,r,o){return t.services.createInterpretProbeService(e,n,r,o)}]),t.registerInfonavBootstrapComponent=n})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.NotSpecified=0]="NotSpecified",e[e.InsightSuggestionAsyncMode=1]="InsightSuggestionAsyncMode"})(t=e.ConversationCreateOptions||(e.ConversationCreateOptions={}));var n;!(function(e){e[e.NotUnderstood=0]="NotUnderstood",e[e.GreetingAck=1]="GreetingAck",e[e.HelpAck=2]="HelpAck",e[e.ByeAck=3]="ByeAck",e[e.ThanksAck=4]="ThanksAck",e[e.NoInsightAck=5]="NoInsightAck",e[e.SelectionAck=6]="SelectionAck",e[e.ConfirmationAck=7]="ConfirmationAck",e[e.UnknownSelectionAck=8]="UnknownSelectionAck",e[e.UnknownConfirmationAck=9]="UnknownConfirmationAck"})(n=e.ConversationTextType||(e.ConversationTextType={}));var r;!(function(e){e[e.Confirm=1]="Confirm",e[e.Choice=2]="Choice",e[e.Clarification=3]="Clarification"})(r=e.ConversationPromptType||(e.ConversationPromptType={}));var o;!(function(e){e[e.None=0]="None",e[e.InsightReasoning=1]="InsightReasoning",e[e.InsightSuggestions=2]="InsightSuggestions",e[e.NoInsightWithSuggestions=3]="NoInsightWithSuggestions"})(o=e.ConversationPromptReason||(e.ConversationPromptReason={}));var a;!(function(e){e[e.ConversationNotFound=0]="ConversationNotFound",e[e.InvalidArgument=1]="InvalidArgument",e[e.InternalError=2]="InternalError",e[e.ModelAccessDenied=3]="ModelAccessDenied",e[e.TalkingTooFast=4]="TalkingTooFast"})(a=e.ConversationErrorCode||(e.ConversationErrorCode={}))})(t=e.contracts||(e.contracts={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Server=0]="Server",e[e.User=1]="User"})(t=e.SpanSource||(e.SpanSource={}));var n;!(function(e){e[e.None=0]="None",e[e.LinguisticSchemaAutoGenerated=1]="LinguisticSchemaAutoGenerated",e[e.LinguisticSchemaNotAvailable=2]="LinguisticSchemaNotAvailable",e[e.LinguisticSchemaIsStillLoading=4]="LinguisticSchemaIsStillLoading",e[e.InvalidDataModel=8]="InvalidDataModel",e[e.DataRetrievalFailed=16]="DataRetrievalFailed",e[e.DataRetrievalSkipped=32]="DataRetrievalSkipped",e[e.DuplicateExecuteSemanticQuery=64]="DuplicateExecuteSemanticQuery"})(n=e.InterpretWarnings||(e.InterpretWarnings={}));var r;!(function(e){e[e.AdjectivePhrasing=0]="AdjectivePhrasing",e[e.AttributePhrasing=1]="AttributePhrasing",e[e.VerbPhrasing=2]="VerbPhrasing"})(r=e.PhrasingType||(e.PhrasingType={}));var o;!(function(e){e[e.Integer=0]="Integer",e[e.Number=1]="Number",e[e.String=2]="String"})(o=e.InputType||(e.InputType={}))})(t=e.contracts||(e.contracts={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Data=1]="Data",e[e.QueryMetadata=2]="QueryMetadata",e[e.VisualConfiguration=4]="VisualConfiguration",e[e.SupportPodQueries=64]="SupportPodQueries",e[e.Cortana=128]="Cortana",e[e.Personality=256]="Personality",e[e.TermBindings=512]="TermBindings",e[e.Diagnostics=1024]="Diagnostics",e[e.CortanaFreeformResults=16384]="CortanaFreeformResults"})(t=e.InterpretRequestOptions||(e.InterpretRequestOptions={}))})(t=e.contracts||(e.contracts={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.openTileAction="/openQnA",e.openTileEventName="openQnaTile",e.pinSelectedVisual="pinSelectedVisual",e.showQnaStart="showQnaStart",e.ScopedInstanceProviderName="infonav",e.DefaultVisualMaxWidth=1024,e.DefaultVisualMaxHeight=768})(t=e.constants||(e.constants={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var o=n(t);return r(o,e)}function n(e){var t;if(_.isEmpty(e))return t;for(var n=0,r=e;n<r.length;n++){var o=r[n];if(t&&o.Language!==t){t=void 0;break}t=o.Language}return t}function r(e,t){var n="";if(e){var r=!1,i=o(t.currentLanguageLocale);e=o(e);var s=a[e];s&&(n=s.resStringSuffix,r=s.preview),r||e!==i||(n="")}return t.get("Qna_Input_Placeholder"+n)}function o(e){if(e){var t=e.split("-");return t[0].toLowerCase()}}var a={en:{resStringSuffix:"_English"},es:{resStringSuffix:"_Spanish",preview:!0}};e.getPlaceholderText=t})(t=e.QnaLanguageUtil||(e.QnaLanguageUtil={}))})(t=e.utils||(e.utils={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n,r=e.common.helpers.ModelConverterHelper;!(function(e){function t(e,t){return{DbMonikers:_(e).filter((function(e){return e&&r.getIsQnaSupported(e,t)&&!_.isEmpty(e.vsName)&&!_.isEmpty(e.dbName)})).filter((function(e){return e&&!_.isEmpty(e.vsName)&&!_.isEmpty(e.dbName)})).map((function(e){return{VirtualServerName:e.vsName,DatabaseName:e.dbName}})).value()}}e.createInterpretRequestScope=t})(n=t.InterpretUtil||(t.InterpretUtil={}))})(n=t.utils||(t.utils={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n,r=jsCommon.Lazy,o=e.visuals.plugins;!(function(e){function t(e){var t=i.getValue();return t[e]}function n(e){var t=s.getValue();return t[e]}function a(e,t){for(var n=[],r={},o=0,a=t.length;o<a;o++){var i=t[o];r[i.vsName+i.dbName]=i}for(var s=e.configs,c=0,u=s.length;c<u;c++){var l=s[c],p=l.Query||e.queryDefn,f=l.DataShapeBinding||e.dataShapeBinding,d=l.QueryMetadata||e.queryMetadata,i=r[e.virtualServerName+e.databaseName];null!=i&&n.push({config:{Query:p,QueryMetadata:d,DataShapeBinding:f,VisualizationType:l.VisualizationType,VisualElements:l.VisualElements,InsightType:l.InsightType},model:i,dataViewSource:e.dataViewSource})}return n}var i=new r(function(){var e={};return e[3]=o.card,e[31]=o.lineClusteredColumnComboChart,e[29]=o.multiRowCard,e[7]=o.clusteredBarChart,e[10]=o.clusteredColumnChart,e[20]=o.donutChart,e[16]=o.funnel,e[30]=o.gauge,e[22]=o.heatMap,e[9]=o.hundredPercentStackedBarChart,e[12]=o.hundredPercentStackedColumnChart,e[4]=o.lineChart,e[1]=o.map,e[19]=o.filledMap,e[2]=o.matrix,e[5]=o.pieChart,e[6]=o.scatterChart,e[8]=o.barChart,e[11]=o.columnChart,e[0]=o.table,e[17]=o.treemap,e[23]=o.waterfallChart,e[26]=o.stackedAreaChart,e[32]=o.areaChart,e[33]=o.ribbonChart,e}),s=new r(function(){var e={};return e[o.card.name]=3,e[o.lineClusteredColumnComboChart.name]=31,e[o.multiRowCard.name]=29,e[o.clusteredBarChart.name]=7,e[o.clusteredColumnChart.name]=10,e[o.donutChart.name]=20,e[o.funnel.name]=16,e[o.gauge.name]=30,e[o.heatMap.name]=22,e[o.hundredPercentStackedBarChart.name]=9,e[o.hundredPercentStackedColumnChart.name]=12,e[o.lineChart.name]=4,e[o.map.name]=1,e[o.filledMap.name]=19,e[o.matrix.name]=2,e[o.pieChart.name]=5,e[o.scatterChart.name]=6,e[o.barChart.name]=8,e[o.columnChart.name]=11,e[o.table.name]=0,e[o.treemap.name]=17,e[o.waterfallChart.name]=23,e[o.stackedAreaChart.name]=26,e[o.areaChart.name]=32,e[o.ribbonChart.name]=33,e});e.getPlugin=t,e.getType=n,e.interpretResultToConfig=a})(n=t.visualUtil||(t.visualUtil={}))})(n=t.utils||(t.utils={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(t){var n,r=e.visuals.plugins,o=e.explore.QueryProjectionBuilderCoreUtils.QueryProjectionBuilder,a=e.infonav.utils.visualUtil;!(function(e){function t(e,t,n){var r=a.getPlugin(e);if(null!=r){var o;switch(e){case 3:case 29:case 0:o=new i(r,t,n);break;case 2:o=new m(r,t,n);break;case 20:case 16:case 4:case 26:case 32:case 5:o=new s(r,t,n);break;case 23:o=new c(r,t,n);break;case 7:case 10:case 9:case 12:case 8:case 11:case 33:o=new u(r,t,n);break;case 1:case 22:o=new f(r,t,n);break;case 19:o=new d(r,t,n);break;case 17:o=new h(r,t,n);break;case 6:o=new p(r,t,n);break;case 30:o=new l(r,t,n);break;default:return}return o}}e.createProjectionBuilder=t})(n=t.QueryProjectionBuilderUtils||(t.QueryProjectionBuilderUtils={}));var i=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 1===e.length&&e[0].name===o.ValuesRole},t.prototype.build=function(e){var t={};if(1===this.projectionsInfo.length)return o.addValuesRole(t,this.projectionsInfo[0]),t;for(var n=e.Primary.Groupings,r=n[0].Projections,a=0,i=r.length;a<i;a++)o.addValuesRole(t,this.projectionsInfo[r[a]]);return t},t})(o),s=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return this.plugin.name===r.funnel.name?4===e.length&&e[0].name===o.CategoryRole&&e[1].name===o.YRole&&e[2].name===o.GradientRole&&e[3].name===o.TooltipRole:4===e.length&&e[0].name===o.CategoryRole&&e[1].name===o.SeriesRole&&e[2].name===o.YRole&&e[3].name===o.TooltipRole},t.prototype.build=function(e){var t=e.Primary.Groupings,n={};if(this.processPrimaryGroup(t[0],n),e.Secondary){var r=e.Secondary.Groupings;1===r.length&&this.processSecondaryGroup(r[0],n)}return n},t.prototype.processPrimaryGroup=function(e,t){for(var n=e.Projections,r=0,a=n.length;r<a;r++){var i=n[r],s=this.projectionsInfo[i];0===s.metadata.kind?(o.addCategoryRole(t,s),t[o.CategoryRole].addActiveQueryReference(s.projection.queryRef)):1===s.metadata.kind&&o.addYRole(t,s)}},t.prototype.processSecondaryGroup=function(e,t){for(var n=e.Projections,r=0,a=n.length;r<a;r++){var i=n[r];o.addSeriesRole(t,this.projectionsInfo[i])}},t})(o),c=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.processSecondaryGroup=function(e,t){for(var n=e.Projections,r=0,a=n.length;r<a;r++){var i=n[r];o.addBreakdownRole(t,this.projectionsInfo[i])}},t})(s),u=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return this.plugin.name===r.ribbonChart.name?4===e.length&&e[0].name===o.CategoryRole&&e[1].name===o.SeriesRole&&e[2].name===o.YRole&&e[3].name===o.TooltipRole:5===e.length&&e[0].name===o.CategoryRole&&e[1].name===o.SeriesRole&&e[2].name===o.YRole&&e[3].name===o.GradientRole&&e[4].name===o.TooltipRole},t})(s),l=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 5===e.length&&e[0].name===o.YRole&&e[1].name===o.MinValueRole&&e[2].name===o.MaxValueRole&&e[3].name===o.TargetValueRole&&e[4].name===o.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var n=e.Projections,r=0,a=0,i=n;a<i.length;a++){var s=i[a],c=this.projectionsInfo[s];if(1===c.metadata.kind){switch(r){case 0:o.addYRole(t,c);break;case 1:o.addTargetValueRole(t,c);break;case 2:o.addMaxValueRole(t,c);break;case 3:o.addMinValueRole(t,c);break;case 4:o.addTooltipRole(t,c)}r++}}},t})(s),p=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 8===e.length&&e[0].name===o.CategoryRole&&e[1].name===o.SeriesRole&&e[2].name===o.XRole&&e[3].name===o.YRole&&e[4].name===o.SizeRole&&e[5].name===o.GradientRole&&e[6].name===o.PlayRole&&e[7].name===o.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var n=e.Projections,r=0,a=0,i=n.length;a<i;a++){var s=n[a],c=this.projectionsInfo[s];if(0===c.metadata.kind)o.addCategoryRole(t,c);else if(1===c.metadata.kind){switch(r){case 0:o.addXRole(t,c);break;case 1:o.addYRole(t,c);break;case 2:o.addSizeRole(t,c);break;case 3:o.addGradientRole(t,c);break;case 4:o.addTooltipRole(t,c)}r++}}},t})(s),f=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 7===e.length&&e[0].name===o.CategoryRole&&e[1].name===o.SeriesRole&&e[2].name===o.YRole&&e[3].name===o.XRole&&e[4].name===o.SizeRole&&e[5].name===o.GradientRole&&e[6].name===o.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var n=e.Projections,r=0,a=0,i=n;a<i.length;a++){var s=i[a],c=this.projectionsInfo[s];if(0===c.metadata.kind)o.addCategoryRole(t,c);else if(1===c.metadata.kind){switch(r){case 0:o.addSizeRole(t,c);break;case 1:o.addXRole(t,c);break;case 2:o.addYRole(t,c);break;case 3:o.addGradientRole(t,c);break;case 4:o.addTooltipRole(t,c)}r++}}},t})(s),d=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 6===e.length&&e[0].name===o.CategoryRole&&e[1].name===o.SeriesRole&&e[2].name===o.YRole&&e[3].name===o.XRole&&e[4].name===o.SizeRole&&e[5].name===o.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var n=e.Projections,r=0,a=0,i=n;a<i.length;a++){var s=i[a],c=this.projectionsInfo[s];if(0===c.metadata.kind)o.addCategoryRole(t,c);else if(1===c.metadata.kind){switch(r){case 0:o.addSizeRole(t,c);break;case 1:o.addXRole(t,c);break;case 2:o.addYRole(t,c);break;case 3:o.addTooltipRole(t,c)}r++}}},t})(s),h=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 5===e.length&&e[0].name===o.GroupRole&&e[1].name===o.DetailsRole&&e[2].name===o.ValuesRole&&e[3].name===o.GradientRole&&e[4].name===o.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var n=e.Projections,r=0,a=n.length;r<a;r++){var i=n[r],s=this.projectionsInfo[i];0===s.metadata.kind?(o.addGroupRole(t,s),t[o.GroupRole].addActiveQueryReference(s.projection.queryRef)):1===s.metadata.kind&&o.addValuesRole(t,s)}},t.prototype.processSecondaryGroup=function(e,t){for(var n=e.Projections,r=0,a=n.length;r<a;r++){var i=n[r];o.addDetailsRole(t,this.projectionsInfo[i])}},t})(s),m=(function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 3===e.length&&e[0].name===o.RowsRole&&e[1].name===o.ColumnsRole&&e[2].name===o.ValuesRole},t.prototype.build=function(e){var t=e.Primary.Groupings,n={};if(this.processPrimaryGroups(t,n),e.Secondary){var r=e.Secondary.Groupings;this.processSecondaryGroups(r,n)}return n},t.prototype.processPrimaryGroups=function(e,t){if(e)for(var n=0,r=e.length;n<r;n++)this.processPrimaryGroup(e[n],t)},t.prototype.processSecondaryGroups=function(e,t){if(e)for(var n=0,r=e.length;n<r;n++)this.processSecondaryGroup(e[n],t)},t.prototype.processPrimaryGroup=function(e,t){for(var n=e.Projections,r=0,a=n.length;r<a;r++){var i=(n[r],this.projectionsInfo[n[r]]);0===i.metadata.kind?o.addRowsRole(t,i):1===i.metadata.kind&&o.addValuesRole(t,i)}},t.prototype.processSecondaryGroup=function(e,t){for(var n=e.Projections,r=0,a=n.length;r<a;r++)o.addColumnsRole(t,this.projectionsInfo[n[r]])},t})(o)})(n=t.util||(t.util={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){var r=e.common.helpers.ModelConverterHelper,o=(function(){function n(e,n,r,o,a,i){this.$timeout=e,this.featureSwitchService=n,this.promiseFactory=r,this.interpretProbeService=o,this.conceptualSchemaProxy=a,this.localizationService=i,this.placeholder=t.utils.QnaLanguageUtil.getPlaceholderText(i),this.sendInterpretProbe()}return n.createOptions=function(){return{additionalServices:["$timeout","featureSwitchService","promiseFactory","interpretProbe","conceptualSchemaProxy","localizationService"]}},n.prototype.launchQna=function(){this.showQna(),this.$timeout((function(){return $(".qnaInputContainer #content").focus()}))},n.prototype.sendInterpretProbe=function(e){var o=this,a=_.filter(this.models,(function(e){return e&&r.getIsQnaSupported(e,o.featureSwitchService.featureSwitches)})),i=this.interpretProbeService.probe(a||[],e),s=this.promiseFactory.defer();return i.then((function(e){o.placeholder=t.utils.QnaLanguageUtil.getPlaceholderText(o.localizationService,e),n.preloadConceptualSchemas(o.models||[],o.conceptualSchemaProxy),s.resolve({})}),(function(){s.reject()})),s.promise},n.preloadConceptualSchemas=function(e,t){for(var r=3,o=Math.min(e.length,r),a=0,i=_.take(e,o);a<i.length;a++){var s=i[a];t.get(n.createDataSourceArray(s))}},n.createDataSourceArray=function(t){return e.explore.contracts.createDataSourceArray([{type:"dsr",id:t.id,packageId:t.packageId,name:void 0,dsr:{schemaName:void 0,vsName:t.vsName,dbName:t.dbName,modelId:t.id}}])},n})();n.QnaInputLauncherController=o,o.$inject=o.createOptions().additionalServices})(n=t.controllers||(t.controllers={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){t.QnaInputLauncher={templateUrl:"qnaInputLauncher/qnaInputLauncher.html",bindings:{models:"=",showQna:"="},controller:e.controllers.QnaInputLauncherController}})(t=e.components||(e.components={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={})),powerbi.infonav.registerInfonavBootstrapComponent("QnaInputLauncher");var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){function r(e,t,n,r,a){var i=6e5;return new o(e,t,r,a||i)}n.createInterpretProbeService=r;var o=(function(){function n(e,t,n,r){this.interpretHttpService=e,this.promiseFactory=t,this.featureSwitchService=n,this.probePromiseCache=new a(r)}return n.prototype.probe=function(e,n,r){var o=t.utils.InterpretUtil.createInterpretRequestScope(e,this.featureSwitchService.featureSwitches);return _.isEmpty(o.DbMonikers)?this.promiseFactory.reject():this.probeInternal(o,n,r).promise},n.prototype.isProbeCompleted=function(e){var t=this.probePromiseCache.getPromise(e);return t&&t.isComplete},n.prototype.probeInternal=function(e,t,n){var r=this,o=this.probePromiseCache.getPromise(e);if(!o){var a=this.promiseFactory.defer();o={promise:a.promise,waitingInterprets:[],isComplete:!1},this.probePromiseCache.setPromise(e,o),this.sendProbeRequest(e,t).then((function(e){a.resolve(e.data)}),(function(){a.reject(),r.probePromiseCache.clearPromise(e)})),a.promise.finally((function(){o.isComplete=!0;var e=o.waitingInterprets,t=e.length;if(t>0){var n=e[t-1].runToCompletion();n.finally((function(){for(var n=0;n<t-1;n++)e[n].reject()}))}o.waitingInterprets=[]}))}return n&&o.waitingInterprets.push(n),o},n.prototype.sendProbeRequest=function(t,n){var r=6e4,o=e.common.httpService.powerbiRequestOptions(n,"InterpretProbe");return o.timeout=r,this.interpretHttpService.probe(t,n)},n})(),a=(function(){function e(e){this.cache={},this.expirationInMilliseconds=e}return e.prototype.getPromise=function(t){var n=e.getCacheKey(t),r=this.cache[n];return r&&r.expiration<Date.now()&&(delete this.cache[n],r=void 0),r},e.prototype.setPromise=function(t,n){n.expiration=Date.now()+this.expirationInMilliseconds,this.cache[e.getCacheKey(t)]=n},e.prototype.clearPromise=function(t){delete this.cache[e.getCacheKey(t)]},e.getCacheKey=function(e){return _(e.DbMonikers).sortBy((function(e){return e.VirtualServerName})).sortBy((function(e){return e.DatabaseName})).map((function(e){return e.DatabaseName+":"+e.VirtualServerName})).value().join("::")},e})()})(n=t.services||(t.services={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={})),angular.module("powerbi.infonavbootstrap").run(["$templateCache",function(e){e.put("qnaInputLauncher/qnaInputLauncher.html",'<span class="qnaInputLauncher" ng-click="$ctrl.launchQna()"><span class="glyphicon pbi-glyph-qna icon"></span><span class="qnaInputLauncherText" ng-bind="$ctrl.placeholder"></span></span>')}]);var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){function r(e,t){return new i(e,t)}n.createInterpretHttpService=r;var o=25e3,a=6e4,i=(function(){function n(e,t){this.timeoutService=e,this.promiseFactory=t}return n.prototype.probe=function(n,r){var o=e.common.httpService.powerbiRequestOptions(r,"InterpretProbe");o.timeout=a;var i={Scope:n,Options:t.contracts.InterpretRequestOptions.SupportPodQueries};return e.common.httpService.post("/explore/interpretation/interpretprobe/",i,o)},n.prototype.interpret=function(t,n,r){var a=e.common.httpService.powerbiRequestOptions(n,"Interpret"),i=this.promiseFactory.defer();return a.timeout=i.promise,this.timeoutService((function(){return i.resolve({})}),o),r&&r.then((function(){return i.resolve({})})),e.common.httpService.post("/explore/interpretation/interpret/",t,a)},n})()})(n=t.services||(t.services={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));;"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{u(i.next(e))}catch(e){o(e)}}function a(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}u((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,o&&(s=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},powerbi;!(function(e){var t;!(function(t){var n;!(function(t){function n(t,n){void 0===n&&(n=[]);var i=t[0].toLowerCase()+t.slice(1);n.push((function(n,i,r,o){return new e.explore.infonav.directives[t](n,i,r,o)})),angular.module("powerbi.qnacore").directive(i,n)}function i(t){var n=t[0].toLowerCase()+t.slice(1),i=e.explore.infonav.components[t];angular.module("powerbi.qnacore").component(n,i)}angular.module("powerbi.qnacore",["powerbi.explore","powerbi.common","powerbi.infonavbootstrap"]).factory("answeredQuestionEventLoggerFactory",["promiseFactory","telemetryService","$timeout",function(e,n,i){return t.createAnsweredQuestionEventLoggerFactory(e,n,i)}]).factory("interpretService",["interpretProbe","interpretHttpService","promiseFactory","$timeout","telemetryService","contentProviderHttpService","featureSwitchService",function(e,n,i,r,o,s,a){return t.services.createInterpretService(e,n,i,r,o,s,a)}]).factory("interpretUsageListener",["usageHttpService",function(t){return e.explore.infonav.usage.createInterpretUsageListener(t)}]).factory("sampleQuestionsService",["interpretService","featureSwitchService","promiseFactory",function(t,n,i){return e.explore.infonav.services.createSampleQuestionsService(t,n,i)}]).factory("usageHttpService",[function(){return e.explore.infonav.services.createUsageService()}]).factory("bindingElementFactory",["localizationService",function(t){return e.explore.infonav.services.createBindingElementFactory(t)}]).factory("termConverterService",["bindingElementFactory","rtl",function(t,n){return e.explore.infonav.services.createTermConverterService(t,n)}]).factory("qnaInputInterpreterService",["interpretService","interpretUsageListener","promiseFactory","contentProviderHttpService","answeredQuestionEventLoggerFactory","applicationOptions",function(t,n,i,r,o,s){return e.explore.infonav.services.createQnaInputInterpreterService(t,n,i,r,o,s)}]).run(["lazyScopedFactories",function(e){e.insightContainerFactory={source:{javascript:"Insights/services/insightContainerFactory"},ng:["displayNameService","localizationService","themeService"],scoped:["visualPlugin"],scopedModular:[],fn:function(e,t,n,i,r){return e.create(r,t,n,i)}},e.insightsExportService={source:{javascript:"Insights/services/insightsExportService"},ng:["conceptualSchemaProxy","displayNameService"],scoped:["visualPlugin","visualQueryGenerator"],scopedModular:["insightContainerFactory"],fn:function(e,t,n,i,r,o){return e.create(t,n,i,r,o)}}}]).run(["scopedProvider",function(n){n.register("visualPlugin",{services:["asyncFeatureSwitchService","mapControlFactory","promiseFactory"],scopedServices:["resourceLoader"],fn:function(t,n,i,r){return e.explore.infonav.services.createVisualPlugins(t,i,r,n)}},e.infonav.constants.ScopedInstanceProviderName).register("eventBridge",{fn:function(){return e.common.createEventBridge()}}).register("infoNavCanvasDefinitionFactory",{services:["moduleLoader","conceptualSchemaProxy","explorationProxy","explorationSerializer","featureSwitchService","geoTaggingAnalyzerService","aggrOps","promiseFactory"],scopedServices:["lazyScoped","eventBridge"],fn:function(e,n,i,r,o,s,a,u,c,l){return t.services.createInfoNavCanvasDefinitionFactory(e,n,i,r,o,s,a,c,u,l)}})}]),t.registerQnaCoreDirective=n,t.registerQnaCoreComponent=i})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function n(n,i,r,o,s,a,c,p,d){var h=t.CustomerAction(n,i,r,o,s,a,c,p,d),g=l(h.info,{}),f={name:"PBI.QnA.QnaHowToAskClicked",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:u(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:g,loggers:t.QnAQnaHowToAskClickedLoggers};return f}function i(n,i,r,o,s,a,c,h,g,f,v){var m=t.CustomerAction(r,o,s,a,c,h,g,f,v),S=l(m.info,{suggestionType:n,pageType:i}),y={name:"PBI.QnA.QnaStartSuggestionClicked",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:u(),formatted:function(){return e.extendFormatted({suggestionType:p[S.suggestionType],pageType:d[S.pageType]},null,m.formatted())},info:S,loggers:t.QnAQnaStartSuggestionClickedLoggers};return y}function r(n,i,r,o,s,a,c,p,d,g,f,v,m,S,y,T,I,x,C){var w=t.CustomerAction(f,v,m,S,y,T,I,x,C),b=l(w.info,{EventsKitEventName:n,howEnded:i,isResponseEmpty:r,fromCache:o,contentProviderType:s,ownerType:a,duration:c,probeDuration:p,wasCancelled:d,interpretRequestId:g}),E={name:"PBI.QnA.INAQ",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:u(),formatted:function(){return e.extendFormatted({EventsKitEventName:b.EventsKitEventName,howEnded:b.howEnded,isResponseEmpty:b.isResponseEmpty,fromCache:b.fromCache,contentProviderType:b.contentProviderType,ownerType:h[b.ownerType],duration:b.duration,probeDuration:b.probeDuration,wasCancelled:b.wasCancelled,interpretRequestId:b.interpretRequestId},null,w.formatted())},info:b,loggers:t.QnAINAQLoggers};return E}function o(n,i,r,o,s,a,c,p,d){var h=t.Verbose(n,i,r,o,s,a,c,p,d),g=l(h.info,{}),f={name:"PBI.QnA.QuestionBoxLoadingMessage",category:e.TelemetryCategory.Verbose,time:Date.now(),id:u(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:g,loggers:t.QnAQuestionBoxLoadingMessageLoggers};return f}function s(n,i,r,o,s,a,c,p,d,h){var g=t.CustomerAction(i,r,o,s,a,c,p,d,h),f=l(g.info,{isUtteranceEmpty:n}),v={name:"PBI.QnA.DropdownItemSelected",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:u(),formatted:function(){return e.extendFormatted({isUtteranceEmpty:f.isUtteranceEmpty},null,g.formatted())},info:f,loggers:t.QnADropdownItemSelectedLoggers};return v}function a(n,i,r,o,s,a,c,p,d){var h=t.CustomerAction(n,i,r,o,s,a,c,p,d),g=l(h.info,{}),f={name:"PBI.QnA.QuestionBoxAutoComplete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:u(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:g,loggers:t.QnAQuestionBoxAutoCompleteLoggers};return f}var u,c=jsCommon.Utility,l=jsCommon.UnionExtensions.mergeUnionType;u=c?c.generateGuid:Function.prototype,t.QnAQnaHowToAskClicked=n;var p;!(function(e){e[e.Generated=0]="Generated",e[e.Tile=1]="Tile",e[e.FeaturedQuestion=2]="FeaturedQuestion"})(p=t.QnaStartSuggestionType||(t.QnaStartSuggestionType={}));var d;!(function(e){e[e.HowToAsk=0]="HowToAsk",e[e.ErrorPage=1]="ErrorPage"})(d=t.QnaStartPageType||(t.QnaStartPageType={})),t.QnAQnaStartSuggestionClicked=i;var h;!(function(e){e[e.Unknown=0]="Unknown",e[e.Owner=1]="Owner",e[e.Shared=2]="Shared"})(h=t.OwnerType||(t.OwnerType={})),t.QnAINAQ=r,t.QnAQuestionBoxLoadingMessage=o,t.QnADropdownItemSelected=s,t.QnAQuestionBoxAutoComplete=a})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(t){function n(e,t,n,r){return new i(e,n,t,new o(e,r))}var i=e.explore.services.ExplorationVisualPluginService,r=e.explore.services.ExplorationVisualPluginProvider;t.createVisualPlugins=n;var o=(function(){function t(e,t){this.featureSwitchService=e,this.explorationPlugins=new r(e,t)}return t.prototype.getPlugin=function(t){var n=this.featureSwitchService.featureSwitches;switch(t){case e.visuals.plugins.card.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.card,(function(t){return t.module.createCard({isScrollable:!0,displayUnitSystemType:e.DisplayUnitSystemType.Verbose})}),n);default:return this.explorationPlugins.getPlugin(t)}},t})()})(n=t.services||(t.services={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){var i;!(function(n){var i=t.ScopeUtils,r=e.visualHost.ThemeUtils,o=(function(){function t(t,n){var r=this;if(this.scope=t,this.services=n,this.infoNavContainerOptions=this.services.explorationCapabilities.getCapabilities(),t.viewModel={exploreCanvas:null},t.respectPaneUpdates){var o=this.services.eventBridge.setBubblingScope(this.services.rootScope).subscribe(e.explore.services.events.visualConversion,(function(e,t){return r.onVisualConversion(t)}));t.$on("$destroy",(function(){o.unsubscribeAll()}))}i.defineDataSourcesOnScopeLegacy(this.scope,this.services.dataSources),this.handleNewCanvasDefinition(t.canvasDefinition,null),t.$watch("canvasDefinition",(function(e,t){return r.handleNewCanvasDefinition(e,t)}))}return t.createOptions=function(){return{additionalServices:["featureSwitchService","promiseFactory","themeService"],scopedDependencies:["dataSources","eventBridge","explorationCapabilities","explorationNavigation","resourceLoader","selection"]}},t.prototype.handleNewCanvasDefinition=function(e,t){var n=this,i=this.services,o=this.scope;if(i.dataSources.set(null),o.packageId=null,!e)return o.sourceLabel=null,void(o.viewModel.exploreCanvas=null);var s=e.dataSources;i.dataSources.set(s),o.packageId=e.model.packageId,e.initialize(t,i.eventBridge,o.respectPaneUpdates,i.selection).then((function(){if(e===o.canvasDefinition){var t=e.getExploration();r.loadThemeAndBaseTheme(i.promiseFactory,i.resourceLoader,i.themeService,[],t.theme,t.baseTheme,i.featureSwitchService.featureSwitches.loadBaseTheme).then((function(){i.explorationNavigation.loadExploration(t),i.explorationNavigation.goto(e.section),o.viewModel.exploreCanvas=e.exploreCanvas})),n.updateExplorationMaxSize(e)}}))},t.prototype.onVisualConversion=function(e){var t=this.scope.canvasDefinition;t&&(t.onVisualConversion(e.newVisualType),this.updateExplorationMaxSize(t))},t.prototype.updateExplorationMaxSize=function(e){if(!this.infoNavContainerOptions.cortana&&!this.infoNavContainerOptions.embedded){var t={};e.maxWidth>0&&(t["max-width"]=e.maxWidth+"px"),e.maxHeight>0&&(t["max-height"]=e.maxHeight+"px"),this.scope.explorationStyle=t}},t})();n.InfoNavCanvasController=o})(i=n.controllers||(n.controllers={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){var i;!(function(i){var r=e.infonav.constants,o=e.explore.constants,s=e.explore.viewModels,a=e.common.helpers.ModelConverterHelper,u=t.ScopeUtils,c=110,l=50,p=(function(){function t(e,t){this.scope=e,this.services=t,this.initialize()}return t.createOptions=function(){return{scopedServiceRoot:!0,scopedProviderInstanceName:r.ScopedInstanceProviderName,additionalServices:["featureSwitchService","resourcePackagesService","localizationService","rtl"],scopedDependencies:["dataSources","infoNavCanvasDefinitionFactory","explorationCapabilities","explorationNavigation","filterGenerator","pinVisual","selection","undoRedo","viewModeState","visualPlugin"]}},t.prototype.onInterpretSuccess=function(e,t,n,i){var r=_.find(this.scope.models,(function(e){return e.vsName===t.virtualServerName&&e.dbName===t.databaseName}));this.scope.sourceLabel=this.getSourceLabelForModel(r),t.restatement&&this.scope.newQnaEnabled&&(this.scope.restatement=t.restatement.replace(/^Show /,"Showing ")),i&&this.handleNewInterpretResponse(e,t,n)},t.prototype.getSourceLabelForModel=function(e){return e&&!_.isEmpty(e.displayName)?this.services.localizationService.format("InfoNav_SourceLabel",[e.displayName]):null},t.prototype.handleNewInterpretResponse=function(e,t,i){this.utterance=e.utterance,this.utteranceData=t;var r=this.scope.infoNavContainerOptions.cortana?n.services.SingleVisualizationType.Cortana:n.services.SingleVisualizationType.PrimaryVisual,o=this.services.infoNavCanvasDefinitionFactory.createGivenUtteranceData(t,this.scope.models,i,r,this.services.visualPlugin,this.services.resourcePackagesService);this.setNewCanvasDefinition(o),this.raiseRenderedVisualUtteranceDataChanged()},t.prototype.onInterpretError=function(e){this.utterance=e,this.scope.sourceLabel=this.scope.restatement=null,this.showDefaultError(e),this.scope.hostService.updatePinIconState&&this.scope.hostService.updatePinIconState({visible:!1,enabled:!1})},t.prototype.onInterpretResultCleared=function(){this.utterance="",this.scope.sourceLabel=this.scope.restatement=null,this.scope.hasResult=!1,this.scope.infoNavCanvasDefinition=null,this.updateState(0),this.scope.hostService.updatePinIconState&&this.scope.hostService.updatePinIconState({visible:!1,enabled:!1})},t.prototype.onInterpretIssued=function(){3!==this.scope.state&&2!==this.scope.state&&this.updateState(1)},t.prototype.initialize=function(){var e=this;u.defineDataSourcesOnScopeLegacy(this.scope,this.services.dataSources),this.scope.infoNavContainerOptions?this.services.explorationCapabilities.setCapabilities(this.scope.infoNavContainerOptions):this.scope.infoNavContainerOptions=this.services.explorationCapabilities.getCapabilities(),this.scope.infoNavContainerOptions.shouldShowPageFilters=function(t){return e.shouldShowPageFilters(t)},this.services.explorationCapabilities.setCapabilities(this.scope.infoNavContainerOptions),this.services.viewModeState.setMode(0),this.explorationLoadedEventRaised=!1,this.scope.viewModel=n.viewModels.ViewModelFactory.createInfoNavContainer(this.services.filterGenerator),this.scope.hasResult=!1;var t=s.createFieldListViewModelFactory(s.createFieldListMenuItemFactory(this.services.localizationService,this.services.featureSwitchService),s.createFieldListPropertyTemplateGenerator(),this.services.localizationService,this.services.featureSwitchService);this.scope.fieldListConfig={viewModelFactory:t,alwaysHasActiveItem:!0},this.scope.newQnaEnabled=!this.services.rtl.isRtlLayout&&!this.scope.infoNavContainerOptions.cortana&&!this.scope.infoNavContainerOptions.disableQnaInput;var i=this.scope.hostService.getInitialVisualState;this.scope.state=i?i():0,this.services.undoRedo.setHandler({rollback:function(){},takeSnapshot:function(){return null}}),this.services.pinVisual.setHandler({pinVisual:function(t){e.pinVisual(t)}}),this.interpretListener=new v(this.services.timeout,new h(this.services.timeout,new g(this))),this.scope.hostService.setInterpretListener(this.interpretListener),this.scope.$watchGroup(["infoNavCanvasDefinition","infoNavCanvasDefinition.maxHeight"],(function(){e.scope.infoNavContentMaxHeight=null;var t=e.scope.infoNavCanvasDefinition;if(t&&t.maxHeight&&t.maxHeight>0){var n=c+l;e.scope.infoNavContentMaxHeight=t.maxHeight+n+"px"}}));var o=this.services.rootScope.$on(r.openTileEventName,(function(t,n){return e.onOpenTile(t,n)})),a=this.services.rootScope.$on(r.pinSelectedVisual,(function(t){return e.pinSelectedVisual(t)})),p=this.services.rootScope.$on(r.showQnaStart,(function(){e.scope.hasResult=!1,e.scope.state=4}));this.scope.$on("$destroy",(function(){e.interpretListener=null,e.scope.hostService.setInterpretListener(null),o(),a(),p()}))},t.prototype.shouldShowPageFilters=function(e){var t=this.scope.infoNavCanvasDefinition;return t.section!==e||t.showPageFilters},t.prototype.setNewCanvasDefinition=function(e){var t=this;this.scope.infoNavCanvasDefinition=e,this.raiseExplorationLoadedEventIfNeeded();var n=e.dataSources;this.services.dataSources.set(n),this.scope.packageId=e.model.packageId,e.initializePromise.then((function(){e===t.scope.infoNavCanvasDefinition&&(e.resetSelection&&t.services.selection.clearSelection(),t.scope.hostService.updatePinIconState&&t.scope.hostService.updatePinIconState({visible:!0,enabled:e.pinEnabled}),t.services.viewModeState.updateConfig((function(n){n.alwaysPopulatePanes=!t.scope.infoNavContainerOptions.cortana&&!t.scope.infoNavContainerOptions.embedded&&!e.pod})),t.scope.infoNavContainerOptions.showTaskPane=!t.scope.infoNavContainerOptions.cortana&&!t.scope.infoNavContainerOptions.embedded&&!e.pod,t.services.explorationCapabilities.setCapabilities(t.scope.infoNavContainerOptions),t.updateState(3),t.scope.hasResult=!0)}))},t.prototype.pinVisual=function(e){var t=this.scope.infoNavCanvasDefinition.model;t&&(this.scope.infoNavCanvasDefinition.pod||(e.action={action:r.openTileAction},e.utterance=this.utterance,e.modelId=t.id,e.packageId=t.packageId,this.services.rootScope.$emit(o.pinVisualContainerEventName,e)))},t.prototype.showDefaultError=function(t){var n=this;this.scope.hasResult=!1,this.scope.infoNavCanvasDefinition=null,this.updateState(2);var i=this.services.featureSwitchService.featureSwitches,r=_.any(this.scope.models,(function(e){return a.getIsQnaSupported(e,i)}));e.common.localize.ensureLocalization((function(){r?n.scope.errorMessage=e.common.localize.get("QnaStart_ErrorPrompt"):n.scope.errorMessage=e.common.localize.get(1===n.scope.models.length?"QnAVisualization_UnsupportedModelTitleText":"QnAVisualization_UnsupportedModelsTitleText")}))},t.prototype.updateState=function(e){var t=this,n=this.scope;n.state!==e&&(!this.openTileEvent||3!==e&&2!==e||(2!==e?this.openTileEvent.resolve():this.openTileEvent.reject(),this.openTileEvent=null),n.state=e,this.raiseStateChanged(),window.setTimeout((function(){return t.scope.$apply()})))},t.prototype.onOpenTile=function(e,t){e.stopPropagation(),this.interpretListener.onInterpretResultCleared(),this.openTileEvent=t.openTileTelemetryEvent,this.utterance=t.utterance,this.utteranceData=null;var n=this.services.infoNavCanvasDefinitionFactory.createGivenTileData(t,this.scope.models,this.services.visualPlugin);this.setNewCanvasDefinition(n),this.scope.hostService.setUtteranceText&&t.utterance&&this.scope.hostService.setUtteranceText(t.utterance)},t.prototype.pinSelectedVisual=function(t){if(t.stopPropagation(),3===this.scope.state)if(this.scope.infoNavCanvasDefinition.pod){var n=this.scope.infoNavCanvasDefinition,i={exploration:n.exploration,section:n.section,reportId:n.exploration.contract.reportId,modelId:n.model.id,packageId:n.model.packageId,action:{action:e.common.constants.tileActions.openQnAActionName},utterance:this.utterance,pod:n.pod.name,filters:n.extractParameterFilters()};this.services.rootScope.$emit(e.common.constants.pinReportPageToDashboard,i)}else{var r=this.services.selection.getSelectedElements(),o=r[0].visualContainer,s=[],a=o.filters||[],u=this.services.explorationNavigation.getCurrentSection();u&&u.filters&&u.filters.length&&(a=a.concat(u.filters));for(var c=[],l=0,p=a.length;l<p;l++){var d=a[l].filter;d&&(s.push(d),c.push(a[l]))}var h={dataFilter:e.data.SemanticFilter.merge(s),highlightFilter:null,filterMetadata:this.services.filterGenerator.generateFilterMetadata(c)};this.services.pinVisual.pinVisualContainer(this.scope.infoNavCanvasDefinition.dataSources,o,h)}},t.prototype.raiseStateChanged=function(){var e=this.scope.hostService.onStateChanged;e&&e(this.utteranceData,this.scope.state)},t.prototype.raiseRenderedVisualUtteranceDataChanged=function(){var e=this.scope.hostService.updateRenderedVisualUtteranceData;e&&e(this.utteranceData)},t.prototype.raiseExplorationLoadedEventIfNeeded=function(){this.explorationLoadedEventRaised||(this.scope.$broadcast(e.explore.constants.explorationLoadedEventName),this.explorationLoadedEventRaised=!0)},t})();i.InfoNavContainerController=p;var d=500,h=(function(){function e(e,t,n){this.timeout=e,this.interpretListener=t,this.throttleTimeoutMilliseconds=n||d}return e.prototype.onInterpretIssued=function(){this.interpretListener.onInterpretIssued()},e.prototype.onInterpretSuccess=function(e,t,n,i){var r=this;this.doThrottledVisualUpdate((function(){return r.interpretListener.onInterpretSuccess(e,t,n,i)}))},e.prototype.onInterpretError=function(e,t){var n=this;this.doThrottledVisualUpdate((function(){return n.interpretListener.onInterpretError(e,t)}))},e.prototype.onInterpretResultCleared=function(){this.cancelThrottledVisualUpdate(),this.interpretListener.onInterpretResultCleared()},e.prototype.cancelThrottledVisualUpdate=function(){this.throttledVisualUpdatePromise&&this.timeout.cancel(this.throttledVisualUpdatePromise),this.throttledVisualUpdatePromise=null,this.doWaitingVisualUpdate=null},e.prototype.doThrottledVisualUpdate=function(e){var t=this;this.throttledVisualUpdatePromise?this.doWaitingVisualUpdate=e:(e(),this.throttledVisualUpdatePromise=this.timeout((function(){if(t.throttledVisualUpdatePromise=null,t.doWaitingVisualUpdate){var e=t.doWaitingVisualUpdate;t.doWaitingVisualUpdate=null,t.doThrottledVisualUpdate(e)}}),this.throttleTimeoutMilliseconds))},e})();i.ThrottledInterpretListener=h;var g=(function(){function e(e){this.innerListener=e}return e.prototype.onInterpretIssued=function(){this.innerListener.onInterpretIssued()},e.prototype.onInterpretSuccess=function(e,t,n,i){this.currentUtteranceData&&t.interpretResult.completedUtterance===this.currentUtteranceData.interpretResult.completedUtterance||(this.currentUtteranceData=t,this.innerListener.onInterpretSuccess(e,t,n,i))},e.prototype.onInterpretError=function(e,t){this.innerListener.onInterpretError(e,t)},e.prototype.onInterpretResultCleared=function(){this.innerListener.onInterpretResultCleared()},e})();i.CompletedUtteranceInterpretListener=g;var f=1e3,v=(function(){function e(e,t,n){this.timeout=e,this.interpretListener=t,this.errorDelayTimeoutMilliseconds=n||f}return e.prototype.onInterpretIssued=function(){this.cancelWaitingError(),this.interpretListener.onInterpretIssued()},e.prototype.onInterpretSuccess=function(e,t,n,i){this.cancelWaitingError(),this.interpretListener.onInterpretSuccess(e,t,n,i)},e.prototype.onInterpretError=function(e,t){var n=this;this.cancelWaitingError(),t||(this.onErrorPromise=this.timeout((function(){n.interpretListener.onInterpretError(e,t)}),this.errorDelayTimeoutMilliseconds))},e.prototype.onInterpretResultCleared=function(){this.cancelWaitingError(),this.interpretListener.onInterpretResultCleared()},e.prototype.cancelWaitingError=function(){this.onErrorPromise&&this.timeout.cancel(this.onErrorPromise),this.onErrorPromise=null},e})();i.DelayedErrorInterpretListener=v})(i=n.controllers||(n.controllers={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i=e.common.helpers.ModelConverterHelper,r=10,o=(function(){function n(e,t){var i=this;this.scope=e,this.services=t,e.showUtterance=function(e){return i.showUtterance(e)},e.toggleLimit=function(e){return n.toggleLimit(e)},e.viewModel={modelSuggestionSets:[]},this.loadSuggestions(),e.$watch("models",(function(){return i.loadSuggestions()}))}return n.createOptions=function(){return{additionalServices:["localizationService","promiseFactory","sampleQuestionsService","telemetryService","featureSwitchService"]}},n.prototype.loadSuggestions=function(){var e=this.services,t=this.scope,i=t.models;return _.isEmpty(i)?void(t.viewModel.modelSuggestionSets=[]):(t.isLoading=!0,void n.loadSuggestionsForModels(i,e).then((function(e){i===t.models&&(t.viewModel.modelSuggestionSets=e,t.isLoading=!1)})))},n.loadSuggestionsForModels=function(e,t){for(var i=t.promiseFactory.defer(),r=[],o=t.sampleQuestionsService.getSampleQuestions(e),s=0,a=0,u=o;a<u.length;a++){var c=u[a];c.then((function(o){if(!_.isEmpty(o)){var s=n.getSuggestionsForSampleQuestions(e,o,t.featureSwitchService.featureSwitches);n.mergeSuggestionSets(r,s),r.length>0&&i.resolve(r)}})),c.finally((function(){s++,s===o.length&&i.resolve(r)}))}return i.promise},n.getSuggestionsForSampleQuestions=function(e,t,o){return _.isEmpty(t)?[]:_(e||[]).filter((function(e){return i.getIsQnaSupported(e,o)})).map((function(e){return{modelName:e.displayName,dbName:e.dbName,vsName:e.vsName,initialSuggestionLimit:r,currentSuggestionLimit:r,suggestions:_(t).filter((function(t){return t.modelId===e.id})).map((function(e){return{suggestion:e.question.trim(),source:n.convertSampleQuestionSource(e.source)}})).uniq((function(e){return e.suggestion.toUpperCase()})).value()}})).filter((function(e){return e.suggestions.length>0})).value()},n.mergeSuggestionSets=function(e,t){for(var n=0,i=t;n<i.length;n++){var r=i[n],o=r.dbName,s=r.vsName,a=_.find(e,(function(e){return e.dbName===o&&e.vsName===s}));a?a.suggestions=_(a.suggestions.concat(r.suggestions)).uniq((function(e){return e.suggestion.trim().toUpperCase()})).value():e.push(r)}},n.prototype.showUtterance=function(t){var n=_.isEmpty(this.scope.errorMessage)?e.telemetry.QnaStartPageType.HowToAsk:e.telemetry.QnaStartPageType.ErrorPage;this.services.telemetryService.logEvent(e.telemetry.QnAQnaStartSuggestionClicked,t.source,n);var i=t.suggestion;_.endsWith(i," ")||(i+=" "),this.scope.interpretUtterance(i)},n.toggleLimit=function(e){e.currentSuggestionLimit?e.currentSuggestionLimit=void 0:e.currentSuggestionLimit=e.initialSuggestionLimit},n.convertSampleQuestionSource=function(n){switch(n){case t.services.SampleQuestionSource.Generated:return e.telemetry.QnaStartSuggestionType.Generated;case t.services.SampleQuestionSource.Tile:return e.telemetry.QnaStartSuggestionType.Tile;case t.services.SampleQuestionSource.FeaturedQuestion:return e.telemetry.QnaStartSuggestionType.FeaturedQuestion;default:return e.telemetry.QnaStartSuggestionType.Generated}},n})();n.InfoNavQnaStartController=o})(n=t.controllers||(t.controllers={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i;!(function(n){var i=e.common.helpers.ModelConverterHelper,r=(jsCommon.DOMConstants,e.infonav.utils.QnaLanguageUtil),o=(function(){function e(e,o,s,a,u,c,l,p,d){var h=this;this.interpretService=l,this.qnaInputInterpreterService=d,this.utteranceElement=e.find("#utteranceContent")[0],this.captureElement=e.find("#cap")[0],this.contentElement=e.find("#content")[0],this.stateMachine=t.stateMachine.createStateMachine(n.QnaInputStateMachine.definition,n.QnaInputState.Inactive),this.registerStateMachineActions();var g={stateMachine:this.stateMachine,contentElement:this.contentElement,utteranceElement:this.utteranceElement,captureElement:this.captureElement,utterance:function(e,t){return h.processUtterance(e,t)},selectCharacters:function(e,t){return h.selectCharacters(e,t)}};this.termManager=new n.TermManager(p,g);var f=this.output;f.showQnaFeedback=!1,f.updateUtteranceWithoutInterpret=function(e){h.processUtterance(e,!0,!0),h.sendInterpretForCurrentInput(!1),h.selectCharacters(e.length),h.contentElement.focus()},f.interpretUtterance=function(e){var t=h.processUtterance(e);return h.selectCharacters(t.length),h.contentElement.focus(),t};var v=a.featureSwitches;this.sharedViewModel={additionalODataFilterGetter:function(){return h.getAdditionalODataFilter},interpretListener:function(){return h.interpretListener},interpretResponse:null,models:function(){return _.filter(h.models,(function(e){return e&&i.getIsQnaSupported(e,v)}))},showLoadingPlaceholder:!1,showLoadingSpinner:!1,showPinButton:!1,showQnaFeedback:function(e){return h.output.showQnaFeedback=e},stateMachine:this.stateMachine,storedUserInput:null,usageReportingEnabled:function(){return h.usageReportingEnabled},userInput:function(e){return h.processUtterance(e)}},this.interpretService.probe(_.filter(this.models,(function(e){return e&&i.getIsQnaSupported(e,v)}))).then((function(e){var t=_.map(e.results,(function(e){return e.source}));h.placeholder=r.getPlaceholderText(s,t)})),this.addEventListeners()}return e.createOptions=function(){return{additionalServices:["$element","interpretUsageListener","localizationService","featureSwitchService","modalDialogService","promiseFactory","interpretService","termConverterService","qnaInputInterpreterService"]}},e.prototype.selectUtterance=function(){this.contentElement.focus(),this.selectCharacters(0,this.utterance.length)},e.prototype.processUtterance=function(e,t,i){if(void 0!==e){e=e.replace(/\s/g," ");var r=this.contentElement.selectionStart,o=this.contentElement.selectionEnd;this.termManager.updateUtterance(this.output.utterance,e,t),this.contentElement.value=this.output.utterance=e,this.selectCharacters(r,o),_.isEmpty(e)?this.interpretListener&&this.interpretListener.onInterpretResultCleared():i||this.stateMachine.enqueueTransition(n.QnaInputTransitionId.TextChanged)}return this.utterance},Object.defineProperty(e.prototype,"utterance",{get:function(){return this.output.utterance},set:function(e){this.processUtterance(e)},enumerable:!0,configurable:!0}),e.prototype.addEventListeners=function(){var e=this;this.contentElement.addEventListener("input",(function(t){return e.utterance=e.contentElement.value})),this.contentElement.addEventListener("focus",(function(){return e.utteranceFocus()})),this.contentElement.addEventListener("blur",(function(){return e.utteranceBlur()})),this.contentElement.addEventListener("keyup",(function(t){switch(t.keyCode){case 39:case 37:case 35:case 36:e.stateMachine.enqueueTransition(n.QnaInputTransitionId.NavigateLeftRight)}})),this.contentElement.addEventListener("keydown",(function(t){switch(t.keyCode){case 9:e.termManager.hasCurrentTerm()&&(e.stateMachine.enqueueTransition(n.QnaInputTransitionId.TextSuggestionConfirmed),t.preventDefault());break;case 13:e.termManager.hasCurrentTerm()?e.stateMachine.enqueueTransition(n.QnaInputTransitionId.TextSuggestionConfirmed):e.stateMachine.enqueueTransition(n.QnaInputTransitionId.ConfirmQuery),t.preventDefault();break;case 40:e.stateMachine.enqueueTransition(n.QnaInputTransitionId.NavigateDown),t.preventDefault();break;case 38:e.stateMachine.enqueueTransition(n.QnaInputTransitionId.NavigateUp),t.preventDefault();break;case 27:e.termManager.hasOpenMenu?e.termManager.hideMenus():e.clear(),t.preventDefault()}}))},e.prototype.hideAllMenus=function(){this.stateMachine.enqueueTransition(n.QnaInputTransitionId.NavigateOutOfBounds)},e.prototype.utteranceBlur=function(){this.stateMachine.enqueueTransition(n.QnaInputTransitionId.EndSession)},e.prototype.utteranceFocus=function(){this.contentElement.value===this.placeholder&&(this.contentElement.value=""),_.isEmpty(this.contentElement.value)&&this.stateMachine.enqueueTransition(n.QnaInputTransitionId.BeginSession)},e.prototype.clear=function(){this.contentElement.value=this.utterance="",this.termManager.clearTerms(),this.interpretListener&&this.interpretListener.onInterpretResultCleared(),this.contentElement.focus()},e.prototype.selectCharacters=function(e,t){void 0===t&&(t=e),this.contentElement.setSelectionRange(e,t)},e.prototype.registerStateMachineActions=function(){var e=this;this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.interpret,(function(){return e.sendInterpretForCurrentInput()})),this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.sendInterpretProbe,(function(){return e.interpretService.probe(e.models)})),this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.displayQueryResult,(function(){return e.interpretLoaded(!1)})),this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.updateResult,(function(){return e.interpretLoaded(!0)})),this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.storeUserInput,(function(){})),
this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.restoreUserInput,(function(){})),this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.clearUserInputBuffer,(function(){})),this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.displaySuggestionsForEmptyQuery,(function(){})),this.stateMachine.addTransitionActionHandler(n.QnaInputTransitionAction.textInput_UpdateTermSelection,(function(){}))},e.prototype.sendInterpretForCurrentInput=function(e){void 0===e&&(e=!0),this.interpretListener&&this.interpretListener.onInterpretIssued(),this.qnaInputInterpreterService.sendInterpret(this.utterance,this.sharedViewModel,this.termManager.getUserSpanBindings(),e)},e.prototype.interpretLoaded=function(e){var t=this.sharedViewModel.interpretResponse,n=this.contentElement.selectionEnd>=this.contentElement.value.trim().length&&!e;this.termManager.processInterpret(t,n)},e})();n.QnaInputController=o,o.$inject=o.createOptions().additionalServices})(i=n.qna||(n.qna={}))})(n=t.controllers||(t.controllers={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(e){e[e.clearInterpretResult=0]="clearInterpretResult",e[e.clearUserInputBuffer=1]="clearUserInputBuffer",e[e.displayQueryResult=2]="displayQueryResult",e[e.displaySuggestionsForEmptyQuery=3]="displaySuggestionsForEmptyQuery",e[e.interpret=4]="interpret",e[e.restoreUserInput=5]="restoreUserInput",e[e.selectTerm=6]="selectTerm",e[e.sendInterpretProbe=7]="sendInterpretProbe",e[e.setInputTextToSelectedSuggestion=8]="setInputTextToSelectedSuggestion",e[e.storeUserInput=9]="storeUserInput",e[e.suggestionList_Clear=10]="suggestionList_Clear",e[e.suggestionList_ClearPreserveRestatement=11]="suggestionList_ClearPreserveRestatement",e[e.suggestionList_ClearSelection=12]="suggestionList_ClearSelection",e[e.suggestionList_SelectNext=13]="suggestionList_SelectNext",e[e.suggestionList_SelectPrevious=14]="suggestionList_SelectPrevious",e[e.textInput_Blur=15]="textInput_Blur",e[e.textInput_Clear=16]="textInput_Clear",e[e.textInput_ClearTermHighlights=17]="textInput_ClearTermHighlights",e[e.textInput_CompleteInput=18]="textInput_CompleteInput",e[e.textInput_ShowAutoCompletion=19]="textInput_ShowAutoCompletion",e[e.textInput_UpdateTermSelection=20]="textInput_UpdateTermSelection",e[e.updateResult=21]="updateResult",e[e.hideMenus=22]="hideMenus",e[e.startNavigate=23]="startNavigate",e[e.findTerm=24]="findTerm"})(n=t.QnaInputTransitionAction||(t.QnaInputTransitionAction={}));var i;!(function(e){e[e.BeginSession=0]="BeginSession",e[e.EndSession=1]="EndSession",e[e.ClearInterpretResult=2]="ClearInterpretResult",e[e.ClearQueryWithBlur=3]="ClearQueryWithBlur",e[e.ClearQueryWithoutBlur=4]="ClearQueryWithoutBlur",e[e.ConfirmQuery=5]="ConfirmQuery",e[e.TextChanged=6]="TextChanged",e[e.CompleteQuery=7]="CompleteQuery",e[e.NavigateUp=8]="NavigateUp",e[e.NavigateDown=9]="NavigateDown",e[e.NavigateOutOfBounds=10]="NavigateOutOfBounds",e[e.TextSuggestionSelected=11]="TextSuggestionSelected",e[e.TextSuggestionConfirmed=12]="TextSuggestionConfirmed",e[e.TermSelected=13]="TermSelected",e[e.ResultReady=14]="ResultReady",e[e.NavigateLeftRight=15]="NavigateLeftRight"})(i=t.QnaInputTransitionId||(t.QnaInputTransitionId={}));var r;!(function(e){e[e.Inactive=0]="Inactive",e[e.Typing=1]="Typing",e[e.BrowseSuggestions=2]="BrowseSuggestions",e[e.TermSelection=3]="TermSelection"})(r=t.QnaInputState||(t.QnaInputState={}));var o=(function(){function t(){}return Object.defineProperty(t,"definition",{get:function(){return t.storedDefinition||t.initializeDefinition(),t.storedDefinition},enumerable:!0,configurable:!0}),t.initializeDefinition=function(){t.storedDefinition=new e.stateMachine.StateMachineDefinition,t.storedDefinition.addTransition(r.Inactive,i.BeginSession,r.Typing,t.beginSessionActions),t.storedDefinition.addTransition(r.Inactive,i.ClearInterpretResult,r.Inactive,t.clearInterpretResultActions),t.storedDefinition.addTransition(r.Inactive,i.ClearQueryWithBlur,r.Inactive,t.clearQueryWithBlurEventActions),t.storedDefinition.addTransition(r.Inactive,i.ClearQueryWithoutBlur,r.Inactive,t.clearQueryWithoutBlurEventActions),t.storedDefinition.addTransition(r.Inactive,i.ResultReady,r.Typing,t.inactiveStateResultReadyActions),t.storedDefinition.addTransition(r.Inactive,i.TextChanged,r.Typing,t.textChangedEventActions),t.storedDefinition.addTransition(r.Inactive,i.TextSuggestionConfirmed,r.Typing,t.textSuggestionConfirmedActions),t.storedDefinition.addTransition(r.Inactive,i.TextSuggestionSelected,r.Typing,[n.setInputTextToSelectedSuggestion]),t.storedDefinition.addTransition(r.Inactive,i.TermSelected,r.BrowseSuggestions,t.termSelectedActions),t.storedDefinition.addTransition(r.Inactive,i.NavigateOutOfBounds,r.Inactive,t.navigateOutOfBoundsEventActions),t.storedDefinition.addTransition(r.Typing,i.ClearInterpretResult,r.Typing,t.clearInterpretResultActions),t.storedDefinition.addTransition(r.Typing,i.ClearQueryWithBlur,r.Typing,t.clearQueryWithBlurEventActions),t.storedDefinition.addTransition(r.Typing,i.ClearQueryWithoutBlur,r.Typing,t.clearQueryWithoutBlurEventActions),t.storedDefinition.addTransition(r.Typing,i.CompleteQuery,r.Typing,t.completeQueryEventActions),t.storedDefinition.addTransition(r.Typing,i.EndSession,r.Inactive,t.endSessionEventTypingActions),t.storedDefinition.addTransition(r.Typing,i.NavigateDown,r.BrowseSuggestions,t.navigateDownEventActions),t.storedDefinition.addTransition(r.Typing,i.NavigateUp,r.BrowseSuggestions,t.navigateUpEventActions),t.storedDefinition.addTransition(r.Typing,i.NavigateOutOfBounds,r.Typing,t.navigateOutOfBoundsEventActions),t.storedDefinition.addTransition(r.Typing,i.NavigateLeftRight,r.Typing,t.navigateLeftRightEventActions),t.storedDefinition.addTransition(r.Typing,i.ResultReady,r.Typing,t.queryResultReadyEventActions),t.storedDefinition.addTransition(r.Typing,i.TermSelected,r.BrowseSuggestions,t.termSelectedActions),t.storedDefinition.addTransition(r.Typing,i.TextChanged,r.Typing,t.textChangedEventActions),t.storedDefinition.addTransition(r.Typing,i.TextSuggestionConfirmed,r.TermSelection,t.textSuggestionConfirmedActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.ClearInterpretResult,r.Typing,t.clearInterpretResultActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.ClearQueryWithBlur,r.Typing,t.clearQueryWithBlurEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.ClearQueryWithoutBlur,r.Typing,t.clearQueryWithoutBlurEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.ConfirmQuery,r.TermSelection,t.confirmQueryEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.EndSession,r.Inactive,t.endSessionBrowseSuggestionsEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.NavigateDown,r.BrowseSuggestions,t.selectNextActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.NavigateOutOfBounds,r.Typing,t.navigateOutOfBoundsEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.NavigateUp,r.BrowseSuggestions,t.selectPreviousActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.NavigateLeftRight,r.Typing,t.navigateLeftRightEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.TermSelected,r.BrowseSuggestions,t.termSelectedActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.TextChanged,r.Typing,t.textChangedEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.TextSuggestionConfirmed,r.TermSelection,t.textSuggestionConfirmedActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.TextSuggestionSelected,r.BrowseSuggestions,[n.setInputTextToSelectedSuggestion]),t.storedDefinition.addTransition(r.TermSelection,i.ClearInterpretResult,r.Typing,t.clearInterpretResultActions),t.storedDefinition.addTransition(r.TermSelection,i.ClearQueryWithBlur,r.Typing,t.clearQueryWithBlurEventActions),t.storedDefinition.addTransition(r.TermSelection,i.ClearQueryWithoutBlur,r.Typing,t.clearQueryWithoutBlurEventActions),t.storedDefinition.addTransition(r.TermSelection,i.EndSession,r.Inactive,t.endSessionBrowseSuggestionsEventActions),t.storedDefinition.addTransition(r.TermSelection,i.NavigateDown,r.BrowseSuggestions,t.navigateDownEventActions),t.storedDefinition.addTransition(r.TermSelection,i.NavigateUp,r.BrowseSuggestions,t.navigateUpEventActions),t.storedDefinition.addTransition(r.TermSelection,i.NavigateOutOfBounds,r.Typing,t.navigateOutOfBoundsEventActions),t.storedDefinition.addTransition(r.TermSelection,i.ResultReady,r.Typing,t.termSelectionQueryResultReadyEventActions),t.storedDefinition.addTransition(r.TermSelection,i.TermSelected,r.BrowseSuggestions,t.termSelectedActions),t.storedDefinition.addTransition(r.TermSelection,i.TextChanged,r.Typing,t.textChangedEventActions),t.storedDefinition.addTransition(r.TermSelection,i.TextSuggestionSelected,r.Typing,[n.setInputTextToSelectedSuggestion]),t.storedDefinition.addTransition(r.TermSelection,i.TextSuggestionConfirmed,r.Typing,t.textSuggestionConfirmedActions)},t.storedDefinition=null,t.beginSessionActions=[n.displaySuggestionsForEmptyQuery,n.sendInterpretProbe],t.clearInterpretResultActions=[n.clearInterpretResult],t.clearQueryWithoutBlurEventActions=[n.textInput_Clear,n.suggestionList_Clear,n.clearInterpretResult],t.clearQueryWithBlurEventActions=[n.textInput_Blur].concat(t.clearQueryWithoutBlurEventActions),t.completeQueryEventActions=[n.textInput_CompleteInput,n.interpret],t.inactiveStateResultReadyActions=[n.updateResult],t.textChangedEventActions=[n.clearUserInputBuffer,n.interpret],t.selectPreviousActions=[n.suggestionList_SelectPrevious],t.selectNextActions=[n.suggestionList_SelectNext],t.navigateLeftRightEventActions=[n.findTerm],t.navigateUpEventActions=[n.storeUserInput].concat(t.selectPreviousActions),t.navigateDownEventActions=[n.findTerm,n.startNavigate],t.textSuggestionConfirmedActions=[n.setInputTextToSelectedSuggestion].concat(t.textChangedEventActions),t.endSessionEventActions=[],t.endSessionBrowseSuggestionsEventActions=[n.restoreUserInput].concat(t.endSessionEventActions),t.endSessionEventTypingActions=[n.hideMenus].concat(t.endSessionEventActions),t.queryResultReadyEventActions=[n.displayQueryResult],t.termSelectionQueryResultReadyEventActions=t.queryResultReadyEventActions.concat(n.textInput_UpdateTermSelection),t.confirmQueryEventActions=t.textChangedEventActions,t.navigateOutOfBoundsEventActions=[n.suggestionList_ClearSelection,n.restoreUserInput,n.hideMenus],t.termSelectedActions=[],t})();t.QnaInputStateMachine=o})(n=t.qna||(t.qna={}))})(t=e.controllers||(e.controllers={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i;!(function(n){function i(e){return new s(e)}var r=e.common.helpers.ModelConverterHelper,o=(function(){function e(e,r){var o=this;this.scope=e,this.services=r,e.infoNavControlContainer=i(r.promiseFactory),e.sharedViewModel={getAdditionalODataFilter:e.getAdditionalODataFilter,interpretListener:e.interpretListener,interpretResponse:null,models:this.filterModelsFromScope(e.models),showLoadingPlaceholder:!1,showLoadingSpinner:!1,showPinButton:!1,showQnaFeedback:!1,stateMachine:t.stateMachine.createStateMachine(n.QuestionBoxStateMachine.definition,n.QuestionBoxControlState.Inactive),storedUserInput:null,usageReportingEnabled:e.usageReportingEnabled,userInput:""};var s=e.output;s.utterance="",s.showQnaFeedback=!1,s.interpretUtterance=function(e){return o.updateUtterance(e,!0)},s.updateUtteranceWithoutInterpret=function(e){return o.updateUtterance(e,!1)},s.clearQuestionBox=function(){return o.clearQuestionBox()},s.showUserFeedbackDialog=function(){return o.showUserFeedbackDialog()};var a=[e.$watch("getAdditionalODataFilter",(function(t){return e.sharedViewModel.getAdditionalODataFilter=t})),e.$watch("interpretListener",(function(t){return e.sharedViewModel.interpretListener=t})),e.$watch("models",(function(t){return e.sharedViewModel.models=o.filterModelsFromScope(t)})),e.$watch("usageReportingEnabled",(function(t){return e.sharedViewModel.usageReportingEnabled=t})),e.$watch("sharedViewModel.showQnaFeedback",(function(t){return e.output.showQnaFeedback=t})),e.$watch("sharedViewModel.storedUserInput",(function(){return o.setOutputUtterance()})),e.$watch("sharedViewModel.userInput",(function(){return o.setOutputUtterance()}))];this.scope.$on("$destroy",(function(){for(var e=0,t=a;e<t.length;e++){var n=t[e];n()}}))}return e.createOptions=function(){return{additionalServices:["interpretUsageListener","localizationService","modalDialogService","promiseFactory","featureSwitchService"]}},e.prototype.filterModelsFromScope=function(e){var t=this.services.featureSwitchService.featureSwitches;return _.filter(e,(function(e){return e&&r.getIsQnaSupported(e,t)}))},e.prototype.setOutputUtterance=function(){var e=this.scope.sharedViewModel,t=this.scope.output;null!=e.storedUserInput?t.utterance=e.storedUserInput:t.utterance=e.userInput},e.prototype.updateUtterance=function(e,t){var i=this;this.scope.infoNavControlContainer.getTextInputControl().then((function(r){r.setInputText(e,!0),r.focus(),t&&i.scope.sharedViewModel.stateMachine.enqueueTransition(n.QuestionBoxControlTransitionId.TextChanged)}))},e.prototype.clearQuestionBox=function(){this.scope.sharedViewModel.stateMachine.enqueueTransition(n.QuestionBoxControlTransitionId.ClearQueryWithBlur)},e.prototype.showUserFeedbackDialog=function(){var e=this,t=this.services.localizationService,n=this.services.rootScope.$new(),i=[new InJs.ModalDialogAction(t.get("ModalDialog_Send"),function(t,i){n.closeDialog(),e.scope.sharedViewModel.usageReportingEnabled&&null!=n.feedback.selected&&e.services.interpretUsageListener.setFeedbackForLastUtterance(n.feedback.selected)},null,null,(!0)),new InJs.ModalDialogAction(t.get("ModalDialog_Cancel"),function(e,t){n.closeDialog()})],r={dialogName:t.get("UtteranceFeedbackDialogTitle"),isDismissable:!0,scope:n,template:"<user-feedback-dialog></user-feedback-dialog>",dialogActions:i};this.services.modalDialogService.showLegacyWebModalDialog(r)},e})();n.QuestionBoxContainerController=o,n.createInfoNavControlContainer=i;var s=(function(){function e(e){this._promiseFactory=e}return e.prototype.getTextInputControl=function(){return this._textInputControlDeferred||(this._textInputControlDeferred=this._promiseFactory.defer(),this._textInputControl&&this._textInputControlDeferred.resolve(this._textInputControl)),this._textInputControlDeferred.promise},e.prototype.setTextInputControl=function(e){this._textInputControl=e,this._textInputControlDeferred&&this._textInputControlDeferred.resolve(e)},e.prototype.getSuggestionListControl=function(){return this._suggestionListControlDeferred||(this._suggestionListControlDeferred=this._promiseFactory.defer(),this._suggestionListControl&&this._suggestionListControlDeferred.resolve(this._suggestionListControl)),this._suggestionListControlDeferred.promise},e.prototype.setSuggestionListControl=function(e){this._suggestionListControl=e,this._suggestionListControlDeferred&&this._suggestionListControlDeferred.resolve(e)},e})()})(i=n.qna||(n.qna={}))})(n=t.controllers||(t.controllers={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i;!(function(n){var i=e.infonav.contracts,r=3,o=4,s=2,a=3e3,u=(function(){function u(e,t){var n=this;this.latestProbeRequestId=0,this.outstandingInterpretRequests=[],this.scope=e,this.services=t,this.answeredQuestionEventLogger=t.answeredQuestionEventLoggerFactory.createAnsweredQuestionEventLogger(a),e.sharedViewModel.showLoadingPlaceholder=!1,e.infoNavControlContainer.getSuggestionListControl().then((function(t){e.infoNavControlContainer.getTextInputControl().then((function(e){n.suggestionListControl=t,n.textInputControl=e,n.registerStateMachineActions()}))})),this.sendInterpretProbeWithLoadingMessage(),e.$watch("sharedViewModel.models",(function(e,t){var i=_.map(e,(function(e){return e.id})),r=_.map(t,(function(e){return e.id})),o=_.difference(i,r);_.isEmpty(o)||n.sendInterpretProbeWithLoadingMessage()})),e.$watch("sharedViewModel.interpretResponse",(function(e){e&&e!==n.interpretResponse&&n.handleNewInterpretResponse(e,null)}))}return u.createOptions=function(){return{additionalServices:["answeredQuestionEventLoggerFactory","conceptualSchemaProxy","contentProviderHttpService","interpretService","interpretUsageListener","promiseFactory","telemetryService"]}},Object.defineProperty(u.prototype,"contentProviders",{get:function(){return this.services.contentProviderHttpService.getBuiltInContentProviders()},enumerable:!0,configurable:!0}),u.prototype.sendInterpretProbeWithLoadingMessage=function(){var t=this,n=this.scope.sharedViewModel;if(!_.isEmpty(n.models)){this.latestProbeRequestId++;var i=this.latestProbeRequestId;n.showLoadingPlaceholder=!0;var r=this.services.telemetryService.startEvent(e.telemetry.QnAQuestionBoxLoadingMessage),o=this.sendInterpretProbe(r.event).then((function(){return r.resolve()}),(function(){return r.reject()}));o.finally((function(){i===t.latestProbeRequestId&&(n.showLoadingPlaceholder=!1)}))}},u.prototype.sendInterpretProbe=function(e){var t=this,n=this.scope.sharedViewModel,i=this.services.interpretService.probe(n.models||[],e),r=this.services.promiseFactory.defer();return i.then((function(){u.preloadConceptualSchemas(n.models||[],t.services.conceptualSchemaProxy),r.resolve({})}),(function(){r.reject()})),r.promise},u.prototype.sendInterpretForCurrentInput=function(){var e=this,n=this.scope,r=n.sharedViewModel;r.showLoadingSpinner=!0,r.interpretListener&&r.interpretListener.onInterpretIssued();var o=this.answeredQuestionEventLogger.startAnsweredQuestionEvent(),a={},u=r.userInput,c=null;r.getAdditionalODataFilter&&(c=r.getAdditionalODataFilter());var l=this.services.promiseFactory.defer();this.outstandingInterpretRequests.push(l),this.enforceMaxConcurrentRequests();var p;if(!u||u.trim().length<s){var d=this.services.promiseFactory.defer();this.services.interpretService.probe(r.models).then((function(){return d.reject()}),(function(){return d.reject()})),p=d.promise}else p=this.services.interpretService.interpret(u,i.InterpretRequestOptions.QueryMetadata|i.InterpretRequestOptions.VisualConfiguration|i.InterpretRequestOptions.Data|i.InterpretRequestOptions.SupportPodQueries,r.models,c,a,l.promise),p.finally((function(){return o.resolve(a)}));p.then((function(n){if(!e.shouldIgnoreResponse(n,l,u)){if(e.handleNewInterpretResponse(n,l),r.interpretListener)if(!n||n.isEmpty(!0)||n.result.isEmpty(!0))r.interpretListener.onInterpretError(n?n.utterance:null,e.hasOutstandingRequests());else{var i=t.util.InterpretResultUtility.parseInterpret(n.result);i?r.interpretListener.onInterpretSuccess(n,i,c,!0):r.interpretListener.onInterpretError(n?n.utterance:null,e.hasOutstandingRequests())}r.usageReportingEnabled&&e.services.interpretUsageListener.onInterpretSuccess(n,e.getModelContentProviderType(n))}}),(function(){e.shouldIgnoreResponse(null,l,u)||(e.updateStateGivenResponse(null,l),r.interpretListener&&r.interpretListener.onInterpretError(u,e.hasOutstandingRequests()))})),r.usageReportingEnabled&&this.services.interpretUsageListener.onInterpretIssued()},u.prototype.handleNewInterpretResponse=function(e,t){this.updateStateGivenResponse(e,t),this.scope.sharedViewModel.stateMachine.enqueueTransition(n.QuestionBoxControlTransitionId.ResultReady)},u.prototype.shouldIgnoreResponse=function(e,t,n){if(!_.contains(this.outstandingInterpretRequests,t))return!0;var i=this.scope.sharedViewModel.userInput,r=n;e&&e.result&&e.result.completedUtterance&&!_.isEmpty(e.result.completedUtterance.Text)&&(r=e.result.completedUtterance.Text);var o=Math.min(i.length,r.length);return i.substr(0,o)!==r.substr(0,o)},u.prototype.updateStateGivenResponse=function(e,t){this.updateOutstandingRequestsGivenCompletedRequest(t);var n=this.scope.sharedViewModel;n.interpretResponse=this.interpretResponse=e,n.showLoadingSpinner=this.hasOutstandingRequests(),n.showQnaFeedback=n.usageReportingEnabled},u.prototype.hasOutstandingRequests=function(){return!_.isEmpty(this.outstandingInterpretRequests)},u.prototype.enforceMaxConcurrentRequests=function(){if(this.outstandingInterpretRequests.length>o)for(var e=this.outstandingInterpretRequests.splice(0,this.outstandingInterpretRequests.length-o),t=0,n=e;t<n.length;t++){var i=n[t];i.resolve({})}},u.prototype.updateOutstandingRequestsGivenCompletedRequest=function(e){var t;t=e?_.findIndex(this.outstandingInterpretRequests,(function(t){return t===e})):this.outstandingInterpretRequests.length;for(var n=0;n<t;n++)this.outstandingInterpretRequests[n].resolve({});this.outstandingInterpretRequests.splice(0,t+1)},u.prototype.storeInput=function(){this.scope.sharedViewModel.storedUserInput=this.scope.sharedViewModel.userInput||"",this.textInputControl.hideAutoCompletion()},u.prototype.restoreInput=function(){null!=this.scope.sharedViewModel.storedUserInput&&(this.textInputControl.setInputText(this.scope.sharedViewModel.storedUserInput,!1),this.textInputControl.showAutoCompletion(),this.scope.sharedViewModel.storedUserInput=null),this.interpretResponse&&this.textInputControl.applyNLResult(this.interpretResponse.result)},u.prototype.clearStoredInput=function(){this.scope.sharedViewModel.storedUserInput=null},u.prototype.setInputTextToSelectedSuggestion=function(){this.services.telemetryService.logEvent(e.telemetry.QnADropdownItemSelected,_.isEmpty(this.scope.sharedViewModel.userInput)),this.textInputControl.setInputText(this.suggestionListControl.currentSelectionText,!1)},u.prototype.clearInterpret=function(){var e=this.scope.sharedViewModel;e.interpretResponse=this.interpretResponse=null,e.showQnaFeedback=!1,e.showLoadingSpinner=!1;var t=this.outstandingInterpretRequests;this.outstandingInterpretRequests=[];for(var n=0,i=t;n<i.length;n++){var r=i[n];r.resolve({})}var o=e.interpretListener;o&&o.onInterpretResultCleared()},u.prototype.selectTermInternal=function(){var e=this.textInputControl.getSelection(),t=this.interpretResponse;t&&!e.isUserRangeSelection&&t.result.hasSuggestionsForTermSelection(e)?(this.textInputControl.highlightSelectedTerm(),this.displayQueryResultInternal(!0,!0,e)):this.displayQueryResultInternal(!0,!0)},u.prototype.displayQueryResultInternal=function(e,t,n){var i=this.interpretResponse;i?(this.suggestionListControl.displaySuggestions(this.scope.sharedViewModel.userInput,i,n,!t),this.textInputControl.applyNLResult(i.result,e)):this.suggestionListControl.displaySuggestions(this.scope.sharedViewModel.userInput)},u.prototype.displaySuggestionsForEmptyQuery=function(){jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(this.scope.sharedViewModel.userInput)&&this.suggestionListControl.displaySuggestions(null)},u.prototype.getModelContentProviderType=function(t){if(t){var n=t.result;if(n){var i=_.find(this.scope.sharedViewModel.models,(function(e){return e.vsName===n.virtualServerName&&e.dbName===n.databaseName}));if(i&&null!=i.contentProviderId)return e.common.findContentProviderName(this.contentProviders,i.contentProviderId)}}return"Unknown"},u.prototype.registerStateMachineActions=function(){var e=this,t=this.scope.sharedViewModel.stateMachine;t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.interpret,(function(){return e.sendInterpretForCurrentInput()})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.storeUserInput,(function(){return e.storeInput()})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.restoreUserInput,(function(){return e.restoreInput()})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.clearUserInputBuffer,(function(){return e.clearStoredInput()})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.setInputTextToSelectedSuggestion,(function(){return e.setInputTextToSelectedSuggestion()})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.clearInterpretResult,(function(){return e.clearInterpret()})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.displayQueryResult,(function(){return e.displayQueryResultInternal(!0,!0)})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.updateResult,(function(){return e.displayQueryResultInternal(!1,!1)})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.displaySuggestionsForEmptyQuery,(function(){return e.displaySuggestionsForEmptyQuery()})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.selectTerm,(function(){return e.selectTermInternal()})),t.addTransitionActionHandler(n.QuestionBoxControlTransitionAction.sendInterpretProbe,(function(){return e.sendInterpretProbe(null)}))},u.preloadConceptualSchemas=function(e,t){for(var n=Math.min(e.length,r),i=0,o=_.take(e,n);i<o.length;i++){var s=o[i];t.get(u.createDataSourceArray(s))}},u.createDataSourceArray=function(t){return e.explore.contracts.createDataSourceArray([{type:"dsr",id:t.id,packageId:t.packageId,name:void 0,dsr:{schemaName:void 0,vsName:t.vsName,dbName:t.dbName,modelId:t.id}}])},u})();n.QuestionBoxController=u})(i=n.qna||(n.qna={}))})(n=t.controllers||(t.controllers={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(e){e[e.clearInterpretResult=0]="clearInterpretResult",e[e.clearUserInputBuffer=1]="clearUserInputBuffer",e[e.displayQueryResult=2]="displayQueryResult",e[e.displaySuggestionsForEmptyQuery=3]="displaySuggestionsForEmptyQuery",e[e.interpret=4]="interpret",e[e.restoreUserInput=5]="restoreUserInput",e[e.selectTerm=6]="selectTerm",e[e.sendInterpretProbe=7]="sendInterpretProbe",e[e.setInputTextToSelectedSuggestion=8]="setInputTextToSelectedSuggestion",e[e.storeUserInput=9]="storeUserInput",e[e.suggestionList_Clear=10]="suggestionList_Clear",e[e.suggestionList_ClearPreserveRestatement=11]="suggestionList_ClearPreserveRestatement",e[e.suggestionList_ClearSelection=12]="suggestionList_ClearSelection",e[e.suggestionList_SelectNext=13]="suggestionList_SelectNext",e[e.suggestionList_SelectPrevious=14]="suggestionList_SelectPrevious",e[e.textInput_Blur=15]="textInput_Blur",e[e.textInput_Clear=16]="textInput_Clear",e[e.textInput_ClearTermHighlights=17]="textInput_ClearTermHighlights",e[e.textInput_CompleteInput=18]="textInput_CompleteInput",e[e.textInput_ShowAutoCompletion=19]="textInput_ShowAutoCompletion",e[e.textInput_UpdateTermSelection=20]="textInput_UpdateTermSelection",e[e.updateResult=21]="updateResult"})(n=t.QuestionBoxControlTransitionAction||(t.QuestionBoxControlTransitionAction={}));var i;!(function(e){e[e.BeginSession=0]="BeginSession",e[e.EndSession=1]="EndSession",e[e.ClearInterpretResult=2]="ClearInterpretResult",e[e.ClearQueryWithBlur=3]="ClearQueryWithBlur",e[e.ClearQueryWithoutBlur=4]="ClearQueryWithoutBlur",e[e.ConfirmQuery=5]="ConfirmQuery",e[e.TextChanged=6]="TextChanged",e[e.CompleteQuery=7]="CompleteQuery",e[e.NavigateUp=8]="NavigateUp",e[e.NavigateDown=9]="NavigateDown",e[e.NavigateOutOfBounds=10]="NavigateOutOfBounds",e[e.TextSuggestionSelected=11]="TextSuggestionSelected",e[e.TextSuggestionConfirmed=12]="TextSuggestionConfirmed",e[e.TermSelected=13]="TermSelected",e[e.ResultReady=14]="ResultReady"})(i=t.QuestionBoxControlTransitionId||(t.QuestionBoxControlTransitionId={}));var r;!(function(e){e[e.Inactive=0]="Inactive",e[e.Typing=1]="Typing",e[e.BrowseSuggestions=2]="BrowseSuggestions",e[e.TermSelection=3]="TermSelection"})(r=t.QuestionBoxControlState||(t.QuestionBoxControlState={}));var o=(function(){function t(){}return Object.defineProperty(t,"definition",{get:function(){return t.storedDefinition||t.initializeDefinition(),t.storedDefinition},enumerable:!0,configurable:!0}),t.initializeDefinition=function(){t.storedDefinition=new e.stateMachine.StateMachineDefinition,t.storedDefinition.addTransition(r.Inactive,i.BeginSession,r.Typing,t.beginSessionActions),t.storedDefinition.addTransition(r.Inactive,i.ClearInterpretResult,r.Inactive,t.clearInterpretResultActions),t.storedDefinition.addTransition(r.Inactive,i.ClearQueryWithBlur,r.Inactive,t.clearQueryWithBlurEventActions),t.storedDefinition.addTransition(r.Inactive,i.ClearQueryWithoutBlur,r.Inactive,t.clearQueryWithoutBlurEventActions),t.storedDefinition.addTransition(r.Inactive,i.ResultReady,r.Inactive,t.inactiveStateResultReadyActions),t.storedDefinition.addTransition(r.Inactive,i.TextChanged,r.Inactive,t.textChangedEventActions),t.storedDefinition.addTransition(r.Inactive,i.TextSuggestionConfirmed,r.Typing,t.textSuggestionConfirmedActions),t.storedDefinition.addTransition(r.Inactive,i.TextSuggestionSelected,r.Typing,[n.setInputTextToSelectedSuggestion]),t.storedDefinition.addTransition(r.Typing,i.ClearInterpretResult,r.Typing,t.clearInterpretResultActions),t.storedDefinition.addTransition(r.Typing,i.ClearQueryWithBlur,r.Typing,t.clearQueryWithBlurEventActions),t.storedDefinition.addTransition(r.Typing,i.ClearQueryWithoutBlur,r.Typing,t.clearQueryWithoutBlurEventActions),t.storedDefinition.addTransition(r.Typing,i.CompleteQuery,r.Typing,t.completeQueryEventActions),t.storedDefinition.addTransition(r.Typing,i.EndSession,r.Inactive,t.endSessionEventTypingActions),t.storedDefinition.addTransition(r.Typing,i.NavigateDown,r.BrowseSuggestions,t.navigateDownEventActions),t.storedDefinition.addTransition(r.Typing,i.NavigateUp,r.BrowseSuggestions,t.navigateUpEventActions),t.storedDefinition.addTransition(r.Typing,i.ResultReady,r.Typing,t.queryResultReadyEventActions),t.storedDefinition.addTransition(r.Typing,i.TermSelected,r.TermSelection,t.termSelectedActions),t.storedDefinition.addTransition(r.Typing,i.TextChanged,r.Typing,t.textChangedEventActions),t.storedDefinition.addTransition(r.Typing,i.TextSuggestionConfirmed,r.TermSelection,t.textSuggestionConfirmedActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.ClearInterpretResult,r.Typing,t.clearInterpretResultActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.ClearQueryWithBlur,r.Typing,t.clearQueryWithBlurEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.ClearQueryWithoutBlur,r.Typing,t.clearQueryWithoutBlurEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.ConfirmQuery,r.TermSelection,t.confirmQueryEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.EndSession,r.Inactive,t.endSessionBrowseSuggestionsEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.NavigateDown,r.BrowseSuggestions,t.selectNextActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.NavigateOutOfBounds,r.Typing,t.navigateOutOfBoundsEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.NavigateUp,r.BrowseSuggestions,t.selectPreviousActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.TermSelected,r.Typing,t.termSelectedActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.TextChanged,r.Typing,t.textChangedEventActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.TextSuggestionConfirmed,r.TermSelection,t.textSuggestionConfirmedActions),t.storedDefinition.addTransition(r.BrowseSuggestions,i.TextSuggestionSelected,r.BrowseSuggestions,[n.setInputTextToSelectedSuggestion]),t.storedDefinition.addTransition(r.TermSelection,i.ClearInterpretResult,r.Typing,t.clearInterpretResultActions),t.storedDefinition.addTransition(r.TermSelection,i.ClearQueryWithBlur,r.Typing,t.clearQueryWithBlurEventActions),t.storedDefinition.addTransition(r.TermSelection,i.ClearQueryWithoutBlur,r.Typing,t.clearQueryWithoutBlurEventActions),t.storedDefinition.addTransition(r.TermSelection,i.EndSession,r.Inactive,t.endSessionBrowseSuggestionsEventActions),t.storedDefinition.addTransition(r.TermSelection,i.NavigateDown,r.BrowseSuggestions,t.navigateDownEventActions),t.storedDefinition.addTransition(r.TermSelection,i.NavigateUp,r.BrowseSuggestions,t.navigateUpEventActions),
t.storedDefinition.addTransition(r.TermSelection,i.ResultReady,r.Typing,t.termSelectionQueryResultReadyEventActions),t.storedDefinition.addTransition(r.TermSelection,i.TermSelected,r.Typing,t.termSelectedActions),t.storedDefinition.addTransition(r.TermSelection,i.TextChanged,r.Typing,t.textChangedEventActions),t.storedDefinition.addTransition(r.TermSelection,i.TextSuggestionSelected,r.Typing,[n.setInputTextToSelectedSuggestion]),t.storedDefinition.addTransition(r.TermSelection,i.TextSuggestionConfirmed,r.Typing,t.textSuggestionConfirmedActions)},t.storedDefinition=null,t.beginSessionActions=[n.displaySuggestionsForEmptyQuery,n.sendInterpretProbe],t.clearInterpretResultActions=[n.clearInterpretResult],t.clearQueryWithoutBlurEventActions=[n.textInput_Clear,n.suggestionList_Clear,n.clearInterpretResult],t.clearQueryWithBlurEventActions=[n.textInput_Blur].concat(t.clearQueryWithoutBlurEventActions),t.completeQueryEventActions=[n.textInput_CompleteInput,n.interpret],t.inactiveStateResultReadyActions=[n.updateResult],t.textChangedEventActions=[n.clearUserInputBuffer,n.interpret,n.textInput_ClearTermHighlights],t.selectPreviousActions=[n.textInput_ClearTermHighlights,n.suggestionList_SelectPrevious],t.selectNextActions=[n.textInput_ClearTermHighlights,n.suggestionList_SelectNext],t.navigateUpEventActions=[n.storeUserInput].concat(t.selectPreviousActions),t.navigateDownEventActions=[n.storeUserInput].concat(t.selectNextActions),t.textSuggestionConfirmedActions=[n.setInputTextToSelectedSuggestion].concat(t.textChangedEventActions),t.endSessionEventActions=[n.textInput_ClearTermHighlights,n.suggestionList_ClearPreserveRestatement,n.textInput_ShowAutoCompletion],t.endSessionBrowseSuggestionsEventActions=[n.restoreUserInput].concat(t.endSessionEventActions),t.endSessionEventTypingActions=t.endSessionEventActions,t.queryResultReadyEventActions=[n.displayQueryResult],t.termSelectionQueryResultReadyEventActions=t.queryResultReadyEventActions.concat(n.textInput_UpdateTermSelection),t.confirmQueryEventActions=t.textChangedEventActions,t.navigateOutOfBoundsEventActions=[n.suggestionList_ClearSelection,n.restoreUserInput],t.termSelectedActions=[n.textInput_ClearTermHighlights,n.selectTerm],t})();t.QuestionBoxStateMachine=o})(n=t.qna||(t.qna={}))})(t=e.controllers||(e.controllers={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){var n;!(function(t){var n=50,i=7,r=(function(){function r(e,t){var i=this;this.scope=e,this.services=t;var r=e.viewModel={restatement:null,uiSuggestionItems:[],maxSuggestions:n,showSuggestionsHost:!1,selectedSuggestionIndex:-1};e.handleSuggestionMouseDown=function(e,t){return i.handleSuggestionMouseDown(e,t)},e.handleSuggestionMouseEnter=function(e){r.selectedSuggestionIndex=e},e.infoNavControlContainer.setSuggestionListControl(this),this.registerStateMachineActions()}return r.createOptions=function(){return{additionalServices:["sampleQuestionsService"]}},r.prototype.clear=function(e){var t=this.scope,n=t.viewModel;n.selectedSuggestionIndex=-1,n.uiSuggestionItems=[],e?n.showSuggestionsHost=!!n.restatement:(n.restatement=null,n.showSuggestionsHost=!1)},r.prototype.clearSelection=function(){this.scope.viewModel.selectedSuggestionIndex=-1},r.prototype.selectPrevious=function(){var e=this.scope,t=e.viewModel;t.selectedSuggestionIndex===-1?this.attemptSelection(t.uiSuggestionItems.length-1):this.attemptSelection(t.selectedSuggestionIndex-1)},r.prototype.selectNext=function(){var e=this.scope;this.attemptSelection(e.viewModel.selectedSuggestionIndex+1)},Object.defineProperty(r.prototype,"currentSelectionText",{get:function(){var e=this.scope.viewModel,t=e.selectedSuggestionIndex,n=e.uiSuggestionItems;return t>=0&&t<n.length?n[t].text:null},enumerable:!0,configurable:!0}),r.prototype.displaySuggestions=function(e,t,n,i){var o=this.scope,s=o.viewModel,a=t?t.result:null;if(a&&a.restatement&&!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(a.restatement)?s.restatement=a.restatement:s.restatement=null,s.selectedSuggestionIndex=-1,i)return s.uiSuggestionItems=[],void(s.showSuggestionsHost=!!s.restatement);if(_.isEmpty(e)){s.showSuggestionsHost=!1;for(var u=s.uiSuggestionItems=[],c=this.services.sampleQuestionsService.getSampleQuestions(o.sharedViewModel.models),l=0,p=c;l<p.length;l++){var d=p[l];d.then((function(e){s.uiSuggestionItems===u&&(r.addSampleQuestionsToSuggestions(e,u),s.showSuggestionsHost=!_.isEmpty(s.uiSuggestionItems))}))}}else s.uiSuggestionItems=this.generateSuggestionsForUtterance(e,a,n),s.showSuggestionsHost=!_.isEmpty(s.uiSuggestionItems)||!_.isEmpty(s.restatement);o.scrollToTop&&this.services.timeout((function(){return o.scrollToTop()}),0,!1)},r.prototype.handleSuggestionMouseDown=function(e,n){n.preventDefault(),this.attemptSelection(e),this.doStateMachineTransition(t.QuestionBoxControlTransitionId.TextSuggestionConfirmed)},r.prototype.attemptSelection=function(e){var n=this.scope,i=n.viewModel;e>=0&&e<i.uiSuggestionItems.length?(i.selectedSuggestionIndex=e,this.doStateMachineTransition(t.QuestionBoxControlTransitionId.TextSuggestionSelected),n.scrollSelectionIntoView&&this.services.timeout((function(){return n.scrollSelectionIntoView()}),0,!1)):(i.selectedSuggestionIndex=-1,this.doStateMachineTransition(t.QuestionBoxControlTransitionId.NavigateOutOfBounds),n.scrollToTop&&this.services.timeout((function(){return n.scrollToTop()}),0,!1))},r.prototype.doStateMachineTransition=function(e){this.scope.sharedViewModel.stateMachine.enqueueTransition(e)},r.prototype.generateSuggestionsForUtterance=function(e,t,n){return t?n?t.getTermSuggestions(n):t.getCompletionSuggestions():[]},r.addSampleQuestionsToSuggestions=function(t,n){for(var r=function(t){var i=t.question.trim().toUpperCase(),r=_.any(n,(function(e){return e.text.trim().toUpperCase()===i}));r||n.push(new e.models.UISuggestionItem([{text:t.question,emphasize:!1}]))},o=0;n.length<i&&o<t.length;)r(t[o]),o++},r.prototype.registerStateMachineActions=function(){var e=this,n=this.scope.sharedViewModel.stateMachine;n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.suggestionList_Clear,(function(){return e.clear(!1)})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.suggestionList_ClearPreserveRestatement,(function(){return e.clear(!0)})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.suggestionList_ClearSelection,(function(){return e.clearSelection()})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.suggestionList_SelectNext,(function(){return e.selectNext()})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.suggestionList_SelectPrevious,(function(){return e.selectPrevious()}))},r})();t.SuggestionListController=r})(n=t.qna||(t.qna={}))})(t=e.controllers||(e.controllers={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(t){var n;!(function(t){var n=e.infonav.contracts,i=(function(){function e(e,n){var i=this;this.termConverterService=e,this.inputController=n,this.terms=[],this.stateMachine=n.stateMachine,this.utteranceElem=n.utteranceElement,this.currentTerm=null,this.userSpanBindings=[],this.stateMachine.addTransitionActionHandler(t.QnaInputTransitionAction.setInputTextToSelectedSuggestion,(function(){return i.setInputTextToSelectedSuggestion()})),this.stateMachine.addTransitionActionHandler(t.QnaInputTransitionAction.suggestionList_SelectNext,(function(){return i.navigateDown()})),this.stateMachine.addTransitionActionHandler(t.QnaInputTransitionAction.suggestionList_SelectPrevious,(function(){return i.navigateUp()})),this.stateMachine.addTransitionActionHandler(t.QnaInputTransitionAction.suggestionList_ClearSelection,(function(){return i.hideMenus()})),this.stateMachine.addTransitionActionHandler(t.QnaInputTransitionAction.textInput_ClearTermHighlights,(function(){return i.hideMenus()})),this.stateMachine.addTransitionActionHandler(t.QnaInputTransitionAction.hideMenus,(function(){i.hideMenus()})),this.stateMachine.addTransitionActionHandler(t.QnaInputTransitionAction.startNavigate,(function(){i.startNavigate()})),this.stateMachine.addTransitionActionHandler(t.QnaInputTransitionAction.findTerm,(function(){i.findCurrentTerm(i.inputController.contentElement.selectionStart,i.inputController.contentElement.selectionEnd)}))}return e.prototype.hasCurrentTerm=function(){return null!=this.currentTerm},Object.defineProperty(e.prototype,"hasOpenMenu",{get:function(){return this.currentTerm&&this.currentTerm.menuOpened},enumerable:!0,configurable:!0}),e.prototype.getUserSpanBindings=function(){return this.userSpanBindings},Object.defineProperty(e.prototype,"utteranceElement",{get:function(){return this.utteranceElem},enumerable:!0,configurable:!0}),e.prototype.hideMenus=function(){this.currentTerm&&this.currentTerm.closeMenu()},e.prototype.menuClosed=function(){this.currentTerm=null,this.inputController.captureElement.style.display="none"},e.prototype.updateUtterance=function(e,t,n){if(void 0===n&&(n=!1),!_.isEmpty(e)){if(_.isEmpty(t))return void(this.utteranceElem.innerHTML="");if(this.terms){for(var i=0,r=Math.min(e.length,t.length);i<r&&e.charAt(i)===t.charAt(i);)i++;i--;for(var o=e.length,s=t.length;o>i&&s>i&&e.charAt(o)===t.charAt(s);)o--,s--;o++,s++,n||this.updateUserBindings(i,o,s);for(var a=0,u=this.terms;a<u.length;a++){var c=u[a];c.span.StartIndex+c.text.length>=i&&(c.span.StartIndex<i-1?c.header.textContent=c.header.textContent.substr(0,i-c.span.StartIndex+1):c.element.parentElement===this.utteranceElem&&this.utteranceElem.removeChild(c.element))}}}},e.prototype.updateUserBindings=function(e,t,n){var i=t-n;_.remove(this.userSpanBindings,(function(n){var r=n.StartIndex,o=n.StartIndex+n.Length-1;return n.StartIndex>=t&&(n.StartIndex-=i),r>e&&o<t||r<e&&o>e||r<t&&o>t}))},e.prototype.processInterpret=function(e,t){void 0===t&&(t=!0),this.userSpanBindings=[];var i=this.termConverterService.convert(e),r=i.terms,o=this.inputController.utterance();if(o===e.utterance){var s=this.inputController.contentElement,a=s.selectionStart,u=s.selectionEnd;if(s.value=i.utterance,this.inputController.selectCharacters(a,u),r.length>0){for(var c=this.utteranceElem,l=_.indexBy(this.terms,(function(e){return e.span.StartIndex})),p=[],d=null,h=r.length-1;h>=0;h--){var g=r[h];g.manager=this,g.span.Source===n.SpanSource.User&&this.userSpanBindings.push(g.span);var f=l[g.span.StartIndex];f&&g.reuseElement(f)?p.push(f):c.insertBefore(g.element,d),d=g.element}for(var v=0,m=this.terms;v<m.length;v++){var g=m[v];_.contains(p,g)||g.element.parentElement!==this.utteranceElem||c.removeChild(g.element)}this.handleLayout(),i.hasCompletions&&t&&this.selectTerm(r[r.length-1],!0)}return this.terms=r,!0}return!1},e.prototype.handleLayout=function(){if(this.terms)for(var e=Number.MIN_VALUE,t=0,n=this.terms;t<n.length;t++){var i=n[t],r=$(i.element),o=r.offset().top;o>e?(e=o,r.addClass("row")):r.removeClass("row")}},e.prototype.selectReplacement=function(e,t){var n=this.inputController.utterance(),i=e.span.StartIndex+e.span.Length,r=e.span.StartIndex+t.length,o=n.substring(0,e.span.StartIndex)+t+n.substring(i);i===n.length&&(o+=" ",r++);var s=this.userSpanBindings.indexOf(e.span);if(s>-1&&this.userSpanBindings.splice(s,1),!e.currentReplacement.container.Core){this.userSpanBindings.push({StartIndex:e.span.StartIndex,Length:t.length,Binding:e.currentReplacement.container});for(var a=e.span.Length-t.length,u=0,c=this.userSpanBindings;u<c.length;u++){var l=c[u];l.StartIndex>e.span.StartIndex&&(l.StartIndex-=a)}}this.inputController.utterance(o,!0),this.inputController.selectCharacters(r),this.inputController.contentElement.focus(),this.currentTerm=null},e.prototype.selectTerm=function(e,n){void 0===n&&(n=!1),this.stateMachine.enqueueTransition(t.QnaInputTransitionId.TermSelected),this.currentTerm&&this.currentTerm!==e&&this.currentTerm.closeMenu(),this.currentTerm=e,e.openMenu()?(n||this.inputController.selectCharacters(e.span.StartIndex,e.span.StartIndex+e.span.Length),this.inputController.captureElement.style.display="block"):this.currentTerm=null},e.prototype.clearTerms=function(){this.utteranceElem.innerHTML="",this.terms=[]},e.prototype.navigateUp=function(){var e=!1;this.currentTerm&&(e=this.currentTerm.selectPreviousReplacement()),e||this.stateMachine.enqueueTransition(t.QnaInputTransitionId.NavigateOutOfBounds)},e.prototype.navigateDown=function(){this.currentTerm&&this.currentTerm.selectNextReplacement()},e.prototype.startNavigate=function(){this.currentTerm?this.selectTerm(this.currentTerm):this.stateMachine.enqueueTransition(t.QnaInputTransitionId.NavigateOutOfBounds)},e.prototype.findCurrentTerm=function(e,t){var n=this.findTerm(e,t);n&&n===this.currentTerm||!this.currentTerm||this.currentTerm.closeMenu(),this.currentTerm=n},e.prototype.setInputTextToSelectedSuggestion=function(){var e=this.currentTerm;e&&e.chooseCurrentReplacement()},e.prototype.findTerm=function(e,t){for(var n=this.terms.length-1;n>=0;n--){var i=this.terms[n];if(i.hasBindings&&i.span.StartIndex<=e&&i.span.StartIndex+i.span.Length>=e)return i}},e})();t.TermManager=i})(n=t.qna||(t.qna={}))})(n=t.controllers||(t.controllers={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(t){var n;!(function(t){var n=20,i=250,r=(function(){function r(e,t){var n=this;this.terms=[],this.selection={},this.hasUncommittedText=!0,this.lastTextValue="",this.scope=e,this.services=t,e.onUserInputFocus=function(){return n.onUserInputFocus()},e.onUserInputBlur=function(){return n.onUserInputBlur()},e.onUserInputChange=function(){return n.onUserInputChange()},e.onUserInputKeyDown=function(e){return n.onUserInputKeyDown(e)},e.onUserInputKeyUp=function(e){return n.onUserInputKeyUp(e)},e.onUserInputClick=function(){return n.onUserInputClick()},e.onUserInputSelect=function(){return n.onUserInputSelect()},e.viewModel={hasFocus:!1,showAutoComplete:!0,userInput:"",placeholder:null,autoComplete:null,inputRendererTerms:[],inputRendererRemainder:null,inputRendererShowUnrecognized:!1,showInputTermSelection:!1,inputTermSelectionPosition:{}},e.infoNavControlContainer.setTextInputControl(this),this.registerStateMachineActions()}return r.createOptions=function(){return{additionalServices:["telemetryService"]}},r.prototype.getInputText=function(){return this.scope.sharedViewModel.userInput},r.prototype.setInputText=function(e,t){var n=this.scope;this.hasUncommittedText=!0,this.lastTextValue=n.sharedViewModel.userInput=e,this.renderInputText(),this.clearAutoCompletion(),t&&!_.isEmpty(e)&&this.services.timeout((function(){return n.setCursorPositionAtEnd()}),0,!1)},r.prototype.focus=function(){this.hasFocus()||this.scope.setFocusToInput()},r.prototype.blur=function(){this.hasFocus()&&this.scope.blurInput()},r.prototype.completeInput=function(){this.services.telemetryService.logEvent(e.telemetry.QnAQuestionBoxAutoComplete);var t=this.scope;this.setInputText(t.sharedViewModel.userInput+t.viewModel.autoComplete,!0)},r.prototype.clearAutoCompletion=function(){this.scope.viewModel.autoComplete=null,this.scrollLeftIfEmpty()},r.prototype.showAutoCompletion=function(){this.scope.viewModel.showAutoComplete=!0},r.prototype.hideAutoCompletion=function(){this.scope.viewModel.showAutoComplete=!1},r.prototype.clear=function(){var e=this.scope;this.lastTextValue=e.sharedViewModel.userInput="";var t=e.viewModel;t.inputRendererTerms=[],t.inputRendererRemainder=null,t.showInputTermSelection=!1,this.currentResult=null,this.terms=[],this.clearAutoCompletion()},r.prototype.updateTermSelection=function(){this.trackSelectionInternal(!0)},r.prototype.hasFocus=function(){return this.scope.viewModel.hasFocus},r.prototype.applyNLResult=function(e,t){this.currentResult!==e&&(this.currentResult=e,this.terms=e.getCompletedUtteranceAsTerms(),t&&(this.setCompletionText(),this.showAutoCompletion()),this.renderInputText(e),this.trackSelectionInternal(!1))},r.prototype.clearTermHighlights=function(){this.scope.viewModel.showInputTermSelection=!1},r.prototype.highlightSelectedTerm=function(){this.clearTermHighlights();var e=this.scope,t=e.viewModel;jsCommon.BrowserUtility.getInternetExplorerVersion()>0&&this.scope.sharedViewModel.userInput.indexOf("\t")>=0||(t.showInputTermSelection=!0,t.inputTermSelectionPosition=e.getSelectedTermPosition(this.selection.start,this.selection.end))},r.prototype.getSelection=function(){return this.selection},r.prototype.doStateMachineTransition=function(e){this.scope.sharedViewModel.stateMachine.enqueueTransition(e)},r.prototype.onUserInputFocus=function(){this.doStateMachineTransition(t.QuestionBoxControlTransitionId.BeginSession),this.scope.viewModel.hasFocus=!0},r.prototype.onUserInputBlur=function(){this.doStateMachineTransition(t.QuestionBoxControlTransitionId.EndSession),this.scope.viewModel.hasFocus=!1,this.scrollLeftIfEmpty()},r.prototype.onUserInputChange=function(){this.renderInputText(),this.setCompletionText();var e=this.scope.sharedViewModel.userInput,n=(this.lastTextValue||"").length,i=(e||"").length;if(this.lastTextValue=e,i>0){var r=Math.abs(n-i);r>1&&this.doStateMachineTransition(t.QuestionBoxControlTransitionId.ClearInterpretResult),this.doStateMachineTransition(t.QuestionBoxControlTransitionId.TextChanged)}else this.doStateMachineTransition(t.QuestionBoxControlTransitionId.ClearQueryWithoutBlur);this.hasUncommittedText=!1},r.prototype.onUserInputKeyDown=function(e){var n=e.keyCode;if(18!==n&&17!==n&&16!==n){var i=this.scope,r=i.sharedViewModel,o=i.getSelectionEnd();switch(o!==(r.userInput?r.userInput.length:0)&&this.clearAutoCompletion(),n){case 13:e.preventDefault(),this.hasUncommittedText?(this.doStateMachineTransition(t.QuestionBoxControlTransitionId.ConfirmQuery),this.hasUncommittedText=!1):this.doStateMachineTransition(t.QuestionBoxControlTransitionId.EndSession);break;case 27:this.doStateMachineTransition(t.QuestionBoxControlTransitionId.ClearQueryWithoutBlur);break;case 9:case 39:_.isEmpty(i.viewModel.autoComplete)?this.hasUncommittedText&&(this.doStateMachineTransition(t.QuestionBoxControlTransitionId.ConfirmQuery),this.hasUncommittedText=!1):(e.preventDefault(),this.doStateMachineTransition(t.QuestionBoxControlTransitionId.CompleteQuery));break;case 38:e.preventDefault(),this.doStateMachineTransition(t.QuestionBoxControlTransitionId.NavigateUp);break;case 40:e.preventDefault(),this.doStateMachineTransition(t.QuestionBoxControlTransitionId.NavigateDown)}}},r.prototype.onUserInputKeyUp=function(e){var t=e.keyCode;37!==t&&39!==t&&35!==t&&36!==t||this.trackSelection()},r.prototype.onUserInputClick=function(){this.trackSelection();var e=this.scope;_.isEmpty(e.sharedViewModel.userInput)&&e.selectInput()},r.prototype.onUserInputSelect=function(){this.trackSelection()},r.prototype.trackSelection=function(){var e=this;this.trackSelectionPromise&&(this.services.timeout.cancel(this.trackSelectionPromise),this.trackSelectionPromise=null),this.trackSelectionPromise=this.services.timeout((function(){return e.trackSelectionInternal(!0)}),n,!0)},r.prototype.trackSelectionInternal=function(e){var n=this,i=0,r=this.scope,o=r.getSelectionStart(),s=r.getSelectionEnd();if(null!==s&&null!==o){for(var a=o===s,u=[],c=0,l=this.terms.length;c<l;c++){var p=this.terms[c];p.trim().length>0&&(a&&i<=s&&o<=i+p.length?u.push(c):!a&&i<s&&o<i+p.length&&u.push(c)),i+=p.length}if(!_.isEmpty(u)){if(this.selection={start:u[0],end:u[u.length-1]},this.currentResult.suggestionItems){var d=_.filter(this.currentResult.suggestionItems,(function(e){return e.TermStartIndex<=n.selection.end&&n.selection.start<=e.TermEndIndex}));if(!_.isEmpty(d)){var h=_.filter(d,(function(e){return d[0].TermStartIndex===e.TermStartIndex&&d[0].TermEndIndex===e.TermEndIndex}));h.length===d.length&&(this.selection.start=d[0].TermStartIndex,this.selection.end=d[0].TermEndIndex)}}this.selection.text=this.terms.slice(this.selection.start,this.selection.end+1).join(""),this.selection.isUserRangeSelection=!a,this.selection.userRangeText=this.scope.sharedViewModel.userInput.substring(o,s),this.selection.isSingleTermSelection=this.selection.start===this.selection.end,e&&this.doStateMachineTransition(t.QuestionBoxControlTransitionId.TermSelected)}}},r.prototype.setCompletionText=function(){var e=this.currentResult,t=this.scope,n=t.viewModel;n.autoComplete=null;var i=t.sharedViewModel.userInput;if(e&&e.completedUtterance&&e.completedUtterance.Text.length>=i.length&&0===e.completedUtterance.Text.indexOf(i)){var r=e.completedUtterance.Text.substring(i.length);n.autoComplete=r}},r.prototype.renderInputText=function(e){var t=this.scope.viewModel;if(t.inputRendererTerms=[],t.inputRendererRemainder=null,t.inputRendererShowUnrecognized=!1,e&&e.completedUtterance){for(var n=e.getCompletedUtteranceAsTerms(),r=this.scope.sharedViewModel.userInput,o=0,s=n.length;o<s&&!_.isEmpty(r);o++){var a=n[o];0===r.indexOf(a)&&(t.inputRendererTerms.push({term:a,index:o,unrecognized:e.unrecognizedTerms&&e.unrecognizedTerms.indexOf(o)!==-1}),r=r.replace(a,""))}_.isEmpty(r)||(t.inputRendererRemainder=r),this.inputRendererShowUnrecognizedPromise&&(this.services.timeout.cancel(this.inputRendererShowUnrecognizedPromise),this.inputRendererShowUnrecognizedPromise=null),this.inputRendererShowUnrecognizedPromise=this.services.timeout((function(){return t.inputRendererShowUnrecognized=!0}),i,!0)}else t.inputRendererRemainder=this.scope.sharedViewModel.userInput},r.prototype.scrollLeftIfEmpty=function(){var e=this.scope;_.isEmpty(e.sharedViewModel.userInput)&&this.services.timeout((function(){return e.scrollInputBoxToLeft()}),0,!1)},r.prototype.registerStateMachineActions=function(){var e=this,n=this.scope.sharedViewModel.stateMachine;n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.textInput_Blur,(function(){return e.blur()})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.textInput_Clear,(function(){return e.clear()})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.textInput_ClearTermHighlights,(function(){return e.clearTermHighlights()})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.textInput_CompleteInput,(function(){return e.completeInput()})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.textInput_ShowAutoCompletion,(function(){return e.showAutoCompletion()})),n.addTransitionActionHandler(t.QuestionBoxControlTransitionAction.textInput_UpdateTermSelection,(function(){return e.updateTermSelection()}))},r})();t.TextInputController=r})(n=t.qna||(t.qna={}))})(n=t.controllers||(t.controllers={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i=(function(){function n(){this.restrict="E",this.templateUrl="views/infoNavCanvas.html",this.scope={canvasDefinition:"=",respectPaneUpdates:"="},this.replace=!0,this.controller=e.common.createController(t.controllers.InfoNavCanvasController)}return n})();n.InfoNavCanvas=i})(n=t.directives||(t.directives={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreDirective("InfoNavCanvas",[]);var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i=(function(){function n(){this.restrict="E",this.templateUrl="views/infoNavContainer.html",this.scope={hostService:"=",interpretUtterance:"=?",infoNavContainerOptions:"=?",models:"=",getAdditionalODataFilter:"=",interpretListener:"=",questionBoxOutput:"=",usageReportingEnabled:"="},this.replace=!0,this.controller=e.common.createController(t.controllers.InfoNavContainerController)}return n})();n.InfoNavContainer=i})(n=t.directives||(t.directives={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreDirective("InfoNavContainer",[]);var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i=(function(){function n(){this.restrict="E",this.templateUrl="views/infoNavQnaStart.html",this.scope={errorMessage:"@",interpretUtterance:"=",models:"="},this.replace=!0,this.controller=e.common.createController(t.controllers.InfoNavQnaStartController)}return n})();n.InfoNavQnaStart=i})(n=t.directives||(t.directives={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreDirective("InfoNavQnaStart",[]);var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i="data-suggestionIndex",r=".infonav-suggestionsHostInnerLayout",o=(function(){function n(){this.restrict="E",this.templateUrl="views/qna/suggestionList.html",this.scope={infoNavControlContainer:"=",sharedViewModel:"="},this.replace=!0,this.controller=e.common.createController(t.controllers.qna.SuggestionListController),this.link=function(e,t,n){e.scrollSelectionIntoView=function(){var n=t.find("["+i+'="'+e.viewModel.selectedSuggestionIndex+'"]');if(n.length>0){var o=n.offset(),s=n.outerHeight(),a=n.closest(r),u=a.height(),c=a.offset(),l=o.top>=c.top,p=o.top+s<=u+c.top;if(l&&p)return;var d=0;n.prevAll().each((function(e,t){d+=$(t).outerHeight()})),l?p||a.scrollTop(d-u+s):a.scrollTop(d)}},e.scrollToTop=function(){t.find(r).scrollTop(0)}}}return n})();n.QnaSuggestionList=o})(n=t.directives||(t.directives={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreDirective("QnaSuggestionList",[]);var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i=".infonav-textInputBox",r=".infonav-userInput",o="data-termindex",s=(function(){function n(){this.restrict="E",this.templateUrl="views/qna/textInput.html",this.scope={infoNavControlContainer:"=",sharedViewModel:"="},this.replace=!0,this.controller=e.common.createController(t.controllers.qna.TextInputController),this.link=function(e,t,n){var s=t.find(r),a=s.get(0),u=t.find(i);e.setFocusToInput=function(){return s.focus()},e.blurInput=function(){return s.blur()},e.selectInput=function(){return s.select()},e.scrollInputBoxToLeft=function(){return u.scrollLeft(0)},e.setCursorPositionAtEnd=function(){return a.selectionStart=a.selectionEnd=e.sharedViewModel.userInput.length},e.getSelectionStart=function(){try{return a.selectionStart}catch(e){return null}},e.getSelectionEnd=function(){try{return a.selectionEnd}catch(e){return null}},e.getSelectedTermPosition=function(e,n){for(var i={top:0,left:0,height:0,width:0},r=e;r<=n;r++){var s=t.find("["+o+'="'+r+'"]');i.width+=s.width(),s.length>0&&r===e&&(i.top=s.position().top,i.left=s.position().left,i.height=s.height())}return i}}}return n})();n.QnaTextInput=s})(n=t.directives||(t.directives={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreDirective("QnaTextInput",[]);var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i=(function(){function n(){this.restrict="E",this.templateUrl="views/qna/questionBox.html",this.scope={infoNavControlContainer:"=",sharedViewModel:"="},this.replace=!0,this.controller=e.common.createController(t.controllers.qna.QuestionBoxController)}return n})();n.QuestionBox=i})(n=t.directives||(t.directives={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreDirective("QuestionBox",[]);var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i=(function(){function n(){this.restrict="E",this.templateUrl="views/qna/questionBoxContainer.html",this.scope={getAdditionalODataFilter:"=",interpretListener:"=",models:"=",output:"=",usageReportingEnabled:"="},this.replace=!0,this.controller=e.common.createController(t.controllers.qna.QuestionBoxContainerController)}return n})();n.QuestionBoxContainer=i})(n=t.directives||(t.directives={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreDirective("QuestionBoxContainer",[]);var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(t,n,i,r){void 0===i&&(i=0),this._utterance=t,this._results=n.map((function(n){return new e.InterpretResult(n,t)})),this._resultIndex=i,this._featureSwitches=r}return Object.defineProperty(t.prototype,"utterance",{get:function(){return this._utterance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"result",{get:function(){return _.isEmpty(this._results)?null:this._resultIndex<0||this._resultIndex>=this._results.length?null:this._results[this._resultIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"results",{get:function(){return this._results},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultIndex",{get:function(){return this._resultIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureSwitches",{get:function(){return this._featureSwitches},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(e){return this._results.length<1||this._results[this._resultIndex].isEmpty(e)},t.prototype.isUtteranceLinguisticallyEquivalent=function(e){return e&&(e._utterance||"").trim()===(this._utterance||"").trim()},t})();e.InterpretResponse=t})(t=e.models||(e.models={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this._parts=e}return Object.defineProperty(e.prototype,"parts",{get:function(){return this._parts},set:function(e){this._parts=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){var e="";return this._parts.forEach((function(t,n,i){e+=t.text})),e},enumerable:!0,configurable:!0}),e})();e.UISuggestionItem=t;var n=(function(){function e(e,t){this._source=e,this._utterance=t}return Object.defineProperty(e.prototype,"language",{get:function(){return this._source.Language},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alternateCompletions",{get:function(){return this._source.AlternateCompletions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suggestionItems",{get:function(){return this._source.SuggestionItems},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"suggestedPhrasingTemplates",{get:function(){return this._source.SuggestedPhrasingTemplates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"completedUtterance",{get:function(){return this._source.CompletedUtterance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"warnings",{get:function(){return this._source.Warnings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._source.Error},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"databaseName",{get:function(){return this._source.DatabaseName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"virtualServerName",{get:function(){return this._source.VirtualServerName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restatement",{get:function(){return this._source.Restatement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spans",{get:function(){return this._source.Spans},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"utterance",{get:function(){return this._utterance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unrecognizedTerms",{get:function(){return this._source.UnrecognizedTerms?this._source.UnrecognizedTerms.map((function(e){return e.TermIndex})):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(e){
return!(this._source.Command||e&&(this.restatement||this.completedUtterance||this.alternateCompletions&&this.alternateCompletions.length||this.suggestionItems&&this.suggestionItems.length))},e.prototype.hasCompletionSuggestions=function(){return!!this._source&&!!this.alternateCompletions&&this.alternateCompletions.length>0},e.prototype.hasTermSuggestions=function(){return!!this._source&&!!this.suggestionItems&&this.suggestionItems.length>0},e.prototype.getCompletedUtteranceAsTerms=function(){var t=new Array,n=this.completedUtterance;if(n)for(var i=n.Terms,r=0,o=i.length;r<o;r++)t.push(e.getTermText(n,r));return t},e.getTermText=function(e,t){var n=e.Text,i=e.Terms,r=i[t].StartCharIndex,o=t===i.length-1,s=o?n.length:i[t+1].StartCharIndex;return n.substring(r,s)},e.prototype.getTermSuggestionsForSelection=function(e){for(var t=[],n=0,i=this.suggestionItems;n<i.length;n++){var r=i[n];r.TermStartIndex<=e.end&&e.start<=r.TermEndIndex&&t.push(r)}return t},e.prototype.hasSuggestionsForTermSelection=function(e){if(this._source&&this.suggestionItems)for(var t=this.suggestionItems,n=0,i=t;n<i.length;n++){var r=i[n];if(r.TermStartIndex<=e.end&&e.start<=r.TermEndIndex)return!0}return!1},e.prototype.getCompletionSuggestions=function(){var e=new Array;if(this._source&&this.completedUtterance&&this.hasCompletionSuggestions())for(var n=this.getCompletedUtteranceAsTerms(),i=0,r=this.alternateCompletions;i<r.length;i++){var o=r[i],s=new t;s.parts=new Array;for(var a=0,u=o.Items;a<u.length;a++){var c=u[a];if(c.TermIndices)for(var l=0;l<c.TermIndices.length;l++){var p={};if(p.text=c.Text?c.Text:n[c.TermIndices[l]],p.emphasize=!!c.Text,s.parts.push(p),c.Text&&0===l)break}else{var d={};d.text=c.Text,d.emphasize=!0,s.parts.push(d)}}e.push(s)}return e},e.prototype.getTermSuggestions=function(e){var n=new Array;if(e&&this.completedUtterance&&this.hasTermSuggestions())for(var i=this.getCompletedUtteranceAsTerms(),r=this.getTermSuggestionsForSelection(e),o=0,s=r;o<s.length;o++){var a=s[o];if(a.TermStartIndex<=e.end&&e.start<=a.TermEndIndex){var u=new t;u.parts=i.map((function(e){var t={};return t.text=e,t.emphasize=!1,t}));var c=a.TermEndIndex-a.TermStartIndex+1;u.parts.splice(a.TermStartIndex,c,{text:a.SuggestedReplacement,emphasize:!0}),n.push(u)}}return n},e})();e.InterpretResult=n})(t=e.models||(e.models={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(t){function n(){return new i}t.createUsageService=n;var i=(function(){function t(){this.firstUsage=!0}return t.prototype.update=function(t){var n={UtteranceData:t};this.firstUsage&&(n.FirstUsage=!0,this.firstUsage=!1);var i=e.common.httpService.powerbiRequestOptions(null,"UsageUpdate");e.common.httpService.post("infonav/usage/update/",{request:n},i)},t})()})(n=t.services||(t.services={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new n(e)}e.createBindingElementFactory=t;var n=(function(){function e(e){this.localizationService=e}return e.prototype.buildBindingElement=function(e,t,n){var i=document.createElement("div");if(i.textContent=t,e.appendChild(i),n){var r=document.createElement("div");r.className="replacementDetail",r.textContent="("+n+")",e.appendChild(r)}},e.prototype.buildPropertyBaseElement=function(e,t){t.ConceptualProperty?this.buildBindingElement(e,t.Text,this.localizationService.format("Qna_BindingType_Property",[t.ConceptualEntity,t.ConceptualProperty])):t.ConceptualHierarchy&&(t.ConceptualHierarchyLevel?this.buildBindingElement(e,t.Text,this.localizationService.format("Qna_BindingType_Hierarchy",[t.ConceptualEntity,t.ConceptualHierarchy,t.ConceptualHierarchyLevel])):this.buildBindingElement(e,t.Text,this.localizationService.format("Qna_BindingType_Property",[t.ConceptualEntity,t.ConceptualHierarchy])))},e.prototype.buildTable=function(e,t){this.buildBindingElement(e,t.Text,t.ConceptualEntity)},e.prototype.buildPod=function(e,t){this.buildBindingElement(e,t.Text,this.localizationService.get("Qna_BindingType_ReportPage"))},e.prototype.buildProperty=function(e,t){return this.buildPropertyBaseElement(e,t)},e.prototype.buildValue=function(e,t){return this.buildPropertyBaseElement(e,t)},e.prototype.buildRange=function(e,t){return this.buildPropertyBaseElement(e,t)},e.prototype.buildVisType=function(e,t){this.buildBindingElement(e,t.Text,this.localizationService.get("Qna_BindingType_VisualizationType"))},e.prototype.buildComposite=function(e,t){this.buildBindingElement(e,t.Text,this.localizationService.get("Qna_BindingType_Composite"))},e.prototype.buildCoreTerm=function(e,t){this.buildBindingElement(e,t.Text)},e.prototype.buildAnyEntityTerm=function(e,t){this.buildBindingElement(e,t.Text)},e.prototype.build=function(e){var t,n=document.createElement("li");e.Composite?(t=e.Composite,this.buildComposite(n,e.Composite)):e.Pod?(t=e.Pod,this.buildPod(n,e.Pod)):e.Property?(t=e.Property,this.buildProperty(n,e.Property)):e.Range?(t=e.Range,this.buildRange(n,e.Range)):e.Table?(t=e.Table,this.buildTable(n,e.Table)):e.Value?(t=e.Value,this.buildValue(n,e.Value)):e.VisType?(t=e.VisType,this.buildVisType(n,e.VisType)):e.Core?(t=e.Core,this.buildCoreTerm(n,e.Core)):e.AnyEntity&&(t=e.AnyEntity,this.buildAnyEntityTerm(n,e.AnyEntity));var i=t.Text;return{element:n,text:i,binding:t,container:e}},e})();e.BindingElementFactory=n})(t=e.services||(e.services={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){var i;!(function(i){function r(e,t,n,i,r,o,s,u,c,l){return new a(e,t,n,i,r,o,s,u,c,l)}var o=e.explore.FilterUtils,s=e.infonav.utils.visualUtil;i.createInfoNavCanvasDefinitionFactory=r;var a=(function(){function r(e,t,n,i,r,o,s,a,u,c){this.moduleLoader=e,this.conceptualSchemaProxy=t,this.explorationProxy=n,this.explorationSerializer=i,this.featureSwitchService=r,this.geoTaggingAnalyzerService=o,this.aggrOps=s,this.lazyScoped=a,this.promiseFactory=u,this.eventBridge=c}return r.prototype.createGivenUtteranceData=function(a,u,c,l,p,d){var h,g=this;a&&a.queryDefn&&(h=_.filter(a.queryDefn.From,(function(t){return t.Type===e.data.EntitySourceType.Pod})));var f=_.find(u,(function(e){return e.vsName===a.virtualServerName&&e.dbName===a.databaseName})),v=r.createDataSourceArray(f);if(_.isEmpty(h)){var m=s.interpretResultToConfig(a,u),S=t.services.createVisualAuthoringCore(p,this.geoTaggingAnalyzerService,this.aggrOps,this.featureSwitchService),y=n.viewModels.ViewModelFactory.createVisualDataFromInterpretResult(m,this.conceptualSchemaProxy,v,S,this.lazyScoped).then((function(e){return g.promiseFactory.resolve(_.first(e))}));return new i.SingleVisualizationCanvasDefinition(this.moduleLoader,y,c,l,f,v,this.promiseFactory,this.featureSwitchService.featureSwitches.baseTheme)}var T=h[0],I=r.unwrapReportIdFromSchema(T.Schema),x=T.Entity,C=o.extractParameterFilters(a.queryDefn,a.queryMetadata);return new i.PodExploreCanvasDefinition(I,x,C,f,v,this.explorationProxy,this.explorationSerializer,this.promiseFactory,this.eventBridge,p,d)},r.prototype.createGivenTileData=function(e,t,o){var s=_.find(t,(function(t){return t.id===e.modelId})),a=r.createDataSourceArray(s);if(e.reportPageTile){var u=e.reportPageTile.reportId,c=e.reportPageTile.pod,l=[],p=e.reportPageTile.filters&&this.explorationSerializer.deserializeFilterCollection(e.reportPageTile.filters,l,!1);if(!_.isEmpty(l))return;return new i.PodExploreCanvasDefinition(u,c,p,s,a,this.explorationProxy,this.explorationSerializer,this.promiseFactory,this.eventBridge,null,null)}if(e.visualContainer){var d=n.viewModels.ViewModelFactory.createVisualDataFromVisualContainer(e.visualContainer,s);return new i.SingleVisualizationCanvasDefinition(this.moduleLoader,this.promiseFactory.resolve(d),null,i.SingleVisualizationType.PrimaryVisual,s,a,this.promiseFactory,this.featureSwitchService.featureSwitches.baseTheme)}},r.createDataSourceArray=function(t){return e.explore.contracts.createDataSourceArray([{type:"dsr",id:t.id,packageId:t.packageId,name:void 0,dsr:{schemaName:void 0,vsName:t.vsName,dbName:t.dbName,modelId:t.id}}])},r.unwrapReportIdFromSchema=function(e){var t="Report_";return e&&_.startsWith(e,t)&&(e=e.substring(t.length)),parseInt(e,10)},r})()})(i=n.services||(n.services={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){var i;!(function(n){var i=e.explore.constants.ExploreCanvasConstants,r=e.explore.viewModels,o=e.explore.FilterUtils,s=(function(){function e(e,t,n,i,r,o,s,a,u,c,l){this.reportId=e,this.podName=t,this.parameterFilters=n,this.model=i,this.dataSources=r,this.explorationProxy=o,this.explorationSerializer=s,this.promiseFactory=a,this.eventBridge=u,this.visualPlugin=c,this.resourcePackagesService=l,this.pinEnabled=!0,this.resetSelection=!0,this.showPageFilters=!0,this.initializeDeferred=a.defer()}return Object.defineProperty(e.prototype,"initializePromise",{get:function(){return this.initializeDeferred.promise},enumerable:!0,configurable:!0}),e.prototype.getExploration=function(){return this.exploration.contract},e.prototype.initialize=function(e){var t=this;return e&&e.infoNavPodExplorationCreator?this.infoNavPodExplorationCreator=e.infoNavPodExplorationCreator:this.infoNavPodExplorationCreator=new a(this.explorationProxy,this.explorationSerializer,this.promiseFactory,this.eventBridge),this.infoNavPodExplorationCreator.createExploration(this.reportId,this.podName,this.parameterFilters,this.model).then((function(e){t.ensureCustomViz(e).then((function(){t.exploration=e.exploration,t.exploreCanvas=e.exploration.exploreCanvas,t.section=e.section,t.pod=e.pod,t.originalFilters=e.originalFilters,t.section.size.displayOption=4,t.maxWidth=e.section.size.width+2*i.AutoLayoutVisualPadding+2*i.ExploreCanvasPadding,t.maxHeight=e.section.size.height+2*i.AutoLayoutVisualPadding+2*i.ExploreCanvasPadding+i.AutoLayoutVisualVCHeader+i.ScrollbarOffset,t.initializeDeferred.resolve(null)}))})),this.initializePromise},e.prototype.onVisualConversion=function(e){},e.prototype.extractParameterFilters=function(){var e=[],t=this.explorationSerializer.deserializeFilterCollection(this.originalFilters,e,!1);if(_.isEmpty(e))return o.extractParameterFiltersFromSection(this.section.filters,t)},e.prototype.ensureCustomViz=function(e){var t=e.section,n=_.filter(e.exploration.contract.resourcePackages,(function(e){return _.any(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e.name}))}));return n.length>0&&(this.resourcePackagesService&&this.resourcePackagesService.registerPackages(n),this.visualPlugin)?this.visualPlugin.ensurePlugins(n):this.promiseFactory.resolve()},e})();n.PodExploreCanvasDefinition=s,n.ExplorationExpirationMilliseconds=6e4;var a=(function(){function i(e,t,n,i){this.explorationProxy=e,this.explorationSerializer=t,this.promiseFactory=n,this.eventBridge=i,this.lastExplorationData=null,this.lastExplorationTime=0,this.lastReportId=null,this.lastPodName=null,this.lastParameterFilters=null}return i.prototype.createExploration=function(t,i,s,a){var u=this,c=null,l=JSON.stringify(s);if(this.lastExplorationData&&this.lastExplorationTime+n.ExplorationExpirationMilliseconds>Date.now()&&this.lastReportId===t&&this.lastPodName===i){var p=this.lastExplorationData;if(this.lastParameterFilters===l)c=this.promiseFactory.resolve(p);else{this.lastExplorationTime=Date.now(),this.lastParameterFilters=l;var d=[],h=this.explorationSerializer.deserializeFilterCollection(p.originalFilters,d,!1);p.section.filters=h||[],o.applySectionParameterFilters(p.section,p.pod,s,!0),this.eventBridge.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(){return!0},allowCache:!0}),c=this.promiseFactory.resolve(p)}}else c=this.explorationProxy.get({id:t}).then((function(e){var n=u.findPodSectionIndices(e,i);if(n){var a=e.sections[n.sectionIndex],c=e.pods[n.podIndex];o.mergeExplorationSectionFilters(e,a);var p=u.explorationSerializer.serializeFilterCollection(a.filters);o.applySectionParameterFilters(a,c,s);var d={exploration:r.ViewModelFactory.convertExploration(e,0,n.sectionIndex),section:a,pod:c,originalFilters:p};return u.lastExplorationData=d,u.lastExplorationTime=Date.now(),u.lastReportId=t,u.lastPodName=i,u.lastParameterFilters=l,d}}));return c},i.prototype.findPodSectionIndices=function(e,n){var i=t.PodUtils.findPodIndexForPodName(e,n);if(i>=0){var r=e.pods[i].boundSection,o=t.SectionUtils.findSectionIndexForSectionName(e,r);if(o>=0)return{podIndex:i,sectionIndex:o}}},i})();n.InfoNavPodExplorationCreator=a})(i=n.services||(n.services={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){var i;!(function(n){var i,r=e.infonav.constants,o=t.constants.DefaultBaseThemeName,s=e.explore.constants.ExploreCanvasConstants,a=e.explore.contracts,u=e.data.SemanticFilter,c=jsCommon.Utility,l=e.explore.util.VisualContainerUtils,p=t.viewModels.ViewModelFactory,d=e.infonav.utils.visualUtil;!(function(e){e[e.PrimaryVisual=0]="PrimaryVisual",e[e.Cortana=1]="Cortana"})(i=n.SingleVisualizationType||(n.SingleVisualizationType={}));var h=(function(){function n(e,t,n,i,r,o,s,a){this.moduleLoader=e,this.visualDataPromise=t,this.additionalODataFilter=n,this.singleVisualizationType=i,this.model=r,this.dataSources=o,this.promiseFactory=s,this.useBaseTheme=a,this.pinEnabled=!0,this.resetSelection=!1,this.showPageFilters=!1,this.maxSizeProvider=new g,this.initializeDeferred=this.promiseFactory.defer()}return Object.defineProperty(n.prototype,"initializePromise",{get:function(){return this.initializeDeferred.promise},enumerable:!0,configurable:!0}),n.prototype.getExploration=function(){return this.singleVisualExploration.exploration},n.prototype.initialize=function(e,t,n,i){var r=this;return e&&e.singleVisualExploration?this.singleVisualExploration=e.singleVisualExploration:this.singleVisualExploration=new f(t,this.singleVisualizationType,this.maxSizeProvider,this.useBaseTheme),this.visualDataPromise.then((function(e){return r.handleVisualData(e,r.additionalODataFilter,n,i)})),this.initializePromise},n.prototype.onVisualConversion=function(e){var t=d.getType(e),n=this.maxSizeProvider.calculateCanvasSize(t);this.maxWidth=n.width,this.maxHeight=n.height},n.prototype.handleVisualData=function(n,i,r,o){return __awaiter(this,void 0,e.Promise,(function(){var s,a,u,c;return __generator(this,(function(l){switch(l.label){case 0:return i?[4,this.loadODataFilterDependencies()]:[3,2];case 1:l.sent(),e.explore.odata&&(a=e.explore.odata.createODataFilterParser().tryGetFilters(i),_.isEmpty(a)||(s={filters:a})),l.label=2;case 2:return this.singleVisualExploration.updateForVisual(n,s),r&&t.services.selectionUtils.selectVisualContainer(this.singleVisualExploration.visualContainerContract,o),this.exploreCanvas=this.singleVisualExploration.exploreCanvas,this.section=this.singleVisualExploration.section,u=d.getType(this.singleVisualExploration.visualContainerContract.config.singleVisual.visualType),c=this.maxSizeProvider.calculateCanvasSize(u),this.maxWidth=c.width,this.maxHeight=c.height,this.model=n.model,this.initializeDeferred.resolve(null),[2]}}))}))},n.prototype.loadODataFilterDependencies=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.promiseFactory.all([this.moduleLoader.require({javascript:"odataFilterParser"}),this.moduleLoader.require({javascript:"odataExplore"})])];case 1:return e.sent(),[2]}}))}))},n})();n.SingleVisualizationCanvasDefinition=h;var g=(function(){function e(){}return e.prototype.calculateCanvasSize=function(e){var t=.75,n=650;switch(e){case 3:return{width:n,height:175};case 5:case 20:case 30:case 17:case 16:return{width:n,height:t*n};default:return{width:r.DefaultVisualMaxWidth,height:r.DefaultVisualMaxHeight}}},e.prototype.calculateSectionSize=function(e){var t=960,n=720,r=20,o=-250;switch(e){case i.Cortana:return{width:s.DefaultCortanaWidth+r,height:s.DefaultCortanaHeight+o};case i.PrimaryVisual:return{width:t,height:n};default:return{width:t,height:n}}},e})(),f=(function(){function e(e,t,n,i){this.eventBridge=e,this.singleVisualizationType=t,this.maxSizeProvider=n,this.useBaseTheme=i,this.initialize()}return Object.defineProperty(e.prototype,"section",{get:function(){return this.sectionInternal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exploreCanvas",{get:function(){return this.exploreCanvasInternal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualContainerContract",{get:function(){return this.visualContainer.contract},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exploration",{get:function(){return this.explorationContract},enumerable:!0,configurable:!0}),e.prototype.updateForVisual=function(e,n){n&&!_.isEmpty(n.filters)?this.sectionInternal.filters=n.filters:this.sectionInternal.filters=[],this.visualContainer.contract.filters=e.visualContainer.filters,this.visualContainer.contract.config=e.visualContainer.config,this.visualContainer.dataViewSource=e.dataViewSource,this.visualContainer.updateViewState(),this.eventBridge.publishToChannel(t.services.events.visualContainerChanged,{affectContainer:l.contractEqualityComparator(this.visualContainer.contract)})},e.prototype.initialize=function(){var e,t=this;e=this.singleVisualizationType===i.Cortana?3:0;var n=this.maxSizeProvider.calculateSectionSize(this.singleVisualizationType);this.initialVisualContainerPosition={x:0,y:0,width:n.width,height:n.height};var r={id:0,name:c.generateGuid(),config:{},layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:this.initialVisualContainerPosition}])},s=p.convertVisualContainerStandalone(r);s.allowDeferredRendering=!0,s.hostServices={deleteVisualRelationships:_.noop,getFilters:function(){var e=[],n=s.contract.filters||[];n=n.concat(t.sectionInternal.filters||[]);for(var i=0,r=n;i<r.length;i++){var o=r[i],a=o.filter;a&&e.push(a)}return{dataFilter:u.merge(e),highlightFilter:null}},getVisualRelationshipFilterAction:function(){return 0},selectDataPoint:_.noop,setVisualRelationshipFilterAction:_.noop,clearHighlight:_.noop},this.sectionInternal={name:"InfoNavSection",displayName:"InfoNavSection",size:{displayOption:e,width:n.width,height:n.height},visualContainers:[s.contract],filters:[]},this.explorationContract={width:this.sectionInternal.size.width,height:this.sectionInternal.size.height,dataSources:a.createDataSourceArray(),sections:[this.sectionInternal]},this.useBaseTheme&&(this.explorationContract.baseTheme=o),this.exploreCanvasInternal=p.convertSectionToExploreCanvas(this.explorationContract,this.sectionInternal,0),this.visualContainer=this.exploreCanvasInternal.visualContainers[0]},e})()})(i=n.services||(n.services={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){function i(e,t,n,i,r,o,s,a){return new c(e,t,n,i,o,s,a||u)}var r=e.infonav.contracts,o=jsCommon.EnumExtensions,s=e.infonav.utils.InterpretUtil,a=2,u=6e4;n.createInterpretService=i;var c=(function(){function n(e,t,n,i,r,o,s){this.interpretProbeService=e,this.interpretHttpService=t,this.promiseFactory=n,this.contentProviderHttpService=r,this.featureSwitchService=o,this.interpretCache=new l(s,i)}return n.prototype.probe=function(t,n){return this.interpretProbeService.probe(t,n).then((function(t){return new e.explore.infonav.models.InterpretResponse(null,t)}))},Object.defineProperty(n.prototype,"contentProviders",{get:function(){return this.contentProviderHttpService.getBuiltInContentProviders()},enumerable:!0,configurable:!0}),n.prototype.interpret=function(e,t,i,r,o,s,a,u){var c=this,l=_.first(i);o.isError=null,o.isResponseEmpty=null,o.fromCache=null,o.wasCancelled=null,o.probeCompletedTimestamp=null,o.contentProviderType=this.getModelContentProviderType(l),o.ownerType=n.getModelOwnerType(l);var p=this.interpretInternal(e,t,i,r,o,s,a,u);return p.then((function(e){if(o.isError=!1,o.isResponseEmpty=!e||e.isEmpty(!1),e){var t=n.getFirstModelFromInterpretResponse(e,i);t&&(o.contentProviderType=c.getModelContentProviderType(t),o.ownerType=n.getModelOwnerType(t))}}),(function(){o.isError=!0,o.isResponseEmpty=!0})),p},n.prototype.interpretInternal=function(e,i,r,o,a,u,c,l){var p=this,d=s.createInterpretRequestScope(r,this.featureSwitchService.featureSwitches);if(_.isEmpty(d.DbMonikers))return this.promiseFactory.reject();var h=n.constructInterpretRequest(e,i,d,o,null,l);a.fromCache=!1;var g=this.interpretCache.getInterpretResponse(h);if(g)return a.fromCache=!0,this.promiseFactory.resolve(g);var f=this.promiseFactory.defer();a.wasCancelled=!1,u&&u.then((function(){return a.wasCancelled=!0})),a.probeCompletedTimestamp=null;var v=function(){a.probeCompletedTimestamp=Date.now(),p.interpretHttpService.interpret(h,null,u).then((function(n){var i=n.data,r=_.isArray(i)?{results:i}:i;a.interpretRequestId=n.requestId;var o=new t.models.InterpretResponse(e,r.results,0,r.featureSwitches);p.interpretCache.setInterpretResponse(h,o),f.resolve(o)}),(function(e){a.interpretRequestId=e.requestId,f.reject()}))};if(c)v();else{var m=this.interpretProbeService;if(m.isProbeCompleted(d))v();else{var S={runToCompletion:function(){return v(),f.promise},reject:function(){f.reject()}};this.interpretProbeService.probe(r,null,S)}}return f.promise},n.getFirstModelFromInterpretResponse=function(e,t){if(e){var n=e.result;if(n)return _.find(t,(function(e){return e.vsName===n.virtualServerName&&e.dbName===n.databaseName}))}return null},n.prototype.getModelContentProviderType=function(t){return t&&null!=t.contentProviderId?e.common.findContentProviderName(this.contentProviders,t.contentProviderId):"Unknown"},n.getModelOwnerType=function(t){return t&&null!=t.permissions?jsCommon.EnumExtensions.hasFlag(t.permissions,e.common.contracts.Permissions.All)?e.telemetry.OwnerType.Owner:e.telemetry.OwnerType.Shared:e.telemetry.OwnerType.Unknown},n.constructInterpretRequest=function(e,t,n,i,s,u){var c={Version:a,Utterance:e,Scope:n,AdditionalODataFilter:i,Spans:u};if(t&&(c.Options=t,s&&o.hasFlag(c.Options,r.InterpretRequestOptions.Data))){var l=s.result;if(l&&!l.isEmpty(!1)&&!o.hasFlag(l.source.Warnings,r.InterpretWarnings.DataRetrievalFailed)){var p=l.source.Command,d=p.VisualConfigurations;c.LastQuery={Query:p.Query,Binding:_.isEmpty(d)?null:d[0].DataShapeBinding}}}return c},n})(),l=(function(){function e(e,t){this.cache={},this.expirationInMilliseconds=e,this.timeoutService=t}return e.prototype.getInterpretResponse=function(t){if(!e.shouldRequestUseCache(t))return null;var n=e.getCacheKey(t),i=this.cache[n];if(i){if(!(i.expiration<Date.now()))return i.response;delete this.cache[n]}return null},e.prototype.setInterpretResponse=function(t,n){if(e.shouldRequestUseCache(t)&&e.shouldResponseUseCache(t,n)){var i=e.getCacheKey(t);this.cache[i]={response:n,expiration:Date.now()+this.expirationInMilliseconds},this.removeExpiredEntriesAfterTimeout()}},e.prototype.removeExpiredEntriesAfterTimeout=function(){var e=this;this.removeExpiredEntriesPromise||(this.removeExpiredEntriesPromise=this.timeoutService((function(){e.removeExpiredEntriesPromise=null;var t=Date.now(),n=!1;for(var i in e.cache){var r=e.cache[i];r.expiration<t?delete e.cache[i]:n=!0}n&&e.removeExpiredEntriesAfterTimeout()}),this.expirationInMilliseconds))},e.shouldRequestUseCache=function(e){return!(!_.isEmpty(e.AdditionalODataFilter)||!_.isEmpty(e.Spans))},e.shouldResponseUseCache=function(e,t){return(!o.hasFlag(e.Options,r.InterpretRequestOptions.Data)||!_.any(t.results,(function(e){return o.hasFlag(e.warnings,r.InterpretWarnings.DataRetrievalFailed)||o.hasFlag(e.warnings,r.InterpretWarnings.DataRetrievalSkipped)})))&&!_.any(t.results,(function(e){return o.hasFlag(e.warnings,r.InterpretWarnings.LinguisticSchemaIsStillLoading)}))},e.getCacheKey=function(e){return[e.Utterance||"",e.Options?e.Options.toString(10):"-",e.DesiredInterpretationsCount?e.DesiredInterpretationsCount.toString(10):"-",e.Scope?JSON.stringify(e.Scope.DbMonikers):"-",e.Version?e.Version.toString(10):"-"].join("::")},e})()})(n=t.services||(t.services={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){function i(e,t,n,i,r,o){return new u(e,t,n,i,r,o)}var r=e.infonav.contracts;n.createQnaInputInterpreterService=i;var o=3e3,s=4,a=1,u=(function(){function n(e,t,n,i,r,s){this.interpretService=e,this.interpretUsageListener=t,this.promiseFactory=n,this.contentProviderHttpService=i,this.outstandingInterpretRequests=[],this.answeredQuestionEventLogger=r.createAnsweredQuestionEventLogger(o),this.diagnosticsEnabled=s.diagnostics}return n.prototype.sendInterpret=function(e,n,i,o){var s=this;void 0===o&&(o=!1);var u=null,c=n.additionalODataFilterGetter();c&&(u=c());var l=this.answeredQuestionEventLogger.startAnsweredQuestionEvent(),p={},d=this.promiseFactory.defer();this.outstandingInterpretRequests.push(d),this.enforceMaxConcurrentRequests();var h;if(!e||e.trim().length<a){var g=this.promiseFactory.defer();this.interpretService.probe(n.models()).then((function(){return g.reject()}),(function(){return g.reject()})),h=g.promise}else{var f=r.InterpretRequestOptions.QueryMetadata|r.InterpretRequestOptions.VisualConfiguration|r.InterpretRequestOptions.SupportPodQueries|r.InterpretRequestOptions.TermBindings;this.diagnosticsEnabled&&(f|=r.InterpretRequestOptions.Diagnostics),h=this.interpretService.interpret(e,f,n.models(),u,p,d.promise,null,i),h.finally((function(){return l.resolve(p)}))}h.then((function(i){if(!s.shouldIgnoreResponse(i,n,d,e)){s.handleNewInterpretResponse(i,n,d);var r=n.interpretListener();if(r)if(!i||i.isEmpty(!0)||i.result.isEmpty(!0))r.onInterpretError(i?i.utterance:null,s.hasOutstandingRequests());else{var a=t.util.InterpretResultUtility.parseInterpret(i.result);a?r.onInterpretSuccess(i,a,u,o):r.onInterpretError(i?i.utterance:null,s.hasOutstandingRequests())}n.usageReportingEnabled()&&s.interpretUsageListener.onInterpretSuccess(i,s.getModelContentProviderType(i,n))}}),(function(){if(!s.shouldIgnoreResponse(null,n,d,e)){s.updateStateGivenResponse(null,n,d);var t=n.interpretListener();t&&t.onInterpretError(e,s.hasOutstandingRequests())}})),n.usageReportingEnabled()&&this.interpretUsageListener.onInterpretIssued()},Object.defineProperty(n.prototype,"contentProviders",{get:function(){return this.contentProviderHttpService.getBuiltInContentProviders()},enumerable:!0,configurable:!0}),n.prototype.enforceMaxConcurrentRequests=function(){if(this.outstandingInterpretRequests.length>s)for(var e=this.outstandingInterpretRequests.splice(0,this.outstandingInterpretRequests.length-s),t=0,n=e;t<n.length;t++){var i=n[t];i.resolve({})}},n.prototype.handleNewInterpretResponse=function(t,n,i){this.updateStateGivenResponse(t,n,i),n.stateMachine.enqueueTransition(e.explore.infonav.controllers.qna.QnaInputTransitionId.ResultReady)},n.prototype.shouldIgnoreResponse=function(e,t,n,i){if(!_.contains(this.outstandingInterpretRequests,n))return!0;if(!e&&""===i)return!0;var r=t.userInput(),o=i;e&&e.result&&e.result.completedUtterance&&!_.isEmpty(e.result.completedUtterance.Text)&&(o=e.result.completedUtterance.Text);var s=Math.min(r.length,o.length);return r.substr(0,s)!==o.substr(0,s)},n.prototype.updateStateGivenResponse=function(e,t,n){this.updateOutstandingRequestsGivenCompletedRequest(n),t.interpretResponse=this.interpretResponse=e,t.showLoadingSpinner=this.hasOutstandingRequests(),t.showQnaFeedback(t.usageReportingEnabled)},n.prototype.hasOutstandingRequests=function(){return!_.isEmpty(this.outstandingInterpretRequests)},n.prototype.updateOutstandingRequestsGivenCompletedRequest=function(e){var t;t=e?_.findIndex(this.outstandingInterpretRequests,(function(t){return t===e})):this.outstandingInterpretRequests.length;for(var n=0;n<t;n++)this.outstandingInterpretRequests[n].resolve({});this.outstandingInterpretRequests.splice(0,t+1)},n.prototype.getModelContentProviderType=function(t,n){if(t){var i=t.result;if(i){var r=_.find(n.models(),(function(e){return e.vsName===i.virtualServerName&&e.dbName===i.databaseName}));if(r&&null!=r.contentProviderId)return e.common.findContentProviderName(this.contentProviders,r.contentProviderId)}}return"Unknown"},n})()})(n=t.services||(t.services={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(t){function n(e,t,n){return new o(e,t,n)}var i,r=e.common.helpers.ModelConverterHelper;!(function(e){e[e.Generated=0]="Generated",e[e.Tile=1]="Tile",e[e.FeaturedQuestion=2]="FeaturedQuestion"})(i=t.SampleQuestionSource||(t.SampleQuestionSource={})),t.createSampleQuestionsService=n;var o=(function(){function e(e,t,n){this.interpretService=e,this.featureSwitchService=t,this.promiseFactory=n,this.tileUtterancesByModel={}}return e.prototype.getSampleQuestions=function(t){if(_.isEmpty(t))return[];for(var n=[],i=this.featureSwitchService.featureSwitches,o=_(t).filter((function(e){return r.getIsQnaSupported(e,i)})).sortBy((function(e){return e.id})).value(),s=e.createFeaturedQuestions(o),a=0,u=o;a<u.length;a++){var c=u[a],l=c.id;l in this.tileUtterancesByModel&&s.push.apply(s,this.tileUtterancesByModel[l])}return s=_.uniq(s,(function(e){return e.question.trim().toUpperCase()})),n.push(this.promiseFactory.resolve(s)),n.push(this.interpretService.probe(o).then((function(t){return e.createSampleQuestionsFromResponse(t,o)}),(function(){return[]}))),n},e.prototype.addTileUtterance=function(e,t){this.tileUtterancesByModel[t]||(this.tileUtterancesByModel[t]=[]),this.tileUtterancesByModel[t].push({question:e,source:i.Tile,modelId:t})},e.prototype.deleteTileUtterance=function(t,n){if(n in this.tileUtterancesByModel){var r={question:t,source:i.Tile,modelId:n},o=_.findIndex(this.tileUtterancesByModel[n],(function(t){return e.areEqual(r,t)}));o!==-1&&this.tileUtterancesByModel[n].splice(o,1)}},e.prototype.clearTilesUtterance=function(){this.tileUtterancesByModel={}},e.createFeaturedQuestions=function(e){return _(e).map((function(e){return _(e.featuredQuestions).sortBy((function(e){return e.order})).map((function(t){return{question:t.utterance,source:i.FeaturedQuestion,modelId:e.id}})).value()})).flatten().value()},e.createSampleQuestionsFromResponse=function(t,n){if(!t||t.isEmpty(!0))return[];var r=_(t.results).map((function(t){return t.alternateCompletions.map((function(r){if(r.Items.length>1)return null;var o=e.findModelId(t.databaseName,t.virtualServerName,n);return o===-1?null:{question:r.Items[0].Text,source:i.Generated,modelId:o}}))})).flatten().filter((function(e){return!!e})).uniq((function(e){return e.question.trim().toUpperCase()})).value();return r||[]},e.findModelId=function(e,t,n){var i=_.find(n,(function(n){return n.dbName===e&&n.vsName===t}));return i?i.id:-1},e.areEqual=function(e,t){return e===t||jsCommon.StringExtensions.equalIgnoreCase(e.question,t.question)&&e.source===t.source&&e.modelId===t.modelId},e})()})(n=t.services||(t.services={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}e.createTermConverterService=t;var n=(function(){function e(e,t,n){this.span=t,this.bindingElementFactory=n,this.menuOpened=!1,this.currentReplacementIndex=0,this.hasBuiltReplacements=!1,this.span=t,this.text=e.substr(t.StartIndex,t.Length),jsCommon.StringExtensions.isWhitespace(this.text)||(this.text=this.text.replace(/ /g,""));var i=[];t.Binding&&i.push(t.Binding),t.AlternateBindings&&(i=i.concat(t.AlternateBindings)),t.SuggestedReplacements&&(i=i.concat(t.SuggestedReplacements)),t.PhraseCompletions&&(i=i.concat(t.PhraseCompletions)),
this.bindings=i}return Object.defineProperty(e.prototype,"element",{get:function(){return this.elem||(this.elem=this.buildElement()),this.elem},enumerable:!0,configurable:!0}),e.prototype.reuseElement=function(e){return!!(e.element.parentElement&&(this.text.indexOf(e.text)>-1||e.text.indexOf(this.text)>-1)&&e.hasBindings&&this.hasBindings)&&(this.elem=this.buildElement(e),!0)},Object.defineProperty(e.prototype,"hasElement",{get:function(){return!!this.elem},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasBindings",{get:function(){return this.bindings.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentReplacement",{get:function(){return this.replacements[this.currentReplacementIndex]},enumerable:!0,configurable:!0}),e.prototype.chooseCurrentReplacement=function(){this.chooseReplacement(this.currentReplacement)},e.prototype.chooseReplacement=function(e){this.header.innerText=e.text,this.manager&&this.manager.selectReplacement(this,e.text),this.closeMenu()},e.prototype.selectNextReplacement=function(){var e=this.currentReplacementIndex;this.currentReplacement.element.className="",e=Math.min(e+1,this.replacements.length-1),this.currentReplacementIndex=e,this.currentReplacement.element.className="selected";var t=this.replacementElement.offsetHeight,n=this.replacementElement.scrollTop,i=this.currentReplacement.element.offsetHeight,r=this.currentReplacement.element.offsetTop;r+i>n+t&&(this.replacementElement.scrollTop=r-t+i)},e.prototype.selectPreviousReplacement=function(){var e=this.currentReplacementIndex;return this.currentReplacement.element.className="",e--,e>=0?(this.currentReplacementIndex=e,this.currentReplacement.element.className="selected",this.currentReplacement.element.offsetTop<this.replacementElement.scrollTop&&(this.replacementElement.scrollTop=this.currentReplacement.element.offsetTop),!0):(e=0,!1)},e.prototype.closeMenu=function(){this.menuOpened&&this.replacementElement&&(this.currentReplacement.element.className="",this.replacementElement.style.display="none"),this.menuOpened=!1,this.header.className="term-main",this.manager&&this.manager.menuClosed()},e.prototype.openMenu=function(){return this.hasBindings&&(this.menuOpened||(this.hasBuiltReplacements||this.buildReplacements(),this.replacementElement.style.display="block",this.replacementElement.offsetWidth+this.elem.offsetLeft>this.manager.utteranceElement.parentElement.offsetWidth?this.replacementElement.style.left=this.elem.offsetLeft+this.elem.offsetWidth-this.replacementElement.offsetWidth+"px":this.replacementElement.style.left="",this.currentReplacementIndex=0,this.replacementElement.scrollTop=0,this.currentReplacement.element&&(this.currentReplacement.element.className="selected")),this.menuOpened=!0,this.header.className="term-main selected"),this.menuOpened},e.prototype.buildElement=function(e){var t,n,i=this;e&&e.hasElement?(t=e.element,this.replacementElement=e.replacementElement,e.menuOpened&&this.buildReplacements()):t=document.createElement("span"),n=this.header=document.createElement("span"),n.className="term-main";var r=this.span;n.appendChild(document.createTextNode(this.text.replace(/ /g,"")));var o=""===this.text.trim(),s=["term"];return r.Unrecognized||s.push("recognized"),this.hasBindings?(s.push("bindings"),o||s.push("replacements")):o&&s.push("space"),t.className=s.join(" "),e&&e.header&&e.header.parentElement===t?t.replaceChild(n,e.header):t.appendChild(n),this.hasBindings&&n.addEventListener("click",(function(e){i.menuOpened?i.closeMenu():i.manager&&i.manager.selectTerm(i)})),t},e.prototype.buildReplacements=function(){var e=this;if(this.bindingElementFactory){var t=!this.replacementElement;t?this.replacementElement=document.createElement("ul"):this.replacementElement.innerHTML="",this.replacements=this.bindings.map((function(t,n){var i=e.bindingElementFactory.build(t);return i.element.addEventListener("mousedown",(function(t){e.currentReplacementIndex=n,e.chooseCurrentReplacement(),t.preventDefault()})),e.replacementElement.appendChild(i.element),i})),t&&this.elem.appendChild(this.replacementElement)}this.hasBuiltReplacements=!0},e})();e.Term=n;var i=(function(){function e(e,t){this.bindingElementFactory=e,this.rtl=t}return e.prototype.convertIntermediateTerms=function(e,t,i,r){for(var o=i;o<r;)if(/\s/.test(t.charAt(o)))e.push(new n(t,{StartIndex:o,Length:1})),o++;else{var s=t.indexOf(" ",o);s=s>-1?Math.min(s,r):r,e.push(new n(t,{StartIndex:o,Length:s-o})),o=s}},e.prototype.isTextRTL=function(t){return e.rtlDirCheck.test(t)},e.prototype.swapTerms=function(e,t,n){var i=e.splice(t,n-t),r=i.reverse();e.splice.apply(e,[t,0].concat(r))},e.prototype.reorderLtrRuns=function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n].text,r=this.isTextRTL(i);r?null!==t&&(this.swapTerms(e,t,n),t=null):null===t&&(t=n)}return null!==t&&this.swapTerms(e,t,e.length-1),e},e.prototype.convert=function(e){var t,i=e.utterance.replace(/\u00A0/g," "),r=e.result,o=[];if(r){var s=r.spans,a=0;if(!_.isEmpty(s)){for(var u=0,c=s;u<c.length;u++){var l=c[u];a<l.StartIndex&&(this.convertIntermediateTerms(o,i,a,l.StartIndex),a=l.StartIndex);var p=new n(i,l,this.bindingElementFactory);o.push(p),a+=l.Length,i=i.substring(0,l.StartIndex)+p.text+i.substring(a)}t=_.last(o).hasBindings}a<i.length&&(this.convertIntermediateTerms(o,i,a,i.length),t=!1)}return this.rtl.isRtlLayout&&(o=this.reorderLtrRuns(o)),{utterance:i,hasCompletions:t,terms:o}},e.ltrCharacters="A-Za-z--------",e.rtlCharacters="---",e.rtlDirCheck=new RegExp("^[^"+e.ltrCharacters+"]*["+e.rtlCharacters+"]"),e})()})(t=e.services||(e.services={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){function n(e,t,n){return new i(e,t,n)}t.createAnsweredQuestionEventLoggerFactory=n;var i=(function(){function e(e,t,n){this.promiseFactory=e,this.telemetryService=t,this.timeoutService=n}return e.prototype.createAnsweredQuestionEventLogger=function(e){return new s(e,this.promiseFactory,this.telemetryService,this.timeoutService)},e})(),r="1",o="3",s=(function(){function t(e,t,n,i){this.delayMilliseconds=e,this.promiseFactory=t,this.telemetryService=n,this.timeoutService=i}return t.prototype.startAnsweredQuestionEvent=function(){var e=this,t=Date.now(),n=-1,i=this.promiseFactory.defer();return i.promise.then((function(){return n=Date.now()})),this.lastTimeout&&this.timeoutService.cancel(this.lastTimeout),this.lastTimeout=this.timeoutService((function(){e.lastTimeout=null,i.promise.then((function(i){return e.endAnsweredQuestionEvent(t,n,i)}))}),this.delayMilliseconds,!1),i},t.prototype.endAnsweredQuestionEvent=function(t,n,i){var s=-1;i.probeCompletedTimestamp&&i.probeCompletedTimestamp>=t&&(s=i.probeCompletedTimestamp-t),i.wasCancelled&&(i.isError=!1);var a=function(a,u,c,l){return void 0===u&&(u=!1),void 0===c&&(c=void 0),void 0===l&&(l=void 0),e.telemetry.QnAINAQ("FireActivityCompletionSummaryEvent",i.isError?o:r,i.isResponseEmpty,i.fromCache,i.contentProviderType,i.ownerType,n-t,s,i.wasCancelled,i.interpretRequestId,a,i.isError,c,l)};this.telemetryService.logEvent(a)},t})()})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new n(e,t)}e.createStateMachine=t;var n=(function(){function e(e,t){this.stateMachineDefinition=e,this.current=t,this.isBusy=!1,this.transitionQueue=[],this.transitionActionHandlers={}}return e.prototype.addTransitionActionHandler=function(e,t){this.transitionActionHandlers[e.toString()]=t},e.prototype.enqueueTransition=function(e){this.transitionQueue.push(e),this.performTransitionInternal()},e.prototype.performTransitionInternal=function(){if(!this.isBusy){for(this.isBusy=!0;this.transitionQueue.length>0;){var e=this.transitionQueue.shift(),t=this.stateMachineDefinition.getTransition(this.current,e);if(void 0!==t){this.current=t.toState;for(var n=t.actions,i=0,r=n;i<r.length;i++){var o=r[i],s=this.transitionActionHandlers[o.toString()];s&&s()}}}this.isBusy=!1}},e})()})(t=e.stateMachine||(e.stateMachine={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(){this.states={}}return t.prototype.getTransition=function(e,t){return this.states[e.toString()][t.toString()]},t.prototype.containsState=function(e){return e.toString()in this.states},t.prototype.addTransition=function(t,n,i,r){var o=this.states[t.toString()];void 0===o&&(this.states[t.toString()]=o={}),o[n.toString()]=new e.Transition(r,i),this.containsState(i)||(this.states[i.toString()]={})},t})();e.StateMachineDefinition=t})(t=e.stateMachine||(e.stateMachine={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this._actions=e,this._toState=t}return Object.defineProperty(e.prototype,"toState",{get:function(){return this._toState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actions",{get:function(){return this._actions},enumerable:!0,configurable:!0}),e})();e.Transition=t})(t=e.stateMachine||(e.stateMachine={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(t){return new r(new e.InterpretUsageQueue(t))}var n=jsCommon.TimerPromiseFactory;e.createInterpretUsageListener=t;var i=5e3,r=(function(){function e(e,t){this.interpretUsageQueue=e,this.timerFactory=t||n.instance}return e.prototype.setFeedbackForLastUtterance=function(e){this.sendPendingResponse(),this.interpretUsageQueue.setFeedbackForLastUtterance(e),this.interpretUsageQueue.flushPending()},e.prototype.onInterpretIssued=function(){var e=this;this.userCompletionPromise&&this.userCompletionPromise.reject(),this.userCompletionPromise=this.timerFactory.create(i),this.userCompletionPromise.done((function(){return e.sendPendingResponse()}))},e.prototype.onInterpretSuccess=function(e,t){return this.userCompletionPromise?(this.pendingInterpretResponse=e,void(this.pendingContentProviderType=t)):void this.registerResponse(e,t)},e.prototype.sendPendingResponse=function(){this.userCompletionPromise&&(this.userCompletionPromise.reject(),this.userCompletionPromise=null);var e=this.pendingInterpretResponse;e&&this.registerResponse(e,this.pendingContentProviderType)},e.prototype.registerResponse=function(e,t,n,i){e.isUtteranceLinguisticallyEquivalent(this.lastInterpretResponse)||(this.interpretUsageQueue.register(e,t,n,i),this.lastInterpretResponse=e)},e})();e.InterpretUsageListener=r})(t=e.usage||(e.usage={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.TimerPromiseFactory,n=100,i=12e4,r=(function(){function r(n,i,r){this.pendingInterpretations=[],this.usageService=n,this.usageUpdateUtteranceFactory=i||new e.UsageUpdateUtteranceFactory,this.timerFactory=r||t.instance}return r.prototype.register=function(t,r,o,s,a){var u=this;this.mostRecentInterpretation={interpretation:t,flags:o||e.UtteranceFlags.None,feedback:s||e.UtteranceFeedback.None,timeStamp:a||new Date,contentProviderType:r},this.pendingInterpretations.push(this.mostRecentInterpretation),this.pendingInterpretations.length>n?this.flushPending():this.sendPendingUsagesPromise||(this.sendPendingUsagesPromise=this.timerFactory.create(i),this.sendPendingUsagesPromise.done((function(){return u.sendAllUsages()})))},r.prototype.flushPending=function(){this.sendPendingUsagesPromise&&this.sendPendingUsagesPromise.reject(),this.sendAllUsages()},r.prototype.sendAllUsages=function(){var e=[];this.sendPendingUsagesPromise=null;for(var t=0,n=this.pendingInterpretations.length;t<n;++t){var i=this.pendingInterpretations[t];e=e.concat(this.usageUpdateUtteranceFactory.create(i.interpretation,i.flags,i.feedback,i.timeStamp,i.contentProviderType))}this.pendingInterpretations=[],e.length>0&&this.usageService.update(e)},r.prototype.setFeedbackForLastUtterance=function(t){this.updateMostRecentUtterance((function(n){n.feedback=t,t===e.UtteranceFeedback.Bad&&(n.flags|=e.UtteranceFlags.User)}))},r.prototype.updateMostRecentUtterance=function(e){var t=this.pendingInterpretations.length;t>0?e(this.pendingInterpretations[t-1]):this.mostRecentInterpretation&&(e(this.mostRecentInterpretation),this.pendingInterpretations.push(this.mostRecentInterpretation))},r})();e.InterpretUsageQueue=r})(t=e.usage||(e.usage={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.None=0]="None",e[e.ResultIsEmpty=1]="ResultIsEmpty",e[e.User=2]="User"})(t=e.UtteranceFlags||(e.UtteranceFlags={}));var n;!(function(e){e[e.None=0]="None",e[e.Bad=1]="Bad",e[e.Medium=2]="Medium",e[e.Good=3]="Good"})(n=e.UtteranceFeedback||(e.UtteranceFeedback={}))})(t=e.usage||(e.usage={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){var n=jsCommon.StringExtensions,i=(function(){function i(){}return i.prototype.create=function(e,t,n,r,o){for(var s=[],a=e.results,u=0,c=a.length;u<c;++u)s.push(i.createUsageData(a[u],t,n,u,r,o));return s},i.createUsageData=function(e,t,n,r,o,s){var a=e.source,u={Text:e.utterance,ResultRank:r,Flags:t|i.determineFlags(e),DatabaseName:a.DatabaseName,VirtualServerName:a.VirtualServerName,ClientDateTime:jsCommon.DateExtensions.serializeDate(o),UserFeedback:n,ContentProviderType:s},c=e.completedUtterance;if(c){u.Text=c.Text;var l=e.unrecognizedTerms;l&&l.length>0&&(u.UnrecognizedTerms=i.convertUnrecognizedTerms(l,c))}return a.Score&&(u.Score=a.Score),u},i.determineFlags=function(e){var n=t.UtteranceFlags.None;return e.completedUtterance||(n|=t.UtteranceFlags.ResultIsEmpty),n},i.convertUnrecognizedTerms=function(t,i){for(var r=[],o=i.Terms,s=0,a=t.length;s<a;++s){var u=t[s],c=o[u].StartCharIndex,l=e.models.InterpretResult.getTermText(i,u);r.push({StartIndex:c,Length:n.trimTrailingWhitespace(l).length})}return r},i})();t.UsageUpdateUtteranceFactory=i})(t=e.usage||(e.usage={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){if(!e)return null;var t=e.utterance;return e.completedUtterance&&(t=e.completedUtterance.Text),n(t,e)}function n(e,t){var n=t.source,i=n.Command;if(!i)return null;var r=i.Binding,o=i.Data,s=null,a=null,u=null;if(o){if(!r)return null;if(a=JSON.parse(r),u=JSON.parse(o),!u)return null;s={data:{descriptor:a,dsr:u}}}return{utterance:e,interpretResult:t,restatement:n.Restatement,queryDefn:i.Query,queryDescriptor:a,queryMetadata:i.QueryMetadata,configs:i.VisualConfigurations,dataViewSource:s,virtualServerName:n.VirtualServerName,databaseName:n.DatabaseName}}e.parseInterpret=t})(t=e.InterpretResultUtility||(e.InterpretResultUtility={}))})(t=e.util||(e.util={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(n){var i;!(function(n){var i,r=(e.explore.viewModels,e.explore.infonav.util.QueryProjectionBuilderUtils),o=e.data.services.SemanticQuerySerializer,s=jsCommon.Utility;!(function(n){function i(e){return{taskPane:l(),visualizationPane:p(e)}}function a(n,i,a,c,l){return __awaiter(this,void 0,e.Promise,(function(){var e,p,d,h,g,f,v,m,S,y;return __generator(this,(function(T){switch(T.label){case 0:return[4,i.get(a)];case 1:e=T.sent(),p=[],d=0,h=n.length,T.label=2;case 2:return d<h?(g=n[d],f=g.config,f.InsightType?[4,l("insightsExportService")]:[3,5]):[3,8];case 3:return m=T.sent(),[4,m.createVisualContainer(g.model,f.InsightType,u(f))];case 4:return v=T.sent(),[3,6];case 5:S=o.deserializeQuery(f.Query),y=r.createProjectionBuilder(f.VisualizationType,S,e),v=t.VisualContainerFactory.create(s.generateGuid(),S,f.QueryMetadata,f.DataShapeBinding,y,e,c),v.config.singleVisual.objects=g.dataViewObjectDefinitions||v.config.singleVisual.objects,T.label=6;case 6:p.push({visualContainer:v,model:g.model,dataViewSource:g.dataViewSource}),T.label=7;case 7:return d++,[3,2];case 8:return[2,p]}}))}))}function u(e){return{VisualizationType:e.VisualizationType,VisualElements:e.VisualElements,QueryCommand:{Query:e.Query,Binding:e.DataShapeBinding},QueryMetadata:e.QueryMetadata}}function c(e,t){return{visualContainer:e,model:t}}function l(){return{isPaneExpanded:!1}}function p(e){return{sections:[],activeSection:0,pagePaneSections:[],activePageSection:0,isPaneExpanded:!1,visualPluginFilter:function(t){var n=e.tryGetFilterPropertyIdentifier(t.capabilities);return!n}}}n.createInfoNavContainer=i,n.createVisualDataFromInterpretResult=a,n.createVisualDataFromVisualContainer=c,n.createTaskPane=l,n.createVisualizationPane=p})(i=n.ViewModelFactory||(n.ViewModelFactory={}))})(i=n.viewModels||(n.viewModels={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),angular.module("powerbi.qnacore").run(["$templateCache",function(e){e.put("components/qnaInput/qnaInput.html",'<div class="qnaInputContainer"><span class="glyphicon pbi-glyph-qna icon" ng-click="$ctrl.selectUtterance()"></span><div id="box"><textarea id="content" type="text" placeholder="{{::$ctrl.placeholder}}" spellcheck="false" autofocus></textarea><div id="utterance"><div id="utteranceContent"></div></div></div></div><div id="cap" ng-click="$ctrl.hideAllMenus()"></div>'),e.put("views/infoNavCanvas.html",'<div class="infoNavCanvas"><section class="exploration" ng-if="viewModel.exploreCanvas" ng-style="explorationStyle"><explore-canvas view-model="viewModel.exploreCanvas"></explore-canvas></section></div>'),e.put("views/infoNavContainer.html",'<section class="explorationContainer infoNavContainer"><exploration-host class="explorationHost" view-model="viewModel" id="athenaExplorationHost"><task-pane class="qnaTaskPane" view-model="viewModel.taskPane" field-list-config="::fieldListConfig" ng-if="hasResult" ng-show="infoNavContainerOptions.showTaskPane" resizable resizable-containerid="athenaExplorationHost" resizable-sibling="qnaVizPane" ng-attr-resizable-expanded="{{viewModel.taskPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"></task-pane><visualization-pane class="qnaVizPane" ng-if="hasResult" ng-show="infoNavContainerOptions.showVisualizationPane" view-model="viewModel.visualizationPane" resizable resizable-containerid="athenaExplorationHost" resizable-sibling="qnaTaskPane" resizable-expanded="{{viewModel.visualizationPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"></visualization-pane><div class="infonavContentWrapper"><section class="infonavContent" ng-style="{\'max-height\':infoNavContentMaxHeight}"><div class="infonavHeader"><qna-input models="models" get-additional-o-data-filter="getAdditionalODataFilter" output="questionBoxOutput" interpret-listener="interpretListener" usage-reporting-enabled="usageReportingEnabled" ng-if="newQnaEnabled"></qna-input></div><div class="infonavMainContent"><info-nav-canvas ng-show="hasResult" canvas-definition="infoNavCanvasDefinition" respect-pane-updates="true"></info-nav-canvas><div ng-if="state === 1" class="qnaLoading"><spinner class="large qnaLoadingSpinner"></spinner><span localize="Qna_LoadingMessage"></span></div><div class="qnaStartFrame" ng-if="(state === 0 || state === 2 || state === 4) && !infoNavContainerOptions.cortana"><info-nav-qna-start models="models" error-message="{{state === 2 ? errorMessage : \'\'}}" interpret-utterance="interpretUtterance || questionBoxOutput.interpretUtterance"></info-nav-qna-start></div></div><div class="infonavFooter"><h3 ng-if="restatement && !infoNavContainerOptions.cortana" class="restatement">{{restatement}}</h3><h3 ng-if="sourceLabel" class="dataSource">{{sourceLabel}}</h3></div></section></div></exploration-host></section>'),e.put("views/infoNavQnaStart.html",'<div ng-switch="isLoading" class="qnaStart"><div ng-switch-when="true" class="qnaLoading"><spinner modern class="large qnaLoadingSpinner"></spinner><span localize="Qna_LoadingMessage"></span></div><div ng-switch-when="false" class="qnaStartContent"><div ng-switch="viewModel.modelSuggestionSets.length> 0"><div ng-switch-when="true"><div ng-if="!!errorMessage" class="prompt">{{errorMessage}}</div><div class="suggestionSet" ng-repeat="set in viewModel.modelSuggestionSets"><div class="modelName" title="{{::set.modelName}}">{{::set.modelName}}</div><div class="suggestions"><ul><li ng-repeat="s in set.suggestions | limitTo : set.currentSuggestionLimit"> <button ng-click="showUtterance(s)" class="utterance">{{::s.suggestion}}</button></li><li ng-if="set.suggestions.length> set.initialSuggestionLimit"> <button ng-click="toggleLimit(set)" ng-switch="!!set.currentSuggestionLimit" class="seeMore"><span ng-switch-when="true" localize="QnaStart_SeeMore"></span><span ng-switch-when="false" localize="QnaStart_SeeLess"></span></button></li></ul></div></div></div><div ng-switch-when="false"><span ng-if="errorMessage" class="prompt" localize="QnAVisualization_EmptyResultTitleText"></span><span ng-if="!errorMessage" class="prompt" localize="QnaStart_ErrorLoadingSuggestions"></span></div></div></div></div>'),e.put("views/qna/questionBox.html",'<div class="infonav-questionBoxContainer"><div class="infonav-questionBoxControl"><qna-text-input info-nav-control-container="infoNavControlContainer" shared-view-model="sharedViewModel"></qna-text-input></div></div>'),e.put("views/qna/questionBoxContainer.html",'<div class="qnaQuestionBoxContainer"><spinner class="qnaSpinner" ng-show="sharedViewModel.showLoadingSpinner"></spinner><question-box info-nav-control-container="infoNavControlContainer" shared-view-model="sharedViewModel"></question-box><qna-suggestion-list info-nav-control-container="infoNavControlContainer" shared-view-model="sharedViewModel"></qna-suggestion-list></div>'),e.put("views/qna/suggestionList.html",'<div class="infonav-suggestionsHost" ng-show="viewModel.showSuggestionsHost"><div class="infonav-suggestionsHostInnerBorder"><div class="infonav-suggestionsHostInnerLayout" ng-class="{\'no-restatement\': !viewModel.restatement}"><ul class="infonav-suggestionsList"><li class="infonav-restatement" ng-if="!!viewModel.restatement">{{viewModel.restatement}}</li><div class="infonav-hr" ng-if="!!viewModel.restatement && viewModel.uiSuggestionItems.length> 0"></div><li ng-repeat="item in viewModel.uiSuggestionItems | limitTo : viewModel.maxSuggestions" ng-class="{\'infonav-listItemSelected\': $index === viewModel.selectedSuggestionIndex}" ng-mouseenter="handleSuggestionMouseEnter($index)" ng-mousedown="handleSuggestionMouseDown($index, $event)" data-suggestionIndex="{{$index}}"> <span ng-repeat="part in item.parts" ng-class="{\'infonav-suggestedTermReplacement\': part.emphasize}">{{part.text}}</span></li></ul></div></div></div>'),e.put("views/qna/textInput.html",'<div class="infonav-textInputControl"><div class="infonav-textInputBox"><div class="infonav-inputAutoComplete" ng-show="viewModel.showAutoComplete" ng-switch="viewModel.hasFocus"> <span ng-switch-when="true" ng-if="viewModel.autoComplete" class="autoCompleteUserInput">{{sharedViewModel.userInput}}</span><span ng-switch-when="true" ng-if="viewModel.autoComplete" class="autoCompleteCompletion">{{viewModel.autoComplete}}</span><span ng-switch-when="false" ng-show="!sharedViewModel.userInput" ng-switch="sharedViewModel.showLoadingPlaceholder"><span ng-switch-when="true" localize="QnaTextBoxLoadingPlaceholder"></span><span ng-switch-when="false" localize="QnaTextBoxPlaceholder"></span></span></div><div class="infonav-inputTermSelection" ng-show="viewModel.showInputTermSelection" ng-style="{                \'top\':viewModel.inputTermSelectionPosition.top,                \'left\':viewModel.inputTermSelectionPosition.left,                \'width\':viewModel.inputTermSelectionPosition.width,                \'height\':viewModel.inputTermSelectionPosition.height}"></div><div class="infonav-inputRenderer"> <span ng-repeat="t in viewModel.inputRendererTerms" ng-class="{\'infonav-unrecognizedTerm\': t.unrecognized && viewModel.inputRendererShowUnrecognized}" data-termindex="{{t.index}}">{{t.term}}</span><span ng-if="!!viewModel.inputRendererRemainder">{{viewModel.inputRendererRemainder}}</span></div> <input class="infonav-userInput" type="text" spellcheck="false" autocomplete="off" maxlength="500" ng-model="sharedViewModel.userInput" ng-focus="onUserInputFocus()" ng-blur="onUserInputBlur()" ng-change="onUserInputChange()" ng-keydown="onUserInputKeyDown($event)" ng-keyup="onUserInputKeyUp($event)" ng-click="onUserInputClick()" ng-on-select="onUserInputSelect()" ng-trim="false"/></div></div>'),e.put("views/userFeedbackDialog.html",'<div><div localize="UtteranceFeedbackDialogPrompt"></div><div class="utteranceFeedbackOptions"> <label ng-repeat="o in feedback.options"><input type="radio" name="utteranceFeedback" ng-value="{{o.value}}" ng-model="feedback.selected"/> <span>{{o.text}}</span></label></div></div>')}]);var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){var n=(function(){function t(t,n){this.scope=t,this.services=n,t.feedback={options:[this.createFeedbackOption("UtteranceFeedbackResultGood",e.usage.UtteranceFeedback.Good),this.createFeedbackOption("UtteranceFeedbackResultMedium",e.usage.UtteranceFeedback.Medium),this.createFeedbackOption("UtteranceFeedbackResultBad",e.usage.UtteranceFeedback.Bad)],selected:null},t.$watch("feedback.selected",(function(e){t.getPrimaryButton().prop("disabled",null==e)}))}return t.createOptions=function(){return{additionalServices:["localizationService"]}},t.prototype.createFeedbackOption=function(e,t){return{value:t,text:this.services.localizationService.get(e)}},t})();t.UserFeedbackDialogController=n})(t=e.controllers||(e.controllers={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var n;!(function(t){var n;!(function(n){var i=(function(){function n(){this.restrict="E",this.templateUrl="views/userFeedbackDialog.html",this.replace=!0,this.controller=e.common.createController(t.controllers.UserFeedbackDialogController),this.link=function(e,t,n){e.getPrimaryButton=function(){return t.parent().parent().find(".infonav-dialogActions > input").filter(":first")}}}return n})();n.UserFeedbackDialog=i})(n=t.directives||(t.directives={}))})(n=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreDirective("UserFeedbackDialog",[]);var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){t.QnaInput={templateUrl:"components/qnaInput/qnaInput.html",bindings:{getAdditionalODataFilter:"=",interpretListener:"=",models:"=",output:"=",usageReportingEnabled:"="},controller:e.controllers.qna.QnaInputController}})(t=e.components||(e.components={}))})(t=e.infonav||(e.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),powerbi.explore.infonav.registerQnaCoreComponent("QnaInput");;"use strict";var __awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(a,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function r(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(o,r)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,s&&(o=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,s=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(t){i=[6,t],s=0}finally{a=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,s,o,r,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},powerbi;!(function(t){var e;!(function(e){function i(i,n,a,s,o,r,l,d,g){var p=e.CustomerAction(i,n,a,s,o,r,l,d,g),m=u(p.info,{}),h={name:"PBI.Settings.AdminAuditing",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return t.extendFormatted(null,null,p.formatted())},info:m,loggers:e.SettingsAdminAuditingLoggers};return h}function n(i,n,a,s,o,r,l,d,g){var p=e.Verbose(i,n,a,s,o,r,l,d,g),m=u(p.info,{}),h={name:"PBI.Settings.GetUsageMetricsDashboardId",category:t.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return t.extendFormatted(null,null,p.formatted())},info:m,loggers:e.SettingsGetUsageMetricsDashboardIdLoggers};return h}function a(i,n,a,s,o,r,l,d,g){var p=e.Verbose(i,n,a,s,o,r,l,d,g),m=u(p.info,{}),h={name:"PBI.Settings.GetTenantSettings",category:t.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return t.extendFormatted(null,null,p.formatted())},info:m,loggers:e.SettingsGetTenantSettingsLoggers};return h}function s(i,n,a,s,o,r,l,d,g){var p=e.CustomerAction(i,n,a,s,o,r,l,d,g),m=u(p.info,{}),h={name:"PBI.Settings.UpdateTenantSettings",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return t.extendFormatted(null,null,p.formatted())},info:m,loggers:e.SettingsUpdateTenantSettingsLoggers};return h}function o(i,n,a,s,o,r,l,d,g,p,m,h,f,S){var v=e.CustomerAction(r,l,d,g,p,m,h,f,S),b=u(v.info,{name:i,isEnabled:n,isGranular:a,hasAllowedSecurityGroups:s,hasDeniedSecurityGroups:o}),y={name:"PBI.Settings.UpdateTenantSetting",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return t.extendFormatted({name:b.name,isEnabled:b.isEnabled,isGranular:b.isGranular,hasAllowedSecurityGroups:b.hasAllowedSecurityGroups,hasDeniedSecurityGroups:b.hasDeniedSecurityGroups},null,v.formatted())},info:b,loggers:e.SettingsUpdateTenantSettingLoggers};return y}function r(i,n,a,s,o,r,l,d,g,p){var m=e.CustomerAction(n,a,s,o,r,l,d,g,p),h=u(m.info,{numberOfDataClassifications:i}),f={name:"PBI.Settings.UpdateDataClassifications",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return t.extendFormatted({numberOfDataClassifications:h.numberOfDataClassifications},null,m.formatted())},info:h,loggers:e.SettingsUpdateDataClassificationsLoggers};return f}function l(i,n,a,s,o,r,l,d,p,m){var h=e.Verbose(n,a,s,o,r,l,d,p,m),f=u(h.info,{adminPortalTab:i}),S={name:"PBI.Settings.AdminPortalTabSelected",category:t.TelemetryCategory.Verbose,time:Date.now(),id:c(),formatted:function(){return t.extendFormatted({adminPortalTab:g[f.adminPortalTab]},null,h.formatted())},info:f,loggers:e.SettingsAdminPortalTabSelectedLoggers};return S}var c,d=jsCommon.Utility,u=jsCommon.UnionExtensions.mergeUnionType;c=d?d.generateGuid:Function.prototype;var g;!(function(t){t[t.None=0]="None",t[t.UsageMetrics=1]="UsageMetrics",t[t.ManageUsers=2]="ManageUsers",t[t.Auditing=3]="Auditing",t[t.TenantSettings=4]="TenantSettings",t[t.CapacitySettings=5]="CapacitySettings"})(g=e.AdminPortalTab||(e.AdminPortalTab={})),e.SettingsAdminAuditing=i,e.SettingsGetUsageMetricsDashboardId=n,e.SettingsGetTenantSettings=a,e.SettingsUpdateTenantSettings=s,e.SettingsUpdateTenantSetting=o,e.SettingsUpdateDataClassifications=r,e.SettingsAdminPortalTabSelected=l})(e=t.telemetry||(t.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){function i(e){var i=[{name:"AdminPortal",blockType:2,consumerHostFlags:8},{name:"Auditing",blockType:2,consumerHostFlags:8},{name:"DataClassifications",blockType:2,consumerHostFlags:8},{name:"ManageUsers",blockType:2,consumerHostFlags:8},{name:"TenantMessage",blockType:2,consumerHostFlags:8},{name:"TenantSettingsContainer",blockType:2,consumerHostFlags:8},{name:"TenantSetting",blockType:2,consumerHostFlags:8},{name:"UsageMetrics",blockType:2,consumerHostFlags:8}];t.common.registerBuildingBlocksForHost(e,i,{componentsTarget:"powerbi.adminPortal.components",componentsMap:t.adminPortal.components})}angular.module("powerbi.adminPortal.components",[]),angular.module("powerbi.adminPortal",["powerbi.common","powerbi.connectivity","powerbi.adminPortal.components"]).factory("adminPortalHttp",[function(){return e.createAdminPortalHttpService()}]).factory("adminPortal",["promiseFactory","adminPortalHttp","localizationService","telemetryService","$interval",function(t,i,n,a,s){return e.createAdminPortalService(t,i,n,a,s)}]).factory("userInfo",["telemetryService","errorService","localizationService","userMetadataHttpService","promiseFactory","applicationOptions","featureSwitchService","$timeout",function(e,i,n,a,s,o,r,l){return t.common.createUserInfoService({telemetryService:e,errorService:i,localizationService:n,userMetadataHttpService:a,promiseFactory:s,applicationOptions:o,featureSwitchService:r,timeout:l},{shouldGetUserPhoto:!0,shouldRefreshUserMetadata:!0,isAdminRequest:!0})}]),e.registerBuildingBlocksForHost=i})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(t){var e;!(function(t){t.TenantSettingFormName="tenantSettingForm",t.DataClassificationsFormName="dataClassificationsForm",t.AdminPortalNavigationStateName="landing.adminPortal",t.PublishContentPackTenantSwitchId=9,t.ExternalSharingTenantSwitchId=11,t.ExternalSharingV2TenantSwitchId=12,t.PublishToWebTenantSwitchId=13,t.ExportDataTenantSwitchId=14,t.RScriptVisualTenantSwitchId=15,t.CortanaTenantSwitchId=16,t.ExportPowerPointTenantSwitchId=17,t.OnPremAnalayzeInExcelTenantSwitchId=18,t.TemplatePublishTenantSwitchId=19,t.AuditingTenantSwitchId=21,t.EsriVisualTenantSwitchId=23,t.PrintingTenantSwitchId=24,t.UsageMetricsTenantSwitchId=29,t.ArtifactSearchTenantSwitchId=35,t.DeveloperSettingsSwitchId=41,t.AppPushTenantSwitchId=50,t.ContentAuthoringUISwitchId=63,t.UsageMetricsTrackUserLevelInfoSwitchId=70,t.ImportExternalDataSwitchId=72;var e;!(function(t){t[t.ExportAndSharing=1]="ExportAndSharing",t[t.ContentPack=2]="ContentPack",t[t.Integration=3]="Integration",t[t.RVisuals=4]="RVisuals",t[t.Audit=5]="Audit",t[t.Dashboard=6]="Dashboard",t[t.DeveloperSettings=7]="DeveloperSettings",t[t.ContentAuthoring=8]="ContentAuthoring",t[t.Others=9]="Others"})(e=t.TenantSettingsGroupName||(t.TenantSettingsGroupName={})),t.TenantSettingsGroups=[e.ExportAndSharing,e.ContentPack,e.Integration,e.RVisuals,e.Audit,e.Dashboard,e.DeveloperSettings,e.ContentAuthoring,e.Others],t.TenantSettingGroupMapping={11:e.ExportAndSharing,12:e.ExportAndSharing,13:e.ExportAndSharing,14:e.ExportAndSharing,17:e.ExportAndSharing,24:e.ExportAndSharing,9:e.ContentPack,19:e.ContentPack,50:e.ContentPack,16:e.Integration,18:e.Integration,23:e.Integration,35:e.Integration,15:e.RVisuals,21:e.Audit,29:e.Audit,70:e.Audit,41:e.DeveloperSettings,63:e.ContentAuthoring,72:e.ContentAuthoring}})(e=t.constants||(t.constants={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(t){var e;!(function(t){var e=(function(){function t(){this.featureSwitches=[],this.tenantSettingsGroups=[],this.dataClassifications=[]}return t})();t.TenantSettings=e;var i=(function(){function t(t,e,i){this.name=t,this.displayName=e,this.tenantSettings=i}return t})();t.TenantSettingsGroup=i;var n=(function(){function t(t){this.contract=t,this.id=t.switchId,this.name=t.switchName,this.isEnabled=t.isEnabled,this.isGranular=t.isGranular}return t.prototype.equals=function(t){return!(!t||t.id!==this.id)&&this.isEnabled===t.isEnabled},t})();t.TenantSetting=n;var a=(function(){function t(t){this.contract=t}return t})();t.UsageMetricsDashboard=a})(e=t.models||(t.models={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){var n,a=t.common.contracts.ADUserMetaDataObjectType,s=t.common.models.EmailsListModel,o=t.common.contracts.GroupType,r=e.constants.TenantSettingGroupMapping,l=e.constants.TenantSettingsGroupName,c=e.constants.TenantSettingsGroups;!(function(t){function e(t,e){for(var i=[],n=0,a=t;n<a.length;n++){var s=a[n],o=u(s,e);o&&i.push(o)}return i}function n(t,e){for(var n=new i.TenantSettings,a=[],s=0,o=t.featureSwitches;s<o.length;s++){var r=o[s],l=u(r,e);l&&a.push(l)}return n.featureSwitches=a,n.tenantSettingsGroups=f(a,e),n.dataClassifications=t.dataClassifications,n}function d(t,e,i){var n=[];return n.push({displayName:t.get("UsageMetrics_Label"),type:1,requiredPermissionRole:1}),n.push({displayName:t.get("AdminPortal_ManageUsers"),type:2,requiredPermissionRole:1}),e.featureSwitches.adminAuditingEnabled&&i&&"undefined"!=typeof window.o365AdminAuditingPageUrl&&n.push({displayName:t.get("AdminPortal_Auditing"),type:3,requiredPermissionRole:1}),n.push({displayName:t.get("AdminPortal_TenantSettings"),type:4,requiredPermissionRole:1}),e.featureSwitches.adminCapacityEnabled&&n.push({displayName:e.featureSwitches.capacitiesAzureTab?t.get("AdminPortal_CapacitySettings"):t.get("CapacityAdmin_ManageCapacity"),type:5,requiredPermissionRole:0}),n.push({displayName:t.get("AdminPortal_EmbedCodes"),type:6,requiredPermissionRole:2}),n}function u(t,e){var n=new i.TenantSetting(t);if(n.displayName=e.get("TenantSetting_"+n.name+"_Title"),n.description=e.getOptional("TenantSetting_"+n.name+"_Description"),n.privacy=g(n.name,e),n.group=r[n.id]||l.Others,n.allowedSecurityGroups=m(t.allowedSecurityGroups),n.deniedSecurityGroups=m(t.deniedSecurityGroups),n.enabledForSecurityGroupsInfoMessage=e.getOptional("TenantSetting_"+n.name+"_EnabledForSecurityGroupsInfoMessage"),n.disabledInfoMessage=e.getOptional("TenantSetting_"+n.name+"_DisabledInfoMessage"),n.retroactiveDisableMessage=e.getOptional("TenantSetting_"+n.name+"_RetroactiveDisable_Message"),n.retroactiveDisableDescription=p(n.name+"_RetroactiveDisable",e),n.displayName)return n}function g(t,e){var i,n="TenantSetting_"+t+"_Privacy";if(e.getOptional(n)){i=[];var a=e.getOptional("TenantSetting_"+t+"_PrivacyTermsUrl");a&&i.push({key:"Terms",url:a});var s=e.getOptional("TenantSetting_"+t+"_PrivacyPolicyUrl");s&&i.push({key:"PrivacyPolicy",url:s});var o=e.getOptional("TenantSetting_"+t+"_PrivacyLearnMoreUrl");return o&&i.push({key:"LearnMore",url:o}),{isAlert:!0,message:n,fragments:i}}}function p(t,e){var i,n="TenantSetting_"+t+"_Description";if(e.getOptional(n)){i=[];var a=e.getOptional("TenantSetting_"+t+"_Description_LearnMoreUrl");return a&&i.push({key:"LearnMore",url:a}),{isAlert:!1,message:n,fragments:i}}}function m(t){var e=new s;return t&&(e.inputUserList=_.map(t,(function(t){return h(t)}))),e}function h(t){return{displayName:t.name,objectId:t.id,userPrincipalName:t.emailAddress,isSecurityGroup:!0,objectType:a.Group,groupType:t.emailAddress?o.EmailEnabledSecurityGroup:o.SecurityGroup}}function f(t,e){for(var n,a=[],s=0,o=c;s<o.length;s++){n=o[s];var r=S(t,n);if(0!==r.length||n===l.Dashboard){var d=e.get("TenantSettingsGroup_"+l[n]);a.push(new i.TenantSettingsGroup(n,d,r))}}return a}function S(t,e){return _.filter(t,(function(t){return t.group===e}))}t.convertTenantSettings=e,t.convertTenantSettingsV2=n,t.createAdminPortalOptions=d,t.convertTenantSetting=u})(n=i.AdminPortalModelFactory||(i.AdminPortalModelFactory={}))})(i=e.models||(e.models={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){var n=(function(){function i(i,n){var a=this;this.embedCodesModuleConfig={name:"powerbi.embedCodes",namespace:"powerbi.embedCodes",dependency:{javascript:"embedCodes",css:["embedCodes"]}},this.services=n,this.services.appMetadataService.getAppMetadata().then((function(t){var i=a.services.featureSwitchService;return a.adminCapacityEnabled=i.featureSwitches.adminCapacityEnabled,a.adminAuditingEnabled=i.featureSwitches.adminAuditingEnabled&&t.clusterFeatureSwitches.clusterAuditingEnabled,a.embedCodesEnabled=i.featureSwitches.embedCodesEnabled,a.services.localizationService.ensureLocalization((function(){a.options=e.models.AdminPortalModelFactory.createAdminPortalOptions(a.services.localizationService,a.services.featureSwitchService,t.clusterFeatureSwitches.clusterAuditingEnabled)})),a.services.userInfo.userMetadataPromise})).then((function(e){a.options=_.filter(a.options,(function(t){return a.isOptionAllowed(t)})),a.services.telemetryService.logEvent(t.telemetry.SettingsAdminPortalTabSelected,a.getSelectedTabTelemetryName());var i=a.getCurrentAdminPortalSettingsTab();5!==i||a.services.navigation.inCapacitySettingsView()||a.services.navigation.navigateToAdminPortal(i),a.showOptionsList=!0}))}return i.createOptions=function(){return{additionalServices:["appMetadataService","featureSwitchService","localizationService","navigation","telemetryService","userInfo"]}},i.prototype.onActiveOptionChanged=function(t){this.services.navigation.navigateToAdminPortal(t)},i.prototype.getCurrentAdminPortalSettingsTab=function(){var t=this.services.navigation.currentAdminPortalSettingsTab;return!t&&_.any(this.options)?this.options[0].type:t},i.prototype.isOptionAllowed=function(t){switch(t.requiredPermissionRole){case 1:return this.services.userInfo.userMetadata.isTenantAdmin;case 2:return this.embedCodesEnabled;default:return!0}},i.prototype.getSelectedTabTelemetryName=function(){var e=this.getCurrentAdminPortalSettingsTab();switch(e){case 3:return t.telemetry.AdminPortalTab.Auditing;case 1:return t.telemetry.AdminPortalTab.UsageMetrics;case 2:return t.telemetry.AdminPortalTab.ManageUsers;case 4:return t.telemetry.AdminPortalTab.TenantSettings;case 5:return t.telemetry.AdminPortalTab.CapacitySettings;default:return t.telemetry.AdminPortalTab.None}},i})();i.AdminPortalController=n})(i=e.controllers||(e.controllers={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){i.AdminPortal={controller:t.common.createController(e.controllers.AdminPortalController),templateUrl:"components/adminPortal/adminPortal.html"}})(i=e.components||(e.components={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(e){var i=(function(){function e(e,i){var n=this;this.scope=e,this.services=i;var a=this.services.$window;this.scope.auditingPageLanding=function(){a.open(window.o365AdminAuditingPageUrl,"_blank"),n.services.telemetryService.logEvent(t.telemetry.SettingsAdminAuditing)}}return e.createOptions=function(){return{additionalServices:["$window","telemetryService"]}},e})();e.AuditingController=i})(i=e.controllers||(e.controllers={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){i.Auditing={controller:t.common.createController(e.controllers.AuditingController),templateUrl:"components/auditing/auditing.html"}})(i=e.components||(e.components={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){var n=t.errorDetailsHelper,a=(function(){function a(t,e){this.services=e}return a.createOptions=function(){return{additionalServices:["adminPortal","errorService","localizationService","notificationToast","telemetryService"]}},a.prototype.$onInit=function(){this.showDetails=!1,this.lastSavedViewModel=_.cloneDeep(this.viewModel),this.refreshDataClassificationsForm()},a.prototype.$postLink=function(){var t=this;this.dataClassificationsForm.validate=function(){return t.validateDataClassifications()}},a.prototype.getFormName=function(){return e.constants.DataClassificationsFormName},a.prototype.toggleDetailsView=function(){this.showDetails=!this.showDetails},a.prototype.applyChanges=function(){return __awaiter(this,void 0,t.Promise,(function(){var e,i,a,s,o;return __generator(this,(function(r){switch(r.label){case 0:if(e=this.validateDataClassifications(),i=this.services.localizationService,!e)return[3,5];a=this.services.notificationToast.notify({title:i.get("AdminPortal_TenantSettings_Saving_Title"),message:i.get("AdminPortal_TenantSettings_Saving_Message"),notificationType:t.common.NotificationToastType.Loading}),s=this.services.telemetryService.startEvent(t.telemetry.SettingsUpdateDataClassifications,this.viewModel.length),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.services.adminPortal.updateDataClassifications(this.viewModel,s.event)];case 2:return r.sent(),this.lastSavedViewModel=_.cloneDeep(this.viewModel),this.services.notificationToast.hide(a),this.services.notificationToast.notify({title:i.get("AdminPortal_TenantSettings_DataClassification_Changed"),message:i.get("AdminPortal_TenantSettings_Success_Message"),notificationType:t.common.NotificationToastType.Success}),s.resolve(),[3,4];case 3:return o=r.sent(),this.services.notificationToast.hide(a),this.services.errorService.error(i.get("AdminPortal_TenantSettings_Failure_Message"),"FailedToApplyDataClassificationsChanges",{requestId:o.requestId,statusCode:o.status.toString()}),s.reject(n.getTelemetryErrorDetails(o.error,o.status)),[3,4];case 4:this.refreshDataClassificationsForm(),this.dataClassificationsForm.$setPristine(),r.label=5;case 5:return[2]}}))}))},a.prototype.cancelChanges=function(){this.viewModel=_.cloneDeep(this.lastSavedViewModel),this.refreshDataClassificationsForm(),this.dataClassificationsForm.$setPristine()},a.prototype.setDefaultDataClassification=function(t){for(var e=0,i=this.viewModel.length;e<i;e++)this.viewModel[e].default=e===t;this.dataClassificationsForm.$setDirty()},a.prototype.onDataClassificationToggled=function(){this.isEnabled?this.addDataClassification():this.viewModel=[]},a.prototype.addDataClassification=function(){var e=this.viewModel;e.push(new t.common.models.DataClassification),1===e.length&&(e[0].default=!0),this.dataClassificationsForm.$setDirty()},a.prototype.removeDataClassification=function(t){var e=this.viewModel,i=e[t].default;e.splice(t,1),i&&e.length>0&&(e[0].default=!0),0===e.length&&(this.isEnabled=!1),this.dataClassificationsForm.$setDirty()},a.prototype.validateDataClassifications=function(){if(this.isEnabled){for(var t={},e=0,i=0,n=this.viewModel.length;i<n;i++){var a=this.viewModel[i];if(!a.name)return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_MissingName"),!1;if(!a.shortHand||a.shortHand.length>4)return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_MissingShortHand"),!1;if(a.url&&0!==a.url.indexOf("http://")&&0!==a.url.indexOf("https://"))return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_WrongUrlFormat"),!1;a.default&&e++,t[a.shortHand]=t[a.shortHand]?t[a.shortHand]+1:1}if(this.viewModel.length>0&&1!==e)return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_NoDefault"),!1;for(var s in t)if(t[s]>1)return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_ShortHandMustBeUnique"),!1}return this.errorMessage=void 0,!0},a.prototype.refreshDataClassificationsForm=function(){this.updateIsEnabled(),this.updateGranularityState(),this.updateStatusMessage(),this.errorMessage=void 0},a.prototype.updateIsEnabled=function(){this.isEnabled=!_.isEmpty(this.viewModel)},a.prototype.updateGranularityState=function(){this.granularityState=this.isEnabled?i.TenantSettingGranularityState.EnabledForEntireOrganization:i.TenantSettingGranularityState.Disabled},a.prototype.updateStatusMessage=function(){this.statusMessage=this.services.localizationService.get("TenantSettingStatus_"+i.TenantSettingGranularityState[this.granularityState])},a})();i.DataClassificationsController=a})(i=e.controllers||(e.controllers={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){i.DataClassifications={bindings:{viewModel:"="},controller:t.common.createController(e.controllers.DataClassificationsController),templateUrl:"components/dataClassifications/dataClassifications.html"}})(i=e.components||(e.components={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(t){var e;!(function(t){var e=(function(){function t(t,e){}return t.prototype.createOptions=function(){return{additionalServices:[]}},t})();t.TenantMessageController=e})(e=t.controllers||(t.controllers={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){i.TenantMessage={bindings:{viewModel:"<"},controller:t.common.createController(e.controllers.TenantMessageController),templateUrl:"components/tenantMessage/tenantMessage.html"}})(i=e.components||(e.components={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){var n=t.common.constants,a=t.errorDetailsHelper,s=e.constants.TenantSettingsGroupName,o=(function(){function i(i,n){var a=this;this.scope=i,this.services=n,this.scope.tenantSettings=new e.models.TenantSettings,this.scope.isLoading=!0,this.scope.hasChanges=!1,this.scope.dataClassificationToggle={enabled:!1},this.scope.isDataClassificationFeatureEnabled=this.services.featureSwitchService.featureSwitches.dataClassificationEnabled,this.scope.areGranularTenantControlsEnabled=this.services.featureSwitchService.featureSwitches.granularTenantControls;var s=this.services.telemetryService.startEvent(t.telemetry.SettingsGetTenantSettings);this.services.featureSwitchService.featureSwitches.dataClassificationEnabled?this.prepareUnsupportedSettings().then((function(){a.services.adminPortal.getTenantSettingsV2(s.event).then((function(t){a.scope.tenantSettings.featureSwitches=a.filterOutUnsupportedFeaturesSettings(t.featureSwitches),a.scope.tenantSettings.tenantSettingsGroups=a.filterOutUnsupportedFeaturesSettingsFromGroups(t.tenantSettingsGroups),a.scope.tenantSettings.dataClassifications=t.dataClassifications,a.originalSettings=_.cloneDeep(a.scope.tenantSettings),a.scope.dataClassificationToggle.enabled=t.dataClassifications.length>0,a.scope.isLoading=!1}))})):this.prepareUnsupportedSettings().then((function(){a.services.adminPortal.getTenantSettings(s.event).then((function(t){a.scope.tenantSettings.featureSwitches=a.filterOutUnsupportedFeaturesSettings(t),a.originalSettings=_.cloneDeep(a.scope.tenantSettings),a.scope.isLoading=!1}))})),this.scope.updateFormState=function(){return a.updateFormState()},this.scope.applyChanges=function(){return a.applyChanges()},this.scope.cancelChanges=function(){return a.cancelChanges()},this.scope.addDataClassification=function(){return a.addDataClassification()},this.scope.removeDataClassification=function(t){return a.removeDataClassification(t)},this.scope.onDataClassificationToggled=function(){return a.onDataClassificationToggled()},this.scope.setDefaultDataClassification=function(t){return a.setDefaultDataClassification(t)},this.scope.isDashboardGroup=function(t){return a.isDashboardGroup(t)},this.registerRouteStateChangeEvent()}return i.createOptions=function(){return{additionalServices:["adminPortal","appMetadataService","errorService","featureSwitchService","localizationService","notificationToast","navigation","telemetryService"]}},i.prototype.$onDestroy=function(){this.routeStateChangeUnsubscribe()},i.prototype.registerRouteStateChangeEvent=function(){var t=this;this.routeStateChangeUnsubscribe=this.services.rootScope.$on(n.navigation.stateChangeStart,(function(i,n,a,s,o){t.scope.areGranularTenantControlsEnabled&&s&&s.name===e.constants.AdminPortalNavigationStateName&&t.isTenantSettingsFormDirty()&&(t.showSavePrompt(n,a),i.preventDefault())}))},i.prototype.showSavePrompt=function(t,e){var i=this,n=this.services.errorService.control(),a=this.services.localizationService;this.isTenantSettingsFormValid()?n.showPrompt(a.get("AdminPortal_TenantSettings_UnappliedChangesWarning_Title"),a.get("AdminPortal_TenantSettings_UnappliedChangesWarning_Message"),[new InJs.ModalDialogAction(a.get("ModalDialogButtonText_ApplyAll"),function(a,s){n.hideDialog(),i.routeStateChangeUnsubscribe(),i.applyChangesAndNavigateAwayIfSuccess(t,e)}),new InJs.ModalDialogAction(a.get("ModalDialogButtonText_DiscardAll"),function(a,s){n.hideDialog(),i.routeStateChangeUnsubscribe(),i.tenantSettingsForm.$setPristine(),i.navigateAway(t,e)}),new InJs.ModalDialogAction(a.get("ModalDialogButtonText_Cancel"),function(t,e){n.hideDialog()})]):n.showPrompt(a.get("AdminPortal_TenantSettings_UnappliedChangesWithErrors_Title"),a.get("AdminPortal_TenantSettings_UnappliedChangesWithErrors_Message"),[new InJs.ModalDialogAction(a.get("ModalDialogButtonText_FixErrors"),function(t,e){n.hideDialog()}),new InJs.ModalDialogAction(a.get("ModalDialogButtonText_DiscardChanges"),function(a,s){n.hideDialog(),i.routeStateChangeUnsubscribe(),i.tenantSettingsForm.$setPristine(),i.navigateAway(t,e)})])},i.prototype.isTenantSettingsFormDirty=function(){var t=this;return this.getDataClassificationsForm().$dirty||void 0!==_.find(this.scope.tenantSettings.featureSwitches,(function(e){return t.getTenantSettingForm(e.id).$dirty}))},i.prototype.isTenantSettingsFormValid=function(){var t=this;return this.getDataClassificationsForm().validate()&&void 0===_.find(this.scope.tenantSettings.featureSwitches,(function(e){return!t.getTenantSettingForm(e.id).validate()}))},i.prototype.getDataClassificationsForm=function(){return this.tenantSettingsForm["$ctrl."+e.constants.DataClassificationsFormName]},i.prototype.getTenantSettingForm=function(t){return this.tenantSettingsForm["$ctrl."+e.constants.TenantSettingFormName+t]},i.prototype.navigateAway=function(t,e){t&&t.name&&this.services.navigation.stateService.go(t.name,e)},i.prototype.isDashboardGroup=function(t){return t===s.Dashboard},i.prototype.setDefaultDataClassification=function(t){for(var e=0,i=this.scope.tenantSettings.dataClassifications.length;e<i;e++)this.scope.tenantSettings.dataClassifications[e].default=e===t;this.updateFormState()},i.prototype.onDataClassificationToggled=function(){this.scope.dataClassificationToggle.enabled?this.addDataClassification():this.scope.tenantSettings.dataClassifications=[],this.updateFormState()},i.prototype.addDataClassification=function(){var e=this.scope.tenantSettings.dataClassifications;e.push(new t.common.models.DataClassification),1===e.length&&(e[0].default=!0),this.updateFormState()},i.prototype.removeDataClassification=function(t){var e=this.scope.tenantSettings.dataClassifications,i=e[t].default;e.splice(t,1),i&&e.length>0&&(e[0].default=!0),0===e.length&&(this.scope.dataClassificationToggle.enabled=!1),this.updateFormState()},i.prototype.prepareUnsupportedSettings=function(){var t=this;this.unsupportedSettings=[];var i=!1;return this.services.appMetadataService.getAppMetadata().then((function(n){i=n.clusterFeatureSwitches.clusterAuditingEnabled;var a=t.services.featureSwitchService.featureSwitches;a.scriptVisualEnabled||t.unsupportedSettings.push(e.constants.RScriptVisualTenantSwitchId),a.exportReportToPowerPointEnabled||t.unsupportedSettings.push(e.constants.ExportPowerPointTenantSwitchId),a.adminAuditingEnabled&&i||t.unsupportedSettings.push(e.constants.AuditingTenantSwitchId),a.clientUsageMetricsEnabled||t.unsupportedSettings.push(e.constants.UsageMetricsTenantSwitchId),a.artifactSearchTenantAdminSettings||t.unsupportedSettings.push(e.constants.ArtifactSearchTenantSwitchId),a.appsEnabled&&a.appPushDev||t.unsupportedSettings.push(e.constants.AppPushTenantSwitchId),a.authoringCapabilitiesAdminControl||(t.unsupportedSettings.push(e.constants.ContentAuthoringUISwitchId),t.unsupportedSettings.push(e.constants.ImportExternalDataSwitchId)),a.trackUserInfo||t.unsupportedSettings.push(e.constants.UsageMetricsTrackUserLevelInfoSwitchId)}))},i.prototype.filterOutUnsupportedFeaturesSettings=function(t){var e=this;return _.filter(t,(function(t){return e.unsupportedSettings.indexOf(t.id)===-1}))},i.prototype.filterOutUnsupportedFeaturesSettingsFromGroups=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];n.tenantSettings=this.filterOutUnsupportedFeaturesSettings(n.tenantSettings),n.name!==s.ContentAuthoring||this.services.featureSwitchService.featureSwitches.authoringCapabilitiesAdminControl||_.pull(t,n)}return t},i.prototype.updateFormState=function(){this.checkChanges()},i.prototype.applyChanges=function(){var e=this;if(this.scope.hasChanges){for(var i=this.services.notificationToast.notify({title:this.services.localizationService.get("AdminPortal_TenantSettings_Saving_Title"),message:this.services.localizationService.get("AdminPortal_TenantSettings_Saving_Message"),notificationType:t.common.NotificationToastType.Loading}),n=0,a=this.scope.tenantSettings.featureSwitches.length;n<a;n++)this.scope.tenantSettings.featureSwitches[n].contract.isEnabled=this.scope.tenantSettings.featureSwitches[n].isEnabled;var s=this.isDataClassificationSettingChanged();if(!_.isEmpty(this.scope.tenantSettings)){var o=this.services.telemetryService.startEvent(t.telemetry.SettingsUpdateTenantSettings);this.services.featureSwitchService.featureSwitches.dataClassificationEnabled?this.services.adminPortal.updateTenantSettingsConfigV2(this.scope.tenantSettings,o.event).then((function(){e.services.notificationToast.hide(i);for(var n=function(i,n){var a=e.scope.tenantSettings.featureSwitches[i],s=_.find(e.originalSettings.featureSwitches,(function(t){return t.id===a.id}));a.isEnabled!==s.isEnabled&&(s.isEnabled=a.isEnabled,e.services.telemetryService.logEvent(t.telemetry.SettingsUpdateTenantSetting,a.name,a.isEnabled,!1,!1,!1),e.services.notificationToast.notify({title:e.getSaveSuccessTitle(a),message:e.services.localizationService.get("AdminPortal_TenantSettings_Success_Message"),notificationType:t.common.NotificationToastType.Success}))},a=0,r=e.scope.tenantSettings.featureSwitches.length;a<r;a++)n(a,r);s&&(e.services.telemetryService.logEvent(t.telemetry.SettingsUpdateTenantSetting,"dataClassification",e.scope.tenantSettings.dataClassifications.length>0,!1,!1,!1),e.services.notificationToast.notify({title:e.services.localizationService.get("AdminPortal_TenantSettings_DataClassification_Changed"),message:e.services.localizationService.get("AdminPortal_TenantSettings_Success_Message"),notificationType:t.common.NotificationToastType.Success})),e.originalSettings.dataClassifications=_.cloneDeep(e.scope.tenantSettings.dataClassifications),o.resolve()}),(function(){e.services.notificationToast.hide(i),e.services.notificationToast.notify({title:e.services.localizationService.get("AdminPortal_TenantSettings_Failure_Title"),message:e.services.localizationService.get("AdminPortal_TenantSettings_Failure_Message"),
notificationType:t.common.NotificationToastType.Error}),o.reject()})).finally((function(){e.checkChanges()})):this.services.adminPortal.updateTenantSettingsConfig(this.scope.tenantSettings.featureSwitches,o.event).then((function(){e.services.notificationToast.hide(i);for(var n=function(i,n){var a=e.scope.tenantSettings.featureSwitches[i],s=_.find(e.originalSettings.featureSwitches,(function(t){return t.id===a.id}));a.isEnabled!==s.isEnabled&&(s.isEnabled=a.isEnabled,e.services.telemetryService.logEvent(t.telemetry.SettingsUpdateTenantSetting,a.name,a.isEnabled,!1,!1,!1),e.services.notificationToast.notify({title:e.getSaveSuccessTitle(a),message:e.services.localizationService.get("AdminPortal_TenantSettings_Success_Message"),notificationType:t.common.NotificationToastType.Success}))},a=0,s=e.scope.tenantSettings.featureSwitches.length;a<s;a++)n(a,s);e.originalSettings.dataClassifications=_.cloneDeep(e.scope.tenantSettings.dataClassifications),o.resolve()}),(function(){e.services.notificationToast.hide(i),e.services.notificationToast.notify({title:e.services.localizationService.get("AdminPortal_TenantSettings_Failure_Title"),message:e.services.localizationService.get("AdminPortal_TenantSettings_Failure_Message"),notificationType:t.common.NotificationToastType.Error}),o.reject()})).finally((function(){e.checkChanges()}))}}},i.prototype.applyChangesAndNavigateAwayIfSuccess=function(e,i){return __awaiter(this,void 0,t.Promise,(function(){var n,s,o,r,l,c,d,u,g=this;return __generator(this,(function(p){switch(p.label){case 0:n=this.services.notificationToast.notify({title:this.services.localizationService.get("AdminPortal_TenantSettings_Saving_Title"),message:this.services.localizationService.get("AdminPortal_TenantSettings_Saving_Message"),notificationType:t.common.NotificationToastType.Loading}),s=this.services.telemetryService.startEvent(t.telemetry.SettingsUpdateTenantSettings),o=this.getDataClassificationsForm().$dirty?this.scope.tenantSettings.dataClassifications:void 0,r=_.filter(this.scope.tenantSettings.featureSwitches,(function(t){return g.getTenantSettingForm(t.id).$dirty})),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.services.adminPortal.updateTenantSettingsAndDataClassifications(r,o,s.event)];case 2:for(p.sent(),this.services.notificationToast.hide(n),this.services.notificationToast.notify({title:this.services.localizationService.get("TenantSetting_SavingSucceededNotification_Title"),message:this.services.localizationService.get("TenantSetting_SavingNotification_Message"),notificationType:t.common.NotificationToastType.Success}),l=0,c=r;l<c.length;l++)d=c[l],this.services.telemetryService.logEvent(t.telemetry.SettingsUpdateTenantSetting,d.name,d.isEnabled,d.isGranular,d.allowedSecurityGroups&&!_.isEmpty(d.allowedSecurityGroups.inputUserList),d.deniedSecurityGroups&&!_.isEmpty(d.deniedSecurityGroups.inputUserList));return o&&this.services.telemetryService.logEvent(t.telemetry.SettingsUpdateDataClassifications,o.length),s.resolve(),this.tenantSettingsForm.$setPristine(),this.navigateAway(e,i),[3,4];case 3:return u=p.sent(),this.services.notificationToast.hide(n),this.services.errorService.error(this.services.localizationService.get("AdminPortal_TenantSettings_Failure_Message"),"FailedToApplyTenantSettingsChanges",{requestId:u.requestId,statusCode:u.status.toString()}),s.reject(a.getTelemetryErrorDetails(u.error,u.status)),[3,4];case 4:return[2]}}))}))},i.prototype.cancelChanges=function(){_.isEmpty(this.scope.tenantSettings)||(this.scope.tenantSettings=_.cloneDeep(this.originalSettings),this.scope.dataClassificationToggle.enabled=this.scope.tenantSettings.dataClassifications.length>0),this.scope.hasChanges=!1},i.prototype.checkChanges=function(){this.scope.hasChanges=!1;for(var t=function(t,i){var n=e.scope.tenantSettings.featureSwitches[t],a=_.find(e.originalSettings.featureSwitches,(function(t){return t.id===n.id}));if(n.isEnabled!==a.isEnabled)return e.scope.hasChanges=!0,{value:void 0}},e=this,i=0,n=this.scope.tenantSettings.featureSwitches.length;i<n;i++){var a=t(i,n);if("object"==typeof a)return a.value}if(this.isDataClassificationSettingChanged()){this.scope.hasChanges=!0;for(var s={},o=0,i=0,n=this.scope.tenantSettings.dataClassifications.length;i<n;i++){var r=this.scope.tenantSettings.dataClassifications[i];if(!r.name||!r.shortHand||r.shortHand.length>4)return void(this.scope.hasChanges=!1);if(r.url&&0!==r.url.indexOf("http://")&&r.url.indexOf("https://"))return void(this.scope.hasChanges=!1);r.default&&o++,s[r.shortHand]=s[r.shortHand]?s[r.shortHand]+1:1}if(this.scope.tenantSettings.dataClassifications.length>0&&1!==o)return void(this.scope.hasChanges=!1);for(var l in s)if(s[l]>1)return void(this.scope.hasChanges=!1)}},i.prototype.isDataClassificationSettingChanged=function(){if(this.scope.tenantSettings.dataClassifications.length!==this.originalSettings.dataClassifications.length)return!0;for(var t=function(t,i){var n=e.scope.tenantSettings.dataClassifications[t],a=_.find(e.originalSettings.dataClassifications,(function(t){return t.id===n.id}));for(var s in n)if("$$hashKey"!==s&&void 0!==a[s]&&n[s]!==a[s])return{value:!0}},e=this,i=0,n=this.scope.tenantSettings.dataClassifications.length;i<n;i++){var a=t(i,n);if("object"==typeof a)return a.value}return!1},i.prototype.getSaveSuccessTitle=function(t){if(t)return this.services.localizationService.format("AdminPortal_TenantSettings_Success_RadioButton_Title",[t.name,t.isEnabled?this.services.localizationService.get("AdminPortal_TenantSettings_ButtonText_Enabled"):this.services.localizationService.get("AdminPortal_TenantSettings_RadioButton_Disabled")])},i})();i.TenantSettingsContainerController=o})(i=e.controllers||(e.controllers={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){i.TenantSettingsContainer={controller:t.common.createController(e.controllers.TenantSettingsContainerController),templateUrl:"components/tenantSettingsContainer/tenantSettingsContainer.html"}})(i=e.components||(e.components={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){var n,a=e.models.AdminPortalModelFactory,s=t.errorDetailsHelper,o=t.common.models.EmailsListModel;!(function(t){t[t.Disabled=1]="Disabled",t[t.EnabledForEntireOrganization=2]="EnabledForEntireOrganization",t[t.EnabledForSpecificSecurityGroups=3]="EnabledForSpecificSecurityGroups"})(n=i.TenantSettingGranularityState||(i.TenantSettingGranularityState={}));var r=(function(){function i(t,e){this.services=e}return i.createOptions=function(){return{additionalServices:["adminPortal","errorService","featureSwitchService","localizationService","notificationToast","telemetryService"]}},i.prototype.$onInit=function(){this.showDetails=!1,this.refreshTenantSettingForm()},i.prototype.$postLink=function(){var t=this;this.tenantSettingForm=this[this.getFormName()],this.tenantSettingForm.validate=function(){return t.validateTenantSettingForm(t.services.localizationService)}},i.prototype.getFormName=function(){return e.constants.TenantSettingFormName+this.viewModel.id},i.prototype.toggleDetailsView=function(){this.showDetails=!this.showDetails},i.prototype.onEnabledToggleChange=function(){this.viewModel.isEnabled||(this.viewModel.allowedSecurityGroups=new o,this.viewModel.deniedSecurityGroups=new o),this.refreshTenantSettingForm()},i.prototype.onDeniedSecurityGroupsCheckboxChanged=function(){this.deniedSecurityGroupsEnabled||(this.viewModel.deniedSecurityGroups=new o)},i.prototype.onRadioGroupSelectionChanged=function(){this.granularityState===n.EnabledForEntireOrganization&&(this.viewModel.allowedSecurityGroups=new o)},i.prototype.applyChanges=function(){return __awaiter(this,void 0,t.Promise,(function(){var e,i,n,a,o,r;return __generator(this,(function(l){switch(l.label){case 0:if(e=this.services.localizationService,!this.validateTenantSettingForm(e))return[2];i=this.services.notificationToast.notify({title:e.get("TenantSetting_SavingNotification_Title"),message:e.get("TenantSetting_SavingNotification_Message"),notificationType:t.common.NotificationToastType.Loading}),n=this.viewModel,a=this.services.telemetryService.startEvent(t.telemetry.SettingsUpdateTenantSetting,n.name,n.isEnabled,n.isGranular,this.hasAllowedSecurityGroups(),this.hasDeniedSecurityGroups()),o=_.cloneDeep(this.viewModel.contract),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.services.adminPortal.updateTenantSetting(n,a.event)];case 2:return l.sent(),this.services.notificationToast.hide(i),this.services.notificationToast.notify({title:e.get("TenantSetting_SavingSucceededNotification_Title"),message:e.get("TenantSetting_SavingNotification_Message"),notificationType:t.common.NotificationToastType.Success}),a.resolve(),[3,4];case 3:return r=l.sent(),this.services.notificationToast.hide(i),this.viewModel.contract=o,this.services.errorService.error(this.services.localizationService.get("TenantSetting_SavingFailedNotification_Message"),"FailedToApplyTenantSettingsChanges",{requestId:r.requestId,statusCode:r.status.toString()}),a.reject(s.getTelemetryErrorDetails(r.error,r.status)),[3,4];case 4:return this.refreshTenantSettingForm(),this.tenantSettingForm.$setPristine(),[2]}}))}))},i.prototype.cancelChanges=function(){this.viewModel=a.convertTenantSetting(this.viewModel.contract,this.services.localizationService),this.refreshTenantSettingForm(),this.tenantSettingForm.$setPristine()},i.prototype.showDisabledInfoMessage=function(){return this.viewModel.disabledInfoMessage&&this.tenantSettingForm.$dirty&&!this.viewModel.isEnabled},i.prototype.showRetroactiveDisable=function(){return this.services.featureSwitchService.featureSwitches.usageMetricsRetroactiveDisable&&this.tenantSettingForm.$dirty&&!_.isEmpty(this.viewModel.retroactiveDisableMessage)},i.prototype.showEnabledForSecurityGroupsInfoMessage=function(){return this.viewModel.enabledForSecurityGroupsInfoMessage&&(this.granularityState===n.EnabledForSpecificSecurityGroups||this.deniedSecurityGroupsEnabled)},i.prototype.validateTenantSettingForm=function(t){var e=this.viewModel.allowedSecurityGroups,i=this.viewModel.deniedSecurityGroups;if(this.granularityState===n.EnabledForSpecificSecurityGroups&&e.validationTrigger&&!e.validationTrigger())return!1;if(this.deniedSecurityGroupsEnabled&&i.validationTrigger&&!i.validationTrigger())return!1;if(this.granularityState===n.EnabledForSpecificSecurityGroups&&this.deniedSecurityGroupsEnabled)for(var a=_.map(e.inputUserList,(function(t){return t.objectId})),s=_.map(i.inputUserList,(function(t){return t.objectId})),o=_.zipObject(s,s),r=0,l=a;r<l.length;r++){var c=l[r];if(o[c])return i.errorMessage=t.get("TenantSetting_DuplicateAllowedAndDeniedSecurityGroup"),i.hasValidationError=!0,!1}return!0},i.prototype.refreshTenantSettingForm=function(){this.updateGranularityState(),this.updateStatusMessage(),this.updateDeniedSecurityGroupsEnabled()},i.prototype.updateDeniedSecurityGroupsEnabled=function(){this.deniedSecurityGroupsEnabled=this.hasDeniedSecurityGroups()},i.prototype.updateGranularityState=function(){this.viewModel.isEnabled?this.hasAllowedSecurityGroups()?this.granularityState=n.EnabledForSpecificSecurityGroups:this.granularityState=n.EnabledForEntireOrganization:this.granularityState=n.Disabled},i.prototype.updateStatusMessage=function(){var t=this.services.localizationService;this.granularityState===n.EnabledForEntireOrganization&&this.hasDeniedSecurityGroups()?this.statusMessage=t.get("TenantSettingStatus_EnabledForSpecificSecurityGroups"):this.statusMessage=t.get("TenantSettingStatus_"+n[this.granularityState])},i.prototype.hasAllowedSecurityGroups=function(){return this.viewModel.allowedSecurityGroups&&!_.isEmpty(this.viewModel.allowedSecurityGroups.inputUserList)},i.prototype.hasDeniedSecurityGroups=function(){return this.viewModel.deniedSecurityGroups&&!_.isEmpty(this.viewModel.deniedSecurityGroups.inputUserList)},i})();i.TenantSettingController=r})(i=e.controllers||(e.controllers={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){i.TenantSetting={bindings:{viewModel:"<"},controller:t.common.createController(e.controllers.TenantSettingController),templateUrl:"components/tenantSetting/tenantSetting.html"}})(i=e.components||(e.components={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(t){var e;!(function(t){var e=(function(){function t(t,e){this.scope=t,this.services=e,this.scope.o365AdminUserPageUrl=window.o365AdminUserPageUrl}return t.createOptions=function(){return{additionalServices:["errorService","localizationService","adminPortal"]}},t})();t.ManageUsersController=e})(e=t.controllers||(t.controllers={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){var i;!(function(i){i.ManageUsers={controller:t.common.createController(e.controllers.ManageUsersController),templateUrl:"components/manageUsers/manageUsers.html"}})(i=e.components||(e.components={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(t){var e;!(function(t){t.UsageMetrics={templateUrl:"components/usageMetrics/usageMetrics.html"}})(e=t.components||(t.components={}))})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){function i(t,e,i,n,s){return new a(t,e,i,n,s)}var n=t.common.contracts.GroupType;e.createAdminPortalService=i;var a=(function(){function i(t,e,i,n,a){this.promiseFactory=t,this.adminPortalHttpService=e,this.localizationService=i,this.telemetryService=n}return i.prototype.getTenantSettings=function(t){var i=this,n=this.promiseFactory.defer();return this.adminPortalHttpService.getTenantSettings(t).then((function(t){n.resolve(e.models.AdminPortalModelFactory.convertTenantSettings(t.data,i.localizationService))}),(function(t){n.reject(t)})),n.promise},i.prototype.updateTenantSettingsConfig=function(t,e){var i=this.promiseFactory.defer();return this.adminPortalHttpService.updateTenantSettingsConfig(t.map((function(t){return t.contract})),e).then((function(t){i.resolve(t)}),(function(t){i.reject(t)})),i.promise},i.prototype.getTenantSettingsV2=function(t){var i=this,n=this.promiseFactory.defer();return this.adminPortalHttpService.getTenantSettingsV2(t).then((function(t){n.resolve(e.models.AdminPortalModelFactory.convertTenantSettingsV2(t.data,i.localizationService))}),(function(t){n.reject(t)})),n.promise},i.prototype.updateTenantSettingsConfigV2=function(t,e){var i={featureSwitches:t.featureSwitches.map((function(t){return t.contract})),dataClassifications:t.dataClassifications};return this.adminPortalHttpService.updateTenantSettingsConfigV2(i,e)},i.prototype.updateTenantSetting=function(t,e){var i=this,n={featureSwitches:_.map([t],(function(t){return i.updateAndGetTenantSettingContract(t)})),dataClassifications:void 0};return this.adminPortalHttpService.updateTenantSettingsConfigV2(n,e)},i.prototype.updateDataClassifications=function(t,e){var i={featureSwitches:[],dataClassifications:t};return this.adminPortalHttpService.updateTenantSettingsConfigV2(i,e)},i.prototype.updateTenantSettingsAndDataClassifications=function(t,e,i){var n=this,a={featureSwitches:_.map(t,(function(t){return n.updateAndGetTenantSettingContract(t)})),dataClassifications:e};return this.adminPortalHttpService.updateTenantSettingsConfigV2(a,i)},i.prototype.refreshAndGetAdminUserMetadata=function(){if(!this._userMetadataPromise){var e=this.promiseFactory.defer(),i=this.telemetryService.startEvent(t.telemetry.DashboardRefreshAndGetUserMetadata);this.adminPortalHttpService.refreshAndGetAdminUserMetadata(i.event).then((function(t){e.resolve(t.data),i.resolve()}),(function(){e.reject(),i.reject()})),this._userMetadataPromise=e.promise}return this._userMetadataPromise},i.prototype.updateAndGetTenantSettingContract=function(t){return t.contract.isEnabled=t.isEnabled,t.contract.allowedSecurityGroups=this.createSecurityGroupsContracts(t.allowedSecurityGroups),t.contract.deniedSecurityGroups=this.createSecurityGroupsContracts(t.deniedSecurityGroups),t.contract.retroactiveDisable=t.retroactiveDisable,t.contract},i.prototype.createSecurityGroupsContracts=function(t){var e=this;return _.map(t.inputUserList,(function(t){return e.createSecurityGroupContract(t)}))},i.prototype.createSecurityGroupContract=function(t){return{id:t.objectId,name:t.displayName,emailAddress:t.userPrincipalName,isEmailEnabled:t.groupType===n.EmailEnabledSecurityGroup}},i})()})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var e;!(function(e){function i(){return new n}e.createAdminPortalHttpService=i;var n=(function(){function e(){}return e.prototype.getAdminUsageGroupMetadata=function(e,i){var n=t.common.httpService.powerbiRequestOptions(i,"GetAdminGroupContainer",{isAdminRequest:!0,groupObjectIdOverride:e});return t.common.httpService.get("powerbi/metadata/admingroupmetadata/",n)},e.prototype.getAdminUsageDashboardMetadata=function(e,i,n){var a=t.common.httpService.powerbiRequestOptions(n,"GetAdminUsageDashboardMetadata",{isAdminRequest:!0,groupObjectIdOverride:i});return t.common.httpService.get("powerbi/metadata/dashboards/"+e,a)},e.prototype.batchGetAdminUsageTiles=function(e,i,n,a){var s=t.common.httpService.powerbiRequestOptions(a,"BatchGetAdminUsageTiles",{isAdminRequest:!0,groupObjectIdOverride:n});return s.enableTelemetry=!0,t.common.httpService.post("powerbi/metadata/dashboard/"+e+"/tiles",JSON.stringify(i),s)},e.prototype.createAdminUsageDashboard=function(e,i){var n=t.common.httpService.powerbiRequestOptions(i,"createAdminUsageDashboard",{isAdminRequest:!0,groupObjectIdOverride:e});return t.common.httpService.get("powerbi/content/providers/adminportal/usage/",n)},e.prototype.getTenantSettings=function(e){var i=t.common.httpService.powerbiRequestOptions(e,"GetTenantSettings",{isAdminRequest:!0});return i.enableTelemetry=!0,t.common.httpService.get("/powerbi/flight/tenantswitches",i)},e.prototype.updateTenantSettingsConfig=function(e,i){var n=t.common.httpService.powerbiRequestOptions(i,"UpdateTenantSettings",{isAdminRequest:!0});return n.enableTelemetry=!0,t.common.httpService.post("/powerbi/flight/tenantswitches",{switches:e},n)},e.prototype.getTenantSettingsV2=function(e){var i=t.common.httpService.powerbiRequestOptions(e,"GetTenantSettings",{isAdminRequest:!0});return i.enableTelemetry=!0,t.common.httpService.get("/metadata/tenantsettings",i)},e.prototype.updateTenantSettingsConfigV2=function(e,i){var n=t.common.httpService.powerbiRequestOptions(i,"UpdateTenantSettings",{isAdminRequest:!0});return n.enableTelemetry=!0,t.common.httpService.put("/metadata/tenantsettings",e,n)},e.prototype.refreshAndGetAdminUserMetadata=function(e){var i=t.common.httpService.powerbiRequestOptions(e,"RefreshAndGetAdminUserMetadata",{isAdminRequest:!0,dismissGroupObjectId:!0});return t.common.httpService.put("powerbi/metadata/refreshusermetadata",null,i)},e})()})(e=t.adminPortal||(t.adminPortal={}))})(powerbi||(powerbi={})),angular.module("powerbi.adminPortal").run(["$templateCache",function(t){t.put("components/adminPortal/adminPortal.html",'<div class="sliderContentView adminPortal"><div class="header label-xl"><span localize="AdminPortal_Title"></span></div><div class="adminPortalSpinner" ng-if="$ctrl.adminCapacityEnabled && !$ctrl.showOptionsList"><spinner class="centered xlarge"></spinner><div class="spinnerInfo" localize="Loading_Text"></div></div><div class="content" ng-if="$ctrl.showOptionsList"><div class="adminPortalLeftColumn"><ul class="contentOption"><li class="option label-med" ng-repeat="option in $ctrl.options track by option.type" ng-mousedown="$ctrl.onActiveOptionChanged(option.type)" ng-class="{selected: $ctrl.getCurrentAdminPortalSettingsTab() === option.type}" ng-if="$ctrl.isOptionAllowed(option)"><span ng-bind="::option.displayName"></span></li></ul></div><div class="adminPortalRightColumn" ng-switch="$ctrl.getCurrentAdminPortalSettingsTab()"><usage-metrics class="contentPane" ng-switch-when="1"></usage-metrics><manage-users class="contentPane" ng-switch-when="2"></manage-users><auditing class="contentPane" ng-switch-when="3" ng-if="::$ctrl.adminAuditingEnabled"></auditing><tenant-settings-container class="contentPane" ng-switch-when="4"></tenant-settings-container><capacity-admin-container class="contentPane" ng-switch-when="5" ng-if="::$ctrl.adminCapacityEnabled"></capacity-admin-container><div ng-switch-when="6" pbi-lazy-load-contents="$ctrl.embedCodesModuleConfig"><embed-codes class="contentPane"></embed-codes></div></div></div></div>'),t.put("components/auditing/auditing.html",'<div class="auditing"><div class="title label-xl trimmedTextWithEllipsis" localize="AdminPortal_Auditing_Title" localize-tooltip="AdminPortal_Auditing_Title"></div><div class="subtitle label-med trimmedTextWithEllipsis"><span localize="AdminPortal_Auditing_SubtitleV2" localize-fragments><pbi-link fragment-index="0" guid="823102" label="LearnMore"></pbi-link></span></div><div class="goToButton"><a class="btn primary" localize="AdminPortal_Auditing_ButtonText" ng-click="auditingPageLanding()"></a></div></div>'),t.put("components/dataClassifications/dataClassifications.html",'<ng-form name="{{::(\'$ctrl.\' + $ctrl.getFormName())}}"><div class="titleContainer" ng-click="$ctrl.toggleDetailsView()"><i class="glyphicon detailsViewExpander" ng-class="$ctrl.showDetails ? \'pbi-glyph-caretdownright\': \'pbi-glyph-caretright\'"></i><div class="tenantSettingTitle"><header class="displayName" localize="AdminPortal_TenantSettings_DataClassification_Title"></header><header class="statusMessage" ng-bind="$ctrl.statusMessage" ng-if="!$ctrl.dataClassificationsForm.$dirty"></header><header class="statusMessage unappliedChanges" localize="TenantSettingStatus_UnappliedChanges" ng-if="$ctrl.dataClassificationsForm.$dirty"></header></div></div><div class="details" ng-if="$ctrl.showDetails"><header class="description" localize="AdminPortal_TenantSettings_DataClassification_Description"></header><pbi-toggle class="toggleAction" ng-model="$ctrl.isEnabled" ng-change="$ctrl.onDataClassificationToggled()" no-label on-state-text="Enabled" off-state-text="Disabled"></pbi-toggle><div class="dataClassificationContainer" ng-if="$ctrl.isEnabled"><table pbi-table pbi-table-config="$ctrl.tableConfig"><tr ng-repeat="item in $ctrl.viewModel"><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Default" class="default"><div class="pbi-input"> <input type="radio" name="dataClassification" ng-model="item.default" ng-value="true" ng-change="$ctrl.setDefaultDataClassification($index)"><label class="form-label label-med"></label></div></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Classification" class="name"> <input type="text" ng-model="item.name"/></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Shorthand" class="shorthand"> <input type="text" maxlength="4" ng-model="item.shortHand"/></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_ShowTag" class="showTag"><pbi-checkbox label="test" ng-model="item.showTag" localize-tooltip="AdminPortal_TenantSettings_DataClassification_ShowTagTooltip"></pbi-checkbox></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_URL"> <input type="text" ng-model="item.url"/></td><td class="remove"> <button ng-click="$ctrl.removeDataClassification($index)"><i class="glyphicon pbi-glyph-delete glyph-small"></i></button></td></tr></table> <button class="add" ng-click="$ctrl.addDataClassification()"><i class="glyphicon pbi-glyph-add glyph-small"></i><span localize="AdminPortal_TenantSettings_DataClassification_AddItem"></span></button></div><div class="nonGranularErrorMessageContainer" ng-if="$ctrl.errorMessage"><i class="glyphicon glyph-small pbi-glyph-error"></i><span class="errorMessage" ng-bind="$ctrl.errorMessage"></span></div><div class="applyButtonContainer"><pbi-button class="applyChangesButton" label="PBI_Button_Label_Apply" primary="true" ng-click="$ctrl.applyChanges()" ng-disabled="!$ctrl.dataClassificationsForm.$dirty"></pbi-button><pbi-button class="cancelChangesButton" label="PBI_Button_Label_Cancel" ng-click="$ctrl.cancelChanges()" ng-disabled="!$ctrl.dataClassificationsForm.$dirty"></pbi-button></div><div class="nonGranularInfoMessageContainer"><i class="glyphicon glyph-small pbi-glyph-info"></i><span class="infoMessage" localize="TenantSetting_NonGranularInfoMessage"></span></div></div></ng-form>'),t.put("components/manageUsers/manageUsers.html",'<div class="manageUsers"><div class="title label-xl trimmedTextWithEllipsis" localize="AdminPortal_ManageUsers_Title" localize-tooltip="AdminPortal_ManageUsers_Title"></div><div class="subtitle label-med trimmedTextWithEllipsis" localize="AdminPortal_ManageUsers_Subtitle" localize-tooltip="AdminPortal_ManageUsers_Subtitle"></div><div class="goToButton"><a class="btn primary" localize="AdminPortal_ManageUsers_ButtonText" ng-href="{{::o365AdminUserPageUrl}}" target="_blank"></a></div></div>'),t.put("components/tenantMessage/tenantMessage.html",'<div class="infoMessageContainer" ng-class="$ctrl.viewModel.isAlert ? \'privacyInfoMessage\' : \'guidanceInfoMessage\'"><i class="glyphicon glyph-small" ng-class="$ctrl.viewModel.isAlert ? \'pbi-glyph-securityalert\' : \'pbi-glyph-info\'"></i><div class="infoMessage" ng-switch="$ctrl.viewModel.fragments.length"><span ng-switch-when="1" localize="{{::$ctrl.viewModel.message}}" localize-fragments><a fragment-index="0" localize="$ctrl.viewModel.fragments[0].key" target="_blank" href="{{::$ctrl.viewModel.fragments[0].url}}"/></span><span ng-switch-when="2" localize="{{::$ctrl.viewModel.message}}" localize-fragments><a fragment-index="0" localize="$ctrl.viewModel.fragments[0].key" target="_blank" href="{{::$ctrl.viewModel.fragments[0].url}}"/><a fragment-index="1" localize="$ctrl.viewModel.fragments[1].key" target="_blank" href="{{::$ctrl.viewModel.fragments[1].url}}"/></span><span ng-switch-when="3" localize="{{::$ctrl.viewModel.message}}" localize-fragments><a fragment-index="0" localize="$ctrl.viewModel.fragments[0].key" target="_blank" href="{{::$ctrl.viewModel.fragments[0].url}}"/><a fragment-index="1" localize="$ctrl.viewModel.fragments[1].key" target="_blank" href="{{::$ctrl.viewModel.fragments[1].url}}"/><a fragment-index="2" localize="$ctrl.viewModel.fragments[2].key" target="_blank" href="{{::$ctrl.viewModel.fragments[2].url}}"/></span><span ng-switch-default localize="{{::$ctrl.viewModel.message}}"/></div></div>'),t.put("components/tenantSetting/tenantSetting.html",'<ng-form name="{{::(\'$ctrl.\' + $ctrl.getFormName())}}"><div class="titleContainer" ng-click="$ctrl.toggleDetailsView()"><i class="glyphicon detailsViewExpander" ng-class="$ctrl.showDetails ? \'pbi-glyph-caretdownright\' : \'pbi-glyph-caretright\'"></i><div class="tenantSettingTitle"><header class="displayName" ng-bind="::$ctrl.viewModel.displayName"></header><header class="statusMessage" ng-bind="$ctrl.statusMessage" ng-if="!$ctrl.tenantSettingForm.$dirty"></header><header class="statusMessage unappliedChanges" localize="TenantSettingStatus_UnappliedChanges" ng-if="$ctrl.tenantSettingForm.$dirty"></header></div></div><div class="details" ng-if="$ctrl.showDetails"><header class="description" ng-bind="$ctrl.viewModel.description"></header><pbi-toggle class="toggleAction" ng-model="$ctrl.viewModel.isEnabled" ng-change="$ctrl.onEnabledToggleChange()" no-label on-state-text="Enabled" off-state-text="Disabled"></pbi-toggle><div class="infoMessageContainer guidanceInfoMessage" ng-if="$ctrl.showDisabledInfoMessage()"><i class="glyphicon glyph-small pbi-glyph-info"></i><div class="infoMessage" ng-bind="::$ctrl.viewModel.disabledInfoMessage"></div></div><tenant-message view-model="$ctrl.viewModel.privacy" ng-if="::$ctrl.viewModel.privacy"></tenant-message><div class="granularityControl" ng-if="$ctrl.viewModel.isEnabled && $ctrl.viewModel.isGranular"><div class="applyToRadioGroup"><pbi-radio-group ng-model="$ctrl.granularityState" label="TenantSetting_ApplyTo" ng-change="$ctrl.onRadioGroupSelectionChanged()"><pbi-radio label="TenantSetting_ApplyTo_EntireOrganization" ng-value="2"></pbi-radio><pbi-radio label="TenantSetting_ApplyTo_SpecificSecurityGroups" ng-value="3"></pbi-radio></pbi-radio-group></div><emails-list id="allowedSecurityGroupsBox" class="securityGroupsBox" view-model="$ctrl.viewModel.allowedSecurityGroups" ng-if="$ctrl.granularityState == 3" block-users="true" allow-object-ids="true" allow-security-groups="true"></emails-list><pbi-checkbox class="deniedSecurityGroupsCheckbox" label="TenantSetting_ExceptSpecificSecurityGroups" ng-model="$ctrl.deniedSecurityGroupsEnabled" ng-change="$ctrl.onDeniedSecurityGroupsCheckboxChanged()"></pbi-checkbox><emails-list id="deniedSecurityGroupsBox" class="securityGroupsBox" ng-if="$ctrl.deniedSecurityGroupsEnabled" view-model="$ctrl.viewModel.deniedSecurityGroups" block-users="true" allow-object-ids="true" allow-security-groups="true"></emails-list><div class="infoMessageContainer guidanceInfoMessage" ng-if="$ctrl.showEnabledForSecurityGroupsInfoMessage()"><i class="glyphicon glyph-small pbi-glyph-info"></i><div class="infoMessage" ng-bind="::$ctrl.viewModel.enabledForSecurityGroupsInfoMessage"></div></div></div><fieldset class="retro-container" ng-if="$ctrl.showRetroactiveDisable()"><pbi-checkbox class="retro-checkbox" label="TenantSetting_{{::$ctrl.viewModel.name}}_RetroactiveDisable_Message" ng-model="$ctrl.viewModel.retroactiveDisable"></pbi-checkbox><tenant-message view-model="$ctrl.viewModel.retroactiveDisableDescription" ng-if="$ctrl.viewModel.retroactiveDisable"></tenant-message></fieldset><div class="applyButtonContainer"><pbi-button class="applyChangesButton" label="PBI_Button_Label_Apply" primary="true" ng-click="$ctrl.applyChanges()" ng-disabled="!$ctrl.tenantSettingForm.$valid || !$ctrl.tenantSettingForm.$dirty"></pbi-button><pbi-button class="cancelChangesButton" label="PBI_Button_Label_Cancel" ng-click="$ctrl.cancelChanges()" ng-disabled="!$ctrl.tenantSettingForm.$valid || !$ctrl.tenantSettingForm.$dirty"></pbi-button></div><div class="nonGranularInfoMessageContainer" ng-if="::!$ctrl.viewModel.isGranular"><i class="glyphicon glyph-small pbi-glyph-info"></i><span class="infoMessage" localize="TenantSetting_NonGranularInfoMessage"></span></div></div></ng-form>'),t.put("components/tenantSettingsContainer/tenantSettingsContainer.html",'<div class="tenantSettingsContainer"><spinner class="centered" ng-show="isLoading"></spinner><div class="title label-xl" ng-if="::!areGranularTenantControlsEnabled" localize="AdminPortal_TenantSettings_Title" localize-tooltip="AdminPortal_TenantSettings_Title"></div><div class="settingsContent {{::areGranularTenantControlsEnabled ? \'\' : \'nonGranularSettings\'}}" ng-if="!isLoading"><div class="nonGranularTenantSettingsContainer" ng-if="::!areGranularTenantControlsEnabled" ng-repeat="featureSwitch in tenantSettings.featureSwitches"><div class="radioButton"><div class="radioButtonTitle label-med" ng-bind="::featureSwitch.displayName"></div><div class="radioButtonContainer"><div class="pbi-input"> <input type="radio" ng-model="featureSwitch.isEnabled" ng-value="true" ng-change="updateFormState()"><label class="form-label label-med" localize="ToggleSwitchOn"></label></div><div class="pbi-input"> <input type="radio" ng-model="featureSwitch.isEnabled" ng-value="false" ng-change="updateFormState()"><label class="form-label label-med" localize="ToggleSwitchOff"></label></div></div><div class="radioButtonPrivacy label-med" ng-if="::featureSwitch.privacy" ng-bind="::featureSwitch.privacy"></div></div></div><ng-form name="$ctrl.tenantSettingsForm" class="granularTenantSettingsContainer" ng-if="::areGranularTenantControlsEnabled"><div class="tenantSettingsGroup" ng-class="::{lastDivider: $last}" ng-repeat="tenantSettingsGroup in ::tenantSettings.tenantSettingsGroups"><div class="groupTitle" ng-bind="::tenantSettingsGroup.displayName"></div><div class="tenantSettingContainer" ng-repeat="tenantSetting in tenantSettingsGroup.tenantSettings"><tenant-setting view-model="tenantSetting"></tenant-setting></div><x-data-classifications view-model="tenantSettings.dataClassifications" ng-if="isDataClassificationFeatureEnabled && isDashboardGroup(tenantSettingsGroup.name)"></x-data-classifications><hr ng-if="::!$last"/></div></ng-form><div class="nonGranularTenantSettingsContainer dataClassificationSwitchContainer" ng-if="isDataClassificationFeatureEnabled && !areGranularTenantControlsEnabled"><div class="radioButton"><div class="radioButtonTitle label-med"><span localize="AdminPortal_TenantSettings_DataClassification_Title"></span><i class="glyphicon pbi-glyph-info glyph-small" localize-tooltip="AdminPortal_TenantSettings_DataClassification_RadioButtonTooltip"></i></div><div class="radioButtonContainer"><div class="pbi-input"> <input type="radio" ng-model="dataClassificationToggle.enabled" ng-value="true" ng-change="onDataClassificationToggled()"><label class="form-label label-med" localize="ToggleSwitchOn"></label></div><div class="pbi-input"> <input type="radio" ng-model="dataClassificationToggle.enabled" ng-value="false" ng-change="onDataClassificationToggled()"><label class="form-label label-med" localize="ToggleSwitchOff"></label></div></div></div></div><div class="dataClassificationContainer nonGranularTenantSettingsContainer" ng-if="isDataClassificationFeatureEnabled && dataClassificationToggle.enabled && !areGranularTenantControlsEnabled"><table pbi-table pbi-table-config="$ctrl.tableConfig"><tr ng-repeat="item in tenantSettings.dataClassifications"><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Default" class="default"><div class="pbi-input"> <input type="radio" name="dataClassification" ng-model="item.default" ng-value="true" ng-change="setDefaultDataClassification($index)"> <label class="form-label label-med">&nbsp;</label></div></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Classification" class="name"> <input type="text" ng-model="item.name" ng-change="updateFormState()"/></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Shorthand" class="shortHand"> <input type="text" maxlength="4" ng-model="item.shortHand" ng-change="updateFormState()"/></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_ShowTag" class="showTag"><pbi-checkbox label="test" ng-model="item.showTag" localize-tooltip="AdminPortal_TenantSettings_DataClassification_ShowTagTooltip" ng-change="updateFormState()"></pbi-checkbox></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_URL"> <input type="text" ng-model="item.url" ng-change="updateFormState()"/></td><td class="remove"> <button ng-click="removeDataClassification($index)"><i class="glyphicon pbi-glyph-delete glyph-small"></i></button></td></tr></table> <button class="add" ng-click="addDataClassification()"><i class="glyphicon pbi-glyph-add glyph-small"></i><span localize="AdminPortal_TenantSettings_DataClassification_AddItem"></span></button></div><div class="settingsButtonContainer" ng-if="::!areGranularTenantControlsEnabled"><pbi-button id="applyChanges" label="AdminPortal_TenantSettings_ButtonText_Apply" primary="true" ng-disabled="!hasChanges" ng-click="applyChanges()"></pbi-button><pbi-button id="cancelChanges" label="PBI_Button_Label_Cancel" ng-disabled="!hasChanges" ng-click="cancelChanges()"></pbi-button></div></div></div>'),
t.put("components/usageMetrics/usageMetrics.html",'<div class="usageMetrics"><iframe ng-src="/adminPortalDashboard" frameborder="0" scrolling="no"></iframe></div>')}]);;"use strict";var powerbi;!(function(e){var t;!(function(t){function a(t){var a=[{name:"Gateways",blockType:1,consumerHostFlags:8},{name:"Gateway",blockType:1,consumerHostFlags:8},{name:"GatewaySettings",blockType:1,consumerHostFlags:8},{name:"GatewayAdministrators",blockType:1,consumerHostFlags:8},{name:"Datasource",blockType:1,consumerHostFlags:8},{name:"DatasourceSettings",blockType:1,consumerHostFlags:8},{name:"DatasourceUsers",blockType:1,consumerHostFlags:8},{name:"SelectGateway",blockType:1,consumerHostFlags:8},{name:"UpnMappingPane",blockType:2,consumerHostFlags:8}];e.common.registerBuildingBlocksForHost(t,a,{directivesTarget:"powerbi.gateways.directives",directivesMap:e.gateways.directives,componentsTarget:"powerbi.gateways.components",componentsMap:e.gateways.components})}angular.module("powerbi.gateways.directives",[]),angular.module("powerbi.gateways.components",[]),angular.module("powerbi.gateways.controllers",[]),angular.module("powerbi.gateways",["powerbi.common","powerbi.connectivity","powerbi.gateways.directives","powerbi.gateways.controllers","powerbi.gateways.components"]).factory("selectGatewayService",["$rootScope","$compile","gatewaysMetadataService","modalDialogService","localizationService","featureSwitchService",function(e,a,i,n,o,r){return t.createSelectGatewayService(e,a,i,n,o,r)}]).factory("gatewaysMetadataHttpService",[function(){return e.connectivity.createGatewaysMetadataHttpService()}]).factory("gatewaysMetadataService",["promiseFactory","gatewaysMetadataHttpService","telemetryService","featureSwitchService",function(t,a,i,n){return e.connectivity.createGatewaysMetadataService(t,a,i,n)}]).factory("gatewayDataService",["gatewaysMetadataService","promiseFactory","featureSwitchService","moduleLoader",function(e,a,i,n){return t.createGatewayDataService(e,a,i,n)}]),t.registerBuildingBlocksForHost=a})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(){this.restrict="E",this.templateUrl="views/gatewaySettingsView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.GatewaySettingsController)}return a})();a.GatewaySettings=i})(a=t.directives||(t.directives={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.switchToUserTabEventName="gatewaySettingsSwitchToUserTab",e.dataSourceCreatedEventName="gatewaySettingsDataSourceCreated",e.onDirtyGatewaySelectionChanging="gatewayOnDirtyGatewaySelectionChanging",e.onGatewaySelectionChanged="gatewayOnGatewaySelectionChanged",e.discardAddingDataSourceEventName="gatewaySettingsDiscardAddingDataSource",e.addDataSourceEventName="gatewayAddDataSource",e.gatewaySelectionAppliedEventName="gatewaySettingsGatewaySelectionApplied",e.gatewaySelectionDiscardedEventName="gatewaySettingsGatewaySelectionDiscarded",e.selectGatewayStatusReadyEventName="gatewaySettingsSelectGatewayStatusReady",e.showGatewayUserMappingPaneEventName="showGatewayUserMappingPaneEvent",e.hideGatewayUserMappingPaneEventName="hideGatewayUserMappingPaneEvent",e.DataSourceTypePrefix="SettingsDataSourceType_",e.AuthenticationMethodPrefix="SettingsAuthenticationMethod_",e.LabelPrefix="SettingsLabel_",e.ServerError_ModelHasNoPowerBIDMMoniker="ModelHasNoPowerBIDMMoniker",e.ExtensionDataSourceKind="ExtensionDataSourceKind",e.extensionDataSourcePath="extensionDataSourcePath",e.database="database",e.server="server"})(t=e.constants||(e.constants={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.SqlServer=0]="SqlServer",e[e.AnalysisServices=1]="AnalysisServices",e[e.SAP=2]="SAP",e[e.File=3]="File",e[e.Folder=4]="Folder",e[e.Oracle=5]="Oracle",e[e.Teradata=6]="Teradata",e[e.SharePoint=7]="SharePoint",e[e.Web=8]="Web",e[e.OData=9]="OData",e[e.DB2=10]="DB2",e[e.MySql=11]="MySql",e[e.PostgreSql=12]="PostgreSql",e[e.Sybase=13]="Sybase",e[e.Extension=14]="Extension",e[e.SAPBW=15]="SAPBW",e[e.AzureTable=16]="AzureTable",e[e.AzureBlob=17]="AzureBlob",e[e.Informix=18]="Informix",e[e.ODBC=19]="ODBC",e[e.GoogleAnalytics=25]="GoogleAnalytics",e[e.Exchange=27]="Exchange",e[e.Facebook=28]="Facebook",e[e.HDInsight=29]="HDInsight",e[e.AzureMarketplace=30]="AzureMarketplace",e[e.ActiveDirectory=31]="ActiveDirectory",e[e.OleDb=35]="OleDb",e[e.Salesforce=39]="Salesforce",e[e.Impala=40]="Impala",e[e.Snowflake=41]="Snowflake",e[e.Netezza=42]="Netezza"})(t=e.ExtendedDataSourceType||(e.ExtendedDataSourceType={}));var a=(function(){function e(){}return e})();e.DataSourceSettingsModel=a})(t=e.models||(e.models={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(t){var a=e.common.models.EmailsListModel,i=(function(){function e(){this.pendingUsers=new a,this.editableUsers=[],this.isAdding=!1,this.isReloadingList=!1}return e})();t.DataSourceUserModel=i})(a=t.models||(t.models={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=e.common.contracts.gateway.CredentialType,n=e.common.contracts.gateway.DataSourceType,o=e.connectivity.models.GatewayTabSelectionType,r=e.common.contracts.gateway.GatewayStatus,s=(function(){function s(){}return s.convertSettingsGateways=function(e){var t=this;return _.map(e,(function(e){return t.convertGateway(e)}))},s.convertGateway=function(e){var t=this.getGatewayAnnotation(e);return{displayName:e.gatewayName,id:e.gatewayId,isLoadingDataSources:!1,isLoadingStatus:!1,status:this.convertGatewayStatus(e.gatewayStatus),dataSources:[],isExpanded:!1,description:e.gatewayDescription,enableAutoUpdate:!1,joinImprovmentProgram:!1,administrators:null,tabSelectionType:o.Settings,publicKey:e.gatewayPublicKey,isWaitingForGatewayUpdate:!1,isDirty:!1,contactInformationString:null,connectionError:null,originalValues:null,traceDetails:null,contextMenuItem:null,gatewayAnnotation:t,staticCapabilities:null}},s.convertSettingsClusters=function(e){var t=this;return _.map(e,(function(e){return t.convertClusters(e)}))},s.convertClusters=function(e){var t=this.getGatewayAnnotationFromClusterDetails(e);return{displayName:e.name,id:e.gatewayId,isLoadingDataSources:!1,isLoadingStatus:!1,status:this.convertGatewayStatus(r.Installed),dataSources:[],isExpanded:!1,description:e.description,enableAutoUpdate:!1,joinImprovmentProgram:!1,administrators:null,tabSelectionType:o.Settings,publicKey:e.publicKey,isWaitingForGatewayUpdate:!1,isDirty:!1,contactInformationString:null,connectionError:null,originalValues:null,traceDetails:null,contextMenuItem:null,gatewayAnnotation:t,staticCapabilities:null,gateways:e.gateways}},s.convertDataSources=function(e){var t=this;return _.map(e,(function(e){return t.convertDataSource(e)}))},s.convertDataSource=function(e){var t={id:e.dataSourceId,displayName:e.dataSourceName,onPremGatewayRequired:e.onPremGatewayRequired,dataSourceType:e.dataSourceType,connectionInfo:this.convertConnectionDetails(e.connectionDetails,e.credentialDetails),users:null,tabSelectionType:o.Settings,singleSignOnType:e.singleSignOnType};return t.dataSourceAnnotation=this.convertDataSourceAnnotation(e.dataSourceAnnotation),t},s.convertDataSourceAnnotation=function(t){var a={dataSourceAnnotationUPNMapping:{connectionStringPropertyName:e.common.contracts.gateway.ConnectionStringPropertyName.EffectiveUserName,mappingRules:[]}};if(!t)return a;try{return JSON.parse(t)}catch(e){return a}},s.convertUsers=function(e,t){var a=[{accessRight:t,principalList:e}];return a},s.convertToPrincipalAccessEntry=function(e,t){var a=[{accessRight:t,principalList:e}];return a},s.convertDiscoverDataSourceFeaturesToDataSourceTypeOptions=function(e){for(var o=this,r=[],s=0,c=e.dataSourceTypes;s<c.length;s++){var l=c[s],d=l.dataSourceType===n.Extension?l.extensionDataSourceKind:n[l.dataSourceType];if(void 0!==a.ExtendedDataSourceType[d]){var u=a.ExtendedDataSourceType[d],g=_.map(l.dataSourceCredentialTypes,(function(e){return{id:e,name:o.getLocalizedString(t.constants.AuthenticationMethodPrefix,i[e])}})),p=_.map(l.dataSourceLabels,(function(e){return{name:e.name,displayName:o.getLocalizedString(t.constants.LabelPrefix,e.name),type:o.getLabelType(e.name)}}));r[u]={id:u,name:this.getLocalizedString(t.constants.DataSourceTypePrefix,a.ExtendedDataSourceType[u]),datasourceType:l.dataSourceType,extensionDataSourceKind:l.extensionDataSourceKind,labels:p,authenticationMethodOptions:g}}}return r},s.convertAuthenticationParametersToCredentialData=function(e){return _.map(e,(function(e){return{name:e.name,value:e.value}}))},s.convertConnectionDetails=function(e,t){return{connetionDetails:e,credentialDetails:t}},s.getDataSourceModelExtendedDataSourceType=function(e){if(e.dataSourceType===n.Extension){var t=JSON.parse(e.connectionInfo.connetionDetails),i=t.extensionDataSourceKind;return a.ExtendedDataSourceType[i]}var o=n[e.dataSourceType];return a.ExtendedDataSourceType[o]},s.getGatewayAnnotation=function(e){return this.getGatewayAnnotationFromString(e.gatewayAnnotation)},s.getGatewayAnnotationFromClusterDetails=function(e){return this.getGatewayAnnotationFromString(e.annotation)},s.getGatewayAnnotationFromString=function(e){if(e)try{return JSON.parse(e)}catch(e){return null}return null},s.convertGatewayStatus=function(t){return t===r.Live?e.connectivity.models.GatewayStatus.Live:e.connectivity.models.GatewayStatus.NotReachable},s.getLocalizedString=function(t,a){var i=a.length>0?a.charAt(0).toUpperCase()+a.slice(1):"",n=e.common.localize.get("SettingsDataSource_"+t+i);return n||(n=i),n},s.getLabelType=function(e){switch(e.toLocaleLowerCase()){case"url":case"sharepointsiteurl":return"url";default:return"text"}},s})();a.GatewayModelConverter=s})(a=t.models||(t.models={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,a,i){this.modelId=e,this.selectedGatewayId=-1,this.title=null,this.showStatus=!0,this.showHeader=t,this.allowPersonalGateway=a,this.egwStatusLoaded=!1,this.isCloudScheduleRefresh=i,this.showNewPersonalGatewayAvailableMessage=!1,this.isDMTSPersonalGateway=!1}return e})();e.SelectGatewayModel=t})(t=e.models||(e.models={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(e,a){var i=this;this.scope=e,this.services=a,this.scope.onTabSelected=function(e){return i.onTabSelected(e)},this.scope.$on(t.constants.switchToUserTabEventName,(function(e){return i.switchToUserTabListener(e)}))}return a.prototype.switchToUserTabListener=function(t){t.stopPropagation(),this.onTabSelected(e.connectivity.models.GatewayTabSelectionType.Users)},a.prototype.onTabSelected=function(e){this.scope.viewModel.tabSelectionType=e},a})();a.DataSourceController=i})(a=t.controllers||(t.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=e.common.contracts.gateway.CredentialType,n=e.common.contracts.gateway.DataSourceType,o=e.common.EncryptionContext,r=e.common.contracts.gateway.GatewayStaticCapabilities,s=e.common.contracts.gateway.PrivacyLevel,c=e.common.contracts.gateway.SingleSignOnType,l=(function(){function a(e,a){var i=this;this.scope=e,this.services=a,this.viewModel=this.scope.viewModel=new t.models.DataSourceSettingsModel,this.viewModel.isLoadingForm=!0,this.viewModel.advancedSettingsExpanded=!1,this.initEntropy(),this.initializePlaceholder(),this.initViewModelOptions().then((function(){i.loadViewModelData(),i.startWatchFormControl(),i.startWatchDataSourceModel()})),this.scope.tryDiscardChanges=function(){return i.tryDiscardChanges()},this.scope.tryAddDataSource=function(){return i.tryAddDataSource()},this.scope.tryApplyChanges=function(){return i.tryApplyChanges()},this.scope.switchToUserTab=function(){return i.switchToUserTab()},this.scope.onAuthenticationParameter1Change=function(){return i.onAuthenticationParameter1Change()},this.scope.onAuthenticationParameter1Focus=function(){return i.onAuthenticationParameter1Focus()},this.scope.onAuthenticationParameter1Blur=function(){return i.onAuthenticationParameter1Blur()},this.scope.onAuthenticationParameter2Change=function(){return i.onAuthenticationParameter2Change()},this.scope.onAuthenticationParameter2Focus=function(){return i.onAuthenticationParameter2Focus()},this.scope.onAuthenticationParameter2Blur=function(){return i.onAuthenticationParameter2Blur()},this.scope.onDataSourceTypeChange=function(){return i.onDataSourceTypeChange()},this.scope.onAuthenticationMethodChange=function(){return i.onAuthenticationMethodChange()},this.scope.enterpriseGatewayETLEnabled=this.services.featureSwitchService.featureSwitches.enterpriseGatewayETLEnabled,this.scope.allowSingleSignOn=function(){return i.allowSingleSignOn()},this.scope.onSingleSignOnSettingChange=function(){return i.onSingleSignOnSettingChange()}}return a.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","localizationService","gatewaysMetadataService","promiseFactory","gatewayDataService"]}},a.prototype.initializePlaceholder=function(){a.Placeholder||("Google Inc."===navigator.vendor?a.Placeholder="":a.Placeholder="")},a.prototype.initEntropy=function(){var e=this;this.services.gatewaysMetadataService.getEntropy().then((function(t){if(e.entropy=[],t)for(var a=atob(t),i=a.length,n=0;n<i;n++)e.entropy.push(a.charCodeAt(n));else e.entropy=o.generateEntropy()}),(function(e){}))},a.prototype.initViewModelOptions=function(){var e=this,a=this.services.promiseFactory.defer();return this.services.gatewaysMetadataService.discoverDataSourceFeatures().then((function(a){e.viewModel.dataSourceTypeOptions=t.models.GatewayModelConverter.convertDiscoverDataSourceFeaturesToDataSourceTypeOptions(a)}),(function(e){})).finally((function(){a.resolve(null)})),a.promise},a.prototype.startWatchFormControl=function(){var e=this,t=this.scope.$watch("settingsForm",(function(a){a&&(e.scope.dataSourceModel.isDirty=function(){return a.$dirty},e.viewModel.isAddingDataSource&&e.scope.settingsForm.$setDirty(),t())}))},a.prototype.startWatchDataSourceModel=function(){var e=this;this.scope.$watch("dataSourceModel",(function(t,a){a!==t&&(e.loadViewModelData(),e.scope.dataSourceModel.isDirty=function(){return e.scope.settingsForm.$dirty})}))},a.prototype.loadViewModelData=function(){var e=this.scope.dataSourceModel,i=this.viewModel,n=i.isAddingDataSource=e.id<0,o=n?void 0:e.connectionInfo.credentialDetails.credentialType,r=n?void 0:JSON.parse(e.connectionInfo.connetionDetails),l=t.models.GatewayModelConverter.getDataSourceModelExtendedDataSourceType(e);if(i.editableSettings={dataSourceName:e.displayName,extendedDataSourceType:l,authenticationMethod:o,authenticationParameters:n?this.initAuthenticationParameters(e.dataSourceType,o):this.initAuthenticationParameters(e.dataSourceType,o,[a.Placeholder,a.Placeholder]),authenticationParameter1Edited:!1,authenticationParameter2Edited:!1,privacyLevel:n?s.Organizational:e.connectionInfo.credentialDetails.privacyLevel,singleSignOnType:e.singleSignOnType},!n){for(var d=0,u=this.viewModel.dataSourceTypeOptions[l].labels;d<u.length;d++){var g=u[d];i.editableSettings[g.name]=r[g.name]}if(this.isExtensionDatasourceType(l)){var p=r[t.constants.extensionDataSourcePath].split(";");i.editableSettings[t.constants.server]=p[0],p.length>=2&&(i.editableSettings[t.constants.database]=p[1])}}i.waitingForDataSourceStatus=!1,i.hasTestConnectionFailure=!1,i.isLoadingForm=!1,i.messageState=0,e.compositeErrorMessage="",this.scope.settingsForm&&(n?this.scope.settingsForm.$setDirty():this.scope.settingsForm.$setPristine()),i.isSingleSignOnEnabled=null!=e.singleSignOnType&&e.singleSignOnType!==c.None,this.isSingleSignOnOptionChanged=!1},a.prototype.getUserNameLabel=function(t){return t===e.common.contracts.gateway.DataSourceType.File||t===e.common.contracts.gateway.DataSourceType.Folder?this.services.localizationService.get("SettingsDataSource_SettingsWindowsUsername"):this.services.localizationService.get("SettingsDataSource_SettingsUsername")},a.prototype.getPasswordLabel=function(t){return t===e.common.contracts.gateway.DataSourceType.File||t===e.common.contracts.gateway.DataSourceType.Folder?this.services.localizationService.get("SettingsDataSource_SettingsWindowsPassword"):this.services.localizationService.get("SettingsDataSource_SettingsPassword")},a.prototype.initAuthenticationParameters=function(e,t,a){var n=[];if(null!=t)switch(t){case i.NotSpecified:case i.Anonymous:break;case i.Basic:case i.Windows:a||(a=["",""]),n.push({name:"username",value:a[0],displayName:this.getUserNameLabel(e),shouldDisplay:!0}),n.push({name:"password",value:a[1],displayName:this.getPasswordLabel(e),shouldDisplay:!0})}return n},a.prototype.getDefaultAuthenticationMethod=function(){var e=this.viewModel.editableSettings,t=this.viewModel.dataSourceTypeOptions[e.extendedDataSourceType].authenticationMethodOptions;if(1===t.length)return t[0].id},a.prototype.onDataSourceTypeChange=function(){for(var e=this.viewModel.editableSettings,t=this.getDefaultAuthenticationMethod(),a=this.viewModel.dataSourceTypeOptions[e.extendedDataSourceType].datasourceType,i=0,n=this.viewModel.dataSourceTypeOptions[e.extendedDataSourceType].labels;i<n.length;i++){var o=n[i];e[o.name]=""}e.authenticationMethod=t,e.authenticationParameters=this.initAuthenticationParameters(a,t),e.authenticationParameter1Edited=!1,e.authenticationParameter2Edited=!1},a.prototype.onAuthenticationMethodChange=function(){var e=this.scope.viewModel.editableSettings,t=this.scope.viewModel.dataSourceTypeOptions[e.extendedDataSourceType].datasourceType;e.authenticationParameters=this.initAuthenticationParameters(t,e.authenticationMethod,["",""]),e.authenticationParameter1Edited=!0,e.authenticationParameter2Edited=!0},a.prototype.tryDiscardChanges=function(){var e=this;this.showDiscardPopup().then((function(){e.viewModel.isAddingDataSource?e.scope.$emit(t.constants.discardAddingDataSourceEventName):e.loadViewModelData()}))},a.prototype.showDiscardPopup=function(){var e=this.services.promiseFactory.defer(),t=this.services.errorService,a=t.control(),i=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),o=[new InJs.ModalDialogAction(i,function(t,i){a.hideDialog(),e.resolve(null)}),new InJs.ModalDialogAction(n,function(t,i){a.hideDialog(),e.reject()})],r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),s=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_DataSourceMessage");return a.showCustomDialog(r,$("<div/>").text(s),o,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0),e.promise},a.prototype.onAuthenticationParameter1Change=function(){this.viewModel.editableSettings.authenticationParameters.length>1&&!this.viewModel.editableSettings.authenticationParameter2Edited&&(this.viewModel.editableSettings.authenticationParameters[1].value="",this.viewModel.editableSettings.authenticationParameter2Edited=!0),this.viewModel.editableSettings.authenticationParameter1Edited=!0},a.prototype.onAuthenticationParameter1Focus=function(){this.viewModel.isAddingDataSource||this.viewModel.editableSettings.authenticationParameter1Edited||(this.viewModel.editableSettings.authenticationParameters[0].value="")},a.prototype.onAuthenticationParameter1Blur=function(){this.viewModel.isAddingDataSource||this.viewModel.editableSettings.authenticationParameter1Edited||(this.viewModel.editableSettings.authenticationParameters[0].value=a.Placeholder)},a.prototype.onAuthenticationParameter2Change=function(){this.viewModel.editableSettings.authenticationParameter1Edited||(this.viewModel.editableSettings.authenticationParameters[0].value="",this.viewModel.editableSettings.authenticationParameter1Edited=!0),this.viewModel.editableSettings.authenticationParameter2Edited=!0},a.prototype.onAuthenticationParameter2Focus=function(){this.viewModel.isAddingDataSource||this.viewModel.editableSettings.authenticationParameter2Edited||(this.viewModel.editableSettings.authenticationParameters[1].value="")},a.prototype.onAuthenticationParameter2Blur=function(){this.viewModel.isAddingDataSource||this.viewModel.editableSettings.authenticationParameter2Edited||(this.viewModel.editableSettings.authenticationParameters[1].value=a.Placeholder)},a.prototype.isDataSourceNameUnique=function(e,t){return!_.find(this.scope.dataSourceModel.gateway.dataSources,(function(a){return a.displayName===e&&a!==t}))},a.prototype.tryAddDataSource=function(){var e=this;if(this.isFormValid()){var a=this.scope.dataSourceModel,i=this.scope.viewModel.dataSourceTypeOptions,n=this.viewModel.editableSettings,o=a.gateway,r=this.services.gatewayDataService.getDecodedPublicKey(a.gateway.publicKey),s={credentialData:t.models.GatewayModelConverter.convertAuthenticationParametersToCredentialData(this.viewModel.editableSettings.authenticationParameters)};this.services.gatewayDataService.encryptCredentials(s,r,n.authenticationMethod,this.entropy).then((function(a){e.viewModel.waitingForDataSourceStatus=!0,a.privacyLevel=n.privacyLevel;var r=i[n.extendedDataSourceType].datasourceType,s={dataSourceName:n.dataSourceName,dataSourceType:r,onPremGatewayRequired:!0,connectionDetails:e.getConnectionDetailsString(n.extendedDataSourceType),credentialDetails:a,supportedAuthenticationTypes:null,singleSignOnType:e.viewModel.singleSignOnType};e.services.gatewayDataService.createDataSourceWithRetry(o,s,n.authenticationParameters,e.entropy).then((function(a){e.viewModel.waitingForDataSourceStatus=!1,e.scope.dataSourceModel.id=a.dataSourceId,e.scope.dataSourceModel.displayName=a.dataSourceName,e.scope.dataSourceModel.dataSourceType=a.dataSourceType,e.scope.dataSourceModel.connectionInfo.connetionDetails=a.connectionDetails,e.scope.dataSourceModel.connectionInfo.credentialDetails=a.credentialDetails,e.scope.dataSourceModel.dataSourceAnnotation=t.models.GatewayModelConverter.convertDataSourceAnnotation(""),e.scope.dataSourceModel.singleSignOnType=a.singleSignOnType,e.loadViewModelData(),e.scope.dataSourceModel.connected=!0,e.scope.dataSourceModel.connectionError=null,e.viewModel.messageState=1,e.scope.$emit(t.constants.dataSourceCreatedEventName,[a.dataSourceId])}),(function(t){e.showDataSourceError(t),e.scope.dataSourceModel.connected=!1}))}))}},a.prototype.tryApplyChanges=function(){var e=this;if(this.isFormValid()){var a=this.scope.dataSourceModel,i=this.viewModel.editableSettings,n=a.gateway,o=a.id;if(this.isSingleSignOnOptionChanged&&this.allowSingleSignOn()&&this.services.gatewaysMetadataService.updateDataSource(n.id,o,{dataSourceType:null,onPremGatewayRequired:null,connectionDetails:null,credentialDetails:null,dataSourceAnnotation:null,supportedAuthenticationTypes:null,singleSignOnType:this.viewModel.singleSignOnType}).then((function(){e.scope.dataSourceModel.singleSignOnType=e.viewModel.singleSignOnType,e.isCredentialsEdited()?e.isSingleSignOnOptionChanged=!1:e.loadViewModelData()}),(function(t){e.showDataSourceError(t)})),this.isCredentialsEdited()){var r=this.services.gatewayDataService.getDecodedPublicKey(a.gateway.publicKey),s={credentialData:t.models.GatewayModelConverter.convertAuthenticationParametersToCredentialData(this.viewModel.editableSettings.authenticationParameters)};this.services.gatewayDataService.encryptCredentials(s,r,i.authenticationMethod,this.entropy).then((function(t){e.viewModel.waitingForDataSourceStatus=!0,t.privacyLevel=i.privacyLevel,e.services.gatewayDataService.updateCredentialsWithRetry(n,o,i.authenticationParameters,t,e.entropy).then((function(){e.viewModel.waitingForDataSourceStatus=!1,e.scope.dataSourceModel.connectionInfo.credentialDetails.credentialType=e.viewModel.editableSettings.authenticationMethod,e.scope.dataSourceModel.connectionInfo.credentialDetails.privacyLevel=e.viewModel.editableSettings.privacyLevel,e.loadViewModelData(),e.scope.dataSourceModel.connected=!0,e.scope.dataSourceModel.connectionError=null}),(function(t){e.showDataSourceError(t),e.viewModel.hasTestConnectionFailure=!0}))}))}}},a.prototype.isFormValid=function(){return!this.scope.settingsForm.$invalid&&(!(this.viewModel.isAddingDataSource&&!this.isDataSourceNameUnique(this.viewModel.editableSettings.dataSourceName,this.scope.dataSourceModel))||(this.scope.dataSourceModel.errorTitle="",this.scope.dataSourceModel.compositeErrorMessage=this.services.localizationService.get("SettingsDatasources_DuplicateDataSourceName"),this.viewModel.messageState=2,!1))},a.prototype.switchToUserTab=function(){this.scope.$emit(t.constants.switchToUserTabEventName)},a.prototype.getConnectionDetailsString=function(e){for(var a={},i=this.viewModel.dataSourceTypeOptions[this.viewModel.editableSettings.extendedDataSourceType].labels,n=0,o=i;n<o.length;n++){var r=o[n];a[r.name]=this.viewModel.editableSettings[r.name]}return this.isExtensionDatasourceType(e)&&(a[t.constants.ExtensionDataSourceKind]=t.models.ExtendedDataSourceType[e],a.hasOwnProperty(t.constants.database)?(a[t.constants.extensionDataSourcePath]=a[t.constants.server].concat(";").concat(a[t.constants.database]),delete a[t.constants.server],delete a[t.constants.database]):a.hasOwnProperty(t.constants.server)&&(a[t.constants.extensionDataSourcePath]=a[t.constants.server],delete a[t.constants.server])),JSON.stringify(a)},a.prototype.getDataSourceName=function(e){var t=this.viewModel.dataSourceTypeOptions[e.extendedDataSourceType].labels;return t.length>0?e[t[0].name]:""},a.prototype.showDataSourceError=function(t){var a=this,i=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(t.error);i.always((function(i){var n=e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code,o=a.services.localizationService.get(n);"ServerError_DMTS_DuplicateDatasourceError"===n?(a.scope.dataSourceModel.errorTitle="",a.scope.dataSourceModel.compositeErrorMessage=o):(a.scope.dataSourceModel.errorTitle=a.services.localizationService.get("SettingsDataSource_SettingsConnectionErrorTitle"),a.scope.dataSourceModel.compositeErrorMessage=a.services.localizationService.format("SettingsDataSource_SettingsConnectionErrorMessage",[a.getDataSourceName(a.viewModel.editableSettings),o]));var r=[];if(i&&i.displayableErrorInfo)for(var s=0,c=i.displayableErrorInfo;s<c.length;s++){var l=c[s];r.push({key:l.errorInfoKey,value:l.errorInfoValue})}a.scope.dataSourceModel.traceDetails={requestId:t.requestId,activityId:t.activityId,clusterUri:clusterUri,errorCode:t.status.toString(),error:t.error.code,details:r,time:(new Date).toString(),version:e.build,linkText:a.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"},a.viewModel.waitingForDataSourceStatus=!1,a.viewModel.messageState=2}))},a.prototype.allowSingleSignOn=function(){return null!=this.scope.dataSourceModel.gateway&&null!=this.scope.dataSourceModel.gateway.staticCapabilities&&(this.scope.dataSourceModel.gateway.staticCapabilities&r.DirectQuerySingleSignOn_Kerberos)===r.DirectQuerySingleSignOn_Kerberos&&this.doDatasourcetypeSupportSingleSignOn(this.viewModel.dataSourceTypeOptions[this.viewModel.editableSettings.extendedDataSourceType].datasourceType)},a.prototype.doDatasourcetypeSupportSingleSignOn=function(e){switch(e){case n.SqlServer:return this.services.featureSwitchService.featureSwitches.onPremDirectQuerySingleSignOnForSql;case n.Oracle:return this.services.featureSwitchService.featureSwitches.onPremDirectQuerySingleSignOnForOracle;case n.SAP:return this.services.featureSwitchService.featureSwitches.onPremDirectQuerySingleSignOnForSAP;case n.Teradata:return this.services.featureSwitchService.featureSwitches.onPremDirectQuerySingleSignOnForTeradata;default:return!1}},a.prototype.onSingleSignOnSettingChange=function(){this.viewModel.singleSignOnType=this.viewModel.isSingleSignOnEnabled?c.Kerberos:c.None,this.isSingleSignOnOptionChanged=!this.isSingleSignOnOptionChanged},a.prototype.isCredentialsEdited=function(){return this.viewModel.editableSettings.authenticationParameter1Edited||this.viewModel.editableSettings.authenticationParameter2Edited},a.prototype.isExtensionDatasourceType=function(e){return this.viewModel.dataSourceTypeOptions[e].datasourceType===n.Extension},a})();a.DataSourceSettingsController=l})(a=t.controllers||(t.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=e.common.contracts.gateway.AccessRight,n=e.common.contracts.gateway.DataSourceType,o=(function(){function a(e,a){var i=this;this.scope=e,this.services=a,this.dataSourceModel=e.dataSourceModel,this.viewModel=this.scope.viewModel=new t.models.DataSourceUserModel,this.scope.tryAddUsers=function(){return i.tryAddUsers()},this.scope.tryRemoveSelectedUsers=function(){return i.tryRemoveSelectedUsers()},this.scope.shouldDisableRemoveButton=function(){return i.shouldDisableRemoveButton()},this.scope.mapUserNames=function(){return i.mapUserNames()},this.getDataSourceUsers(),this.setupUpnMappingButton(),this.startWatchDataSourceModel(),this.scope.dataSourceModel.isDirty=function(){return!1}}return a.createOptions=function(){return{additionalServices:["errorService","localizationService","gatewaysMetadataService","telemetryService"]}},a.prototype.startWatchDataSourceModel=function(){var e=this;this.scope.$watch("dataSourceModel",(function(t,a){a!==t&&(e.dataSourceModel=e.scope.dataSourceModel,e.getDataSourceUsers(),e.setupUpnMappingButton())}))},a.prototype.setupUpnMappingButton=function(){this.scope.upnMappingEnabled=this.dataSourceModel&&this.dataSourceModel.dataSourceType===n.AnalysisServices},a.prototype.tryAddUsers=function(){var a=this;this.viewModel.pendingUsers.validationTrigger()&&(this.viewModel.isAdding=!0,this.validateEmailAddresses(),this.viewModel.pendingUsers.validEmailsList.length>0?this.services.gatewaysMetadataService.addDataSourcePrincipals(this.dataSourceModel.gateway.id,this.dataSourceModel.id,t.models.GatewayModelConverter.convertUsers(this.viewModel.pendingUsers.validEmailsList,i.read)).then((function(){a.viewModel.isAdding=!1,a.viewModel.pendingUsers.inputUserList=[],a.getDataSourceUsers()}),(function(t){a.viewModel.isAdding=!1,a.services.errorService.error(a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"AddDataSourceUser_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})})):(this.viewModel.isAdding=!1,this.viewModel.pendingUsers.inputUserList=[]))},a.prototype.validateEmailAddresses=function(){this.viewModel.pendingUsers.validEmailsList=_.unique(this.arrayStringsToLowerCase(this.viewModel.pendingUsers.validEmailsList));var e=this.arrayStringsToLowerCase(_.map(this.viewModel.editableUsers,(function(e){return e.emailAddress})));this.viewModel.pendingUsers.validEmailsList=_.difference(this.viewModel.pendingUsers.validEmailsList,e)},a.prototype.arrayStringsToLowerCase=function(e){var t=_.map(e,(function(e){return e.toLowerCase()}));return t},a.prototype.tryRemoveSelectedUsers=function(){var a=this,n=_.filter(this.viewModel.editableUsers,(function(e){return e.shouldBeRemoved})),o=_.map(n,(function(e){return{objectId:e.objectId,principalType:e.principalType}}));this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.deleteDataSourcePrincipals(this.dataSourceModel.gateway.id,this.dataSourceModel.id,t.models.GatewayModelConverter.convertToPrincipalAccessEntry(o,i.none)).then((function(){a.getDataSourceUsers()}),(function(t){a.viewModel.isReloadingList=!1,a.services.errorService.error(a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"AddDataSourceUser_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,
statusCode:t.status.toString()})}))},a.prototype.getDataSourceUsers=function(){var t=this;this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.getDataSourcePrincipals(this.dataSourceModel.gateway.id,this.dataSourceModel.id).then((function(e){var a=_.filter(e,(function(e){return e.accessRight===i.read||e.accessRight===i.write})),n=_.flatten(_.map(a,(function(e){return e.principalList})));t.viewModel.editableUsers=_.map(n,(function(e){var t=e.givenName?e.givenName:e.displayName,a=e.familyName?e.familyName:"";return{objectId:e.objectId,name:t+" "+a,emailAddress:e.emailAddress,principalType:e.principalType,shouldBeRemoved:!1}})),t.viewModel.isReloadingList=!1}),(function(a){t.services.errorService.error(t.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+a.error.code),"GetDataSourceUsers_Error",{requestId:a.requestId,ecsCorrelationId:a.activityId,statusCode:a.status.toString()}),t.viewModel.isReloadingList=!1}))},a.prototype.shouldDisableRemoveButton=function(){return _.all(this.viewModel.editableUsers,(function(e){return!e.shouldBeRemoved}))},a.prototype.mapUserNames=function(){this.services.telemetryService.logEvent(e.telemetry.SettingsOpenGatewayDatasourceUPNMappingPane),this.scope.$emit(t.constants.showGatewayUserMappingPaneEventName)},a})();a.DataSourceUsersController=o})(a=t.controllers||(t.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=e.common.contracts.gateway.AccessRight,n=(function(){function a(e,a){var i=this;this.scope=e,this.services=a,this.gatewayModel=e.gatewayModel,this.viewModel=this.scope.viewModel=new t.models.DataSourceUserModel,this.scope.tryAddAdministrators=function(){return i.tryAddAdministrators()},this.scope.tryRemoveSelectedAdminstrators=function(){return i.tryRemoveSelectedAdministrators()},this.scope.shouldDisableRemoveButton=function(){return i.shouldDisableRemoveButton()},this.getGatewayAdministrators(),this.startWatchGatewayModel()}return a.createOptions=function(){return{additionalServices:["errorService","localizationService","gatewaysMetadataService"]}},a.prototype.startWatchGatewayModel=function(){var e=this;this.scope.$watch("gatewayModel",(function(t,a){a!==t&&(e.gatewayModel=e.scope.gatewayModel,e.getGatewayAdministrators())}))},a.prototype.tryAddAdministrators=function(){var a=this;this.viewModel.pendingUsers.validationTrigger()&&(this.viewModel.isAdding=!0,this.validateEmailAddresses(),this.viewModel.pendingUsers.validEmailsList.length>0?this.services.gatewaysMetadataService.addGatewayPrincipals(this.gatewayModel.id,t.models.GatewayModelConverter.convertUsers(this.viewModel.pendingUsers.validEmailsList,i.read|i.write)).then((function(){a.viewModel.isAdding=!1,a.viewModel.pendingUsers.inputUserList=[],a.getGatewayAdministrators()}),(function(t){a.viewModel.isAdding=!1,a.services.errorService.error(a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"AddGatewayAdmin_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})})):(this.viewModel.isAdding=!1,this.viewModel.pendingUsers.inputUserList=[]))},a.prototype.validateEmailAddresses=function(){this.viewModel.pendingUsers.validEmailsList=_.unique(this.arrayStringsToLowerCase(this.viewModel.pendingUsers.validEmailsList));var e=this.arrayStringsToLowerCase(_.map(this.viewModel.editableUsers,(function(e){return e.emailAddress})));this.viewModel.pendingUsers.validEmailsList=_.difference(this.viewModel.pendingUsers.validEmailsList,e)},a.prototype.arrayStringsToLowerCase=function(e){var t=_.map(e,(function(e){return e.toLowerCase()}));return t},a.prototype.tryRemoveSelectedAdministrators=function(){var a=this,n=_.filter(this.viewModel.editableUsers,(function(e){return e.shouldBeRemoved})),o=_.map(n,(function(e){return{objectId:e.objectId,principalType:e.principalType}}));this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.deleteGatewayPrincipals(this.gatewayModel.id,t.models.GatewayModelConverter.convertToPrincipalAccessEntry(o,i.none)).then((function(){a.getGatewayAdministrators()}),(function(t){a.viewModel.isReloadingList=!1,a.services.errorService.error(a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"AddGatewayAdmin_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},a.prototype.getGatewayAdministrators=function(){var t=this;this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.getGatewayPrincipals(this.gatewayModel.id).then((function(e){var a=_.filter(e,(function(e){return e.accessRight&(i.read|i.write)})),n=_.flatten(_.map(a,(function(e){return e.principalList})));t.viewModel.editableUsers=_.map(n,(function(e){var t=e.givenName?e.givenName:e.displayName,a=e.familyName?e.familyName:"";return{objectId:e.objectId,name:t+" "+a,emailAddress:e.emailAddress,principalType:e.principalType,shouldBeRemoved:!1}})),t.viewModel.isReloadingList=!1}),(function(a){t.services.errorService.error(t.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+a.error.code),"GetGatewaysAdmins_Error",{requestId:a.requestId,ecsCorrelationId:a.activityId,statusCode:a.status.toString()}),t.viewModel.isReloadingList=!1}))},a.prototype.shouldDisableRemoveButton=function(){return _.all(this.viewModel.editableUsers,(function(e){return!e.shouldBeRemoved}))},a})();a.GatewayAdministratorsController=n})(a=t.controllers||(t.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){var a=this;this.scope=e,this.services=t,this.scope.onTabSelected=function(e){return a.onTabSelected(e)}}return e.prototype.onTabSelected=function(e){this.scope.viewModel.tabSelectionType=e},e})();e.GatewayController=t})(t=e.controllers||(e.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=e.connectivity.models.DataSourceContextMenuItemModel,n=e.connectivity.models.GatewayContextMenuItemModel,o=e.connectivity.models.GatewayStatus,r=e.connectivity.models.GatewayTabSelectionType,s=(function(){function a(e,a){var i=this;this.scope=e,this.services=a,this.scope.onItemSelected=function(e,t){return i.onItemSelected(e,t)},this.scope.getSelectionType=function(){return i.getSelectionType()},this.scope.tryAddDataSource=function(){return i.tryAddDataSource(i.scope.viewModel.currentGateway)},this.scope.testConnections=function(){return i.testConnections()},this.scope.isLoading=!1,this.services.featureSwitchService.featureSwitches.gatewayHighAvailability===!0?this.loadGatewayClusters():this.loadGateways(),this.scope.$on(t.constants.dataSourceCreatedEventName,(function(e,t){return i.updateCurrentDataSource(e,t[0])})),this.scope.$on(t.constants.discardAddingDataSourceEventName,(function(e){return i.discardAddingDataSource(e)})),this.scope.$on(t.constants.addDataSourceEventName,(function(e){return i.tryAddDataSource(i.scope.viewModel.currentGateway)}))}return a.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","gatewayDataService","gatewaysMetadataService","localizationService","navigation","promiseFactory"]}},a.prototype.updateCurrentDataSource=function(e,t){e.stopPropagation(),this.scope.viewModel.currentDataSourceId=t,this.loadDataSourceContextMenu(this.scope.viewModel.currentDataSource)},a.prototype.discardAddingDataSource=function(e){e.stopPropagation(),this.scope.viewModel.currentGateway.dataSources.pop(),this.openItem(this.scope.viewModel.currentGatewayId,null)},a.prototype.gatewayExists=function(e){var t=_.find(this.scope.viewModel.gateways,(function(t){return t.id===e}));return null!==t&&void 0!==t},a.prototype.dataSourceExists=function(e,t){var a=_.find(e.dataSources,(function(e){return e.id===t}));return null!==a&&void 0!==a},a.prototype.tryInitializeGatewaySelection=function(){if(this.scope.viewModel.gateways.length>0){var e=this.services.navigation,t=e?e.gatewayId:null,a=e?e.dataSourceId:null;null!==t&&this.gatewayExists(t)?a||this.onItemSelected(t,null):(t=this.scope.viewModel.gateways[0].id,this.onItemSelected(t,null))}},a.prototype.tryInitializeDataSourceSelection=function(e){var t=this.services.navigation,a=t?t.gatewayId:null,i=t?t.dataSourceId:null;e.id===a&&i&&(i===-1?(this.onItemSelected(a,null),this.tryAddDataSource(e)):this.dataSourceExists(e,i)?this.onItemSelected(a,i):this.onItemSelected(a,null))},a.prototype.loadGateways=function(){var e=this;this.scope.isLoading=!0,this.services.gatewaysMetadataService.getGateways().then((function(a){e.scope.viewModel={gateways:t.models.GatewayModelConverter.convertSettingsGateways(a),currentGatewayId:0,currentDataSourceId:0,currentGateway:null,currentDataSource:null,gatewayClusters:null},e.scope.isLoading=!1,e.tryInitializeGatewaySelection(),e.loadGatewaysState()}),(function(t){e.services.errorService.error(e.services.localizationService.get("SettingsGateways_Error_FailedToLoad"),"SettingsGateways_Error_FailedToLoad")}))},a.prototype.loadGatewaysState=function(){for(var e=0,t=this.scope.viewModel.gateways;e<t.length;e++){var a=t[e];this.loadGatewayContextMenu(a),this.loadGatewayStatus(a),this.loadDataSources(a)}},a.prototype.loadGatewayContextMenu=function(t){var a=this,i=new n(t);i.actions=[],i.actions.push({text:this.services.localizationService.get("AddDataSourceText"),action:function(){a.tryAddDataSource(t)}}),i.actions.push({text:this.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){a.tryDeleteGateway(t)}}),i.metadata=[],i.metadata.push({type:e.common.models.ContextMenuItemMetadataType.Status,status:e.common.models.ContextMenuItemMetadataStatus.Unknown,value:""}),t.contextMenuItem=i},a.prototype.tryDeleteGateway=function(e){var t=this,a=this.services.errorService,i=a.control(),n=this.services.localizationService.get("SettingsGateway_DeleteWarning_YesOption"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(n,function(a,n){i.hideDialog(),t.deleteGateway(e)}),new InJs.ModalDialogAction(o,function(e,t){i.hideDialog()})],s=this.services.localizationService.get("SettingsGateway_DeleteWarning_Title"),c=this.services.localizationService.get("SettingsGateway_DeleteWarning_Message");i.showCustomDialog(s,$("<div/>").text(c),r,(function(e){e.parent().find('input[value="'+o+'"]').focus()}),!0,!0)},a.prototype.deleteGateway=function(t){var a=this;t&&this.services.gatewaysMetadataService.deleteGateway(t.id).then((function(){var e=a.scope.viewModel.gateways.indexOf(t);e>-1&&(a.scope.viewModel.gateways.splice(e,1),a.scope.viewModel.gateways.length>0?a.onItemSelected(a.scope.viewModel.gateways[0].id,null):a.onItemSelected(null,null))}),(function(t){a.services.errorService.error(a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"Gateways_Error_FailedToDelete",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},a.prototype.getCurrentGateway=function(){return this.scope.viewModel.currentGateway},a.prototype.getCurrentDataSource=function(){return this.scope.viewModel.currentDataSource},a.prototype.loadGatewayStatus=function(t){var a=this;t.isLoadingStatus=!0,this.services.gatewaysMetadataService.getGatewayStatus(t.id).then((function(i){if(t.status=o.Live,t.staticCapabilities=i.gatewayStaticCapabilities,t.isLoadingStatus=!1,t.gatewayVersion=i.gatewayVersion,t.gatewayUpgradeState=i.gatewayUpgradeState,t.contextMenuItem){var n=t.contextMenuItem.metadata[0];n.status=e.common.models.ContextMenuItemMetadataStatus.Success,n.value=a.services.localizationService.get("SettingsGateway_OnlineMessage")}}),(function(i){t.isLoadingStatus=!1,t.status=o.NotReachable,e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(i.error).done((function(n){if(t.connectionError=a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+i.error.code),t.contextMenuItem){var o=t.contextMenuItem.metadata[0];o.status=e.common.models.ContextMenuItemMetadataStatus.Error,o.value=a.services.localizationService.get("SettingsGateway_NotConnectedMessage")}var r=[];if(n&&n.displayableErrorInfo)for(var s=0,c=n.displayableErrorInfo;s<c.length;s++){var l=c[s];r.push({key:l.errorInfoKey,value:l.errorInfoValue})}t.traceDetails={requestId:i.requestId,activityId:i.activityId,clusterUri:clusterUri,errorCode:i.status.toString(),error:i.error.code,details:r,time:(new Date).toString(),version:e.build,linkText:a.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))}))},a.prototype.loadDataSources=function(a){var i=this;a.isLoadingDataSources=!0,this.services.gatewaysMetadataService.getDataSources(a.id).then((function(e){a.dataSources=t.models.GatewayModelConverter.convertDataSources(e),a.isLoadingDataSources=!1,i.tryInitializeDataSourceSelection(a),i.loadDataSourcesState(a)}),(function(t){i.services.errorService.error(i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"SettingsDataSources_Error_FailedToLoad",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},a.prototype.loadDataSourcesState=function(e){for(var t=0,a=e.dataSources;t<a.length;t++){var i=a[t];i.gateway=e,this.loadDataSourceContextMenu(i),this.loadDataSourceStatus(e,i)}},a.prototype.loadDataSourceContextMenu=function(t){var a=this,n=new i(t);n.actions=[],n.actions.push({text:this.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){a.tryDeleteDataSource(t)}}),n.metadata=[],n.metadata.push({type:e.common.models.ContextMenuItemMetadataType.Status,status:e.common.models.ContextMenuItemMetadataStatus.Unknown,value:""}),t.contextMenuItem=n},a.prototype.tryDeleteDataSource=function(e){var t=this,a=this.services.errorService,i=a.control(),n=this.services.localizationService.get("SettingsDataSource_DeleteWarning_YesOption"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(n,function(a,n){i.hideDialog(),t.deleteDataSource(e)}),new InJs.ModalDialogAction(o,function(e,t){i.hideDialog()})],s=this.services.localizationService.get("SettingsDataSource_DeleteWarning_Title"),c=this.services.localizationService.get("SettingsDataSource_DeleteWarning_Message");i.showCustomDialog(s,$("<div/>").text(c),r,(function(e){e.parent().find('input[value="'+o+'"]').focus()}),!0,!0)},a.prototype.deleteDataSource=function(t){var a=this,i=t.gateway;if(i&&t)if(t.id<0){var n=i.dataSources.indexOf(t);n>-1&&(i.dataSources.splice(n,1),this.openItem(i.id,null))}else this.services.gatewaysMetadataService.deleteDataSource(i.id,t.id).then((function(){var e=i.dataSources.indexOf(t);e>-1&&(i.dataSources.splice(e,1),a.onItemSelected(i.id,null))}),(function(t){a.services.errorService.error(a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"DataSources_Error_FailedToDelete",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},a.prototype.loadDataSourceStatus=function(t,a){var i=this;a.id!==-1&&this.services.gatewaysMetadataService.getDataSourceStatus(t.id,a.id).then((function(){if(a.connected=!0,a.connectionError=null,a.contextMenuItem){var t=a.contextMenuItem.metadata[0];t.status=e.common.models.ContextMenuItemMetadataStatus.Success,t.value=i.services.localizationService.get("SettingsGateway_OnlineMessage")}}),(function(t){a.connected=!1,a.gateway.isExpanded=!0,e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(t.error).done((function(n){if(a.connectionError=i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),a.contextMenuItem){var o=a.contextMenuItem.metadata[0];o.status=e.common.models.ContextMenuItemMetadataStatus.Error,o.value=i.services.localizationService.get("SettingsGateway_NotConnectedMessage")}var r=[];if(n&&n.displayableErrorInfo)for(var s=0,c=n.displayableErrorInfo;s<c.length;s++){var l=c[s];r.push({key:l.errorInfoKey,value:l.errorInfoValue})}a.traceDetails={requestId:t.requestId,activityId:t.activityId,clusterUri:clusterUri,errorCode:t.status.toString(),error:t.error.code,details:r,time:(new Date).toString(),version:e.build,linkText:i.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))}))},a.prototype.generateUniqueDataSourceName=function(){if(!this.scope.viewModel.currentGateway)return null;for(var e=this.services.localizationService.get("NewDataSourceName"),t=e,a=0;;){var i=_.find(this.scope.viewModel.currentGateway.dataSources,(function(e){return e.displayName===t}));if(!i)break;a++,t=e+" "+a}return t},a.prototype.tryAddDataSource=function(e){var a=this;this.scope.viewModel.currentDataSourceId<0||(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSource.isDirty&&this.scope.viewModel.currentDataSource.isDirty()?this.showDiscardPopup().then((function(){a.addDataSource(e)})):this.scope.viewModel.currentGateway&&this.scope.viewModel.currentGateway.isDirty?this.scope.$broadcast(t.constants.onDirtyGatewaySelectionChanging,"SettingsGateway_DiscardChangesWarning_GatewayMessage",(function(){a.addDataSource(e),a.scope.$apply()})):this.addDataSource(e))},a.prototype.addDataSource=function(e){var t={id:-1,displayName:this.generateUniqueDataSourceName(),dataSourceType:void 0,gateway:e,connectionInfo:{},users:null,tabSelectionType:r.Settings};e.dataSources.push(t),this.loadDataSourceContextMenu(t),this.openItem(e.id,t.id)},a.prototype.onItemSelected=function(e,a){var i=this;e===this.scope.viewModel.currentGatewayId&&a===this.scope.viewModel.currentDataSourceId||(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSource.isDirty&&this.scope.viewModel.currentDataSource.isDirty()?this.showDiscardPopup().then((function(){i.scope.viewModel.currentDataSourceId<0&&i.scope.viewModel.currentGateway.dataSources.pop(),i.openItem(e,a)})):this.scope.viewModel.currentGateway&&this.scope.viewModel.currentGateway.isDirty?this.scope.$broadcast(t.constants.onDirtyGatewaySelectionChanging,"SettingsGateway_DiscardChangesWarning_GatewayMessage",(function(){i.openItem(e,a),i.scope.$apply()})):(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSourceId<0&&this.scope.viewModel.currentGateway.dataSources.pop(),this.openItem(e,a)))},a.prototype.openItem=function(e,a){var i=this,n=this.scope.viewModel;n.currentGatewayId=e,n.currentDataSourceId=a,n.currentGateway=this.getCurrentGatewayModel(),this.services.gatewayDataService.selectedGatewayDatasource=n.currentDataSource=this.getCurrentDataSourceModel(),a?this.scope.viewModel.currentGateway.isExpanded=!0:requestAnimationFrame((function(){return i.scope.$broadcast(t.constants.onGatewaySelectionChanged)})),this.services.navigation&&this.services.navigation.navigateToGatewayItem(e,a)},a.prototype.getSelectionType=function(){return this.scope.viewModel.currentGatewayId?this.scope.viewModel.currentDataSourceId?e.connectivity.models.GatewaysSelectionType.DataSource:e.connectivity.models.GatewaysSelectionType.Gateway:e.connectivity.models.GatewaysSelectionType.None},a.prototype.getCurrentGatewayModel=function(){var e=this;return _.find(this.scope.viewModel.gateways,(function(t){return t.id===e.scope.viewModel.currentGatewayId}))},a.prototype.getCurrentDataSourceModel=function(){var e=this.scope.viewModel.currentDataSourceId;if(e){var t=this.getCurrentGatewayModel();if(t)return _.find(t.dataSources,(function(t){return t.id===e}))}return null},a.prototype.showDiscardPopup=function(){var e=this.services.promiseFactory.defer(),t=this.services.errorService,a=t.control(),i=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),o=[new InJs.ModalDialogAction(i,function(t,i){a.hideDialog(),e.resolve(null)}),new InJs.ModalDialogAction(n,function(t,i){a.hideDialog(),e.reject()})],r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),s=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_DataSourceMessage");return a.showCustomDialog(r,$("<div/>").text(s),o,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0),e.promise},a.prototype.testConnections=function(){if(this.scope.viewModel.gateways)for(var e=0,t=this.scope.viewModel.gateways;e<t.length;e++){var a=t[e];if(this.loadGatewayStatus(a),a.dataSources)for(var i=0,n=a.dataSources;i<n.length;i++){var o=n[i];this.loadDataSourceStatus(a,o)}}},a.prototype.loadGatewayClusters=function(){var e=this;this.scope.isLoading=!0,this.services.gatewaysMetadataService.getGatewayClusters().then((function(a){var i=t.models.GatewayModelConverter.convertSettingsClusters(a);e.scope.viewModel={gateways:i,currentGatewayId:0,currentDataSourceId:0,currentGateway:null,currentDataSource:null,gatewayClusters:i},e.scope.isLoading=!1,e.tryInitializeGatewaySelection(),e.loadGatewaysState()}),(function(t){e.scope.isLoading=!1,e.services.errorService.error(e.services.localizationService.get("SettingsGateways_Error_FailedToLoad"),"SettingsGateways_Error_FailedToLoad")}))},a})();a.GatewaysController=s})(a=t.controllers||(t.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(e,a){var i=this;this.scope=e,this.services=a,this.scope.updateDirtyFlag=function(){return i.updateDirtyFlag()},this.scope.applyChanges=function(){return i.applyChanges()},this.scope.discardChanges=function(){return i.discardChanges()},this.scope.addDataSource=function(){return i.addDataSource()};var n=this.scope.$on(t.constants.onDirtyGatewaySelectionChanging,(function(e,t,a){return i.discardOrCancel(t,a)})),o=this.scope.$on(t.constants.onGatewaySelectionChanged,(function(){return i.initializeGateway()}));this.initializeGateway(),this.scope.$on("$destroy",(function(){n(),o()}))}return a.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","localizationService","gatewaysMetadataService","telemetryService"]}},a.prototype.initializeGateway=function(){var e=this.scope.viewModel;e.contactInformationString=this.getContactInformationString(e.gatewayAnnotation.gatewayContactInformation),this.initializeOriginalValues()},a.prototype.updateDirtyFlag=function(){var e=this.scope.viewModel;e.isDirty=e.displayName!==e.originalValues.name||e.description!==e.originalValues.description||e.gatewayAnnotation.gatewayDepartment!==e.originalValues.department||e.contactInformationString!==e.originalValues.contactInformationString},a.prototype.discardOrCancel=function(e,t){var a=this,i=this.services.errorService.control(),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(n,function(e,n){a.restoreOriginalValues(),a.scope.$apply(),i.hideDialog(),t&&t()}),new InJs.ModalDialogAction(o,function(e,t){i.hideDialog()})],s=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),c=this.services.localizationService.get(e);i.showCustomDialog(s,$("<div/>").text(c),r,(function(e){e.parent().find('input[value="'+o+'"]').focus()}),!0,!0)},a.prototype.restoreOriginalValues=function(){var e=this.scope.viewModel;e.displayName=e.originalValues.name,e.description=e.originalValues.description,e.gatewayAnnotation.gatewayDepartment=e.originalValues.department,e.contactInformationString=e.originalValues.contactInformationString,e.isDirty=!1},a.prototype.initializeOriginalValues=function(){var e=this.scope.viewModel;e.originalValues={name:e.displayName,description:e.description,department:e.gatewayAnnotation.gatewayDepartment,contactInformationString:e.contactInformationString},e.isDirty=!1},a.prototype.getContactInformationString=function(e){var t="";return e&&(t=e.join(";")),t},a.prototype.parseContactInformation=function(e){return e.split(";")},a.prototype.applyChanges=function(){var e=this;if(this.scope.viewModel.gatewayAnnotation.gatewayContactInformation=this.parseContactInformation(this.scope.viewModel.contactInformationString),this.scope.viewModel.isWaitingForGatewayUpdate=!0,this.services.featureSwitchService.featureSwitches.gatewayHighAvailability===!0){var t={name:this.scope.viewModel.displayName,description:this.scope.viewModel.description,annotation:JSON.stringify(this.scope.viewModel.gatewayAnnotation)};this.services.gatewaysMetadataService.updateGatewayCluster(this.scope.viewModel.id,t).then((function(){e.successCallback()}),(function(t){e.errorCallback(t)}))}else{var a={gatewayName:this.scope.viewModel.displayName,gatewayDescription:this.scope.viewModel.description,gatewayAnnotation:JSON.stringify(this.scope.viewModel.gatewayAnnotation)};this.services.gatewaysMetadataService.updateGateway(this.scope.viewModel.id,a).then((function(){e.successCallback()}),(function(t){e.errorCallback(t)}))}},a.prototype.discardChanges=function(){this.discardOrCancel("SettingsGateway_DiscardChangesWarning_GatewaySettingsMessage",null)},a.prototype.addDataSource=function(){this.scope.$emit(t.constants.addDataSourceEventName)},a.prototype.successCallback=function(){this.scope.viewModel.isWaitingForGatewayUpdate=!1,this.initializeOriginalValues()},a.prototype.errorCallback=function(t){this.scope.viewModel.isWaitingForGatewayUpdate=!1,this.services.errorService.error(this.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"UpdateGateway_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})},a})();a.GatewaySettingsController=i})(a=t.controllers||(t.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=e.common.contracts.gateway.GatewayType,n=(function(){function a(e,a){var i=this;this.scope=e,this.services=a,this.scope.viewModel.title=this.services.localizationService.format("SettingsGateways_ConnectToServer",[this.scope.viewModel.serverName]),this.scope.viewModel.gatewayOnlineStatusLabel=this.services.localizationService.format("Gateways_Status_Bracketed",[this.services.localizationService.get("Gateways_Status_Online")]),this.scope.viewModel.gatewayOfflineStatusLabel=this.services.localizationService.format("Gateways_Status_Bracketed",[this.services.localizationService.get("Gateways_Status_Offline")]),this.scope.gatewayTypeSelected=function(){return i.gatewayTypeSelected()},this.scope.enterpriseGatewaySelected=function(e){return i.enterpriseGatewaySelected(e)},this.scope.navigateToManageGateways=function(){return i.navigateToManageGateways()},this.scope.deletePersonalGateway=function(){return i.deletePersonalGateway()},this.scope.usingADMSPGW=function(){return i.usingADMSPGW()},this.scope.$on(t.constants.gatewaySelectionAppliedEventName,(function(){return i.onGatewaySelectionApplied()})),this.scope.$on(t.constants.gatewaySelectionDiscardedEventName,(function(){return i.onGatewaySelectionDiscarded()})),this.scope.isSovereignCloud=this.services.featureSwitchService.featureSwitches.isSovereignCloud,this.populateGatewayTable()}return a.createOptions=function(){return{additionalServices:["telemetryService","errorService","localizationService","selectGatewayService","gatewaysMetadataService","featureSwitchService","navigation"]}},a.prototype.populateGatewayTable=function(){var e=this;this.services.gatewaysMetadataService.getModelDataSources(this.scope.viewModel.modelId).then((function(a){if(e.scope.cachedDiscoverDatasourceResponse=a,0===a.gateways.length&&0===a.datasources.length)return e.scope.viewModel.isCloudScheduleRefresh||e.loadPersonalGateway(),e.scope.viewModel.enterpriseGateways=[],e.scope.viewModel.egwStatusLoaded=!0,void(e.scope.viewModel.useEnterpriseGateway=!1);var n=e.services.selectGatewayService.getAvailableGateways(a);e.scope.viewModel.serverName=e.services.selectGatewayService.getServerName(a),e.scope.viewModel.enterpriseGateways=t.models.GatewayModelConverter.convertSettingsGateways(n.filter((function(e){return e.gatewayType===i.Resource}))),e.loadSelectedGateway(a),e.loadDataSourcesStatus(a.datasources),e.loadDmtsPlaceHolderPersonalGatewayId(a),e.loadPersonalGateway(),e.scope.viewModel.egwStatusLoaded=!0,e.checkIfOnPremMigrationIsAllowed(),e.scope.$emit(t.constants.selectGatewayStatusReadyEventName)}),(function(a){a.error&&a.error.code===t.constants.ServerError_ModelHasNoPowerBIDMMoniker&&(e.scope.viewModel.isCloudScheduleRefresh||e.loadPersonalGateway(),e.scope.viewModel.enterpriseGateways=[],e.scope.viewModel.egwStatusLoaded=!0,e.scope.viewModel.useEnterpriseGateway=!1,e.checkIfOnPremMigrationIsAllowed())}))},a.prototype.loadDmtsPlaceHolderPersonalGatewayId=function(e){var t=_.find(e.gateways,(function(e){return e.gatewayType===i.Personal}));t&&(this.scope.viewModel.dmtsPlaceHolderGatewayId=t.gatewayId)},a.prototype.loadPersonalGateway=function(){var e=this;this.services.gatewaysMetadataService.getPersonalGateway().then((function(a){e.scope.viewModel.pgw=a,e.scope.viewModel.isDMTSPersonalGateway=e.isDMTSPersonalGateway(),e.scope.viewModel.pgwAnnotation=t.models.GatewayModelConverter.getGatewayAnnotation(e.scope.viewModel.pgw),e.updateStatus()}),(function(e){}))},a.prototype.usingADMSPGW=function(){return!(!this.scope.viewModel.showNewPersonalGatewayAvailableMessage||!this.scope.viewModel.pgw||this.scope.viewModel.pgw.gatewayStatus===e.common.contracts.gateway.GatewayStatus.NotInstalled)},a.prototype.checkIfOnPremMigrationIsAllowed=function(){var e=this;this.services.gatewaysMetadataService.checkIfOnPremMigrationIsAllowed().then((function(t){e.scope.viewModel.showNewPersonalGatewayAvailableMessage=!e.scope.viewModel.isCloudScheduleRefresh&&t.IsMigrationAllowed&&t.FirstTimeInstallDMTSPersonalGateway}),(function(e){}))},a.prototype.loadDataSourcesStatus=function(e){if(this.scope.viewModel.showStatus)for(var t=0,a=this.scope.viewModel.enterpriseGateways;t<a.length;t++){var i=a[t];this.getDataSourcesStatus(i,e,this.services.gatewaysMetadataService)}},a.prototype.getDataSourcesStatus=function(t,a,i){var n,o,r=this,s=this.getDataSourceIds(t.id,a);if(n=s.length,0===n)return void(t.status=e.connectivity.models.GatewayStatus.NotReachable);o=!0,t.status=e.connectivity.models.GatewayStatus.Unknown;for(var c=0,l=s;c<l.length;c++){var d=l[c];i.getDataSourceStatus(t.id,d).then((function(){o&&(n--,0===n&&(t.status=e.connectivity.models.GatewayStatus.Live,r.updateStatus()))}),(function(a){o=!1,t.status=e.connectivity.models.GatewayStatus.NotReachable,r.updateStatus()}))}},a.prototype.getDataSourceIds=function(e,t){for(var a=[],i=0,n=t;i<n.length;i++){var o=n[i];o.gatewayId===e&&a.push(o.dataSourceId)}return a},a.prototype.loadSelectedGateway=function(e){var t=this.services.selectGatewayService.getSelectedGateway(e),a=this.services.selectGatewayService.getSelectedGatewayType(t);switch(a){case 0:this.scope.viewModel.selectedGatewayId=-1,this.scope.viewModel.useEnterpriseGateway=void 0,this.scope.viewModel.egwAccessLost=this.services.selectGatewayService.isEGWAccessLost(e);break;case 1:this.scope.viewModel.selectedGatewayId=t.gatewayId,this.scope.viewModel.useEnterpriseGateway=!1;break;case 2:this.scope.viewModel.selectedGatewayId=t.gatewayId,this.scope.viewModel.useEnterpriseGateway=!0}},a.prototype.gatewayTypeSelected=function(){this.scope.viewModel.selectedGatewayId=this.scope.viewModel.useEnterpriseGateway?this.scope.viewModel.enterpriseGateways[0].id:this.scope.viewModel.dmtsPlaceHolderGatewayId,this.scope.viewModel.isDirty=!0},a.prototype.enterpriseGatewaySelected=function(e){
this.scope.viewModel.useEnterpriseGateway=!0,this.scope.viewModel.selectedGatewayId=e,this.scope.viewModel.isDirty=!0},a.prototype.onGatewaySelectionApplied=function(){var e=this;this.services.gatewaysMetadataService.getModelDataSources(this.scope.viewModel.modelId).then((function(a){e.scope.cachedDiscoverDatasourceResponse=a,e.scope.$emit(t.constants.selectGatewayStatusReadyEventName)}),(function(e){})),this.scope.viewModel.isDirty=!1},a.prototype.onGatewaySelectionDiscarded=function(){this.loadSelectedGateway(this.scope.cachedDiscoverDatasourceResponse),this.scope.viewModel.isDirty=!1},a.prototype.updateStatus=function(){if(this.scope.viewModel.pgw&&this.scope.viewModel.pgw.gatewayStatus!==e.common.contracts.gateway.GatewayStatus.NotInstalled){for(var a=0,i=this.scope.viewModel.enterpriseGateways;a<i.length;a++){var n=i[a];if(n.status===e.connectivity.models.GatewayStatus.Unknown)return}this.scope.$emit(t.constants.selectGatewayStatusReadyEventName)}},a.prototype.navigateToManageGateways=function(){this.services.navigation&&this.services.navigation.navigateToGateways()},a.prototype.isDMTSPersonalGateway=function(){if(this.scope.viewModel.pgw){var e=this.services.selectGatewayService.getAvailableGateways(this.scope.cachedDiscoverDatasourceResponse),t=e.filter((function(e){return e.gatewayType===i.Personal}));if(t&&1===t.length)return t[0].gatewayId===this.scope.viewModel.pgw.gatewayId}return!1},a.prototype.deletePersonalGateway=function(){this.tryDeleteGateway(this.scope.viewModel.pgw)},a.prototype.tryDeleteGateway=function(t){var a=this,i=this.services.errorService,n=i.control(),o=this.services.localizationService.get("SettingsGateway_DeleteWarning_YesOption"),r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),s=[new InJs.ModalDialogAction(o,function(i,o){n.hideDialog(),a.services.gatewaysMetadataService.deleteGateway(t.gatewayId).then((function(){a.scope.viewModel.isDMTSPersonalGateway=!1,a.scope.viewModel.showNewPersonalGatewayAvailableMessage=!0,a.loadPersonalGateway()}),(function(t){a.services.errorService.error(a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"Gateways_Error_FailedToDelete",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))}),new InJs.ModalDialogAction(r,function(e,t){n.hideDialog()})],c=this.services.localizationService.get("SettingsGateway_DeletePersonalGatewayWarning_Title"),l=this.services.localizationService.get("SettingsGateway_DeletePersonalGatewayWarning_Message");n.showCustomDialog(c,$("<div/>").text(l),s,(function(e){e.parent().find('input[value="'+r+'"]').focus()}),!0,!0)},a})();a.SelectGatewayController=n})(a=t.controllers||(t.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(){this.restrict="E",this.templateUrl="views/datasourceView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.DataSourceController)}return a})();a.Datasource=i})(a=t.directives||(t.directives={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(){this.restrict="E",this.templateUrl="views/datasourceSettingsView.html",this.replace=!0,this.scope={dataSourceModel:"=datasourceModel"},this.controller=e.common.createController(t.controllers.DataSourceSettingsController)}return a})();a.DatasourceSettings=i})(a=t.directives||(t.directives={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(){this.restrict="E",this.templateUrl="views/datasourceUsersView.html",this.replace=!0,this.scope={dataSourceModel:"=datasourceModel"},this.controller=e.common.createController(t.controllers.DataSourceUsersController)}return a})();a.DatasourceUsers=i})(a=t.directives||(t.directives={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(){this.restrict="E",this.templateUrl="views/gatewayView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.GatewayController)}return a})();a.Gateway=i})(a=t.directives||(t.directives={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(){this.restrict="E",this.templateUrl="views/gatewayAdministratorsView.html",this.replace=!0,this.scope={gatewayModel:"= gatewayModel"},this.controller=e.common.createController(t.controllers.GatewayAdministratorsController)}return a})();a.GatewayAdministrators=i})(a=t.directives||(t.directives={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(){this.restrict="E",this.templateUrl="views/gatewaysView.html",this.replace=!0,this.controller=e.common.createController(t.controllers.GatewaysController)}return a})();a.Gateways=i})(a=t.directives||(t.directives={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(){this.restrict="E",this.replace=!0,this.templateUrl="views/selectGatewayView.html",this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.SelectGatewayController)}return a})();a.SelectGateway=i})(a=t.directives||(t.directives={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){var i=(function(){function a(e,a){this.scope=e,this.services=a;var i=a.gatewayDataService.selectedGatewayDatasource;i.dataSourceAnnotation&&i.dataSourceAnnotation.dataSourceAnnotationUPNMapping||(i.dataSourceAnnotation=t.models.GatewayModelConverter.convertDataSourceAnnotation("")),this.viewModel=_.cloneDeep(a.gatewayDataService.selectedGatewayDatasource.dataSourceAnnotation.dataSourceAnnotationUPNMapping),this.localizedOriginalName=a.localizationService.get("UpnMappingPane_OriginalName"),this.localizedNewName=a.localizationService.get("UpnMappingPane_NewName"),this.localizedResultOfApplyingMappingRule=a.localizationService.get("UpnMappingPane_AfterRuleAppliedPlaceHolder"),this.resetNewRule()}return a.createOptions=function(){return{additionalServices:["gatewayDataService","gatewaysMetadataService","localizationService","errorService","telemetryService","notificationToast"]}},a.prototype.addNewRule=function(){var e=this.newRule;this.viewModel.mappingRules.push({algorithm:e.algorithm,searchString:e.searchString,replacementString:e.replacementString}),this.resetNewRule()},a.prototype.deleteRule=function(){if(this.selectedRule){var e=this.viewModel.mappingRules.indexOf(this.selectedRule);this.viewModel.mappingRules.splice(e,1)}},a.prototype.testRule=function(){var e=this;this.testRuleOriginalName&&(this.isTestRuleRequestPending=!0,this.services.gatewaysMetadataService.getUPNMappingResult([this.testRuleOriginalName],this.viewModel).then((function(t){if(!_.isEmpty(t.upns)){var a=t.upns[0];e.testRuleNewName=a.result}}),(function(){e.services.errorService.error(e.services.localizationService.get("UpnMappingPane_FailToTestUPNRuleMessage"),"FailToTestUPNRuleMessage")})).finally((function(){e.isTestRuleRequestPending=!1})))},a.prototype.saveChangesAndExit=function(){var t=this;this.isUpdateDataSourceRequestPending=!0;var a=JSON.stringify({dataSourceAnnotationUPNMapping:{connectionStringPropertyName:this.viewModel.connectionStringPropertyName,mappingRules:this.viewModel.mappingRules}}),i=this.services.gatewayDataService.selectedGatewayDatasource,n=this.services.telemetryService.startEvent(e.telemetry.SettingsUpdateGatewayDatasourceUPNMapping);this.services.gatewaysMetadataService.updateDataSource(i.gateway.id,i.id,{dataSourceType:null,onPremGatewayRequired:null,connectionDetails:null,credentialDetails:null,dataSourceAnnotation:a,supportedAuthenticationTypes:null}).then((function(){i.dataSourceAnnotation.dataSourceAnnotationUPNMapping=_.cloneDeep(t.viewModel),t.closeUpnMappingPane(),t.services.notificationToast.notify({title:t.services.localizationService.get("UpnMappingPane_SuccessfulMessage"),notificationType:e.common.NotificationToastType.Info}),n.resolve()}),(function(){t.services.errorService.error(t.services.localizationService.get("UpnMappingPane_FailToUpdateMessage"),"FailToUpdateGatewayUPNMapping"),n.reject()})).finally((function(){t.isUpdateDataSourceRequestPending=!1}))},a.prototype.closeUpnMappingPane=function(){this.scope.$emit(t.constants.hideGatewayUserMappingPaneEventName)},a.prototype.selectPre=function(){var e=this.viewModel.mappingRules,t=e.indexOf(this.selectedRule);e.length>1&&t>0&&(this.selectedRule=e[t-1])},a.prototype.selectNext=function(){var e=this.viewModel.mappingRules,t=e.indexOf(this.selectedRule);e.length>1&&t<e.length-1&&(this.selectedRule=e[t+1])},a.prototype.resetNewRule=function(){this.newRule={algorithm:e.common.contracts.gateway.DataSourceAnnotationUPNMappingAlgorithm.SubstringReplacement,searchString:"",replacementString:""}},a})();a.UpnMappingPaneController=i})(a=t.controllers||(t.controllers={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var a;!(function(a){a.UpnMappingPane={templateUrl:"components/upnMappingPane/upnMappingPaneView.html",controller:e.common.createController(t.controllers.UpnMappingPaneController)}})(a=t.components||(t.components={}))})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function a(e,t,a,i){return new r(e,t,a,i)}var i=e.common.contracts.gateway.EncryptedConnection,n=e.common.EncryptionContext,o=e.common.contracts.gateway.PrivacyLevel;t.createGatewayDataService=a;var r=(function(){function a(e,t,a,i){this.gatewaysMetadataService=e,this.promiseFactory=t,this.featureSwitchService=a,this.moduleLoader=i}return a.prototype.getDecodedPublicKey=function(e){return atob(e).split(/<\/Modulus>|<Modulus>/)[1]},a.prototype.encryptCredentials=function(e,t,a,r){var s=this,c=this.promiseFactory.defer();return n.create(JSON.stringify(e),t,r,(function(e){var t={credentials:e,credentialType:a,encryptedConnection:s.featureSwitchService.featureSwitches.enterpriseGatewayETLEnabled?i.NotEncrypted:i.Encrypted,privacyLevel:o.Public,encryptionAlgorithm:"RSA-OAEP"};c.resolve(t)}),this.moduleLoader).then((function(e){e.RSAEncrypt()})),c.promise},a.prototype.createDataSourceWithRetry=function(e,t,a,i){var n=this,o=this.promiseFactory.defer();return this.gatewaysMetadataService.createDataSource(e.id,t).then((function(e){o.resolve(e)}),(function(r){n.updateGatewayPublicKeyIfNeed(e,t.credentialDetails.credentialType,a,i,r).then((function(a){t.credentialDetails=a,n.gatewaysMetadataService.createDataSource(e.id,t).then((function(e){o.resolve(e)}),(function(e){o.reject(e)}))}),(function(){o.reject(r)}))})),o.promise},a.prototype.updateCredentialsWithRetry=function(e,t,a,i,n){var o=this,r=this.promiseFactory.defer();return this.gatewaysMetadataService.updateCredentials(e.id,t,i).then((function(){r.resolve(null)}),(function(s){o.updateGatewayPublicKeyIfNeed(e,i.credentialType,a,n,s).then((function(a){a.privacyLevel=i.privacyLevel,o.gatewaysMetadataService.updateCredentials(e.id,t,a).then((function(){r.resolve(null)}),(function(e){r.reject(e)}))}),(function(){r.reject(s)}))})),r.promise},a.prototype.updateGatewayPublicKeyIfNeed=function(a,i,n,o,r){var s=this,c=this.promiseFactory.defer(),l=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(r.error);return l.always((function(r){if(r&&r.displayableErrorInfo){var l=e.common.localize.get("ServerError_DM_ErrorDetailNameCode_UnderlyingErrorMessage");_.filter(r.displayableErrorInfo,(function(e){return e.errorInfoKey===l}))&&s.gatewaysMetadataService.getGateways().then((function(e){var r=_.filter(e,(function(e){return e.gatewayId===a.id&&a.publicKey!==e.gatewayPublicKey}));if(_.isEmpty(r))c.reject();else{a.publicKey=r[0].gatewayPublicKey;var l=s.getDecodedPublicKey(a.publicKey),d={credentialData:t.models.GatewayModelConverter.convertAuthenticationParametersToCredentialData(n)};s.encryptCredentials(d,l,i,o).then((function(e){c.resolve(e)}),(function(){c.reject()}))}}),(function(e){c.reject()}))}})),c.promise},a})();t.GatewayDataService=r})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function a(e,t,a,i,o,r){return new n(e,t,a,i,o,r)}var i=e.common.contracts.gateway.GatewayType;t.createSelectGatewayService=a;var n=(function(){function e(e,t,a,i,n,o){this.rootScope=e,this.compile=t,this.gatewaysMetadataService=a,this.modalDialogService=i,this.localizationService=n,this.featureSwitchService=o}return e.prototype.bindModelToGateway=function(e,t,a,i){var n=this;this.showDialog(e,(function(i){return n.bindModel(e,i,t,a)}),i)},e.prototype.bindModel=function(e,t,a,i){this.gatewaysMetadataService.bindModelToGateway(e,t).then((function(){a()}),(function(e){i()}))},e.prototype.getAvailableGateways=function(e){if(0===e.monikers.length)return[];if(this.featureSwitchService.featureSwitches.gatewayBindingEnhancement){var t=_.filter(e.monikers,(function(e){return _.some(e.monikerGateways,(function(e){return e.onPremGatewayRequired}))})),a=_.filter(e.monikers,(function(e){return e.monikerDataSources.length>1})),n=_.map(t,(function(e){return _.map(_.filter(e.monikerGateways,(function(e){return e.onPremGatewayRequired})),(function(e){return e.gatewayId}))})),o=_.intersection.apply(_,n),r=_.filter(e.gateways,(function(e){return o.indexOf(e.gatewayId)!==-1&&e.gatewayPublicKey})),s=[];if(a.length>0){for(var c=function(t){if(t.gatewayType!==i.Personal)for(var n=_.filter(e.datasources,(function(e){return e.gatewayId===t.gatewayId})),o=0,r=a;o<r.length;o++){var c=r[o],l=_.filter(c.monikerDataSources,(function(e){return 0===_.filter(n,(function(t){return t.dataSourceType===e.dataSourceType&&t.connectionDetails===e.connectionDetails})).length}));if(l.length>0){s.push(t.gatewayId);break}}},l=0,d=r;l<d.length;l++){var u=d[l];c(u)}r=_.filter(r,(function(e){return s.indexOf(e.gatewayId)===-1}))}return r}var t=_.filter(e.monikers,(function(e){return e.monikerGateways.length>0})),n=_.map(t,(function(e){return _.map(e.monikerGateways,(function(e){return e.gatewayId}))})),g=_.intersection.apply(_,n),r=_.filter(e.gateways,(function(e){return g.indexOf(e.gatewayId)!==-1&&e.gatewayPublicKey}));return r},e.prototype.getServerName=function(e){if(0===e.monikers.length)return null;if(0===e.monikers[0].monikerDataSources.length)return null;try{var t=JSON.parse(e.monikers[0].monikerDataSources[0].connectionDetails);return t.server}catch(e){return null}},e.prototype.getSelectedGateway=function(e){if(this.featureSwitchService.featureSwitches.gatewayBindingEnhancement){for(var t=[],a=!1,n=function(i){if(0===i.monikerDataSources.length)return"continue";var n=_.map(i.monikerDataSources,(function(e){return e.dataSourceId}));if(!_.every(n))return{value:void 0};var o=_.filter(e.datasources,(function(e){return n.indexOf(e.dataSourceId)>-1}));return 0===o.length?{value:void 0}:_.find(o,(function(e){return e.onPremGatewayRequired}))?(a=!0,void(t=t.concat(n))):"continue"},o=0,r=e.monikers;o<r.length;o++){var s=r[o],c=n(s);if("object"==typeof c)return c.value}if(0===t.length&&!a)return _.find(e.gateways,(function(e){return e.gatewayType===i.Personal}));var l=_.filter(e.datasources,(function(e){return t.indexOf(e.dataSourceId)>-1&&e.onPremGatewayRequired})),d=_.map(l,(function(e){return e.gatewayId})),u=_.uniq(d);if(1!==u.length)return;return _.find(e.gateways,(function(e){return u[0]===e.gatewayId}))}for(var g=[],p=_.some(e.monikers,(function(e){return 0===e.monikerDataSources.length})),w=0,v=e.monikers;w<v.length;w++){var s=v[w],y=_.map(s.monikerDataSources,(function(e){return e.dataSourceId}));if(!_.every(y))return p?_.find(e.gateways,(function(e){return _.isEmpty(e.gatewayName)})):void 0;g=g.concat(y)}var l=_.filter(e.datasources,(function(e){return g.indexOf(e.dataSourceId)>-1})),d=_.map(l,(function(e){return e.gatewayId})),S=_.uniq(d);if(1===S.length)return _.find(e.gateways,(function(e){return S[0]===e.gatewayId}))},e.prototype.isEGWAccessLost=function(e){for(var t=[],a=0,i=e.monikers;a<i.length;a++){var n=i[a],o=_.map(n.monikerDataSources,(function(e){return e.dataSourceId}));if(!_.every(o))return!1;t=t.concat(o)}if(t.length>0)for(var r=0,s=t;r<s.length;r++){var c=s[r];if(!_.find(e.datasources,(function(e){return e.dataSourceId===c})))return!0}return!1},e.prototype.getSelectedGatewayType=function(e){return e?_.isEmpty(e.gatewayName)?1:2:0},e.prototype.showDialog=function(a,i,n){var o=new t.models.SelectGatewayModel(a,(!0),(!1),(!1)),r=this.rootScope.$new();r.viewModel=o;var s,c={dialogName:null,isDismissable:!0,scope:r,template:e.htmlTemplate,focusOnFirstButton:!0,dialogCssClass:"gatewaysDialog",dialogActions:[new InJs.ModalDialogAction(this.localizationService.get("SettingsGateways_Connect"),function(e,t){i(o.selectedGatewayId),s.closeDialog()}),new InJs.ModalDialogAction(this.localizationService.get("SettingsGateways_Cancel"),function(e,t){n(),s.closeDialog()})]};s=this.modalDialogService.showLegacyWebModalDialog(c)},e.htmlTemplate="<select-gateway view-model='viewModel'> </select-gateway>",e})();t.SelectGatewayService=n})(t=e.gateways||(e.gateways={}))})(powerbi||(powerbi={})),angular.module("powerbi.gateways").run(["$templateCache",function(e){e.put("components/upnMappingPane/upnMappingPaneView.html",'<div class="upnMappingPane"><header><h3 class="primaryHeading" localize="UpnMappingPane_Title"></h3><h6 class="secondaryHeading" localize="UpnMappingPane_Subtitle" localize-fragments><a fragment-index="0" href="//go.microsoft.com/fwlink/?LinkID=786855" target="_blank" localize="LearnMore"></a></h6></header><section class="contentContainer"><section class="dataSource"><h6 localize="UpnMappingPane_SelectDataSource"></h6><div class="pbi-input inline"> <input type="radio" ng-model="$ctrl.viewModel.connectionStringPropertyName" ng-value="0"/><label class="form-label" localize="UpnMappingPane_EffectiveUserName"></label></div><div class="pbi-input inline"> <input type="radio" ng-model="$ctrl.viewModel.connectionStringPropertyName" ng-value="1"/><label class="form-label" localize="UpnMappingPane_CustomData"></label></div></section><section class="mappingTable"><div class="mappingTableContainer"><div class="caption"><div localize="UpnMappingPane_Replace"></div><div localize="UpnMappingPane_With"></div></div><div class="tableContainer"><table><tr ng-repeat="rule in $ctrl.viewModel.mappingRules track by $index" ng-click="$ctrl.selectedRule = rule" ng-class="{selected: rule === $ctrl.selectedRule}"><td ng-bind="$index + 1"></td><td ng-bind="rule.searchString"></td><td ng-bind="rule.replacementString"></td></tr><tr><td ng-bind="$ctrl.viewModel.mappingRules.length + 1"></td><td> <input name="newSearchString" ng-model="$ctrl.newRule.searchString" placeholder="{{::$ctrl.localizedOriginalName}}"/></td><td> <input name="newReplacementString" ng-model="$ctrl.newRule.replacementString" placeholder="{{::$ctrl.localizedNewName}}"/></td></tr></table></div></div><div class="tableSelectionControl"><i class="glyphicon pbi-glyph-chevronupmedium glyph-small" ng-class="{disabled: !$ctrl.selectedRule}" ng-click="$ctrl.selectPre()"></i><i class="glyphicon pbi-glyph-chevrondownmedium glyph-small" ng-class="{disabled: !$ctrl.selectedRule}" ng-click="$ctrl.selectNext()"></i></div><div> <button localize="UpnMappingPane_Add" ng-disabled="!$ctrl.newRule.searchString || !$ctrl.newRule.replacementString" ng-click="$ctrl.addNewRule()"></button> <button localize="UpnMappingPane_Delete" ng-disabled="!$ctrl.selectedRule" ng-click="$ctrl.deleteRule()"></button></div></section><section class="testRule"><div localize="UpnMappingPane_TestRuleTitle"></div><div class="originalValue"><div localize="UpnMappingPane_OriginalName"></div><div> <input ng-model="$ctrl.testRuleOriginalName" placeholder="{{::$ctrl.localizedOriginalName}}"/> <button localize="UpnMappingPane_TestRuleButtonText" ng-disabled="!$ctrl.testRuleOriginalName" ng-click="$ctrl.testRule()"></button></div></div><div class="replacementValue"><div localize="UpnMappingPane_AfterRuleApplied"></div><div> <input ng-model="$ctrl.testRuleNewName" placeholder="{{::$ctrl.localizedResultOfApplyingMappingRule}}" readonly/><spinner ng-show="$ctrl.isTestRuleRequestPending"></spinner></div></div></section></section><footer><div class="buttons"><spinner ng-show="$ctrl.isUpdateDataSourceRequestPending"></spinner> <button class="biButton primary" type="button" localize="OK_ButtonText" ng-disabled="false" ng-click="$ctrl.saveChangesAndExit()"/> <button class="biButton" type="button" localize="Cancel_ButtonText" ng-click="$ctrl.closeUpnMappingPane()"/></div></footer></div>'),e.put("views/datasourceSettingsView.html",'<div class="formContainer" ng-cloak><header ng-switch on="viewModel.waitingForDataSourceStatus || viewModel.isLoadingForm"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false"><div class="successContainer" ng-if="!viewModel.hasTestConnectionFailure && dataSourceModel.connected"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></span><span localize="SettingsDataSource_SettingsConnectionSuccessfulText"></span></div><div ng-if="dataSourceModel.connectionError"><inline-message use-error-icon trace-details="dataSourceModel.traceDetails"><span localize="SettingsDataSource_SettingsConnectionErrorTitle"></span><span ng-bind="dataSourceModel.connectionError"></span></inline-message></div><div class="messageContainer" ng-switch on="viewModel.messageState"><div ng-switch-when="1"><inline-message class="inlineInfo"><span class="glyphicon glyph-small pbi-glyph-info"></span><span localize="SettingsDataSource_SettingsAddUserText1" localize-fragments><a fragment-index="0" href=\'\' localize="SettingsDataSource_SettingsAddUserText2" ng-click="switchToUserTab()"></a></span></inline-message></div><div ng-switch-when="2"><inline-message use-error-icon trace-details="dataSourceModel.traceDetails"><span ng-bind="dataSourceModel.errorTitle"></span><span ng-bind="dataSourceModel.compositeErrorMessage"></span></inline-message></div></div></div></header><form name="settingsForm" autocomplete="off" ng-hide="viewModel.isLoadingForm"><section><label for="dataSourceName" class="input-field-label" localize="SettingsDataSource_SettingsName"></label> <input id="dataSourceName" select-pristine-on-focus type="text" ng-disabled="!viewModel.isAddingDataSource || viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.dataSourceName" required/></section><section><label for="dataSourceType" class="input-field-label" localize="SettingsDataSource_SettingsType"></label> <select id="dataSourceType" ng-disabled="!viewModel.isAddingDataSource || viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.extendedDataSourceType" ng-change="onDataSourceTypeChange()" ng-options="option.id as option.name for option in viewModel.dataSourceTypeOptions | filter: {name: \'\'}" required><option value="" disabled localize="SettingsGateway_SelectDataSourceType">Select a data source type</option></select></section><div class="connectionSettings" ng-show="viewModel.editableSettings.extendedDataSourceType !== undefined"><section ng-repeat="label in viewModel.dataSourceTypeOptions[viewModel.editableSettings.extendedDataSourceType].labels"> <label for="{{label.name}}" class="input-field-label">{{label.displayName}}</label> <input id="{{label.name}}" type="{{label.type}}" ng-disabled="!viewModel.isAddingDataSource || viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings[label.name]" required/></section><section ng-show="viewModel.dataSourceTypeOptions[viewModel.editableSettings.extendedDataSourceType].authenticationMethodOptions.length> 1"><label for="dataSourceAuthenticationMethod" class="input-field-label" localize="SettingsDataSource_SettingsAuthenticationMethod"></label> <select id="dataSourceAuthenticationMethod" ng-disabled="viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.authenticationMethod" ng-change="onAuthenticationMethodChange()" ng-options="option.id as option.name for option in viewModel.dataSourceTypeOptions[viewModel.editableSettings.extendedDataSourceType].authenticationMethodOptions" required><option value="" disabled localize="SettingsGateway_SelectAnAuthenticationMethod">Select an authentication method</option></select></section><div ng-show="viewModel.editableSettings.authenticationMethod !== undefined && viewModel.editableSettings.authenticationMethod !== 0 && viewModel.editableSettings.authenticationMethod !== 2"><section><span localize="SettingsDataSource_SettingsCredentialEncryptionText"></span> &#32;<a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></section><section ng-show="viewModel.editableSettings.authenticationParameters[0].shouldDisplay"> <label for="authenticationParameter1" class="input-field-label">{{viewModel.editableSettings.authenticationParameters[0].displayName}}</label> <input id="authenticationParameter1" type="text" ng-disabled="viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.authenticationParameters[0].value" ng-change="onAuthenticationParameter1Change()" ng-focus="onAuthenticationParameter1Focus()" ng-blur="onAuthenticationParameter1Blur()" ng-required="viewModel.editableSettings.authenticationParameters[0].shouldDisplay"/></section><section ng-show="viewModel.editableSettings.authenticationParameters[1].shouldDisplay"> <label for="authenticationParameter2" class="input-field-label">{{viewModel.editableSettings.authenticationParameters[1].displayName}}</label> <input id="authenticationParameter2" type="password" ng-disabled="viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.authenticationParameters[1].value" ng-change="onAuthenticationParameter2Change()" ng-focus="onAuthenticationParameter2Focus()" ng-blur="onAuthenticationParameter2Blur()" ng-required="viewModel.editableSettings.authenticationParameters[1].shouldDisplay"/></section></div><section ng-if="enterpriseGatewayETLEnabled"><div class="advancedSettingsContainer" ng-class="{expanded: viewModel.advancedSettingsExpanded}"><i class="glyphicon pbi-glyph-chevronrightmedium expandIcon" ng-click="viewModel.advancedSettingsExpanded = !viewModel.advancedSettingsExpanded; $event.stopPropagation();"></i><span localize="SettingsDataSource_AdvancedSettings"></span><div ng-show="viewModel.advancedSettingsExpanded"><section ng-if="allowSingleSignOn()" id="singleSignOnOptionSection"><div class="singleSignOnSettingCheckBox"> <input id="singleSignOnForDQ" type="checkbox" ng-model="viewModel.isSingleSignOnEnabled" ng-change="onSingleSignOnSettingChange()"/><label class="singleSignOnSettingDescription" localize="SettingsDataSource_SettingsSingleSignOn_Text" for="singleSignOnForDQ"/></div><div class="singleSignOnSettingDescription"><span localize="SettingsDataSource_SettingsSingleSignOn_Info"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></div></section><section><label for="dataSourcePrivacyLevel" class="input-field-label" localize="SettingsDataSource_SettingsPrivacyLevelLabel"></label> <select id="dataSourcePrivacyLevel" ng-disabled="viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.privacyLevel"><option value="0" localize="SettingsDataSource_SettingsPrivacyLevel_None" ng-selected="viewModel.editableSettings.privacyLevel === 0"></option><option value="1" localize="SettingsDataSource_SettingsPrivacyLevel_Private" ng-selected="viewModel.editableSettings.privacyLevel === 1"></option><option value="2" localize="SettingsDataSource_SettingsPrivacyLevel_Organizational" ng-selected="viewModel.editableSettings.privacyLevel === 2"></option><option value="3" localize="SettingsDataSource_SettingsPrivacyLevel_Public" ng-selected="viewModel.editableSettings.privacyLevel === 3"></option></select></section></div></div></section></div><div class="buttonsContainer" ng-if="viewModel.editableSettings.extendedDataSourceType !== undefined"><div ng-switch on="viewModel.isAddingDataSource"> <button class="primary" localize="SettingsDataSource_SettingsApply" ng-switch-when="false" ng-disabled="viewModel.waitingForDataSourceStatus || !settingsForm.$dirty" ng-click="tryApplyChanges()"></button> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-switch-when="true" ng-disabled="viewModel.waitingForDataSourceStatus" ng-click="tryAddDataSource()"></button> <button localize="SettingsDataSource_SettingsDiscard" ng-disabled="!settingsForm.$dirty || viewModel.waitingForDataSourceStatus" ng-click="tryDiscardChanges()" formnovalidate></button></div></div></form></div>'),e.put("views/datasourceUsersView.html",'<div class="formContainer verticalPaneContainer" ng-cloak><div class="leftVerticalPane"><section class="pendingUsersContainer"><label class="input-field-label" localize="SettingsDataSource_UsersAllowed"></label><emails-list view-model="viewModel.pendingUsers" allow-security-groups="true" allow-unified-groups="true"></emails-list></section><section class="editableUsersContainer"><div class="editableUsersTable"><div class="tableContentContainer" ng-switch on="viewModel.isReloadingList || viewModel.isAdding"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false" ng-repeat="editableUser in viewModel.editableUsers" class="pbi-input"> <input type="checkbox" ng-model="editableUser.shouldBeRemoved"> <label class="form-label">{{editableUser.name}}</label></div></div></div> <button localize="SettingsDataSource_SettingsRemove" ng-disabled="viewModel.isReloadingList || shouldDisableRemoveButton()" ng-click="tryRemoveSelectedUsers()"></button> <button class="rightSideButton" ng-if="upnMappingEnabled" localize="UpnMappingPane_Title" ng-disabled="!viewModel.editableUsers || viewModel.editableUsers.length === 0" ng-click="mapUserNames()"></button></section></div><div class="rightVerticalPane"> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-disabled="viewModel.isAdding || !viewModel.pendingUsers.inputUserList" ng-click="tryAddUsers()"></button></div></div>'),e.put("views/datasourceView.html",'<div class="settingsContainer" ng-cloak><div class="tabHeader"><ul><li ng-click="onTabSelected(1)" ng-class="{selected: viewModel.tabSelectionType === 1}" localize="SettingsDataSource_SettingsTitle"></li><li ng-click="onTabSelected(2)" ng-class="{selected: viewModel.tabSelectionType === 2}" ng-if="viewModel.id !== -1" localize="SettingsDataSource_UsersTitle"></li></ul></div><div ng-switch on="viewModel.tabSelectionType"><datasource-settings ng-switch-when="1" datasource-model="viewModel"></datasource-settings><datasource-users ng-switch-when="2" datasource-model="viewModel"></datasource-users></div></div>'),e.put("views/gatewayAdministratorsView.html",'<div class="formContainer verticalPaneContainer" ng-cloak><div class="leftVerticalPane"><section class="pendingUsersContainer"><label class="input-field-label" localize="SettingsDataSource_AdminsAllowed"></label><emails-list view-model="viewModel.pendingUsers" allow-security-groups="true" allow-unified-groups="true"></emails-list></section><section class="editableUsersContainer"><div class="editableUsersTable"><div class="tableContentContainer" ng-switch on="viewModel.isReloadingList || viewModel.isAdding"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false" ng-repeat="editableUser in viewModel.editableUsers" class="pbi-input"> <input type="checkbox" ng-model="editableUser.shouldBeRemoved"> <label class="form-label">{{editableUser.name}}</label></div></div></div> <button class="rightSideButton" localize="SettingsDataSource_SettingsRemove" ng-disabled="viewModel.isReloadingList || shouldDisableRemoveButton()" ng-click="tryRemoveSelectedAdminstrators()"></button></section></div><div class="rightVerticalPane"> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-disabled="viewModel.isAdding || !viewModel.pendingUsers.inputUserList" ng-click="tryAddAdministrators()"></button></div></div>'),
e.put("views/gatewaySettingsView.html",'<div class="formContainer" ng-cloak><header ng-switch="viewModel.isLoadingStatus"><div ng-switch-when="false" ng-switch="viewModel.status"><div ng-switch-when="1"><inline-message use-error-icon trace-details="viewModel.traceDetails"><span ng-bind="viewModel.connectionError"></span></inline-message></div><div ng-switch-when="2"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></span><span localize="SettingsGateway_ConnectedText"></span></div></div><div ng-switch-when="true"><div class="statusContainer"><spinner class="settingsLoadingSpinner"></spinner><span localize="SettingsGateway_WaitingForConnectinonText"></span></div></div><div class="warning" ng-show="viewModel.gatewayUpgradeState === \'UpgradeRequired\'"><inline-message><span localize="SettingsGateway_UpgradeRequiredText"></span></inline-message></div><div class="warning" ng-if="viewModel.status === 2 && viewModel.dataSources.length === 0"><inline-message class="inlineInfo"><span class="glyphicon glyph-small pbi-glyph-info"></span><a href=\'\' localize="AddDataSourceToGatewayText" ng-click="addDataSource()"></a></inline-message></div></header><form name="settingsForm" autocomplete="off"><section><label id="gatewayNameLabel" for="gatewayName" class="input-field-label" localize="SettingsGateway_Name" feature-switch-not="gatewayHighAvailability"></label><label id="gatewayClusterNameLabel" for="gatewayName" class="input-field-label" localize="SettingsGatewayCluster_Name" feature-switch="gatewayHighAvailability"></label> <input id="gatewayName" type="text" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model=viewModel.displayName ng-change="updateDirtyFlag()"/></section><section><label for="gatewayDepartment" class="input-field-label" localize="SettingsGateways_Department"></label> <input id="gatewayDepartment" type="text" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model=viewModel.gatewayAnnotation.gatewayDepartment ng-change="updateDirtyFlag()"/></section><section><label for="gatewayDescription" class="input-field-label" localize="SettingsGateway_Description"></label><textarea id="gatewayDescription" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model="viewModel.description" ng-change="updateDirtyFlag()" ng-trim="false" maxlength="4000"/></section><section><label for="gatewayContactInfo" class="input-field-label" localize="SettingsGateway_ContactInformation"></label><textarea id="gatewayContactInfo" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model="viewModel.contactInformationString" ng-change="updateDirtyFlag()" ng-trim="false" maxlength="4000"/></section><div class="buttonsContainer"> <button class="biButton primary" localize="SettingsDataset_ApplyButtonText" ng-disabled="!viewModel.isDirty" ng-click="applyChanges()"></button> <button class="biButton" localize="SettingsDataSource_SettingsDiscard" ng-disabled="!viewModel.isDirty" ng-click="discardChanges()"></button></div></form></div>'),e.put("views/gatewaysView.html",'<div class="gatewaysSliderContentView" ng-switch="isLoading"><div class="gatewaysLayoutTop"><div class="sliderContentHeader"><div localize="EnterpriseGateway_Title" feature-switch-not="breadcrumbNavigationEnabled"></div><spinner class="large settingsLoadingSpinner" ng-switch-when="true"></spinner></div></div><div class="gatewaysLayoutBody" ng-switch-when="false" ng-switch="viewModel.gateways.length> 0" feature-switch-class="breadcrumbNavigationEnabled"><div ng-switch-when="true"><div class="settingsAddDataSource" ng-click="tryAddDataSource()"><span class="glyphicon glyph-mini pbi-glyph-add" feature-switch-not="breadcrumbNavigationEnabled"></span><span class="settingsAddDataSourceLabel" localize="AddDataSourceText"></span></div><div class="settingsGateways"><div class="settingsGatewaysLeftColumn"><div><span id="gatewayClustersSpan" localize="SettingsGatewayClusters_SettingsTitle" feature-switch="gatewayHighAvailability"></span></div><div class="gatewayTree"><ul><li class="navTreeItem" ng-repeat="gateway in viewModel.gateways" ng-class="{expanded: gateway.isExpanded}"><div ng-click="onItemSelected(gateway.id, null)" ng-class="{selected: gateway.isExpanded ? viewModel.currentGatewayId === gateway.id && viewModel.currentDataSourceId === null : viewModel.currentGatewayId === gateway.id}"><div class="gatewayTreeItem"> <span class="expanderContainer"><i ng-show="gateway.dataSources.length>0" class="glyphicon refreshSectionExpander pbi-glyph-chevronrightmedium expandIcon" ng-click="gateway.isExpanded = !gateway.isExpanded; $event.stopPropagation();"></i></span><span class="gatewayLabel trimmedTextWithEllipsis" ng-bind="gateway.displayName"></span><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon" ng-if="gateway.status != 2"></span> <button class="contextMenuButton" context-menu localize-tooltip="NavigationPane_OpenMenu" context="gateway.contextMenuItem" ng-click="$event.stopPropagation()"><i class="glyphicon pbi-glyph-more gatewayMoreIcon"></i></button></div></div><div class="expandableInnerContainer" ng-show="gateway.isExpanded"><ul><li ng-repeat="dataSource in gateway.dataSources" ng-click="onItemSelected(gateway.id, dataSource.id)" class="gatewayTreeItem" ng-class="{selected: viewModel.currentGatewayId === gateway.id && viewModel.currentDataSourceId === dataSource.id}"><span class="gatewayLabel trimmedTextWithEllipsis" ng-bind="dataSource.displayName"></span><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon" ng-if="dataSource.connectionError || dataSource.compositeErrorMessage"></span> <button class="contextMenuButton" context-menu localize-tooltip="NavigationPane_OpenMenu" context="dataSource.contextMenuItem" ng-click="$event.stopPropagation()"><i class="glyphicon pbi-glyph-more gatewayMoreIcon"></i></button></li></ul></div></li></ul></div><div class="testConnectionContainer"> <button localize="SettingsGateway_TestConnections" ng-click="testConnections()"></button></div></div><div class="settingsGatewaysRightColumn"><div ng-switch on="getSelectionType()"><gateway ng-switch-when="1" view-model="viewModel.currentGateway"></gateway><datasource ng-switch-when="2" view-model="viewModel.currentDataSource"></datasource></div></div></div></div><div class="gatewaysEmpty unselectable" ng-switch-when="false"><i class="glyphicon pbi-glyph-warning glyph-med warningIcon"></i><h2 localize="Gateways_NoGatewaysWarningTitle"></h2><p localize="Gateways_NoGatewaysWarningText"></p><a href="https://go.microsoft.com/fwlink/?LinkId=627094" target="_blank" localize="LearnMore"></a></div></div></div>'),e.put("views/gatewayView.html",'<div class="settingsContainer" ng-cloak><div class="tabHeader"><ul><li ng-click="onTabSelected(1)" ng-class="{selected: viewModel.tabSelectionType === 1}"><span id="gatewaySettingsTitleSpan" localize="SettingsGateway_SettingsTitle" feature-switch-not="gatewayHighAvailability"></span><span id="gatewayClusterSettingsTitleSpan" localize="SettingsGatewayCluster_SettingsTitle" feature-switch="gatewayHighAvailability"></span></li><li ng-click="onTabSelected(2)" ng-class="{selected: viewModel.tabSelectionType === 2}"><span localize="GatewayDataSource_SettingsAdministrators"></span></li></ul></div><div ng-switch on="viewModel.tabSelectionType"><gateway-settings ng-switch-when="1" view-model="viewModel"></gateway-settings><gateway-administrators ng-switch-when="2" gateway-model="viewModel"></gateway-administrators></div></div>'),e.put("views/selectGatewayView.html",'<div class="selectGateway" ng-class="{\'noEGW\': viewModel.enterpriseGateways.length===0, \'singleEGW\': viewModel.enterpriseGateways.length===1, \'multipleEGW\': viewModel.enterpriseGateways.length> 1}"><div localize="SettingsDataset_Gateway_StaticInfo" localize-fragments><a fragment-index="0" localize="SettingsDataset_Gateway_StaticInfo_ManageGateways" href="" ng-click="navigateToManageGateways()"></a></div><div ng-show="::viewModel.showHeader"><div class="title"><span ng-bind="viewModel.title"></span></div></div><div class="gatewayTypeSelectionContainer" ng-show="viewModel.allowPersonalGateway"><div class="gwOption" ng-switch on="viewModel.isCloudScheduleRefresh"><span ng-cloak ng-show="viewModel.showNewPersonalGatewayAvailableMessage && usingADMSPGW()"><label localize="SettingsDataset_New_OnPrem_Gateway_Available_WithExpirationInfo" class="newPersonalGatewayAvailableMessage"></label><a localize="SettingsDataset_OnPrem_Gateway_InstallNow" target="_blank" href="//go.microsoft.com/fwlink/?LinkID=534231" class="pgwLink"></a><a localize="LearnMore" target="_blank" href="//go.microsoft.com/fwlink/?LinkId=843378" class="pgwLink"></a></span><span ng-cloak ng-show="viewModel.showNewPersonalGatewayAvailableMessage && !usingADMSPGW()"><label localize="SettingsDataset_New_OnPrem_Gateway_Available" class="newPersonalGatewayAvailableMessage"></label><a localize="SettingsDataset_OnPrem_Gateway_InstallNow" target="_blank" href="//go.microsoft.com/fwlink/?LinkID=534231" class="pgwLink"></a><a localize="LearnMore" target="_blank" href="//go.microsoft.com/fwlink/?LinkId=843378" class="pgwLink"></a></span> <span class="pbi-input"><input ng-switch-when="false" type="radio" name="pgwRadioOption" ng-model="viewModel.useEnterpriseGateway" ng-value="false" ng-change="gatewayTypeSelected()" ng-disabled="viewModel.pgw.gatewayStatus === 1"><label ng-switch-when="false" class="form-label" localize="SettingsDataset_GatewaySelectLabel_PGW"></label> <input ng-switch-when="true" type="radio" name="pgwRadioOption" ng-model="viewModel.useEnterpriseGateway" ng-value="false" ng-change="gatewayTypeSelected()" ng-disabled="isSovereignCloud"><label ng-switch-when="true" class="form-label" localize="SettingsDataset_GatewaySelectLabel_Cloud"></label></span><span class="additionalInfo" ng-switch-when="false"><span ng-show="viewModel.pgw.gatewayStatus === 0" localize="Gateways_StatusWithMachineName" localize-fragments><span fragment-index="0" class="gatewayStatusLabelOnline" localize="Gateways_Status_Online"></span><span fragment-index="1" ng-bind="viewModel.pgwAnnotation.gatewayMachine"></span></span><span ng-show="viewModel.pgw.gatewayStatus === 2 || viewModel.pgw.gatewayStatus === 3" localize="Gateways_StatusWithMachineName" localize-fragments><span fragment-index="0" class="gatewayStatusLabelOffline" localize="Gateways_Status_Offline"></span><span fragment-index="1" ng-bind="viewModel.pgwAnnotation.gatewayMachine"></span></span><span ng-show="viewModel.isDMTSPersonalGateway"><a localize="SettingsGateway_DeletePersonalGateway" target="_blank" class="pgwLink" ng-click="deletePersonalGateway()"></a></span></span></div><div class="gwOption"> <span class="pbi-input"><input type="radio" name="egwRadioOption" ng-model="viewModel.useEnterpriseGateway" ng-value="true" ng-change="gatewayTypeSelected()" ng-disabled="!viewModel.egwStatusLoaded || viewModel.enterpriseGateways.length === 0"><label class="form-label" localize="SettingsDataset_GatewaySelectLabel_EGW"></label></span><spinner ng-show="!viewModel.egwStatusLoaded"></spinner></div></div><div ng-show="viewModel.egwStatusLoaded"><div class="gatewaysIntroText hideIfNoEGW hideIfSingleEGW" localize="Gateways_MultipleEnterpriseGatewaysText"></div><div class="gatewaysIntroText hideIfNoEGW hideIfMultipleEGW" localize="Gateways_SingleEnterpriseGatewaysText" ng-show="!viewModel.allowPersonalGateway"></div><div class="gatewaysIntroText hideIfSingleEGW hideIfMultipleEGW" localize="Gateways_NoEnterpriseGatewaysText" ng-show="!viewModel.allowPersonalGateway"></div></div><div class="gatewaysTableOuterContainer hideIfNoEGW" ng-switch on="viewModel.egwStatusLoaded"><spinner ng-switch-when="false"></spinner><div class="gatewaysTableInnerContainer" ng-switch-when="true"><table class="gatewaysTable"><thead class="gatewaysTableHeader"><tr><th class="gatewaysTableSelection hideIfNoEGW hideIfSingleEGW"></th><th class="gatewaysTableStatus" ng-show="viewModel.showStatus"><div class="gatewaysTableHeaderContent" localize="SettingsGateways_Status"></div></th><th class="gatewaysTableDepartmentName"><div class="gatewaysTableHeaderContent" localize="SettingsGateways_Department"></div></th><th class="gatewaysTableGatewayName"><div class="gatewaysTableHeaderContent" localize="SettingsGateways_Gateway"></div></th><th class="gatewaysTableCreatedBy"><div class="gatewaysTableHeaderContent" localize="SettingsGateways_ContactInformation"></div></th><th class="gatewaysTableGatewayDescription"><div class="gatewaysTableHeaderContent" localize="SettingsGateway_Description"></div></th></tr></thead><tbody class="gatewaysTableBody"><tr ng-repeat="gateway in viewModel.enterpriseGateways" ng-click="enterpriseGatewaySelected(gateway.id)"><td class="egwRadioButton hideIfNoEGW hideIfSingleEGW"><div class="pbi-input"> <input type="radio" name="gwRadioOption" ng-model="viewModel.selectedGatewayId" ng-value="gateway.id" ng-click="enterpriseGatewaySelected(gateway.id)"><label class="dummyRadioButtonLabel"></label></div></td><td ng-show="viewModel.showStatus"><span ng-show="gateway.status === 1" class="gatewayStatusLabelOffline" localize="Gateways_Status_Offline"></span><span ng-show="gateway.status === 2" class="gatewayStatusLabelOnline" localize="Gateways_Status_Online"></span><spinner ng-show="gateway.status === 3" class="gatewayStatusSpinner glyph-mini"></spinner></td><td class="trimmedTextWithEllipsis"><span ng-bind="gateway.gatewayAnnotation.gatewayDepartment" title="{{gateway.gatewayAnnotation.gatewayDepartment}}"></span></td><td class="trimmedTextWithEllipsis"><span ng-if="gateway.displayName" ng-bind="gateway.displayName" title="{{gateway.displayName}}"></span><span ng-if="!gateway.displayName" localize="SettingsGateways_ConnectToCloudDatasource"></span></td><td class="trimmedTextWithEllipsis"><span ng-bind="gateway.gatewayAnnotation.gatewayContactInformation.join(\';\')" title="{{gateway.gatewayAnnotation.gatewayContactInformation.join(\';\')}}"></span></td><td><span ng-bind="gateway.description" title="{{gateway.description}}"></span></td></tr></tbody></table></div></div></div>')}]);;"use strict";var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){t.userNotificationsInfoService="userNotificationsInfoService"})(i=t.constants||(t.constants={}))})(i=t.userNotifications||(t.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){angular.module("powerbi.userNotifications",[]).factory("userNotificationHttp",[function(){return t.userNotifications.createUserNotificationHttpService()}]).factory("userNotificationInfo",["userNotificationHttp","promiseFactory","telemetryService","$window","$interval","asyncFeatureSwitchService","syncService","userInfo","$timeout",function(i,e,o,n,s,a,r,c,f){return t.userNotifications.createUserNotificationInfoService({userNotificationHttpService:i,promiseFactory:e,telemetryService:o,intervalService:s,asyncFeatureSwitchService:a,syncService:r,userInfo:c,timeout:f},!0)}]).factory("userNotificationTileFilterService",["userNotificationInfo",function(i){return t.userNotifications.createUserNotificationTileFilterService(i)}])})(i=t.userNotifications||(t.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){var i;!(function(t){t[t.NewFeatureProductMessage=0]="NewFeatureProductMessage",t[t.DashboardSharing=2]="DashboardSharing",t[t.DashboardAddedToGroup=3]="DashboardAddedToGroup",t[t.Trial=5]="Trial",t[t.DataDrivenAlert=6]="DataDrivenAlert",t[t.DynamicMessage=999]="DynamicMessage"})(i=t.NotificationCategory||(t.NotificationCategory={}));var e;!(function(t){t[t.DashboardContentPackNewVersion=0]="DashboardContentPackNewVersion",t[t.UsersNotifications_SharedDashboard=1]="UsersNotifications_SharedDashboard",t[t.ExtendTrial_TrialExpired=2]="ExtendTrial_TrialExpired",t[t.UsersNotifications_TrialRunsOutInLessThanADay=3]="UsersNotifications_TrialRunsOutInLessThanADay",t[t.UsersNotifications_TrialRunningOut=4]="UsersNotifications_TrialRunningOut",t[t.UsersNotifications_TitleTrialExpired=5]="UsersNotifications_TitleTrialExpired",t[t.UsersNotifications_UserName=6]="UsersNotifications_UserName",t[t.UsersNotifications_GoToApp=7]="UsersNotifications_GoToApp",t[t.UsersNotifications_GoToDashboard=8]="UsersNotifications_GoToDashboard",t[t.UsersNotifications_TrialRunsOutInOneDay=9]="UsersNotifications_TrialRunsOutInOneDay",t[t.UsersNotifications_TitleTrialRunsOutInOneDay=10]="UsersNotifications_TitleTrialRunsOutInOneDay",t[t.UsersNotifications_TitleTrialRunsOutInLessThanADay=11]="UsersNotifications_TitleTrialRunsOutInLessThanADay",t[t.UsersNotifications_TitleTrialRunningOut=12]="UsersNotifications_TitleTrialRunningOut",t[t.UsersNotifications_RequestExtensionLinkText=13]="UsersNotifications_RequestExtensionLinkText",t[t.UsersNotifications_DataDrivenAlert=14]="UsersNotifications_DataDrivenAlert",t[t.UsersNotifications_GroupName=15]="UsersNotifications_GroupName",t[t.UsersNotifications_NewDashboard=16]="UsersNotifications_NewDashboard",t[t.UsersNotifications_TileName=17]="UsersNotifications_TileName",t[t.UsersNotifications_DataDrivenDown=18]="UsersNotifications_DataDrivenDown",t[t.UsersNotifications_DataDrivenUp=19]="UsersNotifications_DataDrivenUp",t[t.UsersNotifications_GoToTile=20]="UsersNotifications_GoToTile",t[t.UsersNotifications_DatasetSettingChangeTitle=21]="UsersNotifications_DatasetSettingChangeTitle",t[t.UsersNotifications_DatasetInGroupWorkspaceSettingChangeMessage=22]="UsersNotifications_DatasetInGroupWorkspaceSettingChangeMessage",t[t.UsersNotifications_DatasetInMyWorkspaceSettingChangeMessage=23]="UsersNotifications_DatasetInMyWorkspaceSettingChangeMessage",t[t.UsersNotifications_LearnMore=24]="UsersNotifications_LearnMore",t[t.UsersNotifications_Upgrade=25]="UsersNotifications_Upgrade",t[t.UsersNotifications_AlertTitle=1e3]="UsersNotifications_AlertTitle",t[t.UsersNotifications_AlertExceeded=1001]="UsersNotifications_AlertExceeded",t[t.UsersNotifications_AlertWentBelow=1002]="UsersNotifications_AlertWentBelow",t[t.UsersNotifications_AlertAction=1003]="UsersNotifications_AlertAction",t[t.UsersNotifications_AlertExceededNoTileName=1004]="UsersNotifications_AlertExceededNoTileName",t[t.UsersNotifications_AlertWentBelowNoTileName=1005]="UsersNotifications_AlertWentBelowNoTileName"})(e=t.NotificationResource||(t.NotificationResource={}));var o;!(function(t){t[t.DismissAll=0]="DismissAll",t[t.Dismiss=1]="Dismiss",t[t.SeenAll=2]="SeenAll",t[t.Seen=3]="Seen"})(o=t.UserNotificationsStatus||(t.UserNotificationsStatus={}))})(i=t.contracts||(t.contracts={}))})(i=t.userNotifications||(t.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){var e=jsCommon.DateExtensions,o=t.common.utils.DateFormatter,n=(function(){function i(t,i){this.contract=t,this.localizationService=i,t.message&&(t.message.title&&(this.title=t.message.title.text||this.getLocalizedValue(t.message.title)),t.message.message&&(this.description=t.message.message.text||this.getLocalizedValue(t.message.message)),this.image=t.message.image);var n=t.createdTime;this.formattedDate=n?o.getPrettyRelativeDate(e.parseUtcDate(n),this.localizationService):"",this.seen=t.seen,t.action&&(this.actionText=t.action.resource.text?t.action.resource.text:this.getLocalizedValue(t.action.resource),this.actionPath=t.action.path,this.actionType=t.action.actionType)}return i.prototype.getLocalizedValue=function(i){var o=t.userNotifications.contracts.NotificationResource[i.displayTextResource];if(o&&i.values&&i.values.length>0){for(var n=[],s=0,a=i.values;s<a.length;s++){var r=a[s];switch(r.NotificationValueType){case 2:n.push(this.localizationService.formatValue(e.parseUtcDate(r.value)));break;case 1:var c=parseFloat(r.value);if(r.Format){var f=t.formattingService.formatValue(c,r.Format);n.push(this.localizationService.formatValue(f))}else n.push(this.localizationService.formatValue(r.value));break;default:n.push(this.localizationService.formatValue(r.value))}}return this.localizationService.format(o,n)}return this.localizationService.get(o)},i})();i.UserNotificationModel=n})(e=i.models||(i.models={}))})(i=t.userNotifications||(t.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){function e(){return new o}i.createUserNotificationHttpService=e;var o=(function(){function i(){}return i.prototype.getActiveNotification=function(i,e,o){var n=t.common.httpService.powerbiRequestOptions(i,"LoadMoreNotifications"),s="metadata/notifications?take="+e;return o&&(s=s+"&skip="+o),t.common.httpService.get(s,n)},i.prototype.getActiveNotificationSummary=function(i,e){var o=t.common.httpService.powerbiRequestOptions(i,"GetUserNotificationsSummary");return t.common.httpService.get("metadata/notifications/summary?take="+e,o)},i.prototype.updateNotificationStatus=function(i,e,o){var n;return n=o?t.common.httpService.powerbiRequestOptions(o,"UpdateUserNotificationsStatus"):t.common.httpService.powerbiRequestOptions(),t.common.httpService.put("metadata/notifications/"+i+"/action/"+e,null,n)},i.prototype.markNotificationsSeen=function(i,e){var o;o=e?t.common.httpService.powerbiRequestOptions(e,"UpdateUserNotificationsStatus"):t.common.httpService.powerbiRequestOptions();var n={ids:i};return t.common.httpService.put("metadata/notifications/action/"+t.userNotifications.contracts.UserNotificationsStatus.Seen+"/collections",n,o)},i})()})(i=t.userNotifications||(t.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){function e(t,i,e){return o||(o=new r(t,i,e)),o}var o;i.createUserNotificationInfoService=e;var n=100,s=6e5,a=6e3,r=(function(){function e(t,i,e){var o=this;this.notificationsUpdatedListeners=[],this.clientNotificationId=0,this.services=t,i&&!e&&(this.userNotifications={totalCount:0,unseenCount:0,notifications:[]},t.timeout((function(){o.initialize()}),a))}return e.prototype.getNextPageData=function(i){var e=this;i||(i=n);var o=this.services.telemetryService.startEvent(t.telemetry.UserNotificationsLoadMoreNotifications),s=this.userNotifications.notifications[this.userNotifications.notifications.length-1].id;this.services.userNotificationHttpService.getActiveNotification(o.event,i,s).then((function(t){e.userNotifications.notifications=e.userNotifications.notifications.concat(e.filterNotSupportedNotifications(t.data)),e.notifyNotificationsUpdated(),o.resolve()}),(function(t){o.reject()}))},e.prototype.registerNotificationsUpdatedListener=function(t){this.notificationsUpdatedListeners.push(t)},e.prototype.updateLastSeenDate=function(){if(this.userNotifications){this.userNotifications.unseenCount=0;var t=this.getLatestNotificationForServer(),e=t&&!t.seen;this.userNotifications.notifications.forEach((function(t){t.seen=!0})),this.notifyNotificationsUpdated(),e&&this.services.userNotificationHttpService.updateNotificationStatus(t.id,i.contracts.UserNotificationsStatus.SeenAll).then((function(t){}),(function(t){}))}},e.prototype.updateSeenNotifications=function(t){this.userNotifications&&(this.userNotifications.unseenCount-=t.length,this.userNotifications.notifications.forEach((function(i){_.contains(t,i.id)&&(i.seen=!0)})),this.notifyNotificationsUpdated(),this.services.userNotificationHttpService.markNotificationsSeen(t))},e.prototype.dismissNotification=function(e,o){if(this.userNotifications.totalCount=this.userNotifications.totalCount-1,this.userNotifications.notifications=_.filter(this.userNotifications.notifications,(function(t){return t.id!==e.id})),e.seen||(this.userNotifications.unseenCount=this.userNotifications.unseenCount-1),this.notifyNotificationsUpdated(),!o&&e.id>0){var n=this.services.telemetryService.startEvent(t.telemetry.UserNotificationsDismissNotification);this.services.userNotificationHttpService.updateNotificationStatus(e.id,i.contracts.UserNotificationsStatus.Dismiss,n.event).then((function(t){n.resolve()}),(function(t){n.reject()}))}},e.prototype.dismissAll=function(){if(this.userNotifications&&this.userNotifications.notifications.length>0){var e=this.getLatestNotificationForServer();if(this.userNotifications.totalCount=0,this.userNotifications.unseenCount=0,this.userNotifications.notifications=[],this.notifyNotificationsUpdated(),e){var o=this.services.telemetryService.startEvent(t.telemetry.UserNotificationsDismissAllNotifications);this.services.userNotificationHttpService.updateNotificationStatus(e.id,i.contracts.UserNotificationsStatus.DismissAll,o.event).then((function(t){o.resolve()}),(function(t){o.reject()}))}}},e.prototype.onNotificationAdded=function(){this.getActiveNotification(n)},e.prototype.onNotificationDismiss=function(t){var i=_.find(this.userNotifications.notifications,(function(i){return i.id===t}));i&&this.dismissNotification(i,!0)},e.prototype.onNotificationSeen=function(t){var i=this,e=!1;this.userNotifications.notifications.forEach((function(o){o.id<=t&&o.id>0&&!o.seen&&(o.seen=!0,i.userNotifications.unseenCount=i.userNotifications.unseenCount-1,e=!0)})),e&&this.notifyNotificationsUpdated()},e.prototype.onNotificationDismissAll=function(){this.userNotifications.totalCount>0&&this.getActiveNotification(n)},e.prototype.loadIcon=function(t){if(!t.iconUrl&&t.message.image&&t.message.image.imagePath)switch(t.message.image.imageType){case 0:this.services.userInfo.findOrGetUserPhoto(t.message.image.imagePath).then((function(i){t.iconUrl=i}));break;case 1:this.services.userInfo.findOrGetGroupPhoto(t.message.image.imagePath).then((function(i){t.iconUrl=i}))}},e.prototype.addClientNotification=function(t){t&&(t.id=this.clientNotificationId--,t.seen=!1,this.userNotifications&&(this.userNotifications.totalCount++,this.userNotifications.unseenCount++,this.userNotifications.notifications=[t].concat(this.userNotifications.notifications),this.notifyNotificationsUpdated()))},e.prototype.getHighestNotificationLevel=function(t){return!this.userNotifications||_.isEmpty(this.userNotifications.notifications)?1:_.max(t,(function(t){return t.notificationLevel})).notificationLevel},e.prototype.initialize=function(){var t=this;this.getActiveNotification(n),this.services.syncService.addNotificationsRefreshListener(this),this.services.intervalService((function(){t.getActiveNotification(n)}),s)},e.prototype.getLatestNotificationForServer=function(){var t=_.find(this.userNotifications.notifications,(function(t){return t.id>0&&!t.seen}));return t},e.prototype.mergeNotifications=function(t){if(t){this.userNotifications.totalCount=t.totalCount,this.userNotifications.unseenCount=t.unseenCount;var i=_.filter(this.userNotifications.notifications,(function(t){return t.id<=0}));if(i&&i.length>0){this.userNotifications.totalCount=t.totalCount+i.length;var e=_.filter(i,(function(t){return!t.seen}));e&&e.length>0&&(this.userNotifications.unseenCount=t.unseenCount+e.length)}var o=[],n=_.map(this.userNotifications.notifications,(function(t){return t.id}));o=_.filter(t.notifications,(function(t){return n.indexOf(t.id)<0})),o.length>0&&(i&&i.length>0?this.userNotifications.notifications=i.concat(o).concat(_.filter(this.userNotifications.notifications,(function(t){return t.id>0}))):this.userNotifications.notifications=o.concat(this.userNotifications.notifications))}},e.prototype.notifyNotificationsUpdated=function(){this.notificationsUpdatedListeners.forEach((function(t){t()}))},e.prototype.getActiveNotification=function(i){var e=this;void 0===i&&(i=n);var o=this.services.telemetryService.startEvent(t.telemetry.UserNotificationsGetNotificationsSummary);this.services.userNotificationHttpService.getActiveNotificationSummary(o.event,i).then((function(t){var i=e.filterNotSupportedUserNotifications(t.data);e.userNotifications&&e.userNotifications.notifications?e.mergeNotifications(i):e.userNotifications=i,e.notifyNotificationsUpdated(),o.resolve()}),(function(t){o.reject()}))},e.prototype.filterNotSupportedUserNotifications=function(t){if(t&&t.totalCount>0){t.notifications=this.filterNotSupportedNotifications(t.notifications);var i=_.filter(t.notifications,(function(t){return!t.seen}));t.unseenCount=i?i.length:0}return t},e.prototype.filterNotSupportedNotifications=function(t){return _.filter(t,(function(t){return i.contracts.NotificationCategory[t.notificationCategory]}))},e})()})(i=t.userNotifications||(t.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){function i(t){return new e(t)}t.createUserNotificationTileFilterService=i;var e=(function(){function t(t){this.userNotificationInfoService=t}return t.prototype.filterNotifications=function(t,i){if(_.isEmpty(t))return[];var e=i?i:this.tileId;return e?_.filter(t,(function(t){var i=t.message.filterProperties?t.message.filterProperties.TileId:null;if(!i)return!1;var o=parseInt(i,10);return(2===t.action.actionType||3===t.action.actionType)&&o===e})):t},t})()})(i=t.userNotifications||(t.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){function e(e,o,n,s,r,f,u,N,l){var p=i.Verbose(e,o,n,s,r,f,u,N,l),h=c(p.info,{}),m={name:"PBI.UserNotifications.GetNotificationsSummary",category:t.TelemetryCategory.Verbose,time:Date.now(),id:a(),formatted:function(){return t.extendFormatted(null,null,p.formatted())},info:h,loggers:i.UserNotificationsGetNotificationsSummaryLoggers};return m}function o(e,o,n,s,r,f,u,N,l){var p=i.CustomerAction(e,o,n,s,r,f,u,N,l),h=c(p.info,{}),m={name:"PBI.UserNotifications.LoadMoreNotifications",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:a(),formatted:function(){return t.extendFormatted(null,null,p.formatted())},info:h,loggers:i.UserNotificationsLoadMoreNotificationsLoggers};return m}function n(e,o,n,s,r,f,u,N,l){var p=i.CustomerAction(e,o,n,s,r,f,u,N,l),h=c(p.info,{}),m={name:"PBI.UserNotifications.DismissNotification",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:a(),formatted:function(){return t.extendFormatted(null,null,p.formatted())},info:h,loggers:i.UserNotificationsDismissNotificationLoggers};return m}function s(e,o,n,s,r,f,u,N,l){var p=i.CustomerAction(e,o,n,s,r,f,u,N,l),h=c(p.info,{}),m={name:"PBI.UserNotifications.DismissAllNotifications",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:a(),formatted:function(){return t.extendFormatted(null,null,p.formatted())},info:h,loggers:i.UserNotificationsDismissAllNotificationsLoggers};return m}var a,r=jsCommon.Utility,c=jsCommon.UnionExtensions.mergeUnionType;a=r?r.generateGuid:Function.prototype,i.UserNotificationsGetNotificationsSummary=e,i.UserNotificationsLoadMoreNotifications=o,i.UserNotificationsDismissNotification=n,i.UserNotificationsDismissAllNotifications=s})(i=t.telemetry||(t.telemetry={}))})(powerbi||(powerbi={}));;"use strict";var __assign=this&&this.__assign||Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++){t=arguments[o];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},__extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}})(),__awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))(function(i,a){function n(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new o(function(t){t(e.value)}).then(n,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function o(e){return function(t){return r([e,t])}}function r(o){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(n=a[2&o[0]?"return":o[0]?"throw":"next"])&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[0,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return c.label++,{value:o[1],done:!1};case 5:c.label++,a=o[1],o=[0];continue;case 7:o=c.ops.pop(),c.trys.pop();continue;default:if(n=c.trys,!(n=n.length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){c=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){c.label=o[1];break}if(6===o[0]&&c.label<n[1]){c.label=n[1],n=o;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(o);break}n[2]&&c.ops.pop(),c.trys.pop();continue}o=t.call(e,c)}catch(e){o=[6,e],a=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var i,a,n,s,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},powerbi;!(function(e){var t;!(function(t){var o;!(function(t){t.contentPackDirtyShowNotification="contentPackDirty",t.reportDeletedEventName="reportDeleted",t.onDatasetAddedEventName="onDatasetAdded",t.deleteModelFailedEventName="deleteModelFailed",t.deleteModelStartedEventName="deleteModelStarted",t.onDashboardShallowEditEventName="onDashboardShallowEdit",t.mergeDashboardContainerModelsReportsAndPackagesEventName="mergeDashboardContainerModelsReportsAndPackages",t.updateDashboardContainerEventName="updateDashboardContainer",t.addOrUpdateDashboardEventName="addOrUpdateDashboard",t.samplesContentProviderId=-1,t.initialDashboardContainerLoadingState="#loading#",t.initialDashboardContainerErrorState="#error#",t.initialDashboardContainerReadyEventName="initialDashboardContainerReady",t.CannotDeleteModelPublishedToOrganizationalAppHeader="CannotDeleteModelPublishedToOrganizationalApp",t.shouldShowEnableCustomVisualsDialog="shouldShowEnableCustomVisualsDialog",t.seenDashboardsStorageKey="seenSharedDashboards",t.ScopedInstanceProviderName="dataServices",t.dashboardElementName=".dashboard";var o;!(function(e){e.reloadExcelWorkbookEventName="reloadExcelWorkbook",e.pinClickedEventName="pinClicked",e.editInExcelOnlineClickedEventName="editInExcelOnlineClicked",e.editInExcelClickedEventName="editInExcelClicked",e.calculateWorkbookClickedEventName="calculateWorkbookClicked",e.bindToExcelWorkbookEventName="bindToExcelWorkbook",e.openWorkbookContextMenuEventName="openWorkbookContextMenu",e.viewWorkbookEventName="viewWorkbook",e.renameWorkbookEventName="renameWorkbook",e.editWorkbookEventName="editWorkbook",e.scheduleRefreshWorkbookEventName="scheduleRefreshWorkbook",e.refreshNowWorkbookEventName="refreshNowWorkbook",e.removeWorkbookEventName="removeWorkbook",e.excelWebAppScriptsLoaded="excelWebAppScriptsLoaded",e.defaultKeepOriginalContentSize=!1,e.workbookAddedEventName="workbookAdded"})(o=t.workbook||(t.workbook={})),t.SingleValueRealTimeWindow=250,t.MultipleValueRealTimeWindow=6e4,t.RealTimeIntervals=[1,5,10,15,20,25,30,45,60],t.RealTimeDataSourceName="_RealTimeSchema_",t.modelPlaceholderImageUrl="/"+e.build+"/images/modelPlaceholder.png",t.packagePublishedSuccessfullyEventName="packagePublishedSuccessfully",t.packageVersionChange="packageVersionChange";var r;!(function(e){e.TileConfigVersion="1.1",e.NoVisualType="No visual type"})(r=t.upgrader||(t.upgrader={}))})(o=t.constants||(t.constants={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(o,r,i,a,n,s,c,l,d){var p=t.CustomerAction(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.RenameReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardRenameReportLoggers};return h}function r(o,r,i,a,n,s,c,l,d){var p=t.CustomerAction(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.DeleteReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardDeleteReportLoggers};return h}function i(o,r,i,a,n,s,c,l,d){var p=t.Verbose(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.InitializeNavigationPaneReports",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardInitializeNavigationPaneReportsLoggers};return h}function a(o,r,i,a,n,s,c,l,d){var p=t.Verbose(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.InitializeNavigationPaneModels",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardInitializeNavigationPaneModelsLoggers};return h}function n(o,r,i,a,n,s,c,l,d){var p=t.CustomerAction(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.RenameDataset",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardRenameDatasetLoggers};return h}function s(o,r,i,a,n,s,c,l,d,p,u){var h=t.CustomerAction(i,a,n,s,c,l,d,p,u),m=_(h.info,{cortanaValue:o,qnaValue:r}),f={name:"PBI.Dashboard.UpdateModelQnaFeatures",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({cortanaValue:m.cortanaValue,qnaValue:m.qnaValue},null,h.formatted())},info:m,loggers:t.DashboardUpdateModelQnaFeaturesLoggers};return f}function c(o,r,i,a,n,s,c,l,d,p){var u=t.CustomerAction(r,i,a,n,s,c,l,d,p),h=_(u.info,{count:o}),m={name:"PBI.Dashboard.UpdateFeaturedQuestions",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({count:h.count},null,u.formatted())},info:h,loggers:t.DashboardUpdateFeaturedQuestionsLoggers};return m}function l(o,r,i,a,n,s,c,l,d){var p=t.CustomerAction(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.DeleteDataset",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardDeleteDatasetLoggers};return h}function d(o,r){var i={tileType:o,message:r},a={name:"PBI.Dashboard.TileError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({tileType:i.tileType,message:i.message},null)},info:i,loggers:t.DashboardTileErrorLoggers};return a}function p(o,r,i,a,n,s,c,l,d){var p=t.CustomerAction(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.AddUpdateDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardAddUpdateDashboardLoggers};return h}function u(o,r,i,a,n,s,c,l,d,p,u,h){var m=t.Verbose(a,n,s,c,l,d,p,u,h),f=_(m.info,{numNewUnseenSharedDashboards:o,numSharedDashboards:r,numAllDashboards:i}),v={name:"PBI.Dashboard.SharingNewUnseenDashboards",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({numNewUnseenSharedDashboards:f.numNewUnseenSharedDashboards,numSharedDashboards:f.numSharedDashboards,numAllDashboards:f.numAllDashboards},null,m.formatted())},info:f,loggers:t.DashboardSharingNewUnseenDashboardsLoggers};return v}function h(o,r,i,a,n,s,c,l,d){var p=t.Verbose(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.InitializeNavigationPaneWorkbooks",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardInitializeNavigationPaneWorkbooksLoggers};return h}function m(o,r,i,a,n,s,c,l,d){var p=t.CustomerAction(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.UpdateLocalWorkbookNeverShowExplanation",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardUpdateLocalWorkbookNeverShowExplanationLoggers};return h}function f(o,r,i,a,n,s,c,l,d){var p=t.CustomerAction(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.RenameWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardRenameWorkbookLoggers};return h}function v(o,r,i,a,n,s,c,l,d,p,u){var h=t.CustomerAction(i,a,n,s,c,l,d,p,u),m=_(h.info,{storageProvider:o,contentProvider:r}),f={name:"PBI.Dashboard.RemoveWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({storageProvider:m.storageProvider,contentProvider:m.contentProvider},null,h.formatted())},info:m,loggers:t.DashboardRemoveWorkbookLoggers};return f}function g(o,r,i,a,n,s,c,l,d){var p=t.CustomerAction(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.GetWorkbookWopiAccessInformation",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardGetWorkbookWopiAccessInformationLoggers};return h}function y(o,r,i,a,n,s,c,l,d,p,u,h,m,f){var v=t.Verbose(s,c,l,d,p,u,h,m,f),g=_(v.info,{etagHash:o,correlationId:r,storageProvider:i,permissions:a,contentProvider:n}),y={name:"PBI.Dashboard.WorkbookEmbeddingExternalSuccess",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({etagHash:g.etagHash,correlationId:g.correlationId,storageProvider:g.storageProvider,permissions:g.permissions,contentProvider:g.contentProvider},null,v.formatted())},info:g,loggers:t.DashboardWorkbookEmbeddingExternalSuccessLoggers};return y}function b(o,r,i,a,n,s,c,l){var d={etagHash:o,errorCode:r,errorDescription:i,correlationId:a,storageProvider:n,permissions:s,contentProvider:c,message:l},p={name:"PBI.Dashboard.WorkbookEmbeddingExternalFailure",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({etagHash:d.etagHash,errorCode:d.errorCode,errorDescription:d.errorDescription,correlationId:d.correlationId,storageProvider:d.storageProvider,permissions:d.permissions,contentProvider:d.contentProvider,message:d.message},null)},info:d,loggers:t.DashboardWorkbookEmbeddingExternalFailureLoggers};return p}function S(o,r,i,a,n,s,c,l,d,p,u){var h=t.Verbose(i,a,n,s,c,l,d,p,u),m=_(h.info,{dashboardId:o,resourcePackagesCount:r}),f={name:"PBI.Dashboard.ImportResourcePackagesOnLoad",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({dashboardId:m.dashboardId,resourcePackagesCount:m.resourcePackagesCount},null,h.formatted())},info:m,loggers:t.DashboardImportResourcePackagesOnLoadLoggers};return f}function k(o,r,i,a,n,s,c,l,d){var p=t.Verbose(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Dashboard.GetNavigationPanePackage",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardGetNavigationPanePackageLoggers};return h}function T(o,r,i,a){var n={Id:o,packageId:r,objectType:i,message:a},s={name:"PBI.Permissions.ObjectNotFound",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({Id:n.Id,packageId:n.packageId,objectType:n.objectType,message:n.message},null)},info:n,loggers:t.PermissionsObjectNotFoundLoggers};return s}function D(o,r,i,a,n,s,c,l,d){var p=t.Verbose(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.Apps.GetApp",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.AppsGetAppLoggers};return h}function w(o,r,i,a,n,s,c,l,d,p,u){var h=t.CustomerAction(i,a,n,s,c,l,d,p,u),m=_(h.info,{appGUID:o,contentProviderCategory:r}),f={name:"PBI.Apps.UninstallApp",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({appGUID:m.appGUID,contentProviderCategory:m.contentProviderCategory},null,h.formatted())},info:m,loggers:t.AppsUninstallAppLoggers};return f}function I(o,r,i,a,n,s,c,l,d,p){var u=t.Verbose(r,i,a,n,s,c,l,d,p),h=_(u.info,{error:o}),m={name:"PBI.TileConfig.UpgradeTileConfig",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({error:h.error},null,u.formatted())},info:h,loggers:t.TileConfigUpgradeTileConfigLoggers};return m}function C(o,r,i,a,n,s,c,l,d){var p=t.Verbose(o,r,i,a,n,s,c,l,d),u=_(p.info,{}),h={name:"PBI.AppService.GetOrgAppsMetadata",category:e.TelemetryCategory.Verbose,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.AppServiceGetOrgAppsMetadataLoggers};return h}function P(o){var r={requestType:o},i={name:"PBI.EmailSubscriptions.Request",time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({requestType:L[r.requestType]},null)},info:r,loggers:t.EmailSubscriptionsRequestLoggers};return i}function R(){var o={},r={name:"PBI.InstantEmail.Request",time:Date.now(),id:E(),formatted:function(){return e.extendFormatted(null,null)},info:o,loggers:t.InstantEmailRequestLoggers};return r}function M(o,r,i,a,n,s,c,l,d,p,u){var h=t.CustomerAction(i,a,n,s,c,l,d,p,u),m=_(h.info,{flyoutOperationType:o,navigatedToMobileDashboard:r}),f={name:"PBI.MobileAuthoring.DashboardOpenedFromFlyout",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:E(),formatted:function(){return e.extendFormatted({flyoutOperationType:O[m.flyoutOperationType],navigatedToMobileDashboard:m.navigatedToMobileDashboard},null,h.formatted())},info:m,loggers:t.MobileAuthoringDashboardOpenedFromFlyoutLoggers};return f}var E,A=jsCommon.Utility,_=jsCommon.UnionExtensions.mergeUnionType;E=A?A.generateGuid:Function.prototype;var L;!(function(e){e[e.Create=0]="Create",e[e.Update=1]="Update",e[e.Toggle=2]="Toggle",e[e.Delete=3]="Delete",e[e.Get=4]="Get"})(L=t.EmailSubscriptionRequestType||(t.EmailSubscriptionRequestType={})),t.DashboardRenameReport=o,t.DashboardDeleteReport=r,t.DashboardInitializeNavigationPaneReports=i,t.DashboardInitializeNavigationPaneModels=a,t.DashboardRenameDataset=n,t.DashboardUpdateModelQnaFeatures=s,t.DashboardUpdateFeaturedQuestions=c,t.DashboardDeleteDataset=l,t.DashboardTileError=d,t.DashboardAddUpdateDashboard=p,t.DashboardSharingNewUnseenDashboards=u,t.DashboardInitializeNavigationPaneWorkbooks=h,t.DashboardUpdateLocalWorkbookNeverShowExplanation=m,t.DashboardRenameWorkbook=f,t.DashboardRemoveWorkbook=v,t.DashboardGetWorkbookWopiAccessInformation=g,t.DashboardWorkbookEmbeddingExternalSuccess=y,t.DashboardWorkbookEmbeddingExternalFailure=b,t.DashboardImportResourcePackagesOnLoad=S,t.DashboardGetNavigationPanePackage=k,t.PermissionsObjectNotFound=T,t.AppsGetApp=D,t.AppsUninstallApp=w,t.TileConfigUpgradeTileConfig=I,t.AppServiceGetOrgAppsMetadata=C,t.EmailSubscriptionsRequest=P,t.InstantEmailRequest=R;var O;!(function(e){e[e.Add=0]="Add",e[e.Pin=1]="Pin",e[e.Remove=2]="Remove"})(O=t.FlyoutOperationType||(t.FlyoutOperationType={})),t.MobileAuthoringDashboardOpenedFromFlyout=M})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.composite=0]="composite",e[e.iframe=1]="iframe",e[e.image=2]="image",e[e.model=3]="model",e[e.ssrs=4]="ssrs",e[e.workbook=5]="workbook",e[e.report=6]="report",e[e.realTime=8]="realTime"})(t=e.TileType||(e.TileType={}));var o;!(function(e){e[e.PowerBIServiceException=0]="PowerBIServiceException",e[e.DSRException=1]="DSRException"})(o=e.QueryResultErrorType||(e.QueryResultErrorType={}));var r;!(function(e){e[e.SingleVisual=0]="SingleVisual"})(r=e.CompositeTileType||(e.CompositeTileType={}));var i;!(function(e){e[e.Undefined=0]="Undefined",e[e.AppTemplate=1]="AppTemplate",e[e.AppInstance=2]="AppInstance",e[e.AppCopy=3]="AppCopy"})(i=e.PackageType||(e.PackageType={}))})(t=e.contracts||(e.contracts={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report",e[e.Model=2]="Model",e[e.Workbook=3]="Workbook"})(t=e.ContentPackItems||(e.ContentPackItems={}))})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.AppModelIconColors=["#000","#FFF"],e.AppModelIconBackgroundColors=[{color:"#01B8AA",fontColor:"#000"},{color:"#374649",fontColor:"#FFF"},{color:"#FD625E",fontColor:"#FFF"},{color:"#F2C80F",fontColor:"#000"},{color:"#5F6B6D",fontColor:"#000"},{color:"#8AD4EB",fontColor:"#000"},{color:"#FE9666",fontColor:"#000"},{color:"#A66999",fontColor:"#000"},{color:"#3599B8",fontColor:"#000"},{color:"#DFBFBF",fontColor:"#000"}],e.ServiceAppFallbackColors={color:"#374649",fontColor:"#FFF"},e.AppModelIcons=["financial","emi","group","realtime","image","pc1","paintbrush","world","streaming-data","user","barchart","gauge","globe","piedouble","areachart","comment","visualinteraction","code","shapes","piechart","stackedcolumn","scatter","database","home","insight"]})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){var r=e.common.contracts.ContentTileType,i=jsCommon.Lazy;o.DashboardAsyncLayoutDelayMs=100;var a=(function(){function e(e){this.contract=e,this.isEnabled=!0,this.isUsedByContentPack=!1,this.isLoaded=e&&null!=e.tiles,this.hitCount=0,this.lazyTiles=null,this.uniqueId=r.Dashboard+"_"+this.contract.id}return e.prototype.getPermissions=function(){var e;return this.getPermissionsCallback&&null!=(e=this.getPermissionsCallback())?e:this.contract&&this.contract.permissions},e.prototype.increaseHitCount=function(){this.hitCount++},Object.defineProperty(e.prototype,"tiles",{get:function(){return this.lazyTiles||(this.lazyTiles=new i(function(){return[]})),this.lazyTiles.getValue()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.contract.id},set:function(e){this.contract.id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this.contract.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return t.DashboardUtils.isWriteable(this.contract)&&!(this.gridLayoutService&&this.gridLayoutService.strategy.isLayoutLocked)&&!this.contract.cached},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentTileType",{get:function(){return r.Dashboard},enumerable:!0,configurable:!0}),e.prototype.isFilled=function(){return this.contract.tiles&&this.tiles.length===this.contract.tiles.length},e.prototype.calculateLayout=function(){this.layoutRequired=!1;var e=this.tiles;if(!_.isEmpty(e))for(var t=0,o=e;t<o.length;t++){var r=o[t];r.calculateLayout()}},e.prototype.applyLayout=function(){var e=this.tiles;if(!_.isEmpty(e))for(var t=0,o=e;t<o.length;t++){var r=o[t];r.applyLayout()}},e.prototype.runLayoutIfRequired=function(){this.layoutRequired&&(this.calculateLayout(),this.applyLayout())},e.prototype.scheduleDelayedLayout=function(e){var t=this;void 0===e&&(e=!1),this.layoutRequired||(this.layoutRequired=!0,e||setTimeout((function(){t.layoutRequired&&(t.calculateLayout(),t.applyLayout())}),o.DashboardAsyncLayoutDelayMs))},e.prototype.findTile=function(e){return _.find(this.tiles,(function(t){return t.id===e}))},e.prototype.findTileByObjectIdOrOriginalObjectId=function(e,t){if(e||t)return _.find(this.tiles,(function(o){return!_.isEmpty(e)&&o.contract.objectId===e||!_.isEmpty(t)&&o.contract.originalTileObjectId===t}))},e.prototype.getTileIndex=function(e){return _.findIndex(this.tiles,(function(t){return t.id===e}))},e.prototype.getTileContractIndex=function(e){return _.findIndex(this.contract.tiles,(function(t){return t.id===e}))},e.prototype.getUniquePackageId=function(){var e=this.contract;return e.originalPackageId?e.originalPackageId:e.packageIds&&1===e.packageIds.length?e.packageIds[0]:void 0},e.prototype.hasModel=function(e){return _.some(this.tiles,(function(t){return t.contract.modelId===e}))},e.prototype.hasOwnerInfo=function(){return!_.isEmpty(this.ownerFullname)||!_.isEmpty(this.ownerMail)},e})();o.Dashboard=a})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(r){function i(e,t,o,r,i,a,n,s,c,l,d,p){return new b(e,t,o,r,i,a,n,s,c,l,d,p)}var a=jsCommon.ArrayExtensions,n=e.common.contracts,s=n.ContentProviderCategory,c=n.ContentTileType,l=t.models,d=jsCommon.GzipUtility,p=jsCommon.JsonExtensions,u=jsCommon.Lazy,h=e.common.helpers.ModelConverterHelper,m=jsCommon.PerfTimer,f=n.PublishOrRefreshStatus,v=e.common.models.Report,g=t.contracts.TileType,y=e.explore.contracts.Version;r.createDataServiceModelConverter=i;var b=(function(){function i(e,t,o,r,i,a,n,s,c,l,d,p){this.geolocationService=e,this.telemetryService=t,this.visualPlugins=o,this.visualPluginOps=r,this.featureSwitchService=i,this.geocoder=a,this.promiseFactory=n,this.moduleLoader=s,this.permissionService=c,this.tileConfigUpgraderService=l,this.localizationService=d,this.explorationSerializer=p}return i.prototype.setModelMerger=function(e){this.modelMerger=e},i.prototype.convertCompositeTile=function(o){if(!o||o.type!==g.composite)return null;var i=this.convertTileConfig(o);this.convertTileLayoutConfig(o);var a;if(!i||!i.visualContainer)return null;a=new r.SingleVisualCompositeTileModel(o,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader),a.config=i.visualContainer,a.displayText=o.displayText,a.subDisplayText=o.subDisplayText;var n=t.ContractUtils.getMasterLayoutPosition(o);if(a.size={rowSpan:n.height,colSpan:n.width},a.isLoading=r.TileFactory.isTileLoading(o),o.queryResultError){a.isError=!0;var s=o.queryResultError;this.telemetryService.logEvent(e.telemetry.DashboardTileError,g[g.composite],jsCommon.StringExtensions.format("{0}:{1} with rootActivityId:{2}, modelId:{3} and tileId:{4}",jsCommon.EnumExtensions.toString(t.contracts.QueryResultErrorType,s.type),s.errorDetail,s.rootActivityId,o.modelId.toString(),o.id.toString()));var c=t.TileUtils.getTileErrorDetailsFromQueryResultError(s);c?(a.errorDetails=c,a.errorText=c.message):a.errorText=e.common.localize.get("Tile_ErrorText")}return a},i.prototype.convertTileData=function(t){if(t.tileDataSet)return t.tileDataSet;var o=this.convertTileConfig(t);try{t.tileDataSet=this.parseTileData(t,o.tileDataType)}catch(o){throw this.telemetryService.logEvent(e.telemetry.DashboardTileError,g[g.composite],jsCommon.StringExtensions.format("DsrParseError:{0} with modelId:{1} and tileId:{2}",o.message,t.modelId.toString(),t.id.toString())),o}return t.tileDataSet},i.prototype.convertDashboard=function(e,t,o,r){var i=this,a=this.convertDashboardShallow(e);return e.tiles&&(a.lazyTiles=new u(function(){return _.map(e.tiles,(function(e){return i.convertTile(e,t,o,r)}))})),a},i.prototype.convertDashboardShallow=function(e){var t=this,o=new r.Dashboard(e);return o.getPermissionsCallback=function(){return t.permissionService.getDashboardEffectivePermissions(e)},o.dataClassificationId=e.dataClassificationId,this.modelMerger.mergeDashboardShallow(o,e),o},i.prototype.convertIframeTile=function(e){if(!e||e.type!==g.iframe)return null;var t=new r.IframeTileModel(e),o=this.convertTileConfig(e);return this.convertTileLayoutConfig(e),o&&o.iframe&&(t.srcUrl=o.iframe.srcUrl,t.embedCode=o.iframe.embedCode),t.isLoading=r.TileFactory.isTileLoading(e),t},i.prototype.convertImageTile=function(e){if(!e||e.type!==g.image)return null;var o=new r.ImageTileModel(e);return this.convertTileLayoutConfig(e),o.displayText=e.displayText,o.subDisplayText=e.subDisplayText,"number"!=typeof o.contract.reportId||e.config?(o.isStatic=!1,o.imageUrl=this.getImageUrl(e)):(o.isStatic=!0,o.imageUrl=t.constants.modelPlaceholderImageUrl),o.isLoading=r.TileFactory.isTileLoading(e),o},i.prototype.convertContentPackBase=function(e){if(e){var o,r,i=p.tryParseJSON(e.providerConfig);i&&(o=_.isEmpty(i.shortDescription)||e.category!==s.ServiceApp&&e.category!==s.Services?i.description:i.shortDescription,r=i.author);var a={providerContract:e,providerId:e.providerId,displayText:e.displayText,iconUrl:e.iconUrl||"",description:o,publishTime:t.DateUtils.convertDate(e.publishTime),providerKey:e.providerKey,author:r,category:e.category,allowCopyContent:!0,dashboardIds:e.dashboardIds||[],reportIds:e.reportIds||[],modelIds:e.modelIds||[],workbookIds:e.workbookIds||[]};return a}},i.prototype.convertAppModelBase=function(e){var r=p.tryParseJSON(e.providerConfig);if(r&&r.appSettings){var i=r.appSettings;return{icon:i.iconName,iconColor:i.iconColor,iconBackgroundColor:i.iconBackgroundColor,headerBackgroundColor:i.headerBackgroundColor||t.AppUtils.getAppHeaderBackgroundColor(i.iconBackgroundColor),defaultContent:i.defaultAppArtifact,defaultContentOption:i.defaultAppArtifact?1:0,appPush:!!i.appPush}}if(e.category===s.ServiceApp||e.category===s.Services)return{iconColor:o.ServiceAppFallbackColors.fontColor,iconBackgroundColor:o.ServiceAppFallbackColors.color,headerBackgroundColor:t.AppUtils.getAppHeaderBackgroundColor(o.ServiceAppFallbackColors.color),defaultContentOption:0}},i.prototype.convertInstalledAppModel=function(e,o){var r=this.convertContentPackBase(e);if(r){var i=this.convertAppModelBase(e),a=__assign({objectId:e.providerKey,contentTileType:c.OrgApp,packageId:o.id,uniqueId:o.id,displayName:e.displayText,publishTime:t.DateUtils.convertDate(e.publishTime),getPermissions:function(){return n.Permissions.Read|n.Permissions.CopyOnWrite},dashboards:[],models:[],reports:[],workbooks:[],displayDate:t.AppUtils.convertDisplayDate(e.publishTime,this.localizationService),isFavorite:!1,isFavoriteDisabled:!1,favoriteInfo:void 0,groupObjectId:e.groupObjectId},r,i);return t.AppUtils.isOrgApp(e)||(a.displayDate=t.AppUtils.convertDisplayDate(o.lastRefreshTime,this.localizationService)),a}},i.prototype.convertModel=function(e){var t=this.convertModelShallow(e);return this.updateModelProperties(t,e),t},i.prototype.convertModelTile=function(e){if(!e||e.type!==g.model)return null;var t=new r.ModelTileModel(e);return this.convertTileLayoutConfig(e),t.displayText=e.displayText,t.isLoading=r.TileFactory.isTileLoading(e),t.subDisplayText=e.subDisplayText,t},i.prototype.convertModelShallow=function(t){return new e.common.models.Model(t)},i.prototype.convertPackage=function(e){var t=this,o=this.convertPackageShallow(e);return e&&(o.contract=e,o.id=e.id,o.contentProviderId=e.contentProviderId,o.lastRefreshTime=e.lastRefreshTime,o.latestVersion=e.latestVersion,o.version=e.version,o.name=e.name,o.publishOrRefreshStatus=e.publishOrRefreshStatus||f.FinishedSuccessfully,o.packageType=e.packageType,o.originalPackageId=e.originalPackageId,o.getPermissionsCallback=function(){return t.permissionService.getPackageEffectivePermissions(e)}),o},i.prototype.convertPackageShallow=function(e){return new l.Package(e)},i.prototype.convertRealTimeTile=function(e){if(!e||e.type!==g.realTime)return null;var o=this.convertTileConfig(e);this.convertTileLayoutConfig(e);var i=new r.RealTimeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader);o&&o.realTimeVisual&&(i.config=o.realTimeVisual),i.displayText=e.displayText,i.subDisplayText=e.subDisplayText;var a=t.ContractUtils.getMasterLayoutPosition(e);return i.size={rowSpan:a.height,colSpan:a.width},i},i.prototype.convertReport=function(e){var t=this,o=this.convertReportShallow(e);return e&&(o.id=e.id,o.modelId=e.modelId,o.reportUrl=e.reportUrl,o.packagePublishStatus=e.packagePublishStatus||f.FinishedSuccessfully,o.name=e.name,o.displayName=e.displayName,o.description=e.description,o.fileName=e.fileName,o.packageId=e.packageId,o.packageVersion=e.packageVersion,o.contentProviderId=e.contentProviderId,o.objectId=e.objectId,o.getPermissionsCallback=function(){return t.permissionService.getReportEffectivePermissions(e)},this.fillReport(o,e)),o},i.prototype.convertReportShallow=function(e){return new v(e)},i.prototype.convertReportTile=function(e){return e&&e.type===g.report?(this.convertTileLayoutConfig(e),new r.ReportTileModel(e)):null},i.prototype.convertSpecificTileShallow=function(e,o){switch(this.convertTileLayoutConfig(e),e.type){case g.composite:var i=this.convertTileConfig(e);if(i&&i.visualContainer&&(o.composite=new r.SingleVisualCompositeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader)),o.composite){var a=t.ContractUtils.getMasterLayoutPosition(e);o.composite.size={rowSpan:a.height,colSpan:a.width},o.composite.isLoading=r.TileFactory.isTileLoading(e)}break;case g.iframe:o.iframe=new r.IframeTileModel(e),o.iframe.isLoading=r.TileFactory.isTileLoading(e);break;case g.image:o.image=new r.ImageTileModel(e),o.image.isLoading=r.TileFactory.isTileLoading(e);break;case g.model:o.model=new r.ModelTileModel(e),o.model.isLoading=r.TileFactory.isTileLoading(e);break;case g.ssrs:o.model=new r.SsrsTileModel(e),o.model.isLoading=r.TileFactory.isTileLoading(e);break;case g.workbook:o.workbook=new r.WorkbookTileModel(e,o),o.workbook.isLoading=r.TileFactory.isTileLoading(e);break;case g.report:o.model=new r.ReportTileModel(e),o.model.isLoading=r.TileFactory.isTileLoading(e);break;case g.realTime:this.convertTileConfig(e),o.realTime=new r.RealTimeTileModel(e,this.visualPlugins,this.visualPluginOps,this.featureSwitchService,this.geolocationService,this.geocoder,this.promiseFactory,this.moduleLoader)}},i.prototype.convertSsrsTile=function(e){if(!e||e.type!==g.ssrs)return null;this.convertTileLayoutConfig(e);var t=new r.SsrsTileModel(e);return e.config&&(t.imageUrl=this.getSsrsImageUrl(e)),t.isLoading=r.TileFactory.isTileLoading(e),t},i.prototype.convertTile=function(e,t,o,r){this.convertTileLayoutConfig(e);var i=this.convertTileShallow(e,t,o);if(this.modelMerger.mergeTile(i,e,t,o,r),null!=e.reportId){var a=this.getTileReport(e.reportId,o);a&&(i.report=i.report||new v(a),this.fillReport(i.report,a))}return i},i.prototype.convertTileLayoutConfig=function(e){if(!e.$layoutConfig){var t={x:e.col,y:e.row,width:e.colSpan,height:e.rowSpan},o=void 0;if(e.layoutConfig)try{o=JSON.parse(e.layoutConfig);var r=a.extendWithId(o.layouts),i=r.withId(0);i.position=t}catch(e){}else o={layouts:[{id:0,position:t}]};e.$layoutConfig=o,e.layoutConfig=JSON.stringify(o)}return e.$layoutConfig},i.prototype.convertTileAction=function(e){var t=e.$action;if(!t){var o;if(e.action&&0===e.action.indexOf("{"))try{o=JSON.parse(e.action)}catch(e){}else o={action:e.action};t=e.$action=o}return t},i.prototype.convertTileConfig=function(e){var t=e.$config;
if(!t){var o=m.start("Parse tile config");try{t=e.$config=this.deserializeTileConfig(e.config);var r=t.visualContainer||t.realTimeVisual;this.deserializeVisualContainer(r);var i=r||t.visual;this.deserializeModelExtensions(i),this.tileConfigUpgraderService.upgrade(e.id,t,e.query)}catch(e){}finally{o()}}return t},i.prototype.deserializeTileConfig=function(e){var t=p.tryParseJSON(e);return null==t&&(t={version:y.ZeroStr}),t},i.prototype.deserializeVisualContainer=function(e){e&&e.visualContainer&&!e.$visualContainer&&(e.$visualContainer=this.explorationSerializer.deserializeVisualContainer(e.visualContainer))},i.prototype.deserializeModelExtensions=function(e){e&&e.modelExtensions&&!e.$modelExtensions&&(e.$modelExtensions=this.explorationSerializer.deserializeModelExtensions(e.modelExtensions))},i.prototype.convertTileShallow=function(e,t,o){this.convertTileLayoutConfig(e);var i=new r.Tile(e,this.localizationService);return this.modelMerger.mergeTileShallow(i,e,t,o),i},i.prototype.convertWorkbook=function(e){var t=this,o=this.convertWorkbookShallow(e);return e&&(o.id=e.id,o.modelId=e.modelId,o.viewUrl=this.getWorkbookViewUrl(e),o.editUrl=this.getWorkbookEditUrl(e),o.embedUrl=this.getWorkbookEmbedView(e),o.name=e.name,o.displayName=e.displayName,o.description=e.description,o.fileName=e.fileName,o.packageId=e.packageId,o.getPermissionsCallback=function(){return t.permissionService.getWorkbookEffectivePermissions(e)}),o},i.prototype.convertWorkbookShallow=function(e){return new r.Workbook(e)},i.prototype.convertWorkbookTile=function(e,o,i){if(!e||e.type!==g.workbook)return null;this.convertTileLayoutConfig(e);var a=new r.WorkbookTileModel(e,i);a.displayText=e.displayText,a.subDisplayText=e.subDisplayText,a.isLoading=r.TileFactory.isTileLoading(e),a.image=e.tileDataBinaryBase64Encoded,e.$config.workbookTile&&e.$config.workbookTile.keepOriginalContentSize?a.keepOriginalContentSize=e.$config.workbookTile.keepOriginalContentSize:a.keepOriginalContentSize=t.constants.workbook.defaultKeepOriginalContentSize;var n=e.$config.workbookTile;return o&&(n&&(a.embedUrl=o.embedUrl+"&item="+n.item),o.contract&&(a.webUri=o.contract.webUri)),a},i.prototype.fillDashboardChildren=function(e,t,o,r){var i=this,a=e.contract;e.displayName!==a.displayName&&(e.displayName=a.displayName),a.tiles&&(e.lazyTiles=new u(function(){return a.tiles.map((function(e){return i.convertTile(e,t,o,r)}))}))},i.prototype.fillModel=function(e,t){e.id=t.id,e.contract=t},i.prototype.fillReport=function(e,t){e.id=t.id,e.contract=t,e.reportUrl=t.reportUrl},i.prototype.getImageUrl=function(e){var t=this.convertTileConfig(e);if(t&&t.imageTile)return t.imageTile.imageUrl},i.prototype.getSsrsImageUrl=function(e){var t=this.convertTileConfig(e);if(t&&t.ssrsTile)return t.ssrsTile.imageUrl},i.prototype.getTileModel=function(e,t){var o;if(t){var r=a.indexOf(t,(function(t){return t&&t.id===e}));r!==-1&&(o=t[r])}return o},i.prototype.getTileReport=function(e,t){var o;if(t){var r=a.indexOf(t,(function(t){return t&&t.id===e}));r!==-1&&(o=t[r])}return o},i.prototype.getTileWorkbook=function(e,t,o){var r;if(o){var i=a.indexOf(o,(function(o){return o.id===e&&o.packageId===t}));i!==-1&&(r=o[i])}return r},i.prototype.resolveTilePackage=function(e,t){if(e.packageId){var o=a.indexOf(t,(function(t){return t.id===e.packageId}));o!==-1&&(e.tilePackage=t[o])}},i.prototype.getWorkbookViewUrl=function(e){return this.getWorkbookActionUrl(e,"view")},i.prototype.getWorkbookEditUrl=function(e){return this.getWorkbookActionUrl(e,"edit")},i.prototype.getWorkbookEmbedView=function(e){return this.getWorkbookActionUrl(e,"embedview")},i.prototype.getWorkbookActionUrl=function(e,t){return e.webUri&&e.etagHash?e.webUri+"/_layouts/WopiFrame.aspx?sourcedoc={"+e.etagHash+"}&action="+t:""},i.prototype.updateModelProperties=function(e,t){var o=this;t&&(e.id=t.id,e.isNew=t.isNew,e.cloudRlsEnabled=t.cloudRlsEnabled,e.name=t.name,e.displayName=t.displayName,e.description=t.description,e.fileName=t.fileName,e.packageId=t.packageId,e.packageVersion=t.packageVersion,e.contentProviderId=t.contentProviderId,e.isHidden=t.isHidden||!1,e.isRefreshInProgress=t.currentRefreshStartingTime&&h.convertRefreshTimeToJsDateTime(t.currentRefreshStartingTime).getTime()+18e5>Date.now(),e.dbName=t.dbName,e.vsName=t.vsName,e.realTimeMode=t.realTimeMode,e.getPermissionsCallback=function(){return o.permissionService.getModelEffectivePermissions(t)},this.fillModel(e,t))},i.prototype.parseTileData=function(e,t){var o,r=m.start("Parse tile data");try{if(e.tileDataBinaryBase64Encoded){var i=d.uncompress(e.tileDataBinaryBase64Encoded);o=JSON.parse(i)}else e.tileData&&(o=JSON.parse(e.tileData));return{type:t,data:o}}finally{r()}},i})()})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){function r(e,t){return new s(e,t)}var i=jsCommon.ArrayExtensions,a=jsCommon.Lazy,n=e.common.helpers.ModelConverterHelper;o.createDataServiceModelMerger=r;var s=(function(){function e(e,t){this.modelConverter=e,this.permissionService=t}return e.prototype.mergeDashboard=function(e,t,o,r,i){var n=this,s=this.modelConverter.convertDashboard(t,o,r,i);e.contract=t,e.displayName=s.displayName,e.getPermissionsCallback=function(){return n.permissionService.getDashboardEffectivePermissions(t)},e.contract.modelIds=t.modelIds,e.contract.reportIds=t.reportIds,e.contract.packageIds=t.packageIds,e.contract.workbookIds=t.workbookIds,e.qnaEnabled=t.qnaEnabled,e.gravityEnabled=t.gravityEnabled,e.isSharedFromSecurityGroup=t.isSharedFromSecurityGroup,e.isHidden=t.isHidden;var c=e.tiles;e.lazyTiles=new a(function(){var e=[];if(_.isEmpty(s.tiles))return e;for(var t=function(t){var a=_.find(c,(function(e){return e.id===t.id}));a?(e.push(a),n.mergeTile(a,t.contract,o,r,i)):e.push(t)},a=0,l=s.tiles;a<l.length;a++){var d=l[a];t(d)}return e})},e.prototype.mergeDashboardOwnerInfo=function(e,t){e.ownerFullname=t.givenName,t.familyName&&(e.ownerFullname=e.ownerFullname+" "+t.familyName),e.ownerMail=t.emailAddress,t.userObjectId&&(e.ownerUserObjectId=t.userObjectId),t.groupObjectId&&(e.ownerGroupObjectId=t.groupObjectId),e.contract.ownerInfo||(e.contract.ownerInfo=t)},e.prototype.mergeDashboardShallow=function(e,t){var o=this;if(t.displayName&&(e.displayName=t.displayName),void 0!==t.permissions&&(e.getPermissionsCallback=function(){return o.permissionService.getDashboardEffectivePermissions(t)}),t.modelIds&&(e.contract.modelIds=t.modelIds),t.reportIds&&(e.contract.reportIds=t.reportIds),t.workbookIds&&(e.contract.workbookIds=t.workbookIds),t.packageIds&&(e.contract.packageIds=t.packageIds),void 0!==t.qnaEnabled&&(e.qnaEnabled=t.qnaEnabled),void 0!==t.gravityEnabled&&(e.gravityEnabled=t.gravityEnabled),void 0!==t.isSharedFromSecurityGroup&&(e.isSharedFromSecurityGroup=t.isSharedFromSecurityGroup),void 0!==t.isHidden&&(e.isHidden=t.isHidden),void 0!==t.ownerInfo){var r=t.ownerInfo;this.mergeDashboardOwnerInfo(e,r)}e.sharedTime=t.sharedTime||"/Date(0)/"},e.prototype.mergeDashboardTiles=function(e,t){var o=t.models||[],r=t.reports||[],i=t.workbooks||[],a=t.packages||[],n=e.contract.tiles;if(n)for(var s=0,c=n;s<c.length;s++){var l=c[s];this.modelConverter.resolveTilePackage(l,a)}var d=e.tiles;if(d)for(var p=0,u=d;p<u.length;p++){var h=u[p];this.mergeTile(h,h.contract,o,r,i)}},e.prototype.mergeModel=function(e,t){var o=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.isNew=t.isNew||e.isNew,e.getPermissionsCallback=function(){return o.permissionService.getModelEffectivePermissions(t)},e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.fileName=t.fileName||e.fileName,e.packageId=t.packageId||e.packageId,e.packageVersion=t.packageVersion||e.packageVersion,e.contentProviderId=t.contentProviderId||e.contentProviderId,e.packagePublishStatus=null!=t.packagePublishStatus?t.packagePublishStatus:e.packagePublishStatus,e.isRefreshInProgress=t.currentRefreshStartingTime&&n.convertRefreshTimeToJsDateTime(t.currentRefreshStartingTime).getTime()+18e5>Date.now(),e.cloudRlsEnabled=t.cloudRlsEnabled,e.realTimeMode=t.realTimeMode)},e.prototype.mergeModelContentProviderId=function(e,o){if(e)for(var r=0,i=e;r<i.length;r++){var a=i[r];a.contentProviderId=a.contentProviderId||t.ContractUtils.findContentProviderId(o,a.packageId)}},e.prototype.mergeReport=function(e,t){var o=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.objectId=t.objectId||e.objectId,e.modelId=t.modelId||e.modelId,e.reportUrl=t.reportUrl||e.reportUrl,e.getPermissionsCallback=function(){return o.permissionService.getReportEffectivePermissions(t)},e.packagePublishStatus=t.packagePublishStatus||e.packagePublishStatus,e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.fileName=t.fileName||e.fileName,e.packageId=t.packageId||e.packageId,e.packageVersion=t.packageVersion||e.packageVersion,e.contentProviderId=t.contentProviderId||e.contentProviderId)},e.prototype.mergeTileShallow=function(e,t,r,i){this.modelConverter.convertTileLayoutConfig(t),e.contract=t,e.type=t.type,this.mergeTileLayoutConfig(e,t),e.displayText=t.displayText,e.subDisplayText=t.subDisplayText,e.backgroundImageUrl=this.modelConverter.getImageUrl(t),e.errorCode=t.errorCode;var a=this.modelConverter.getTileReport(t.reportId,i);if(t.query&&t.query.modelQuery&&(e.utterance=t.query.modelQuery.utterance),e.action=this.modelConverter.convertTileAction(t),e.config=this.modelConverter.convertTileConfig(t),e.isLoading=o.TileFactory.isTileLoading(t),t.modelId){var n=this.modelConverter.getTileModel(t.modelId,r);n&&(e.vsName=n.vsName,e.dbName=n.dbName)}t.reportId&&(e.report=e.report||this.modelConverter.convertReport(a),e.report.id=t.reportId),a&&(this.modelConverter.fillReport(e.report,a),e.action||(e.action={action:"/openReport"})),this.modelConverter.convertSpecificTileShallow(t,e)},e.prototype.mergeTileLayoutConfig=function(e,t){if(!(e.layoutPosition.x&&e.layoutPosition.y&&e.layoutPosition.width&&e.layoutPosition.height)){var o=i.extendWithId(t.$layoutConfig.layouts),r=e.gridLayoutContext,a=r?r.getActiveLayout():0,n=o.withId(a);n&&this.mergeLayoutPosition(e.layoutPosition,n.position)}},e.prototype.mergeLayoutPosition=function(e,t){t&&(e.x=e.x||t.x,e.y=e.y||t.y,e.width=e.width||t.width,e.height=e.height||t.height)},e.prototype.mergeTile=function(e,t,r,i,a,n){var s=e.composite,c=e.realTime;this.mergeTileShallow(e,t,r,i),e.composite=this.modelConverter.convertCompositeTile(t),s&&e.composite&&(e.composite.setDataLoadEventDelegate(s.dataLoadEventDelegate),e.composite.copyDependencies(s),s instanceof o.SingleVisualCompositeTileModel&&e.composite instanceof o.SingleVisualCompositeTileModel&&this.mergeVisual(e.composite.visual,s.visual)),e.iframe=this.modelConverter.convertIframeTile(t),e.image=this.modelConverter.convertImageTile(t),e.model=this.modelConverter.convertModelTile(t),e.ssrs=this.modelConverter.convertSsrsTile(t);var l=this.modelConverter.convertRealTimeTile(t);if(this.updateTileRealTimeModel(e,c,l),e&&e.reportTile){var d=e.reportTile.exploration;e.reportTile=this.modelConverter.convertReportTile(t),e.reportTile.exploration=d}else e.reportTile=this.modelConverter.convertReportTile(t);if(!_.isEmpty(a)){var p=this.modelConverter.getTileWorkbook(t.workbookId,t.packageId,a);if(p){var u=this.modelConverter.convertWorkbook(p);e.workbook=this.modelConverter.convertWorkbookTile(t,u,e)}}if(i){var h=this.modelConverter.getTileReport(t.reportId,i);h?(e.report=e.report||this.modelConverter.convertReport(h),this.modelConverter.fillReport(e.report,h)):e.report=null,e.contractsReport=this.modelConverter.getTileReport(t.reportId,i)}else if(n){for(var m=void 0,f=0,v=n.length;f<v;f++)if(t.reportId===n[f].id){m=n[f];break}m&&(e.report=e.report||m,this.modelConverter.fillReport(e.report,m.contract),e.contractsReport=m.contract)}t.modelId&&(e.contractsModel=this.modelConverter.getTileModel(t.modelId,r))},e.prototype.mergeWorkbook=function(e,t){var o=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.getPermissionsCallback=function(){return o.permissionService.getWorkbookEffectivePermissions(t)},e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.packageId=t.packageId||e.packageId)},e.prototype.mergePackage=function(e,t){var o=this;e&&t&&(e.contract=t,e.contentProviderId=t.contentProviderId,e.id=t.id,e.lastRefreshTime=t.lastRefreshTime,e.latestVersion=t.latestVersion,e.name=t.name,e.publishOrRefreshStatus=t.publishOrRefreshStatus,e.version=t.version,e.originalPackageId=t.originalPackageId||e.originalPackageId,e.packageType=t.packageType||e.packageType,e.getPermissionsCallback=function(){return o.permissionService.getPackageEffectivePermissions(t)})},e.prototype.updateTileRealTimeModel=function(e,t,o){e.realTime=o,t&&e.realTime&&e.realTime.copyRealTimeModelDependencies(t)},e.prototype.mergeVisual=function(e,t){t.visual&&e.type===t.type&&(e.visual=t.visual),e.viewport=t.viewport},e})();o.DataServiceModelMerger=s})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.contract=e}return e.prototype.getPermissions=function(){var e;return this.getPermissionsCallback&&(e=this.getPermissionsCallback()),e?e:this.contract&&this.contract.permissions},e.prototype.hasUpdate=function(){return this.version&&this.latestVersion&&this.version!==this.latestVersion},e})();e.Package=t})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=e.common.models.DefaultGridLayoutStrategy,r=(function(t){function o(e,o){var r=t.call(this)||this;return r.displayWidth=e,r.displayHeight=o,r.minNumOfColumns=2,r.isLayoutLocked=!0,r}return __extends(o,t),o.prototype.calculateDisplayPositions=function(e){t.prototype.calculateDisplayPositions.call(this,e),this.scaleDashboard(e)},o.prototype.scaleDashboard=function(t){var r=this.getDashboardSize(t),i=o.calculateDashboardScaleFactor(r.width,r.height,this.displayWidth,this.displayHeight);if(!(i<=0)){var a={transform:"scale("+i+")",width:r.width+"px",height:this.displayHeight/i+"px",left:0};$(e.dataServices.constants.dashboardElementName).css(a)}},o.prototype.getDashboardSize=function(t){var o=this.getMaxColumnInLayout(t),r=this.getMaxRowInLayout(t);o<this.minNumOfColumns&&(o=this.minNumOfColumns);var i=e.common.GridLayoutConstants.defaultGridItemSpacing;return{width:o*this.gridWidth+i,height:r*this.gridHeight+i}},o.calculateDashboardScaleFactor=function(e,t,o,r){return o/e},o.prototype.getMaxRowInLayout=function(e){return _.max(_.map(e,(function(e){return e.displayRow-1+e.displaySize.rowSpan})))},o.prototype.getMaxColumnInLayout=function(e){return _.max(_.map(e,(function(e){return e.displayCol-1+e.displaySize.colSpan})))},o})(o);t.PhoneLandscapeTileLayoutStrategy=r})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o,r=e.dataServices.contracts.TileType;!(function(e){e.tileSpacing=12,e.smallTileRowSpan=4,e.defaultTileRowSpan=6,e.mediumTileRowSpan=7,e.largeTileRowSpan=9,e.resizeBuffer=10,e.aspectRatio=.1111})(o=t.PhoneTileLayoutConstants||(t.PhoneTileLayoutConstants={}));var i=(function(){function t(t,i){this.isLayoutLocked=!0,this.willOverrideDisplayPosition=!0,this.gridItemSpacing=o.tileSpacing,this.tileTypeRowSpanMap={},this.visualTypeRowSpanMap={},this.gridWidth=t-this.gridItemSpacing,this.gridHeight=Math.round(this.gridWidth*o.aspectRatio),this.gridMinWidthOnResize=this.gridWidth-o.resizeBuffer,this.gridMinHeightOnResize=this.gridHeight-o.resizeBuffer,this.gridMaxWidthOnResize=this.gridWidth*e.common.models.gridLayoutConstants.gridMaxColSpan,this.gridMaxHeightOnResize=this.gridHeight*e.common.models.gridLayoutConstants.gridMaxColSpan,this.tileTypeRowSpanMap[r.report]=o.mediumTileRowSpan,this.visualTypeRowSpanMap[e.visuals.plugins.card.name]=o.smallTileRowSpan,this.visualTypeRowSpanMap[e.visuals.plugins.animatedNumber.name]=o.smallTileRowSpan,this.visualTypeRowSpanMap[e.visuals.plugins.textbox.name]=o.smallTileRowSpan}return t.prototype.calculateDisplayPositions=function(t){for(var o=e.dataServices.DashboardUtils.orderItems(_.map(t,(function(e){return{getActiveLayoutPosition:function(){return e.getLayoutPosition()},getItem:function(){return e}}}))),r=1,i=0,a=o;i<a.length;i++){var n=a[i];n.displayCol=1,n.displayRow=r,this.calculateDisplaySize(n),r+=n.displaySize.rowSpan}this.removeScale()},t.prototype.calculateDisplaySize=function(e){var t=this.getRowSpan(e);e.displaySize={colSpan:1,rowSpan:t}},t.prototype.getRowSpan=function(e){var t=e.gridItem,r=this.tileTypeRowSpanMap[t.type];if(!r&&t.composite){var i=t.composite;null!==i&&(r=this.visualTypeRowSpanMap[i.visual.type])}return r||o.defaultTileRowSpan},t.prototype.removeScale=function(){$(e.dataServices.constants.dashboardElementName).removeAttr("style")},t.prototype.isDynamic=function(){return!1},t})();t.PhonePortraitTileLayoutStrategy=i})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var o=(function(){function t(e,t){this.datasetInfo=e,this.definition=t}return Object.defineProperty(t.prototype,"databaseName",{get:function(){return this.datasetInfo.databaseName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryKey",{get:function(){return this.datasetInfo.resourceKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondaryKey",{get:function(){return this.datasetInfo.resourceKeySecondary},enumerable:!0,configurable:!0}),t.prototype.getPushUrl=function(){var e=window.tenantId,t=window.apiUri,o=window.clusterUri;"https://wabi-staging-us-east-redirect.analysis.windows.net"===o&&(t="https://powerbistagingapi.analysis.windows.net");var r="/beta/"+e+"/datasets/"+this.databaseName+"/rows",i=jsCommon.Utility.urlCombine(t,r),a={};return a.key=this.primaryKey,jsCommon.QueryStringUtil.addOrUpdateQueryStringToUrl(i,a)},t.createRealTimeDatasetDefinition=function(o,r,i){var a=i.schema(e.constants.RealTimeDataSourceName).entities,n=_.first(a),s=[];return _.map(n.properties,(function(e){s.push({name:e.displayName,dataType:t.convertToRealTimeDataType(e.type)})})),{name:o,columns:s,mode:r,tableName:n.name}},t.convertToRealTimeDataType=function(e){switch(e.primitiveType){case 3:case 4:return 1;case 7:return 2;case 1:return 0;case 5:return 3}},t})();t.RealTimeModel=o})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=e.common.GridLayoutConstants,r=(function(e){function t(t,o){var r=e.call(this,t,o)||this;return r.maxColumnsToDisaply=7,r.minColumnsToDisplay=3,r.portionOfNextColumn=.2,r}return __extends(t,e),t.prototype.getDashboardSize=function(e){var t=this.getMaxColumnInLayout(e),r=this.getMaxRowInLayout(e);t>this.maxColumnsToDisaply?t=this.maxColumnsToDisaply+this.portionOfNextColumn:t<this.minColumnsToDisplay&&(t=this.minColumnsToDisplay);var i=o.defaultGridItemSpacing;return{width:t*this.gridWidth+i,height:r*this.gridHeight+i}},t})(t.PhoneLandscapeTileLayoutStrategy);t.TabletTileLayoutStrategy=r})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){var r,i=e.common.GridLayoutConstants,a=e.data.services.DataViewObjectSerializer,n=e.data.services.DataViewTransformActionsSerializer,s=e.common.models.gridLayoutConstants,c=e.explore.contracts.PinData,l=t.constants.upgrader.TileConfigVersion,d=t.contracts.TileType,p=jsCommon.Utility;!(function(o){function r(e,t,o){for(var r=0,i=o.length;r<i;r++){var a=o[r];if(a.vsName===e&&a.dbName===t)return a}}function u(e,t,o,r){return I(e,d.composite,t,o,r)}function h(e,t){var o=m(e,t),r={version:l};if(null!=e.realTimeDataWindow){var i=o;i.dataWindow=e.realTimeDataWindow,r.realTimeVisual=i}else r.visualContainer=o;return r}function m(e,t){var o={$visualContainer:e.visualContainer,$modelExtensions:e.modelExtensions};return f(o,e.dataTransforms,e.baseThemeName,e.elements,e.tileLayoutType,e.queryMetadata,e.themeName,e.tileFilterDetails,e.tileHeading,e.tileSubDisplay,t,c.getVisualType(e)),o}function f(e,t,o,r,i,a,s,c,l,d,p,u){i&&(e.layoutType=i),s&&(e.themeName=s),o&&(e.baseThemeName=o),r&&(e.elements=r),a&&(e.queryMetadata=a),l&&(e.heading1=l),c&&(e.heading2=c),d&&(e.heading3=d);var h=p.capabilities(u);t&&(e.transform=n.serializeTransformActions(n.serializeDataViewTransformActions(t,h&&h.objects)))}function v(e,t,o){var r=h(t,e);t.tileDataType&&(r.tileDataType=t.tileDataType);var i=I(r,null!=t.realTimeDataWindow?d.realTime:d.composite,t.query,t.dataViewSource,o);return i.publishState=2,t.action&&(i.action=JSON.stringify(t.action)),null!=t.utterance&&(i.query.modelQuery.utterance=t.utterance),t.name&&(i.name=t.name),i.reportId=t.reportId,t.modelId&&(i.modelId=t.modelId),t.packageId&&(i.packageId=t.packageId),i.resourcePackageIds=t.resourcePackageIds,i}function g(e){var o=_.omit({id:++P,type:e.type,query:e.query,action:e.action,$config:e.$config,tileData:e.tileData,tileDataSet:e.tileDataSet,publishState:e.publishState,displayText:e.displayText,subDisplayText:e.subDisplayText,modelId:e.modelId,reportId:e.reportId,workbookId:e.workbookId,packageId:e.packageId,name:e.name},(function(e){return void 0===e})),r=t.ContractUtils.getMasterLayoutPosition(e),i=t.ContractUtils.createMasterLayoutConfig({height:r.height,width:r.width});return o.$layoutConfig=i,o.layoutConfig=JSON.stringify(i),o}function y(e,o,r,a,n,c,p,u,h,m,f){var v={version:l};(p||u)&&(v.reportTile={pod:p,filters:u});var g;h&&(g={modelQuery:{utterance:h}});var y=2*i.defaultGridWidth,b=2*i.defaultGridHeight,S=m?m/y:2,k=f?f/b:2;0===Math.round(S)&&(S=2),0===Math.round(k)&&(S=2);var T=Math.round(i.gridItemMediumLandscapeColSpan*S),D=Math.round(i.gridItemMediumLandscapeRowSpan*k);T=T>s.gridMaxColSpan?s.gridMaxColSpan:T,D=D>s.gridMaxRowSpan?s.gridMaxRowSpan:D;var w=t.ContractUtils.createMasterLayoutConfig({width:T,height:D}),I={id:++P,type:d.report,displayText:a,subDisplayText:n,action:JSON.stringify(c),reportId:e,sectionId:r,modelId:o,publishState:2,query:g,config:v?JSON.stringify(v):void 0,$config:v,layoutConfig:JSON.stringify(w),$layoutConfig:w};return I}function b(e){return 1===e.publishState}function S(){var e=[],t=D();t&&!_.isEmpty(t.tiles)&&e.push(t);var o=w();return o&&!_.isEmpty(o.tiles)&&e.push(o),_.cloneDeep(e)}function k(e){for(var t=S(),o=0,r=t;o<r.length;o++){var i=r[o],a=_.find(i.tiles,(function(t){return t.id===e}));if(null!=a)return a.template}return null}function T(e){if(void 0!==e)return JSON.stringify(e,(function(e,t){return e&&e.charAt&&"$"===e.charAt(0)?void 0:t}))}function D(){var o=[{id:1,title:e.common.localize.get("AddWidgetModal_IframeOption_Title"),description:e.common.localize.get("AddWidgetModal_IframeOption_Description"),iconClass:"pbi-glyph-iframe",template:"<edit-iframe-widget></edit-iframe-widget>",defaultTileContract:{type:d.iframe,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{iframe:{srcUrl:"",embedCode:""},version:"1.0",widget:{id:1,name:"webContent"}},$layoutConfig:t.ContractUtils.createMasterLayoutConfig()}},{id:2,title:e.common.localize.get("AddWidgetModal_ImageOption_Title"),description:e.common.localize.get("AddWidgetModal_ImageOption_Description"),iconClass:"pbi-glyph-image",template:"<edit-image-widget></edit-image-widget>",defaultTileContract:{type:d.image,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{imageTile:{imageUrl:""},version:"1.0",widget:{id:2,name:"image"}},$layoutConfig:t.ContractUtils.createMasterLayoutConfig()}},{id:3,title:e.common.localize.get("Textbox"),description:e.common.localize.get("AddWidgetModal_TextOption_Description"),iconClass:"pbi-glyph-font",template:"<edit-text-widget></edit-text-widget>",defaultTileContract:{type:d.composite,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{version:"1.0",visualContainer:{layoutType:e.common.contracts.TileLayoutType.Default,$visualContainer:{name:p.generateGuid(),config:{singleVisual:{objects:{},visualType:"textbox"}}}},widget:{id:3,name:"textbox"}},$layoutConfig:t.ContractUtils.createMasterLayoutConfig()}},{id:4,title:e.common.localize.get("AddWidgetModal_VideoOption_Title"),description:e.common.localize.get("AddWidgetModal_VideoOption_Description"),iconClass:"pbi-glyph-slideshow",template:"<edit-video-widget></edit-video-widget>",defaultTileContract:{type:d.iframe,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{iframe:{srcUrl:"",embedCode:""},version:"1.0",widget:{id:4,name:"video"}},$layoutConfig:t.ContractUtils.createMasterLayoutConfig()}}];return{title:e.common.localize.get("Add_Widgets_Section_Title"),tiles:o}}function w(){var o=[];return o.push({id:6,title:e.common.localize.get("Realtime_TileTitle"),description:e.common.localize.get("Realtime_TileDetails"),iconClass:"pbi-glyph-streaming-data",defaultTileContract:{type:d.realTime,$action:{action:null,targetUrl:"",openInSameTab:!1},$config:{realTimeVisual:{dataWindow:null,layoutType:e.common.contracts.TileLayoutType.Default,$visualContainer:{name:p.generateGuid(),config:{singleVisual:null}}},version:"1.0"},$layoutConfig:t.ContractUtils.createMasterLayoutConfig({width:i.gridItemSmallLandscapeColSpan,height:i.gridItemSmallLandscapeRowSpan})}}),{title:e.common.localize.get("Add_Realtime_Section_Title"),tiles:o}}function I(o,r,a,n,s){var c=i.gridItemMediumLandscapeColSpan,l=i.gridItemMediumLandscapeRowSpan;t.TileUtils.getVisualType(o)===e.visuals.plugins.card.name&&(c=i.gridItemSmallLandscapeColSpan,l=i.gridItemSmallLandscapeRowSpan);var d=a?{modelQuery:{sq:JSON.stringify(a)}}:null,p=t.ContractUtils.createMasterLayoutConfig({width:c,height:l}),u={id:++P,type:r,query:d,$config:o,tileData:n?T(n.data):null,tileDataSet:n,layoutConfig:JSON.stringify(p),$layoutConfig:p},h=o.visualContainer;return h&&(u.displayText=h.heading1,u.subDisplayText=h.heading3),s&&(u.modelId=s.id),u}function C(e,t,o,r){if(e){var i=_.cloneDeep(e),n=i.realTimeVisual||i.visualContainer;if(n){if(r){var s=e.realTimeVisual||e.visualContainer;n.visualContainer=t.serializeVisualContainer(s.$visualContainer)}else{var c=n.$visualContainer.config.singleVisual,l=c.stylePresetName;l&&(n.stylePresetName=l),n.visual=c.visualType;var s=e.realTimeVisual||e.visualContainer,d=s.$visualContainer.config.singleVisual.objects;if(d){var p=o.capabilities(c.visualType);p&&p.objects&&(n.objects=a.serializeObjects(d,p.objects))}i.visualContainer&&(i.visual=n,delete i.visualContainer),i.version="0.1"}n.$modelExtensions&&(n.modelExtensions=t.serializeModelExtensions(n.$modelExtensions)),delete n.$visualContainer,delete n.$modelExtensions}return JSON.stringify(i)}}var P=100;o.findModel=r,o.createCompositeTile=u,o.createTileConfig=h,o.createTileForPinData=v,o.createNonVisualTileFromExisting=g,o.createReportTileForExploreData=y,o.isTileLoading=b,o.getTileGalleryGroups=S,o.getTileTemplate=k,o.serializeTileConfig=C})(r=o.TileFactory||(o.TileFactory={}))})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=e.common.contracts.ContentTileType,r=jsCommon.EnumExtensions,i=e.common.contracts.Permissions,a=e.common.models.ReportResource,n=e.common.models.ResourceType,s=(function(e){function t(t){var o=e.call(this,"undefined"==typeof t?0:t.id,n.Workbook,"undefined"==typeof t?0:t.packageId)||this;return o.contract=t,o}return __extends(t,e),t.prototype.getPermissions=function(){var e;return this.getPermissionsCallback&&(e=this.getPermissionsCallback()),e?e:this.contract&&this.contract.permissions},Object.defineProperty(t.prototype,"contentTileType",{get:function(){return o.Workbook},enumerable:!0,configurable:!0}),t.prototype.isOwner=function(){return r.hasFlag(this.getPermissions(),i.All)},t.prototype.isPersonalized=function(){var e=this.getPermissions();return r.hasFlag(e,i.ReadWrite|i.Explore)&&!r.hasFlag(e,i.All)},t.prototype.isEditable=function(){var e=this.editUrl;return this.isOwner()&&null!==e&&void 0!==e&&""!==e},Object.defineProperty(t.prototype,"displayNameWithExtension",{get:function(){var e=jsCommon.FileUtils.getFileExtension(this.contract.sourceFilePath);return this.displayName.concat(".").concat(e)},enumerable:!0,configurable:!0}),t})(a);t.Workbook=s})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){var r=e.explore.services.createVisualHostServices,i=e.data.services.DataViewTransformActionsSerializer,a=e.common.models.gridLayoutConstants,n=e.common.helpers.ModelConverterHelper,s=(function(){function e(e,t,o){this.useSmallPlotArea=!1,this.contract=e,this.visualPluginService=t,this.pluginOps=o}return Object.defineProperty(e.prototype,"type",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileData",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isError",{get:function(){return this._isError},set:function(e){this._isError=e,this.onErrorDelegate&&this.onErrorDelegate()},enumerable:!0,configurable:!0}),e.prototype.isDataStale=function(e){return!1},e.prototype.setDependencies=function(e){this.dataProxy=e},e.prototype.setDataLoadEventDelegate=function(e){this.dataLoadEventDelegate=e},e.prototype.copyDependencies=function(e){e.dataProxy&&this.setDependencies(e.dataProxy)},e})();o.CompositeTileModel=s,o.staleDataDeltaInMs=36e5;var c=(function(s){function c(e,t,o,i,a,n,c,l){var d=s.call(this,e,t,o)||this;return d.requiresResize=!1,d.geoLocationService=a,d.geocoder=n,d.featureSwitches=i,d.promiseFactory=c,d.moduleLoader=l,d._visual={hostServices:r(d.promiseFactory,d.moduleLoader,a,n)},d}return __extends(c,s),Object.defineProperty(c.prototype,"type",{get:function(){return t.contracts.CompositeTileType.SingleVisual},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"visual",{get:function(){return this._visual},enumerable:!0,configurable:!0}),c.prototype.getThemeName=function(){return this._visual&&this._visual.themeName},c.prototype.getBaseThemeName=function(){return this._visual&&this._visual.baseThemeName},c.prototype.isDataStale=function(e){if(!e)return!1;var t=this.contract,r=n.convertRefreshTimeToJsDateTime(t.tileDataUpdatedTime),i=r&&r.getTime();return!!i&&e-i>o.staleDataDeltaInMs},c.prototype.setData=function(e,t,o){this.ensureVisual(),this._visual.data=e,this._visual.dataTransforms=t,this._visual.type=o},c.prototype.ensureVisual=function(){this._visual||(this._visual={hostServices:r(this.promiseFactory,this.moduleLoader,this.geoLocationService,this.geocoder)},this.calculateLayout())},Object.defineProperty(c.prototype,"config",{get:function(){return this._config},set:function(e){if(this._config=e,this._visual){var t=e.$visualContainer.config.singleVisual,o=t.visualType;this._visual.baseThemeName=e.baseThemeName,this._visual.type=o,this._visual.themeName=e.themeName,this._visual.stylePresetName=t.stylePresetName;var r,a,n=this.visualPluginService.capabilities(o);n&&(r=n.objects,a=t.objects);var s=jsCommon.JsonExtensions.tryParseJSON(e.transform);s?this._visual.dataTransforms=i.deserializeDataViewTransformActions(s,r):this._visual.dataTransforms=i.createTransformActions(e.queryMetadata,e.elements,r,a)}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tileData",{get:function(){return this._tileData},set:function(e){this._tileData=e,this.readDataView(!0)},enumerable:!0,configurable:!0}),c.prototype.refreshData=function(){this.readDataView(!1)},c.prototype.setDependencies=function(e){var t=!this.dataProxy&&this._tileData&&!this.isLoading;s.prototype.setDependencies.call(this,e),t&&this.refreshData()},c.prototype.readDataView=function(o){return __awaiter(this,void 0,e.Promise,(function(){
var r,i,a,n,s,c,l,d,p,u,h;return __generator(this,(function(m){switch(m.label){case 0:if(r=this._visual.type,i=e.visualHost.utils.shouldDisableVisual(r,e.common.localize.shouldDisableMap()),this.visual&&!this.requiresData()&&!i)return[2];if(a=this.dataProxy,!a)return[2];if(this.contract.queryResultError&&(n=t.TileUtils.getTileErrorDetailsFromQueryResultError(this.contract.queryResultError),n?(this.isError=!0,this.errorDetails=n,this.errorText=n.message):this.errorText=e.common.localize.get("Tile_ErrorText")),!this._tileData||!this._tileData.data)return this.isLoading=!0,[2];s=this._tileData,c={type:s.type,query:{dataSources:null,command:s.data},allowCache:o,perfId:r,kinds:this.pluginOps.dataViewKinds(r)},l=null,this.dataLoadEventDelegate&&(l=this.dataLoadEventDelegate(),this.dataLoadEventDelegate=null),m.label=1;case 1:return m.trys.push([1,3,,4]),[4,a.execute(c)];case 2:return d=m.sent(),p={dataView:d&&d.dataReaderResult?d.dataReaderResult.dataView:null,dataViewSource:d&&d.dataViewSource?d.dataViewSource:null},u=d.dataReaderResult.error,i&&(u={code:"NotSupportedForLocale",debugInfo:"",getDetails:function(e){return{displayableErrorInfo:[{errorInfoKey:e.get("VisualContainer_NotSupportedForLocaleKey"),errorInfoValue:e.get("VisualContainer_NotSupportedForLocaleValue")}],message:e.get("VisualContainer_NotSupportedForLocaleMessage")}},ignorable:!1,requestId:""},this.errorDetails=u.getDetails(e.common.localize),this.errorText=this.errorDetails.message),this._visual.data=p,this.isError=this.isError||null!=u,l&&(this.isError?l.reject():l.resolve()),[3,4];case 3:return h=m.sent(),this.isError=!0,l&&l.reject(),[3,4];case 4:return[2]}}))}))},c.prototype.applyLayout=function(t){if(this.requiresResize){var o=this.visual;if(o&&o.visual){var r=o.visual,i=t===a.changeType.resized?2:t===a.changeType.resizing?1:void 0;r.update({viewport:o.viewport,dataViews:o.dataViews,suppressAnimations:!0,type:e.VisualUpdateType.Resize,resizeMode:i})}this.requiresResize=!1}},c.prototype.calculateLayout=function(t,r){if(t&&(this.viewport&&this.viewport.height===t.height&&this.viewport.width===t.width||(this.requiresResize=!0),this.viewport=t),null!=r&&this.useSmallPlotArea!==r&&(this.useSmallPlotArea=r,this.requiresResize=!0),this.viewport){var i=this.viewport.height,a=this.viewport.width;switch(this._config&&this._config.layoutType){case e.common.contracts.TileLayoutType.Full:break;default:i-=this.useSmallPlotArea?o.TileConstants.VisualSmallVerticalMargin:o.TileConstants.VisualVerticalMargin,a-=o.TileConstants.VisualHorizontalMargin}this._visual&&(this._visual.viewport={height:i,width:a,scale:1})}},c.prototype.canResizeTo=function(t){var o=this._visual&&this._visual.visual;return!!o&&(!o.canResizeTo||o.canResizeTo(e.common.GridLayoutConstants.getDefaultGridItemViewport(t)))},c.prototype.getErrorLocId=function(e,t){return""},c.prototype.requiresData=function(){var e=this.visual,t=this.pluginOps;if(e){if(e&&e.type){if(!t)return!0;if(!t.isQueryVisual(e.type))return!1}return!0}},c.prototype.updateVisualInteractivityOptions=function(e){var t=this.visualPluginService.getInteractivityOptions(this._visual.type);"undefined"!=typeof t.isInteractiveLegend&&(t.isInteractiveLegend=t.isInteractiveLegend&&e),this._visual.interactivityOptions=t},c})(s);o.SingleVisualCompositeTileModel=c})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.tileModel=e}return Object.defineProperty(e.prototype,"isSelected",{get:function(){return this.tileModel.isSelected},set:function(e){this.tileModel.isSelected=e},enumerable:!0,configurable:!0}),e})();e.DashboardTileModel=t})(t=e.models||(e.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=(function(){function t(e){this.contract=e}return t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.IframeTileModel=o})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=(function(){function t(e){this.contract=e}return Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){this._imageUrl=e,e&&!this.isStatic&&0!==e.indexOf("data:")&&(this._imageUrl=jsCommon.Utility.getAbsoluteUri(e))},enumerable:!0,configurable:!0}),t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.ImageTileModel=o})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=(function(){function t(e){this.contract=e}return t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeRowSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.ModelTileModel=o})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){var r=t.constants.SingleValueRealTimeWindow,i=e.data.EmptyDataClientError,a=e.data.FailedRealTimeUpdateClientError,n=(function(n){function s(e,t,o,r,i,a,s,c){var l=n.call(this,e,t,o,r,i,a,s,c)||this;return l._visual=null,l}return __extends(s,n),s.prototype.setModelId=function(e){this.contract.modelId=e,this.initialize()},Object.defineProperty(s.prototype,"realTimeModelId",{get:function(){var e=this.contract,t=this.modelService.findModel(e.modelId,e.packageId);return t&&t.contract?{id:t.id,originalModelId:t.contract.originalModelId,tableName:this.getSchemaTableName(),schema:this.getRealTimeConceptualSchema(),packageId:e.packageId}:null},enumerable:!0,configurable:!0}),s.prototype.setRealTimeModelDependencies=function(e,t,o,r,i){n.prototype.setDependencies.call(this,e),this.visualQueryGenerator=t,this.conceptualSchemaProxy=o,this.realTimeDataService=r,this.modelService=i},s.prototype.copyRealTimeModelDependencies=function(e){e.schema&&(this.schema=e.schema),e.dataProxy&&e.realTimeDataService&&e.visualQueryGenerator&&e.conceptualSchemaProxy&&(this.setRealTimeModelDependencies(e.dataProxy,e.visualQueryGenerator,e.conceptualSchemaProxy,e.realTimeDataService,e.modelService),e.onErrorDelegate&&!this.onErrorDelegate&&(this.onErrorDelegate=e.onErrorDelegate),this.realTimeDataService.replaceListener(e.realTimeModelId,e,this))},s.prototype.onDataChanged=function(){var t=this;if(this.singleVisualConfig){var o=r,a=this.config;a&&a.dataWindow&&(o=a.dataWindow);var n=this.visualQueryGenerator.execute({dataSources:this.datasources,schema:this.schema,config:this.singleVisualConfig,additionalFilters:null,dataWindow:o});if(!n||n.error){var s=void 0;n&&n.error&&(s=n.error.getDetails(e.common.localize)),this.onError(s)}else this.dataProxy.execute(n.options).then((function(e){t.isError=!1;var o={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null},r=t.lastCategoryValue;try{var i=t.getLastDateOrNumericCategoryValue(o.dataView);if(null!=r&&null!=i&&r.valueOf()>=i.valueOf())return;t.lastCategoryValue=i}catch(e){}t.setData(o,n.transforms,t.config.$visualContainer.config.singleVisual.visualType),t.isLoading=!1}),(function(o){if(!(o instanceof i)){var r=o&&o.getDetails(e.common.localize);t.onError(r)}}))}},s.prototype.onError=function(t){t||(t=(new a).getDetails(e.common.localize)),this.setErrorDetails(t)},Object.defineProperty(s.prototype,"datasources",{get:function(){var e=this.realTimeModelId;if(e)return o.RealTimeModelUtility.getRealTimeDataSource(e.id,e.originalModelId)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"singleVisualConfig",{get:function(){return this.config.$visualContainer.config.singleVisual},set:function(e){this.config.$visualContainer.config.singleVisual=e,this.onDataChanged()},enumerable:!0,configurable:!0}),s.prototype.isDataStale=function(e){return!1},s.prototype.initialize=function(){var e=this,o=t.ContractUtils.getMasterLayoutPosition(this.contract);this.size={rowSpan:o.height,colSpan:o.width};var r=this.datasources;r&&this.conceptualSchemaProxy.get(r).then((function(t){e.fixUpSchema(t),e.schema=t,e.realTimeDataService.subscribe(e.realTimeModelId,e)}))},s.prototype.unsubscribe=function(){this.realTimeModelId&&this.realTimeDataService.unsubscribe(this.realTimeModelId,this)},s.prototype.fixUpSchema=function(o){for(var r=o.schema(t.constants.RealTimeDataSourceName).entities,i=r[0].properties,a=0,n=i;a<n.length;a++){var s=n[a];s.type!==e.ValueType.fromDescriptor({numeric:!0})&&s.type!==e.ValueType.fromDescriptor({integer:!0})||(s.kind=1)}},s.prototype.getSchemaTableName=function(){var e=this.getRealTimeConceptualSchema();if(e){var t=e.entities;return _.first(t).name}},s.prototype.getRealTimeConceptualSchema=function(){if(this.schema)return this.schema.schema(t.constants.RealTimeDataSourceName)},s.prototype.setErrorDetails=function(e){this.errorDetails=e,this.errorText=e.message,this.isError=!0},s.prototype.getLastDateOrNumericCategoryValue=function(e){var t=e&&e.categorical;if(t){var o=_.first(t.categories),r=o&&o.values;if(!_.isEmpty(r)){var i=_.last(r);return i&&!_.isBoolean(i)&&(_.isDate(i)||_.isNumber(i))?i:void 0}}},s})(o.SingleVisualCompositeTileModel);o.RealTimeTileModel=n})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){var r,i=o.RealTimeModel;!(function(o){function r(o,r){if(o&&!(o<0))return e.explore.contracts.createDataSourceArray([{id:o,type:e.data.tabular.type,name:t.constants.RealTimeDataSourceName,tabular:{modelId:null!=r?r:o}}])}function a(t){var o=e.data.tabular.getColumnsMetadata(t);if(o){for(var r=[],a=0,n=o;a<n.length;a++){var s=n[a];r.push({name:s.name,dataType:i.convertToRealTimeDataType(e.ValueType.fromDescriptor(s.type))})}return r}}o.getRealTimeDataSource=r,o.convertToColumnsDefinition=a})(r=o.RealTimeModelUtility||(o.RealTimeModelUtility={}))})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=(function(){function t(e){this.contract=e,this.exploration={contract:void 0,exploreCanvas:void 0,sections:[]},this.isError=!1,this.tilesUpdated=!1}return t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.ReportTileModel=o})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=(function(){function t(e){this.contract=e}return Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){e&&(0!==e.indexOf("data:")?this._imageUrl=jsCommon.Utility.getAbsoluteUri(e):this._imageUrl=e)},enumerable:!0,configurable:!0}),t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemLargeLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemLargeLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){return""},t})();t.SsrsTileModel=o})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){function r(e){if(!(_.isEmpty(e)||e.length<o.DashboardIntraDomainNavigationPrefix.length)&&i(e))return e.substr(o.DashboardIntraDomainNavigationPrefix.length)}function i(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(o.DashboardIntraDomainNavigationPrefix)}function a(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(o.ReportIntraDomainNavigationPrefix)}function n(e){return!_.isEmpty(e)&&0===e.toLowerCase().indexOf(o.WorkbookIntraDomainNavigationPrefix)}function s(e){return i(e)||a(e)||n(e)}var c,l=jsCommon.ArrayExtensions,d=jsCommon.DateExtensions,p=e.common.utils.DateFormatter,u=e.common.helpers.ModelConverterHelper,h=jsCommon.UrlUtils;!(function(e){e[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report"})(c=o.IntraDomainNavigationType||(o.IntraDomainNavigationType={})),o.getDashboardGuidFromUrl=r,o.IsDashboardIntraDomainPrefix=i,o.IsReportIntraDomainPrefix=a,o.IsWorkbookIntraDomainPrefix=n,o.IsValidIntraDomainPrefix=s,o.DashboardIntraDomainNavigationPrefix="/dashboards/",o.ReportIntraDomainNavigationPrefix="/reports/",o.WorkbookIntraDomainNavigationPrefix="/workbooks/";var m;!(function(e){e.SubtitleHeight=10,e.TileDefaultPadding=10,e.RegularHeaderHeight=50,e.SmallHeaderHeight=42,e.LargeHeaderHeight=65,e.VisualVerticalMargin=20,e.VisualHorizontalMargin=20,e.VisualSmallVerticalMargin=8})(m=o.TileConstants||(o.TileConstants={}));var f=(function(){function o(e,t){this.isSelected=!1,this.hasSpotlight=!1,this.contract=e,this.tileHeaderSize=1,this.layoutPosition={},this.localizationService=t}return Object.defineProperty(o.prototype,"gridLayouts",{get:function(){return this.contract.$layoutConfig.layouts},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"id",{get:function(){return this.contract.id},set:function(e){this.contract.id=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"objectId",{get:function(){return this.contract.objectId},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"details",{get:function(){switch(this.type){case t.contracts.TileType.composite:return this.composite;case t.contracts.TileType.iframe:return this.iframe;case t.contracts.TileType.image:return this.image;case t.contracts.TileType.model:return this.model;case t.contracts.TileType.ssrs:return this.ssrs;case t.contracts.TileType.workbook:return this.workbook;case t.contracts.TileType.report:return this.reportTile;case t.contracts.TileType.realTime:return this.realTime;default:return null}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shouldBeIncludedInTelemetryMeasurement",{get:function(){return this.details&&!!this.details.shouldBeIncludedInTelemetryMeasurement},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isTemporary",{get:function(){return this.id<=0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isTileLoading",{get:function(){return this.composite?this.composite.isLoading&&!this.composite.isError:this.isLoading},enumerable:!0,configurable:!0}),o.prototype.calculateLayout=function(t){var o=this.getHeaderSizeByType(this.tileHeaderSize);if(this.compositeTile&&t){var r=t,i=2===this.tileHeaderSize;if(i)if(this.hasTitle())r.height-=o;else{var a=this.composite&&this.composite.config&&this.composite.config.layoutType;a!==e.common.contracts.TileLayoutType.Full&&(r.height-=m.TileDefaultPadding)}else this.hasTitle()&&(this.hasSubtitle()?r.height-=o:r.height-=o-m.SubtitleHeight);this.compositeTile.calculateLayout(r,i)}},o.prototype.applyLayout=function(e){this.compositeTile&&this.compositeTile.applyLayout(e)},o.prototype.invalidateLayout=function(){this.tryPopulateLayoutPositionValues()&&this.gridLayoutContext.onLayoutInvalidated()},o.prototype.tryPopulateLayoutPositionValues=function(){if(!this.gridLayoutContext||this.gridLayoutContext.isLayoutUpdateLocked)return!1;var e=this.gridLayoutContext.getActiveLayout(),t=l.extendWithId(this.contract.$layoutConfig.layouts),o=t.withId(e);return o&&o.position&&(this.layoutPosition=_.cloneDeep(o.position)),!0},o.prototype.applyChanges=function(){if(this.contract&&this.gridLayoutContext){var e=_.cloneDeep(this.layoutPosition),t=this.contract.$layoutConfig;this.addOrUpdateLayoutPosition(t,e),this.contract.layoutConfig=JSON.stringify(this.contract.$layoutConfig)}},o.isValidUrl=function(e,t){return!_.isEmpty(e)&&(h.isValidHttpUrl(e)||t&&s(e))},o.prototype.getDisplayText=function(){if(this.displayText)return this.displayText;if(this.compositeTile){var e=this.compositeTile.config;if(e&&!_.isEmpty(e.heading1))return e.heading1}return""},o.prototype.getSubDisplayText=function(){if(this.displayText&&this.subDisplayText)return this.subDisplayText;if(this.compositeTile){var e=this.compositeTile.config;if(!this.displayText&&e&&!_.isEmpty(e.heading3))return e.heading3}return""},o.prototype.shouldPlaceBulletSeperator=function(){var e=this.displayText&&this.displayText.length>0;return e&&this.subDisplayText&&this.subDisplayText.length>0&&this.config&&this.config.lastRefreshTimeEnabled},Object.defineProperty(o.prototype,"hrefTarget",{get:function(){return this.action.openInSameTab?"_self":"_blank"},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lastRefreshTimeInLocaleString",{get:function(){var e=u.convertRefreshTimeToJsDateTime(this.contract.tileDataUpdatedTime);return e?e.toLocaleString():this.datasetModel?this.datasetModel.lastRefreshTimeInLocaleString:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"formattedTime",{get:function(){var e;if(this.workbook){var t=this.contract.tilePackage;e=t?u.convertRefreshTimeToJsDateTime(t.lastRefreshTime):null}else e=u.convertRefreshTimeToJsDateTime(this.contract.tileDataUpdatedTime);if(e){var o=v,r=d.isContainedInTimeFrame,i=d.isMomentPresent();return i&&r(e,o.Minute,o.MaxMinuteThreshold,!1)?p.getPrettyRelativeDate(e,this.localizationService):i&&r(e,o.Day,o.SameDayThreshold,!0)?d.GetTime(this.localizationService.currentLanguageLocale,e):i&&r(e,o.Day,o.YesterdayThreshold,!0)?this.localizationService.format("DashboardTile_YesterdayTemplate",[d.GetTime(this.localizationService.currentLanguageLocale,e)]):i&&r(e,o.Day,o.WeekThreshold,!0)?d.GetDayWithTime(this.localizationService.currentLanguageLocale,e):d.GetFullDateWithTime(this.localizationService.currentLanguageLocale,e)}if(this.datasetModel)return this.datasetModel.lastRefreshTimeInLocaleString},enumerable:!0,configurable:!0}),o.prototype.setDatasetModelAndPackageInfo=function(e,t){e&&(this.datasetModel=e,t&&(this.datasetModel.packagePublishStatus=t.publishOrRefreshStatus))},o.prototype.hasTitle=function(){if(this.config&&this.config.hideTitle)return!1;var e=this.compositeTile?this.compositeTile.config:null;return!_.isEmpty(this.displayText)||e&&!_.isEmpty(e.heading1)},o.prototype.hasSubtitle=function(){var e=this.config;return(!e||!e.hideTitle)&&(!_.isEmpty(this.subDisplayText)||e&&e.lastRefreshTimeEnabled)},o.prototype.lastRefreshTimeInLocaleWithLabel=function(){if(this.config&&this.config.lastRefreshTimeEnabled)return this.localizationService.format("DashboardTile_LastRefreshTimeTemplate",[this.formattedTime])},o.prototype.setTileHeaderSize=function(e){this.tileHeaderSize!==e&&(this.tileHeaderSize=e,this.invalidateLayout())},Object.defineProperty(o.prototype,"compositeTile",{get:function(){return this.composite||this.realTime},enumerable:!0,configurable:!0}),o.prototype.hasLayoutDefinition=function(e){var t=l.extendWithId(this.contract.$layoutConfig.layouts);return!!t.withId(e)},o.prototype.hasLayoutPosition=function(e){return!!t.ContractUtils.getLayoutPosition(this.contract,e)},o.prototype.removeLayoutPosition=function(e){return void 0===e&&(e=1),this.hasLayoutDefinition(e)&&(this.addLayout({id:e,position:null},e),this.resetTileLayoutSizeAndPosition()),this.getCurrentTileLayoutDescriptor()},o.prototype.resetTileLayoutSizeAndPosition=function(){this.layoutPosition.x=null,this.layoutPosition.y=null,this.layoutPosition.height=null,this.layoutPosition.width=null,this.gridLayoutContext=null},o.prototype.removeLayoutDefinition=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.hasLayoutDefinition(e)&&(_.remove(this.contract.$layoutConfig.layouts,(function(t){return t.id===e})),t&&this.resetTileLayoutSizeAndPosition()),this.getCurrentTileLayoutDescriptor()},o.prototype.applyLayoutSize=function(e,t){this.compositeTile&&(this.compositeTile.size={colSpan:e.colSpan,rowSpan:e.rowSpan}),this.applyLayout(t)},o.prototype.getCurrentTileLayoutDescriptor=function(e,t){var o=e?e:this.contract.$layoutConfig;return{id:this.id,row:null,col:null,rowSpan:null,colSpan:null,layoutConfig:JSON.stringify(o),query:t?t[0]:null,updatedQuery:t?t[1]:null,modelId:this.contract.modelId}},o.prototype.buildLayoutDescriptor=function(){var e=_.cloneDeep(this.layoutPosition),t=_.cloneDeep(this.contract.$layoutConfig);this.addOrUpdateLayoutPosition(t,e);var o=this.updateTileQueryAfterResize(e);return this.getCurrentTileLayoutDescriptor(t,o)},o.prototype.updateTileQueryAfterResize=function(o){var r=this.composite&&this.composite.contract&&this.composite.contract.query;if(r){var i=t.ContractUtils.convertToTileDataQuery(r);if(!i)return;for(var a=_.cloneDeep(r),n=o.width*e.common.GridLayoutConstants.defaultGridWidth,s=o.height*e.common.GridLayoutConstants.defaultGridHeight,c=!1,l=0,d=i.Commands;l<d.length;l++){var p=d[l],u=p.ScriptVisualCommand;if(u){var h=u.ViewportWidthPx,m=u.ViewportHeightPx;h===n&&m===s||(u.ViewportWidthPx=n,u.ViewportHeightPx=s,p.ScriptVisualCommand=u,c=!0)}}if(c){this.composite.contract.query.modelQuery.sq=JSON.stringify(i);var f=JSON.stringify(this.composite.contract.query);return[a,f]}}},o.prototype.addOrUpdateLayoutPosition=function(e,t){var o=this.gridLayoutContext.getActiveLayout(),r=l.extendWithId(e.layouts),i=r.withId(o);i||(i={id:o,position:{}},r.push(i)),i.position=t},o.prototype.addLayout=function(e,t){return this.removeLayoutDefinition(t),this.contract.$layoutConfig.layouts.push(e),this.getCurrentTileLayoutDescriptor()},o.prototype.getHeaderSizeByType=function(e){switch(e){case 0:return m.LargeHeaderHeight;case 2:return m.SmallHeaderHeight;case 1:default:return m.RegularHeaderHeight}},o})();o.Tile=f;var v;!(function(e){e.Minute="minute",e.Day="day",e.MaxMinuteThreshold=15,e.SameDayThreshold=0,e.YesterdayThreshold=1,e.WeekThreshold=6})(v||(v={}))})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=(function(){function t(e,t){this.contract=e,this.tileModel=t}return t.prototype.canResizeTo=function(t){return t.rowSpan===e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan||t.colSpan===e.common.GridLayoutConstants.gridItemSmallLandscapeColSpan},t.prototype.getErrorLocId=function(e,t){var o,r=[];switch(e){case 10:o="WorkbookTile_GeneralError";break;case 11:o="WorkbookTile_FileNotFound";break;case 12:o="WorkbookTile_ObjectNotFound",r=this.contract.$config.workbookTile?[this.contract.$config.workbookTile.item]:["pinned object"];break;case 13:o="WorkbookTile_Unauthorized";break;default:return""}return t.format(o,r)},t.prototype.hasImages=function(){return this.hasWorkbookTileConfig&&this.tileModel.config.workbookTile.images&&this.tileModel.config.workbookTile.images.length>0},Object.defineProperty(t.prototype,"images",{get:function(){return this.hasWorkbookTileConfig?this.tileModel.config.workbookTile.images:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasWorkbookTileConfig",{get:function(){return!!this.tileModel&&!!this.tileModel.config&&!!this.tileModel.config.workbookTile},enumerable:!0,configurable:!0}),t})();t.WorkbookTileModel=o})(o=t.models||(t.models={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=i.tryParseJSON(e.layoutConfig),o=r.extendWithId(t.layouts).withId(0);e.col=o.position.x,e.row=o.position.y,e.colSpan=o.position.width,e.rowSpan=o.position.height}function o(e){for(var t=0,o=e;t<o.length;t++){var a=o[t],n=i.tryParseJSON(a.layoutConfig),s=r.extendWithId(n.layouts).withId(0);a.col=s.position.x,a.row=s.position.y,a.colSpan=s.position.width,a.rowSpan=s.position.height}}var r=jsCommon.ArrayExtensions,i=jsCommon.JsonExtensions;e.conformOutgoingTile=t,e.conformOutgoingTileLayoutDescriptors=o})(t=e.compatibility||(e.compatibility={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,o,r,i,a,s){return t.dashboardHttpService||(t.dashboardHttpService=new n(e,o,r,i,a,s)),t.dashboardHttpService}var r=jsCommon.GzipUtility,i=t.models.TileFactory;t.createDashboardHttpService=o;var a=1048576,n=(function(){function o(e,t,o,r,i,a){this.syncService=e,this.promiseFactory=t,this.notificationToastService=o,this.explorationSerializer=r,this.featureSwitchService=i,this.visualPlugin=a,this.batchedDashboardRequests=[]}return o.prototype.getDashboardContainer=function(t){var o=e.common.httpService.powerbiRequestOptions(t,"GetDashboardContainer");return e.common.httpService.get("powerbi/metadata/dashboards",o)},o.prototype.getDashboards=function(e,t,o){return this.getDashboardsInternal(e,t,o)},o.prototype.getDashboardContainerByObjectId=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"GetDashboardByObjectId"),i=this.getDashboardContainerByObjectIdUrl(t);return e.common.httpService.get(i,r)},o.prototype.batchGetDashboards=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"GetDashboardsByIds");return i.enableTelemetry=!0,e.common.httpService.post("powerbi/metadata/getDashboardsByIds",JSON.stringify(o),i)},o.prototype.getDashboardMetadata=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"GetDashboardMetadata");return i.enableTelemetry=!0,e.common.httpService.get("powerbi/metadata/dashboards/"+o+"/metadata",i)},o.prototype.getDashboardUrl=function(e){return"powerbi/metadata/dashboards/"+e},o.prototype.getDashboardContainerByObjectIdUrl=function(e){return"metadata/embed/dashboard/"+e},o.prototype.addDashboard=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"AddDashboard");this.syncService.addMetadataEditRequestId(r.headers[e.telemetryConstants.httpRequestIdHeader]);var i={displayName:t.displayName};return r.enableTelemetry=!0,e.common.httpService.put("powerbi/metadata/dashboards",i,r)},o.prototype.renameDashboard=function(o,r,i){t.DashboardUtils.isWriteable(o)||this.notifyReadOnly(o.id);var a=e.common.httpService.powerbiRequestOptions(i,"RenameDashboard");return this.syncService.addMetadataEditRequestId(a.headers[e.telemetryConstants.httpRequestIdHeader]),a.enableTelemetry=!0,e.common.httpService.post("powerbi/metadata/dashboards/"+o.id+"/name",JSON.stringify(r),a)},o.prototype.duplicateDashboard=function(o,r,i){t.DashboardUtils.isWriteable(o)||this.notifyReadOnly(o.id);var a=e.common.httpService.powerbiRequestOptions(i,"DuplicateDashboard");return this.syncService.addMetadataEditRequestId(a.headers[e.telemetryConstants.httpRequestIdHeader]),a.enableTelemetry=!0,e.common.httpService.post("powerbi/metadata/dashboards/"+o.id+"/copy",JSON.stringify(r),a)},o.prototype.setQnaEnabledForDashboard=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"SetQnaEnabled");return this.syncService.addMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),i.enableTelemetry=!0,e.common.httpService.post("powerbi/metadata/dashboards/"+t+"/qnaEnabled",JSON.stringify(o),i)},o.prototype.deleteDashboard=function(o,r){t.DashboardUtils.isWriteable(o)||this.notifyReadOnly(o.id);var i=e.common.httpService.powerbiRequestOptions(r,"DeleteDashboard");this.syncService.addMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),i.enableTelemetry=!0;var a="powerbi/metadata/dashboards/"+o.id;return e.common.httpService.delete(a,i)},o.prototype.exportDashboard=function(o,r,i){if(!t.DashboardUtils.isWriteable(o))return this.notificationToastService.notify({title:e.common.localize.get("Warning_Title"),message:e.common.localize.get("DashboardReadOnlyExportWarning_Message"),notificationType:e.common.NotificationToastType.Alert}),null;var a=e.common.httpService.powerbiRequestOptions(i,"ExportDashboard");return a.responseType="blob",a.enableTelemetry=!0,e.common.httpService.get("powerbi/resource/packages/"+o.id+"/?packageType="+r,a)},o.prototype.addTile=function(o,n,s,c,l){if(!t.DashboardUtils.isWriteable(o))return e.common.httpService.getResolvedHttpChain();var d=e.common.httpService.powerbiRequestOptions(l);this.syncService.addMetadataEditRequestId(d.headers[e.telemetryConstants.httpRequestIdHeader]);var p={id:0,type:n.type,config:i.serializeTileConfig(n.$config,this.explorationSerializer,this.visualPlugin,this.featureSwitchService.featureSwitches.visualContainerTileConfig),displayText:n.displayText,subDisplayText:n.subDisplayText,name:n.name,action:n.action,image:n.image,query:n.query,tileDataBinaryBase64Encoded:r.compress(n.tileData),layoutConfig:n.layoutConfig,publishState:n.publishState,resourcePackageIds:n.resourcePackageIds};p.modelId=n.modelId,p.reportId=n.reportId,p.workbookId=n.workbookId,p.sectionId=n.sectionId,"number"==typeof n.packageId&&(p.packageId=n.packageId),t.compatibility.conformOutgoingTile(p);var u=JSON.stringify(p).length;return u>a?this.promiseFactory.reject({data:p,headers:function(){return null},status:e.HttpStatusCode.RequestEntityTooLarge,error:{code:"AddTileRequestTooLarge","pbi.error":{code:"AddTileRequestTooLarge",parameters:[],details:[],exceptionCulprit:e.ExceptionCulprit.User}}}):(d.telemetryDescription="AddTile",d.enableTelemetry=!0,e.common.httpService.put("powerbi/metadata/tiles/"+o.id,p,d))},o.prototype.updateTile=function(t,o,r){var i,a={};return _.isEqual(t.displayText,o.displayText)||(a.displayText=o.displayText),_.isEqual(t.subDisplayText,o.subDisplayText)||(a.subDisplayText=o.subDisplayText),_.isEqual(t.action,o.action)||(a.action=o.action),_.isEqual(t.config,o.config)||(a.config=o.config),_.isEqual(t.query,o.query)||(a.query=o.query),_.isEqual(t.tileData,o.tileData)||(a.tileDataBinaryBase64Encoded=jsCommon.GzipUtility.compress(o.tileData)),i=e.common.httpService.powerbiRequestOptions(r,"UpdateTile"),i.enableTelemetry=!0,this.syncService.addMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),e.common.httpService.patch("powerbi/metadata/tiles/"+t.id,JSON.stringify(a),i)},o.prototype.deleteTile=function(o,r,i){t.DashboardUtils.isWriteable(o)||this.notifyReadOnly(o.id);var a=e.common.httpService.powerbiRequestOptions(i,"DeleteTile");return this.syncService.addMetadataEditRequestId(a.headers[e.telemetryConstants.httpRequestIdHeader]),a.enableTelemetry=!0,e.common.httpService.delete("powerbi/metadata/tiles/"+r,a)},o.prototype.getTile=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"GetTile");return r.enableTelemetry=!0,e.common.httpService.get("powerbi/metadata/tiles/"+t,r)},o.prototype.batchGetTiles=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"BatchGetTiles");return i.enableTelemetry=!0,e.common.httpService.post("powerbi/metadata/dashboard/"+t+"/tiles",JSON.stringify(o),i)},o.prototype.renameTile=function(t,o,r,i){var a=e.common.httpService.powerbiRequestOptions(i,"RenameTile");this.syncService.addMetadataEditRequestId(a.headers[e.telemetryConstants.httpRequestIdHeader]);var n={id:t,displayText:o,subDisplayText:r};return a.enableTelemetry=!0,e.common.httpService.post("powerbi/metadata/tiles/"+t+"/displayText",JSON.stringify(n),a)},o.prototype.getTileShortUrl=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"GetTileShortUrl");return i.enableTelemetry=!0,e.common.httpService.get("metadata/dashboards/"+t+"/tiles/"+o+"/shortUrl",i)},o.prototype.batchUpdateTileSizePosition=function(e,o,r,i){if(t.compatibility.conformOutgoingTileLayoutDescriptors(r),!t.DashboardUtils.isWriteable(o))return this.isDashboardBatchTilePositionUpgrade(o,r)||this.notifyReadOnly(o.id),null;var a=r.filter((function(e){return!!e.updatedQuery})),n=r.filter((function(e){return!e.updatedQuery})),s=this.batchUpdateTileSizePositionInternal(o,n,i,!0),c=this.batchUpdateTileSizePositionInternal(o,a,i,!1),l=[];return s&&l.push(s),c&&l.push(c),e.allSettled(l)},o.prototype.batchUpdateTileSizePositionInternal=function(t,o,r,i){
if(void 0===i&&(i=!0),o&&0!==o.length){var a=e.common.httpService.powerbiRequestOptions(r,"SetTileSizePosition"),n=a.headers[e.telemetryConstants.httpRequestIdHeader];return i?this.syncService.addMetadataEditRequestId(n):this.syncService.addDashboardTransactionFilter(n,(function(t){return t.changeType!==e.common.contracts.MetadataChangeType.TileDataChange})),a.enableTelemetry=!0,e.common.httpService.post("/powerbi/metadata/dashboard/"+t.id+"/tiles/sizeandposition",o,a)}},o.prototype.isDashboardBatchTilePositionUpgrade=function(t,o){for(var r={},i=t.tiles,a=0,n=i.length;a<n;++a){var s=i[a];r[s.id]=s}for(var a=0,n=o.length;a<n;++a){var c=o[a],s=r[c.id];if(s&&s.row>e.common.constants.contractRowProtocolThreshold)return!0}return!1},o.prototype.setActiveDashboardId=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"SetActiveDashboard");i.enableTelemetry=!0;var a=null;return o&&o.length>0&&(a=JSON.stringify(o)),e.common.httpService.post("/powerbi/metadata/user/activedashboard/"+t,a,i)},o.prototype.refreshTileData=function(t,o,r,i){var a=e.common.httpService.powerbiRequestOptions(r,"SetActiveDashboard",i);a.enableTelemetry=!0,o=_.unique(o);var n=null;return o&&o.length>0&&(n=JSON.stringify(o)),e.common.httpService.post("/powerbi/metadata/user/activedashboard/"+t+"/refresh",n,a)},o.prototype.notifyReadOnly=function(t,o){var r="NotifiedReadOnlyDashboard"+t,i=o||!e.common.sessionStorageService.getData(r);i&&(this.notificationToastService.notify({title:e.common.localize.get("Warning_Title"),message:e.common.localize.get("DashboardReadOnlyWarning_Message"),notificationType:e.common.NotificationToastType.Alert}),e.common.sessionStorageService.setData(r,!0))},o.prototype.addDashboardRequestToBatch=function(t,o,r){for(var i=this.batchedDashboardRequests,a=0,n=i.length;a<n;++a){var s=i[a];if(s.dashboardId===o&&s.requestType===r)return s.deferred.promise()}var c=$.Deferred(),l={dashboardId:o,deferred:c,requestType:r};return i.push(l),void 0===l.requestType||null===l.requestType||l.requestType===e.common.DashboardRequestType.Default?this.getDashboards(t,[o],void 0).then((function(e){return e&&e.length>0?c.resolve(e[0].data):c.reject()}),(function(){c.reject()})):l.requestType===e.common.DashboardRequestType.Metadata&&this.getDashboardMetadata(t,o,void 0).then((function(e){return e?c.resolve(e.data):c.reject()}),(function(){c.reject()})),c.promise()},o.prototype.getDashboardsInternal=function(t,o,r,i){var a=this;return _.isEmpty(o)?null:(i=i||t.defer(),e.common.httpService.getAll(o.map((function(e){return a.getDashboardUrl(e)})),o.map((function(t){var o=e.common.httpService.powerbiRequestOptions(r,"GetDashboard");return o.enableTelemetry=!0,o}))).then((function(e){i.resolve(e)}),(function(o){for(var n=[],s=[],c=0,l=o.length;c<l;c++){var d=o[c];d.status===e.HttpStatusCode.OK?n.push(d):s.push(d)}var p=!!s.length;n.length?(i.resolve(n),p&&a.getDashboardsInternal(t,s.map((function(e){return e.data.dashboards[0].id})),r,i)):i.reject(s)})),i.promise)},o.prototype.updateDashboardSetting=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"UpdateDashboardSetting");return this.syncService.addMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),i.enableTelemetry=!0,e.common.httpService.post("powerbi/metadata/dashboards/"+t+"/settings",JSON.stringify(o),i)},o})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e){return t.modelHttpService||(t.modelHttpService=new r(e)),t.modelHttpService}t.createModelHttpService=o;var r=(function(){function t(e){this.syncService=e}return t.prototype.getModels=function(t){var o=e.common.httpService.powerbiRequestOptions(t,"GetModels");return e.common.httpService.get("powerbi/metadata/models",o)},t.prototype.getModel=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"GetModel");return o?e.common.httpService.get("powerbi/metadata/models/"+t+"/?modelOptions=Default&packageId="+o,i):e.common.httpService.get("powerbi/metadata/models/"+t+"/?modelOptions=Default",i)},t.prototype.getModelForRefresh=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"GetModelForRefresh");return e.common.httpService.get("powerbi/metadata/models/"+t+"/?modelOption=Refresh&packageId="+o,i)},t.prototype.getModelAndPackageForRefresh=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"GetModelAndPackageForRefresh");return this.syncService.addMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),e.common.httpService.get("powerbi/metadata/models/"+t+"/?modelOption=PackageModelRefresh&packageId="+o,i)},t.prototype.renameModel=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"RenameModel");return this.syncService.addMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),e.common.httpService.post("powerbi/metadata/models/"+t.id+"/name",JSON.stringify(o),i)},t.prototype.deleteModel=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"DeleteModel");return e.common.httpService.delete("powerbi/content/models/"+t.id+"/?packageId="+t.packageId,r)},t.prototype.getPackageModels=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"GetPackageModels");return e.common.httpService.get("powerbi/metadata/packages/"+t+"/models",r)},t.prototype.getModelRefreshHistories=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"GetModelRefreshHistories");return e.common.httpService.get("powerbi/metadata/models/"+t+"/refreshhistories",r)},t.prototype.getPackageRefreshHistories=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"GetPackageRefreshHistories");return e.common.httpService.get("powerbi/metadata/packages/"+t+"/refreshhistories",r)},t.prototype.updateFeaturedQuestions=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"UpdateFeaturedQuestions");return e.common.httpService.put("powerbi/metadata/models/"+t+"/featuredQuestions",JSON.stringify(o),i)},t.prototype.disableRlsModel=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"DisableRlsModel");return e.common.httpService.post("metadata/model/"+t+"/rlsdisabled",JSON.stringify(!1),r)},t.prototype.updateModelQnaFeatures=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"UpdateModelQnaFeatures");return e.common.httpService.post("powerbi/metadata/models/"+t+"/qnafeatures",JSON.stringify(o),i)},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){function o(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"GetPackage");return e.common.httpService.get("powerbi/metadata/packages/"+t,r)}t.getPackage=o})(o=t.packageHttpService||(t.packageHttpService={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e){return new r(e)}t.createReportHttpService=o;var r=(function(){function t(e){this.syncService=e}return t.prototype.getReports=function(t){var o=e.common.httpService.powerbiRequestOptions(t,"GetReports");return e.common.httpService.get("powerbi/metadata/reports",o)},t.prototype.getReport=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"GetReport");return e.common.httpService.get("powerbi/metadata/reports/"+t,r)},t.prototype.renameReport=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"RenameReport");return this.syncService.addMetadataEditRequestId(i.headers[e.telemetryConstants.httpRequestIdHeader]),e.common.httpService.post("powerbi/metadata/reports/"+t.id+"/name",JSON.stringify(o),i)},t.prototype.deleteReport=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"DeleteReport");return e.common.httpService.delete("powerbi/content/reports/"+t.id+"/",r)},t.prototype.getReportShortUrl=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"GetReportShortUrl");i.enableTelemetry=!0;var a="metadata/reports/"+t+"/shortUrl";return null!=o&&o.trim().length>0&&(a=a+"?reportPage="+o),e.common.httpService.get(a,i)},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t){return new i(e,t)}var r=jsCommon.StringExtensions;t.createSubscriptionsHttpService=o;var i=(function(){function t(t,o){this.httpService=e.common.httpService,this.promiseFactory=t,this.telemetryService=o,this.endpoint="metadata/emailsubscriptions"}return t.prototype.createSubscription=function(t,o){var r=this,i=this.promiseFactory.defer(),a=this.telemetryService.startChildEvent(o,e.telemetry.EmailSubscriptionsRequest,e.telemetry.EmailSubscriptionRequestType.Create);return this.httpService.post(this.endpoint,t,this.httpService.powerbiRequestOptions()).then((function(e){a.resolve(),i.resolve(e.data)}),(function(t){var o=e.errorDetailsHelper.getTelemetryErrorDetails(t.error);a.reject(o);var n=r.getErrorCode(t);i.reject({ErrorCode:n,RequestId:t.requestId})})),i.promise},t.prototype.sendReportInstantEmail=function(t,o){return __awaiter(this,void 0,e.Promise,(function(){var r,i,a,n,s,c,l;return __generator(this,(function(d){switch(d.label){case 0:r=this.promiseFactory.defer(),i=this.telemetryService.startChildEvent(o,e.telemetry.InstantEmailRequest),a=this.endpoint+"/instant",d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.httpService.post(a,t,this.httpService.powerbiRequestOptions())];case 2:return n=d.sent(),i.resolve(),r.resolve(n.data),[3,4];case 3:return s=d.sent(),c=e.errorDetailsHelper.getTelemetryErrorDetails(s.error),i.reject(c),l=this.getErrorCode(s),r.reject({ErrorCode:l,RequestId:s.requestId}),[3,4];case 4:return[2,r.promise]}}))}))},t.prototype.getAllSubscriptions=function(t){var o=this,r=this.promiseFactory.defer(),i=this.telemetryService.startChildEvent(t,e.telemetry.EmailSubscriptionsRequest,e.telemetry.EmailSubscriptionRequestType.Get);return this.httpService.get(this.endpoint,this.httpService.powerbiRequestOptions()).then((function(e){i.resolve(),r.resolve(e.data)}),(function(t){var a=e.errorDetailsHelper.getTelemetryErrorDetails(t.error);i.reject(a);var n=o.getErrorCode(t);r.reject({ErrorCode:n,RequestId:t.requestId})})),r.promise},t.prototype.updateSubscription=function(t,o){var r=this,i=this.promiseFactory.defer(),a=this.telemetryService.startChildEvent(o,e.telemetry.EmailSubscriptionsRequest,e.telemetry.EmailSubscriptionRequestType.Update);return this.httpService.put(this.endpoint,t,this.httpService.powerbiRequestOptions()).then((function(e){a.resolve(),i.resolve(e.data)}),(function(t){var o=e.errorDetailsHelper.getTelemetryErrorDetails(t.error);a.reject(o);var n=r.getErrorCode(t);i.reject({ErrorCode:n,RequestId:t.requestId})})),i.promise},t.prototype.deleteSubscription=function(t,o){var i=this,a=this.promiseFactory.defer(),n=this.telemetryService.startChildEvent(o,e.telemetry.EmailSubscriptionsRequest,e.telemetry.EmailSubscriptionRequestType.Delete),s=this.endpoint+"/{0}";return this.httpService.delete(r.format(s,t.toString()),this.httpService.powerbiRequestOptions()).then((function(e){n.resolve(),a.resolve(e.data)}),(function(t){var o=e.errorDetailsHelper.getTelemetryErrorDetails(t.error);n.reject(o);var r=i.getErrorCode(t);a.reject({ErrorCode:r,RequestId:t.requestId})})),a.promise},t.prototype.getReportSubscription=function(t,o){var i=this,a=this.promiseFactory.defer(),n="metadata/emailsubscriptions/report/{0}",s=this.telemetryService.startChildEvent(o,e.telemetry.EmailSubscriptionsRequest,e.telemetry.EmailSubscriptionRequestType.Get);return this.httpService.get(r.format(n,t.toString()),this.httpService.powerbiRequestOptions()).then((function(e){s.resolve(),a.resolve(e.data)}),(function(t){var o=e.errorDetailsHelper.getTelemetryErrorDetails(t.error);s.reject(o);var r=i.getErrorCode(t);a.reject({ErrorCode:r,RequestId:t.requestId})})),a.promise},t.prototype.getDashboardSubscription=function(t,o){return __awaiter(this,void 0,e.Promise,(function(){var i,a,n,s,c,l,d;return __generator(this,(function(p){switch(p.label){case 0:i=this.promiseFactory.defer(),a="metadata/emailsubscriptions/dashboard/{0}",n=this.telemetryService.startChildEvent(o,e.telemetry.EmailSubscriptionsRequest,e.telemetry.EmailSubscriptionRequestType.Get),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.httpService.get(r.format(a,t.toString()),this.httpService.powerbiRequestOptions())];case 2:return s=p.sent(),n.resolve(),i.resolve(s.data),[3,4];case 3:return c=p.sent(),l=e.errorDetailsHelper.getTelemetryErrorDetails(c.error),n.reject(l),d=this.getErrorCode(c),i.reject({ErrorCode:d,RequestId:c.requestId}),[3,4];case 4:return[2,i.promise]}}))}))},t.prototype.getErrorCode=function(e){var t;return e&&(e.error?t=e.error.code:e.status&&(t=e.status.toString())),t},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(){return new a}var r,i=jsCommon.QueryStringUtil;!(function(e){e[e.Changed=0]="Changed",e[e.Unchanged=1]="Unchanged",e[e.Error=2]="Error"})(r=t.SetKeyResult||(t.SetKeyResult={})),t.createTutorialDataStoreService=o;var a=(function(){function t(t){this.promiseFactory=t||e.createJQueryPromiseFactory(),this.loadedDeferred=this.promiseFactory.defer()}return t.prototype.setJsonData=function(e){if(!i.getQueryStringValue(t.IgnoreQueryParam)){if(this.store={},!i.getQueryStringValue(t.ShowAllQueryParam))try{_.extend(this.store,JSON.parse(e))}catch(e){}this.loadedDeferred.resolve({})}},t.prototype.onReady=function(e){this.store?e():this.loadedDeferred.promise.then((function(){return e()}))},t.prototype.hasKey=function(e){return!!this.store&&(this.store.hasOwnProperty(e)&&this.store[e])},t.prototype.getKey=function(e){return this.store?this.store[e]:null},t.prototype.setKey=function(o,a,n){var s=this;if(!this.store)return this.promiseFactory.reject(r.Error);var c=this.store[o];if(this.store[o]=a,c===a)return this.promiseFactory.resolve(r.Unchanged);if(!i.getQueryStringValue(t.ShowAllQueryParam)){var l=e.common.httpService.powerbiRequestOptions(n.event,"SetGettingStartedStatus",{dismissGroupObjectId:!0}),d=JSON.stringify(JSON.stringify(this.store));return e.common.httpService.post(t.ServerURL,d,l).then((function(){return n.resolve(),s.promiseFactory.resolve(r.Changed)}),(function(){return n.reject(),s.store[o]=c,s.promiseFactory.reject(r.Error)}))}return this.promiseFactory.reject(r.Error)},t.ServerURL="powerbi/metadata/user/gettingStartedStatus",t.IgnoreQueryParam="ignoreGettingStartedPopups",t.ShowAllQueryParam="showGettingStartedPopups",t})();t.TutorialDataStoreService=a})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e){return new r(e)}t.createWorkbookHttpService=o;var r=(function(){function t(e){this.syncService=e}return t.prototype.getWorkbooks=function(t){var o=e.common.httpService.powerbiRequestOptions(t,"GetWorkbooks");return e.common.httpService.get("powerbi/metadata/workbooks",o)},t.prototype.getWorkbook=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"GetWorkbook");return e.common.httpService.get("powerbi/metadata/workbooks/"+t+"/?packageId="+o,i)},t.prototype.renameWorkbook=function(t,o,r){var i=e.common.httpService.powerbiRequestOptions(r,"RenameWorkbook");return e.common.httpService.post("powerbi/metadata/workbooks/"+t.id+"/name",JSON.stringify(o),i)},t.prototype.deleteWorkbook=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"DeleteWorkbook");return e.common.httpService.delete("powerbi/content/workbooks/"+t.id+"/?packageId="+t.packageId,r)},t.prototype.getWorkbookWopiData=function(t,o){var r=e.common.httpService.powerbiRequestOptions(o,"WopiWorkbook");return e.common.httpService.post("powerbi/metadata/workbooks/wopiaccessinfo",JSON.stringify(t),r)},t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,i,a,n,s){return new r(e,t,o,i,a,n,s)}t.createAppMetadataService=o;var r=(function(){function o(e,t,o,r,i,a,n){this.rootScope=e,this.promiseFactory=t,this.resourcePackagesService=o,this.resourcePackageGateService=r,this.visualPluginService=i,this.telemetryService=a,this.editableFeatureSwitchService=n,this.gettingAppMetadata=!1,this.getAppMetadataDeferred=this.promiseFactory.defer()}return o.prototype.getAppMetadata=function(){var e=this;if(!this.gettingAppMetadata)if(window.initialDashboardContainer)if(window.initialDashboardContainer===t.constants.initialDashboardContainerLoadingState){this.gettingAppMetadata=!0;var o=this.rootScope.$on(t.constants.initialDashboardContainerReadyEventName,(function(){e.editableFeatureSwitchService.registerFeatureSwitches(window.initialDashboardContainer.featureSwitches),e.importResourcePackages(window.initialDashboardContainer.resourcePackages).finally((function(){e.getAppMetadataDeferred.resolve(window.initialDashboardContainer),e.gettingAppMetadata=!1,o()}))}))}else window.initialDashboardContainer!==t.constants.initialDashboardContainerErrorState?(this.editableFeatureSwitchService.registerFeatureSwitches(window.initialDashboardContainer.featureSwitches),this.importResourcePackages(window.initialDashboardContainer.resourcePackages).finally((function(){e.getAppMetadataDeferred.resolve(window.initialDashboardContainer)}))):this.getAppMetadataDeferred.reject();else this.getAppMetadataDeferred.reject();return this.getAppMetadataDeferred.promise},o.prototype.getOrgAppsMetadata=function(){var e=this,t=this.getAppMetadataDeferred.promise;return t.then((function(){var o=window.initialGroupGUID;return _.isEmpty(o)?t:e.requestMyWorkspaceMetadata()})).catch((function(){return e.requestMyWorkspaceMetadata()}))},o.prototype.requestMyWorkspaceMetadata=function(){var t=this;if(null!=this.getMyWorkSpaceAppMetadataDeferred)return this.getMyWorkSpaceAppMetadataDeferred.promise;var o=this.telemetryService.startEvent(e.telemetry.AppServiceGetOrgAppsMetadata);this.getMyWorkSpaceAppMetadataDeferred=this.promiseFactory.defer();var r=e.common.httpService.powerbiRequestOptions(o.event,"AppServiceGetOrgAppsMetadata",{dismissGroupObjectId:!0});return e.common.httpService.get("powerbi/metadata/app",r).then((function(e){t.getMyWorkSpaceAppMetadataDeferred.resolve(e.data),o.resolve()}),(function(r){t.getMyWorkSpaceAppMetadataDeferred.reject(null),o.reject(e.errorDetailsHelper.getTelemetryErrorDetails(r.error,r.status))})),this.getMyWorkSpaceAppMetadataDeferred.promise},o.prototype.importResourcePackages=function(t){var o=this;if(this.importResourcePackagesDeferred)return this.importResourcePackagesDeferred.promise;this.importResourcePackagesDeferred=this.promiseFactory.defer();var r=window.initialDashboardContainer.activeDashboardId;if(_.isEmpty(t))this.importResourcePackagesDeferred.resolve(null),window.initialDashboardContainer&&r&&this.telemetryService.logEvent(e.telemetry.DashboardImportResourcePackagesOnLoad,r.toString(),0);else{var i;window.initialDashboardContainer&&r&&(i=this.telemetryService.startEvent(e.telemetry.DashboardImportResourcePackagesOnLoad,window.initialDashboardContainer.activeDashboardId.toString(),t.length));var a=_.map(t,(function(e){return e.id.toString()}));this.resourcePackageGateService.shouldShowWarning(a,r.toString())?(this.importResourcePackagesDeferred.resolve(null),i&&i.resolve()):(this.resourcePackagesService.registerPackages(t),this.visualPluginService.ensurePlugins(t,!1).catch((function(){i&&i.reject()})).finally((function(){i&&i.resolve(),o.importResourcePackagesDeferred.resolve(null)})))}return this.importResourcePackagesDeferred.promise},o})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(){return new i}var r=e.common.contracts.ContentProviderCategory;t.createAppCollectionService=o;var i=(function(){function e(){this.apps=[]}return e.prototype.findServiceContentProvider=function(e){return _.find(this.apps,(function(t){return t.providerId===e&&(t.category===r.ServiceApp||t.category===r.Services)}))},e.prototype.findOrganizationalContentProvider=function(e){return _.find(this.apps,(function(t){return t.providerId===e&&(t.category===r.Organizational||t.category===r.OrganizationalApp||t.category===r.OrganizationalTemplate||t.category===r.OrganizationalTemplateApp)}))},e.prototype.findContentProviderByKey=function(e){if(null!=e)return _.find(this.apps,(function(t){return t.providerKey===e}))},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,r,i,a,n,s,c,d,p,u,h,m){return new l(e,t,o,r,i,a,n,s,c,d,p,u,h,m)}function r(e){return new d(e)}var i=e.common.contracts.ContentProviderCategory,a=e.errorDetailsHelper,n=e.common.dialog.MessageDialogBuilder,s=e.common.NotifyCollection,c=t.contracts.PackageType;t.createAppService=o;var l=(function(){function t(e,t,o,r,a,c,l,d,p,u,h,m,f,v){this.appMetadataService=e,this.dashboardDataService=t,this.appCollectionService=o,this.modelService=r,this.reportService=a,this.workbookService=c,this.promiseFactory=l,this.dataServiceModelConverter=d,this.asyncFeatureSwitchService=p,this.telemetryService=u,this.modalDialogService=h,this.errorService=m,this.localizationService=f,this.contentProviderHttpService=v,this.orgAppCategories=[i.OrganizationalApp,i.OrganizationalTemplateApp],this.serviceAppCategories=[i.ServiceApp,i.Services],this.inFlightAppRequests=[{},{},{}],this.appInstanceRequests={},this.apps=[],this.instances=new s,this.messageDialogBuilder=new n(this.modalDialogService)}return Object.defineProperty(t.prototype,"apps",{get:function(){return this.appCollectionService.apps},set:function(e){this.appCollectionService.apps=e},enumerable:!0,configurable:!0}),t.prototype.ensureAppsInitialization=function(){return null!=this.appsInitializationDeferred?this.appsInitializationDeferred.promise:this.getOrgAppsMetadata().promise},t.prototype.getAppByCategory=function(e){return _.filter(this.apps,(function(t){return t.category===e}))},t.prototype.getAppByGUID=function(e){return _.find(this.apps,(function(t){return t.providerKey===e}))},t.prototype.updateAppsCollection=function(e,t){var o=this;this.apps=_.filter(e,(function(e){return o.isAppContentProvider(e)}))||[],this.instances.setItems([]);var r=_.filter(t,(function(e){return e.packageType===c.AppInstance}));if(!_.isEmpty(r))for(var i=0,a=r;i<a.length;i++){var n=a[i];this.onInstanceAdded(n)}},t.prototype.addApp=function(e){!this.isInstalledApp(e)&&this.isAppContentProvider(e)&&this.apps.push(e)},Object.defineProperty(t.prototype,"appInstances",{get:function(){return this.instances.items},enumerable:!0,configurable:!0}),t.prototype.onInstanceAdded=function(e){var t=this;if(e.packageType!==c.AppInstance)return this.promiseFactory.reject();var o=this.getAppInstance(e.id);if(null!=o)return this.promiseFactory.resolve(o);var r,i;e.contentProviderRefId?(i=e.contentProviderRefId,r=0):(i=e.serviceContentProviderId,r=1);var a=this.getInstalledAppDefinition(i,r);if(a){var n=this.dataServiceModelConverter.convertInstalledAppModel(a,e);return this.addInstance(n),this.promiseFactory.resolve(n)}var s=this.appInstanceRequests[e.id];return s?s.promise:(s=this.appInstanceRequests[e.id]=this.promiseFactory.defer(),this.getAppDefinitionByType(i,r).then((function(o){var r=t.getAppByGUID(o.providerKey);r||t.addApp(o);var i=t.dataServiceModelConverter.convertInstalledAppModel(r||o,e);t.addInstance(i),s.resolve(i)}),(function(e){s.reject()})).finally((function(){delete t.appInstanceRequests[e.id]})),s.promise)},t.prototype.onInstanceDeleted=function(e){var t=this.instances.deleteItems((function(t){return t.packageId===e}));if(!_.isEmpty(t)){var o=this.getAppInstancesForApp(t[0].objectId);_.isEmpty(o)&&_.pull(this.apps,t[0].providerContract)}},t.prototype.deleteInstance=function(e){var t=this,o=this.getAppInstanceInternal(e);if(null==o)return this.promiseFactory.reject();var r=this.promiseFactory.defer();return this.messageDialogBuilder.show("UninstallAppDialog",{titleText:this.localizationService.get("AppModel_UninstallAppTitle"),messageText:this.localizationService.get("AppModel_UninstallAppMessage"),okButtonText:this.localizationService.get("ModalDialogButtonText_Delete"),cancelButtonText:this.localizationService.get("ModalDialogButtonText_Cancel")}).then((function(e){0===e?t.deleteInstanceInternal(o,r):r.reject()})),r.promise},t.prototype.getAppInstance=function(e){return this.getAppInstanceInternal(e)},t.prototype.getAppArtifact=function(e,t){var o=e.packageId;if(t.dashboardOriginalGUID){var r=t.dashboardOriginalGUID;return _.find(this.dashboardDataService.dashboards,(function(e){return e.contract.originalDashboardObjectId===r&&e.contract.originalPackageId===o}))}if(t.reportOriginalGUID){var i=t.reportOriginalGUID;return _.find(this.reportService.reports,(function(e){return e.contract.originalReportObjectId===i&&e.packageId===o}))}if(t.workbookID){var a=t.workbookID;return _.find(this.workbookService.workbooks,(function(e){return e.uniqueId===a&&e.packageId===o}))}},t.prototype.subscribeToInstanceEvents=function(e){this.appInstancesCollectionChangedHandlers||(this.appInstancesCollectionChangedHandlers=[],this.setupAppInstanceListener()),this.appInstancesCollectionChangedHandlers.push(e)},t.prototype.unsubscribeToInstanceEvents=function(e){this.appInstancesCollectionChangedHandlers&&(_.pull(this.appInstancesCollectionChangedHandlers,e),_.isEmpty(this.appInstancesCollectionChangedHandlers)&&(this.appInstancesCollectionChangedHandlers=null,this.instances.unsubscribe(this.appInstanceListener)))},t.prototype.getAppInstancesForApp=function(e){return _.filter(this.appInstances,(function(t){return t.providerContract.providerKey===e}))},t.prototype.getAppInstanceInternal=function(e){return _.find(this.instances.items,(function(t){return t.packageId===e}))},t.prototype.setupAppInstanceListener=function(){var e=this;this.appInstanceListener||(this.appInstanceListener={onAdded:function(t){return e.notifyListeners((function(e){return e.onInstanceInstalled&&e.onInstanceInstalled(t)}))},onDeleted:function(t){return e.notifyListeners((function(e){return e.onInstanceUninstalled&&e.onInstanceUninstalled(t)}))},onReset:function(){return e.notifyListeners((function(e){return e.onInstancesReset&&e.onInstancesReset()}))}}),this.instances.subscribe(this.appInstanceListener)},t.prototype.getOrgAppsMetadata=function(){var e=this;if(null==this.appsInitializationDeferred){this.appsInitializationDeferred=this.promiseFactory.defer();var t=this.appMetadataService.getOrgAppsMetadata?this.appMetadataService.getOrgAppsMetadata():this.appMetadataService.getAppMetadata();this.promiseFactory.all([t,this.asyncFeatureSwitchService.getFeatureSwitches(),this.dashboardDataService.getDashboards(),this.reportService.ensureReportsInitialization(),this.workbookService.ensureWorkbookInitialization(),this.modelService.modelsPromise]).then((function(t){e.initializeAppCategories(e.asyncFeatureSwitchService);var o=t[0];o&&(o.apps||o.packages)&&e.updateAppsCollection(o.apps,o.packages),e.appsInitializationDeferred.resolve(e)}),(function(){e.appsInitializationDeferred.reject()}))}return this.appsInitializationDeferred},t.prototype.notifyListeners=function(e){var t=this.appInstancesCollectionChangedHandlers;if(!_.isEmpty(t)&&e)for(var o=t.length-1;o>=0;o--)e(t[o])},t.prototype.deleteInstanceInternal=function(t,o){var r=this,n=t.providerContract.providerKey,s=t.packageId;this.onInstanceDeleted(s);var c=this.telemetryService.startEvent(e.telemetry.AppsUninstallApp,n,i[t.category]),l=e.common.httpService.powerbiRequestOptions(c.event,"UninstallApp");l.enableTelemetry=!0,e.common.httpService.delete("/powerbi/content/providers/organization/"+n+"/?packageid="+s+"&uninstall=true",l).then((function(e){c.resolve(),o.resolve(null)}),(function(e){r.addApp(t.providerContract),r.addInstance(t),c.reject(a.getTelemetryErrorDetails(e.error,e.status)),r.errorService.error(r.localizationService.get("AppModel_FailToUninstallAppMessage"),"AppModel_FailToUninstallApp",{requestId:e.requestId,statusCode:e.status.toString()}),o.reject()}))},t.prototype.getInstalledAppDefinition=function(e,t){var o=0===t?this.orgAppCategories:this.serviceAppCategories;return _.find(this.apps,(function(t){return t.providerId===e&&_.contains(o,t.category)}))},t.prototype.getAppDefinitionByType=function(t,o){var r=this,i=this.inFlightAppRequests[o][t];if(i)return i.promise;i=this.inFlightAppRequests[o][t]=this.promiseFactory.defer();var n=this.telemetryService.startEvent(e.telemetry.AppsGetApp),s=1===o?this.contentProviderHttpService.getServiceContentProviderById(n.event,t):this.contentProviderHttpService.getOrganizationalContentProviderById(n.event,t);return s.then((function(e){var t=e&&e.data;t&&r.isAppContentProvider(t)?i.resolve(t):i.reject(),n.resolve()}),(function(e){n.reject(a.getTelemetryErrorDetails(e.error,e.status)),i.reject()})).finally((function(){delete r.inFlightAppRequests[o][t]})),i.promise},t.prototype.isInstalledApp=function(e){return!!this.getAppByGUID(e.providerKey)},t.prototype.isAppCategory=function(e){return _.contains(this.validAppCategories,e)},t.prototype.isAppContentProvider=function(e){return!!e&&this.isAppCategory(e.category)},t.prototype.initializeAppCategories=function(e){this.validAppCategories=[],e.featureSwitches.appsEnabled&&this.validAppCategories.push(i.OrganizationalApp),e.featureSwitches.appTemplatesEnabled&&this.validAppCategories.push(i.OrganizationalTemplateApp),e.featureSwitches.serviceAppsEnabled&&(this.validAppCategories.push(i.ServiceApp),this.validAppCategories.push(i.Services))},t.prototype.addInstance=function(e){var t=this.getAppInstance(e.packageId);null==t&&this.instances.addItem(e)},t})();t.createMockAppService=r;var d=(function(){function e(e){this.promiseFactory=e}return Object.defineProperty(e.prototype,"apps",{get:function(){return[]},set:function(e){},enumerable:!0,configurable:!0}),e.prototype.ensureAppsInitialization=function(){return this.promiseFactory.reject()},e.prototype.getAppByCategory=function(e){return[]},e.prototype.getAppByGUID=function(e){return null},e.prototype.updateAppsCollection=function(e){},e.prototype.addApp=function(e){},e.prototype.isAppCategory=function(e){return!1},e.prototype.onInstanceAdded=function(e){return this.promiseFactory.reject()},e.prototype.onInstanceDeleted=function(e){},e.prototype.deleteInstance=function(e){return this.promiseFactory.reject()},e.prototype.getAppInstance=function(e){return null},e.prototype.getAppArtifact=function(e,t){return null},e.prototype.subscribeToInstanceEvents=function(e){},e.prototype.unsubscribeToInstanceEvents=function(e){},e.prototype.getAppInstancesForApp=function(e){},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(){return new i}var r=e.common.NotifyCollection;t.createDashboardCollectionService=o;var i=(function(){function e(){this.listeners=[],this.collection=new r}return Object.defineProperty(e.prototype,"dashboards",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e)},enumerable:!0,configurable:!0}),e.prototype.getDashboardContracts=function(){return _.map(this.dashboards,(function(e){return e.contract}))},e.prototype.findDashboardContract=function(e){var t=this.getDashboardContracts();return _.find(t,(function(t){return t.id===e}))},e.prototype.onAdded=function(e){for(var t=this.listeners,o=0,r=t;o<r.length;o++){var i=r[o];i.onDashboardAdded&&i.onDashboardAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,o=0,r=t;o<r.length;o++){var i=r[o];i.onDashboardDeleted&&i.onDashboardDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,o=e;t<o.length;t++){var r=o[t];r.onDashboardsReset&&r.onDashboardsReset()}},e.prototype.addDashboard=function(e){this.collection.addItem(e)},e.prototype.removeDashboard=function(e){this.collection.deleteItems((function(t){return t.id===e}))},e.prototype.subscribe=function(e){this.listeners.length<1&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),this.listeners.length<1&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}));
})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,r,i,n,s){return new a(e,t,o,r,i,n,s)}var r=e.common.contracts.PermissionArtifactType;t.createDashboardDataService=o;var i=3e3,a=(function(){function e(e,t,o,r,i,a,n){this.refreshStateListeners=[],this.InEditMobileLayoutMode=!1,this.dashboardCollectionService=a,this.isDashboardLoaded=!1,this.dashboardHttpService=e,this.promiseFactory=t,this.featureSwitchService=o,this.modelMerger=r,this.modelService=i,this.dashboardsDeferred=t.defer(),this.isQnaEnabled=!1,this.modelService.addModelUpdateListener(this),this.timeout=n,this.refreshState=0}return e.prototype.registerRefreshStateListener=function(e){_.contains(this.refreshStateListeners,e)||this.refreshStateListeners.push(e)},e.prototype.unregisterRefreshStateListener=function(e){_.remove(this.refreshStateListeners,e)},e.prototype.onDashboardTileRefreshStarted=function(e){this.activeDashboardId===e&&0===this.refreshState&&this.notify(1,e)},e.prototype.onDashboardTileRefreshFinished=function(e){var t=this;this.activeDashboardId===e&&1===this.refreshState&&(this.notify(2,e),this.timeout((function(){return t.notify(0,e)}),i))},e.prototype.notify=function(e,t){this.refreshState=e;for(var o=0,r=this.refreshStateListeners;o<r.length;o++){var i=r[o];i.onStateChange(this.refreshState,t)}},Object.defineProperty(e.prototype,"dashboards",{get:function(){return this.dashboardCollectionService.dashboards},set:function(e){this.dashboardCollectionService.dashboards=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleDashboards",{get:function(){return _.filter(this.dashboardCollectionService.dashboards,(function(e){return!e.isHidden}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editableAndReshareableDashboards",{get:function(){var e=this.dashboards;return _.filter(e,(function(e){return!e.contract.isHidden&&t.PermissionsUtils.canReshare(e.getPermissions(),r.Dashboard)}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeDashboard",{get:function(){return this.activeDashboardId===-1?null:this.findDashboard(this.activeDashboardId)},set:function(e){e?this.activeDashboardId=e.id:this.activeDashboardId=-1,this.refreshState=0,this.updateActiveDashboardModels()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeDashboardContainsQnaSupportedModel",{get:function(){return t.DashboardUtils.containsQnaSupportedModel(this.activeDashboardModels,this.modelService,this.featureSwitchService)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeDashboardIndex",{get:function(){return this.dashboards.indexOf(this.activeDashboard)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.activeDashboard?this.activeDashboard.displayName:""},enumerable:!0,configurable:!0}),e.prototype.addDashboard=function(e){if(e){var t=this.getDashboardIndex(e.id);t<0&&this.dashboardCollectionService.addDashboard(e)}},e.prototype.addOrReplaceDashboard=function(e){var t=this.getDashboardIndex(e.id);t<0?this.dashboardCollectionService.addDashboard(e):this.dashboards.splice(t,1,e)},e.prototype.deleteDashboardAtServerSide=function(e,t){var o=this.promiseFactory.defer(),r=this.dashboards.filter((function(t){return t.id===e}))[0];return r?this.dashboardHttpService.deleteDashboard(r.contract,t.event).then((function(){t.resolve(),o.resolve(null)}),(function(e){t.reject(),o.reject(e)})):o.reject(),o.promise},e.prototype.deleteDashboard=function(e){this.removeDashboard(e)},e.prototype.deleteTile=function(e,t){var o=this,r=this.promiseFactory.defer(),i=this.findDashboard(e);return i?this.tryUpdateTile(i,t,(function(e,t){if(e>=0&&t>=0){var a=i.contract.tiles[e];i.contract.tiles.splice(e,1),i.tiles.splice(t,1),i.hasModel(a.modelId)||o.dashboardHttpService.addDashboardRequestToBatch(o.promiseFactory,i.id).done((function(e){o.modelMerger.mergeDashboardShallow(i,e.dashboards[0]),o.updateActiveDashboardModels(),r.resolve(null)})).fail((function(){r.reject()}))}else r.resolve(null)})):r.resolve(null),r.promise},e.prototype.dropDashboardfromMemoryIfNotActive=function(e){var t=this.activeDashboard;if(!t||t.id!==e){var o=this.findDashboard(e);return o&&(o.contract.tiles=null,o.isLoaded=!1),!0}return!1},e.prototype.findDashboard=function(e){return _.find(this.dashboards,(function(t){return t.id===e}))},e.prototype.findDashboardByGUID=function(e){for(var t=0,o=this.dashboards;t<o.length;t++){var r=o[t];if(r.objectId===e)return r}},e.prototype.findDashboardsByPackageId=function(e){var t=this.dashboards;if(t)return _.filter(t,(function(t){return!(!t.contract||!t.contract.originalPackageId)&&t.contract.originalPackageId===e}))},e.prototype.retrieveDashboardForApp=function(e,t){return _.find(this.dashboards,(function(o){return o.getUniquePackageId()===e&&o.contract.originalDashboardObjectId===t}))},e.prototype.getDashboardIndex=function(e){for(var t=this.dashboards,o=0,r=t.length;o<r;o++)if(t[o].id===e)return o;return-1},e.prototype.registerDashboards=function(e){this.dashboards=e,this.isDashboardLoaded=!0},e.prototype.tryUpdateTile=function(e,t,o){if(e){var r=e.getTileContractIndex(t),i=e.getTileIndex(t);o(r,i),e.scheduleDelayedLayout(this.activeDashboard!==e)}},e.prototype.updateActiveDashboardModels=function(){this.activeDashboardModels=t.DashboardUtils.getDashboardModels(this.activeDashboard,this.modelService.getModelContracts()),this.updateIsQnaEnabled()},e.prototype.isActiveDashboardModelRefreshDisabled=function(){var e=this.activeDashboardModels;if(_.isEmpty(e))return!1;for(var t=this.modelService,o=0,r=e;o<r.length;o++){var i=r[o],a=t.findModel(i.id,i.packageId);if(a&&a.isRefreshDisabledDueToInactivity())return!0}return!1},e.prototype.updateIsQnaEnabled=function(){this.activeDashboard?"undefined"!=typeof this.activeDashboard.qnaEnabled?this.isQnaEnabled=this.activeDashboard.qnaEnabled:this.isQnaEnabled=this.activeDashboardContainsQnaSupportedModel:this.isQnaEnabled=!1},e.prototype.onModelUpdated=function(e,t){var o=this.modelService.findModel(e,t);o&&this.updateActiveDashboardModels()},e.prototype.getDashboards=function(){var e=this;return this.dashboardsDeferred.promise.then((function(){return e.dashboards}))},e.prototype.resolveDashboardDeferred=function(){this.dashboardsDeferred.resolve(this)},e.prototype.rejectDashboardDeferred=function(){this.dashboardsDeferred.reject()},e.prototype.removeDashboard=function(e){this.dashboardCollectionService.removeDashboard(e)},e.prototype.setQnaEnabled=function(e,t){var o=this.findDashboard(e);o&&(o.qnaEnabled=t,this.updateIsQnaEnabled())},e.prototype.subscribe=function(e){this.dashboardCollectionService.subscribe(e)},e.prototype.unsubscribe=function(e){this.dashboardCollectionService.unsubscribe(e)},e})();t.DashboardDataService=a})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,i,a,n,s,c,l,d,p,u,h,m,f,v){return new r(e,t,o,i,a,n,s,c,l,d,p,u,h,m,f,v)}t.createDashboarSyncService=o;var r=(function(){function o(e,t,o,r,i,a,n,s,c,l,d,p,u,h,m,f){var v=this;this.rootScope=e,this.dashboardDataService=t,this.dashboardHttpService=o,this.modelConverter=r,this.modelMerger=i,this.modelService=a,this.promiseFactory=n,this.reportService=s,this.resourcePackageGateService=c,this.resourcePackageListenerService=l,this.resourcePackagesService=d,this.telemetryService=u,this.tutorialDataStore=h,this.userInfo=m,this.workbookService=f;var g={onTilesAddedOrUpdated:function(e,t){return v.onTilesAddedOrUpdated(e,t)},onTileDeleted:function(e,t){v.dashboardDataService.dropDashboardfromMemoryIfNotActive(e)||v.dashboardDataService.deleteTile(e,t)},onDashboardAdded:function(e){return v.addOrDeepEditDashboard(e)},onDashboardDeleted:function(e){return v.onDashboardDeleted(e)},onDashboardShallowEdit:function(e){return v.onDashboardShallowEdit(e)},onDashboardDeepEdit:function(e){v.dashboardDataService.dropDashboardfromMemoryIfNotActive(e)||v.addOrDeepEditDashboard(e)},onDashboardTileDataChange:function(e){v.onTilesAddedOrUpdated(e,[]),v.dashboardDataService.onDashboardTileRefreshFinished(e)},onClearBatchedDashboardRequests:function(){return v.dashboardHttpService.batchedDashboardRequests=[]}};p.addDashboardRefreshListener(g)}return o.prototype.onTilesAddedOrUpdated=function(e,t){var o=this;if(!this.dashboardDataService.dropDashboardfromMemoryIfNotActive(e)){if(this.dashboardDataService.selectedDashboardTile){0===t.length&&(t=this.dashboardDataService.activeDashboard.tiles.map((function(e){return e.id})));var r=t.indexOf(this.dashboardDataService.selectedDashboardTile.tileModel.id);if(r>=0&&(t.splice(r,1),0===t.length))return}this.dashboardHttpService.batchGetTiles(e,t,void 0).then((function(t){var r=t.data;if(!_.isEmpty(r))for(var i=0,a=r.length;i<a;++i){var n=r[i];o.registerAndUpdateTile(e,n)}}))}},o.prototype.addOrDeepEditDashboard=function(o){var r=this,i=this.telemetryService.startEvent(e.telemetry.DashboardAddUpdateDashboard),a=this.promiseFactory.defer();return this.dashboardHttpService.addDashboardRequestToBatch(this.promiseFactory,o).done((function(e){r.addOrUpdateDashboard(e),r.rootScope.$emit(t.constants.updateDashboardContainerEventName,[e]),r.dashboardDataService.onDashboardTileRefreshFinished(o),i.resolve(),a.resolve(null)})).fail((function(){i.reject(),a.reject(null)})),a.promise},o.prototype.addOrUpdateCustomVisualTile=function(e,o,r,i){var a=this;this.isResourcePackageInCache(e)?this.addOrUpdateTile(o,r,this.modelService.getModelContracts()):this.resourcePackageListenerService.getAndLoadVisualPlugin(e).then((function(){a.addOrUpdateTile(o,r,a.modelService.getModelContracts()),i&&(a.resourcePackageGateService.resetResourceFlag(),a.rootScope.$emit(t.constants.shouldShowEnableCustomVisualsDialog))}))},o.prototype.addOrUpdateDashboard=function(e){var o=e.dashboards[0],r=this.modelConverter.convertDashboard(o,e.models,e.reports),i=this.dashboardDataService.getDashboardIndex(o.id),a=!1;if(this.modelConverter.fillDashboardChildren(r,e.models,e.reports,this.workbookService.getWorkbookContracts()),i>=0){var n=this.dashboardDataService.dashboards[i];this.modelMerger.mergeDashboard(n,o,e.models,e.reports);for(var s=n.tiles.length,c=0;c<s;c++){var l=n.tiles[c];l.invalidateLayout()}}else this.dashboardDataService.addDashboard(r),r.isNew=!0,r.isNotified=!1,r.isLoaded=!0,a=!0,o.ownerInfo&&this.userInfo.addOrUpdateDashboardOwnerInfoCache(o.ownerInfo);this.rootScope.$emit(t.constants.addOrUpdateDashboardEventName,e,a),this.dashboardDataService.onDashboardTileRefreshFinished(r.id)},o.prototype.addOrUpdateTile=function(e,t,o){var r=this;e&&(o=o||[],this.updateModelsIfRequired(e,t),this.dashboardDataService.tryUpdateTile(e,t.id,(function(i,a){var n=r.reportService.findReport(t.reportId),s=null;i>=0?(e.contract.tiles[i]=t,a>=0&&(s=e.tiles[a],r.modelMerger.mergeTile(s,t,o,null,r.workbookService.getWorkbookContracts(),r.reportService.reports))):(!n&&t.reportId&&(n=r.modelConverter.convertReport({id:t.reportId}),r.reportService.addReport(n)),s=r.modelConverter.convertTile(t,o,null,r.workbookService.getWorkbookContracts()),e.contract.tiles.push(t),e.tiles.push(s)),s&&(s.invalidateLayout(),n&&(s.report=n))})))},o.prototype.clearSeenDashboards=function(){var o=this.telemetryService.startEvent(e.telemetry.DashboardSharingNewUnseenDashboards,0,0,0);this.tutorialDataStore.setKey(t.constants.seenDashboardsStorageKey,{},o)},o.prototype.registerAndUpdateTile=function(e,t){var o=this.dashboardDataService.findDashboard(e),r=$.map(t.resourcePackageIds,(function(e){return e.toString()})),i=this.resourcePackageGateService.shouldShowWarning(r,this.dashboardDataService.activeDashboard.objectId);if(t.resourcePackageIds&&t.resourcePackageIds.length>0)for(var a=t.resourcePackageIds.length,n=0;n<a;++n)this.addOrUpdateCustomVisualTile(t.resourcePackageIds[n],o,t,i);else this.addOrUpdateTile(o,t,this.modelService.getModelContracts())},o.prototype.onDashboardDeleted=function(e){this.beforeDashboardDeleting&&this.beforeDashboardDeleting(e),this.dashboardDataService.deleteDashboard(e),this.afterDashboardDeleting&&this.afterDashboardDeleting(e)},o.prototype.onDashboardShallowEdit=function(o){var r=this,i=this.dashboardDataService.findDashboard(o);i&&this.dashboardHttpService.addDashboardRequestToBatch(this.promiseFactory,o,e.common.DashboardRequestType.Metadata).done((function(e){var o=e.dashboards[0],a=o.isHidden&&!i.isHidden;r.modelMerger.mergeDashboardShallow(i,o),a&&r.dashboardDataService.deleteDashboard(i.id),r.rootScope.$emit(t.constants.onDashboardShallowEditEventName,i,o)}))},o.prototype.updateModelsIfRequired=function(e,o){var r=this,i=e.getTileContractIndex(o.id),a=i!==-1&&2===o.publishState&&1===e.contract.tiles[i].publishState;!a&&e.hasModel(o.modelId)||this.dashboardHttpService.addDashboardRequestToBatch(this.promiseFactory,e.id).done((function(o){a&&(r.modelMerger.mergeDashboardTiles(e,o),r.rootScope.$emit(t.constants.mergeDashboardContainerModelsReportsAndPackagesEventName,o),r.modelMerger.mergeModelContentProviderId(o.models,o.packages)),r.modelMerger.mergeDashboardShallow(e,o.dashboards[0]),r.dashboardDataService.updateActiveDashboardModels()}))},o.prototype.isResourcePackageInCache=function(e){var t=this.resourcePackagesService.getAllPackages();return _.some(t,(function(t){return t.id===e}))},o})();t.DashboardSyncService=r})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,i,a,n){return new r(e,t,o,i,a,n)}t.createHostAppMetadataService=o;var r=(function(){function t(e,t,o,r,i,a){this.promiseFactory=e,this.telemetryService=t,this.eventFactory=o,this.editableFeatureSwitchService=r,this.errorCallback=i,this.getAppMetadataDeferred=this.promiseFactory.defer(),this.requestAppMetadata(r,a)}return t.prototype.getAppMetadata=function(){return this.getAppMetadataDeferred.promise},t.prototype.requestAppMetadata=function(o,r){var i=this,a=this.telemetryService.startEvent(this.eventFactory),n=e.common.httpService.powerbiRequestOptions(a.event,"DashboardHostGetAppMetadata",{isAdminRequest:r});e.common.httpService.get("powerbi/metadata/app",n).then((function(e){var t=e.data;window.initialDashboardContainer=t,i.editableFeatureSwitchService.registerFeatureSwitches(t.featureSwitches),i.getAppMetadataDeferred.resolve(t),a.resolve()}),(function(o){i.getAppMetadataDeferred.reject(null),a.reject(e.errorDetailsHelper.getTelemetryErrorDetails(o.error,o.status)),i.errorCallback&&i.errorCallback(t.pageRefreshErrorMessage)}))},t.pageRefreshErrorMessage="GetAppMetadataRequestFailed",t})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,r,i){return new c(e,t,o,r,i)}var r={title:"PinTile_Success",message:"PinTile_EditMobileAuthoringMessage",actionButtons:[{displayText:"EditMobileAuthoring_Button",action:void 0}]},i={title:"PinTile_Success",message:"PinTile_CreateMobileAuthoringMessage",actionButtons:[{displayText:"ToastNotification_GoToDashboard",action:void 0}]},a={title:"AddedTileMobileAuthoringTitle",message:"AddedTileEditMobileAuthoringMessage",actionButtons:[{displayText:"EditMobileAuthoring_Button",action:void 0}]},n={title:"AddedTileMobileAuthoringTitle",message:"AddedTileCreateMobileAuthoringMessage",actionButtons:[{displayText:"CreateMobileAuthoring_Button",action:void 0}]},s={title:"RemovedTileMobileAuthoringTitle",message:"RemovedTileMobileAuthoringMessage",actionButtons:[{displayText:"DeleteMobileAuthoring_Button",action:void 0}]};t.createMobileAuthoringService=o;var c=(function(){function t(e,t,o,r,i){this.gridLayout=e,this.localizationService=t,this.navigationService=o,this.notificationToastService=r,this.telemetryService=i,this.unpinTileFromMobileListeners=[]}return t.prototype.onUnpinTileFromMobileSimulator=function(){for(var e=0,t=this.unpinTileFromMobileListeners;e<t.length;e++){var o=t[e];o.onTileUnpined()}},t.prototype.registerUnpinTileFromMobileListener=function(e){_.contains(this.unpinTileFromMobileListeners,e)||this.unpinTileFromMobileListeners.push(e)},t.prototype.unregisterUnpinTileFromMobileListener=function(e){_.remove(this.unpinTileFromMobileListeners,e)},t.prototype.showMobileIndicationMessage=function(t,o,r,i,a,n){var s,c=this,l=this.getOperationType(o),d=a?function(){c.telemetryService.logEvent(e.telemetry.MobileAuthoringDashboardOpenedFromFlyout,l,!1),c.navigationService.navigateToDashboardByGUID(t)}:function(){i?n():(c.telemetryService.logEvent(e.telemetry.MobileAuthoringDashboardOpenedFromFlyout,l,!0),c.navigationService.navigateToDashboardMobileAuthoringByGUID(t))};a&&(s={displayText:this.localizationService.get("CreateMobileAuthoring_Button"),action:n});var p=this.getIndicationMessage(o);return this.notificationToastService.notify({title:this.localizationService.get(p.title),message:this.localizationService.get(p.message),actionButtons:[{displayText:this.localizationService.get(p.actionButtons[0].displayText),action:d}],actionLinks:[s],notificationType:r})},t.prototype.switchLayoutStrategy=function(e,t,o){e.gridLayoutService||(e.gridLayoutService=this.gridLayout),e.gridLayoutService.strategy=t,e.gridLayoutService.displayLayout=o,this.updateDashboardTilesWithDisplayLayout(e,o)},t.prototype.updateDashboardTilesWithDisplayLayout=function(e,t){if(e&&e.tiles)for(var o=0,r=e.tiles;o<r.length;o++){var i=r[o];i.gridLayoutContext&&(i.gridLayoutContext.setActiveLayout(t),i.invalidateLayout())}},t.prototype.getIndicationMessage=function(e){switch(e){case 0:return n;case 1:return a;case 2:return i;case 3:return r;case 4:return s}},t.prototype.getOperationType=function(t){switch(t){case 0:case 1:return e.telemetry.FlyoutOperationType.Add;case 2:case 3:return e.telemetry.FlyoutOperationType.Pin;case 4:return e.telemetry.FlyoutOperationType.Remove}},t})();t.MobileAuthoringService=c})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(){return new o}e.createPackageCollectionService=t;var o=(function(){function e(){this.resetPackages()}return Object.defineProperty(e.prototype,"packages",{get:function(){return this._packages},enumerable:!0,configurable:!0}),e.prototype.findPackage=function(e){return this.idToPackageMap[e]},e.prototype.findPackageContract=function(e){var t=this.findPackage(e);return t?t.contract:void 0},e.prototype.addPackage=function(e){this.idToPackageMap[e.id]||(this.idToPackageMap[e.id]=e,this._packages.push(e))},e.prototype.removePackage=function(e){_.remove(this._packages,(function(t){return t.id===e.id}));delete this.idToPackageMap[e.id]},e.prototype.resetPackages=function(){this._packages=[],this.idToPackageMap={}},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,r,i,a,n,s,l,d,p,u,h,m,f){return new c(e,t,o,r,i,a,n,s,l,d,p,u,h,f)}var r=t.models.ContentPackItems,i=e.common.contracts.ContentProviderCategory,a=t.contracts.PackageType,n=e.common.contracts.PublishOrRefreshStatus,s=e.common.contracts.StorageProviderType;t.createPackageService=o;var c=(function(){function o(e,t,o,r,i,a,n,s,c,l,d,p,u,h){this.rootScope=e,this.telemetryService=t,this.errorService=o,this.modelMerger=r,this.modelConverter=i,this.reportService=a,this.modelService=n,this.syncService=s,this.localizationService=c,this.appMetadataService=l,this.workbookService=d,this.appService=p,this.packageCollectionService=u,this.promiseFactory=h,this.initPackages(),this.syncService.addPackageRefreshListener(this)}return o.prototype.ensurePackagesInitialization=function(){return this.packagesInitializationDeferred.promise},Object.defineProperty(o.prototype,"packages",{get:function(){return this.packageCollectionService.packages},enumerable:!0,configurable:!0}),o.prototype.findPackage=function(e){return this.packageCollectionService.findPackage(e)},o.prototype.getWorkbookStorageProvider=function(e){var t=this.findPackage(e);return t&&t.contract?t.contract.storageProviderType:null},o.prototype.getWorkbookContentProvider=function(e){var t=this.findPackage(e);return t?t.contentProviderId:null},o.prototype.getInstalledOrgPackage=function(e){return _.find(this.packages,(function(t){return t.contract&&t.contract.contentProviderRefId&&t.contract.contentProviderRefId===e&&t.packageType===a.AppInstance}))},o.prototype.isLocalWorkbook=function(e){var t=this.findPackage(e);return t&&t.contract&&t.contract.storageProviderType===s.Local},o.prototype.getPackagesByProviderId=function(e,t){switch(t){case i.BuiltIn:return _.filter(this.packages,(function(t){return t.contract.contentProviderId===e}));case i.Organizational:case i.OrganizationalApp:case i.OrganizationalTemplate:case i.OrganizationalTemplateApp:return _.filter(this.packages,(function(t){return t.contract.contentProviderRefId===e}));case i.ServiceApp:case i.Services:return _.filter(this.packages,(function(t){return t.contract.serviceContentProviderId===e}))}},o.prototype.getPackagesByProviderIdAndPackageType=function(e,t,o){switch(t){case i.BuiltIn:return _.filter(this.packages,(function(t){return t.contract.contentProviderId===e&&t.packageType===o}));case i.Organizational:case i.OrganizationalApp:case i.OrganizationalTemplate:case i.OrganizationalTemplateApp:return _.filter(this.packages,(function(t){return t.contract.contentProviderRefId===e&&t.packageType===o}));case i.ServiceApp:case i.Services:return _.filter(this.packages,(function(t){return t.contract.serviceContentProviderId===e&&t.packageType===o}))}},o.prototype.getAllAppPackagesByType=function(e){return _.filter(this.packages,(function(t){return t.packageType===e}))},o.prototype.isRefreshNowEnabledForWorkbook=function(e){if(!e)return!1;if(!e.isOwner())return!1;var t=this.findPackage(e.packageId);return!(!t||!t.contract)},o.prototype.isScheduleRefreshEnabledForWorkbook=function(e){return!(!e||!e.contract)&&(!!this.isRefreshNowEnabledForWorkbook(e)&&(void 0!==e.modelId&&!!e.contract.isPowerPivotVersionSupportsRefresh))},o.prototype.initPackages=function(){var e=this;this.packagesInitializationDeferred=this.promiseFactory.defer(),this.appMetadataService.getAppMetadata().then((function(t){e.loadPackages(t),e.packagesInitializationDeferred.resolve(e)}),(function(){return e.packagesInitializationDeferred.reject()}))},o.prototype.loadPackages=function(e){e&&e.packages&&this.updatePackageCollection(e.packages)},o.prototype.updatePackageCollection=function(e){if(this.packageCollectionService.resetPackages(),!_.isEmpty(e))for(var t=0,o=e;t<o.length;t++){var r=o[t];this.packageCollectionService.addPackage(this.modelConverter.convertPackage(r))}},o.prototype.mergePackageCollection=function(e){if(!_.isEmpty(e))for(var t=0,o=e;t<o.length;t++){var r=o[t];this.packageCollectionService.addPackage(this.modelConverter.convertPackage(r))}},o.prototype.deletePackage=function(e){var t=this.findPackage(e);t&&(t.contract.reports&&this.reportService.deleteReportForPackage(e),t.packageType===a.AppInstance&&this.appService.onInstanceDeleted(t.id),this.modelService.deleteModelForPackage(e),this.workbookService.deleteWorkbookForPackage(e),this.packageCollectionService.removePackage(t))},o.prototype.updatePackage=function(e){if(e&&e.id){var o=this.findPackage(e.id);o?this.modelMerger.mergePackage(o,e):(o=this.modelConverter.convertPackage(e),this.packageCollectionService.addPackage(o),e.packageType===a.AppInstance&&this.appService.onInstanceAdded(e)),o.hasUpdate()&&this.rootScope.$emit(t.constants.packageVersionChange,e.id)}},o.prototype.onPackagePublishRefreshCompleted=function(o){var r=this,i=this.telemetryService.startEvent(e.telemetry.DashboardGetNavigationPanePackage);t.packageHttpService.getPackage(o,i.event).then((function(t){var a=t.data;if(r.updatePackage(a),a.models)for(var s=0,c=a.models.length;s<c;s++){var l=a.models[s],d=r.modelService.findModel(l.id,o);d?r.updateExistingModel(d,l,a.publishOrRefreshStatus):r.modelService.onModelAdded(l.id,o)}if(a.reports)for(var s=0,p=a.reports.length;s<p;s++){var u=a.reports[s],h=r.reportService.updateReport(u);h?h.packagePublishStatus=a.publishOrRefreshStatus:r.reportService.addContractReport(u)}if(a.workbooks)for(var s=0,m=a.workbooks.length;s<m;s++){var f=a.workbooks[s],v=r.workbookService.updateWorkbook(f);v||r.workbookService.onWorkbookAdded(f.id,o)}a.publishOrRefreshStatus===n.FinishedSuccessfully&&r.rootScope.$emit(e.dataServices.constants.packagePublishedSuccessfullyEventName,a.id),i.resolve()}),(function(){i.reject()}))},o.prototype.onPackagePublishEdit=function(o){var i=this,a=this.telemetryService,s=a.startEvent(e.telemetry.DashboardGetNavigationPanePackage);t.packageHttpService.getPackage(o,s.event).then((function(a){var c=a.data,l=!1,d=0;if(c.models)for(var p=0,u=c.models.length;p<u;p++){var h=c.models[p],m=i.modelService.findModel(h.id,o);m&&i.updateExistingModel(m,h,c.publishOrRefreshStatus)}if(c.reports)for(var p=0,f=c.reports.length;p<f;p++){var v=c.reports[p],g=i.reportService.findReport(v.id);g&&g.packageVersion!==v.packageVersion&&g.isUsedByContentPack&&(l=!0,d=v.id);var y=i.reportService.updateReport(v);y&&(y.modelId=v.modelId,y.model=i.modelService.findModel(v.modelId,o),y.packagePublishStatus=c.publishOrRefreshStatus)}if(c.workbooks)for(var p=0,b=c.workbooks.length;p<b;p++){var S=c.workbooks[p];i.workbookService.updateWorkbook(S)}var k=i.findPackage(c.id),T=k?k.publishOrRefreshStatus:null;i.updatePackage(c),T!==n.FinishedSuccessfully&&c.publishOrRefreshStatus===n.FinishedSuccessfully&&i.rootScope.$emit(e.dataServices.constants.packagePublishedSuccessfullyEventName,c.id),c.publishOrRefreshStatus===n.PublishError&&i.deletePackageOnPublishFailure(a),l&&(i.rootScope.$emit(t.constants.contentPackDirtyShowNotification,d,r.Report),l=!1),s.resolve()}),(function(){s.reject()}))},o.prototype.updateExistingModel=function(e,t,o){e.dbName=t.dbName,e.vsName=t.vsName,e.contract.packagePublishStatus=o,e.packagePublishStatus=o},o.prototype.onPackageDeleted=function(e){this.deletePackage(e)},o.prototype.deletePackageOnPublishFailure=function(e){var t=this,o=this.localizationService.get("NavigationPane_PackagePublishErrorTitle"),r=this.localizationService.get("NavigationPane_PackagePublishErrorContent"),i={label:this.localizationService.get("ModalDialogButtonText_Delete"),resultValue:"delete",cssClass:"primary"},a={label:this.localizationService.get("ModalDialogButtonText_Cancel"),resultValue:"cancel"},n=[i,a],s=function(o){if("delete"===o)for(var r=e.data.models.length,i=0;i<r;i++)t.modelService.deleteModel(e.data.models[i].id)};this.errorService.error(r,"deletePackageOnPublishFailure",{title:o,dialogOptions:n,dismissCallback:s,isDismissable:!0,showAdditionalErrorInfo:!0,requestId:e?e.requestId:"",statusCode:e?e.status.toString():""})},o})();t.PackageService=c})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,r,i,n,s,c,l){return new a(e,t,o,r,i,n,c,l)}var r=jsCommon.EnumExtensions,i=e.common.contracts.Permissions;t.createPermissionService=o;var a=(function(){function o(e,t,o,r,i,a,n,s){this.activeGroupIdService=e,this.impersonationService=t,this.appCollectionService=o,this.packageCollectionService=r,this.modelCollectionService=i,this.reportCollectionService=a,this.dashboardCollectionService=n,this.telemetryService=s,this.errorsLogged={}}return Object.defineProperty(o.prototype,"activeWorkSpacePermission",{get:function(){return this.activeGroupIdService.isReadOnly?i.Read:i.All},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isActiveWorkspaceIsReadOnly",{get:function(){return this.impersonationService.impersonating||!r.hasFlag(this.activeWorkSpacePermission,i.Write)},enumerable:!0,configurable:!0}),o.prototype.isGroupWorkspaceReadOnly=function(e,t){var o=e&&!t?i.Read:i.All;return!r.hasFlag(o,i.Write)},o.prototype.getReportEffectivePermissions=function(e){var o=e&&e.permissions;return null==o?this.logErrorIfItemNotFoundForType("report",e.id):e&&e.packageId&&(t.PermissionsUtils.markDashboardAndReportsAsCopyableIfPartOfTemplateInstance(null,[e.id],null,e.packageId,this.modelCollectionService,this.reportCollectionService,this.dashboardCollectionService,this.packageCollectionService,this.appCollectionService),o=e&&e.permissions),o},o.prototype.getModelEffectivePermissions=function(e){var t=e&&e.permissions;return t=this.calculateDerivedPermissionsFromPackage(t,e.packageId),null==t&&this.logErrorIfItemNotFoundForType("model",e.id,e.packageId),t},o.prototype.getDashboardEffectivePermissions=function(e){var o=e&&e.permissions;return null==o?this.logErrorIfItemNotFoundForType("dashboard",e.id):e&&e.originalPackageId&&(t.PermissionsUtils.markDashboardAndReportsAsCopyableIfPartOfTemplateInstance([e.id],null,null,e.originalPackageId,this.modelCollectionService,this.reportCollectionService,this.dashboardCollectionService,this.packageCollectionService,this.appCollectionService),o=e&&e.permissions),o},o.prototype.getWorkbookEffectivePermissions=function(e){var t=e&&e.permissions;return t=this.calculateDerivedPermissionsFromPackage(t,e.packageId),null==t&&this.logErrorIfItemNotFoundForType("workbook",e.id),t},o.prototype.getPackageEffectivePermissions=function(e){var t=e&&e.permissions;return null==t&&this.logErrorIfItemNotFoundForType("package",e.id,e.id),t},o.prototype.isExplorableModel=function(e){var t=this.packageCollectionService.findPackageContract(e.packageId);return this.isExplorableModelPermission(e.getPermissions(),t)},o.prototype.isExplorableModelContract=function(e){var t=this.packageCollectionService.findPackageContract(e.packageId);return this.isExplorableModelPermission(this.getModelEffectivePermissions(e),t)},o.prototype.isExplorableModelPermission=function(e,t){return t&&t.permissions?(e&i.Read)===i.Read&&(t.permissions&i.Write)===i.Write:(e&i.ReadWrite)===i.ReadWrite},o.prototype.calculateDerivedPermissionsFromPackage=function(e,t){var o=i.CopyOnWrite&~i.Read,r=this.packageCollectionService.findPackageContract(t),a=!!r&&r.permissions;if(!a)return e;var n=i.None;return n|=e&~o,n|=a&o},o.prototype.logErrorIfItemNotFoundForType=function(t,o,r){this.errorsLogged[t]||(this.errorsLogged[t]=!0,this.telemetryService.logEvent(e.telemetry.PermissionsObjectNotFound,o,r,t))},o})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o){return new r(e,t,o)}t.createResourcePackageListenerService=o;var r=(function(){function t(e,t,o){this.resourcePackageService=e,this.promiseFactory=t,this.visualPluginService=o}return t.prototype.onResourcePackageAdded=function(e){return this.getAndLoadVisualPlugin(e)},t.prototype.getResourcePackageByResourceId=function(t){var o=this,r=this.promiseFactory.defer(),i=this.resourcePackageService.getPackageById(t);if(i)return r.resolve([i]),r.promise;var a=e.common.httpService.powerbiRequestOptions(null,"GetResourcePackageByResourceId");return e.common.httpService.post("/powerbi/metadata/resourcePackage",[t],a).then((function(e){var i=o.resourcePackageService.getPackageById(t);return i?void r.resolve([i]):(o.resourcePackageService.registerPackages(e.data),void r.resolve(e.data))}),(function(e){r.reject()})),r.promise},t.prototype.getAndLoadVisualPlugin=function(e){var t=this,o=this.promiseFactory.defer();return this.getResourcePackageByResourceId(e).then((function(e){t.visualPluginService.ensurePlugins(e).then((function(){return o.resolve(e)}),(function(){return o.reject()}))}),(function(){return o.reject()})),o.promise},t.prototype.getAndLoadVisualPluginsForDashboard=function(e){var t=this,o=this.getAllRequiredResourcePackageIds(e);return this.loadRequiredResourcePackagesAndVisualPlugins(o).then((function(e){var o=_.chain(e).filter((function(e){return 0===e.type})).map((function(e){return t.getCustomVisualTypesFromResourcePackages(e.value)})).flatten(!1).unique().value();return t.promiseFactory.resolve(o)}))},t.prototype.getCustomVisualTypesFromResourcePackages=function(e){return _.chain(e).filter((function(e){return 0===e.type})).map((function(e){return e.name})).unique().value()},t.prototype.getLoadedCustomVisualTypesForDashboard=function(e){var t=[];
if(e&&e.tiles)for(var o=0,r=e.tiles;o<r.length;o++){var i=r[o],a=i.contract.resourcePackageIds;if(a)for(var n=0,s=a;n<s.length;n++){var c=s[n],l=this.resourcePackageService.getPackageById(c);l&&0===l.type&&t.push(l.name)}}return _.unique(t)},t.prototype.getAllRequiredResourcePackageIds=function(e){var t=[];if(e&&e.tiles)for(var o=0,r=e.tiles;o<r.length;o++){var i=r[o],a=i.contract.resourcePackageIds;if(a)for(var n=0,s=a;n<s.length;n++){var c=s[n];t.push(c)}}return _(t).unique().value()},t.prototype.getAllRequiredResourcePackageIdStrings=function(e){var t=this.getAllRequiredResourcePackageIds(e);return $.map(t,(function(e){return e.toString()}))},t.prototype.loadRequiredResourcePackagesAndVisualPlugins=function(e){for(var t=[],o=0,r=e;o<r.length;o++){var i=r[o];t.push(this.getAndLoadVisualPlugin(i))}return this.promiseFactory.allSettled(t)},t})();t.ResourcePackageListenerService=r})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,r,i,a,s,c,l,d,p,u){return new n(e,t,o,r,i,a,s,c,l,d,p,u)}var r=jsCommon.EnumExtensions,i=e.common.contracts.Permissions,a=e.common.contracts.PermissionArtifactType;t.createReportService=o;var n=(function(){function o(e,t,o,r,i,a,n,s,c,l,d,p){this.rootScope=e,this.telemetryService=t,this.errorService=o,this.modelMerger=r,this.modelConverter=i,this.syncService=a,this.reportHttpService=n,this.localizationService=s,this.appMetadataService=c,this.promiseFactory=l,this.reportCollectionService=d,this.permissionService=p,this.reportsDeferred=this.promiseFactory.defer(),this.syncService.addReportRefreshListener(this),this.initReports()}return o.prototype.ensureReportsInitialization=function(){return this.reportsDeferred.promise},Object.defineProperty(o.prototype,"reports",{get:function(){return this.reportCollectionService.reports},set:function(e){this.reportCollectionService.reports=e},enumerable:!0,configurable:!0}),o.prototype.getReports=function(){return this.reportsDeferred.promise.then((function(e){return e.reports}))},o.prototype.onReportAdded=function(e){var t=this,o=this.findReport(e);o&&!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(o.displayName)||this.reportHttpService.getReport(e,null).then((function(r){var a=r.data;if((a.permissions&i.Write)===i.Write||(a.permissions&i.CopyOnWrite)===i.CopyOnWrite)if(o=t.findReport(e))t.modelMerger.mergeReport(o,a);else{var n=t.modelConverter.convertReport(a);n.isNew=!0,t.addReport(n)}}),(function(){}))},o.prototype.onReportDeleted=function(e){this.removeReport(e)},o.prototype.onReportSlideThumbnailEdit=function(e){},o.prototype.onReportUpdated=function(t){var o=this;if(!(this.reports.length<0)){var r=this.findReport(t);r&&this.reportHttpService.getReport(t,null).then((function(i){o.modelMerger.mergeReport(r,i.data),o.currentActiveReport={id:t,displayName:r.displayName,guid:r.objectId},o.rootScope.$emit(e.common.constants.currentActiveReportInfoChangedEventName,o.currentActiveReport)}),_.noop)}},o.prototype.retrieveReportForApp=function(e,t){if(null!=e&&!_.isEmpty(t))return _.find(this.reports,(function(o){return o.packageId===e&&o.contract.originalReportObjectId===t}))},o.prototype.updateReportCollection=function(e){var t=[];if(!_.isEmpty(e))for(var o=0,r=e.length;o<r;++o)t.push(this.modelConverter.convertReport(e[o]));this.reports=t},o.prototype.mergeReportCollection=function(e){if(!_.isEmpty(e))for(var t=_.indexBy(this.reports,"id"),o=0,r=e;o<r.length;o++){var i=r[o];t[i.id]||this.addReport(this.modelConverter.convertReport(i))}},o.prototype.updateReport=function(e){var t=this.findReport(e.id);return t&&this.modelMerger.mergeReport(t,e),t},o.prototype.getReportContracts=function(){return this.reportCollectionService.getReportContracts()},Object.defineProperty(o.prototype,"editableReports",{get:function(){var e=this.permissionService;return _.filter(this.reports,(function(o){var r=e.getReportEffectivePermissions(o.contract);return t.PermissionsUtils.canReshare(r,a.Report)}))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"copyAndEditReports",{get:function(){var e=this.permissionService;return _.filter(this.reports,(function(t){var o=e.getReportEffectivePermissions(t.contract);return r.hasFlag(o,i.Write)||r.hasFlag(o,i.CopyOnWrite)}))},enumerable:!0,configurable:!0}),o.prototype.deleteReportsForModel=function(e,t){for(var o=_.filter(this.reports,(function(o){return o.modelId===e&&o.packageId===t})),r=0,i=o.length;r<i;++r)this.onReportDeleted(o[r].id);return o},o.prototype.deleteReportForPackage=function(e){for(var t=_.filter(this.reports,(function(t){return t.packageId===e})),o=0,r=t.length;o<r;++o)this.onReportDeleted(t[o].id)},o.prototype.addContractReport=function(e){if(e&&null!=e.id){var t=this.modelConverter.convertReport(e),o=this.getReportIndex(e.id);o<0&&(t.isNew=!0,this.addReport(t))}},o.prototype.addReport=function(e){this.reportCollectionService.addReport(e)},o.prototype.tryAddReport=function(e){var t=e.id;if(t){var o=this.findReport(t);if(!o){var r=this.modelConverter.convertReport(e);return r.isNew=!0,this.addReport(r),r}}},o.prototype.removeReport=function(e){var t=this.findReport(e);if(null!=t)return this.reportCollectionService.removeReport(e),t},o.prototype.deleteReport=function(e){this.deleteReportInternal(e)},o.prototype.getReportIndex=function(e){if(null!=e&&this.reports.length>0)for(var t=0,o=this.reports.length;t<o;t++){var r=this.reports[t];if(r.id===e)return t}return-1},o.prototype.findReport=function(e){return null!=e?_.find(this.reports,(function(t){return t.id===e})):null},o.prototype.findReportByGUID=function(e){return null!=e?_.find(this.reports,(function(t){return t.objectId===e})):null},o.prototype.findReportByOriginalReportId=function(e){return null!=e?_.find(this.reports,(function(t){return t.contract.originalReportId===e})):null},o.prototype.findReportsByPackageId=function(e){return _.filter(this.reports,(function(t){return t.packageId===e}))},o.prototype.renameReport=function(o,r){var i=this;if(this.isReportNameValid(o)){var a=this.findReport(r);if(!a)return;var n=a.contract.displayName;if(n!==o){var s=this.telemetryService.startEvent(e.telemetry.DashboardRenameReport);a.displayName=o,this.reportHttpService.renameReport(a,o,s.event).then((function(){s.resolve(),a&&a.isUsedByContentPack&&i.rootScope.$emit(t.constants.contentPackDirtyShowNotification,a.id,t.models.ContentPackItems.Report),i.rootScope.$emit(e.common.constants.currentActiveReportInfoChangedEventName,{id:r,displayName:a.displayName,guid:a.objectId})}),(function(t){t.status===e.HttpStatusCode.Unauthorized?i.errorService.error(i.localizationService.get("Report_NoPermissionToRenameMessage"),"Report_NoPermissionToRename",{requestId:t.requestId,statusCode:t.status.toString()}):i.errorService.error(i.localizationService.get("Report_FailToRenameReportMessage"),"Report_FailToRenameReport",{requestId:t.requestId,statusCode:t.status.toString()}),a.displayName=n,s.reject()}))}}},o.prototype.isReportNameValid=function(e){return!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)},o.prototype.initReports=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(t){e.loadReports(t)}),(function(){e.loadReports()}))},o.prototype.deleteReportInternal=function(o){var r=this,i=this.telemetryService.startEvent(e.telemetry.DashboardDeleteReport),a=this.removeReport(o);return null==a?void i.resolve():void this.reportHttpService.deleteReport(a.contract,i.event).then((function(){r.rootScope.$emit(t.constants.reportDeletedEventName,o),i.resolve(),a&&a.isUsedByContentPack&&r.rootScope.$emit(t.constants.contentPackDirtyShowNotification,a.id,t.models.ContentPackItems.Report)}),(function(t){t.status===e.HttpStatusCode.Unauthorized?r.errorService.error(r.localizationService.get("Report_NoPermissionToDeleteMessage"),"Report_NoPermissionToDelete",{requestId:t.requestId,statusCode:t.status.toString()}):r.errorService.error(r.localizationService.get("Report_FailToDeleteReportMessage"),"Report_FailToDeleteReport",{requestId:t.requestId,statusCode:t.status.toString()}),r.addReport(a),i.reject()}))},o.prototype.loadReports=function(t){var o=this;if("undefined"==typeof t){var r=this.telemetryService.startEvent(e.telemetry.DashboardInitializeNavigationPaneReports);this.reportHttpService.getReports(r.event).then((function(e){var t=e.data;o.updateReportCollection(t),r.resolve(),o.reportsDeferred.resolve(o)}),(function(){r.reject(),o.reportsDeferred.reject()}))}else t.reports&&(this.updateReportCollection(t.reports),this.reportsDeferred.resolve(this))},o.prototype.subscribe=function(e){this.reportCollectionService.subscribe(e)},o.prototype.unsubscribe=function(e){this.reportCollectionService.unsubscribe(e)},o})();t.ReportService=n})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(){return new i}var r=e.common.NotifyCollection;t.createReportCollectionService=o;var i=(function(){function e(){this.listeners=[],this.collection=new r}return Object.defineProperty(e.prototype,"reports",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e)},enumerable:!0,configurable:!0}),e.prototype.getReportContracts=function(){return _.map(this.reports,(function(e){return e.contract}))},e.prototype.findReportContract=function(e){var t=this.getReportContracts();return _.find(t,(function(t){return t.id===e}))},e.prototype.onAdded=function(e){for(var t=this.listeners,o=0,r=t;o<r.length;o++){var i=r[o];i.onReportAdded&&i.onReportAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,o=0,r=t;o<r.length;o++){var i=r[o];i.onReportDeleted&&i.onReportDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,o=e;t<o.length;t++){var r=o[t];r.onReportsReset&&r.onReportsReset()}},e.prototype.addReport=function(e){this.collection.addItem(e)},e.prototype.removeReport=function(e){this.collection.deleteItems((function(t){return t.id===e}))},e.prototype.subscribe=function(e){this.listeners.length<1&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),this.listeners.length<1&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o=e.common.contracts.Permissions,r=e.common.models.ReportPermissions,i=(function(){function t(e){this.userInfo=e}return t.prototype.mapReportOwnerFullnames=function(e,t,o,r){this.mapResourceOwnerFullnames(e,t,o,r,"reportIds")},t.prototype.mapWorkbookOwnerFullnames=function(e,t,o,r){this.mapResourceOwnerFullnames(e,t,o,r,"workbookIds")},t.prototype.mapResourceOwnerFullnames=function(e,t,o,r,i){for(var a=0,n=e;a<n.length;a++){var s=n[a];s.ownerFullname||(s.ownerFullname=this.getOwnerFullname(s.getPermissions(),s.packageId,i,s.id,t,o,r))}},t.prototype.getOwnerFullnameFromUserInfo=function(){if(!this.userInfo)return"";var e=_.trim(this.userInfo.givenName),t=_.trim(this.userInfo.surname);return _.isEmpty(e)?"":(_.isEmpty(t)||(e+=" "+t),e)},t.prototype.hasPermission=function(e,t){return(e&t)===t},t.prototype.getOwnerFromGroupOrUser=function(t,o){return t===e.common.constants.myWorkspaceGroupId?this.getOwnerFullnameFromUserInfo():o},t.prototype.getOwnerFromUserInfo=function(e,t,i){return this.hasPermission(e,o.CopyOnWrite)||this.hasPermission(e,r.Personalized)?this.getOwnerFromGroupOrUser(t,i):""},t.prototype.getOwnerFromDashboard=function(e){return e&&e.ownerFullname||""},t.prototype.getOwnerFullname=function(e,t,o,r,i,a,n){for(var s,c,l,d=0,p=i;d<p.length;d++){var u=p[d],h=u.contract;if(h.originalPackageId===t){s=u;break}!c&&h.packageIds&&_.contains(h.packageIds,t)&&(c=u),!l&&h[o]&&_.contains(h[o],r)&&(l=u)}var m=s||c||l;return m?this.getOwnerFromDashboard(m):this.getOwnerFromUserInfo(e,a,n)},t})();t.ResourceOwnershipService=i})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(){return new i}var r=e.common.NotifyCollection;t.createModelCollectionService=o;var i=(function(){function e(){this.listeners=[],this.collection=new r}return Object.defineProperty(e.prototype,"models",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e)},enumerable:!0,configurable:!0}),e.prototype.getModelContracts=function(){return _.map(this.models,(function(e){return e.contract}))},e.prototype.onAdded=function(e){for(var t=this.listeners,o=0,r=t;o<r.length;o++){var i=r[o];i.onModelAdded&&i.onModelAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,o=0,r=t;o<r.length;o++){var i=r[o];i.onModelDeleted&&i.onModelDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,o=e;t<o.length;t++){var r=o[t];r.onModelsReset&&r.onModelsReset()}},e.prototype.addModel=function(e){this.collection.addItem(e)},e.prototype.removeModel=function(e,t){var o;return o=t?function(o){return o.id===e&&o.packageId===t}:function(t){return t.id===e},!!this.removeModels(o)},e.prototype.removeModels=function(e){return this.collection.deleteItems(e)},e.prototype.subscribe=function(e){this.listeners.length<1&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),this.listeners.length<1&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,r,i,a,n,c,l,d,p,u,h,m){return new s(e,t,o,r,i,a,n,c,l,d,p,u,h,m)}var r=jsCommon.EnumExtensions,i=e.common.contracts.Permissions,a=e.common.contracts.PermissionArtifactType,n=jsCommon.StringExtensions;t.createModelService=o;var s=(function(){function o(e,t,o,r,i,a,n,s,c,l,d,p,u,h){this.rootScope=e,this.telemetryService=t,this.errorService=o,this.modelMerger=r,this.modelConverter=i,this.syncService=a,this.modelHttpService=n,this.localizationService=s,this.reportService=c,this.appMetadataService=l,this.promiseFactory=d,this.dataProxy=p,this.modelCollectionService=u,this.permissionService=h,this.modelUpdateListeners=[],this.syncService.addModelRefreshListener(this),this._modelsDeferred=this.promiseFactory.defer(),this.initModels()}return Object.defineProperty(o.prototype,"models",{get:function(){return this.modelCollectionService.models},set:function(e){this.modelCollectionService.models=e},enumerable:!0,configurable:!0}),o.prototype.applyModelUpdated=function(e,t){for(var o=0,r=this.modelUpdateListeners;o<r.length;o++){var i=r[o];i.onModelUpdated(e,t)}},o.prototype.onModelAdded=function(e,t){var o=this.findModels(e,t);0===o.length&&this.addOrUpdateModel(e,t);for(var r=0,i=o.length;r<i;r++){var a=o[r];n.isNullOrUndefinedOrWhiteSpaceString(a.displayName)&&this.addOrUpdateModel(a.id,a.packageId,a)}},o.prototype.addOrUpdateModel=function(e,o,r){var i=this;this.modelHttpService.getModel(e,o,null).then((function(o){var a=o.data,n=i.modelConverter.convertModel(a);i.isExplorableNonLegacySampleModel(n)&&(r=i.findModel(e,a.packageId),r?(i.modelMerger.mergeModel(r,a),i.applyModelUpdated(r.id,r.packageId)):(n.isNew=!0,i.pushModel(n),i.rootScope.$emit(t.constants.onDatasetAddedEventName,a))),i.updateTimestamp()}))},o.prototype.pushModel=function(e){this.modelCollectionService.addModel(e)},o.prototype.removeModel=function(e,t){if(_.isEmpty(this.models))return!1;var o=this.modelCollectionService.removeModel(e,t);return o&&this.updateTimestamp(),o},o.prototype.onModelDeleted=function(e,t){this.models&&this.removeModel(e,t)},o.prototype.onModelUpdated=function(e,t){var o=this;if(this.models)for(var r=this.findModels(e,t),i=0,a=r.length;i<a;i++){var n=r[i];this.modelHttpService.getModel(e,n.packageId,null).then((function(e){o.modelMerger.mergeModel(n,e.data),o.applyModelUpdated(n.id,n.packageId),o.updateTimestamp();var t=e.data;o.dataProxy.clearCache("dsr",[{dbName:t.dbName,modelId:t.id,vsName:t.vsName,schemaName:void 0}])}))}},o.prototype.addModelUpdateListener=function(e){this.modelUpdateListeners.push(e)},o.prototype.removeModelUpdateListener=function(e){_.pull(this.modelUpdateListeners,e)},Object.defineProperty(o.prototype,"modelsPromise",{get:function(){return this._modelsDeferred.promise},enumerable:!0,configurable:!0}),o.prototype.updateDatasetCollection=function(e){var t=[];if(!_.isEmpty(e))for(var o=0,r=e.length;o<r;++o)t.push(this.modelConverter.convertModel(e[o]));this.modelCollectionService.models=t,this.updateTimestamp()},o.prototype.mergeDatasetCollection=function(e){if(!_.isEmpty(e))for(var t=_.indexBy(this.models,"id"),o=0,r=e;o<r.length;o++){var i=r[o];t[i.id]?this.updateContractModel(i):this.pushModel(this.modelConverter.convertModel(i))}},o.prototype.getModelContracts=function(){return this.modelCollectionService.getModelContracts()},o.prototype.deleteModelForPackage=function(e){for(var t=this.getModelsByPackageId(this.models,e),o=0,r=t.length;o<r;++o)this.onModelDeleted(t[o].id,e)},o.prototype.updateContractModel=function(e){if(e){var t=this.findModel(e.id,e.packageId);t&&(this.modelMerger.mergeModel(t,e),this.applyModelUpdated(t.id,t.packageId))}},o.prototype.addContractModel=function(e){if(e){var t=this.modelConverter.convertModel(e),o=this.getModelIndex(t.id,t.packageId);o<0&&(t.isNew=!0,this.addModel(t))}},o.prototype.addModel=function(e){if(e){var t=this.getModelIndex(e.id,e.packageId);t<0&&(this.modelCollectionService.addModel(e),this.updateTimestamp())}},o.prototype.deleteModel=function(e,t){this.deleteModelInternal(e,t)},o.prototype.getModelIndex=function(e,t){if(this.models.length>0)for(var o=0,r=this.models.length;o<r;o++){var i=this.models[o];if(i.id===e&&i.packageId===t)return o}return-1},o.prototype.getModelIndices=function(e){var t=[];if(this.models.length>0)for(var o=0,r=this.models.length;o<r;o++){var i=this.models[o];i.id===e&&t.push(o)}return t},o.prototype.getModelRefreshSchedule=function(e,t){return this.findModel(e,t).contract.refreshSchedule},o.prototype.findModel=function(e,t,o){var a=this.findModels(e);if(!_.isEmpty(a)){if(1===a.length)return a[0];var n;return null!=t&&(n=this.getModelByPackageId(a,t),n||!o)?n:(n=_.find(a,(function(e){return r.hasFlag(e.getPermissions(),i.All)})),n||a[0])}},o.prototype.findModels=function(e,t){return t?_.filter(this.models,(function(o){return o.id===e&&o.packageId===t})):_.filter(this.models,(function(t){return t.id===e}))},o.prototype.findModelByDBName=function(e,t){var o;return o=t?_.find(this.models,(function(o){return o.dbName===e&&o.packageId===t})):this.findFirstOwnedModelByDBName(e),o||t||(o=_.find(this.models,(function(t){return t.dbName===e}))),o},o.prototype.findFirstOwnedModelByDBName=function(e){return _.find(this.models,(function(t){return t.dbName===e&&(t.getPermissions()&i.All)===i.All}))},o.prototype.findFirstExplorableModelByDBName=function(e){var t=this;return _.find(this.models,(function(o){return o.dbName===e&&t.permissionService.isExplorableModel(o)}))},o.prototype.findModelsByDBName=function(e){return _.filter(this.models,(function(t){return t.dbName===e}))},o.prototype.findModelByPackageId=function(e){return this.getModelByPackageId(this.models,e)},o.prototype.findModelsByPackageId=function(e){return this.getModelsByPackageId(this.models,e)},Object.defineProperty(o.prototype,"editableModels",{get:function(){var e=this;return _.filter(this.models,(function(o){var r=o.contract;if(o.contract.isHidden)return!1;var i=e.permissionService.getModelEffectivePermissions(r);return t.PermissionsUtils.canReshare(i,a.Dataset)}))},enumerable:!0,configurable:!0}),o.prototype.isExplorableNonLegacySampleModel=function(e){var o=e.getPermissions();return e.contentProviderId!==t.constants.samplesContentProviderId&&(this.permissionService.isExplorableModel(e)||r.hasFlag(o,i.CopyOnWrite))},Object.defineProperty(o.prototype,"copyAndEditModels",{get:function(){var e=this;return _.filter(this.models,(function(t){return e.isExplorableNonLegacySampleModel(t)}))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sanitizedCopyAndEditModels",{get:function(){var e=this;return _.filter(this.models,(function(t){return e.isExplorableNonLegacySampleModel(t)&&!n.isNullOrUndefinedOrWhiteSpaceString(t.displayName)&&!t.realTimeMode}))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"streamingModels",{get:function(){var e=this;return _.filter(this.models,(function(t){return e.isExplorableNonLegacySampleModel(t)&&!!t.realTimeMode}))},enumerable:!0,configurable:!0}),o.prototype.renameModel=function(o,r,i){var a=this;if(this.isModelNameValid(o)){var n=this.findModel(r,i);if(!n)return;var s=n.contract.displayName;if(s!==o){var c=this.telemetryService.startEvent(e.telemetry.DashboardRenameDataset);n.displayName=o,this.modelHttpService.renameModel(n,o,c.event).then((function(){c.resolve();var e=a.findModel(n.id,n.packageId);e&&e.isUsedByContentPack&&a.rootScope.$emit(t.constants.contentPackDirtyShowNotification,e.id,t.models.ContentPackItems.Model)}),(function(t){t.status===e.HttpStatusCode.Unauthorized?a.errorService.error(a.localizationService.get("Model_NoPermissionToRenameMessage"),"Model_NoPermissionToRename",{requestId:t.requestId,statusCode:t.status.toString()}):a.errorService.error(a.localizationService.get("Model_FailToRenameModelMessage"),"Model_FailToRenameModel",{requestId:t.requestId,statusCode:t.status.toString()}),n.displayName=s,c.reject()}))}}},o.prototype.updateModelQnaFeatures=function(t,o){var r=this.promiseFactory.defer(),i=this.telemetryService.startEvent(e.telemetry.DashboardUpdateModelQnaFeatures,o.cortanaEnabled,o.powerBIQnaEnabled);return this.modelHttpService.updateModelQnaFeatures(t,o,i.event).then((function(){i.resolve(),r.resolve({})}),(function(){i.reject(),r.reject()})),r.promise},o.prototype.updateFeaturedQuestions=function(t,o){var r=this.promiseFactory.defer(),i=this.telemetryService.startEvent(e.telemetry.DashboardUpdateFeaturedQuestions,o.length);return this.modelHttpService.updateFeaturedQuestions(t,o,i.event).then((function(){i.resolve(),r.resolve({})}),(function(){i.reject(),r.reject()})),r.promise},o.prototype.isModelNameValid=function(e){return!n.isNullOrUndefinedOrWhiteSpaceString(e)},o.prototype.removeModels=function(e){this.modelCollectionService.removeModels((function(t){return _.contains(e,t.id)}))&&this.updateTimestamp()},Object.defineProperty(o.prototype,"lastUpdatedTimestamp",{get:function(){return this._lastUpdatedTimestamp},enumerable:!0,configurable:!0}),o.prototype.updateTimestamp=function(){this._lastUpdatedTimestamp=(new Date).getTime()},o.prototype.initModels=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(t){e.loadModels(t)}),(function(){e.loadModels()}))},o.prototype.deleteModelInternal=function(o,r){for(var i=this,a=this.findModels(o,r),n=0,s=a.length;n<s;n++){var c,l=this.telemetryService.startEvent(e.telemetry.DashboardDeleteDataset),d=a[n],p=this.getModelIndex(o,d.packageId);p>=0?(this.removeModel(o,d.packageId),c=this.reportService.deleteReportsForModel(o,d.packageId),this.rootScope.$emit(t.constants.deleteModelStartedEventName,o),this.modelHttpService.deleteModel(d.contract,l.event).then((function(){l.resolve(),i.updateTimestamp()}),(function(r){r.status===e.HttpStatusCode.Unauthorized?i.errorService.error(i.localizationService.get("Model_NoPermissionToDeleteMessage"),"Model_NoPermissionToDelete",{requestId:r.requestId,statusCode:r.status.toString()}):r.status===e.HttpStatusCode.BadRequest&&r.headers(e.common.PowerBIErrorHeader)===t.constants.CannotDeleteModelPublishedToOrganizationalAppHeader?i.errorService.error(i.localizationService.get("Model_DeleteWaitMessage"),"Model_DeleteWaitMessage",{requestId:r.requestId,statusCode:r.status.toString()}):i.errorService.error(i.localizationService.get("Model_FailToDeleteModelMessage"),"Model_FailToDeleteModel",{requestId:r.requestId,statusCode:r.status.toString()}),i.pushModel(d);for(var a=0,n=c.length;a<n;++a)i.reportService.addReport(c[a]);i.rootScope.$emit(t.constants.deleteModelFailedEventName,o),l.reject()}))):l.resolve()}},o.prototype.loadModels=function(t){var o=this;if(t)t.models&&(this.updateDatasetCollection(t.models),this._modelsDeferred.resolve(this.models));else{var r=this.telemetryService.startEvent(e.telemetry.DashboardInitializeNavigationPaneModels);this.modelHttpService.getModels(r.event).then((function(e){o.updateDatasetCollection(e.data),o._modelsDeferred.resolve(o.models),r.resolve()}),(function(){o._modelsDeferred.reject(),r.reject()}))}},o.prototype.getModelByPackageId=function(e,t){return _.find(e,(function(e){return e.packageId===t}))},o.prototype.getModelsByPackageId=function(e,t){return _.filter(e,(function(e){return e.packageId===t}))},o.prototype.subscribe=function(e){this.modelCollectionService.subscribe(e)},o.prototype.unsubscribe=function(e){this.modelCollectionService.unsubscribe(e)},o})();t.ModelService=s})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(e,t,o,r,i,a,n,s,l,d,p,u,h,m,f,v,g){return new c(e,t,o,r,i,a,n,s,l,d,p,u,h,m,f,v,g)}var r,i=e.common.constants,a=e.common.contracts.Permissions,n=e.common.contracts.PermissionArtifactType;!(function(e){e[e.NamedRange=0]="NamedRange",e[e.Parameter=1]="Parameter",e[e.Table=2]="Table",e[e.PivotTable=3]="PivotTable",e[e.Chart=4]="Chart",e[e.WebExtension=5]="WebExtension"})(r=t.EwaNamedItemType||(t.EwaNamedItemType={})),t.createWorkbookService=o;var s=".xlsx,.xlsm",c=(function(){function o(e,t,o,r,i,a,n,s,c,l,d,p,u,h,m,f,v){this.workbookCollectionService=f,this.telemetryService=t,this.rootScope=e,this.errorService=o,this.modelMerger=r,this.modelConverter=i,this.syncService=a,this.workbookHttpService=n,this.localizationService=s,this.featureSwitchService=c,this.appMetadataService=l,this.windowService=d,this.promiseFactory=p,this.tutorialDataStore=u,this.compile=h,this.localFileService=m,this.permissionService=v,this.spoAuthenticationTelemetryCollected=!1,this.wopiDataTTL=new Array,this.deferredWopiData=Array(),this.workbooksDeferred=p.defer(),this.syncService.addWorkbookRefreshListener(this),this.replaceWorkbookScope=this.rootScope.$new(),this.replaceWorkbookScope.shouldReplaceLocalWorkbook=!1,this.initWorkbooks()}return Object.defineProperty(o.prototype,"workbooks",{get:function(){return this.workbookCollectionService.workbooks},set:function(e){this.workbookCollectionService.workbooks=e},enumerable:!0,configurable:!0}),o.prototype.addContractWorkbook=function(e){if(e&&null!=e.id){var t=this.modelConverter.convertWorkbook(e),o=this.getWorkbookIndex(t.id,t.packageId);o<0&&this.addWorkbook(t)}},o.prototype.addWorkbook=function(e){if(e&&null!=e.id){var t=this.getWorkbookIndex(e.id,e.packageId);t<0&&(this.workbookCollectionService.addWorkbook(e),this.updateTimestamp())}},o.prototype.deleteWorkbookForPackage=function(e){for(var t=_.filter(this.workbooks,(function(t){return t.packageId===e})),o=0,r=t.length;o<r;++o)this.onWorkbookDeleted(t[o].id,e)},o.prototype.postUploadWorkbookErrorMessage=function(e){this.postErrorForWorkbook(e,"UploadExcel_FailedToUploadWorkbook_Title","UploadExcel_FailedToUploadWorkbook_Message")},o.prototype.postReplaceWorkbookErrorMessage=function(e){this.postErrorForWorkbook(e,"UploadExcel_FailedToReplaceWorkbook_Title","UploadExcel_FailedToReplaceWorkbook_Message")},o.prototype.postErrorForWorkbook=function(t,o,r){var a=t.headers(e.common.PowerBIErrorHeader),n=r;if(a){var s=e.common.KnownContentProviderErrors[i.excelContentProviderId],c=s&&s[a];c&&c.messageId&&(n=c.messageId)}this.errorService.error(e.common.localize.get(n),n,{requestId:t.requestId,statusCode:t.status.toString(),title:e.common.localize.get(o)})},o.prototype.replaceLocalWorkbook=function(e){var t=this,o=this.findWorkbookByUniqueId(e);this.replaceWorkbookScope.workbookToUpdate=o;var r,i=this.promiseFactory.defer();r=function(){t.localFileService.chooseLocalFile(i,s)},i.promise.then((function(e){t.getUserConsentToReplace(r,e)})),r=function(){t.replaceWorkbook()},this.localFileService.chooseLocalFile(i,s)},o.prototype.showReplaceWorkbookTutorialIfNeeded=function(e){var t=this;return this.neverShowUpdateExplanation=this.tutorialDataStore.hasKey(o.UpdateLocalWorkbookExplanation),this.neverShowUpdateExplanation?void e():void this.showInputDialog("ReplaceLocalWorkbook_Title","ReplaceLocalWorkbook_Message","ReplaceLocalWorkbook_ReplaceFile","UploadReplace_CancelButton",e,"ToastNotification_DontShowThisAgain",(function(){t.neverShowUpdateExplanation=!t.neverShowUpdateExplanation}))},o.prototype.getUserConsentToReplace=function(e,t){if(t){this.replaceWorkbookScope.localWorkbookToUpload=t;var o=t.name;this.replaceWorkbookScope.workbookToUpdate&&this.replaceWorkbookScope.workbookToUpdate.displayNameWithExtension.toLowerCase()!==o.toLowerCase()?this.showInputDialog("ReplaceLocalWorkbook_DifferentName_Title","ReplaceLocalWorkbook_DifferentName_Message","ReplaceLocalWorkbook_ReplaceFile","UploadReplace_CancelButton",e):this.showReplaceWorkbookTutorialIfNeeded(e)}},o.prototype.showInputDialog=function(e,t,o,r,i,a,n){var s,c=this,l=this.errorService.control(),d=[new InJs.ModalDialogAction(this.localizationService.get(o),function(e,t){l.hideDialog(),c.dismissExplanationPermanentlyIfNeeded(),i()}),new InJs.ModalDialogAction(this.localizationService.get(r),function(e,t){l.hideDialog()})];a&&(s=new InJs.ModalDialogAction(this.localizationService.get(a),function(e,t){n()}));var p=this.localizationService.get(e),u=this.localizationService.get(t);l.showCustomDialog(p,angular.element("<div/>").text(u),d,(function(e){e.parent().find('input[value="'+c.localizationService.get(o)+'"]').focus()}),!1,null,null,null,null,null,null,null,null,null,s)},o.prototype.dismissExplanationPermanentlyIfNeeded=function(){if(this.neverShowUpdateExplanation){var t=this.telemetryService.startEvent(e.telemetry.DashboardUpdateLocalWorkbookNeverShowExplanation);this.tutorialDataStore.setKey(o.UpdateLocalWorkbookExplanation,!0,t)}},o.prototype.replaceWorkbook=function(){this.replaceWorkbookScope.shouldReplaceLocalWorkbook=!0,this.updateLocalWorkbookElement||(this.updateLocalWorkbookTemplate=angular.element(o.HtmlTemplateUpdate),this.updateLocalWorkbookElement=this.compile(this.updateLocalWorkbookTemplate)(this.replaceWorkbookScope),$("body").append(this.updateLocalWorkbookElement)),this.replaceWorkbookScope.$applyAsync()},o.prototype.finishReplacingLocalWorkbook=function(){this.replaceWorkbookScope.shouldReplaceLocalWorkbook=!1},o.prototype.onWorkbookAdded=function(e,o){var r=this,i=this.findWorkbook(e,o);i||this.workbookHttpService.getWorkbook(e,o,null).then((function(a){i=r.findWorkbook(e,o);var n=a.data;i?r.modelMerger.mergeWorkbook(i,n):(i=r.modelConverter.convertWorkbook(n),i.isNew=!0,r.workbookCollectionService.addWorkbook(i),r.updateTimestamp(),r.rootScope.$emit(t.constants.workbook.workbookAddedEventName,i.uniqueId))}),(function(){}))},o.prototype.onWorkbookDeleted=function(e,t){0!==this.workbooks.length&&this.workbookCollectionService.removeWorkbook(e,t)&&this.updateTimestamp()},o.prototype.onWorkbookUpdated=function(e){var t=this;if(0!==this.workbooks.length){var o=this.findWorkbooks(e);if(o)for(var r=0,i=o.length;r<i;r++)this.workbookHttpService.getWorkbook(e,o[r].packageId,null).then((function(e){var o=e.data,r=t.findWorkbook(o.id,o.packageId);t.modelMerger.mergeWorkbook(r,o)}),(function(){}))}},o.prototype.updateWorkbookCollection=function(e){this.updateWorkbooks(e),this.updateTimestamp()},o.prototype.mergeWorkbookCollection=function(t){if(!_.isEmpty(t))for(var o=_.indexBy(this.workbooks,"uniqueId"),r=0,i=t;r<i.length;r++){var a=i[r];o[e.common.models.ReportResource.getUniqueId(e.common.models.ResourceType.Workbook,a.id,a.packageId)]||this.workbookCollectionService.addWorkbook(this.modelConverter.convertWorkbook(a))}this.updateTimestamp()},o.prototype.updateWorkbook=function(e){var t=this.findWorkbook(e.id,e.packageId);return t&&this.modelMerger.mergeWorkbook(t,e),t},o.prototype.getWorkbookContracts=function(){return this.workbookCollectionService.getWorkbookContracts()},Object.defineProperty(o.prototype,"copyAndEditWorkbooks",{get:function(){var e=this.permissionService;return _.filter(this.workbooks,(function(t){
var o=e.getWorkbookEffectivePermissions(t.contract);return(o&a.Write)===a.Write||(o&a.CopyOnWrite)===a.CopyOnWrite}))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"editAndReShareWorkbooks",{get:function(){var e=this.permissionService;return _.filter(this.workbooks,(function(t){var o=e.getWorkbookEffectivePermissions(t.contract);return(o&a.Write)===a.Write&&(o&a.ReShare)===a.ReShare}))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lastUpdatedTimestamp",{get:function(){return this._lastUpdatedTimestamp},enumerable:!0,configurable:!0}),o.prototype.ensureWorkbookInitialization=function(){return this.workbooksDeferred.promise},o.prototype.findWorkbooks=function(e){return _.filter(this.workbooks,(function(t){return t.id===e}))},o.prototype.updateTimestamp=function(){this._lastUpdatedTimestamp=(new Date).getTime()},o.prototype.getWorkbookIndex=function(e,t){for(var o=0,r=this.workbooks.length;o<r;o++){var i=this.workbooks[o];if(i.id===e&&i.packageId===t)return o}return-1},o.prototype.findWorkbook=function(e,t){return t?_.find(this.workbooks,(function(o){return o.id===e&&o.packageId===t})):_.find(this.workbooks,(function(t){return t.id===e&&t.isOwner()}))},o.prototype.findWorkbooksByPackageId=function(e){if(null!=e)return _.filter(this.workbooks,(function(t){return t.packageId===e}))},o.prototype.findWorkbookByEtagHash=function(e){return _.find(this.workbooks,(function(t){return t.contract.etagHash===e}))},o.prototype.findWorkbookByUniqueId=function(e){return _.find(this.workbooks,(function(t){return t.uniqueId===e}))},o.prototype.getWorkbookUniqueId=function(e){return e.uniqueId},o.prototype.initWorkbooks=function(){var e=this;this.appMetadataService.getAppMetadata().then((function(t){e.loadWorkbooks(t)}),(function(){e.loadWorkbooks()}))},o.prototype.loadWorkbooks=function(t){var o=this;if(t)t.workbooks&&(t.workbooks.forEach((function(e){var t=o.modelConverter.convertWorkbook(e);o.workbookCollectionService.addWorkbook(t)})),this.workbooksDeferred.resolve(this),this.updateTimestamp());else{var r=this.telemetryService.startEvent(e.telemetry.DashboardInitializeNavigationPaneWorkbooks);this.workbookHttpService.getWorkbooks(r.event).then((function(e){o.updateWorkbooks(e.data),r.resolve(),o.workbooksDeferred.resolve(o),o.updateTimestamp()}),(function(){r.reject(),o.workbooksDeferred.reject()}))}},o.prototype.updateWorkbooks=function(e){var t=this,o=[];_.isEmpty(e)||(o=_.map(e,(function(e){return t.modelConverter.convertWorkbook(e)}))),this.workbookCollectionService.workbooks=o},Object.defineProperty(o.prototype,"originalWorkbooks",{get:function(){var e=this.permissionService;return _.filter(this.workbooks,(function(o){var r=e.getWorkbookEffectivePermissions(o.contract);return t.PermissionsUtils.canReshare(r,n.Workbook)}))},enumerable:!0,configurable:!0}),o.prototype.renameWorkbook=function(t,o,r){var i=this;if(this.isWorkbookNameValid(t)){var a=this.findWorkbook(o,r);if(a){var n=a.contract.displayName;if(n!==t){var s=this.telemetryService.startEvent(e.telemetry.DashboardRenameWorkbook);a.displayName=t,this.workbookHttpService.renameWorkbook(a,t,s.event).then((function(){s.resolve()}),(function(t){t.status===e.HttpStatusCode.Unauthorized?i.errorService.error(i.localizationService.get("Workbook_NoPermissionToRenameMessage"),"Workbook_NoPermissionToRename",{requestId:t.requestId,statusCode:t.status.toString()}):i.errorService.error(i.localizationService.get("Workbook_FailToRenameWorkbookMessage"),"Workbook_FailToRenameWorkbook",{requestId:t.requestId,statusCode:t.status.toString()}),a.displayName=n,s.reject()}))}}}},o.prototype.isWorkbookNameValid=function(e){return!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)},o.prototype.removeWorkbook=function(t,o,r,i){var a=this,n=this.telemetryService.startEvent(e.telemetry.DashboardRemoveWorkbook,r,i),s=this.workbookCollectionService.removeWorkbook(t,o);return s?void this.workbookHttpService.deleteWorkbook(s.contract,n.event).then((function(){n.resolve(),a.updateTimestamp()}),(function(t){t.status===e.HttpStatusCode.Unauthorized?a.errorService.error(a.localizationService.get("Workbook_NoPermissionToRemoveMessage"),"Workbook_NoPermissionToRemove",{requestId:t.requestId,statusCode:t.status.toString()}):a.errorService.error(a.localizationService.get("Workbook_FailToRemoveWorkbookMessage"),"Workbook_FailToRemoveWorkbook",{requestId:t.requestId,statusCode:t.status.toString()}),a.workbookCollectionService.addWorkbook(s),n.reject()})):void n.resolve()},o.prototype.haveWorkbookEmbedAccessData=function(e){var t=this.deferredWopiData[e],o=this.wopiDataTTL[e];return!(!t||o&&!(o>(new Date).getTime()))},o.prototype.getWorkbookEmbedAccessData=function(t,o,r){var i=this;if(r)var a=this.telemetryService.startChildEvent(r,e.telemetry.DashboardGetWorkbookWopiAccessInformation);else var a=this.telemetryService.startEvent(e.telemetry.DashboardGetWorkbookWopiAccessInformation);if(this.haveWorkbookEmbedAccessData(t))return a.resolve(),this.deferredWopiData[t].promise;var n=this.promiseFactory.defer();this.deferredWopiData[t]=n,this.wopiDataTTL[t]=null;var s=!1;return this.workbookHttpService.getWorkbookWopiData(t,a.event).then((function(e){if(!e.data||!e.data.accessToken||!e.data.url)return void(s=!0);var o=e.data;i.wopiDataTTL[t]=o.accessTokenTtl,i.deferredWopiData[t].resolve(o),a.resolve()}),(function(e){s=!0})).finally((function(){s&&(i.deferredWopiData[t].reject(),i.deferredWopiData[t]=null,a.reject())})),n.promise},o.prototype.createExcelWebAppEmbedUrlParams=function(e,t){var o=[{key:"dsdiv",value:e},{key:"dswp",value:"1"},{key:"dsts",value:"None"},{key:"dsat",value:"1"},{key:"dspti",value:"1"},{key:"dsfl",value:"1"},{key:"dsacs",value:this.featureSwitchService.featureSwitches.ffxlChartSelectionEnabled?"1":"0"},{key:"dsrc",value:"pplr"}];t&&o.push({key:"dssc",value:t});var r=o.map((function(e){return"&"+e.key+"="+e.value})).join("");return r},o.prototype.embedWorkbook=function(t,o,r,i,a,n,s,c,l,d){var p=this;if(null!==o&&null!==r){var u=this.promiseFactory.defer(),h=this.promiseFactory.defer(),m=l?"&wdPublishedInPbiHint=true":"";return h.promise.then((function(){var l=p.createExcelWebAppEmbedUrlParams(o.targetDiv,d),h=r+"&access_token="+i+"&access_token_ttl="+a+l+m,f=p.promiseFactory.defer();f.promise.then((function(r){r.getSucceeded()?(p.telemetryService.logEvent(e.telemetry.DashboardWorkbookEmbeddingExternalSuccess,t,r.getCorrelationId(),n,c,s),u.resolve({ewaControl:r.getReturnValue(),window:o})):(p.telemetryService.logEvent(e.telemetry.DashboardWorkbookEmbeddingExternalFailure,t,r.getCode(),r.getDescription(),r.getCorrelationId(),n,c,s),u.reject())}),(function(){p.telemetryService.logEvent(e.telemetry.DashboardWorkbookEmbeddingExternalFailure,t,-1,null,null,n,c,s),u.reject()})),o.loadEwaScripts(h,f)})),o.loadEvent=h,o.loaded&&h.resolve(null),u.promise}},o.prototype.getDefaultTileTitle=function(e,t){var o=t,r=e.sheetName;if(r)o+=", "+r.replace(/\''/g,"'");else{var i=e.item.split("!");i.length>1&&(o+=", "+i[0].substr(1,i[0].length-2))}return o},o.prototype.getDefaultTileSubtitle=function(e){var t=e.split("!");return t.length>1?t[1]:e},o.prototype.getTileSelectionQuery=function(e,t,o,i){var a="";return o===r.Chart&&i&&(a="Sheets('"+i+"')/"),a+=this.getNamedItemTypeAsString(o)+"('",e?a+=e:t&&(a+=t),encodeURIComponent(a+"')")},o.prototype.encodeImageTileQueryString=function(e){var t=encodeURI(e);return t=t.replace(/\'/g,"%27"),t=t.replace(/\(/g,"%28"),t=t.replace(/\)/g,"%29")},o.prototype.getNamedItemTypeAsString=function(e){switch(e){case r.NamedRange:return"Ranges";case r.Parameter:return"Parameters";case r.Table:return"Tables";case r.PivotTable:return"PivotTables";case r.Chart:return"Charts"}return"Ranges"},o.prototype.getWorkbookTilePreviewImageUrl=function(e){var t=this,o=this.promiseFactory.defer();return this.getWorkbookEmbedAccessData(e.workbookId,e.packageId).then((function(r){if(e.$config.workbookTile){var i=r.url.replace(/ExcelJs.ashx/i,"/XlRestInternal.aspx"),a=t.encodeImageTileQueryString(t.getTileSelectionQuery(e.$config.workbookTile.item,e.$config.workbookTile.activeSelection,e.$config.workbookTile.itemType,e.$config.workbookTile.sheetName));i+="&framemode=proxy&wdRestQuery=$format=image&wdRestPart=Model/"+a+"&access_token="+r.accessToken+"&access_token_ttl="+r.accessTokenTtl,o.resolve(i)}else o.reject()}),(function(){o.reject()})),o.promise},o.prototype.getWorkbookTileBestImageUrl=function(t){if(t.hasImages()){var o=t.images,r=-1,i=-1,a=t.tileModel.layoutPosition,n=e.common.GridLayoutConstants.getDefaultGridItemViewport({colSpan:a.width,rowSpan:a.height}),s=Number.MAX_VALUE,c=Number.MIN_VALUE,l=window.devicePixelRatio;if(n.width=n.width*l,n.height=n.height*l,t.keepOriginalContentSize)return jsCommon.Utility.getAbsoluteUri(o[0].imageUrl);for(var d=0;d<o.length;d++){o[d].width>c&&(c=o[d].width,i=d);var p=o[d].width-n.width,u=o[d].height-n.height,h=Math.max(p,u);h>=0&&h<s&&(s=h,r=d)}return r===-1&&(r=i),jsCommon.Utility.getAbsoluteUri(o[r].imageUrl)}return t.image?"data:image/png;base64,"+t.image:""},o.prototype.setModelDynamicImageUrl=function(e){e.dynamicImageUrl=this.getWorkbookTileBestImageUrl(e),e.dynamicImageUrl||(e.dynamicImageUrl=e.previewImageUrl)},o.prototype.getWorkbooks=function(){return this.workbooksDeferred.promise.then((function(e){return e.workbooks}))},o.prototype.subscribe=function(e){this.workbookCollectionService.subscribe(e)},o.prototype.unsubscribe=function(e){this.workbookCollectionService.unsubscribe(e)},o.HtmlTemplateUpdate="<content-provider-local-file selected-file='localWorkbookToUpload' is-update-from-element-flow='true' ng-if='shouldReplaceLocalWorkbook' element-to-update='workbookToUpdate'></content-provider-local-file>",o.UpdateLocalWorkbookExplanation="updateLocalWorkbookExplanation",o})();t.WorkbookService=c})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(){return new i}var r=e.common.NotifyCollection;t.createWorkbookCollectionService=o;var i=(function(){function e(){this.listeners=[],this.collection=new r}return Object.defineProperty(e.prototype,"workbooks",{get:function(){return this.collection.items},set:function(e){this.collection.setItems(e)},enumerable:!0,configurable:!0}),e.prototype.getWorkbookContracts=function(){return _.map(this.workbooks,(function(e){return e.contract}))},e.prototype.addWorkbook=function(e){this.collection.addItem(e)},e.prototype.removeWorkbook=function(e,t){var o=this.collection.deleteItems((function(o){return o.id===e&&o.packageId===t}));return _.first(o)},e.prototype.onAdded=function(e){for(var t=this.listeners,o=0,r=t;o<r.length;o++){var i=r[o];i.onWorkbookAdded&&i.onWorkbookAdded(e)}},e.prototype.onDeleted=function(e){for(var t=this.listeners,o=0,r=t;o<r.length;o++){var i=r[o];i.onWorkbookDeleted&&i.onWorkbookDeleted(e)}},e.prototype.onReset=function(){for(var e=this.listeners,t=0,o=e;t<o.length;t++){var r=o[t];r.onWorkbooksReset&&r.onWorkbooksReset()}},e.prototype.subscribe=function(e){this.listeners.length<1&&this.collection.subscribe(this),this.listeners.push(e)},e.prototype.unsubscribe=function(e){_.pull(this.listeners,e),this.listeners.length<1&&this.collection.unsubscribe(this)},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){function r(e,t){return new a(e,t)}var i=e.explore.contracts.Version;o.createTileConfigUpgraderService=r;var a=(function(){function e(e,t){this.upgraders=[o.v0_1.createVersionUpgrader(),o.v1_0.createVersionUpgrader(e,t)]}return e.prototype.upgrade=function(e,o,r){if(o){var a=t.ContractUtils.convertToSemanticQueryWithDataShapeBinding(r);o&&(o.version||(o.version=i.ZeroStr));for(var n=0,s=this.upgraders;n<s.length;n++){var c=s[n];i.lt(o.version,c.version)&&c.upgrade(e,o,a)}}},e})();o.TileConfigUpgraderService=a})(o=t.upgrader||(t.upgrader={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o;!(function(t){function o(){return new r}t.createVersionUpgrader=o;var r=(function(){function t(){this.version="0.1"}return t.prototype.upgrade=function(t,o,r){if(o.version=this.version,r&&r.defn&&!r.defn.Version&&o.visual&&!_.isEmpty(o.visual.elements)&&o.visual.visual===e.visuals.plugins.scatterChart.name){var i=o.visual.elements;if(i[0].DataRoles){for(var a=i[0].DataRoles,n=!1,s=!1,c=!1,l=void 0,d=0,p=a;d<p.length;d++){var u=p[d];"Category"===u.Name&&(n=!0,l=u.Projection),s=s||"Series"===u.Name,c=c||"Size"===u.Name}c&&n&&!s&&a.push({Name:"Series",Projection:l})}}},t})()})(o=t.v0_1||(t.v0_1={}))})(o=t.upgrader||(t.upgrader={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){var r;!(function(o){function r(e,t){return new a(e,t)}var i=t.constants.upgrader;o.createVersionUpgrader=r;var a=(function(){function t(e,t){this.pluginService=e,this.telemetryService=t,this.version="1.1"}return t.prototype.upgrade=function(t,o,r){o.version=this.version;var a=o.visual||o.realTimeVisual;if(a){a.visual||this.telemetryService.logEvent(e.telemetry.TileConfigUpgradeTileConfig,i.NoVisualType);var n={stylePresetName:a.stylePresetName,visualType:a.visual},s=this.pluginService.getPlugin(a.visual),c=s&&s.capabilities.objects,l=e.data.services.DataViewObjectSerializer.deserializeObjects(a.objects,c);l&&(n.objects=l);var d={name:"tile"+t,config:{singleVisual:n}};if(r&&r.defn){var p=e.data.services.SemanticQuerySerializer.tryDeserializeQuery(r.defn);if(p){var u=p.select(),h={};a.elements||(a.elements=[]);for(var m=0,f=e.VisualElement.getDataRolesFromVisualElements(a.elements);m<f.length;m++){var v=f[m],g=u[v.Projection];if(g){var y=v.Name,b=h[y];b||(h[y]=b=new e.data.QueryProjectionCollection([])),b.all().push({queryRef:g.name}),v.isActive&&b.addActiveQueryReference(g.name)}}d.filters=e.explore.FilterUtils.deriveFromSQFilters(p.from(),p.where(),a.queryMetadata),n.query=new e.explore.contracts.VisualQuery(p.where([],new e.data.SQFrom),h)}}else delete a.transform;var S={$visualContainer:d,dataWindow:o.realTimeVisual&&o.realTimeVisual.dataWindow,elements:a.elements,heading1:a.heading1,heading2:a.heading2,heading3:a.heading3,layoutType:a.layoutType,queryMetadata:a.queryMetadata,themeName:a.themeName,transform:a.transform,$modelExtensions:a.$modelExtensions};S=_.omit(S,(function(e){return void 0===e})),o.realTimeVisual?o.realTimeVisual=S:o.visualContainer=S}},t})()})(r=o.v1_0||(o.v1_0={}))})(o=t.upgrader||(t.upgrader={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t,o=jsCommon.DateExtensions,r=jsCommon.Utility;!(function(e){function t(e){var t=r.getDateFromWcfJsonString(e,!0);return t||(t=o.parseIsoDate(e)),t}e.convertDate=t})(t=e.DateUtils||(e.DateUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o,r=t.models.AppModelIconBackgroundColors,i=jsCommon.Color,a=e.common.contracts.ContentProviderCategory,n=e.common.models.Model,s=jsCommon.Utility,c=t.models.Workbook;!(function(e){function o(e,t){var o=e.defaultContent;if(0!==e.defaultContentOption&&o)return t.getAppArtifact(e,{dashboardOriginalGUID:o.dashboardObjectId,reportOriginalGUID:o.reportObjectId,workbookID:o.workbookObjectId})}function l(e){return e&&e.category===a.OrganizationalApp}function d(e,t){var o=t.getAppInstance(e);return o&&l(o.providerContract)}function p(e){return e.category===a.OrganizationalTemplateApp||e.category===a.ServiceApp||e.category===a.Services}function u(e,t){var o=t.getAppInstance(e);return o&&p(o.providerContract)}function h(e,t,o){if(e&&e.contract){var r=e.getUniquePackageId&&e.getUniquePackageId();return f(r,t)}}function m(e,t,o){if(e)return f(e.packageId,t)}function f(e,t){if(e){var o=t.getAppInstance(e);return o&&o.providerContract.providerKey}}function v(e,t,o){var r=e.getAppInstancesForApp(o);if(!_.isEmpty(r)){var i=r[0];return i.category===a.OrganizationalApp,i.packageId}}function g(e,o){var r=t.DateUtils.convertDate(e);return r&&r.toLocaleDateString(o.currentLanguageLocale,{month:"short",day:"numeric",year:"numeric"})}function y(e){return!(e.icon||_.isEmpty(e.iconUrl)&&_.isEmpty(e.localAppLogoImageData))}function b(e,t){if(y(e)){if(e.localAppLogoImageData)return"url("+e.localAppLogoImageData+")";if(e.iconUrl){var o=e;return"url("+s.urlCombine(t.backendUri,o.iconUrl)+")"}}}function S(e){var t=_.find(r,(function(t){return t.color===e}));return t&&t.fontColor||w}function k(e){if(e){var t=.8,o=.2;return i.calculateHighlightColor(i.parseColorString(e),t,o)}}function T(e){return e instanceof n?e.dbName:e instanceof c?e.uniqueId:e.objectId}function D(e){var t=jsCommon.JsonExtensions.tryParseJSON(e.providerConfig);if(t)return t.author}var w="#FFF";e.getDefaultAppArtefact=o,e.isOrgApp=l,e.isOrgAppInstance=d,e.isParameterizedApp=p,e.isParameterizedAppInstance=u,e.getDashboardAppGUID=h,e.getResourceAppGUID=m,e.getAppGUIDByPackageId=f,e.getPackageIDByOrgAppGUID=v,e.convertDisplayDate=g,e.hasAppLogoImage=y,e.getAppLogoImageUrlStyle=b,e.getAppHeaderFontColor=S,e.getAppHeaderBackgroundColor=k,e.getAppContentModelObjectId=T,e.getAppAuthor=D})(o=t.AppUtils||(t.AppUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o,r=e.common.helpers.ModelConverterHelper,i=e.common.contracts.Permissions,a=3;!(function(e){function t(e){return(e.permissions&i.Write)===i.Write}function o(e,t,o){var i=o.featureSwitches;return _.some(e,(function(e){if(t){var o=t.findModel(e.id,e.packageId);return!!o&&r.getIsQnaSupported(o.contract,i)}return r.getIsQnaSupported(e,i)}))}function n(e,t){var o=[];if(!e)return o;var r=e.contract,i=[],a=r.modelIds;_.isEmpty(a)||(i=a.slice(0));var n=r.tiles;if(_.map(n,(function(e){null!=e.modelId&&i.push(e.modelId)})),_.isEmpty(i))return o;i=_.uniq(i);for(var s=0,c=i.length;s<c;s++){var l=_.filter(t,(function(e){return e.id===i[s]}));_.isEmpty(l)||o.push(l[0])}return o}function s(e){for(var t=[],o=1e3,r=_.sortBy(e,(function(e){var t=e.getActiveLayoutPosition();return t.y*o+t.x})),i=0,a=r;i<a.length;i++){var n=a[i],s=n.getActiveLayoutPosition();c(t,s.y,s.height)}for(var d=[],p=1e3,u=_.sortBy(e,(function(e){var t=e.getActiveLayoutPosition();return t.x*p+t.y})),h=0,m=u;h<m.length;h++){var n=m[h],s=n.getActiveLayoutPosition();c(d,s.x,s.width)}for(var f=l(t,d,r,u),v=0===f?t:d,g=0===f?u:r,y=[],b=0,S=0,k=v;S<k.length;S++){for(var T=k[S],D=b+1;D<T.startPosition;D++)y.push(void 0);for(var w=T.startPosition;w<T.startPosition+T.size;w++)y.push(T.startPosition),b=w}for(var I=_.groupBy(g,(function(e){var t=0===f?e.getActiveLayoutPosition().y:e.getActiveLayoutPosition().x;return y[t-1]})),C=[],P=0,R=v;P<R.length;P++){var T=R[P];C=C.concat(I[T.startPosition])}return _.map(C,(function(e){return e.getItem()}))}function c(e,t,o){var r=e.length,i=e[r-1];!_.isEmpty(e)&&t>=i.startPosition&&t<i.startPosition+i.size?t+o>i.startPosition+i.size&&(i.size=t+o-i.startPosition):e.push({startPosition:t,size:o})}function l(e,t,o,r){var i,a=_.max(e,(function(e){return e.size})).size,n=_.max(t,(function(e){return e.size})).size,s=_.all(e,(function(t){return t.size===e[0].size})),c=_.all(t,(function(e){return e.size===t[0].size}));return i=d(e,a,s)?0:d(t,n,c)?1:a<=n?0:1}function d(e,t,o){return e.length>1&&o&&t<=a}function p(e,t,o){if(!o||!o.tiles)return!1;switch(e){case 0:return _.any(o.tiles,(function(e){return e.hasLayoutDefinition(t)}));case 1:return _.any(o.tiles,(function(e){return e.hasLayoutPosition(t)}))}}function u(e){for(var t=[],o=0,r=e.tiles;o<r.length;o++){var i=r[o];i.hasLayoutDefinition(1)?i.shouldNewBadgeAppear=!1:(i.shouldNewBadgeAppear=!0,t.push(i.addLayout({id:1,position:null},1)))}return t}e.isWriteable=t,e.containsQnaSupportedModel=o,e.getDashboardModels=n,e.orderItems=s,e.containsLayout=p,e.markTilesAsNewIfNeeded=u})(o=t.DashboardUtils||(t.DashboardUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t,o=jsCommon.ArrayExtensions;!(function(e){function t(e,t){if(e)for(var o=e.length,r=0;r<o;r++)if(e[r].id===t)return e[r].contentProviderId;return null}function r(e){var t=i(e);if(t&&t.Commands&&t.Commands.length>0){var o=t.Commands[0].SemanticQueryDataShapeCommand;return{defn:o.Query,shape:o.Binding}}return null}function i(e){if(e&&e.modelQuery&&e.modelQuery.sq){var t;try{t=JSON.parse(e.modelQuery.sq)}catch(e){}if(t){var o=null;return c(t)?o=t.dataQuery:l(t)?o=t:d(t)&&(o={Commands:[{SemanticQueryDataShapeCommand:{Query:t.defn,Binding:t.shape}}]}),o}}}function a(e){return void 0===e&&(e={}),{layouts:[{id:0,position:e}]}}function n(e){var t=s(e,0);return t}function s(e,t){var r=o.extendWithId(e.$layoutConfig.layouts),i=r.withId(t);return i?i.position:null}function c(e){return e.dataQuery&&e.dataQuery.Commands&&e.dataQuery.Commands.length>0}function l(e){return e.Commands&&e.Commands.length>0}function d(e){return e.defn}e.findContentProviderId=t,e.convertToSemanticQueryWithDataShapeBinding=r,e.convertToTileDataQuery=i,e.createMasterLayoutConfig=a,e.getMasterLayoutPosition=n,e.getLayoutPosition=s})(t=e.ContractUtils||(e.ContractUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o,r=t.contracts,i=e.visuals.plugins,a="__default__",n=1;!(function(e){function t(e,t){void 0===t&&(t=1);var i=o[t];if(!i)return n;var s=r.TileType[e.type],c=i[s];if(!c&&e.composite){var l=e.composite;l&&(s=l.visual.type)}return i[s]||i[a]}var o={},s={};s[r.TileType[r.TileType.report]]=6,s[i.card.name]=2,s[i.animatedNumber.name]=2,s[i.textbox.name]=2,s[a]=3,o[1]=s,e.getRowSpan=t})(o=t.TileDefaultSizesUtils||(t.TileDefaultSizesUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o,r=jsCommon.JsonExtensions,i=t.contracts.TileType;!(function(o){function a(o,r,a,n,s,c,l,d,p){var u=o.realTime,m=d.execute({dataSources:u.datasources,schema:s,config:r,additionalFilters:null,dataWindow:a}),f=c.getPinData({name:"tile"+o.id,config:{singleVisual:r},layouts:void 0},e.common.contracts.TileLayoutType.Default,u.datasources,null,null,null,m,null,s);f.realTimeDataWindow=a;var v=t.models.TileFactory.createTileForPinData(l,f,n),g=v.$config;if(!g)return void p.logEvent(e.telemetry.DashboardTileError,i[i.realTime],h);g.hideTitle=o.config.hideTitle,o.config=g,o.realTime.config=g.realTimeVisual;var y=o.contract;if(y.query=v.query,y.modelId=v.modelId,o.isTemporary){var b=t.ContractUtils.getMasterLayoutPosition(y),S=t.ContractUtils.getMasterLayoutPosition(v);b.width=S.width,b.height=S.height;var k={colSpan:b.width,rowSpan:b.height};o.calculateLayout(e.common.GridLayoutConstants.getDefaultGridItemViewport(k)),o.invalidateLayout()}u.singleVisualConfig=r}function n(e){if(e){var t=e.visualContainer||e.realTimeVisual;return t&&t.$visualContainer?t.$visualContainer.config.singleVisual.visualType:void 0}}function s(e,t){return o.isScriptVisualTile(e,t)||o.reportTileContainsScriptVisuals(e,t)}function c(e,t){return e&&e.type===i.composite&&t.isScriptVisual(o.getVisualType(e.config))}function l(t,o){var r=t&&t.reportTile&&t.reportTile.exploration&&t.reportTile.exploration.sections;if(!r||t.type!==i.report)return!1;for(var a=0,n=r;a<n.length;a++)for(var s=n[a],c=0,l=s.contract.visualContainers;c<l.length;c++){var d=l[c],p=e.explore.util.VisualContainerUtils.getVisualType(d);if(p&&o&&o.isScriptVisual(p))return!0}return!1}function d(e,t){return"tile_"+e.id+"_dash_"+t}function p(e,o,r){var i,a=1,n=6,s=t.TileDefaultSizesUtils.getRowSpan(r,a),c={id:a,position:{y:e,x:o,width:n,height:s}};return i=r.addLayout(c,a),r.layoutPosition.y=e,r.layoutPosition.x=o,r.layoutPosition.height=s,r.layoutPosition.width=n,i}function u(t){var o=r.tryParseJSON(t.errorDetail);if(o&&!_.isEmpty(o.DataShapes)){var i=o.DataShapes[0]["odata.error"];if(i){var a=new e.DsrClientError(i);return a.getDetails(e.common.localize)}}}var h="Invalid tile config object";o.UpdateRealTimeTile=a,o.getVisualType=n,o.tileContainsScriptVisuals=s,o.isScriptVisualTile=c,o.reportTileContainsScriptVisuals=l,o.tileTrackerFn=d,o.createDefaultPhoneByTile=p,o.getTileErrorDetailsFromQueryResultError=u})(o=t.TileUtils||(t.TileUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o,r=e.common.contracts.ContentProviderCategory,i=jsCommon.EnumExtensions,a=t.contracts.PackageType,n=e.common.contracts.Permissions,s=e.common.contracts.PermissionArtifactType;!(function(e){function t(e,t,r,i,a,n,s,c,l){if(t=t||[],o(e,t,r,i,a,n,s,c,l)){var d=void 0;if(!_.isEmpty(e))for(var p=0,u=e;p<u.length;p++){var h=u[p];d=s.findDashboardContract(h),d&&(d.permissions=m,t=_.union(t,d.reportIds))}var f=void 0;if(!_.isEmpty(t))for(var v=0,g=t;v<g.length;v++){var y=g[v];f=n.findReportContract(y),f&&(f.permissions=m)}}}function o(e,t,o,r,i,a,n,s,d){var p=s.findPackageContract(r);return!!c(p,d)&&l(e,t,o,p.id,i,a,n)}function c(e,t){if(!e||e.packageType!==a.AppInstance)return!1;if(e.contentProviderId||e.serviceContentProviderId)return!0;var o=null;return!!e.contentProviderRefId&&(o=t.findOrganizationalContentProvider(e.contentProviderRefId),o&&o.category===r.OrganizationalTemplateApp)}function l(e,t,o,r,i,a,n){return!(_.isEmpty(e)&&_.isEmpty(t)&&_.isEmpty(o))&&(u(o,r,i)&&p(t,r,a)&&d(e,r,n))}function d(e,t,o){if(!_.isEmpty(e)){var r=_.uniq(e),i=_.filter(o.dashboards,(function(e){return e.contract&&e.contract.originalPackageId===t&&_.contains(r,e.id)}));if(_.isEmpty(i)||i.length!==r.length)return!1}return!0}function p(e,t,o){if(!_.isEmpty(e)){var r=_.uniq(e),i=_.filter(o.reports,(function(e){return e.packageId===t&&_.contains(r,e.id)}));if(_.isEmpty(i)||i.length!==r.length)return!1}return!0}function u(e,t,o){if(!_.isEmpty(e)){var r=_.uniq(e),i=_.filter(o.models,(function(e){return e.packageId===t&&_.contains(r,e.id)}));if(_.isEmpty(i)||i.length!==r.length)return!1}return!0}function h(e,t){return t===s.Workbook?i.hasFlag(e,n.ReShare):i.hasFlag(e,n.Write|n.ReShare)}var m=n.Read|n.CopyOnWrite;e.markDashboardAndReportsAsCopyableIfPartOfTemplateInstance=t,e.areArtifactsFromTemplateInstance=o,e.isPackageTemplateInstance=c,e.canReshare=h})(o=t.PermissionsUtils||(t.PermissionsUtils={}))})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){angular.module("powerbi.dataServices",[]);var o=["powerbi.common","powerbi.visualHost"];angular.module("powerbi.dataServices",o).factory("appCollection",[function(){return e.dataServices.createAppCollectionService()}]).factory("dashboardCollection",[function(){return e.dataServices.createDashboardCollectionService()}]).factory("modelCollection",[function(){return e.dataServices.createModelCollectionService()}]).factory("packageCollection",[function(){return e.dataServices.createPackageCollectionService()}]).factory("reportCollection",[function(){return e.dataServices.createReportCollectionService()}]).factory("workbookCollection",[function(){return e.dataServices.createWorkbookCollectionService()}]).factory("permissionService",["activeGroupId","impersonationService","appCollection","packageCollection","modelCollection","reportCollection","workbookCollection","dashboardCollection","telemetryService",function(t,o,r,i,a,n,s,c,l){return e.dataServices.createPermissionService(t,o,r,i,a,n,s,c,l)}]).factory("appMetadataService",["$rootScope","promiseFactory","resourcePackagesService","resourceGateService","visualPlugin","telemetryService","editableFeatureSwitchService",function(t,o,r,i,a,n,s){return e.dataServices.createAppMetadataService(t,o,r,i,a,n,s)}]).factory("modelHttpService",["syncService",function(t){return e.dataServices.createModelHttpService(t)}]).factory("reportHttpService",["syncService",function(t){return e.dataServices.createReportHttpService(t)}]).factory("workbookHttpService",["syncService",function(t){return e.dataServices.createWorkbookHttpService(t)}]).factory("dashboardHttpService",["syncService","promiseFactory","notificationToast","explorationSerializer","featureSwitchService","visualPlugin",function(t,o,r,i,a,n){return e.dataServices.createDashboardHttpService(t,o,r,i,a,n)}]).factory("reportService",["$rootScope","telemetryService","errorService","dataServiceModelMerger","dataServiceModelConverter","syncService","reportHttpService","localizationService","appMetadataService","promiseFactory","reportCollection","permissionService",function(t,o,r,i,a,n,s,c,l,d,p,u){return e.dataServices.createReportService(t,o,r,i,a,n,s,c,l,d,p,u)}]).factory("workbookService",["$rootScope","telemetryService","errorService","dataServiceModelMerger","dataServiceModelConverter","syncService","workbookHttpService","localizationService","featureSwitchService","appMetadataService","$window","promiseFactory","tutorialDataStore","$compile","localFileService","workbookCollection","permissionService",function(t,o,r,i,a,n,s,c,l,d,p,u,h,m,f,v,g){return e.dataServices.createWorkbookService(t,o,r,i,a,n,s,c,l,d,p,u,h,m,f,v,g)}]).factory("modelService",["$rootScope","telemetryService","errorService","dataServiceModelMerger","dataServiceModelConverter","syncService","modelHttpService","localizationService","reportService","appMetadataService","promiseFactory","dataProxy","modelCollection","permissionService",function(t,o,r,i,a,n,s,c,l,d,p,u,h,m){return e.dataServices.createModelService(t,o,r,i,a,n,s,c,l,d,p,u,h,m)}]).factory("dashboardDataService",["dashboardHttpService","promiseFactory","featureSwitchService","dataServiceModelMerger","modelService","dashboardCollection","$timeout",function(t,o,r,i,a,n,s){return e.dataServices.createDashboardDataService(t,o,r,i,a,n,s)}]).factory("dashboardSyncService",["$rootScope","dashboardDataService","dashboardHttpService","dataServiceModelConverter","dataServiceModelMerger","modelService","promiseFactory","reportService","resourceGateService","resourcePackageListenerService","resourcePackagesService","syncService","telemetryService","tutorialDataStore","userInfo","workbookService",function(t,o,r,i,a,n,s,c,l,d,p,u,h,m,f,v){return e.dataServices.createDashboarSyncService(t,o,r,i,a,n,s,c,l,d,p,u,h,m,f,v)}]).factory("resourcePackageListenerService",["resourcePackagesService","promiseFactory","visualPlugin",function(t,o,r){return e.dataServices.createResourcePackageListenerService(t,o,r)}]).factory("tileConfigUpgraderService",["visualPlugin","telemetryService",function(e,o){return t.upgrader.createTileConfigUpgraderService(e,o)}]).factory("dataServiceModelConverter",["geolocationService","geocoder","promiseFactory","moduleLoader","telemetryService","visualPlugin","featureSwitchService","permissionService","tileConfigUpgraderService","localizationService","explorationSerializer",function(t,o,r,i,a,n,s,c,l,d,p){return e.dataServices.models.createDataServiceModelConverter(t,a,n,e.explore.services.createVisualPluginOps(n),s,o,r,i,c,l,d,p)}]).factory("dataServiceModelMerger",["dataServiceModelConverter","permissionService",function(t,o){var r=e.dataServices.models.createDataServiceModelMerger(t,o);return t.setModelMerger(r),r}]).factory("tutorialDataStore",[function(){return t.createTutorialDataStoreService()}]).factory("packageService",["$rootScope","telemetryService","errorService","dataServiceModelMerger","dataServiceModelConverter","reportService","modelService","syncService","localizationService","appMetadataService","workbookService","appService","packageCollection","permissionService","promiseFactory",function(t,o,r,i,a,n,s,c,l,d,p,u,h,m,f){return e.dataServices.createPackageService(t,o,r,i,a,n,s,c,l,d,p,u,h,m,f)}]).factory("appService",["appMetadataService","dashboardDataService","appCollection","modelService","reportService","workbookService","promiseFactory","dataServiceModelConverter","asyncFeatureSwitchService","telemetryService","modalDialogService","errorService","localizationService","contentProviderHttpService",function(e,o,r,i,a,n,s,c,l,d,p,u,h,m){return t.createAppService(e,o,r,i,a,n,s,c,l,d,p,u,h,m)}]).factory("subscriptionsHttp",["promiseFactory","telemetryService",function(e,o){
return t.createSubscriptionsHttpService(e,o)}]).factory("mobileAuthoringService",["gridLayout","localizationService","navigation","notificationToast","telemetryService",function(t,o,r,i,a){return e.dataServices.createMobileAuthoringService(t,o,r,i,a)}]).service("resourceOwnershipService",["userInfo",e.dataServices.ResourceOwnershipService])})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e,t,r,i,a){return new o(e,t,r,i,a)}e.createAppInstanceService=t;var o=(function(){function e(e,t,o,r,i){this.app=e,this.dashboardDataService=t,this.modelService=o,this.reportService=r,this.workbookService=i}return e.prototype.getAppSyncModel=function(){if(this.app){var e=this.app.packageId,t=_.extend(this.app,{dashboards:this.dashboardDataService.findDashboardsByPackageId(e)||[],reports:this.reportService.findReportsByPackageId(e)||[],workbooks:this.workbookService.findWorkbooksByPackageId(e)||[],models:this.modelService.findModelsByPackageId(e)||[]}),o=_.map(t.dashboards,(function(e){return e.id}));null!=t.dashboardIds?this.updateArray(t.dashboardIds,o):t.dashboardIds=o;var r=_.map(t.reports,(function(e){return e.id}));null!=t.reportIds?this.updateArray(t.reportIds,r):t.reportIds=r;var i=_.map(t.models,(function(e){return e.id}));null!=t.modelIds?this.updateArray(t.modelIds,i):t.modelIds=r;var a=_.map(t.workbooks,(function(e){return e.id}));return null!=t.workbookIds?this.updateArray(t.workbookIds,a):t.workbookIds=a,t}},e.prototype.updateArray=function(e,t){e.length=0,e.push.apply(e,t)},e.prototype.subscribe=function(e){return this.unsubscribe(),this.appSyncModel=this.getAppSyncModel(),this.changeHandler=e,this.setupArtifactListeners(),this.appSyncModel},e.prototype.unsubscribe=function(){this.dashboardListener&&(this.dashboardDataService.unsubscribe(this.dashboardListener),this.dashboardListener=null),this.reportListener&&(this.reportService.unsubscribe(this.reportListener),this.reportListener=null),this.workbookListener&&(this.workbookService.unsubscribe(this.workbookListener),this.workbookListener=null),this.modelListener&&(this.modelService.unsubscribe(this.modelListener),this.modelListener=null),this.appSyncModel=null,this.changeHandler=null},e.prototype.onArtifactAdded=function(e,t,o){_.contains(t,e.id)||(t.push(e.id),o.push(e)),this.changeHandler&&this.changeHandler(e,0)},e.prototype.onArtifactDeleted=function(e,t,o){_.contains(t,e.id)&&(_.pull(t,e.id),_.pull(o,e)),this.changeHandler&&this.changeHandler(e,1)},e.prototype.setupArtifactListeners=function(){var e=this;if(this.appSyncModel){var t=this.appSyncModel,o=t.packageId;this.dashboardListener={onDashboardAdded:function(r){r.contract.originalPackageId===o&&e.onArtifactAdded(r,t.dashboardIds,t.dashboards)},onDashboardDeleted:function(r){r.contract.originalPackageId===o&&e.onArtifactDeleted(r,t.dashboardIds,t.dashboards)},onDashboardsReset:_.noop},this.dashboardDataService.subscribe(this.dashboardListener),this.reportListener={onReportAdded:function(r){r.packageId===o&&e.onArtifactAdded(r,t.reportIds,t.reports)},onReportDeleted:function(r){r.packageId===o&&e.onArtifactDeleted(r,t.reportIds,t.reports)},onReportsReset:_.noop},this.reportService.subscribe(this.reportListener),this.workbookListener={onWorkbookAdded:function(r){r.packageId===o&&e.onArtifactAdded(r,t.workbookIds,t.workbooks)},onWorkbookDeleted:function(r){r.packageId===o&&e.onArtifactDeleted(r,t.workbookIds,t.workbooks)},onWorkbooksReset:_.noop},this.workbookService.subscribe(this.workbookListener),this.modelListener={onModelAdded:function(r){r.packageId===o&&e.onArtifactAdded(r,t.modelIds,t.models)},onModelDeleted:function(r){r.packageId===o&&e.onArtifactDeleted(r,t.modelIds,t.models)},onModelsReset:_.noop},this.modelService.subscribe(this.modelListener)}},e})()})(t=e.dataServices||(e.dataServices={}))})(powerbi||(powerbi={}));;"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,a){function o(e){try{l(s.next(e))}catch(e){a(e)}}function n(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,n)}l((s=s.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return s([e,t])}}function s(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,a&&(o=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,a=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],a=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,a,o,n,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n},powerbi;!(function(e){var t;!(function(t){function i(i,r,o,n,l,c,p,d,m){var h=t.CustomerAction(i,r,o,n,l,c,p,d,m),u=a(h.info,{}),g={name:"PBI.Permissions.PlaceholderAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:s(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:u,loggers:t.PermissionsPlaceholderActionLoggers};return g}var s,r=jsCommon.Utility,a=jsCommon.UnionExtensions.mergeUnionType;s=r?r.generateGuid:Function.prototype,t.PermissionsPlaceholderAction=i})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e){return new s(e)}e.createPermissionLocalizationService=t;var i=3,s=(function(){function e(e){this.localizationService=e,this.localizationService=e}return e.prototype.getModalDialogContextInfo=function(e,t){var s="";if(!e)return s;var r=this.getArtifactType(e.type),a="",o=t.slice(0),n=o.length;if(o.sort((function(e,t){return t.displayName.localeCompare(e.displayName)})),n>i){var l=n-i;a=this.localizationService.format("PermissionCenter_RemoveAccess_MembersList",[o[0].displayName,o[1].displayName,o[2].displayName,l])}else for(var c=0;c<n;c++)a=""===a?a=o[c].displayName:c===n-1?this.localizationService.format("PermissionCenter_And",[o[c].displayName,a]):this.localizationService.format("PermissionCenter_RelatedArtifactList_PlaceHolder",[o[c].displayName,a]);return this.localizationService.format("PermissionCenter_RemoveAccess_RemoveAccessDialogText",[e.displayName,r,a])},e.prototype.getArtifactDisplayName=function(e){if(!e)return"";var t=null;switch(e.type){case 1:t=this.localizationService.get("ArtifactKind_Dashboard");break;case 3:t=this.localizationService.get("ArtifactKind_Dataset");break;case 2:t=this.localizationService.get("ArtifactKind_Report");break;case 4:t=this.localizationService.get("ArtifactKind_Workbook")}return this.localizationService.format("PermissionCenter_DisplayName_PlaceHolder",[e.displayName,t])},e.prototype.getArtifactDisplayNameWithSpace=function(e){if(!e)return"";switch(e.type){case 1:return this.localizationService.format("Dashboard_Label",[e.displayName]);case 3:return this.localizationService.format("Dataset_Label",[e.displayName]);case 2:return this.localizationService.format("Report_Label",[e.displayName]);case 4:return this.localizationService.format("Workbook_Label",[e.displayName]);default:return e.displayName}},e.prototype.getArtifactType=function(e){switch(e){case 1:return this.localizationService.get("ArtifactKind_Dashboard");case 3:return this.localizationService.get("ArtifactKind_Dataset");case 2:return this.localizationService.get("ArtifactKind_Report");case 4:return this.localizationService.get("ArtifactKind_Workbook");default:return""}},e})();e.PermissionLocalizationService=s})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t){var i=[{name:"PermissionCannotShareDialog",blockType:2,consumerHostFlags:8},{name:"PermissionCenterHome",blockType:2,consumerHostFlags:8},{name:"PermissionDeleteModalDialog",blockType:2,consumerHostFlags:8},{name:"PermissionDetails",blockType:2,consumerHostFlags:8},{name:"PermissionLockedTile",blockType:2,consumerHostFlags:40}];e.common.registerBuildingBlocksForHost(t,i,{componentsTarget:"powerbi.permissions.components",componentsMap:e.permissions.components})}angular.module("powerbi.permissions.components",[]),angular.module("powerbi.permissions.directives",[]),angular.module("powerbi.permissions",["powerbi.permissions.components","powerbi.permissions.directives","powerbi.dataServices"]).factory("permissionLocalizationService",["localizationService",function(e){return t.createPermissionLocalizationService(e)}]),t.registerBuildingBlocksForHost=i})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=4,i=3,s=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService","modalDialogService"]}},e.prototype.$onInit=function(){this.unsharableUnderlyingArtifacts=_.filter(this.artifact.underlyingArtifacts,(function(e){return 4!==(4&e.permissions)}));var e=this.artifact.inaccessibleUnderlyingArtifacts,s=this.unsharableUnderlyingArtifacts.length;s>t?(this.numberOfItemsToDisplay=i,this.moreItemsText=this.services.localizationService.format("PermissionCenter_CannotShare_NumberOfItemsLeftToDisplay",[s-i])):this.numberOfItemsToDisplay=s,_.isEmpty(e)||(this.inaccessibleItemsText=this.services.localizationService.format("PermissionCenter_CannotShare_NumberOfItemsWithNoPermissions",[e.length]))},e.prototype.close=function(){this.services.modalDialogService.close()},e.prototype.getIconClass=function(e){switch(e){case 1:return"pbi-glyph-gauge";case 3:return"pbi-glyph-database";case 2:return"pbi-glyph-barchart";case 4:return"pbi-glyph-excel"}return""},e})();e.PermissionCannotShareDialogController=s})(t=e.controllers||(e.controllers={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PermissionCannotShareDialog={templateUrl:"components/permissionCannotShareDialog/permissionCannotShareDialog.html",bindings:{artifact:"<"},controller:e.common.createController(t.controllers.PermissionCannotShareDialogController)}})(i=t.components||(t.components={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={})),define("PermissionsUI/components/permissionCannotShareDialog/permissionCannotShareDialogBuilder",["require","exports"],(function(e,t){function i(e){return new s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.createPermissionCannotShareDialogBuilder=i;var s=(function(){function e(e){this.modalDialogService=e,this.lazyModuleConfig={name:"powerbi.permissions",namespace:"powerbi.permissions",dependency:{javascript:"permissions",css:["permissions"]}}}return e.prototype.show=function(e){var t={artifact:e},i={dialogName:"CannotShare",dialogCssClass:"permissionCannotShareDialog",definitionTemplateCachePath:"components/permissionCannotShareDialog/permissionCannotShareDialogDefinition.html",bindings:t,lazyModuleDependencies:[this.lazyModuleConfig]};return this.modalDialogService.showWebModalDialog(i)},e})()}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.contracts.PermissionArtifactType,s=(function(){function t(e,t){var i=this;this.$scope=e,this.services=t,this.selectType=function(e){i.typeFilter^=e},this.$scope=e}return t.createOptions=function(){return{additionalServices:["lazy","localizationService","modalDialogService","permissionLocalizationService","promiseFactory"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e=this;return __generator(this,(function(i){switch(i.label){case 0:return this.searchInputPlaceholder=this.services.localizationService.get("PermissionCenter_SearchInputPlaceholder"),this.typeFilter=t.allTypes,this.tableConfig={data:null,hasHeader:!0,shouldHideData:function(t){return e.shouldHide(t)}},[4,this.initializeArtifacts()];case 1:return i.sent(),[2]}}))}))},t.prototype.initializeArtifacts=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){return e=[],this.assignArtifacts(e),[2]}))}))},t.prototype.assignArtifacts=function(e){this.tableConfig.data=e,this.tableConfig.filteredData=e},t.prototype.openPermissionDetails=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,s;return __generator(this,(function(r){switch(r.label){case 0:return e=t.type,i=t.objectId,[4,this.services.lazy("permissionData")];case 1:return r.sent(),[4,this.services.lazy("permissionNavigation")];case 2:return s=r.sent(),s.navigateToManagePermissions(e,i),[2]}}))}))},t.prototype.resetSelectedArtifacts=function(e){e.selected=!0;for(var t=0,i=e.ownedRelatedArtifacts;t<i.length;t++){var s=i[t];s.selected=!0}},t.prototype.shouldHide=function(e){switch(e.type){case 1:return this.shouldHideType(i.Dashboard);case 3:return this.shouldHideType(i.Dataset);case 2:return this.shouldHideType(i.Report);case 4:return this.shouldHideType(i.Workbook)}},t.prototype.shouldHideType=function(e){return 0===(this.typeFilter&e)},t.prototype.displayRemoveMemberErrorDialog=function(){var e=this.services.localizationService.get("PermissionCenter_ErrorTitle"),t=this.services.localizationService.get("PermissionCenter_ErrorMessage_RemoveMember");this.displayErrorMessageDialog(e,t)},t.prototype.displayErrorMessageDialog=function(e,t){var i=this.services.rootScope.$new(),s=[new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_GotIt"),function(e,t){i.closeDialog()})];i.message=t;var r={dialogName:e,isDismissable:!0,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogActions:s};this.services.modalDialogService.showLegacyWebModalDialog(r)},t.prototype.removeAllMembers=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,s,r,a,o=this;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.services.lazy("permissionData")];case 1:return e=n.sent(),[4,e.assembleRelatedForRelatedDataset(t)];case 2:return i=n.sent(),this.resetSelectedArtifacts(t),this.activePermissionArtifact=i,s={activePermissionArtifact:this.activePermissionArtifact,artifacts:this.tableConfig.data,removeAllMembers:!0},r={dialogName:"RemoveAccessDialog",definitionTemplateCachePath:"components/permissionDeleteModalDialog/permissionDeleteModalDialogDefinition.html",bindings:s},a=this.services.modalDialogService.showWebModalDialog(r),a.then((function(e){e&&e.errorOccured&&o.displayRemoveMemberErrorDialog()})),[2]}}))}))},t.allTypes=i.Dashboard|i.Dataset|i.Report|i.Workbook,t})();t.PermissionCenterHomeController=s})(i=t.controllers||(t.controllers={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PermissionCenterHome={templateUrl:"components/permissionCenterHome/permissionCenterHomeView.html",controller:e.common.createController(t.controllers.PermissionCenterHomeController)}})(i=t.components||(t.components={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e,t){this.services=t,this.impactedItemCount={}}return t.createOptions=function(){return{additionalServices:["lazy","modalDialogService","permissionLocalizationService","promiseFactory"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e=this,[4,this.services.lazy("permissionData")];case 1:return e.permissionDataService=t.sent(),this.selectedMembers=this.members.slice(0),_.remove(this.selectedMembers,(function(e){return!e.selected})),this.populateRelatedContentCollections(this.activePermissionArtifact.ownedRelatedArtifacts),[2]}}))}))},t.prototype.shouldShowWarningForRelatedContent=function(e){var i=this,s=this.isImpactingType(e.type)&&_.any(e.dependentArtifacts,(function(e){return!t.isSamePermissionArtifact(i.activePermissionArtifact,e)}));return s&&(this.showImpactedWarning=!0),s},t.prototype.isArtifactSelected=function(e){return e.selected},t.prototype.toggleArtifact=function(e){if(t.isSamePermissionArtifact(this.activePermissionArtifact,e))this.activePermissionArtifact.selected=!this.activePermissionArtifact.selected;else{var i=_.find(this.activePermissionArtifact.ownedRelatedArtifacts,(function(i){return t.isSamePermissionArtifact(i,e)}));i&&(i.selected=!i.selected),this.isImpactingType(i.type)&&(i.selected?this.addImpactedItems(i.dependentArtifacts):this.removeImpactedItems(i.dependentArtifacts))}},t.prototype.getModalDialogContextInfo=function(e){return this.services.permissionLocalizationService.getModalDialogContextInfo(e,this.selectedMembers)},t.prototype.confirm=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return this.removeAllMembers?[2]:[4,this.removeSelectedMembers()];case 1:return e=t.sent(),this.services.modalDialogService.close(e),[2]}}))}))},t.prototype.cancel=function(){this.services.modalDialogService.close({errorOccured:!1})},t.prototype.addImpactedItems=function(e){for(var i=0,s=e;i<s.length;i++){var r=s[i];if(!t.isSamePermissionArtifact(this.activePermissionArtifact,r))switch(r.type){case 1:this.addItem(r,this.impactedDashboards);break;case 3:this.addItem(r,this.impactedDatasets);break;case 2:this.addItem(r,this.impactedReports);break;case 4:this.addItem(r,this.impactedWorkbooks)}}},t.prototype.addItem=function(e,i){var s=_.find(i,(function(t){return t.objectId===e.objectId&&t.type===e.type}));s||(i.push(e),this.impactedItemCount[t.getImpactedItemCountKey(e)]=0),this.impactedItemCount[t.getImpactedItemCountKey(e)]++},t.prototype.removeImpactedItems=function(e){for(var t=0,i=e;t<i.length;t++){var s=i[t];switch(s.type){case 1:this.removeItem(s,this.impactedDashboards);break;case 3:this.removeItem(s,this.impactedDatasets);break;case 2:this.removeItem(s,this.impactedReports);break;case 4:this.removeItem(s,this.impactedWorkbooks)}}},t.prototype.removeItem=function(e,i){var s=_.findIndex(i,(function(t){return t.objectId===e.objectId}));s>-1&&1===this.impactedItemCount[t.getImpactedItemCountKey(e)]&&i.splice(s,1),this.impactedItemCount[t.getImpactedItemCountKey(e)]--},t.prototype.isImpactingType=function(e){return 3===e||4===e},t.prototype.populateRelatedContentCollections=function(e){this.impactedDashboards=[],this.impactedDatasets=[],this.impactedReports=[],this.impactedWorkbooks=[],this.relatedDashboards=[],this.relatedDatasets=[],this.relatedReports=[],this.relatedWorkbooks=[];for(var t=0,i=e;t<i.length;t++){var s=i[t];switch(s.type){case 1:this.relatedDashboards.push(s);break;case 3:this.relatedDatasets.push(s);break;case 2:this.relatedReports.push(s);break;case 4:this.relatedWorkbooks.push(s)}this.isImpactingType(s.type)&&s.selected&&this.addImpactedItems(s.dependentArtifacts)}},t.prototype.removeSelectedMembers=function(){var e=this,t=this.services.promiseFactory.defer(),i={errorOccured:!1},s=this.getSelectedArtifacts();return this.permissionDataService.removeMembers(s,this.selectedMembers).then((function(){_.remove(e.members,(function(t){return _.indexOf(e.selectedMembers,t)!==-1})),t.resolve(i)}),(function(e){i.errorOccured=!0,i.requestId=e.requestId,i.statusCode=e.status,t.resolve(i)})),t.promise},t.prototype.getSelectedArtifacts=function(){var e=_.filter(this.activePermissionArtifact.ownedRelatedArtifacts,(function(e){return e.selected}));return this.activePermissionArtifact.selected&&e.unshift(this.activePermissionArtifact),e},t.isSamePermissionArtifact=function(e,t){return e.objectId===t.objectId&&e.type===t.type},t.getImpactedItemCountKey=function(e){return e.type+"_"+e.id},t})();t.PermissionDeleteModalDialogController=i})(i=t.controllers||(t.controllers={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PermissionDeleteModalDialog={templateUrl:"components/permissionDeleteModalDialog/permissionDeleteModalDialog.html",bindings:{activePermissionArtifact:"<",artifacts:"<?",members:"<?",removeAllMembers:"<"},controller:e.common.createController(t.controllers.PermissionDeleteModalDialogController)}})(i=t.components||(t.components={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={})),define("PermissionsUI/components/permissionDeleteModalDialog/permissionDeleteModalDialogBuilder",["require","exports"],(function(e,t){function i(e){return new s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.createPermissionDeleteModalDialogBuilder=i;var s=(function(){function e(e){this.modalDialogService=e,this.lazyModuleConfig={name:"powerbi.permissions",namespace:"powerbi.permissions",dependency:{javascript:"permissions",css:["permissions"]}}}return e.prototype.show=function(e,t){var i={activePermissionArtifact:e,members:t,removeAllMembers:!1},s={dialogName:"RemoveAccessDialog",definitionTemplateCachePath:"components/permissionDeleteModalDialog/permissionDeleteModalDialogDefinition.html",bindings:i,lazyModuleDependencies:[this.lazyModuleConfig]};return this.modalDialogService.showWebModalDialog(s)},e})()}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e,t){var i=this;this.$scope=e,this.services=t,this.onSearchTextChange=function(){i.filterMembers(),i.updateAllSelected()},this.searchProperties=function(e){var t=e.displayName.toLocaleLowerCase(),s=i.searchTerm.toLocaleLowerCase();return!!t&&_.contains(t,s)},this.$scope=e,this.allSelected=!1,this.membersLoaded=!1,this.members=[]}return t.createOptions=function(){return{additionalServices:["dashboardDataService","lazy","localizationService","modalDialogService","permissionLocalizationService","shareSliderService"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.initializeMembers()];case 1:return e.sent(),this.createMemberAccessDropdown(),[2]}}))}))},t.prototype.initializeMembers=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i;return __generator(this,(function(s){switch(s.label){case 0:return[4,this.services.lazy("permissionData")];case 1:return e=s.sent(),[4,this.services.lazy("permissionNavigation")];case 2:return t=s.sent(),this.activePermissionArtifactType=t.permissionArtifact,this.activePermissionArtifactGUID=t.permissionArtifactGUID,i=this,[4,e.getPermissionArtifactByObjectId(this.activePermissionArtifactType,this.activePermissionArtifactGUID)];case 3:return i.activePermissionArtifact=s.sent(),this.activePermissionArtifact&&(this.assignMembers(this.activePermissionArtifact.members),this.populateRelatedContentCollections(this.activePermissionArtifact.ownedRelatedArtifacts)),this.resetSelectedMembers(),[2]}}))}))},t.prototype.isLoaded=function(){return this.membersLoaded},t.prototype.canEditAccessForMember=function(e){return!this.isOwner(e)},t.prototype.showAddUserButton=function(){return 2===this.activePermissionArtifactType||4===this.activePermissionArtifactType||3===this.activePermissionArtifactType},t.prototype.openGrantAccessPane=function(){return __awaiter(this,void 0,e.Promise,(function(){var e=this;return __generator(this,(function(t){return this.showAddUserButton()?(this.services.shareSliderService.openGrantAccessPane(this.activePermissionArtifact,(function(){return e.initializeMembers()})),[2]):[2]}))}))},t.prototype.toggleSelectAll=function(){var e=this;this.services.timeout((function(){for(var t=0,i=e.filteredMembers;t<i.length;t++){var s=i[t];e.canEditAccessForMember(s)&&(s.selected=e.allSelected)}}))},t.prototype.openRelatedArtifactDetails=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,s;return __generator(this,(function(r){switch(r.label){case 0:return e=t.type,i=t.objectId,[4,this.services.lazy("permissionNavigation")];case 1:return s=r.sent(),s.navigateToManagePermissions(e,i),[2]}}))}))},t.prototype.isSelected=function(){return!!this.activePermissionArtifact&&_.some(this.members,(function(e){return e.selected}))},t.prototype.onMemberAccessMenuItemSelected=function(t,i,s){return __awaiter(this,void 0,e.Promise,(function(){var e,s;return __generator(this,(function(r){switch(r.label){case 0:switch(i.selected||(this.resetSelectedMembers(),i.selected=!0),e=this.convertMenuActionToPermission(t),s=e){case 1:return[3,1];case 5:return[3,1];case 0:return[3,3]}return[3,5];case 1:return[4,this.updateAccess(e)];case 2:return r.sent(),[3,6];case 3:return[4,this.removeAccess()];case 4:return r.sent(),[3,6];case 5:r.label=6;case 6:return[2]}}))}))},t.prototype.updateAllSelected=function(){var e=this;this.allSelected=!_.isEmpty(this.filteredMembers)&&_.all(this.filteredMembers,(function(t){return t.selected||!e.canEditAccessForMember(t)}))},t.prototype.getMemberDisplayName=function(e){return e.tenantId?this.services.localizationService.get("PermissionCenter_EntireTenant"):e.displayName},t.prototype.getMemberEmail=function(e){return e.email?e.email:this.services.localizationService.get("PermissionCenter_Email_Placeholder")},t.prototype.getValidMenuItemsForMember=function(e){return this.canRemoveAccessForMember(e)?this.memberAccessMenuItemsDefault:this.memberAccessMenuItemsWithoutRemove},t.prototype.canRemoveAccessForMember=function(e){return!e.tenantId},t.prototype.filterMembers=function(){this.filteredMembers=_.filter(this.members,this.searchProperties);for(var e=0,t=this.members;e<t.length;e++){var i=t[e];i.selected&&!_.include(this.filteredMembers,i)&&(i.selected=!1)}},t.prototype.assignMembers=function(e){null==e?this.displayUnknownErrorDialog():(this.ensureOwnerOnFirstEntry(e),this.members=e,this.filteredMembers=e,this.membersLoaded=!0)},t.prototype.isOwner=function(e){return 7===(7&e.permission)},t.prototype.ensureOwnerOnFirstEntry=function(e){var t=this,i=_.findIndex(e,(function(e){return t.isOwner(e)}));if(0!==i){var s=e.splice(i,1)[0];e.unshift(s)}},t.prototype.convertMenuActionToPermission=function(e){switch(e.action){case 0:return 1;case 1:return 5;case 2:return 0}},t.prototype.populateRelatedContentCollections=function(e){this.relatedDashboards=[],this.relatedDatasets=[],this.relatedReports=[],this.relatedWorkbooks=[];for(var t=0,i=e;t<i.length;t++){var s=i[t];switch(s.type){case 1:this.relatedDashboards.push(s);break;case 3:this.relatedDatasets.push(s);break;case 2:this.relatedReports.push(s);break;case 4:this.relatedWorkbooks.push(s)}}},t.prototype.resetSelectedArtifacts=function(){this.activePermissionArtifact.selected=!0;for(var e=0,t=this.activePermissionArtifact.ownedRelatedArtifacts;e<t.length;e++){var i=t[e];i.selected=!1}},t.prototype.resetSelectedMembers=function(){this.activePermissionArtifact&&this.activePermissionArtifact.members&&this.activePermissionArtifact.members.forEach((function(e){e.selected=!1}))},t.prototype.createMemberAccessDropdown=function(){var e=[];e.push({text:this.services.localizationService.get("PermissionCenter_Read"),action:0,type:DropDownMenuItemType.Item}),e.push({text:this.services.localizationService.get("PermissionCenter_ReadAndReshare"),action:1,type:DropDownMenuItemType.Item}),this.memberAccessMenuItemsWithoutRemove=_.clone(e),e.push({text:this.services.localizationService.get("PermissionCenter_RemoveAccess"),action:2,type:DropDownMenuItemType.Item}),this.memberAccessMenuItemsDefault=e},t.prototype.removeAccess=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,s,r,a,o,n,l=this;return __generator(this,(function(c){switch(c.label){case 0:return[4,this.services.lazy("permissionData")];case 1:return e=c.sent(),[4,e.assembleRelatedForRelatedDataset(this.activePermissionArtifact)];case 2:for(t=c.sent(),this.resetSelectedArtifacts(),this.activePermissionArtifact=t,i=0,s=this.filteredMembers;i<s.length;i++)r=s[i],this.canRemoveAccessForMember(r)||(r.selected=!1,this.updateAllSelected());return a={activePermissionArtifact:this.activePermissionArtifact,members:this.filteredMembers,removeAllMembers:!1},o={dialogName:"RemoveAccessDialog",definitionTemplateCachePath:"components/permissionDeleteModalDialog/permissionDeleteModalDialogDefinition.html",bindings:a},n=this.services.modalDialogService.showWebModalDialog(o),n.then((function(e){e&&e.errorOccured&&l.displayRemoveMemberErrorDialog()})),[2]}}))}))},t.prototype.updateAccess=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,s,r,a,o;return __generator(this,(function(n){switch(n.label){case 0:return e=_.filter(this.filteredMembers,(function(e){return e.selected})),[4,this.services.lazy("permissionData")];case 1:i=n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,i.updateAccesses(this.activePermissionArtifact,e,t)];case 3:for(n.sent(),s=0,r=e;s<r.length;s++)a=r[s],a.permission=t;return[3,5];case 4:return o=n.sent(),this.displayUpdateAccessErrorDialog(),[3,5];case 5:return[2]}}))}))},t.prototype.displayRemoveMemberErrorDialog=function(){var e=this.services.localizationService.get("PermissionCenter_ErrorTitle"),t=this.services.localizationService.get("PermissionCenter_ErrorMessage_RemoveMember");this.displayErrorMessageDialog(e,t)},t.prototype.displayUnknownErrorDialog=function(){var e=this.services.localizationService.get("PermissionCenter_ErrorTitle"),t=this.services.localizationService.get("PermissionCenter_ErrorMessage_Generic");this.displayErrorMessageDialog(e,t)},t.prototype.displayUpdateAccessErrorDialog=function(){var e=this.services.localizationService.get("PermissionCenter_ErrorTitle"),t=this.services.localizationService.get("PermissionCenter_ErrorMessage_UpdateAccess");this.displayErrorMessageDialog(e,t)},t.prototype.displayErrorMessageDialog=function(e,t){var i=this.services.rootScope.$new(),s=[new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_GotIt"),function(e,t){i.closeDialog()})];i.message=t;var r={dialogName:e,isDismissable:!0,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogActions:s};this.services.modalDialogService.showLegacyWebModalDialog(r)},t})();t.PermissionDetailsController=i})(i=t.controllers||(t.controllers={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PermissionDetails={templateUrl:"components/permissionDetails/permissionDetailsView.html",controller:e.common.createController(t.controllers.PermissionDetailsController)}})(i=t.components||(t.components={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["$element"]}},e.prototype.$postLink=function(){var e=this.services.$element.width();e<200?this.displayMode=0:e>400?this.displayMode=2:this.displayMode=1},e})();e.PermissionLockedTileController=t})(t=e.controllers||(e.controllers={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PermissionLockedTile={templateUrl:"components/permissionLockedTile/permissionLockedTile.html",controller:e.common.createController(t.controllers.PermissionLockedTileController)}})(i=t.components||(t.components={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={})),angular.module("powerbi.permissions").run(["$templateCache",function(e){e.put("components/permissionCannotShareDialog/permissionCannotShareDialog.html",'<dialog-frame><dialog-header><span class="title" localize="PermissionCenter_UnableShare"></span></dialog-header><dialog-body><div class="cannotShareContent"><span localize="PermissionCenter_UnableShare_Message"></span><div ng-repeat="artifact in $ctrl.unsharableUnderlyingArtifacts | limitTo: $ctrl.numberOfItemsToDisplay"><span class="trimmedTextWithEllipsis" ng-bind="::artifact.displayName" localize-tooltip ng-class="$ctrl.getIconClass(artifact.type)"></span></div><span ng-if="::$ctrl.moreItemsText" ng-bind="::$ctrl.moreItemsText"></span><span ng-if="::$ctrl.inaccessibleItemsText" ng-bind="::$ctrl.inaccessibleItemsText"></span><a href="//go.microsoft.com/fwlink/?LinkID=522083" target="_blank" localize="LearnMore"></a></div></dialog-body><dialog-footer> <button type="submit" ng-click="$ctrl.close()" class="primary" localize="PBI_Button_Label_Close"></button></dialog-footer></dialog-frame>'),e.put("components/permissionCannotShareDialog/permissionCannotShareDialogDefinition.html",'<permission-cannot-share-dialog artifact="::artifact"></permission-cannot-share-dialog>'),e.put("components/permissionCenterHome/permissionCenterHomeView.html",'<div class="permissionCenter permissionCenterHome flexbox"><section class="permissionCenterBody item-fill"><section class="permissionTableAction"><div class="searchInput" localize-tooltip="SearchBox_Text"><i class="glyphicon pbi-glyph-search glyph-small searchIconLocation"></i> <input type="text" placeholder="{{::$ctrl.searchInputPlaceholder}}" ng-model="$ctrl.searchTerm"/></div><div class="right paddingTop"><div class="showingItemCount" localize="PermissionCenter_ShowingItemCount" localize-fragments><span fragment-index="0" ng-bind="filtered.length"></span></div><select-artifact-filter selected-type="$ctrl.typeFilter" on-select-type="$ctrl.selectType" class="textCapitalize"></select-artifact-filter></div></section><section class="permissionTable"><table pbi-table pbi-table-config="$ctrl.tableConfig"><tr ng-repeat="artifact in $ctrl.tableConfig.filteredData | filter: { displayName: $ctrl.searchTerm } as filtered" ng-hide="$ctrl.shouldHide(artifact)"><td localized-header="PermissionCenter_Table_Header_Name" sort-by="displayName" class="permissionArtifactAction nameColumn" ng-click="$ctrl.openPermissionDetails(artifact)"><span class="contentDisplayName trimmedTextWithEllipsis"><span ng-switch="artifact.type"><i ng-switch-when="1" class="glyphicon pbi-glyph-gauge glyph-small"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-barchart glyph-small"></i><i ng-switch-when="3" class="glyphicon pbi-glyph-database glyph-small"></i><i ng-switch-when="4" class="glyphicon pbi-glyph-excel glyph-small"></i></span><span ng-bind="artifact.displayName"></span></span></td><td localized-header="PermissionCenter_Table_Header_Type" ng-bind="artifact.typeToString" sort-by="typeToString"></td><td localized-header="PermissionCenter_Table_Header_RelatedContent" sort-by="related.length"><div localize="PermissionCenter_Table_RelatedCount" localize-fragments><span fragment-index="0" ng-bind="artifact.relatedArtifacts.length"></span></div></td><td localized-header="PermissionCenter_Table_Header_Members" sort-by="sharedWithCount"><div localize="PermissionCenter_Table_MemberCount" localize-fragments><span fragment-index="0" ng-bind="artifact.sharedWithCount"></span></div></td><td localized-header="PermissionCenter_Table_Header_Access" class="permissionArtifactAction"><div localize="PermissionCenter_Table_RemoveAll" ng-click="$ctrl.removeAllMembers(artifact)"></div></td></tr></table><div ng-show="$ctrl.tableConfig.data.length === 0" class="showNoContentText"><span localize="PermissionCenter_NoContent"></span></div></section></section></div>'),e.put("components/permissionDeleteModalDialog/permissionDeleteModalDialog.html",'<dialog-frame><dialog-header><span class="title" localize="PermissionCenter_RemoveAccess"></span></dialog-header><dialog-body><span class="textContent" ng-bind="::$ctrl.getModalDialogContextInfo($ctrl.activePermissionArtifact)"></span><div ng-if="$ctrl.activePermissionArtifact.ownedRelatedArtifacts.length> 0"><span localize="PermissionCenter_RemoveAccess_RemoveDialogText"></span><div class="textWarning" ng-if="$ctrl.showImpactedWarning"><span localize="PermissionCenter_RemoveAccess_WarningPreIcon"></span><span class="pbi-glyph-warning"></span><span localize="PermissionCenter_RemoveAccess_WarningPostIcon"></span></div><div class="relatedList" ng-if="$ctrl.activePermissionArtifact.type !==1 && $ctrl.relatedDashboards.length> 0"><span class="typeHeader" localize="NavigationPane_Dashboards_Header"></span><div ng-repeat="dashboard in $ctrl.relatedDashboards track by $index" class="pbi-input" ng-click="$ctrl.toggleArtifact(dashboard)"> <input type="checkbox" ng-checked="$ctrl.isArtifactSelected(dashboard)"/><label class="relatedItemName trimmedTextWithEllipsis" ng-bind="::dashboard.displayName" title="{{::dashboard.displayName}}"></label></div></div><div class="relatedList" ng-if="$ctrl.activePermissionArtifact.type !==2 && $ctrl.relatedReports.length> 0"><span class="typeHeader" localize="NavigationPane_Reports_Header"></span><div ng-repeat="report in $ctrl.relatedReports track by $index" class="pbi-input" ng-click="$ctrl.toggleArtifact(report)"> <input type="checkbox" ng-checked="$ctrl.isArtifactSelected(report)"/><label class="relatedItemName trimmedTextWithEllipsis" ng-bind="::report.displayName" title="{{::report.displayName}}"></label></div></div><div class="relatedList" ng-if="$ctrl.activePermissionArtifact.type !==4 && $ctrl.relatedWorkbooks.length> 0"><span class="typeHeader" localize="NavigationPane_Workbooks_Header"></span><div ng-repeat="workbook in $ctrl.relatedWorkbooks track by $index" class="pbi-input" ng-click="$ctrl.toggleArtifact(workbook)"> <input type="checkbox" ng-checked="$ctrl.isArtifactSelected(workbook)"/><label class="relatedItemName trimmedTextWithEllipsis" ng-bind="::workbook.displayName" title="{{::workbook.displayName}}"></label><i class="glyphicon pbi-glyph-warning glyph-small floatLeft" ng-if="$ctrl.shouldShowWarningForRelatedContent(workbook)"></i></div></div><div class="relatedList" ng-if="$ctrl.activePermissionArtifact.type !==3 && $ctrl.relatedDatasets.length> 0"><span class="typeHeader" localize="NavigationPane_Datasets_Header"></span><div ng-repeat="dataset in $ctrl.relatedDatasets track by $index" class="pbi-input" ng-click="$ctrl.toggleArtifact(dataset)"> <input type="checkbox" ng-checked="$ctrl.isArtifactSelected(dataset)"/><label class="relatedItemName trimmedTextWithEllipsis" ng-bind="::dataset.displayName" title="{{::dataset.displayName}}"></label><i class="glyphicon pbi-glyph-warning glyph-small floatLeft" ng-if="$ctrl.shouldShowWarningForRelatedContent(dataset)"></i></div></div><div class="impact" ng-if="$ctrl.impactedDashboards.length> 0 || $ctrl.impactedReports.length > 0 || $ctrl.impactedWorkbooks.length > 0 || $ctrl.impactedDatasets.length > 0"><span class="pbi-glyph-warning" localize="PermissionCenter_RemoveAccess_ImpactedWarning"></span><div><div ng-if="$ctrl.impactedDashboards.length> 0"><span class="typeHeader" localize="NavigationPane_Dashboards_Header"></span><span ng-repeat="dashboard in $ctrl.impactedDashboards track by dashboard.id" class="impactedItemName trimmedTextWithEllipsis" ng-bind="::dashboard.displayName" title="{{::dashboard.displayName}}"></span></div><div ng-if="$ctrl.impactedReports.length> 0"><span class="typeHeader" localize="NavigationPane_Reports_Header"></span><span ng-repeat="report in $ctrl.impactedReports track by report.id" class="impactedItemName trimmedTextWithEllipsis" ng-bind="::report.displayName" title="{{::report.displayName}}"></span></div><div ng-if="$ctrl.impactedWorkbooks.length> 0"><span class="typeHeader" localize="NavigationPane_Workbooks_Header"></span><span ng-repeat="workbook in $ctrl.impactedWorkbooks track by workbook.id" class="impactedItemName trimmedTextWithEllipsis" ng-bind="::workbook.displayName" title="{{::workbook.displayName}}"></span></div><div ng-if="$ctrl.impactedDatasets.length> 0"><span class="typeHeader" localize="NavigationPane_Datasets_Header"></span><span ng-repeat="dataset in $ctrl.impactedDatasets track by dataset.id" class="impactedItemName trimmedTextWithEllipsis" ng-bind="::dataset.displayName" title="{{::dataset.displayName}}"></span></div></div></div></div></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="$ctrl.confirm()" class="primary" localize="PermissionCenter_RemoveAccess"></button> <button ng-click="$ctrl.cancel()" localize="ModalDialog_Cancel"></button></dialog-footer></dialog-frame>'),
e.put("components/permissionDeleteModalDialog/permissionDeleteModalDialogDefinition.html",'<permission-delete-modal-dialog active-permission-artifact="activePermissionArtifact" artifacts="artifacts" members="members" remove-all-members="removeAllMembers"></permission-delete-modal-dialog>'),e.put("components/permissionDetails/permissionDetailsView.html",'<div><span class="centeredSpinner" ng-show="!$ctrl.isLoaded()"><spinner modern></spinner></span><section class="permissionCenterBody item-fill" ng-show="$ctrl.isLoaded()"><section class="permissionSidePane"><div class="permissionSidePaneTitle label-xl"><span ng-switch="$ctrl.activePermissionArtifact.type" class="permissionSidePaneTitleIcon"><i ng-switch-when="1" class="glyphicon pbi-glyph-gauge glyph-regular" localize-tooltip="Artifact_Dashboard"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-barchart glyph-regular" localize-tooltip="Artifact_Report"></i><i ng-switch-when="3" class="glyphicon pbi-glyph-database glyph-regular" localize-tooltip="Artifact_Dataset"></i><i ng-switch-when="4" class="glyphicon pbi-glyph-excel glyph-regular" localize-tooltip="Artifact_Workbook"></i></span><div ng-bind="$ctrl.activePermissionArtifact.displayName" ng-bind-attr="{title: $ctrl.activePermissionArtifact.displayName}" class="permissionSidePaneTitleText label-xxl trimmedTextWithEllipsis" localize-tooltip></div></div><div class="permissionSidePaneContent"><div localize="PermissionCenter_RelatedContent" class="subContentTitle"></div><div class="permissionSidePaneRelatedList"><div ng-if="$ctrl.activePermissionArtifact.type !== 1"><span class="relatedHeader" localize="NavigationPane_Dashboards_Header"></span><span class="emptyRelated" ng-if="$ctrl.relatedDashboards.length === 0" localize="RelatedContentBlade_NoRelated"></span> <button ng-repeat="dashboard in $ctrl.relatedDashboards track by dashboard.id" class="pbi-glyph-gauge dashboard relatedArtifact trimmedTextWithEllipsis" ng-click="$ctrl.openRelatedArtifactDetails(dashboard)" ng-bind="::dashboard.displayName" title="{{::dashboard.displayName}}"/></div><div ng-if="$ctrl.activePermissionArtifact.type !== 2"><span class="relatedHeader" localize="NavigationPane_Reports_Header"></span><span class="emptyRelated" ng-if="$ctrl.relatedReports.length === 0" localize="RelatedContentBlade_NoRelated"></span> <button ng-repeat="report in $ctrl.relatedReports track by report.id" class="pbi-glyph-barchart report relatedArtifact trimmedTextWithEllipsis" ng-click="$ctrl.openRelatedArtifactDetails(report)" ng-bind="::report.displayName" title="{{::report.displayName}}"/></div><div ng-if="$ctrl.activePermissionArtifact.type !== 4"><span class="relatedHeader" localize="NavigationPane_Workbooks_Header"></span><span class="emptyRelated" ng-if="$ctrl.relatedWorkbooks.length === 0" localize="RelatedContentBlade_NoRelated"></span> <button ng-repeat="workbook in $ctrl.relatedWorkbooks track by workbook.id" class="pbi-glyph-excel workbook relatedArtifact trimmedTextWithEllipsis" ng-click="$ctrl.openRelatedArtifactDetails(workbook)" ng-bind="::workbook.displayName" title="{{::workbook.displayName}}"/></div><div ng-if="$ctrl.activePermissionArtifact.type !== 3"><span class="relatedHeader" localize="NavigationPane_Datasets_Header"></span><span class="emptyRelated" ng-if="$ctrl.relatedDatasets.length === 0" localize="RelatedContentBlade_NoRelated"></span> <button ng-repeat="dataset in $ctrl.relatedDatasets track by dataset.id" class="pbi-glyph-database dataset relatedArtifact trimmedTextWithEllipsis" ng-click="$ctrl.openRelatedArtifactDetails(dataset)" ng-bind="::dataset.displayName" title="{{::dataset.displayName}}"/></div></div></div></section><section class="permissionContent"><section class="permissionTableAction"><search-box on-change="$ctrl.onSearchTextChange()" filter="$ctrl.searchTerm" placeholder="PermissionCenter_SearchInputPlaceholder"></search-box><div class="showingItemCount" localize="PermissionCenter_Table_MemberCount" localize-fragments><span fragment-index="0" ng-bind="$ctrl.filteredMembers.length"></span></div><pbi-button ng-if="$ctrl.showAddUserButton()" ng-click="$ctrl.openGrantAccessPane()" primary="primary" label="PermissionCenter_AddUser" localize-tooltip="PermissionCenter_AddUser"></pbi-button></section><div class="permissionTable"><div class="tableHeader"><pbi-checkbox ng-model="$ctrl.allSelected" label="member" ng-change="$ctrl.toggleSelectAll()"></pbi-checkbox><span class="nameColumn" localize="PermissionCenter_Table_Header_Name"></span><span class="emailColumn" localize="PermissionCenter_Table_Header_EmailAddress"></span><span class="memberAccessColumn" localize="PermissionCenter_Table_Header_MemberAccess"></span></div><ul><li ng-repeat="member in $ctrl.filteredMembers"><pbi-checkbox ng-model="member.selected" label="member" ng-disabled="::!$ctrl.canEditAccessForMember(member)" ng-change="$ctrl.updateAllSelected()"></pbi-checkbox><span class="pbi-glyph-user nameColumn trimmedTextWithEllipsis" ng-bind="::$ctrl.getMemberDisplayName(member)"></span><span class="emailColumn trimmedTextWithEllipsis" ng-bind="::$ctrl.getMemberEmail(member)"></span><span class="memberAccessColumn trimmedTextWithEllipsis" ng-switch="member.permission"><span ng-switch-when="1" localize="PermissionCenter_Read"></span><span ng-switch-when="5" localize="PermissionCenter_ReadAndReshare"></span><span ng-switch-when="7" localize="Sharing_Owner"></span></span> <button class="options" ng-if="::$ctrl.canEditAccessForMember(member)" dropdown-menu dropdown-class="optionDropdownButton" dropdown-dark-theme="false" dropdown-items="$ctrl.getValidMenuItemsForMember(member)" dropdown-orientation="vertical" dropdown-on-item-selected="$ctrl.onMemberAccessMenuItemSelected(selected, member, $ctrl.filteredMembers)"><i class="glyphicon moreIcon pbi-glyph-more glyph-small"></i></button></li></ul><div ng-show="$ctrl.activePermissionArtifact.members.length === 0" class="showNoMemberText"> <span>No member yet.</span></div></div></section></section></div>'),e.put("components/permissionLockedTile/permissionLockedTile.html",'<div></div><div></div><div><div ng-switch="$ctrl.displayMode"><div class="glyphicon glyph-small pbi-glyph-lock"></div><span ng-switch-when="1" localize="PermissionCenter_LockedTile_Medium"></span><span ng-switch-when="2" localize="PermissionCenter_LockedTile_Large"></span></div></div>')}]);;"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(i,r){function l(e){try{s(a.next(e))}catch(e){r(e)}}function n(e){try{s(a.throw(e))}catch(e){r(e)}}function s(e){e.done?i(e.value):new o(function(t){t(e.value)}).then(l,n)}s((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function o(e){return function(t){return a([e,t])}}function a(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(l=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(l=l.call(r,o[1])).done)return l;switch(r=0,l&&(o=[0,l.value]),o[0]){case 0:case 1:l=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(l=s.trys,!(l=l.length>0&&l[l.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!l||o[1]>l[0]&&o[1]<l[3])){s.label=o[1];break}if(6===o[0]&&s.label<l[1]){s.label=l[1],l=o;break}if(l&&s.label<l[2]){s.label=l[2],s.ops.push(o);break}l[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{i=l=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var i,r,l,n,s={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n},powerbi;!(function(e){var t;!(function(t){function o(t){var o=[{name:"ErrorDialog",blockType:2,consumerHostFlags:8},{name:"ProgressDialog",blockType:2,consumerHostFlags:8},{name:"RequestAccessDialog",blockType:2,consumerHostFlags:8},{name:"SelectDatasetDialog",blockType:2,consumerHostFlags:8}];e.common.registerBuildingBlocksForHost(t,o,{componentsTarget:"powerbi.dialogs",componentsMap:e.dialogs.components})}angular.module("powerbi.dialogs",["powerbi.common"]),t.registerBuildingBlocksForHost=o})(t=e.dialogs||(e.dialogs={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function o(o,a,i,l,s,c,d,g,u){var p=t.CustomerAction(o,a,i,l,s,c,d,g,u),m=n(p.info,{}),f={name:"PBI.CreateReportDialog.Canceled",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:r(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:m,loggers:t.CreateReportDialogCanceledLoggers};return f}function a(o,a,i,l,s,c,d,g,u,p){var m=t.CustomerAction(a,i,l,s,c,d,g,u,p),f=n(m.info,{datasetGuid:o}),h={name:"PBI.CreateReportDialog.Create",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:r(),formatted:function(){return e.extendFormatted({datasetGuid:f.datasetGuid},null,m.formatted())},info:f,loggers:t.CreateReportDialogCreateLoggers};return h}function i(o,a,i,l,s,c,d,g,u){var p=t.CustomerAction(o,a,i,l,s,c,d,g,u),m=n(p.info,{}),f={name:"PBI.CreateReportDialog.Import",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:r(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:m,loggers:t.CreateReportDialogImportLoggers};return f}var r,l=jsCommon.Utility,n=jsCommon.UnionExtensions.mergeUnionType;r=l?l.generateGuid:Function.prototype,t.CreateReportDialogCanceled=o,t.CreateReportDialogCreate=a,t.CreateReportDialogImport=i})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={})),angular.module("powerbi.dialogs").run(["$templateCache",function(e){e.put("components/errorDialog/errorDialog.html",'<dialog-frame dismissable="false"><dialog-header><header localize="$ctrl.titleKey"></header></dialog-header><dialog-body><pbi-icon name="error" size="small"></pbi-icon><label for="message" class="message" localize="$ctrl.messageKey"></label></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="$ctrl.confirm()" class="primary" localize="$ctrl.confirmKey"></button> <button ng-click="$ctrl.cancel()" localize="$ctrl.cancelKey"></button></dialog-footer></dialog-frame>'),e.put("components/errorDialog/errorDialogDefinition.html",'<error-dialog title-key="titleKey" message-key="messageKey" confirm-key="confirmKey" cancel-key="cancelKey"></error-dialog>'),e.put("components/progressDialog/progressDialog.html",'<dialog-frame dismissable="false"><dialog-header><label localize="$ctrl.titleKey"></label></dialog-header><dialog-body><span class="pbi-spinner"></span><label class="message" localize="$ctrl.messageKey"></label></dialog-body><dialog-footer> <button autofocus ng-if="::$ctrl.showCancelButton" ng-click="$ctrl.onCancel()" localize="ModalDialog_Cancel"></button></dialog-footer></dialog-frame>'),e.put("components/progressDialog/progressDialogDefinition.html",'<progress-dialog title-key="titleKey" message-key="messageKey" show-cancel-button="showCancelButton" on-cancel="onCancel()"></progress-dialog>'),e.put("components/requestAccessDialog/requestAccessDialog.html",'<dialog-frame dismissable="false"><dialog-header><header localize="$ctrl.titleKey"></header></dialog-header><dialog-body><label for="message" class="message" localize="$ctrl.messageKey"></label><textarea maxlength="1000" ng-model="$ctrl.requestAccessMessage" ng-attr-placeholder="{{::$ctrl.placeholderMessage}}"></textarea></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="$ctrl.confirm()" class="primary" localize="$ctrl.confirmKey"></button> <button ng-click="$ctrl.cancel()" localize="$ctrl.cancelKey"></button></dialog-footer></dialog-frame>'),e.put("components/requestAccessDialog/requestAccessDialogDefinition.html",'<request-access-dialog title-key="titleKey" message-key="messageKey" placeholder-key="placeholderKey" confirm-key="confirmKey" cancel-key="cancelKey"></request-access-dialog>'),e.put("components/selectDatasetDialog/selectDatasetDialog.html",'<dialog-frame><dialog-header><span localize="$ctrl.titleLabel"></span></dialog-header><dialog-body><label class="description" localize="$ctrl.descriptionLabel"></label><search-box filter="$ctrl.searchString" on-change="$ctrl.onSearchStringChanged()"></search-box><label class="error" ng-if="!$ctrl.hasModels" localize="NavigationPane_NoDatasetText"></label><div class="content" ng-if="$ctrl.hasModels"><label class="error" ng-if="$ctrl.tableConfig.filteredData.length === 0" localize="NavigationPane_NoDatasetSearchResultText"></label><table pbi-table pbi-table-config="$ctrl.tableConfig" ng-if="$ctrl.tableConfig.filteredData.length> 0"><tr ng-repeat="model in $ctrl.tableConfig.filteredData track by model.id" ng-click="$ctrl.selectModel(model)" ng-keydown="$ctrl.itemKeydown($event, model)" ng-class="{selected: $ctrl.selectedDataset.id === model.id}" tabindex="0"><td ng-bind="::model.displayName" title="{{::model.displayName}}" localized-header="CreateReport_Header_Name" sort-by="displayName"></td><td ng-bind="::$ctrl.getLastRefreshDate(model)" title="{{::$ctrl.getLastRefreshDate(model)}}" localized-header="CreateReport_Header_LastRefreshed" sort-by="lastRefreshEpochTime"></td></tr></table></div></dialog-body><dialog-footer><a href="" class="importDataset" localize="CreateReport_ImportNewDataset" ng-click="$ctrl.importDataset()"></a> <button type="submit" ng-click="$ctrl.confirm()" class="primary" ng-disabled="!$ctrl.selectedDataset" localize="$ctrl.confirmLabel"></button> <button ng-click="$ctrl.cancel()" localize="$ctrl.cancelLabel"></button></dialog-footer></dialog-frame>'),e.put("components/selectDatasetDialog/selectDatasetDialogDefinition.html",'<select-dataset-dialog title-label="titleLabel" description-label="descriptionLabel" confirm-label="confirmLabel" cancel-label="cancelLabel" models="models"></select-dataset-dialog>')}]);var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService","modalDialogService"]}},e.prototype.$onInit=function(){var e=this,t=this.services.localizationService;t.ensureLocalization((function(){return e.placeholderMessage=t.get(e.placeholderKey)}))},e.prototype.confirm=function(){this.services.modalDialogService.close({shouldRequestAccess:!0,requestAccessMessage:this.requestAccessMessage||""})},e.prototype.cancel=function(){this.services.modalDialogService.close({shouldRequestAccess:!1})},e})();e.RequestAccessDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.dialogs||(e.dialogs={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){o.RequestAccessDialog={templateUrl:"components/requestAccessDialog/requestAccessDialog.html",bindings:{titleKey:"<",messageKey:"<",placeholderKey:"<",confirmKey:"<",cancelKey:"<"},controller:e.common.createController(t.controllers.RequestAccessDialogController)}})(o=t.components||(t.components={}))})(t=e.dialogs||(e.dialogs={}))})(powerbi||(powerbi={})),define("PowerBIDialogs/components/requestAccessDialog/requestAccessDialogBuilder",["require","exports"],(function(e,t){function o(e){return new i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestAccessDialogBuilder=o;var a={name:"powerbi.dialogs",namespace:"powerbi.dialogs",dependency:{javascript:"dialogs",css:["dialogs"]}},i=(function(){function e(e){this.modalDialogService=e}return e.prototype.show=function(e,t,o,i,r,l){var n={titleKey:t,messageKey:o,placeholderKey:i,confirmKey:r,cancelKey:l},s={dialogName:e,definitionTemplateCachePath:"components/requestAccessDialog/requestAccessDialogDefinition.html",bindings:n,isDismissable:!1,lazyModuleDependencies:[a]};return this.modalDialogService.showWebModalDialog(s)},e})()}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.confirm=function(){this.services.modalDialogService.close(0)},e.prototype.cancel=function(){this.services.modalDialogService.close(1)},e})();e.ErrorDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.dialogs||(e.dialogs={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){o.ErrorDialog={templateUrl:"components/errorDialog/errorDialog.html",bindings:{titleKey:"<",messageKey:"<",confirmKey:"<",cancelKey:"<"},controller:e.common.createController(t.controllers.ErrorDialogController)}})(o=t.components||(t.components={}))})(t=e.dialogs||(e.dialogs={}))})(powerbi||(powerbi={})),define("PowerBIDialogs/components/errorDialog/errorDialogBuilder",["require","exports"],(function(e,t){function o(e){return new i(e)}Object.defineProperty(t,"__esModule",{value:!0});var a={name:"powerbi.dialogs",namespace:"powerbi.dialogs",dependency:{javascript:"dialogs",css:["dialogs"]}};t.createErrorDialogBuilder=o;var i=(function(){function e(e){this.modalDialogService=e}return e.prototype.show=function(e,t,o,i,r){var l={titleKey:t,messageKey:o,confirmKey:i,cancelKey:r},n={dialogName:e,definitionTemplateCachePath:"components/errorDialog/errorDialogDefinition.html",bindings:l,isDismissable:!1,lazyModuleDependencies:[a]};return this.modalDialogService.showWebModalDialog(n)},e})()}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.ProgressDialog={templateUrl:"components/progressDialog/progressDialog.html",bindings:{titleKey:"<",messageKey:"<",showCancelButton:"<",onCancel:"&"}}})(t=e.components||(e.components={}))})(t=e.dialogs||(e.dialogs={}))})(powerbi||(powerbi={})),define("PowerBIDialogs/components/progressDialog/progressDialogBuilder",["require","exports"],(function(e,t){function o(e,t){return new i(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.createProgressDialogBuilder=o;var a={name:"powerbi.dialogs",namespace:"powerbi.dialogs",dependency:{javascript:"dialogs",css:["dialogs"]}},i=(function(){function e(e,t){this.modalDialogService=e,this.promiseFactory=t}return e.prototype.show=function(e,t,o,i){var r=this,l=function(){return r.close(1)},n={titleKey:t,messageKey:o,showCancelButton:i,onCancel:i?l:null},s=this.promiseFactory.defer(),c=s.promise,d={dialogName:e,definitionTemplateCachePath:"components/progressDialog/progressDialogDefinition.html",bindings:n,onDialogDisplayed:s,isDismissable:!1,lazyModuleDependencies:[a]},g=this.modalDialogService.showWebModalDialog(d);return{dialogClosedPromise:g,dialogVisiblePromise:c}},e.prototype.hide=function(e){var t=this;e&&e.then((function(){return t.close(0)}))},e.prototype.close=function(e){this.modalDialogService.close(e)},e})()}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(t){var o=e.common.utils.DateFormatter,a=(jsCommon.DOMConstants,(function(){function e(e,t){this.services=t,this.hasModels=!1}return e.createOptions=function(){return{additionalServices:["localizationService","modalDialogService","modelService"]}},e.prototype.$onInit=function(){this.searchString="",this.tableConfig={data:null,hideHeader:!1},this.tableConfig.data=this.tableConfig.filteredData=this.models,this.hasModels=this.models.length>0},e.prototype.getLastRefreshDate=function(e){return o.getPrettyRelativeDate(new Date(e.lastRefreshEpochTime),this.services.localizationService)},e.prototype.selectModel=function(e){this.selectedDataset=this.selectedDataset!==e?e:null},e.prototype.itemKeydown=function(e,t){13!==e.keyCode&&32!==e.keyCode||(this.selectModel(t),e.preventDefault())},e.prototype.onSearchStringChanged=function(){var e=this.searchString.toLocaleLowerCase();this.tableConfig.filteredData=_.filter(this.tableConfig.data,(function(t){return _.contains(t.displayName.toLocaleLowerCase(),e)})),_.contains(this.tableConfig.filteredData,this.selectedDataset)||(this.selectedDataset=null)},e.prototype.confirm=function(){this.selectedDataset&&this.services.modalDialogService.close({selectedDataset:this.selectedDataset,openGetData:!1})},e.prototype.cancel=function(){this.services.modalDialogService.close({openGetData:!1})},e.prototype.importDataset=function(){this.services.modalDialogService.close({openGetData:!0})},e})());t.SelectDatasetDialogController=a})(o=t.controllers||(t.controllers={}))})(t=e.dialogs||(e.dialogs={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var o;!(function(o){o.SelectDatasetDialog={templateUrl:"components/selectDatasetDialog/selectDatasetDialog.html",bindings:{titleLabel:"<",descriptionLabel:"<",confirmLabel:"<",cancelLabel:"<",models:"<"},controller:e.common.createController(t.controllers.SelectDatasetDialogController)}})(o=t.components||(t.components={}))})(t=e.dialogs||(e.dialogs={}))})(powerbi||(powerbi={})),define("PowerBIDialogs/components/selectDatasetDialog/selectDatasetDialogBuilder",["require","exports"],(function(e,t){function o(e,t){return new a(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectDatasetDialogBuilder=o;var a=(function(){function e(e,t){this.modalDialogService=e,this.modelService=t,this.lazyModuleConfig={name:"powerbi.dialogs",namespace:"powerbi.dialogs",dependency:{javascript:"dialogs",css:["dialogs"]}}}return e.prototype.show=function(e,t,o,a,i,r){var l={titleLabel:t,descriptionLabel:o,confirmLabel:a,cancelLabel:i,models:_.filter(this.modelService.copyAndEditModels,r)},n={dialogName:e,definitionTemplateCachePath:"components/selectDatasetDialog/selectDatasetDialogDefinition.html",bindings:l,lazyModuleDependencies:[this.lazyModuleConfig]};return this.modalDialogService.showWebModalDialog(n)},e})()})),define("PowerBIDialogs/components/createReportDialog/createReportDialogBuilder",["require","exports"],(function(e,t){function o(e,t,o,a,i,r,l){return new n(e,t,o,a,i,r,l)}Object.defineProperty(t,"__esModule",{value:!0});var a=powerbi.common,i=a.contracts.Permissions,r=a.contracts.RealTimeMode,l=powerbi.telemetry;t.createReportDialogBuilder=o;var n=(function(){function e(e,t,o,a,i,r,l){this.telemetryService=e,this.navigation=t,this.permissionService=o,this.modelBelongsToUsageMetricsContentPack=a,this.modalDialogService=i,this.modelService=r,this.moduleLoader=l}return e.prototype.show=function(){return __awaiter(this,void 0,powerbi.Promise,(function(){var e,t,o,a=this;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.moduleLoader.require({javascript:"PowerBIDialogs/components/selectDatasetDialog/selectDatasetDialogBuilder"})];case 1:return e=i.sent(),t=e.createSelectDatasetDialogBuilder(this.modalDialogService,this.modelService),[4,t.show("CreateReportDialog","DashboardContextMenu_CreateReport","CreateReport_Description","CreateReport_Create","PBI_Button_Label_Close",(function(e){return a.canCreateReport(e)}))];case 2:return(o=i.sent())?(o.openGetData?(this.telemetryService.logEvent(l.CreateReportDialogImport),this.navigation.showGetDataSlider()):o.selectedDataset?(this.telemetryService.logEvent(l.CreateReportDialogCreate,o.selectedDataset.dbName),this.navigation.navigateToDataset({datasetDBName:o.selectedDataset.dbName,datasetId:o.selectedDataset.id})):this.telemetryService.logEvent(l.CreateReportDialogCanceled),[2]):(this.telemetryService.logEvent(l.CreateReportDialogCanceled),[2])}}))}))},e.prototype.canCreateReport=function(e){var t=e.realTimeMode&&(e.realTimeMode===r.CacheOnly||e.realTimeMode===r.PubNubCacheOnly);return!e.isHidden&&this.permissionService.isExplorableModel(e)&&(e.getPermissions()&i.CopyOnWrite)!==i.CopyOnWrite&&!t&&!this.modelBelongsToUsageMetricsContentPack(e)},e})()}));;"use strict";var powerbi;!(function(e){var t;!(function(t){function i(e,t){return new s(e,t)}t.createDashboardProgressTrackingService=i;var o=2e4,s=(function(){function t(e,t){this.rootScope=e,this.timeoutService=t,this.registeredCallbacks=[],this.timedOutTiles=[],this.initState()}return t.prototype.registerLoadingProgressCallback=function(e){this.registeredCallbacks.push(e)},t.prototype.unregisterLoadingProgressCallback=function(e){_.pull(this.registeredCallbacks,e)},t.prototype.shouldBeIncluded=function(e){return e.shouldBeIncludedInTelemetryMeasurement},t.prototype.startTracking=function(t){var i=this;t&&(this.unsubcribeTileRepeatFinishedEvent=this.rootScope.$on(e.common.constants.dashboardTileRepeatFinishedEvent,(function(){return i.onDashboardTileRepeatFinishedEvent()})),this.unsubscribeTileVisualLoadedEvent=this.rootScope.$on(e.common.constants.tileVisualLoadedEventName,(function(e,t){return i.onDashboardTileVisualLoadedEvent(e,t)})),this.dashboardModel=t)},t.prototype.cancelTracking=function(){this.dashboardModel&&this.completeTracking(this.dashboardModel,!0),this.dashboardModel=null},t.prototype.onDashboardTileRepeatFinishedEvent=function(){var e=this;if(this.dashboardModel){for(var t=this.dashboardModel,i=function(t){if(s.shouldBeIncluded(t)){var i=t.id;_.contains(s.tileIdsAlreadyLoaded,i)||(s.tileIdsToWait.push(i),s.cancelVisualLoadTimeout(i),s.timeOutMap[i]=s.timeoutService((function(){e.timedOutTiles.push(t),e.removeTileIdFromWaitlist(i)}),o))}},s=this,a=0,r=t.tiles;a<r.length;a++){var n=r[a];i(n)}this.tileRepeatFinishedEventRaised=!0,_.isEmpty(this.tileIdsToWait)&&this.completeTracking(this.dashboardModel,!1)}},t.prototype.removeTileIdFromWaitlist=function(e){this.tileRepeatFinishedEventRaised?_.pull(this.tileIdsToWait,e):this.tileIdsAlreadyLoaded.push(e),this.tileRepeatFinishedEventRaised&&_.isEmpty(this.tileIdsToWait)&&this.completeTracking(this.dashboardModel,!1)},t.prototype.onDashboardTileVisualLoadedEvent=function(e,t){e.stopPropagation(),this.removeTileIdFromWaitlist(t),this.cancelVisualLoadTimeout(t)},t.prototype.cancelVisualLoadTimeout=function(e){var t=this.timeOutMap[e];t&&(this.timeoutService.cancel(t),delete this.timeOutMap[e])},t.prototype.completeTracking=function(e,t){this.unsubcribeTileRepeatFinishedEvent&&this.unsubcribeTileRepeatFinishedEvent(),this.unsubcribeTileRepeatFinishedEvent&&this.unsubcribeTileRepeatFinishedEvent();for(var i={model:e,isCancelled:t,timedOutTiles:this.timedOutTiles},o=0,s=this.registeredCallbacks;o<s.length;o++){var a=s[o];a(i)}this.initState()},t.prototype.initState=function(){this.tileIdsToWait=[],this.tileIdsAlreadyLoaded=[],this.timeOutMap={},this.timedOutTiles=[],this.tileRepeatFinishedEventRaised=!1},t})()})(t=e.dashboard||(e.dashboard={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=["powerbi.common","powerbi.dataServices"];angular.module("powerbi.dashboard",i).factory("dashboardLoadingProgressTracking",["$rootScope","$timeout",function(t,i){return e.dashboard.createDashboardProgressTrackingService(t,i)}])})(t=e.dashboard||(e.dashboard={}))})(powerbi||(powerbi={}));;"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(r,a){function n(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(n,s)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return o([e,t])}}function o(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,a&&(n=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,a=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(n=c.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,a,n,s,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__extends=this&&this.__extends||(function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}})(),__assign=this&&this.__assign||Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};window.DEBUG=!1;var powerbi;!(function(e){var t;!(function(t){function i(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{show:i}),v={name:"PBI.Settings.SetShowGridlines",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({show:h.show},null,u.formatted())},info:h,loggers:t.SettingsSetShowGridlinesLoggers};return v}function o(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{snap:i}),v={name:"PBI.Settings.SetSnapToGrid",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({snap:h.snap},null,u.formatted())},info:h,loggers:t.SettingsSetSnapToGridLoggers};return v}function r(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{fromState:i,toState:o}),g={name:"PBI.Navigation.ClickBreadcrumb",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({fromState:v.fromState,toState:v.toState},null,h.formatted())},info:v,loggers:t.NavigationClickBreadcrumbLoggers};return g}function a(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{isExpanded:i}),v={name:"PBI.Navigation.Toggle",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({isExpanded:h.isExpanded},null,u.formatted())},info:h,loggers:t.NavigationToggleLoggers};return v}function n(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Navigation.ClickLogo",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.NavigationClickLogoLoggers};return h}function s(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.Verbose(a,n,s,c,l,d,p,u,h),g=ri(v.info,{numberOfDashboards:i,numberOfReports:o,numberOfWorkbooks:r}),m={name:"PBI.ContentList.ArtifactsCount",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({numberOfDashboards:g.numberOfDashboards,numberOfReports:g.numberOfReports,numberOfWorkbooks:g.numberOfWorkbooks},null,v.formatted())},info:g,loggers:t.ContentListArtifactsCountLoggers};return m}function c(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.DuplicateDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardDuplicateDashboardLoggers};return h}function l(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.DeleteDashboardUser",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardDeleteDashboardUserLoggers};return h}function d(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{dashboardGuid:i});return{info:h,formatted:function(){return e.extendFormatted({dashboardGuid:h.dashboardGuid},null,u.formatted())}}}function p(i,o,r,a,n,s,c,l,d,p){var u=t.Verbose(o,r,a,n,s,c,l,d,p),h=ri(u.info,{dashboardGuid:i});return{info:h,formatted:function(){return e.extendFormatted({dashboardGuid:h.dashboardGuid},null,u.formatted())}}}function u(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{dashboardGuid:i,tileCount:o});return{info:v,formatted:function(){return e.extendFormatted({dashboardGuid:v.dashboardGuid,tileCount:v.tileCount},null,h.formatted())}}}function h(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{favoriteId:i,groupId:o,favoriteType:r}),m={name:"PBI.Dashboard.AddFavorite",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({favoriteId:g.favoriteId,groupId:g.groupId,favoriteType:bi[g.favoriteType]},null,v.formatted())},info:g,loggers:t.DashboardAddFavoriteLoggers};return m}function v(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{favoriteObjectId:i,groupId:o,favoriteType:r}),m={name:"PBI.Dashboard.DeleteFavorite",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({favoriteObjectId:g.favoriteObjectId,groupId:g.groupId,favoriteType:bi[g.favoriteType]},null,v.formatted())},info:g,loggers:t.DashboardDeleteFavoriteLoggers};return m}function g(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{countOfFavorites:i}),v={name:"PBI.Dashboard.GetFavorites",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({countOfFavorites:h.countOfFavorites},null,u.formatted())},info:h,loggers:t.DashboardGetFavoritesLoggers};return v}function m(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{dashboardGuid:i,invitationId:o}),g={name:"PBI.Dashboard.ClaimInvitation",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({dashboardGuid:v.dashboardGuid,invitationId:v.invitationId},null,h.formatted())},info:v,loggers:t.DashboardClaimInvitationLoggers};return g}function f(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{userAgent:i,invitationId:o}),g={name:"PBI.Dashboard.ClaimInvitationRedirectToMobileLandingPage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({userAgent:v.userAgent,invitationId:v.invitationId},null,h.formatted())},info:v,loggers:t.DashboardClaimInvitationRedirectToMobileLandingPageLoggers};return g}function b(i,o,r,a,n,s,c,l,d,p,u,h,v,g){var m=t.CustomerAction(s,c,l,d,p,u,h,v,g),f=ri(m.info,{contentProviderId:i,contentProviderKey:o,contentProviderDisplayText:r,contentProviderCategory:a,autoInstall:n}),b={name:"PBI.Dashboard.ContentProviderPublish",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({contentProviderId:f.contentProviderId,contentProviderKey:f.contentProviderKey,contentProviderDisplayText:f.contentProviderDisplayText,contentProviderCategory:f.contentProviderCategory,autoInstall:f.autoInstall},null,m.formatted())},info:f,loggers:t.DashboardContentProviderPublishLoggers};return b}function y(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{DSID:i}),v={name:"PBI.Dashboard.ContentProviderPublishDSID",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({DSID:h.DSID},null,u.formatted())},info:h,loggers:t.DashboardContentProviderPublishDSIDLoggers};return v}function S(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{URL:i}),v={name:"PBI.CustomConfigHandler.SharePointDiscover",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({URL:h.URL},null,u.formatted())},info:h,loggers:t.CustomConfigHandlerSharePointDiscoverLoggers};return v}function w(i,o,r,a,n,s,c,l,d,p,h){var v=u(i,o,r,a,n,s,c,l,d,p,h),g=ri(v.info,{}),m={name:"PBI.Dashboard.DeleteDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:g,loggers:t.DashboardDeleteDashboardLoggers};return m}function D(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.DeleteTile",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardDeleteTileLoggers};return h}function C(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{downloadReferrer:i}),v={name:"PBI.Dashboard.DownloadIOSApp",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({downloadReferrer:h.downloadReferrer},null,u.formatted())},info:h,loggers:t.DashboardDownloadIOSAppLoggers};return v}function T(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{downloadReferrer:i}),v={name:"PBI.Dashboard.DownloadCompanionApp",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({downloadReferrer:h.downloadReferrer},null,u.formatted())},info:h,loggers:t.DashboardDownloadCompanionAppLoggers};return v}function I(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{downloadReferrer:i}),v={name:"PBI.Dashboard.DownloadExcelPublisher",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({downloadReferrer:h.downloadReferrer},null,u.formatted())},info:h,loggers:t.DashboardDownloadExcelPublisherLoggers};return v}function k(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{downloadReferrer:i}),v={name:"PBI.Dashboard.DownloadGateways",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({downloadReferrer:h.downloadReferrer},null,u.formatted())},info:h,loggers:t.DashboardDownloadGatewaysLoggers};return v}function M(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{tilesChanged:i}),v={name:"PBI.Dashboard.TileLayoutChanged",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({tilesChanged:h.tilesChanged},null,u.formatted())},info:h,loggers:t.DashboardTileLayoutChangedLoggers};return v}function P(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{tileId:i,workbookId:o,packageId:r}),m={name:"PBI.Dashboard.InFocusWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({tileId:g.tileId,workbookId:g.workbookId,packageId:g.packageId},null,v.formatted())},info:g,loggers:t.DashboardInFocusWorkbookLoggers};return m}function E(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.ReloadWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardReloadWorkbookLoggers};return h}function A(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.CalculateWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardCalculateWorkbookLoggers};return h}function x(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{contentEdited:i}),v={name:"PBI.InFocusMode.SaveTileProperties",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({contentEdited:h.contentEdited},null,u.formatted())},info:h,loggers:t.InFocusModeSaveTilePropertiesLoggers};return v}function R(i,o,r,a,n,s,c,l,p,u){var h=d(i,o,r,a,n,s,c,l,p,u),v=ri(h.info,{}),g={name:"PBI.Dashboard.ExportDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:v,loggers:t.DashboardExportDashboardLoggers};return g}function _(t,i,o,r,a,n,s,c,l,p,u,h){var v=d(o,r,a,n,s,c,l,p,u,h),g=ri(v.info,{originalDashboardGuid:t,appGuid:i});return{info:g,formatted:function(){return e.extendFormatted({originalDashboardGuid:g.originalDashboardGuid,appGuid:g.appGuid},null,v.formatted())}}}function F(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C,T,I,k,M,P,E,A,x,R){var F=_(w,D,C,T,I,k,M,P,E,A,x,R),N=ri(F.info,{hasResourcePackages:i,hasOnPremiseModel:o,compositeTilesCount:r,iframeTilesCount:a,imageTilesCount:n,modelTilesCount:s,ssrsTilesCount:c,workbookTilesCount:l,reportTilesCount:d,workbookTileNoImage:p,otherTileTypes:u,realTimeTilesCount:h,source:v,groupObjectId:g,isReadonlyGroup:m,permissions:f,usageMetricsTilesCount:b,CompoundTileTypesAndCounts:y,scrubUserInfo:S}),L={name:"PBI.Dashboard.OpenDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({hasResourcePackages:N.hasResourcePackages,hasOnPremiseModel:N.hasOnPremiseModel,compositeTilesCount:N.compositeTilesCount,iframeTilesCount:N.iframeTilesCount,imageTilesCount:N.imageTilesCount,modelTilesCount:N.modelTilesCount,ssrsTilesCount:N.ssrsTilesCount,workbookTilesCount:N.workbookTilesCount,reportTilesCount:N.reportTilesCount,workbookTileNoImage:N.workbookTileNoImage,otherTileTypes:N.otherTileTypes,realTimeTilesCount:N.realTimeTilesCount,source:Pi[N.source],permissions:N.permissions,usageMetricsTilesCount:N.usageMetricsTilesCount,CompoundTileTypesAndCounts:N.CompoundTileTypesAndCounts},{groupObjectId:N.groupObjectId,isReadonlyGroup:N.isReadonlyGroup,scrubUserInfo:N.scrubUserInfo},F.formatted())},info:N,loggers:t.DashboardOpenDashboardLoggers};return L}function N(i,o,r,a,n,s,c,l,d,p){var u=t.Verbose(o,r,a,n,s,c,l,d,p),h=ri(u.info,{tileCount:i}),v={name:"PBI.Dashboard.LoadDashboardTileVisual",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({tileCount:h.tileCount},null,u.formatted())},info:h,loggers:t.DashboardLoadDashboardTileVisualLoggers};return v}function L(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b){var y=t.CustomerAction(d,p,u,h,v,g,m,f,b),S=ri(y.info,{visualType:i,source:o,reason:r,unsupportedVisualPinned:a,contentProviderType:n,isCustomVisual:s,widgetType:c,reportPageContainsScriptVisuals:l}),w={name:"PBI.Dashboard.PinTile",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({visualType:S.visualType,source:ni[S.source],reason:S.reason,unsupportedVisualPinned:S.unsupportedVisualPinned,contentProviderType:S.contentProviderType,isCustomVisual:S.isCustomVisual,widgetType:S.widgetType,reportPageContainsScriptVisuals:S.reportPageContainsScriptVisuals},null,y.formatted())},info:S,loggers:t.DashboardPinTileLoggers};return w}function O(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.Verbose(a,n,s,c,l,d,p,u,h),g=ri(v.info,{errorReason:i,userSwitchedGroups:o,userIsBrowsingArchivedContent:r}),m={name:"PBI.Dashboard.InitializeContainer",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({errorReason:g.errorReason,userSwitchedGroups:g.userSwitchedGroups,userIsBrowsingArchivedContent:g.userIsBrowsingArchivedContent},null,v.formatted())},info:g,loggers:t.DashboardInitializeContainerLoggers};return m}function G(i,o,r,a,n,s,c,l,d,p){var u=t.Verbose(o,r,a,n,s,c,l,d,p),h=ri(u.info,{name:i}),v={name:"PBI.Dashboard.InitializeContentProviderConfig",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({name:h.name},null,u.formatted())},info:h,loggers:t.DashboardInitializeContentProviderConfigLoggers};return v}function U(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{dashboardObjectId:i,messageLength:o,isDefaultMessage:r}),m={name:"PBI.Dashboard.RequestDashboardAccess",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({dashboardObjectId:g.dashboardObjectId,messageLength:g.messageLength,isDefaultMessage:g.isDefaultMessage},null,v.formatted())},info:g,loggers:t.DashboardRequestDashboardAccessLoggers};return m}function z(i,o,r,a,n,s,c,l,d,p,u,h,v,g){var m=t.CustomerAction(s,c,l,d,p,u,h,v,g),f=ri(m.info,{tileType:i,tileId:o,reason:r,contentProviderId:a,contentProviderDisplayText:n}),b={name:"PBI.Dashboard.OpenTile",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({tileType:ai[f.tileType],tileId:f.tileId,reason:f.reason,contentProviderId:f.contentProviderId,contentProviderDisplayText:f.contentProviderDisplayText},null,m.formatted())},info:f,loggers:t.DashboardOpenTileLoggers};return b}function B(i,o,r,a,n,s,c,l,d,p,u){var h=t.Verbose(r,a,n,s,c,l,d,p,u),v=ri(h.info,{settingGroupTypeChangedFrom:i,settingGroupTypeChangedTo:o}),g={name:"PBI.Dashboard.SettingGroupChanged",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({settingGroupTypeChangedFrom:v.settingGroupTypeChangedFrom,settingGroupTypeChangedTo:v.settingGroupTypeChangedTo},null,h.formatted())},info:v,loggers:t.DashboardSettingGroupChangedLoggers};return g}function W(i,o,r,a,n,s,c,l,p,u,h){var v=d(o,r,a,n,s,c,l,p,u,h),g=ri(v.info,{tileCount:i}),m={name:"PBI.Dashboard.RenameDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({tileCount:g.tileCount},null,v.formatted())},info:g,loggers:t.DashboardRenameDashboardLoggers};return m}function V(i,o,r,a,n,s,c,l,d,p,u,h,v){var g=t.CustomerAction(n,s,c,l,d,p,u,h,v),m=ri(g.info,{etagHash:i,permissions:o,storageProvider:r,contentProvider:a}),f={name:"PBI.Dashboard.ViewWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({etagHash:m.etagHash,permissions:m.permissions,storageProvider:m.storageProvider,contentProvider:m.contentProvider},null,g.formatted())},info:m,loggers:t.DashboardViewWorkbookLoggers};return f}function $(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.WorkbookEditedInPowerBICausedPinBlock",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardWorkbookEditedInPowerBICausedPinBlockLoggers};return h}function H(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{etagHash:i}),v={name:"PBI.Dashboard.EditWorkbook",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({etagHash:h.etagHash},null,u.formatted())},info:h,loggers:t.DashboardEditWorkbookLoggers};return v}function j(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{etagHash:i}),v={name:"PBI.Dashboard.WorkbookViewedExternallyDueToAnError",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({etagHash:h.etagHash},null,u.formatted())},info:h,loggers:t.DashboardWorkbookViewedExternallyDueToAnErrorLoggers};return v}function q(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{from:i,to:o}),g={name:"PBI.Dashboard.SwitchView",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({from:v.from,to:v.to},null,h.formatted())},info:v,loggers:t.DashboardSwitchViewLoggers};return g}function Q(i,o,r,a,n,s,c,l,d,p){var u=t.Verbose(o,r,a,n,s,c,l,d,p),h=ri(u.info,{dashboardGuid:i}),v={name:"PBI.Dashboard.UpdateActiveDashboard",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({dashboardGuid:h.dashboardGuid},null,u.formatted())},info:h,loggers:t.DashboardUpdateActiveDashboardLoggers};return v}function K(i,o,r,a,n,s,c,l,d,p){var u=t.Verbose(o,r,a,n,s,c,l,d,p),h=ri(u.info,{dashboardGuid:i}),v={name:"PBI.Dashboard.RefreshTileData",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({dashboardGuid:h.dashboardGuid},null,u.formatted())},info:h,loggers:t.DashboardRefreshTileDataLoggers};return v}function J(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{homeDashboardId:i}),v={name:"PBI.Dashboard.SetHomeDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({homeDashboardId:h.homeDashboardId},null,u.formatted())},info:h,loggers:t.DashboardSetHomeDashboardLoggers};return v}function X(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{homeDashboardId:i}),v={name:"PBI.Dashboard.DisableHomeDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({homeDashboardId:h.homeDashboardId},null,u.formatted())},info:h,loggers:t.DashboardDisableHomeDashboardLoggers};return v}function Y(i,o,r,a,n,s,c,l,d,p,u,h,v){var g=t.CustomerAction(n,s,c,l,d,p,u,h,v),m=ri(g.info,{dashboardGuid:i,totalTiles:o,numberOfScriptTiles:r,numberOfliveReportsWithR:a}),f={name:"PBI.Dashboard.RefreshDashboardTiles",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({dashboardGuid:m.dashboardGuid,totalTiles:m.totalTiles,numberOfScriptTiles:m.numberOfScriptTiles,numberOfliveReportsWithR:m.numberOfliveReportsWithR},null,g.formatted())},info:m,loggers:t.DashboardRefreshDashboardTilesLoggers};return f}function Z(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{groupObjectId:i}),v={name:"PBI.Groups.SwitchGroup",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({groupObjectId:h.groupObjectId},null,u.formatted())},info:h,loggers:t.GroupsSwitchGroupLoggers};return v}function ee(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{key:i}),v={name:"PBI.Dashboard.ShowGettingStartedPopup",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({key:h.key},null,u.formatted())},info:h,loggers:t.DashboardShowGettingStartedPopupLoggers};return v}function te(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{providerId:i});return{info:h,formatted:function(){return e.extendFormatted({providerId:h.providerId},null,u.formatted())}}}function ie(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.ManageDatasetsLanding",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardManageDatasetsLandingLoggers};return h}function oe(i,o,r,a,n,s,c,l,d,p){var u=te(i,o,r,a,n,s,c,l,d,p),h=ri(u.info,{}),v={name:"PBI.Dashboard.DatasetClickScheduleRefresh",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,u.formatted())},info:h,loggers:t.DashboardDatasetClickScheduleRefreshLoggers};return v}function re(i,o,r,a,n,s,c,l,d,p){var u=te(i,o,r,a,n,s,c,l,d,p),h=ri(u.info,{}),v={name:"PBI.Dashboard.WorkbookClickScheduleRefresh",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,u.formatted())},info:h,loggers:t.DashboardWorkbookClickScheduleRefreshLoggers};return v}function ae(i,o,r,a,n,s,c,l,d,p){var u=te(i,o,r,a,n,s,c,l,d,p),h=ri(u.info,{}),v={name:"PBI.Dashboard.DatasetClickRefreshNow",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,u.formatted())},info:h,loggers:t.DashboardDatasetClickRefreshNowLoggers};return v}function ne(i,o,r,a,n,s,c,l,d,p){var u=te(i,o,r,a,n,s,c,l,d,p),h=ri(u.info,{}),v={name:"PBI.Dashboard.WorkbookClickRefreshNow",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,u.formatted())},info:h,loggers:t.DashboardWorkbookClickRefreshNowLoggers};return v}function se(i,o,r,a,n,s,c,l,d,p){var u=te(i,o,r,a,n,s,c,l,d,p),h=ri(u.info,{}),v={name:"PBI.Dashboard.DatasetClickDelete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,u.formatted())},info:h,loggers:t.DashboardDatasetClickDeleteLoggers};return v}function ce(i,o,r,a,n,s,c,l,d,p){var u=te(i,o,r,a,n,s,c,l,d,p),h=ri(u.info,{}),v={name:"PBI.Dashboard.DatasetClickInsights",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,u.formatted())},info:h,loggers:t.DashboardDatasetClickInsightsLoggers};return v}function le(i,o,r,a,n,s,c,l,d,p){var u=te(i,o,r,a,n,s,c,l,d,p),h=ri(u.info,{}),v={name:"PBI.Dashboard.DatasetClickRename",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,u.formatted())},info:h,loggers:t.DashboardDatasetClickRenameLoggers};return v}function de(i,o,r,a,n,s,c,l,d,p){var u=te(i,o,r,a,n,s,c,l,d,p),h=ri(u.info,{}),v={name:"PBI.Dashboard.ClickPersonalize",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,u.formatted())},info:h,loggers:t.DashboardClickPersonalizeLoggers};return v}function pe(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{action:i}),v={name:"PBI.Dashboard.ExpandCollapseNavigatorPane",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({action:ci[h.action]},null,u.formatted())},info:h,loggers:t.DashboardExpandCollapseNavigatorPaneLoggers};return v}function ue(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{interaction:i}),v={name:"PBI.Dashboard.OpenGetDataPage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({interaction:li[h.interaction]},null,u.formatted())},info:h,loggers:t.DashboardOpenGetDataPageLoggers};return v}function he(i,o,r,a,n,s,c,l,d,p,u,h,v,g){var m=t.CustomerAction(s,c,l,d,p,u,h,v,g),f=ri(m.info,{action:i,section:o,numDashboards:r,numReports:a,numDatasets:n}),b={name:"PBI.Dashboard.ExpandCollapseNavigatorPaneSection",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({action:ci[f.action],section:ui[f.section],numDashboards:f.numDashboards,numReports:f.numReports,numDatasets:f.numDatasets},null,m.formatted())},info:f,loggers:t.DashboardExpandCollapseNavigatorPaneSectionLoggers};return b}function ve(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{numDashboards:i,numReports:o,numDatasets:r}),m={name:"PBI.Dashboard.FilterNavigatorPaneItems",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({numDashboards:g.numDashboards,numReports:g.numReports,numDatasets:g.numDatasets},null,v.formatted())},info:g,loggers:t.DashboardFilterNavigatorPaneItemsLoggers};return m}function ge(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.GetGroups",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardGetGroupsLoggers};return h}function me(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b){var y=t.CustomerAction(d,p,u,h,v,g,m,f,b),S=ri(y.info,{isUpdateContentPack:i,numberOfDashboards:o,numberOfReports:r,numberOfModels:a,numberOfWorkbooks:n,isMyWorkspace:s,numberOfGroupsSharedTo:c,isUserError:l}),w={name:"PBI.Dashboard.ContentPackPublish",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({isUpdateContentPack:S.isUpdateContentPack,numberOfDashboards:S.numberOfDashboards,numberOfReports:S.numberOfReports,numberOfModels:S.numberOfModels,numberOfWorkbooks:S.numberOfWorkbooks,isMyWorkspace:S.isMyWorkspace,numberOfGroupsSharedTo:S.numberOfGroupsSharedTo,isUserError:S.isUserError},null,y.formatted())},info:S,loggers:t.DashboardContentPackPublishLoggers};return w}function fe(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{numberOfContentPacksDirty:i}),v={name:"PBI.Dashboard.ContentPackDirty",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({numberOfContentPacksDirty:h.numberOfContentPacksDirty},null,u.formatted())},info:h,loggers:t.DashboardContentPackDirtyLoggers};return v}function be(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m){var f=t.CustomerAction(c,l,d,p,u,h,v,g,m),b=ri(f.info,{isSharedWithEntireOrganization:i,numberOfDashboards:o,numberOfReports:r,numberOfModels:a,numberOfWorkbooks:n,numberOfGroupsSharedTo:s}),y={name:"PBI.Dashboard.DeleteContentPack",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({isSharedWithEntireOrganization:b.isSharedWithEntireOrganization,numberOfDashboards:b.numberOfDashboards,numberOfReports:b.numberOfReports,numberOfModels:b.numberOfModels,numberOfWorkbooks:b.numberOfWorkbooks,numberOfGroupsSharedTo:b.numberOfGroupsSharedTo},null,f.formatted())},info:b,loggers:t.DashboardDeleteContentPackLoggers};return y}function ye(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.DeleteTemplateOrganizationApp",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardDeleteTemplateOrganizationAppLoggers};return h}function Se(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.ViewContentPacks",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardViewContentPacksLoggers};return h}function we(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.ContentPackPersonalize",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardContentPackPersonalizeLoggers};return h}function De(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={
name:"PBI.Dashboard.FirstUse",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardFirstUseLoggers};return h}function Ce(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.WorkbookPinabilityShown",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardWorkbookPinabilityShownLoggers};return h}function Te(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{state:i}),v={name:"PBI.Dashboard.GetDataSplash",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({state:di[h.state]},null,u.formatted())},info:h,loggers:t.DashboardGetDataSplashLoggers};return v}function Ie(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{categoryName:i,interaction:o,prevCategoryName:r}),m={name:"PBI.Dashboard.GetDataCategorySelect",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({categoryName:g.categoryName,interaction:pi[g.interaction],prevCategoryName:g.prevCategoryName},null,v.formatted())},info:g,loggers:t.DashboardGetDataCategorySelectLoggers};return m}function ke(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{tileType:i}),v={name:"PBI.Dashboard.InFocusModeSelected",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({tileType:h.tileType},null,u.formatted())},info:h,loggers:t.DashboardInFocusModeSelectedLoggers};return v}function Me(i,o,r,a,n,s,c,l,p,u,h,v,g){var m=d(a,n,s,c,l,p,u,h,v,g),f=ri(m.info,{dataClassificationUpdated:i,qnaEnabledUpdated:o,gravityEnabledUpdated:r}),b={name:"PBI.Dashboard.SaveDashboardSettings",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({dataClassificationUpdated:f.dataClassificationUpdated,qnaEnabledUpdated:f.qnaEnabledUpdated,gravityEnabledUpdated:f.gravityEnabledUpdated},null,m.formatted())},info:f,loggers:t.DashboardSaveDashboardSettingsLoggers};return b}function Pe(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.InitializeSettingsDashboardsModel",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardInitializeSettingsDashboardsModelLoggers};return h}function Ee(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.TestDataSourceConnection",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardTestDataSourceConnectionLoggers};return h}function Ae(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.GetRefreshHistoriesOnRefreshFailures",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardGetRefreshHistoriesOnRefreshFailuresLoggers};return h}function xe(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{tileId:i,modelId:o}),g={name:"PBI.Dashboard.LoadTileData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({tileId:v.tileId,modelId:v.modelId},null,h.formatted())},info:v,loggers:t.DashboardLoadTileDataLoggers};return g}function Re(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{selectedFilter:i,isMyWorkspace:o}),g={name:"PBI.Dashboard.OwnershipFilterSelected",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({selectedFilter:v.selectedFilter,isMyWorkspace:v.isMyWorkspace},null,h.formatted())},info:v,loggers:t.DashboardOwnershipFilterSelectedLoggers};return g}function _e(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{initialState:i,finalState:o}),g={name:"PBI.App.InitialAppLoad",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({initialState:v.initialState,finalState:v.finalState},null,h.formatted())},info:v,loggers:t.AppInitialAppLoadLoggers};return g}function Fe(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.GroupEditor.GetGroupMembers",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.GroupEditorGetGroupMembersLoggers};return h}function Ne(i,o,r,a,n,s,c,l,d,p,u,h,v,g){var m=t.CustomerAction(s,c,l,d,p,u,h,v,g),f=ri(m.info,{groupUpdated:i,groupId:o,isGroupReadOnly:r,adminCount:a,memberCount:n}),b={name:"PBI.GroupEditor.UserLeaveGroup",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({groupUpdated:f.groupUpdated,groupId:f.groupId,isGroupReadOnly:f.isGroupReadOnly,adminCount:f.adminCount,memberCount:f.memberCount},null,m.formatted())},info:f,loggers:t.GroupEditorUserLeaveGroupLoggers};return b}function Le(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{interaction:i,context:o}),g={name:"PBI.Quota.OpenManageStoragePage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({interaction:hi[v.interaction],context:vi[v.context]},null,h.formatted())},info:v,loggers:t.QuotaOpenManageStoragePageLoggers};return g}function Oe(i,o,r,a,n,s,c,l,d,p,u,h,v,g){var m=t.CustomerAction(s,c,l,d,p,u,h,v,g),f=ri(m.info,{isPremiumUser:i,context:o,ownedUsageInMB:r,sharedUsageInMB:a,quotaLimitInMB:n}),b={name:"PBI.Quota.StorageUsage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({isPremiumUser:f.isPremiumUser,context:vi[f.context],ownedUsageInMB:f.ownedUsageInMB,sharedUsageInMB:f.sharedUsageInMB,quotaLimitInMB:f.quotaLimitInMB},null,m.formatted())},info:f,loggers:t.QuotaStorageUsageLoggers};return b}function Ge(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f){var b=t.CustomerAction(l,d,p,u,h,v,g,m,f),y=ri(b.info,{isPremiumUser:i,context:o,itemType:r,sizeInMBToDelete:a,ownedUsageInMB:n,sharedUsageInMB:s,quotaLimitInMB:c}),S={name:"PBI.Quota.ManageStorageDelete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({isPremiumUser:y.isPremiumUser,context:vi[y.context],itemType:mi[y.itemType],sizeInMBToDelete:y.sizeInMBToDelete,ownedUsageInMB:y.ownedUsageInMB,sharedUsageInMB:y.sharedUsageInMB,quotaLimitInMB:y.quotaLimitInMB},null,b.formatted())},info:y,loggers:t.QuotaManageStorageDeleteLoggers};return S}function Ue(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m){var f=t.CustomerAction(c,l,d,p,u,h,v,g,m),b=ri(f.info,{isPremiumUser:i,context:o,operation:r,ownedUsageInMB:a,sharedUsageInMB:n,quotaLimitInMB:s}),y={name:"PBI.Quota.Exceeded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({isPremiumUser:b.isPremiumUser,context:vi[b.context],operation:fi[b.operation],ownedUsageInMB:b.ownedUsageInMB,sharedUsageInMB:b.sharedUsageInMB,quotaLimitInMB:b.quotaLimitInMB},null,f.formatted())},info:b,loggers:t.QuotaExceededLoggers};return y}function ze(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{interaction:i}),v={name:"PBI.OpenUpgradeAccountPage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({interaction:gi[h.interaction]},null,u.formatted())},info:h,loggers:t.OpenUpgradeAccountPageLoggers};return v}function Be(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Privacy.InitializeSettingsModel",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.PrivacyInitializeSettingsModelLoggers};return h}function We(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Privacy.SaveSettingsModel",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.PrivacySaveSettingsModelLoggers};return h}function Ve(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{esriEnabled:i}),v={name:"PBI.Settings.EsriSaveModel",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({esriEnabled:h.esriEnabled},null,u.formatted())},info:h,loggers:t.SettingsEsriSaveModelLoggers};return v}function $e(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Settings.DeleteAllDatasources",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.SettingsDeleteAllDatasourcesLoggers};return h}function He(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Settings.TakeoverDatasources",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.SettingsTakeoverDatasourcesLoggers};return h}function je(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Privacy.SendPowerBIEmail",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.PrivacySendPowerBIEmailLoggers};return h}function qe(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{locale:i}),v={name:"PBI.Locale.SaveLocaleSetting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({locale:h.locale},null,u.formatted())},info:h,loggers:t.LocaleSaveLocaleSettingLoggers};return v}function Qe(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Settings.LoadSettingsData",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.SettingsLoadSettingsDataLoggers};return h}function Ke(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{startingState:i}),v={name:"PBI.Settings.EnterFullScreen",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({startingState:h.startingState},null,u.formatted())},info:h,loggers:t.SettingsEnterFullScreenLoggers};return v}function Je(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m){var f=t.CustomerAction(c,l,d,p,u,h,v,g,m),b=ri(f.info,{groupObjectId:i,dashboardObjectId:o,tileObjectId:r,appId:a,originalDashboardObjectId:n,originalTileObjectId:s}),y={name:"PBI.QRCode.QRCodeDialogShown",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({groupObjectId:b.groupObjectId,dashboardObjectId:b.dashboardObjectId,tileObjectId:b.tileObjectId,appId:b.appId,originalDashboardObjectId:b.originalDashboardObjectId,originalTileObjectId:b.originalTileObjectId},null,f.formatted())},info:b,loggers:t.QRCodeQRCodeDialogShownLoggers};return y}function Xe(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m){var f=t.CustomerAction(c,l,d,p,u,h,v,g,m),b=ri(f.info,{groupObjectId:i,dashboardObjectId:o,tileObjectId:r,appId:a,originalDashboardObjectId:n,originalTileObjectId:s}),y={name:"PBI.QRCode.ShortUrlCreated",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({groupObjectId:b.groupObjectId,dashboardObjectId:b.dashboardObjectId,tileObjectId:b.tileObjectId,appId:b.appId,originalDashboardObjectId:b.originalDashboardObjectId,originalTileObjectId:b.originalTileObjectId},null,f.formatted())},info:b,loggers:t.QRCodeShortUrlCreatedLoggers};return y}function Ye(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f){var b=t.CustomerAction(l,d,p,u,h,v,g,m,f),y=ri(b.info,{groupObjectId:i,dashboardObjectId:o,tileObjectId:r,errorStatus:a,appId:n,originalDashboardObjectId:s,originalTileObjectId:c}),S={name:"PBI.QRCode.ShortUrlFailed",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({groupObjectId:y.groupObjectId,dashboardObjectId:y.dashboardObjectId,tileObjectId:y.tileObjectId,errorStatus:y.errorStatus,appId:y.appId,originalDashboardObjectId:y.originalDashboardObjectId,originalTileObjectId:y.originalTileObjectId},null,b.formatted())},info:y,loggers:t.QRCodeShortUrlFailedLoggers};return S}function Ze(i,o,r,a,n,s,c,l,d,p,u,h,v){var g=t.CustomerAction(n,s,c,l,d,p,u,h,v),m=ri(g.info,{groupObjectId:i,reportObjectId:o,appId:r,originalReportObjectId:a}),f={name:"PBI.QRCode.QRCodeReportDialogShown",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({groupObjectId:m.groupObjectId,reportObjectId:m.reportObjectId,appId:m.appId,originalReportObjectId:m.originalReportObjectId},null,g.formatted())},info:m,loggers:t.QRCodeQRCodeReportDialogShownLoggers};return f}function et(i,o,r,a,n,s,c,l,d,p,u,h,v){var g=t.CustomerAction(n,s,c,l,d,p,u,h,v),m=ri(g.info,{groupObjectId:i,reportObjectId:o,appId:r,originalReportObjectId:a}),f={name:"PBI.QRCode.ReportShortUrlCreated",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({groupObjectId:m.groupObjectId,reportObjectId:m.reportObjectId,appId:m.appId,originalReportObjectId:m.originalReportObjectId},null,g.formatted())},info:m,loggers:t.QRCodeReportShortUrlCreatedLoggers};return f}function tt(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{snapshotId:i,embedType:o,disabled:r}),m={name:"PBI.ManageEmbed.DeleteEmbedCode",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({snapshotId:g.snapshotId,embedType:g.embedType,disabled:g.disabled},null,v.formatted())},info:g,loggers:t.ManageEmbedDeleteEmbedCodeLoggers};return m}function it(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.AddWidget",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardAddWidgetLoggers};return h}function ot(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Dashboard.LoadTenantContentPacks",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DashboardLoadTenantContentPacksLoggers};return h}function rt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.ContentList.Loaded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.ContentListLoadedLoggers};return h}function at(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{predicate:i}),v={name:"PBI.ContentList.SelectSort",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({predicate:si[h.predicate]},null,u.formatted())},info:h,loggers:t.ContentListSelectSortLoggers};return v}function nt(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.ContentList.PersistFilter",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.ContentListPersistFilterLoggers};return h}function st(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.MostRecentlyUsedService.UpdateMRUData",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.MostRecentlyUsedServiceUpdateMRUDataLoggers};return h}function ct(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.ContentList.Search",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.ContentListSearchLoggers};return h}function lt(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{source:i,type:o}),g={name:"PBI.ContentList.OpenArtifact",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({source:Mi[v.source],type:ki[v.type]},null,h.formatted())},info:v,loggers:t.ContentListOpenArtifactLoggers};return g}function dt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Marketplace.EmbeddedOpened",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.MarketplaceEmbeddedOpenedLoggers};return h}function pt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Marketplace.EmbeddedClosedWithAppAcquired",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.MarketplaceEmbeddedClosedWithAppAcquiredLoggers};return h}function ut(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Marketplace.EmbeddedClosedWithoutAppAcquired",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.MarketplaceEmbeddedClosedWithoutAppAcquiredLoggers};return h}function ht(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.RealTime.StreamingDatasetPushInfoPaneOpened",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.RealTimeStreamingDatasetPushInfoPaneOpenedLoggers};return h}function vt(i,o,r,a,n,s,c,l,d,p,u,h,v,g){var m=t.CustomerAction(s,c,l,d,p,u,h,v,g),f=ri(m.info,{action:i,dateTimeColumnCount:o,numericColumnCount:r,stringColumnCount:a,realTimeType:n}),b={name:"PBI.RealTime.AddUpdateRemoveStreamingDataset",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({action:yi[f.action],dateTimeColumnCount:f.dateTimeColumnCount,numericColumnCount:f.numericColumnCount,stringColumnCount:f.stringColumnCount,realTimeType:f.realTimeType},null,m.formatted())},info:f,loggers:t.RealTimeAddUpdateRemoveStreamingDatasetLoggers};return b}function gt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.RealTime.GetStreamingDataset",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.RealTimeGetStreamingDatasetLoggers};return h}function mt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.RealTime.GetPubNubCredentials",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.RealTimeGetPubNubCredentialsLoggers};return h}function ft(i){var o={message:i},r={name:"PBI.RealTime.LongPollError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({message:o.message},null)},info:o,loggers:t.RealTimeLongPollErrorLoggers};return r}function bt(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{source:i,confirmed:o,modelId:r}),m={name:"PBI.RowLevelSecurity.DisableRLS",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({source:Ti[g.source],confirmed:g.confirmed,modelId:g.modelId},null,v.formatted())},info:g,loggers:t.RowLevelSecurityDisableRLSLoggers};return m}function yt(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{alertId:i}),v={name:"PBI.DataAlerts.TileBadgeClicked",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({alertId:h.alertId},null,u.formatted())},info:h,loggers:t.DataAlertsTileBadgeClickedLoggers};return v}function St(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{source:i,action:o,alertId:r}),m={name:"PBI.DataAlerts.NotificationAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({source:Di[g.source],action:Ci[g.action],alertId:g.alertId},null,v.formatted())},info:g,loggers:t.DataAlertsNotificationActionLoggers};return m}function wt(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{requestType:i}),v={name:"PBI.DataAlerts.Request",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({requestType:Si[h.requestType]},null,u.formatted())},info:h,loggers:t.DataAlertsRequestLoggers};return v}function Dt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.DataAlerts.OpenAlertsSettings",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DataAlertsOpenAlertsSettingsLoggers};return h}function Ct(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.DataAlerts.AlertsSettingsEdit",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DataAlertsAlertsSettingsEditLoggers};return h}function Tt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.DataAlerts.DeleteAlertAccept",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DataAlertsDeleteAlertAcceptLoggers};return h}function It(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.DataAlerts.DeleteAlertCancel",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DataAlertsDeleteAlertCancelLoggers};return h}function kt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.DataAlerts.AlertsSettingsDelete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.DataAlertsAlertsSettingsDeleteLoggers};return h}function Mt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.EmailSubscriptions.EditEmailSettings",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.EmailSubscriptionsEditEmailSettingsLoggers};return h}function Pt(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{artifactType:i}),v={name:"PBI.UsageMetrics.Http.GetPackage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({artifactType:wi[h.artifactType]},null,u.formatted())},info:h,loggers:t.UsageMetricsHttpGetPackageLoggers};return v}function Et(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{numScriptTiles:i,numTotalTiles:o,numReportTilesWithScriptVisuals:r}),m={name:"PBI.Dashboard.LoadDashboardWithScriptVisuals",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({numScriptTiles:g.numScriptTiles,numTotalTiles:g.numTotalTiles,numReportTilesWithScriptVisuals:g.numReportTilesWithScriptVisuals},null,v.formatted())},info:g,loggers:t.DashboardLoadDashboardWithScriptVisualsLoggers};return m}function At(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{unseenCount:i}),v={name:"PBI.UserNotifications.LoadNotificationPane",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({unseenCount:h.unseenCount},null,u.formatted())},info:h,loggers:t.UserNotificationsLoadNotificationPaneLoggers};return v}function xt(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{notificationCategory:i}),v={name:"PBI.UserNotifications.LinkClicked",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({notificationCategory:h.notificationCategory},null,u.formatted())},info:h,loggers:t.UserNotificationsLinkClickedLoggers};return v}function Rt(i,o,r,a,n,s,c,l,d,p){var u=t.Verbose(o,r,a,n,s,c,l,d,p),h=ri(u.info,{parsedMessage:i}),v={name:"PBI.DynamicMessage.GetMessage",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({parsedMessage:h.parsedMessage},null,u.formatted())},info:h,loggers:t.DynamicMessageGetMessageLoggers};return v}function _t(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{userAction:i}),v={name:"PBI.DynamicMessage.UserAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({userAction:h.userAction},null,u.formatted())},info:h,loggers:t.DynamicMessageUserActionLoggers};return v}function Ft(i,o,r,a,n,s,c,l,d,u,h){var v=p(o,r,a,n,s,c,l,d,u,h),g=ri(v.info,{retryCount:i}),m={name:"PBI.Dashboard.RetryDashboard",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({retryCount:g.retryCount},null,v.formatted())},info:g,loggers:t.DashboardRetryDashboardLoggers};return m}function Nt(i,o,r,a,n,s,c,l,d,u,h){var v=p(o,r,a,n,s,c,l,d,u,h),g=ri(v.info,{dashboardCount:i}),m={name:"PBI.Dashboard.PreloadLinkedDashboard",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({dashboardCount:g.dashboardCount},null,v.formatted())},info:g,loggers:t.DashboardPreloadLinkedDashboardLoggers};return m}function Lt(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{resourcePackageLength:i,compositeTileHasCustomVisual:o}),g={name:"PBI.Dashboard.RegisterAndLoadResourcePackages",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({resourcePackageLength:v.resourcePackageLength,compositeTileHasCustomVisual:v.compositeTileHasCustomVisual},null,h.formatted())},info:v,loggers:t.DashboardRegisterAndLoadResourcePackagesLoggers};return g}function Ot(i,o,r,a,n,s,c,l,p,u,h){var v=d(o,r,a,n,s,c,l,p,u,h),g=ri(v.info,{pendingRequestCount:i}),m={name:"PBI.Dashboard.LoadDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,{pendingRequestCount:g.pendingRequestCount},v.formatted())},info:g,loggers:t.DashboardLoadDashboardLoggers};return m}function Gt(i,o,r,a,n,s,c,l,d,u,h){var v=p(o,r,a,n,s,c,l,d,u,h),g=ri(v.info,{tileIds:i}),m={name:"PBI.Dashboard.RecordDashboardTiles",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({tileIds:g.tileIds},null,v.formatted())},info:g,loggers:t.DashboardRecordDashboardTilesLoggers};return m}function Ut(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{resourcePackageLength:i,tileId:o,reportTileHasCustomVisual:r}),m={name:"PBI.Dashboard.RegisterAndLoadResourcePackagesForReportTiles",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({resourcePackageLength:g.resourcePackageLength,tileId:g.tileId,reportTileHasCustomVisual:g.reportTileHasCustomVisual},null,v.formatted())},info:g,loggers:t.DashboardRegisterAndLoadResourcePackagesForReportTilesLoggers};return m}function zt(i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S){var w=t.TimedEvent(d,p,u,h,v,g,m,f,b,y,S),D=ri(w.info,{url:i,groupGUID:o,requestSize:r,numOfDashboards:a,numOfReports:n,numOfModels:s,numOfWorkbooks:c,numOfFavorites:l}),C={name:"PBI.App.GetAppMetadata",time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({url:D.url,groupGUID:D.groupGUID,requestSize:D.requestSize,numOfDashboards:D.numOfDashboards,numOfReports:D.numOfReports,numOfModels:D.numOfModels,numOfWorkbooks:D.numOfWorkbooks,numOfFavorites:D.numOfFavorites},null,w.formatted())},info:D,loggers:t.AppGetAppMetadataLoggers};return C}function Bt(i,o,r,a,n,s,c,l,d,p,u){var h=t.TimedEvent(i,o,r,a,n,s,c,l,d,p,u),v=ri(h.info,{}),g={name:"PBI.App.ParseAppMetadata",time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,h.formatted())},info:v,loggers:t.AppParseAppMetadataLoggers};return g}function Wt(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.TimedEvent(o,r,a,n,s,c,l,d,p,u,h),g=ri(v.info,{fileName:i}),m={name:"PBI.App.JavaScriptParse",time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({fileName:g.fileName},null,v.formatted())},info:g,loggers:t.AppJavaScriptParseLoggers};return m}function Vt(i,o,r,a,n,s,c,l,d,p){var u=t.CustomerAction(o,r,a,n,s,c,l,d,p),h=ri(u.info,{artifactKind:i}),v={name:"PBI.ArtifactNotFound",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({artifactKind:h.artifactKind},null,u.formatted())},info:h,loggers:t.ArtifactNotFoundLoggers};return v}function $t(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.AppModel.InitializeContentProviders",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.AppModelInitializeContentProvidersLoggers};return h}function Ht(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{appGUID:i,contentProviderCategory:o,installSource:r}),m={name:"PBI.Apps.InstallApp",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({appGUID:g.appGUID,contentProviderCategory:g.contentProviderCategory,installSource:Ei[g.installSource]},null,v.formatted())},info:g,loggers:t.AppsInstallAppLoggers};return m}function jt(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.NPS.ShowDialog",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.NPSShowDialogLoggers};return h}function qt(i,o,r,a,n,s,c,l,d,p){var u=t.BaseEvent(o,r,a,n,s,c,l,d,p),h=ri(u.info,{jobId:i}),v={name:"PBI.App.PreemptiveQueryData",time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({jobId:h.jobId},null,u.formatted())},info:h,loggers:t.AppPreemptiveQueryDataLoggers};return v}function Qt(i,o,r,a,n,s,c,l,d,p){var u=t.Verbose(o,r,a,n,s,c,l,d,p),h=ri(u.info,{visualType:i}),v={name:"PBI.Dashboard.LoadTileVisualTimedOut",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({visualType:h.visualType},null,u.formatted())},info:h,loggers:t.DashboardLoadTileVisualTimedOutLoggers};return v}function Kt(i,o,r,a,n,s,c,l,p,u,h){var v=d(o,r,a,n,s,c,l,p,u,h),g=ri(v.info,{
pendingRequestCount:i}),m={name:"PBI.Dashboard.AddDashboard",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,{pendingRequestCount:g.pendingRequestCount},v.formatted())},info:g,loggers:t.DashboardAddDashboardLoggers};return m}function Jt(i,o,r,a,n,s,c,l,d,p,u,h){var v=t.CustomerAction(a,n,s,c,l,d,p,u,h),g=ri(v.info,{artifactType:i,artifactGuid:o,source:r}),m={name:"PBI.UsageMetrics.ViewUsageMetricsReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({artifactType:g.artifactType,artifactGuid:g.artifactGuid,source:g.source},null,v.formatted())},info:g,loggers:t.UsageMetricsViewUsageMetricsReportLoggers};return m}function Xt(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Groups.GetCapacities",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.GroupsGetCapacitiesLoggers};return h}function Yt(i,o,r,a,n,s,c,l,d){var p=t.Verbose(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Groups.ChangeMyWorkspaceCapacity",category:e.TelemetryCategory.Verbose,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.GroupsChangeMyWorkspaceCapacityLoggers};return h}function Zt(i,o,r,a,n,s,c,l,d){var p=t.CustomerAction(i,o,r,a,n,s,c,l,d),u=ri(p.info,{}),h={name:"PBI.Apps.HideIntroduceAppBar",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted(null,null,p.formatted())},info:u,loggers:t.AppsHideIntroduceAppBarLoggers};return h}function ei(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{fromState:i,toState:o}),g={name:"PBI.MobileAuthoring.SwitchedState",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({fromState:v.fromState,toState:v.toState},null,h.formatted())},info:v,loggers:t.MobileAuthoringSwitchedStateLoggers};return g}function ti(i,o,r,a,n,s,c,l,d,p,u){var h=t.CustomerAction(r,a,n,s,c,l,d,p,u),v=ri(h.info,{mobileOptimized:i,operationType:o}),g={name:"PBI.MobileAuthoring.FlyoutShown",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:ii(),formatted:function(){return e.extendFormatted({mobileOptimized:v.mobileOptimized,operationType:Ai[v.operationType]},null,h.formatted())},info:v,loggers:t.MobileAuthoringFlyoutShownLoggers};return g}var ii,oi=jsCommon.Utility,ri=jsCommon.UnionExtensions.mergeUnionType;ii=oi?oi.generateGuid:Function.prototype;var ai;!(function(e){e[e.Report=0]="Report",e[e.QnA=1]="QnA",e[e.Url=2]="Url"})(ai=t.ContentTypes||(t.ContentTypes={}));var ni;!(function(e){e[e.Report=0]="Report",e[e.QnA=1]="QnA",e[e.Exploration=2]="Exploration",e[e.Dashboard=3]="Dashboard",e[e.Workbook=4]="Workbook",e[e.Insights=5]="Insights",e[e.Widget=6]="Widget"})(ni=t.PinTileSource||(t.PinTileSource={}));var si;!(function(e){e[e.TitleAlpabetical=0]="TitleAlpabetical",e[e.TitleReverseAlphabetical=1]="TitleReverseAlphabetical",e[e.OwnerAlphabetical=2]="OwnerAlphabetical",e[e.OwnerReverseAlphabetical=3]="OwnerReverseAlphabetical",e[e.LastAccessDate=4]="LastAccessDate",e[e.LastAccessReverseDate=5]="LastAccessReverseDate",e[e.SharedTime=6]="SharedTime",e[e.SharedReverseTime=7]="SharedReverseTime"})(si=t.SelectSort||(t.SelectSort={}));var ci;!(function(e){e[e.Expand=0]="Expand",e[e.Collapse=1]="Collapse"})(ci=t.NavPaneToggleAction||(t.NavPaneToggleAction={}));var li;!(function(e){e[e.NavigatorPaneGetDataButton=0]="NavigatorPaneGetDataButton",e[e.NavigatorPaneAddDatasetButton=1]="NavigatorPaneAddDatasetButton"})(li=t.OpenGetDataPageInteraction||(t.OpenGetDataPageInteraction={}));var di;!(function(e){e[e.GetData=0]="GetData",e[e.Welcome=1]="Welcome",e[e.GroupWelcome=2]="GroupWelcome"})(di=t.GetDataSplashState||(t.GetDataSplashState={}));var pi;!(function(e){e[e.NavPane=0]="NavPane",e[e.Breadcrumb=1]="Breadcrumb",e[e.SplashPage=2]="SplashPage",e[e.GetApps=3]="GetApps"})(pi=t.GetDataCategorySelectInteraction||(t.GetDataCategorySelectInteraction={}));var ui;!(function(e){e[e.Dashboards=0]="Dashboards",e[e.Reports=1]="Reports",e[e.Datasets=2]="Datasets",e[e.Groups=3]="Groups"})(ui=t.NavPaneSection||(t.NavPaneSection={}));var hi;!(function(e){e[e.NavigatorBarManageStorage=0]="NavigatorBarManageStorage",e[e.DirectUrl=1]="DirectUrl"})(hi=t.QuotaOpenManageStorageInteraction||(t.QuotaOpenManageStorageInteraction={}));var vi;!(function(e){e[e.Group=0]="Group",e[e.Personal=1]="Personal"})(vi=t.QuotaOpenManageStorageContext||(t.QuotaOpenManageStorageContext={}));var gi;!(function(e){e[e.NavigatorBarManageStorage=0]="NavigatorBarManageStorage"})(gi=t.OpenUpgradeAccountInteraction||(t.OpenUpgradeAccountInteraction={}));var mi;!(function(e){e[e.DeleteOwnedModel=0]="DeleteOwnedModel",e[e.DeleteOwnedWorkbook=1]="DeleteOwnedWorkbook",e[e.RemoveSharedItem=2]="RemoveSharedItem"})(mi=t.QuotaDeleteItemType||(t.QuotaDeleteItemType={}));var fi;!(function(e){e[e.Unknown=0]="Unknown",e[e.AddDashboard=1]="AddDashboard",e[e.ShareDashboard=2]="ShareDashboard",e[e.AcceptInvitation=3]="AcceptInvitation",e[e.AddTile=4]="AddTile",e[e.ReportSaveAs=5]="ReportSaveAs",e[e.OpenDataset=6]="OpenDataset",e[e.GetData=7]="GetData",e[e.PublishContentPack=8]="PublishContentPack",e[e.UpdateContentPack=9]="UpdateContentPack",e[e.PersonalizeContentPack=10]="PersonalizeContentPack",e[e.CreateStreamingDataset=11]="CreateStreamingDataset",e[e.AppAutoInstall=12]="AppAutoInstall",e[e.PersonalizeApp=13]="PersonalizeApp"})(fi=t.QuotaCheckOperation||(t.QuotaCheckOperation={}));var bi;!(function(e){e[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report",e[e.AppInstance=2]="AppInstance"})(bi=t.FavoriteType||(t.FavoriteType={}));var yi;!(function(e){e[e.Create=0]="Create",e[e.Delete=1]="Delete",e[e.Update=2]="Update"})(yi=t.CreateUpdateDeleteAction||(t.CreateUpdateDeleteAction={}));var Si;!(function(e){e[e.Create=0]="Create",e[e.Update=1]="Update",e[e.Toggle=2]="Toggle",e[e.Delete=3]="Delete",e[e.Get=4]="Get"})(Si=t.AlertRequestType||(t.AlertRequestType={}));var wi;!(function(e){e[e.Report=0]="Report",e[e.Dashboard=1]="Dashboard"})(wi=t.UsageMetricsArtifactType||(t.UsageMetricsArtifactType={}));var Di;!(function(e){e[e.UnifiedNotificationPane=0]="UnifiedNotificationPane"})(Di=t.DataAlertNotificationSource||(t.DataAlertNotificationSource={}));var Ci;!(function(e){e[e.OpenTile=0]="OpenTile"})(Ci=t.DataAlertNotificationAction||(t.DataAlertNotificationAction={}));var Ti;!(function(e){e[e.OneDriveRefreshEnabled=0]="OneDriveRefreshEnabled",e[e.RefreshNow=1]="RefreshNow",e[e.RLSSettingsPage=2]="RLSSettingsPage",e[e.UploadOverride=3]="UploadOverride"})(Ti=t.DisableRLSSource||(t.DisableRLSSource={}));var Ii;!(function(e){e[e.APIPush=0]="APIPush",e[e.PubNub=1]="PubNub"})(Ii=t.StreamingDatasetGalleryOption||(t.StreamingDatasetGalleryOption={}));var ki;!(function(e){e[e.Dashboard=0]="Dashboard",e[e.OrgApp=1]="OrgApp",e[e.Report=2]="Report",e[e.Workbook=3]="Workbook"})(ki=t.ContentListArtifactType||(t.ContentListArtifactType={}));var Mi;!(function(e){e[e.ContentList=0]="ContentList",e[e.OrgApps=1]="OrgApps",e[e.RecentlyUsed=2]="RecentlyUsed",e[e.Favorites=3]="Favorites"})(Mi=t.ContentListArtifactSource||(t.ContentListArtifactSource={}));var Pi;!(function(e){e[e.Normal=0]="Normal",e[e.EmailSubscription=1]="EmailSubscription"})(Pi=t.OpenDashboardSource||(t.OpenDashboardSource={})),t.SettingsSetShowGridlines=i,t.SettingsSetSnapToGrid=o,t.NavigationClickBreadcrumb=r,t.NavigationToggle=a,t.NavigationClickLogo=n,t.ContentListArtifactsCount=s,t.DashboardDuplicateDashboard=c,t.DashboardDeleteDashboardUser=l,t.BaseDashboardEvent=d,t.BaseDashboardVerboseEvent=p,t.DashboardEvent=u,t.DashboardAddFavorite=h,t.DashboardDeleteFavorite=v,t.DashboardGetFavorites=g,t.DashboardClaimInvitation=m,t.DashboardClaimInvitationRedirectToMobileLandingPage=f,t.DashboardContentProviderPublish=b,t.DashboardContentProviderPublishDSID=y,t.CustomConfigHandlerSharePointDiscover=S,t.DashboardDeleteDashboard=w,t.DashboardDeleteTile=D,t.DashboardDownloadIOSApp=C,t.DashboardDownloadCompanionApp=T,t.DashboardDownloadExcelPublisher=I,t.DashboardDownloadGateways=k,t.DashboardTileLayoutChanged=M,t.DashboardInFocusWorkbook=P,t.DashboardReloadWorkbook=E,t.DashboardCalculateWorkbook=A,t.InFocusModeSaveTileProperties=x,t.DashboardExportDashboard=R,t.BaseAppDashboardEvent=_,t.DashboardOpenDashboard=F,t.DashboardLoadDashboardTileVisual=N,t.DashboardPinTile=L,t.DashboardInitializeContainer=O,t.DashboardInitializeContentProviderConfig=G,t.DashboardRequestDashboardAccess=U,t.DashboardOpenTile=z,t.DashboardSettingGroupChanged=B,t.DashboardRenameDashboard=W,t.DashboardViewWorkbook=V,t.DashboardWorkbookEditedInPowerBICausedPinBlock=$,t.DashboardEditWorkbook=H,t.DashboardWorkbookViewedExternallyDueToAnError=j,t.DashboardSwitchView=q,t.DashboardUpdateActiveDashboard=Q,t.DashboardRefreshTileData=K,t.DashboardSetHomeDashboard=J,t.DashboardDisableHomeDashboard=X,t.DashboardRefreshDashboardTiles=Y,t.GroupsSwitchGroup=Z,t.DashboardShowGettingStartedPopup=ee,t.BaseDataSetTopLevelCustomerAction=te,t.DashboardManageDatasetsLanding=ie,t.DashboardDatasetClickScheduleRefresh=oe,t.DashboardWorkbookClickScheduleRefresh=re,t.DashboardDatasetClickRefreshNow=ae,t.DashboardWorkbookClickRefreshNow=ne,t.DashboardDatasetClickDelete=se,t.DashboardDatasetClickInsights=ce,t.DashboardDatasetClickRename=le,t.DashboardClickPersonalize=de,t.DashboardExpandCollapseNavigatorPane=pe,t.DashboardOpenGetDataPage=ue,t.DashboardExpandCollapseNavigatorPaneSection=he,t.DashboardFilterNavigatorPaneItems=ve,t.DashboardGetGroups=ge,t.DashboardContentPackPublish=me,t.DashboardContentPackDirty=fe,t.DashboardDeleteContentPack=be,t.DashboardDeleteTemplateOrganizationApp=ye,t.DashboardViewContentPacks=Se,t.DashboardContentPackPersonalize=we,t.DashboardFirstUse=De,t.DashboardWorkbookPinabilityShown=Ce,t.DashboardGetDataSplash=Te,t.DashboardGetDataCategorySelect=Ie,t.DashboardInFocusModeSelected=ke,t.DashboardSaveDashboardSettings=Me,t.DashboardInitializeSettingsDashboardsModel=Pe,t.DashboardTestDataSourceConnection=Ee,t.DashboardGetRefreshHistoriesOnRefreshFailures=Ae,t.DashboardLoadTileData=xe,t.DashboardOwnershipFilterSelected=Re,t.AppInitialAppLoad=_e,t.GroupEditorGetGroupMembers=Fe,t.GroupEditorUserLeaveGroup=Ne,t.QuotaOpenManageStoragePage=Le,t.QuotaStorageUsage=Oe,t.QuotaManageStorageDelete=Ge,t.QuotaExceeded=Ue,t.OpenUpgradeAccountPage=ze,t.PrivacyInitializeSettingsModel=Be,t.PrivacySaveSettingsModel=We,t.SettingsEsriSaveModel=Ve,t.SettingsDeleteAllDatasources=$e,t.SettingsTakeoverDatasources=He,t.PrivacySendPowerBIEmail=je,t.LocaleSaveLocaleSetting=qe,t.SettingsLoadSettingsData=Qe,t.SettingsEnterFullScreen=Ke,t.QRCodeQRCodeDialogShown=Je,t.QRCodeShortUrlCreated=Xe,t.QRCodeShortUrlFailed=Ye,t.QRCodeQRCodeReportDialogShown=Ze,t.QRCodeReportShortUrlCreated=et,t.ManageEmbedDeleteEmbedCode=tt,t.DashboardAddWidget=it,t.DashboardLoadTenantContentPacks=ot,t.ContentListLoaded=rt,t.ContentListSelectSort=at,t.ContentListPersistFilter=nt,t.MostRecentlyUsedServiceUpdateMRUData=st,t.ContentListSearch=ct,t.ContentListOpenArtifact=lt,t.MarketplaceEmbeddedOpened=dt,t.MarketplaceEmbeddedClosedWithAppAcquired=pt,t.MarketplaceEmbeddedClosedWithoutAppAcquired=ut,t.RealTimeStreamingDatasetPushInfoPaneOpened=ht,t.RealTimeAddUpdateRemoveStreamingDataset=vt,t.RealTimeGetStreamingDataset=gt,t.RealTimeGetPubNubCredentials=mt,t.RealTimeLongPollError=ft,t.RowLevelSecurityDisableRLS=bt,t.DataAlertsTileBadgeClicked=yt,t.DataAlertsNotificationAction=St,t.DataAlertsRequest=wt,t.DataAlertsOpenAlertsSettings=Dt,t.DataAlertsAlertsSettingsEdit=Ct,t.DataAlertsDeleteAlertAccept=Tt,t.DataAlertsDeleteAlertCancel=It,t.DataAlertsAlertsSettingsDelete=kt,t.EmailSubscriptionsEditEmailSettings=Mt,t.UsageMetricsHttpGetPackage=Pt,t.DashboardLoadDashboardWithScriptVisuals=Et,t.UserNotificationsLoadNotificationPane=At,t.UserNotificationsLinkClicked=xt,t.DynamicMessageGetMessage=Rt,t.DynamicMessageUserAction=_t,t.DashboardRetryDashboard=Ft,t.DashboardPreloadLinkedDashboard=Nt,t.DashboardRegisterAndLoadResourcePackages=Lt,t.DashboardLoadDashboard=Ot,t.DashboardRecordDashboardTiles=Gt,t.DashboardRegisterAndLoadResourcePackagesForReportTiles=Ut,t.AppGetAppMetadata=zt,t.AppParseAppMetadata=Bt,t.AppJavaScriptParse=Wt,t.ArtifactNotFound=Vt,t.AppModelInitializeContentProviders=$t;var Ei;!(function(e){e[e.AppSource=0]="AppSource",e[e.AppAutoInstallLink=1]="AppAutoInstallLink",e[e.AppArtifactAutoInstallLink=2]="AppArtifactAutoInstallLink",e[e.AppsOnlyAppSource=3]="AppsOnlyAppSource"})(Ei=t.InstallSource||(t.InstallSource={})),t.AppsInstallApp=Ht,t.NPSShowDialog=jt,t.AppPreemptiveQueryData=qt,t.DashboardLoadTileVisualTimedOut=Qt,t.DashboardAddDashboard=Kt,t.UsageMetricsViewUsageMetricsReport=Jt,t.GroupsGetCapacities=Xt,t.GroupsChangeMyWorkspaceCapacity=Yt,t.AppsHideIntroduceAppBar=Zt,t.MobileAuthoringSwitchedState=ei;var Ai;!(function(e){e[e.Add=0]="Add",e[e.Pin=1]="Pin",e[e.Remove=2]="Remove"})(Ai=t.OperationType||(t.OperationType={})),t.MobileAuthoringFlyoutShown=ti})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){e.actualOpenTileEventName="actualOpenTile",e.cancelEditWidgetEventName="cancelEditWidget",e.configPageErrorLoadingEventName="configPageErrorLoading",e.configPageLoadedEventName="configPageLoaded",e.contentListDashboardsLoadedEvent="contentListDashboardsLoaded",e.contentListDatasetsLoadedEvent="contentListDatasetssLoaded",e.contentListFavoritesLoadedEvent="contentListFavoritesLoaded",e.contentListRecentlyUsedLoadedEvent="contentListRecentlyUsedLoaded",e.contentListReportsLoadedEvent="contentListReportsLoaded",e.contentListWorkbooksLoadedEvent="contentListWorkbooksLoaded",e.dashboardContainerLoaded="dashboardContainerLoaded",e.dataSourceAccessInfoGeneratedEventName="dataSourceAccessInfoGenerated",e.datasetShowHistoryDialog="datasetShowHistoryDialog",e.deleteModelEventName="deleteModel",e.deleteReportEventName="deleteReport",e.enablePowerBIASConnectorApp="asConnectorEnabled",e.enablePowerBICompanionApp="companionEnabled",e.myWorkSpaceGroupId="me",e.navPaneScrollEventName="navPaneScroll",e.navigateToActiveDashboard="navigateToActiveDashboard",e.notifyDashboardOwnerInfoLoaded="dashboardOwnerInfoLoaded",e.notifyUpdateAllowQnaDataCollectionEventName="notifyUpdateAllowQnaDataCollection",e.openCreateContentPackEventName="openCreateContentPack",e.openModelEventName="openModel",e.openProviderTileEventName="openProviderTile",e.openReportEventName="openReport",e.openTileEventName="openTile",e.scrollToSelectedTileEventName="scrollToSelectedTile",e.personalizeEventName="personalize",e.removeTileEventName="removeTileFromGroup",e.renameDashboardEventName="renameDashboard",e.renameModelEventName="renameModel",e.reportDeletedEventName="reportDeleted",e.scrollNavPaneToActiveDashboardEventName="scrollNavPaneToActiveDashboard",e.scrollToNavPaneListItemEventName="scrollToNavPaneListItem",e.setDashboardTileOptionsMenuVisibility="setDashboardTileOptionsMenuVisibility",e.shouldShowProviderTilesEventName="shouldShowProviderTiles",e.temporaryTilePinned="temporaryTilePinned",e.updateTileHrefEventName="updateTileHref",e.uploadFormatChosenEventName="uploadFormatChosen",e.replaceLocalWorkbookEventName="replaceLocalFile",e.dashboardTileErrorEventName="dashboardTileError",e.removeDashboardTileErrorEventName="removeDashboardTileError",e.rowLevelSecurityAccessDeniedEventName="rowLevelSecurityAccessDenied",e.defaultPortraitPrintWidth=673,e.defaultPortraitPrintHeight=860,e.defaultLandscapePrintWidth=940,e.defaultLandscapePrintHeight=578,e.inFocusEnterEvent="inFocusEnter",e.inFocusExitEvent="inFocusExit",e.dashboardTileLayoutChangeEvent="dashboardTileLayoutChangeEvent",e.notifyDashboardUpdate="notifyDashboardUpdate",e.mobileApplication="winApp",e.pvScriptsLoaded="exploreHostLoaded",e.openReportStarting="openReportStarting",e.openReportSucceeded="openReportSucceded",e.openReportFailed="openReportFailed",e.modelFailedGenericServiceError="modelFailedGenericServiceError",e.modelFailedGenericClientError="modelFailedGenericClientError",e.modelFailednoErrorInfo="modelFailednoErrorInfo",e.openDashboardStarting="openDashboardStarting",e.openDashboardSucceeded="openDashboardSucceeded",e.openDashboardFailed="openDashboardFailed",e.openInFocusTileActionName="/openInFocus",e.openInFocusWorkbookTileActionName="/openInFocusWorkbook",e.openInFocusRealTimeTileActionName="/openInFocusRealTime",e.showTileEditorEventName="showTileEditor",e.hideTileEditorEventName="hideTileEditor",e.alertTitleMaxLength=250,e.hideTaskPaneSliderOnClickEventName="hideTaskPaneSliderOnClick",e.refreshTileData="refreshTileData",e.maxDashboardNameLength=30,e.openReportFinished="OpenReportFinished",e.tokenRefreshIntervalOffset=27e5,e.biTokenRefreshInterval=23760027e5,e.windowParentScope="windowParentScope",e.oauthResponseName="oAuthResponse",e.appLoadErrorGroupNotAccessible="#groupNotAccessible#",e.saveReportFromPinDialog="saveReportFromPinDialog",e.populateDashboardWithReportTiles="populateDashboardWithReportTiles",e.updateFavorites="updateFavorites",e.updateSharedWithMe="updateSharedWithMe",e.saveDashboardSettings="saveDashboardSettings",e.insightsDescriptor="insights",e.groupSwitchedEventName="GroupSwitched",e.groupAddedUpdateContextMenuEventName="GroupAddedUpdateContextMenu",e.groupDeletedEventName="GroupDeleted",e.contentPackDirtyShowNotification="contentPackDirty",e.loadDashboardFailed="loadDashboardFailed",e.usageMetrics_Report="Report",e.usageMetrics_Dashboard="Dashboard",e.usageMetrics_NavModel="NavModel";var t;!(function(e){var t;!(function(e){e.landing="landing",e.adminPortal="landing.adminPortal",e.adminPortalCapacities="landing.adminPortal.capacities",e.adminPortalCapacity="landing.adminPortal.capacities.capacity",e.adminPortalCapacitiesPivot="landing.adminPortal.capacities.pivot",e.adminPortalCreateCapacity="landing.adminPortal.capacities.createCapacity",e.appAutoinstall="landing.autoInstall",e.devTools="landing.devTools",e.home="landing.featureddashboard",e.list="landing.list",e.groups="landing.groups",e.group="landing.groups.group",e.apps="landing.groups.group.apps",e.app="landing.groups.group.apps.app",e.appDashboards="landing.groups.group.apps.app.dashboards",e.appDashboard="landing.groups.group.apps.app.dashboards.dashboard",e.appAlertsEditor="landing.groups.group.apps.app.dashboards.dashboard.alerts",e.appInFocusMode="landing.groups.group.apps.app.dashboards.dashboard.infocus",e.appInFocusInsights="landing.groups.group.apps.app.dashboards.dashboard.insights",e.appDashboardQna="landing.groups.group.apps.app.dashboards.dashboard.qna",e.appInsights="landing.groups.group.apps.app.insights",e.appInstances="landing.groups.group.apps.app.instances",e.appInstance="landing.groups.group.apps.app.instances.instance",e.appInstanceDashboards="landing.groups.group.apps.app.instances.instance.dashboards",e.appInstanceDashboard="landing.groups.group.apps.app.instances.instance.dashboards.dashboard",e.appInstanceAlertsEditor="landing.groups.group.apps.app.instances.instance.dashboards.dashboard.alerts",e.appInstanceInFocusMode="landing.groups.group.apps.app.instances.instance.dashboards.dashboard.infocus",e.appInstanceInFocusInsights="landing.groups.group.apps.app.instances.instance.dashboards.dashboard.insights",e.appInstanceDashboardQna="landing.groups.group.apps.app.instances.instance.dashboards.dashboard.qna",e.contentList="landing.groups.group.contentList",e.contentListPivot="landing.groups.group.contentList.pivot",e.dashboards="landing.groups.group.dashboards",e.dashboard="landing.groups.group.dashboards.dashboard",e.dashboardMobileAuthoring="landing.groups.group.dashboards.dashboard.mobileAuthoring",e.dashboardReports="landing.groups.group.dashboards.dashboard.reports",e.dashboardReport="landing.groups.group.dashboards.dashboard.reports.report",e.dashboardReportPage="landing.groups.group.dashboards.dashboard.reports.report.page",e.dashboardWorkbooks="landing.groups.group.dashboards.dashboard.workbooks",e.dashboardWorkbook="landing.groups.group.dashboards.dashboard.workbooks.workbook",e.alertsEditor="landing.groups.group.dashboards.dashboard.alerts",e.inFocusMode="landing.groups.group.dashboards.dashboard.infocus",e.inFocusInsights="landing.groups.group.dashboards.dashboard.insights",e.dashboardQna="landing.groups.group.dashboards.dashboard.qna",e.dashboardRequestAccess="landing.groups.group.dashboards.dashboard.requestaccess",e.dashboardShare="landing.groups.group.dashboards.dashboard.share",e.modelQna="landing.groups.group.datasets.dataset.qna",e.extendTrial="landing.groups.group.extendTrial",e.accept2017ProTrial="landing.groups.group.accept2017ProTrial",e.favorites="landing.groups.group.favorites",e.insights="landing.groups.group.insights",e.gateways="landing.groups.group.gateways",e.gateway="landing.groups.group.gateways.gateway",e.dataSource="landing.groups.group.gateways.gateway.dataSource",e.getData="landing.groups.group.getData",e.getDataCategory="landing.groups.group.getData.category",e.getDataCategoryProviderName="landing.groups.group.getData.category.providerName",e.groupWelcome="landing.groups.group.groupWelcome",e.manageEmbed="landing.groups.group.manageEmbed",e.manageStorage="landing.groups.group.manageStorage",e.publishApp="landing.groups.group.publishApp",e.publishContent="landing.groups.group.publishContent",e.recentlyViewed="landing.groups.group.recentlyViewed",e.rowLevelSecurity="landing.groups.group.rowLevelSecurity",e.settings="landing.groups.group.settings",e.settingsGroup="landing.groups.group.settings.settingsGroup",e.settingsId="landing.groups.group.settings.settingsGroup.settingsId",e.sharedWithMe="landing.groups.group.sharedWithMe",e.sharedDashboards="landing.groups.group.sharedWithMe.dashboards",e.sharedDashboard="landing.groups.group.sharedWithMe.dashboards.dashboard",e.sharedAlertsEditor="landing.groups.group.sharedWithMe.dashboards.dashboard.alerts",e.sharedInFocusMode="landing.groups.group.sharedWithMe.dashboards.dashboard.infocus",e.sharedInFocusInsights="landing.groups.group.sharedWithMe.dashboards.dashboard.insights",e.sharedDashboardQna="landing.groups.group.sharedWithMe.dashboards.dashboard.qna",e.sharedDashboardReports="landing.groups.group.sharedWithMe.dashboards.dashboard.reports",e.sharedDashboardReport="landing.groups.group.sharedWithMe.dashboards.dashboard.reports.report",e.sharedDashboardReportPage="landing.groups.group.sharedWithMe.dashboards.dashboard.reports.report.page",e.sharedDashboardRequestAccess="landing.groups.group.sharedWithMe.dashboards.dashboard.requestaccess",e.sharedDashboardShare="landing.groups.group.sharedWithMe.dashboards.dashboard.share",e.sharedDashboardWorkbooks="landing.groups.group.sharedWithMe.dashboards.dashboard.workbooks",e.sharedDashboardWorkbook="landing.groups.group.sharedWithMe.dashboards.dashboard.workbooks.workbook",e.viewContent="landing.groups.group.viewContent",e.workspaces="landing.workspaces"})(t=e.states||(e.states={})),e.getDataWelcome="welcome"})(t=e.navigation||(e.navigation={})),e.emailsListSeparator="; ",e.streamingDatasetModelPubNub="PubNub",e.defaultBrowserLanguageCode="browserLanguage";var i;!(function(e){e.PowerBIUserQuotaExceeded="PowerBIUserQuotaExceeded",e.PowerBIGroupQuotaExceeded="PowerBIGroupQuotaExceeded"})(i=e.quotaErrorCodes||(e.quotaErrorCodes={}));var o;!(function(e){e.OverwriteNonLocalPackageWithLocalFileError="OverwriteNonLocalPackageWithLocalFileError"})(o=e.FileUploadWarnings||(e.FileUploadWarnings={}));var r;!(function(e){e.ReportWithDisplayNameForTheModelExists="ReportWithDisplayNameForTheModelExists",e.MoreThanOneDuplicateReportFoundError="MoreThanOneDuplicateReportFoundError",e.ReplaceOriginalReportForPowerBICompanionNotSupported="ReplaceOriginalReportForPowerBICompanionNotSupported",e.ModelNotFound="PowerBIModelNotFoundException"})(r=e.pbixUploadWarnings||(e.pbixUploadWarnings={}));var a;!(function(e){e.acquireAppEventName="acquireSaasMarketplaceApp",e.initSaasMarketplaceEventName="initSaasMarketplace",e.updateHostUrl="updateUrlForSaasMarketplaceApp";var t;!(function(e){e.acquireApp="acquireApp",e.externalRedirect="externalRedirect",e.updateUrl="updateUrl",e.closeSaasMarketplace="closeSaasMarketplace",e.finishedLoadingContentProviderList="contentProvidersLoaded"})(t=e.actionTypes||(e.actionTypes={}))})(a=e.saasMarketplace||(e.saasMarketplace={}));var n;!(function(e){e.closeNpsDialog="closeNpsDialog",e.resizeNpsDialog="thankyouNpsDialog",e.renderPath="/render/powerbi/",e.displayPath="/display/powerbi/",e.puidParam="puid",e.languageParam="culture"})(n=e.nps||(e.nps={})),e.DashboardSharingSecurityGroupRequirePro="DashboardInvitationSGRequirePro",e.DashboardInvitationUnsupportedGroup="DashboardInvitationUnsupportedGroup";var s;!(function(e){e.userDismissedAction="dismissed",e.userClickedAction="clicked"})(s=e.dynamicMessaging||(e.dynamicMessaging={})),e.targetValueBlank="_blank",e.downloadPBIDesktopLink="https://go.microsoft.com/fwlink/?LinkID=521920",e.pbiAppsLink="https://go.microsoft.com/fwlink/?linkid=838948",e.pbiAlertsLink="https://go.microsoft.com/fwlink/?linkid=851587",e.refreshHistoryDialogTimeoutValue=9e6,e.configureScheduledRefreshLink="https://go.microsoft.com/fwlink/?linkid=844603";var c;!(function(e){e.Apps="pbi-glyph-my-apps",e.Dashboard="pbi-glyph-gauge",e.Report="pbi-glyph-barchart",e.Workbook="pbi-glyph-excel",e.Database="pbi-glyph-database"})(c=e.iconClasses||(e.iconClasses={}))})(t=e.constants||(e.constants={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=e.dataServices.AppUtils,r=e.common.models.ArtifactType,a=e.common.models.CollapsiblePaneExpandedWidth,n=e.common.models,s=e.dataServices.ContractUtils.convertToSemanticQueryWithDataShapeBinding,c=e.dataServices.models.DashboardTileModel,l=e.dataServices.constants,d=e.common.DropdownUtils,p=e.dataServices.EwaNamedItemType,u=e.common.dialogs.FeatureNotSupportedDialogBuilder,h=e.dataServices.models.IntraDomainNavigationType,v=e.dataServices.models.IsDashboardIntraDomainPrefix,g=e.dataServices.models.IsReportIntraDomainPrefix,m=e.common.contracts.Permissions,f=e.common.contracts.reportServer.ReportInstantiationMode,b=jsCommon.StringExtensions,y=e.common.constants.tileActions,S=e.dataServices.contracts.TileType,w='\n    <div class="tileErrors">\n        <div class="errorText" ng-bind="::title"></div>\n        <div ng-repeat="tileError in ::tileErrors" class="tileError">\n            <div class="tileErrorCount">\n                <pbi-icon name="error" size="small"></pbi-icon>\n                <span localize="DashboardAppBar_TileError_ErrorDialogErrorTitle" localize-fragments>\n                    <span fragment-index="0" ng-bind="::tileError.count"></span>\n                </span>\n            </div>\n            <error-details-info error-details="tileError.errorDetails"></error-details-info>\n        </div>\n        <a class="modalErrorHelpLink" target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=690865" localize="TopNav_HelpMenu_GetHelp"></a>\n    </div>\n    ';!(function(e){e[e.Normal=0]="Normal",e[e.NoDashboardsWatermark=1]="NoDashboardsWatermark",e[e.RequestAccess=2]="RequestAccess",e[e.Uninitialized=3]="Uninitialized"})(i=t.DashboardContainerControllerViewState||(t.DashboardContainerControllerViewState={}));var D=(function(){function D(t,i){var o=this;this.scope=t,this.services=i,this.scope.rootScope=i.rootScope,this.scope.refreshState=0,this.notificationIds=[],this.initialize(this.services.dashboardService.dashboardContainerModel),this.initialized||(this.unregisterViewModelWatch=this.services.rootScope.$on(e.constants.dashboardContainerLoaded,(function(){o.initialize(o.services.dashboardService.dashboardContainerModel)}))),this.scope.groupService=this.services.groupService,this.services.dashboardDataService.registerRefreshStateListener(this),this.scope.inAppView=function(){return o.services.conceptualModelSetting.isAppsEnabled()&&o.services.navigation.inAppView()},this.scope.inAppArtifactView=function(){return o.services.conceptualModelSetting.isAppsEnabled()&&o.services.navigation.inAppArtifactView()}}return D.createOptions=function(){return{additionalServices:["$window","contentProviderHttpService","dashboardHttpService","dashboardService","dashboardStateChangeService","dashboardWarningsService","home","errorService","featureSwitchService","modelConverter","modelMerger","navigation","promiseFactory","reportService","modelService","moduleLoader","workbookService","settingsMetadataService","syncService","telemetryService","localizationService","overlayService","visualPlugin","groupService","notificationBar","notificationToast","viralTenantMergeHelperService","modelService","licenseEnforcementService","userInfo","dashboardDataService","fullScreen","inFocusService","permissionService","pinTileService","favorites","gridLayout","dashboardConfigurationService","modalDialogService","auditing","mostRecentlyUsedService","quota","conceptualModelSetting","appService","packageService","taskPaneSliderService","subscription","ownership","usageMetricsReport","pbiLazyLoad","dropdown","navigationHelper","viewRelatedContentService","emailSubscriptionService","lazy","mobileAuthoringService"],scopedDependencies:["explorationCapabilities"],scopedServiceRoot:!0}},D.prototype.initialize=function(t){var o=this;if(!this.initialized&&t){this.viewModel=t;var r=this.services,n=this.scope,s=n.dashboardDataService=r.dashboardDataService;n.showBreadcrumb=0===n.refreshState&&(!r.featureSwitchService.featureSwitches.breadcrumbNavigationEnabled||_.include(r.$window.location.pathname,"invite")),r.navigation.inDashboardView()&&r.dashboardWarningsService.showWarningsIfNeeded();var c=n.permissionService=r.permissionService,d=n.navigation=r.navigation;n.fullScreen=r.fullScreen,n.maxDashboardNameLength=e.constants.maxDashboardNameLength,n.sharingEnabled=function(){return!c.isActiveWorkspaceIsReadOnly&&s.activeDashboard&&(s.activeDashboard.getPermissions()&m.ReShare)===m.ReShare},n.showAddTileButton=function(){return o.isDashboardEditable()},n.showHomeDashboardButton=function(){return!r.dashboardConfigurationService.disableSetFeaturedDashboard&&!d.inAppView()},n.showViewRelatedButton=function(){return!r.viewRelatedContentService.disableViewRelated},n.showUsageMetricsButton=function(){var e=o.services.licenseEnforcementService.supportsUsageMetrics();return o.services.featureSwitchService.featureSwitches.usageMetricsEnabled&&e&&o.isDashboardEditable()},n.openUsageMetricsReport=function(){return o.openUsageMetricsReport()},n.showRelatedContentPane=function(){return o.showRelatedContentPane()},n.showTileGalleryPane=function(){return o.showTileGalleryPane()},n.showShareSlider=function(){return o.showShareSlider()},n.showSubscriptionPane=function(){return o.showSubscriptionPane()},n.showInstantEmailPane=function(){return o.showInstantEmailPane()},n.isEmailSubscriptionEnabled=function(){return o.isEmailSubscriptionEnabled()},n.isInstantEmailEnabled=function(){return o.isInstantEmailEnabled()},n.navigateToContentList=function(){return o.navigateToContentList()},n.shareDashboard=function(e){return r.dashboardService.navigateToShareDashboard(e)},n.personalize=function(){return o.personalize()},n.getAdditionalODataFilter=function(){return r.navigation.additionalODataFilter},n.addDashboardFavorite=function(){return o.addDashboardFavorite()},n.deleteDashboardFavorite=function(){return o.deleteDashboardFavorite()},n.setHomeDashboard=function(){return o.setHomeDashboard()},n.unsetHomeDashboard=function(){return o.unsetHomeDashboard()},n.exploreContainerOptions=r.explorationCapabilities.getCapabilities(),n.showQna=function(){return o.showQna()},n.canWrite=function(){return!c.isActiveWorkspaceIsReadOnly},n.isOnHomeDashboard=r.home.isOnHomeDashboard(r.navigation.currentDashboardGUID),this.tileErrorDetails={},n.showDashboardTileErrors=!1,n.dashboardTileErrorCount=0,n.toggleTileError=function(){return o.toggleTileError()},n.showTileErrorDetails=function(){return o.showTileErrorDetails();
},n.$watch("dashboardDataService.activeDashboard",(function(t){if(t){o.hideAllNotifications();var i=o.isAppInstanceDashboard(t);if(n.favoriteEnabled=!r.dashboardConfigurationService.disableDashboardFavoriteButton&&!i,n.isOnHomeDashboard=r.home.isOnHomeDashboard(r.navigation.currentDashboardGUID),r.dashboardService.updateDashboardMenuItems(n),o.services.dashboardDataService.updateIsQnaEnabled(),o.updateShouldDisplayQuestionBox(),o.resetDashboardToWebView(t),o.toggleFullScreenByViewState(),o.resetDashboardTileErrors(),t.id>=0){var a=t.contract.originalPackageId,s=o.services.groupService.activeGroup,c=s&&s.aadGroupId,l=t.contract.originalDashboardObjectId;r.mostRecentlyUsedService.updateMRU(e.models.MRUArtifactType.Dashboards,t.objectId,t.displayName,t.getPermissions(),c,l,a),n.activeDashboardId=t.id}o.notifyIfModelRefreshDisabledBySelectiveRefresh()}})),n.showMoreOptionsMenu=function(e){return o.showMoreOptionsMenu(e)},n.moreOptionsMenuSelected=function(e){return o.onDashboardMenuItemSelected(e)},n.isMoreOptionsMenuAvailable=function(){return _.any(n.moreOptionsMenu)},n.$watchGroup(["dashboardDataService.isQnaEnabled","isActive"],(function(e){r.dashboardDataService.activeDashboard&&o.updateShouldDisplayQuestionBox()})),r.licenseEnforcementService.createNotificationForTrial(),r.localizationService.ensureLocalization((function(){var t=r.localizationService;n.newDashboardPlaceholder=t.get("NewDashboard_Placeholder"),n.dashboardReadOnlyText=t.get("DashboardReadOnly_Tooltip"),r.viralTenantMergeHelperService.viewingDataFromMergedViralTenant()&&r.notificationBar.notify({message:r.localizationService.get("ArchivedContent_HeaderMessage"),notificationType:e.common.NotificationBarType.Warning,actions:[{displayText:r.localizationService.get("ArchivedContent_BackToPowerBI"),linkId:1,action:function(){return n.navigation.toggleArchivedContent()}}],secondaryLink:{displayText:r.localizationService.get("LearnMore"),urlString:"https://go.microsoft.com/fwlink/p/?LinkId=522081"}}),n.errorMessageConfig={canEdit:n.canWrite(),mode:!1,titleShared:t.get("Dashboard_NoDashboardsWarningTitle_ReadOnlyMode"),titleNonShared:t.get("Dashboard_NoDashboardsWarningTitle"),contentShared:t.get("Dashboard_NoDashboardsWarningText_ReadOnlyMode"),contentNonShared:t.get("Dashboard_NoDashboardsWarningText")}})),n.getViewState=function(){return r.navigation.inRequestDashboardAccessView()?i.RequestAccess:t.dashboards.length>0?i.Normal:this.initialized?void 0:i.Uninitialized},r.home.onHomeSettingChanged.push((function(){n.isOnHomeDashboard=r.home.isOnHomeDashboard(r.navigation.currentDashboardGUID),r.dashboardService.updateDashboardMenuItems(n),1===o.viewModel.viewMode&&o.services.navigation.navigateToActiveDashboard()})),r.dashboardStateChangeService.registerDashboardContainerScope(n),n.$on(e.constants.actualOpenTileEventName,(function(e,t,i){return o.onActualOpenTile(e,t,i)})),n.$on(e.constants.updateTileHrefEventName,(function(e,t,i){return o.onUpdateTileHref(e,t,i)})),n.$watch("dashboardDataService.activeDashboard.isLoaded",(function(e){e&&r.navigation.inDashboardView()?r.dashboardWarningsService.showWarningsIfNeeded():r.dashboardWarningsService.hideDashboardWarnings()}));var p=r.rootScope,u=p.$on(l.shouldShowEnableCustomVisualsDialog,(function(e){return r.dashboardWarningsService.showWarningsIfNeeded()})),h=p.$on(e.constants.dashboardTileErrorEventName,(function(e,t,i){return o.onDashboardTileError(e,t,i)})),v=p.$on(e.constants.removeDashboardTileErrorEventName,(function(e,t,i){return o.onRemoveDashboardTileError(e,t,i)}));if(p.$on(e.constants.removeTileEventName,(function(e,t){return o.onRemoveTile(e,t)})),n.$on("$destroy",(function(){o.viewModel.viewMode=0,o.toggleFullScreenByViewState(),u(),h(),v(),o.unregisterViewModelWatch&&o.unregisterViewModelWatch(),r.dashboardStateChangeService.unregisterDashboardContainerScope(),r.dashboardDataService.unregisterRefreshStateListener(o),o.hideAllNotifications()})),this.initialized=!0,r.navigation.inRequestDashboardAccessView()&&this.services.dashboardService.requestDashboardAccess(r.navigation.currentDashboardGUID),n.viewModel.dashboards&&0===n.viewModel.dashboards.length&&n.viewModel.contract.reports&&n.viewModel.contract.reports.length>0&&r.permissionService.isActiveWorkspaceIsReadOnly){var g=this.services.reportService.findReportByGUID(n.viewModel.contract.reports[0].objectId);this.services.navigationHelper.navigateToReport(g)}if(d.inSharingView()&&r.timeout((function(){r.dashboardService.navigateToShareDashboard(d.currentDashboardGUID),o.showShareSlider()})),d.inAlertsEditorView()&&r.timeout((function(){var e=n.$watch("dashboardDataService.activeDashboard.isLoaded",(function(t){if(d.inAlertsEditorView()){if(!t)return;var i=o.setAndGetActiveTile();i&&o.services.taskPaneSliderService.expandPane(9,a.Small)}e()}))})),d.inInFocusView()||d.inInFocusInsightsView())r.timeout((function(){var e=n.$watch("dashboardDataService.activeDashboard.isLoaded",(function(t){if(d.inInFocusView()||d.inInFocusInsightsView()){if(!t)return;var i=o.setAndGetActiveTile();i&&r.inFocusService.view(i,void 0,d.inInFocusInsightsView())}e()}))}));else if(this.services.navigation.inDashboardSubscription()){var f=s.activeDashboard.contract;this.services.subscription.expandPaneForDashboardSubscription({dashboardId:f.id,dashboardName:f.displayName,dashboardObjectId:f.objectId,modelIds:f.modelIds},this.services.navigation.currentSubscriptionGUID)}}},D.prototype.onStateChange=function(e,t){this.scope.refreshState=e},D.prototype.showMoreOptionsMenu=function(e){var t=this;d.showLegacyDropdownItems(this.services.dropdown,"moreOptionsMenu",this.scope.moreOptionsMenu,"additionalMenus",(function(e){return t.scope.moreOptionsMenuSelected(e)}),{anchorElement:$(e.target),preferLeft:!0,horizontal:!1})},D.showDashboardDoesNotExistDialog=function(t,i,o,r){e.helpers.ArtifactNotFoundHelper.showArtifactDoesNotExistDialog("ArtifactKind_Dashboard",t,i,o),r.navigateToContentListOrActiveDashboard()},D.showTileDoesNotExistDialog=function(t,i,o){e.helpers.ArtifactNotFoundHelper.showArtifactDoesNotExistDialog("ArtifactKind_Tile",t,i,o)},D.prototype.updateCurrentViewMode=function(e){var t=this.services.dashboardDataService.activeDashboard;switch(e.action){case 5:var i=_.any(this.scope.moreOptionsMenu,(function(e){return 2===e.action}));i||this.services.dashboardService.updateDashboardMenuItems(this.scope),_.remove(this.scope.moreOptionsMenu,(function(e){return 9===e.action})),this.services.mobileAuthoringService.switchLayoutStrategy(t,new n.DefaultGridLayoutStrategy,0),this.viewModel.viewMode=0;break;case 6:var o=_.any(this.scope.moreOptionsMenu,(function(e){return 9===e.action}));o||this.services.dashboardService.updateDashboardMenuItems(this.scope),_.remove(this.scope.moreOptionsMenu,(function(e){return 2===e.action})),this.services.navigation.navigateToDashboardMobileAuthoringByGUID(this.services.navigation.currentDashboardGUID)}this.toggleFullScreenByViewState()},D.showDuplicateDashboardDialog=function(t,i,o,r){var a=r.defer();return o.ensureLocalization((function(){var r=i.control(),n=o.get("ModalDialog_Duplicate"),s=o.get("Duplicate_Dashboard"),c=o.get("Dashboard_DuplicateDialogMessage"),l='<section class="duplicateDialog"><div class="message"></div><input type="text" class="dashboardSaveAsName" /></section>',d=$(l);d.find(".message").text(c);var p=d.find(".dashboardSaveAsName");p.val(o.format("Dashboard_DuplicateDialogNameTemplate",[t]));var u=[new InJs.ModalDialogAction(n,function(e,t){var i=b.trimWhitespace(p.val());r.hideDialog(),a.resolve(i)}),new InJs.ModalDialogAction(e.common.localize.get("ModalDialog_Cancel"),function(e,t){r.hideDialog(),a.reject()})];r.showCustomDialog(s,d,u,(function(e){var t=e.parent().find('input[value = "'+n+'"]');p.focus().on("change keyup paste mouseup",(function(e){var i=b.isNullOrUndefinedOrWhiteSpaceString($(e.target).val());t.prop("disabled",i)})).on("keyup",(function(e){13!==e.which||b.isNullOrUndefinedOrWhiteSpaceString($(e.target).val())?27===e.which&&u[1].actionCallback(null,null,null):u[0].actionCallback(null,null,null)}))}),!0)})),a.promise},Object.defineProperty(D.prototype,"contentProviders",{get:function(){return this.services.contentProviderHttpService.getBuiltInContentProviders()},enumerable:!0,configurable:!0}),D.prototype.setAndGetActiveTile=function(){var e=this.services.dashboardDataService.activeDashboard,i=this.getValidTileNavState(e);return i?(this.services.dashboardService.selectDashboardTile(new c(i)),i):void t.DashboardContainerController.showTileDoesNotExistDialog(this.services.errorService,this.services.localizationService,this.services.telemetryService)},D.prototype.getValidTileNavState=function(e){var t=this.services.navigation.currentTileGUID,i=this.services.navigation.currentTileOriginalGUID;return e.findTileByObjectIdOrOriginalObjectId(t,i)},D.prototype.updateShouldDisplayQuestionBox=function(){this.scope.shouldDisplayQuestionBox=this.scope.dashboardDataService.isQnaEnabled&&this.scope.isActive},D.prototype.addDashboardFavorite=function(){var e=this.services.dashboardService.getActiveDashboard();e&&(e.isFavorite=!0,e.isFavoriteDisabled=!0,this.services.favorites.addFavorite(e).then((function(t){e.favoriteInfo=t})).finally((function(){e.isFavoriteDisabled=!1})))},D.prototype.deleteDashboardFavorite=function(){var e=this.services.dashboardService.getActiveDashboard();e&&this.services.favorites.deleteFavorite(e)},D.prototype.resetDashboardToWebView=function(e){e&&(e.gridLayoutService||(e.gridLayoutService=this.services.gridLayout),this.services.mobileAuthoringService.switchLayoutStrategy(e,new n.DefaultGridLayoutStrategy,0),this.viewModel.viewMode=0)},D.prototype.isAppInstanceDashboard=function(t){var i=t&&t.getUniquePackageId();if(!i)return!1;var o=this.services.packageService.findPackage(i);return!!o&&o.packageType===e.dataServices.contracts.PackageType.AppInstance},D.prototype.showQna=function(){this.services.navigation.showQnaView()},D.prototype.personalize=function(){this.services.dashboardDataService.activeDashboard.getPermissions()===m.CopyOnWrite&&this.scope.$emit(e.constants.personalizeEventName,this.services.dashboardDataService.activeDashboard.contract.originalPackageId)},D.prototype.onActualOpenTile=function(t,i,o){t&&t.stopPropagation&&t.stopPropagation();var r,a=this.services.telemetryService;i.contractsModel&&(r=i.contractsModel.contentProviderId);var n=e.common.findContentProviderName(this.contentProviders,r),s=a.startEvent(e.telemetry.DashboardOpenTile,null,i.report?i.report.id:i.id,"No error",r,n);switch(i.action.action){case y.openReportActionName:this.openReportTile(i,o,s);break;case y.custom.openUrlActionName:this.openUrlTile(i,s);break;case y.openInsightsActionName:case y.openInFocusActionName:this.services.inFocusService.view(i);break;case y.openWorkbookActionName:this.openWorkbookTile(i,o,s);break;case y.openQnAActionName:this.openQnaTile(i,s)}},D.prototype.onUpdateTileHref=function(e,t,i){return v(i)?void(t.intraDomainNavigationParameters=this.getDashboardNavigationParameters(t,this.getIntraDomainNavigationTargetName(i))):g(i)?void(t.intraDomainNavigationParameters=this.getReportNavigationParameters(t,this.getIntraDomainNavigationTargetName(i))):(t.intraDomainNavigationParameters=void 0,void(t.href=i))},D.prototype.onDashboardTileError=function(e,t,i){e&&e.stopPropagation&&e.stopPropagation();var o=this.services.pinTileService.pinTileScope;if(o&&o.viewModel){var r=o.viewModel;if(r.dashboardTile===t||r.reportTile===t||r.workbookTile===t)return}var a=i.message,n=this.tileErrorDetails[a]?this.tileErrorDetails[a].tileIds:null;n?n.indexOf(t.id)<0&&(n.push(t.id),this.scope.dashboardTileErrorCount++):(this.tileErrorDetails[a]={tileIds:[t.id],errorDetails:i},this.scope.dashboardTileErrorCount++)},D.prototype.onRemoveDashboardTileError=function(e,t,i){e&&e.stopPropagation&&e.stopPropagation();var o=i.message,r=this.tileErrorDetails[o]?this.tileErrorDetails[o].tileIds:null;if(!_.isEmpty(r)){var a=r.indexOf(t.id);a>=0&&(r.splice(a,1),this.scope.dashboardTileErrorCount--,_.isEmpty(r)&&delete this.tileErrorDetails[o])}},D.prototype.getDashboardNavigationParameters=function(e,t){if(e.href=void 0,t){var i=this.services.dashboardService.dashboardContainerModel.visibleDashboards,r=this.services.dashboardDataService.activeDashboard,a=r&&r.getUniquePackageId(),n=r&&o.getDashboardAppGUID(r,this.services.appService,this.services.packageService);n&&(i=_.filter(i,(function(e){return e.getUniquePackageId()===a})));var s=_.filter(i,(function(e){return e.displayName.toLowerCase()===t||e.objectId.toLowerCase()===t||e.contract.originalDashboardObjectId&&e.contract.originalDashboardObjectId.toLowerCase()===t}));if(!_.isEmpty(s)){var c=s[0];s.length>1&&a&&(c=_.find(s,(function(e){return e.getUniquePackageId()===a}))||c);var l=a;return n&&!o.isOrgAppInstance(l,this.services.appService)||(l=null),{navigationTargetGuid:c.objectId,navigationTargetOriginalGuid:c.contract.originalDashboardObjectId,navigationTargetAppGuid:n,navigationType:h.Dashboard,navigationSubPage:null,appInstance:l}}}},D.prototype.getReportNavigationParameters=function(e,t){if(e.href=void 0,t){var i=this.services.reportService.reports,r=this.services.dashboardDataService.activeDashboard,a=r&&o.getDashboardAppGUID(r,this.services.appService,this.services.packageService),n=r&&r.getUniquePackageId();a&&(i=_.filter(i,(function(e){return e.packageId===n})));var s=_.filter(i,(function(e){return e.displayName.toLowerCase()===t||e.objectId.toLowerCase()===t||e.contract.originalReportObjectId&&e.contract.originalReportObjectId.toLowerCase()===t}));if(!_.isEmpty(s)){var c=s[0];s.length>1&&n&&(c=_.find(s,(function(e){return e.packageId===n}))||c);var l=n;return a&&!o.isOrgAppInstance(l,this.services.appService)||(l=null),{navigationTargetGuid:c.objectId,navigationTargetOriginalGuid:c.contract.originalReportObjectId,navigationTargetAppGuid:a,navigationType:h.Report,navigationSubPage:null,appInstance:l,additionalODataFilter:null}}}},D.prototype.getIntraDomainNavigationTargetName=function(e){var t=e.split("/");return t.length<3?null:decodeURIComponent(t[2]).toLowerCase()},D.prototype.openReportTile=function(t,i,o){if(this.canOpenReport(t)){o.event.info.tileType=e.telemetry.ContentTypes.Report;var r=this.services.dashboardService.findDashboard(i);if(t.report&&t.report.id){var a=void 0,n=void 0;t.action&&(a=t.action.targetSlideId,this.services.featureSwitchService.featureSwitches.usageMetricsEnabled&&this.services.usageMetricsReport.reportBelongsToUsageMetricsContentPack(t.report.contract)&&(n=t.action.filter)),t.report.model=t.contractsModel,t.report.packageId=t.contract.packageId;var s=this.services;s.reportService.addReport(t.report),s.modelService.addModel(s.modelConverter.convertModel(t.report.model));var c=r&&r.objectId;s.navigationHelper.navigateToReport(t.report,s.groupService.activeGroupObjectId,a,c,n)}else{var l=r.getPermissions();if(r.isHidden||(l&m.Write)!==m.Write)return;this.services.quota.checkQuotaExceeded()||this.services.permissionService.isActiveWorkspaceIsReadOnly||this.services.navigation.navigateToDataset({datasetDBName:t.contractsModel.dbName,instantiationMode:f.NonTemplateForExistingTile,datasetId:t.contractsModel.id})}}o.resolve()},D.prototype.canOpenReport=function(e){if(!e.contractsModel){var t=e.contract.modelId,i=this.services.dashboardService.dashboardContainerModel.contract.models;if(!i)return!1;for(var o=i.length,r=0;r<o;r++)i[r].id===t&&(e.contractsModel=i[r])}var a=null!=e.contractsModel&&null!=e.contractsModel.vsName&&null!=e.contractsModel.dbName,n=2===e.contract.publishState;return a&&n},D.prototype.openUrlTile=function(t,i){if(!t.href&&t.intraDomainNavigationParameters){var o=t.intraDomainNavigationParameters;switch(o.navigationType){case h.Dashboard:o.navigationTargetAppGuid?this.services.navigation.navigateToAppDashboardByGUID(o.navigationTargetGuid,o.navigationTargetOriginalGuid,o.navigationTargetAppGuid,this.services.groupService.activeGroupObjectId,null,!0,o.appInstance):this.services.navigation.navigateToDashboardByGUID(o.navigationTargetGuid);break;case h.Report:this.services.navigation.navigateToReport({appGUID:o.navigationTargetAppGuid,appInstanceId:o.appInstance,reportGUID:o.navigationTargetGuid,reportOriginalGUID:o.navigationTargetOriginalGuid,groupGUID:this.services.groupService.activeGroupObjectId,reportPage:o.navigationSubPage,filter:o.additionalODataFilter})}}i.event.info.tileType=e.telemetry.ContentTypes.Url,i.resolve()},D.prototype.openWorkbookTile=function(e,t,i){var o,r=this.services.workbookService.findWorkbook(e.contract.workbookId,e.contract.packageId),a=this.services.workbookService.getWorkbookUniqueId(r);o=e.contract.$config.workbookTile.itemType===p.NamedRange||e.contract.$config.workbookTile.itemType===p.Table?e.contract.$config.workbookTile.item:e.contract.$config.workbookTile.activeSelection;var n=this.services.ownership.isResourceSharedWithMe(r);this.services.navigation.navigateToWorkbookByUrlId(a,o,n,this.services.navigation.currentDashboardGUID)},D.prototype.openQnaTile=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a,n,c,l,d,p,u=this;return __generator(this,(function(h){switch(h.label){case 0:return i.event.info.tileType=e.telemetry.ContentTypes.QnA,o=t.contract,r=o.query.modelQuery,a=o.$config,n={name:"powerbi.qnacore",namespace:"powerbi.explore.infonav",dependency:{javascript:"qnacore",css:["qnacore"]}},[4,this.services.pbiLazyLoad.load(n)];case 1:if(h.sent(),o.type===S.report)c=a&&a.reportTile,l={modelId:o.modelId,utterance:r.utterance,openTileTelemetryEvent:i,reportPageTile:{reportId:o.reportId,sectionId:o.sectionId,pod:c&&c.pod,filters:c&&c.filters}},this.services.timeout((function(){u.services.rootScope.$emit(e.infonav.constants.openTileEventName,l)}),D.runningQueryDelayMs);else{if(d=s(o.query),p=a.visualContainer.$visualContainer,!e.helpers.VisualQueryUtil.canVisualizeQuery(d.defn,p.filters))return this.services.navigation.showQnaView(t.utterance,0,!1),[2];this.services.timeout((function(){u.services.rootScope.$emit(e.infonav.constants.openTileEventName,{modelId:o.modelId,utterance:r.utterance,openTileTelemetryEvent:i,visualContainer:p})}),D.runningQueryDelayMs)}return this.services.navigation.inQnaView()||this.services.navigation.showQnaView(),[2]}}))}))},D.prototype.onRemoveTile=function(e,t){e&&e.stopPropagation&&e.stopPropagation(),this.services.dashboardWarningsService.showWarningsIfNeeded(),this.removeTileAndUpdateTileErrorCount(t)},D.prototype.onDashboardMenuItemSelected=function(e){var t=this.services;if(t.overlayService.hideAllDropdowns(),null!=e.action)switch(e.action){case 0:this.duplicateDashboard();break;case 3:this.refreshDashboard();break;case 2:this.printDashboard();break;case 4:this.setHomeDashboard();break;case 8:this.unsetHomeDashboard();break;case 1:t.taskPaneSliderService.expandPane(20,a.Medium);break;case 7:var i=t.dashboardDataService.activeDashboard.objectId;t.settingsMetadataService.setSettings(1,i),t.taskPaneSliderService.expandPane(12,a.Medium)}},D.prototype.toggleFullScreenByViewState=function(){var e=$(".enterFullScreenBtn");e.length>0&&(0===this.viewModel.viewMode?e.show():e.hide())},D.prototype.duplicateDashboard=function(){var t=this.services.dashboardDataService.activeDashboard,i=this.services,o=i.localizationService;i.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.AddDashboard)||D.showDuplicateDashboardDialog(t.displayName,i.errorService,o,i.promiseFactory).then((function(r){i.dashboardService.duplicateDashboard(t.contract,r).then((function(r){var a=o.get("DuplicateDashboard_Success"),n=o.format("DuplicateDashboard_Success_Details",[t.displayName]);i.notificationToast.notify({title:a,message:n,notificationType:e.common.NotificationToastType.Success})}),(function(){var r=o.get("DuplicateDashboard_Error"),a=o.format("DuplicateDashboard_Error_Details",[t.displayName]);i.notificationToast.notify({title:r,message:a,notificationType:e.common.NotificationToastType.Error})}))}))},D.prototype.setHomeDashboard=function(){this.services.home.setHomeDashboardDialog(this.services.dashboardDataService.activeDashboard,this.services.groupService.activeGroupObjectId)},D.prototype.unsetHomeDashboard=function(){this.services.home.disableHomeDashboard()},D.prototype.printDashboard=function(){this.services.$window.print(),this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsPrint,e.telemetry.PrintType.Dashboard);var t=this.services.dashboardDataService.activeDashboard;this.services.auditing.auditEvent(t.id,e.common.contracts.AuditEntityType.Dashboard,e.common.contracts.AuditActivityType.printDashboard)},D.prototype.refreshDashboard=function(){var t=this,i=this.services.dashboardDataService.activeDashboard;if(0!==i.tiles.length){var o=this.services.notificationToast.notify({message:this.services.localizationService.get("Dashboard_RefreshStart"),notificationType:e.common.NotificationToastType.Loading}),r=this.createRefreshEvent();this.services.dashboardHttpService.refreshTileData(i.id,null,r.event).then((function(i){t.services.notificationToast.hide(o),t.services.notificationToast.notify({message:t.services.localizationService.get("Dashboard_RefreshCompletedSuccess"),notificationType:e.common.NotificationToastType.Success}),t.services.dashboardService.checkRefreshTileResponse(i.data),r.resolve()}),(function(e){t.services.notificationToast.hide(o),t.services.errorService.error(t.services.localizationService.get("Dashboard_RefreshCompletedFailure"),"Dashboard_RefreshCompletedFailure",{requestId:e.requestId,statusCode:e.status.toString()}),r.reject()}))}},D.prototype.createRefreshEvent=function(){var t=this.services.dashboardDataService.activeDashboard,i=this.services.dashboardService.getVisualCountData(),o=i.scriptVisualsCount,r=i.reportTilesWithR,a=i.totalVisualsCount;return this.services.telemetryService.startEvent(e.telemetry.DashboardRefreshDashboardTiles,t.objectId,a,o,r)},D.prototype.showRelatedContentPane=function(){var e=!this.isDashboardEditable(),t={id:this.services.dashboardDataService.activeDashboard.objectId,artifactType:r.Dashboard,displayName:this.services.dashboardDataService.activeDashboard.displayName,readOnly:e&&!this.scope.inAppView()};this.services.taskPaneSliderService.expandPane(17,a.Default,t)},D.prototype.isDashboardEditable=function(){return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&this.services.dashboardDataService.activeDashboard&&this.services.dashboardDataService.activeDashboard.canEdit},D.prototype.showTileGalleryPane=function(){this.services.telemetryService.logEvent(e.telemetry.DashboardAddWidget),this.services.taskPaneSliderService.expandPane(5,a.Large)},D.prototype.showShareSlider=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,o,r,n;return __generator(this,(function(s){switch(s.label){case 0:return e=this.services,e.licenseEnforcementService.supportsSharing(!0)?this.services.featureSwitchService.featureSwitches.permissionCenterEnabled?[4,this.services.lazy("permissionData")]:[3,4]:[2];case 1:return t=s.sent(),[4,t.getPermissionArtifactByObjectId(1,this.services.dashboardDataService.activeDashboard.objectId,0)];case 2:return i=s.sent(),o=i.hasReshareForAllUnderlyingArtifacts(),o?[3,4]:[4,this.services.moduleLoader.require({javascript:"PermissionsUI/components/permissionCannotShareDialog/permissionCannotShareDialogBuilder"})];case 3:return r=s.sent(),n=r.createPermissionCannotShareDialogBuilder(this.services.modalDialogService),n.show(i),[2];case 4:return this.services.taskPaneSliderService.expandPane(6,a.Large),[2]}}))}))},D.prototype.openUsageMetricsReport=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o;return __generator(this,(function(r){switch(r.label){case 0:t=this.services.dashboardDataService.activeDashboard,i=this.services.telemetryService.startEvent(e.telemetry.UsageMetricsViewUsageMetricsReport,e.constants.usageMetrics_Dashboard,t.objectId,e.constants.usageMetrics_Dashboard),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.services.usageMetricsReport.openDashboardUsageMetricsReport(t,this.services.groupService.activeGroupObjectId,i)];case 2:return r.sent(),i.resolve(),[3,4];case 3:return o=r.sent(),i.reject(e.errorDetailsHelper.getTelemetryErrorDetails(o.error)),[3,4];case 4:return[2]}}))}))},D.prototype.showInstantEmailPane=function(){var e=this;this.services.lazy("instantEmail").then((function(t){var i=e.getDashboardInfo();if(i){var r=e.services.dashboardDataService.activeDashboard,a=r&&o.getDashboardAppGUID(r,e.services.appService,e.services.packageService);i.contentProviderKey=a,t.expandPaneForInstantDashboardEmail(i)}}))},D.prototype.showSubscriptionPane=function(){var e=this.getDashboardInfo();e&&this.services.subscription.expandPaneForDashboardSubscription(e)},D.prototype.getDashboardInfo=function(){var t,i=this,o=_.filter(this.viewModel.dashboards,(function(e){return e.contract.objectId===i.services.navigation.currentDashboardGUID})),r=o[0].contract,a=this.services.dashboardService.findDashboard(r.id);if(_.isEmpty(r.modelIds))return void(t=new u(this.services.modalDialogService).show("ModalDialog_EmailSubscriptionUnSupportedEmptyDashboardTitle","ModalDialog_EmailSubscriptionUnSupportedEmptyDashboardText","https://go.microsoft.com/fwlink/?linkid=849073"));if(a.getPermissions()===e.common.contracts.Permissions.CopyOnWrite&&!this.isEmailSubscriptionForAppsEnabled())return void(t=new u(this.services.modalDialogService).show("ModalDialog_EmailSubscriptionUnSupportedDashboardContentPackTitle",this.services.featureSwitchService.featureSwitches.appsEnabled?"ModalDialog_DashboardEmailSubscriptionUnSupportedContentPackOrAppMessage":"ModalDialog_DashboardEmailSubscriptionUnSupportedContentPackMessage","https://go.microsoft.com/fwlink/?linkid=849073"));var n={dashboardName:r.displayName,dashboardId:r.id,modelIds:r.modelIds,dashboardObjectId:r.objectId};return n},D.prototype.isEmailSubscriptionEnabled=function(){return this.services.featureSwitchService.featureSwitches.dashboardEmailSubscription&&1!==this.viewModel.viewMode&&this.services.emailSubscriptionService.supportsEmailSubscription},D.prototype.isInstantEmailEnabled=function(){return this.services.featureSwitchService.featureSwitches.instantEmail&&1!==this.viewModel.viewMode&&this.services.emailSubscriptionService.supportsEmailSubscription},D.prototype.isEmailSubscriptionForAppsEnabled=function(){var e=this.services.featureSwitchService.featureSwitches;return e.appEmailSubscription&&e.appPublishDiffing},D.prototype.navigateToContentList=function(){this.services.navigation.navigateToContentList(this.services.groupService.activeGroupObjectId)},D.prototype.toggleTileError=function(){this.scope.showDashboardTileErrors=!this.scope.showDashboardTileErrors;var e=this.services.dashboardDataService.activeDashboard.tiles;if(this.scope.showDashboardTileErrors)_.forOwn(this.tileErrorDetails,(function(t){for(var i=t.tileIds,o=function(t){var i=_.find(e,(function(e){return e.id===t}));i&&(i.isSelected=!0)},r=0,a=i;r<a.length;r++){var n=a[r];o(n)}}));else for(var t=0,i=this.services.dashboardDataService.activeDashboard.tiles;t<i.length;t++){var o=i[t];o.isSelected=!1}},D.prototype.showTileErrorDetails=function(){var t=this.services.localizationService,i=this.scope.$new(),o=[],r=0;for(var a in this.tileErrorDetails){var n={errorDetails:this.tileErrorDetails[a].errorDetails,count:this.tileErrorDetails[a].tileIds.length};r+=n.count,o.push(n)}i.tileErrors=o,i.title=t.format("DashboardAppBar_TileError_ErrorDialogSubTitle",[e.formattingService.formatValue(r)]),this.services.modalDialogService.showLegacyWebModalDialog({dialogName:t.get("DashboardAppBar_TileError_ErrorDialogTitle"),template:w,scope:i,isDismissable:!0,dialogActions:[new InJs.ModalDialogAction(t.get("PBI_Button_Label_Close"),function(e,t){i.closeDialog()},null,"")]})},D.prototype.updateTileErrorCount=function(){var e=this;this.scope.dashboardTileErrorCount=0,this.tileErrorDetails&&_.forOwn(this.tileErrorDetails,(function(t){var i=t.tileIds;e.scope.dashboardTileErrorCount+=i.length}))},D.prototype.removeTileAndUpdateTileErrorCount=function(e){var t=this;this.tileErrorDetails&&_.forOwn(this.tileErrorDetails,(function(i,o){var r=i.tileIds,a=r.indexOf(e.id);a>=0&&r.splice(a,1),0===r.length&&delete t.tileErrorDetails[o]})),this.updateTileErrorCount()},D.prototype.notifyIfModelRefreshDisabledBySelectiveRefresh=function(){var t=this.services,i=t.dashboardDataService;t.featureSwitchService.featureSwitches.selectiveModelRefresh&&i.isActiveDashboardModelRefreshDisabled()&&this.notificationIds.push(t.notificationBar.notify({message:t.localizationService.get("Notification_InactiveModelRefreshDisabled"),notificationType:e.common.NotificationBarType.Warning,secondaryLink:{displayText:t.localizationService.get("LearnMore"),urlString:e.constants.configureScheduledRefreshLink}}))},D.prototype.hideAllNotifications=function(){for(var e=this.services.notificationBar;!_.isEmpty(this.notificationIds);)e.hide(this.notificationIds.pop());this.notificationIds=[]},D.prototype.resetDashboardTileErrors=function(){this.tileErrorDetails={},this.scope.showDashboardTileErrors=!1,this.scope.dashboardTileErrorCount=0},D.runningQueryDelayMs=100,D})();t.DashboardContainerController=D})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.ArrowPosition,o=e.common.models.TooltipTheme,r=(function(){function e(e,t,i,o,r,a,n,s,c){this.uiSref=e,this.tooltipTemplate=t,this.entity=i,this.stateOptions=o,this.customClass=r,this.beforeIcon=a,this.beforeIconSize=n,this.afterIcon=s,this.afterIconSize=c}return Object.defineProperty(e.prototype,"label",{get:function(){return this.entity.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tooltipConfig",{get:function(){return{tooltipTitle:this.entity.displayName,tooltipArrowPosition:i.arrowTopMiddle,tooltipTheme:o.Dark}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tooltipTemplateConfig",{get:function(){return{tooltipTitle:this.createTemplateTooltipTitle(this.entity.displayName),tooltipArrowPosition:i.arrowTopMiddle,tooltipTheme:o.Dark}},enumerable:!0,configurable:!0}),e.prototype.createTemplateTooltipTitle=function(e){return this.tooltipTemplate.replace("{0}",e)},e})();t.BreadcrumbEntity=r})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=e.common.contracts.ContentTileType;!(function(e){e[e.Dashboards=0]="Dashboards",e[e.Reports=1]="Reports",e[e.Workbooks=2]="Workbooks",e[e.AppInstance=3]="AppInstance"})(i=t.MRUArtifactType||(t.MRUArtifactType={}));var r=(function(){function e(e,t,i,r){this.type=e,this.objectId=t,this.workspaceId=i,this.packageid=r,this.count=0,this.contentTileType=o.MRU,this.uniqueId=e+"_"+t+"_"+i+"_"+r}return e.prototype.getPermissions=function(){return this.permissions},e})();t.MRUModel=r})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.constants.navigation.states,o=e.common.constants.navigation.states;t.SimpleBreadcrumbs={firstSegment:[{state:i.adminPortal,labelResourceKey:"AdminPortal_Title"},{state:i.apps,labelResourceKey:"Apps_AppsTitle",icon:"my-apps",terminal:!1},{state:i.favorites,labelResourceKey:"Favorites_FavoritesTitle",icon:"favoritestar"},{state:i.recentlyViewed,labelResourceKey:"RecentlyViewed_NavPaneTitle",icon:"mru"},{state:i.settings,labelResourceKey:"TopNav_Settings"},{state:i.workspaces,labelResourceKey:"NavigationPane_Workspaces",icon:"collections"}],secondSegment:[{state:o.datasets,labelResourceKey:"NavigationPane_DatasetsTitle",strictState:!0},{state:i.gateways,labelResourceKey:"EnterpriseGateway_Title"},{state:i.manageStorage,labelResourceKey:"QuotaManagement_ManageStorage"},{state:i.manageEmbed,labelResourceKey:"TopNav_SettingsMenu_ManageEmbedCodes"},{state:i.publishApp,labelResourceKey:"CreateApp_Publish"},{state:i.insights,labelResourceKey:"InsightsPane_InsightsTitle"},{state:i.viewContent,labelResourceKey:"TopNav_SettingsMenu_ViewContentPack"}],thirdSegment:[{state:i.appDashboardQna,labelResourceKey:"SettingsDashboard_QnA_Title"
},{state:i.appInFocusMode,labelResourceKey:"InFocus_Title"},{state:i.appInFocusInsights,labelResourceKey:"InsightsPane_InsightsTitle"},{state:i.dashboardQna,labelResourceKey:"SettingsDashboard_QnA_Title"},{state:i.inFocusMode,labelResourceKey:"InFocus_Title"},{state:i.inFocusInsights,labelResourceKey:"InsightsPane_InsightsTitle"},{state:i.sharedDashboardQna,labelResourceKey:"SettingsDashboard_QnA_Title"},{state:i.sharedInFocusMode,labelResourceKey:"InFocus_Title"},{state:i.sharedInFocusInsights,labelResourceKey:"InsightsPane_InsightsTitle"},{state:i.appInsights,labelResourceKey:"InsightsPane_InsightsTitle"}]}})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function o(e,t,i,o,r,a,n,s,c,l,d,p,u,h,g,m,f,b,y){return new v(e,t,i,o,r,a,n,s,c,l,d,p,u,h,g,m,f,b,y)}var r=e.dataServices.AppUtils,a=e.common.ArrowPosition,n=t.BreadcrumbEntity,s=e.common.constants.navigation.states,c=e.dataServices.models.Dashboard,l=e.common.models.Report,d=t.SimpleBreadcrumbs,p=e.constants.navigation.states,u=e.common.models.TooltipTheme,h=e.dataServices.models.Workbook;i.createBreadcrumbFactory=o;var v=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b){this.localizationService=e,this.navigationService=t,this.groupService=i,this.dashboardDataService=o,this.homeService=r,this.reportService=a,this.workbookService=n,this.modelService=s,this.permissionService=c,this.asyncFeatureSwitchService=d,this.promiseFactory=p,this.ownershipService=u,this.appService=h,this.packageService=g,this.usageMetricsReport=m,this.featureSwitchService=f,this.lazy=b,this.tooltipTemplate=this.localizationService.get("Breadcrumb_Tooltip")}return t.prototype.createCurrentBreadcrumbs=function(t){var i=this;t=t||{};var o=[];if(this.addSimpleBreadcrumbs(o,d.firstSegment))return o;if(this.navigationService.inHomeDashboardView())return this.homeService.isHomeDashboardSet?this.dashboardDataService.getDashboards().then((function(){var e=i.homeService.homeDashboard,t=e?i.dashboardDataService.findDashboardByGUID(e.dashboardObjectId):null;t&&o.push(i.createDashboardBreadcrumb(p.home,t))})):o.push(this.createEmptyFeaturedDashboardBreadcrumb()),o;if(this.navigationService.inGroupView()&&!this.navigationService.inAppsView()&&!this.navigationService.inContentListView(!0)){var a=this.promiseFactory.all([this.groupService.ensureGroupsInitialization(),this.dashboardDataService.getDashboards(),this.asyncFeatureSwitchService.getFeatureSwitches()]).then((function(){var e,t=i.dashboardDataService.activeDashboard,o=i.groupService.activeGroup;return i.isDashboardShared(t)?e=i.createSharedWithMeBreadcrumb():o&&(e=new n(p.contentList,i.tooltipTemplate,o)),e}));this.insertBreadcrumbAsync(o,a)}if(this.addSimpleBreadcrumbs(o,d.secondSegment))return o;if(this.navigationService.inGetDataView()){var c=this.navigationService.getDataViewName,l="getapps"===c?"GetApps":"NavigationPane_GetData",u=this.localizationService.get(l),h=p.getData+"({getDataView:'"+c+"'})";o.push({uiSref:h,label:u,tooltipConfig:this.createCommonTooltipConfig(u),tooltipTemplateConfig:this.createCommonTemplateTooltipConfig(u)})}if(this.navigationService.inAppView()){var v=this.navigationService.currentAppGUID,g=this.navigationService.currentAppInstanceId,a=this.appService.ensureAppsInitialization().then((function(){g||(g=r.getPackageIDByOrgAppGUID(i.appService,i.packageService,v));var e=i.appService.getAppInstance(g);if(e)return i.createAppBreadcrumb(e)}));this.insertBreadcrumbAsync(o,a)}if(this.navigationService.inDashboardPath()){var a=this.dashboardDataService.getDashboards().then((function(){var e=i.dashboardDataService.activeDashboard;if(e){var t=p.dashboard;return i.navigationService.inAppInstanceView()?t=p.appInstanceDashboard:i.navigationService.inAppView()?t=p.appDashboard:i.navigationService.inSharedWithMePath()&&(t=p.sharedDashboard),i.createDashboardBreadcrumb(t,e)}}));this.insertBreadcrumbAsync(o,a)}var m=this.navigationService.inReportView();if(m||t.subsituteReportForDataset){var f=this.reportService.getReports().then((function(){var e=t.reportGUID||i.navigationService.currentReportGUID,r=i.reportService.findReport(t.reportId)||i.reportService.findReportByGUID(e)||{id:t.reportId,displayName:t.reportName,objectId:t.reportGUID};if(i.usageMetricsReport.reportBelongsToUsageMetricsContentPack(r)){var a=i.navigationService.additionalODataFilter,c=i.promiseFactory.defer(),l=i.localizationService.get("UsageMetrics_Label");return c.resolve(new n(s.report,i.tooltipTemplate,{displayName:l})),i.insertBreadcrumbAsync(o,c.promise),i.usageMetricsReport.getContentTileFromUsageMetricsFilters(a).then((function(e){var t=i.promiseFactory.defer();return t.resolve(i.createUsageMetricsBreadcrumb(e)),t.promise}))}if(r){var d=s.report;return m&&(i.navigationService.inAppInstanceView()?d=s.appInstanceReport:i.navigationService.inAppView()?d=s.appReport:i.navigationService.inSharedWithMePath()&&(d=p.sharedDashboardReport)),f=new n(d,i.tooltipTemplate,r)}}));this.insertBreadcrumbAsync(o,f)}if(this.navigationService.inWorkbookView()){var a=this.workbookService.getWorkbooks().then((function(){var e=i.navigationService.currentWorkbookURLIdentifier,t=i.workbookService.findWorkbookByUniqueId(e),o=s.workbook;if(i.navigationService.inAppView()?o=s.appWorkbook:i.navigationService.inSharedWithMePath()&&(o=p.sharedDashboardWorkbook),t)return new n(o,i.tooltipTemplate,t)}));this.insertBreadcrumbAsync(o,a)}if(this.navigationService.inDatasetView()&&!t.subsituteReportForDataset){var a=this.modelService.modelsPromise.then((function(){var e=i.navigationService.currentDatasetId,t=i.navigationService.currentDatasetDBName,o=i.modelService.findFirstExplorableModelByDBName(t);if(i.usageMetricsReport.modelOriginatedFromUsageMetricsContentPack(o)&&_.isNumber(e)&&(o=i.modelService.findModel(e)),o)return new n(s.dataset,i.tooltipTemplate,o)}));this.insertBreadcrumbAsync(o,a)}if(this.navigationService.inPublishContentPackView()){var b=this.navigationService.contentPack,u=_.isNaN(b)?this.localizationService.get("TopNav_SettingsMenu_CreateContentPack"):this.localizationService.get("Publish_UpdateContentPack");return o.push({uiSref:p.publishContent,label:u,tooltipConfig:this.createCommonTooltipConfig(u),tooltipTemplateConfig:this.createCommonTemplateTooltipConfig(u)}),o}if(this.navigationService.inRowLevelSecurityView()){var u=this.localizationService.get("RowLevelSecurity_Title");return o.push({uiSref:p.rowLevelSecurity,label:u,tooltipConfig:this.createCommonTooltipConfig(u),tooltipTemplateConfig:this.createCommonTemplateTooltipConfig(u)}),o}if(this.featureSwitchService.featureSwitches.permissionCenterEnabled&&this.navigationService.inManagePermissionsView()){var y,S=this.lazy("permissionNavigation").then((function(e){return e.inManagePermissionDetailsView()?(y=e,i.lazy("permissionData")):i.promiseFactory.reject(null)})).then((function(e){return e.getArtifactByObjectId(y.permissionArtifact,y.permissionArtifactGUID)})).then((function(t){var o=i.localizationService.format("PermissionCenter_ManageAccessTo",[t.displayName]),r={uiSref:e.common.constants.navigation.states.permissionCenter,label:o,tooltipConfig:o,tooltipTemplateConfig:o};return r}));this.insertBreadcrumbAsync(o,S)}if(this.addSimpleBreadcrumbs(o,d.thirdSegment))return o;if(this.navigationService.inGetDataCategoryView()){var w=e.contentProviderConstants.CategoryNameToEnumMap,D=e.contentProviderConstants.categoryEnumToDisplayNameMap,C=D[w[this.navigationService.categoryName]],u=this.localizationService.get(C);o.push({uiSref:p.getDataCategory,label:u,tooltipConfig:this.createCommonTooltipConfig(u),tooltipTemplateConfig:this.createCommonTemplateTooltipConfig(u)})}if(this.navigationService.inGetDataCategoryProviderView()){var T=e.common.contracts.contentProviderManifest,I=_.find(T,{providerName:this.navigationService.providerName});if(I){var u=I.displayText;I.displayTextLocalizationKey&&(u=this.localizationService.get(I.displayTextLocalizationKey)),o.push({uiSref:p.getDataCategoryProviderName,label:u,tooltipConfig:this.createCommonTooltipConfig(u),tooltipTemplateConfig:this.createCommonTemplateTooltipConfig(u)})}}return o},t.prototype.createDashboardBreadcrumb=function(e,t){var i=!t.canEdit||this.permissionService.isActiveWorkspaceIsReadOnly?"lock":void 0;return new n(e,this.tooltipTemplate,t,(void 0),"dashboard",(void 0),(void 0),i,"mini")},t.prototype.createEmptyFeaturedDashboardBreadcrumb=function(){return this.createSimpleBreadcrumb(p.home,"NavigationPane_FeaturedDashboardTitle",null,"gauge")},t.prototype.createSharedWithMeBreadcrumb=function(){return this.createSimpleBreadcrumb(p.sharedWithMe,"NavigationPane_SharedWithMeTitle",null,"shared")},t.prototype.createAppBreadcrumb=function(e){var t,i=r.getDefaultAppArtefact(e,this.appService),o=r.isOrgApp(e.providerContract);if(i)if(i instanceof c){var a=o?p.appDashboard:p.appInstanceDashboard;t=a+"({dashboardGUID:'"+i.objectId+"',dashboardOriginalGUID:'"+i.contract.originalDashboardObjectId+"'})"}else if(i instanceof l){var a=o?s.appReport:s.appInstanceReport;t=a+"({reportGUID:'"+i.objectId+"',reportOriginalGUID:'"+i.contract.originalReportObjectId+"'})"}else i instanceof h&&(t=s.appWorkbook+"({workbookURLIdentifier:'"+i.uniqueId+"'})");else t=o?p.app:p.appInstance;return new n(t,this.tooltipTemplate,e,(void 0))},t.prototype.createUsageMetricsBreadcrumb=function(e){if(e instanceof c)return new n(p.dashboard+"({dashboardGUID:'"+e.objectId+"',filter:''})",this.tooltipTemplate,e);if(e instanceof l){var t=s.report+"({reportGUID:'"+e.objectId+"',filter:''})";return new n(t,this.tooltipTemplate,e)}},t.prototype.insertBreadcrumbAsync=function(e,t){var i=e.length;e.push({label:null}),t.then((function(t){t&&(e[i]=t)}))},t.prototype.addSimpleBreadcrumbs=function(e,t){for(var i=0,o=t;i<o.length;i++){var r=o[i],a=r.strictState?this.navigationService.stateService.is(r.state):this.navigationService.stateService.includes(r.state);if(a){e.push(this.createSimpleBreadcrumb(r.state,r.labelResourceKey,r.customClass,r.icon));var n=angular.isUndefined(r.terminal)||r.terminal;if(n)return!0}}return!1},t.prototype.createSimpleBreadcrumb=function(e,t,i,o){var r=this.localizationService.get(t);return{uiSref:e,label:r,customClass:i,beforeIcon:o,beforeIconSize:"small",tooltipConfig:this.createCommonTooltipConfig(r),tooltipTemplateConfig:this.createCommonTemplateTooltipConfig(r)}},t.prototype.createCommonTooltipConfig=function(e){return{tooltipTitle:e,tooltipArrowPosition:a.arrowTopMiddle,tooltipTheme:u.Dark}},t.prototype.createCommonTemplateTooltipConfig=function(e){return{tooltipTitle:this.createTemplateTooltipTitle(e),tooltipArrowPosition:a.arrowTopMiddle,tooltipTheme:u.Dark}},t.prototype.createTemplateTooltipTitle=function(e){return this.tooltipTemplate.replace("{0}",e)},t.prototype.isDashboardShared=function(e){return this.navigationService.inSharedWithMePath()||e&&this.navigationService.inDashboardPath()&&this.ownershipService.isResourceSharedWithMe(e)},t})()})(i=t.factory||(t.factory={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var o,r="https://support.powerbi.com";!(function(e){e[e.ContactSupport=0]="ContactSupport",e[e.DownloadCompanionApp=1]="DownloadCompanionApp",e[e.DownloadExcelPublisher=2]="DownloadExcelPublisher",e[e.DownloadGateways=3]="DownloadGateways",e[e.DownloadIOSApp=4]="DownloadIOSApp",e[e.DownloadAnalyzeInExcelUpdates=5]="DownloadAnalyzeInExcelUpdates",e[e.MakeSuggestion=6]="MakeSuggestion",e[e.ManageEmbed=7]="ManageEmbed",e[e.ManageStorage=8]="ManageStorage",e[e.OpenGeneralSettings=9]="OpenGeneralSettings",e[e.PublishContentPack=10]="PublishContentPack",e[e.ShowAboutDialog=11]="ShowAboutDialog",e[e.SignOut=12]="SignOut",e[e.UpgradeAccount=13]="UpgradeAccount",e[e.ViewContentPack=14]="ViewContentPack"})(o=i.NavigationBarMenuAction||(i.NavigationBarMenuAction={}));var a;!(function(i){function a(e){return[{type:DropDownMenuItemType.Title,text:e.get("FeedbackContextMenu_Title"),dropdownItemClass:"header"},{type:DropDownMenuItemType.Item,text:e.get("FeedbackContextMenu_SubmitIdea"),href:"https://go.microsoft.com/fwlink/?linkid=833533"},{type:DropDownMenuItemType.Item,text:e.get("FeedbackContextMenu_SubmitIssue"),href:"https://go.microsoft.com/fwlink/?linkid=833535"}]}function n(e,i){var r=[{text:e.get("TopNav_SettingsMenu_PowerBICompanion"),action:o.DownloadCompanionApp,href:t.PowerBICompanionModel.downloadLink,type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"},{text:e.get("TopNav_SettingsMenu_PowerBIGateways"),action:o.DownloadGateways,href:"https://go.microsoft.com/fwlink/?LinkId=698861",type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"},{text:e.get("TopNav_SettingsMenu_MobileDownload"),action:o.DownloadIOSApp,type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"},{text:e.get("TopNav_SettingsMenu_PowerBIPublisher"),action:o.DownloadExcelPublisher,href:"https://powerbi.microsoft.com/en-us/excel-dashboard-publisher/",type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"}];return i.analyzeInExcelEnabled&&r.push({text:e.get("TopNav_SettingsMenu_AnalyzeInExcelUpdates"),action:o.DownloadAnalyzeInExcelUpdates,type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"}),r}function s(t){return[{text:e.session.userInfo.givenName+" "+e.session.userInfo.surname,description:e.session.userInfo.name,descriptionTitle:e.session.userInfo.name,containerClass:"userInfoContainer",itemClass:"userInfoContent",labelClass:"userName",descriptionClass:"userEmail",type:DropDownMenuItemType.Title},{text:t.get("TopNav_UserInfoMenu_SignOut"),action:o.SignOut,href:"/SignOut",hrefTarget:jsCommon.DOMConstants.selfValue,type:DropDownMenuItemType.Item}]}function c(e,t){var i=t.supportPageUrl||r;return[{text:e.get("TopNav_HelpMenu_GettingStarted"),href:"https://go.microsoft.com/fwlink/?LinkID=512054",type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"},{text:e.get("TopNav_HelpMenu_Community"),href:"https://go.microsoft.com/fwlink/?LinkId=617032",type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"},{text:e.get("TopNav_HelpMenu_GetHelp"),href:i,type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"},{text:e.get("TopNav_HelpMenu_Developers"),href:"https://go.microsoft.com/fwlink/?LinkId=521914",type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"},{text:e.get("TopNav_HelpMenu_About"),action:o.ShowAboutDialog,type:DropDownMenuItemType.Item,dropdownItemClass:"addBorderBottom"}]}i.createFeedbackMenuItems=a,i.createDownloadMenu=n,i.createUserInfoMenu=s,i.createHelpMenu=c})(a=i.NavigationBarMenuFactory||(i.NavigationBarMenuFactory={}))})(i=t.factory||(t.factory={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=e.common.contracts.StorageProviderType,r=e.common.PowerBIErrorHeader;!(function(i){function a(e,t){if(e){var o=e.headers(r);if(o){if(o===i.ImageTypeNotAllowed)return{errorType:0,errorMessage:t.get("PublishContentPack_ImageTypeNotAllowed")};if(o===i.InvalidImageFormat)return{errorType:0,errorMessage:t.get("PublishContentPack_InvalidImageFormat")};if(o.indexOf(i.TemplatePublishErrorPrefix)>=0)return{errorType:1,errorMessage:t.get("PublishContentPack_"+o)};if(o===i.PublishToEntireOrgDisabledErrorCode)return{errorType:2,errorMessage:t.get("PublishOrgProvidersToEntireOrgDisabled")};if(o===i.OrgAppsDisabled)return{errorType:3,errorMessage:null}}return v(e.error,t)}}function n(e){return!e||0===e.length}function s(e){return e&&e.length<=this.TitleSizeLimit}function c(e){return!e||0===e.length}function l(e){return e&&!t.ReportUtility.IsReportSavedAsExploration(e.contract)}function d(e,t){var i=t.findPackage(e.contract.packageId);return i&&i.contract.storageProviderType===o.Local}function p(e,t){e.publishedTo=t.publishedTo,e.listOfGroupPrincipals=t.listOfGroupPrincipals,e.isSharedToEntireOrg=t.isSharedToEntireOrg,e.providerId=t.providerId,e.displayText=t.displayText,e.iconUrl=t.iconUrl,e.description=t.description,e.publishTime=t.publishTime,e.author=t.author,e.category=t.category,e.allowCopyContent=t.allowCopyContent,e.dashboardIds=t.dashboardIds.slice(),e.reportIds=t.reportIds.slice(),e.modelIds=t.modelIds.slice(),e.workbookIds=t.workbookIds.slice()}function u(t,i,o,r,a,n,s){if(!_.isEmpty(r))return!1;if(!s||"undefined"==typeof s)return!1;if(!o||1!==o.length)return!1;if(!t||1!==t.length)return!1;if(!i||i.length<1)return!1;var c=t[0],l=c.contract.modelIds;if(!l||l.length<1||l.length>1)return!1;for(var d=!1,p=0,u=l;p<u.length;p++){var h=u[p],v=a.findModel(h),g=n.findPackage(v.contract.packageId);if(!g||!g.contentProviderId||g.contentProviderId!==e.common.constants.pbiDesktopContentProviderId)return!1;for(var m=s.datasetModels,f=0,b=m;f<b.length;f++){var y=b[f];if(y.id===h){d=!0;for(var S=0,w=y.refreshConnections;S<w.length;S++){var D=w[S];if(!D.isDMValidated&&(D.onpremGatewayRequired||_.isEmpty(D.connectionString)||D.connectionString.indexOf("Microsoft.Mashup")<0))return!1}}}}return d}function h(e,t,i){var o=_.union.apply(_,_.map(t,(function(e){return e.contract.modelIds}))),r=_.map(i,(function(e){return e.contract.modelId})),a=_.union(o,r);return _.filter(e,(function(e){return _.contains(a,e.id)}))}function v(e,t){if(e&&(e.code===i.GroupsErrorCode||e.code===i.ServicePlanErrorCode)&&e["pbi.error"].parameters[0]&&(e["pbi.error"].parameters[0].Key===i.GroupsErrorKey||e["pbi.error"].parameters[0].Key===i.ServicePlanErrorKey)){var o=e["pbi.error"].parameters[0].Value.split("[")[1].split("]")[0],r=void 0;if(o){var a=o.split(","),n=a.join("; ");r=e.code===i.GroupsErrorCode?t.format("PublishContentPack_InvalidGroupAddresses",[n]):t.format("PublishContentPack_ServicePlanInvalid",[n])}else r=t.get("PublishContentPack_GroupsValidationFailed");return{errorMessage:r,errorType:2}}}i.ImageTypeNotAllowed="ImageTypeNotAllowed",i.InvalidImageFormat="InvalidImageFormat",i.GroupsErrorCode="GroupOrPrincipalValidationFailed",i.GroupsErrorKey="FailedGroupOrPrincipals",i.PublishToEntireOrgDisabledErrorCode="PublishToEntireOrgDisabled",i.OrgAppsDisabled="OrgAppsDisabled",i.ServicePlanErrorCode="PrincipalDoesNotHaveKnownOrValidServicePlan",i.ServicePlanErrorKey="FailedPrincipals",i.TemplatePublishErrorPrefix="TemplatePublishError_",i.DescriptionSizeLimit=2e3,i.TitleSizeLimit=200,i.ImageSizeLimit=65e3,i.getPublishErrorFromResult=a,i.isTitleEmpty=n,i.isTitleValid=s,i.isDescriptionEmpty=c,i.isLegacyReport=l,i.isLocalWorkbook=d,i.updateContentPack=p,i.isTemplatingAllowed=u,i.getUsedDatasets=h})(i=t.ContentPackAuthoringHelper||(t.ContentPackAuthoringHelper={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=e.common.constants.myWorkspaceGroupId;e.dataServices.models.Workbook;!(function(e){function i(e){return t.RedirectUrlHelper.WebRedirectUrlHelper.getAppRedirectUrl(o,e,null)}function r(e,i){return t.RedirectUrlHelper.WebRedirectUrlHelper.getDashboardRedirectUrl(o,e.objectId,i.objectId,null)}function a(e,i){return t.RedirectUrlHelper.WebRedirectUrlHelper.getReportRedirectUrl(o,e.objectId,i.objectId,null,null)}function n(e,i){return t.RedirectUrlHelper.WebRedirectUrlHelper.getWorkbookRedirectUrl(o,e.objectId,i.uniqueId,null)}e.getAppUrl=i,e.getPublishedAppDashboardUrl=r,e.getPublishedAppReportUrl=a,e.getPublishedAppWorkbookUrl=n})(i=t.UrlHelper||(t.UrlHelper={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.constants.myWorkspaceGroupId,o=jsCommon.StringExtensions,r=(function(){function t(e){this.redirectPath=e}return t.prototype.getAppRedirectUrl=function(e,t,i){var o={action:"OpenApp",groupObjectId:e,context:i,appId:t};return this.getRedirectUrl(o)},t.prototype.getDashboardRedirectUrl=function(e,t,i,o){var r={action:"OpenDashboard",context:o,groupObjectId:e,appId:t,dashboardObjectId:i};return this.getRedirectUrl(r)},t.prototype.getReportRedirectUrl=function(e,t,i,o,r){var a={action:"OpenReport",context:r,groupObjectId:e,appId:t,reportObjectId:i};return _.isEmpty(o)||(a.reportPage=o),this.getRedirectUrl(a)},t.prototype.getWorkbookRedirectUrl=function(e,t,i,o){var r={action:"OpenWorkbook",context:o,groupObjectId:e,appId:t,workbookUniqueId:i};return this.getRedirectUrl(r)},t.prototype.getTileRedirectUrl=function(e,t,i,o,r){var a={action:"OpenTile",context:r,groupObjectId:e,appId:t,dashboardObjectId:i,tileObjectId:o};return this.getRedirectUrl(a)},t.prototype.getRedirectUrl=function(t){var r=[];return(_.isEmpty(t.groupObjectId)||t.groupObjectId===i)&&r.push("groupObjectId"),_.isEmpty(t.appId)&&r.push("appId"),_.isEmpty(t.context)&&r.push("context"),r.length>0&&(t=_.omit(t,r)),o.format("{0}/{1}?{2}",e.common.httpService.frontendUri,this.redirectPath,$.param(t))},t.WebRedirectUrlHelper=new t("Redirect"),t.MobileRedirectUrlHelper=new t("MobileRedirect.html"),t})();t.RedirectUrlHelper=r})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.ContentProviderClientCategory,o=e.telemetry;t.CategoryNameToEnumMap={files:i.File,services:i.Service,samples:i.Sample,bigdata:i.BigDataAndMore,myorg:i.Organizational,learn:i.Learn},t.categoryEnumToNameMap={},t.categoryEnumToNameMap[i.File]="files",t.categoryEnumToNameMap[i.Sample]="samples",t.categoryEnumToNameMap[i.Service]="services",t.categoryEnumToNameMap[i.BigDataAndMore]="bigdata",t.categoryEnumToNameMap[i.Organizational]="myorg",t.categoryEnumToNameMap[i.Learn]="learn",t.categoryEnumToDisplayNameMap={},t.categoryEnumToDisplayNameMap[i.File]="GetData_Files",t.categoryEnumToDisplayNameMap[i.Sample]="GetData_Samples",t.categoryEnumToDisplayNameMap[i.Service]="GetData_Services",t.categoryEnumToDisplayNameMap[i.BigDataAndMore]="GetData_BigDataAndMore",t.categoryEnumToDisplayNameMap[i.Organizational]="GetData_MyOrganization",t.categoryEnumToDisplayNameMap[i.Learn]="GetData_AddYourContent",t.categoryInteractionTelemetryMap={breadcrumb:o.GetDataCategorySelectInteraction.Breadcrumb,navPane:o.GetDataCategorySelectInteraction.NavPane,splashPage:o.GetDataCategorySelectInteraction.SplashPage,getApps:o.GetDataCategorySelectInteraction.GetApps},t.getAppsInteraction="getApps",t.saasMarketplacePublicCategory="public",t.saasMarketplacePrivateCategory="private",t.salesforceAppName="salesforce"})(t=e.contentProviderConstants||(e.contentProviderConstants={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=e.common.contracts.ContentProviderClientCategory;!(function(t){function i(t,i,o){if(t){var r=e.common.KnownContentProviderErrors[i],a=r&&r[t];if(a)return s(a,o)}}function r(e,t,i,o){return e.isImportOperation!==!1?o&&t&&i.isAppCategory(t.category)?2:0:1}function a(t,i,o,r,a,n,p){var u,h=c(t,i);a.ensureLocalization((function(){if(h){var c=s(h,n),v=h.titleId||"ErrorMessage_DefaultTitle";u={message:a.get(c),title:a.get(v),errorType:c,helpLink:h.helpLink||d(i),helperText:h.helperTextId?a.get(h.helperTextId):null},l(t,u,p)}else{var g,m,f=void 0,b=e.models.contentProviderHelpLink[i]||d(i);switch(r){case 2:g="ErrorMessage_FailedToInstallApp",m=a.format("ErrorTitle_FailedToInstallApp",[o]);break;case 0:g="ErrorMessage_FailedToStorePackage",m=a.format("ErrorTitle_FailedToStorePackage",[o]);break;case 1:g="ErrorMessage_FailedToConnectWorkbook",m=a.format("ErrorTitle_FailedToConnectWorkbook",[o])}if(t.error)f=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(t.error);else{var y=$.Deferred();y.resolve(null),f=y.promise()}f.then((function(i){u={message:i&&i.message?i.message:a.get(g),title:m,errorType:e.common.contentProviderDefaultErrorType,displayableErrorInfo:i?i.displayableErrorInfo:null,helpLink:b},l(t,u,p)}))}}))}function n(t,i,r,a,n,s,c){t!==o.Service&&t!==o.Organizational||s.$emit(e.constants.saasMarketplace.initSaasMarketplaceEventName,c);var l=e.contentProviderConstants.categoryEnumToNameMap[t],d=e.contentProviderConstants.categoryInteractionTelemetryMap[i];a.logEvent(e.telemetry.DashboardGetDataCategorySelect,l,d,this.previousSelectedCategoryName),n.showGetDataSlider({categoryName:l,getDataView:c?"getapps":"getdata"},r)}function s(e,t){var i=e.messageId;return e.messageIdOverride&&t.featureSwitches[e.messageIdOverride.featureSwitch]&&(i=e.messageIdOverride.messageId),i}function c(t,i){if(t){var o=e.common.KnownContentProviderErrors[i];if(o){var r=t.headers(e.common.PowerBIErrorDetailsHeader);if(r){var a=u.tryParseJSON(r),n=a&&a.error&&a.error.code;return n?o[n]:void 0}}}}function l(t,i,o){o.error(i.message,i.errorType,{requestId:t?t.requestId:void 0,statusCode:t?t.status.toString():void 0,title:i.title,displayLearnMoreHelpLink:null!=i.helpLink,helpLink:i.helpLink,customErrorDialogHelperText:i.helperText,displayableErrorInfo:i.displayableErrorInfo,showAdditionalErrorInfo:null!=i.displayableErrorInfo},null,e.telemetry.ErrorSource.PowerBI)}function d(t){return t===p.excelContentProviderId?e.models.excelWorkbookUploadFailedDefaultHelpLink:e.models.contentProviderFallbackLink}var p=e.common.constants,u=jsCommon.JsonExtensions;t.getErrorMessageId=i,t.getStoreOperationType=r,t.handleStoreConfigurationError=a,t.navigateToCategoryAndProviderHelper=n})(i=t.ContentProviderStoreHelper||(t.ContentProviderStoreHelper={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=e.common.contracts.ContentTileType,r=e.dataServices.models.Dashboard,a=e.common.models.Model,n=e.models.MRUModel,s=e.common.contracts.PublishOrRefreshStatus,c=e.common.models.Report,l=e.dataServices.models.Workbook;!(function(t){function i(e,t,i,r,a){if(e.contentTileType!==o.Dataset){var n=d(e,t);i.openContent(e,n,r,a)}}function d(t,i){var r=t.workspaceId;return r||(r=t.contentTileType===o.Favorite?e.constants.myWorkSpaceGroupId:i.activeGroupObjectId),r}function p(e){var t=e.contentTileType;if(t!==o.Dataset)return e instanceof l?e.uniqueId:e.objectId}function u(e){return e instanceof r?e.contract&&e.contract.originalDashboardObjectId:e instanceof c?e.contract&&e.contract.originalReportObjectId:e instanceof n?e.originalGUID:e.contentTileType===o.Favorite?e.originalObjectId:void 0}function h(e){if(e.contentTileType===o.OrgApp)return e.packageId;if(e instanceof r)return e.contract&&e.contract.originalPackageId;if(e instanceof c)return e.packageId;if(e instanceof l)return e.packageId;if(e instanceof n)return e.packageid;if(e instanceof a)return e.packageId;if(e.contentTileType===o.Favorite){var t=e;if(w(t)===o.OrgApp)return t.favoriteId}}function v(e,t){return e instanceof a?e.isNew&&e.contract.packagePublishStatus!==s.PublishError&&e.contract.packagePublishStatus!==s.RefreshError&&!b(e,t):e.isNew}function g(e,i){return!!e&&(y(e)===o.Dashboard&&i.isFavoriteDisabled(t.getObjectID(e)))}function m(e){var t=y(e);return f(t)}function f(e){return e===o.OrgApp||e===o.Dashboard}function b(e,t){if(e instanceof a){var i=t.findModel(e.contract.id,e.contract.packageId);return!!i&&i.isRefreshInProgress}return!1}function y(t){var i=t.contentTileType;if(i===o.MRU&&t instanceof e.models.MRUModel)i=S(t);else if(i===o.Favorite){var r=t;i=w(r)}return i}function S(t){switch(t.type){case e.models.MRUArtifactType.Dashboards:return o.Dashboard;case e.models.MRUArtifactType.Reports:return o.Report;case e.models.MRUArtifactType.Workbooks:return o.Workbook;case e.models.MRUArtifactType.AppInstance:return o.OrgApp}}function w(e){switch(e.favoriteType){case 1:return o.Dashboard;case 3:return o.OrgApp}}function D(i,r,a,n,s){var c,l=t.getActualType(i),d=p(i);switch(l){case o.Dashboard:c=r.findDashboardByGUID(d);break;case o.Report:c=a.findReportByGUID(d);break;case o.Workbook:c=n.findWorkbookByUniqueId(d);break;case o.OrgApp:if(i instanceof e.models.MRUModel){var u=i.packageid;c=s.getAppInstance(u)}}return c||i}function C(t,i){if(t instanceof e.dataServices.models.Dashboard)return t.id;if(t.contentTileType===o.OrgApp)return t.packageId;if(t.contentTileType===o.Favorite)return t.favoriteId;if(t instanceof n){var r=S(t);if(r===o.Dashboard){var a=i.findDashboardByGUID(t.objectId);return a&&a.id}if(r===o.OrgApp)return t.packageid}}function T(e){return I(e,e.contentTileType)}function I(e,t){switch(t){case o.Favorite:return e.favoriteType;case o.Dashboard:return 1;case o.OrgApp:return 3;case o.MRU:var i=S(e);return I(e,i)}}t.openContentTile=i,t.getGroupId=d,t.getObjectID=p,t.getOriginalObjectID=u,t.getPackageId=h,t.isNew=v,t.isFavoriteDisabled=g,t.isFavoritableContent=m,t.isFavoritableContentType=f,t.getActualType=y,t.getMRUActualType=S,t.getFavoriteActualType=w,t.getMRUOriginalContentTile=D,t.getFavoriteId=C,t.getContentFavoriteType=T})(i=t.ContentTileHelper||(t.ContentTileHelper={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,a,s,d,u,h,v){var g=c(a),m=l(g,h,v,s);return{automaticallyImport:!0,sandboxProperties:[p.AllowSameOrigin,p.AllowPopups,p.AllowScripts,p.AllowForms],providers:{blocker:g,validator:m},visualTypeOptions:n(),registerVisualConsentOptions:o(e,t,i,r,d,u)}}function o(e,t,i,o,r,a){return{consentDialogProvider:d(e,t,i,o),consentPersistencyProvider:s(r,a)}}function r(t,i){return{automaticallyImport:!0,sandboxProperties:[p.AllowSameOrigin,p.AllowPopups,p.AllowScripts,p.AllowForms],providers:{blocker:{blockedInCluster:_.noopTrue,blockedInTenant:_.noopTrue},validator:{getErrorDetails:function(){return{message:i.get("VisualContainer_EsriNotSupportedInEmbed"),errorType:1,displayableErrorInfo:[],helpLink:e.models.EsriLearnMoreUrl}}}},visualTypeOptions:n(),registerVisualConsentOptions:{consentDialogProvider:{showConsentDialog:function(){return t.reject("Esri is not supported in Embedded scenario.")}},consentPersistencyProvider:{loadConsent:function(){return t.reject("Esri is not supported in Embedded scenario.")},saveConsent:function(e){return t.reject("Esri is not supported in Embedded scenario.")}}}}}function a(e,t,i,o,r,a,d){var u=c(t),h=l(u,o,r,i);return{automaticallyImport:!0,sandboxProperties:[p.AllowSameOrigin,p.AllowPopups,p.AllowScripts,p.AllowForms],providers:{blocker:u,validator:h},visualTypeOptions:n(),registerVisualConsentOptions:{consentDialogProvider:{showConsentDialog:function(){return e.reject("Esri consent dialog is not supported in Mobile scenario.")}},consentPersistencyProvider:s(a,d)}}}function n(){return{class:e.visualHost.EsriVisual,titleKey:"ArcGISMapsForPowerBI",watermarkKey:"map"}}function s(t,i){return{loadConsent:function(){return t.getUserSettings().then((function(e){return!!e&&e.esriVisualEnabled}))},saveConsent:function(o){var r=i.startEvent(e.telemetry.SettingsEsriSaveModel,o);return t.updateEsriSetting(o,r).then((function(){return t.refreshUserSettings(),r.resolve(),o}))}}}function c(e){return{blockedInCluster:function(){return!e.featureSwitches.esriEnabled},blockedInTenant:function(){return!e.featureSwitches.esriVisualEnabled}}}function l(t,i,o,r){return{getErrorDetails:function(){var i;if(t.blockedInTenant()?i="SettingsEsri_OrganizationHasDisabled":o.hasConsent(e.visualHost.EsriVisual)||(i="VisualContainer_EsriNotConsented"),i)return{message:r.get(i),errorType:1,displayableErrorInfo:[],helpLink:e.models.EsriLearnMoreUrl}}}}function d(t,i,o,r){return{showConsentDialog:function(){return e.explore.controllers.EsriConsentDialogController.createAndShowEsriConsentDialog(t,i,o,r)}}}var p=e.visualHost.SandboxProperty;t.createRegisterTrustedVisualOptions=i,t.createRegisterVisualConsentOptions=o,t.createEmbedRegisterTrustedVisualOptions=r,t.createMobileVisualRegisterOptions=a,t.createConsentPersistencyProvider=s,t.createBlocker=c,t.createValidator=l,t.createConsentDialogProvider=d})(i=t.EsriVisualHelper||(t.EsriVisualHelper={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){if(!i.isTrustedVisual(e))return!1;for(var r=0,a=t.tiles;r<a.length;r++){var n=a[r];if(o(e,n,i))return!0}return!1}function o(e,t,i){return!!i.isTrustedVisual(e)&&(t.type===a.composite&&t.config&&t.config.visualContainer&&t.config.visualContainer.$visualContainer.config.singleVisual.visualType===e);
}function r(e,t){for(var i=[],o=0,r=e.tiles;o<r.length;o++){var n=r[o],s=n.type===a.composite&&n.config&&n.config.visualContainer&&n.config.visualContainer.$visualContainer.config.singleVisual.visualType;s&&t.isTrustedVisual(s)&&i.push(s)}return t.getConsentAndLoadVisuals(i)}var a=e.dataServices.contracts.TileType;t.dashboardContainsTrustedVisual=i,t.tileContainsTrustedVisual=o,t.acquireTrustedVisuals=r})(i=t.TrustedVisualUtil||(t.TrustedVisualUtil={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e){var t,i,o=a(e);e.isSharedToEntireOrg||(t=_.map(e.emailsList.validEmailsList.concat(e.emailsList.validObjectIds),(function(e){return e.toLowerCase()})),i=e.emailsList&&e.emailsList.inputUserList);var r={name:e.displayName,description:e.description,icon:o,parameterIcon:null,accessPermissions:{adUserMetadataList:i,listOfGroupsOrPrincipals:t,isSharedToEntireOrganization:e.isSharedToEntireOrg},dashboardIds:e.dashboardIds,reportIds:e.reportIds,modelIds:e.modelIds,workbookIds:e.workbookIds,contentProviderCategory:e.publishAsTemplate?n.OrganizationalTemplateApp:n.OrganizationalApp,skipUpdateIcon:!o,appSettings:{defaultAppArtifact:0===e.defaultContentOption?null:e.defaultContent,iconName:e.icon,iconColor:e.iconColor,iconBackgroundColor:e.iconBackgroundColor,headerBackgroundColor:e.headerBackgroundColor,allowCopyContent:e.allowCopyContent,appPush:!e.isSharedToEntireOrg&&!!e.appPush}};return r}function o(e){return _.isEmpty(e.objectId)||e.isFromContentPack===!0}function r(e){return e&&!e.localAppLogoImageData&&o(e)}function a(e){return r(e)?e.iconImageData:e.groupImageData}var n=e.common.contracts.ContentProviderCategory;t.createPublishOrUpdateAppModelRequest=i,t.isNewApp=o,t.hasNewIconData=r})(i=t.PublishAppHelper||(t.PublishAppHelper={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(t,i){for(var o=0,r=i;o<r.length;o++){var a=r[o];if(!a.expression&&null==a.type&&!a.restatement)return!1}return t.Version&&t.Version>=e.data.SemanticQueryVersions.Version2}t.canVisualizeQuery=i})(i=t.VisualQueryUtil||(t.VisualQueryUtil={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){return new o}var i=e.dataServices.TileUtils;e.createAlertRuleService=t;var o=(function(){function t(){this.cardMeasureRoleName="Values",this.gaugeMeasureRoleName="Y",this.kpiMeasureRoleName="Indicator",this.kpiGoalRoleName="Goal",this.kpiTrendRoleName="TrendLine",this.gaugeGoalRoleName="TargetValue"}return t.prototype.createAlertRule=function(t,o,r){var a=this,n=this.getQuery(t);if(n){var s=t.config.visualContainer;if(s){var c=s.elements[0].DataRoles;if(c){var l=i.getVisualType(t.config),d=this.getProjectionIndex(l,c);if(null!=d){if(l===e.visuals.plugins.kpi.name){var p=_.find(c,(function(e){return e.Name===a.kpiTrendRoleName}));p&&this.updateQuerySortOrder(n,p.Projection)}return{condition:{compareToAValue:{operator:o,columnIndex:{columnIndex:d,queryIndex:0},value:r}},queries:[n]}}}}}},t.prototype.getMeasureName=function(e){var t=e.config.visualContainer||e.config.realTimeVisual;if(t&&!_.isEmpty(t.elements)){var o=t.elements[0].DataRoles,r=t.queryMetadata,a=void 0;if(o&&r){var n=this.getProjectionIndex(i.getVisualType(e.config),o);null!=n&&(a=r.Select[n].Restatement)}return a}},t.prototype.getThresholdValue=function(t){var i=0,o=t.composite,r=o&&o.visual&&o.visual.dataViews;if(!_.isEmpty(r)){var a=r[0],n=o.visual.type;if(a)if(a.categorical&&n===e.visuals.plugins.card.name)i=a.categorical.values[0].values[0];else if(n===e.visuals.plugins.gauge.name){var s=e.data.DataRoleHelper.getMeasureIndexOfRole(a.categorical.values.grouped(),this.gaugeGoalRoleName);if(s>=0){var c=a.categorical.values[s].values;i=_.last(c)}else if(a.metadata){var l=a.metadata.objects;l&&l.axis&&l.axis.target&&(i=l.axis.target)}}else if(a.categorical&&n===e.visuals.plugins.kpi.name){var s=e.data.DataRoleHelper.getMeasureIndexOfRole(a.categorical.values.grouped(),this.kpiGoalRoleName);if(s>=0){var c=a.categorical.values[s].values;i=_.last(c)}}}return i},t.prototype.getProjectionIndex=function(t,i){var o;switch(t){case e.visuals.plugins.card.name:o=this.cardMeasureRoleName;break;case e.visuals.plugins.gauge.name:o=this.gaugeMeasureRoleName;break;case e.visuals.plugins.kpi.name:o=this.kpiMeasureRoleName}if(o){var r=_.find(i,(function(e){return e.Name===o}));if(r)return r.Projection}},t.prototype.getQuery=function(e){var t=e.contract.query.modelQuery;if(t&&t.sq){var i=jsCommon.JsonExtensions.tryParseJSON(t.sq);if(i){if(i.defn){var o=i;return{Commands:[{SemanticQueryDataShapeCommand:{Query:o.defn,Binding:o.shape}}]}}var r=void 0;return i.dataQuery?r=i.dataQuery:i.Commands&&(r=i),r}}},t.prototype.updateQuerySortOrder=function(e,t){if(e.Commands&&!_.isEmpty(e.Commands)&&e.Commands[0].SemanticQueryDataShapeCommand){var i=e.Commands[0].SemanticQueryDataShapeCommand,o=i.Query;o.OrderBy=[{Direction:2,Expression:o.Select[t]}];var r=i.Binding;r&&r.DataReduction&&r.DataReduction.Primary&&(r.DataReduction.Primary={Top:{Count:1}})}},t})();e.AlertRuleService=o})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.contracts.PackageType,o=e.common.contracts.Permissions,r=e.dataServices.constants,a=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D){this.rootScope=e,this.$timeout=t,this.dashboardService=i,this.modelService=r,this.localizationService=n,this.navigation=s,this.notificationToastService=c,this.favoritesService=p,this.mostRecentlyUsedService=u,this.homeService=h,this.groupService=v,this.promiseFactory=g,this.workbookService=m,this.storeAppInstall=f,this.packageService=b,this.appService=y,this.lazy=S,this.navigationActions=w,this.asyncFeatureSwitchService=D,this.pendingDatasetReadyNotification=[]}return t.prototype.bootstrap=function(){var t=this;this.rootScope.$on(r.onDatasetAddedEventName,(function(e,i){t.handleDatasetAddedEvent(i)})),this.rootScope.$on(e.dataServices.constants.packagePublishedSuccessfullyEventName,(function(e,i){t.showPackageReadyToast(i)})),this.rootScope.$on(r.workbook.workbookAddedEventName,(function(e,i){t.showWorkbookReadyToast(i)})),this.dashboardService.readyForConceptualModelInitializationPromise.then((function(){t.$timeout((function(){t.bootstrapNavigation(!0,!1).then((function(i){return t.rootScope.$emit(e.constants.dashboardContainerLoaded,i),t.promiseFactory.resolve(null)}))}))}))},t.prototype.bootstrapNavigation=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a,n,s,c,l;return __generator(this,(function(d){switch(d.label){case 0:return o=this.navigation,r=o.inHomeDashboardView(),a=t&&(o.inLandingContainerView()||r),t&&o.inHybridView()?[2]:[3,1];case 1:if(!t||!o.inAppView())return[3,6];n={dashboardOriginalGUID:o.currentDashboardOriginalGUID,reportOriginalGUID:o.currentReportOriginalGUID,workbookID:o.currentWorkbookURLIdentifier},d.label=2;case 2:return d.trys.push([2,,4,5]),[4,this.storeAppInstall.addAppAndNavigate(o.currentAppGUID,n)];case 3:return d.sent(),[3,5];case 4:return[2];case 5:return[3,12];case 6:return t&&o.inWorkspacesView()?(o.navigateToWorkspaces(),[2,e.constants.navigation.states.workspaces]):[3,7];case 7:return!this.homeService.isHomeDashboardSet||!a&&t?[3,8]:(o.navigateToHomeDashboard(t),[2,e.constants.navigation.states.home]);case 8:return[4,this.favoritesService.reloadFavorites(i)];case 9:return s=d.sent(),_.isEmpty(s)?[4,this.mostRecentlyUsedService.getMRUModels()]:(o.navigateToFavorites(this.groupService.activeGroupObjectId),[2]);case 10:return c=d.sent(),_.isEmpty(c)?[4,this.asyncFeatureSwitchService.getFeatureSwitches()]:(o.navigateToRecentlyViewed(),[2]);case 11:l=d.sent(),l.contentAuthoringUIEnabled?o.navigateToContentList(this.groupService.activeGroupObjectId):o.navigateToApps(),d.label=12;case 12:return[2]}}))}))},t.prototype.handleDatasetAddedEvent=function(e){var t=this.dashboardService.dashboardContainerModel.contract.models,i=!1;if(t){for(var o=t.length,r=0;r<o;r++)if(t[r].id===e.id&&t[r].packageId===e.packageId){t[r]=e,i=!0;break}i||t.push(e)}},t.prototype.showPackageReadyToast=function(e){var t=this;this.packageService.ensurePackagesInitialization().then((function(){var o=t.packageService.findPackage(e);o&&o.packageType===i.AppInstance?t.appService.onInstanceAdded(o.contract).catch((function(){t.showDashboardOrModelNotification(e)})):t.showDashboardOrModelNotification(e)}))},t.prototype.showWorkbookReadyToast=function(t){var i=this,o=this.workbookService.findWorkbookByUniqueId(t);if(o&&o.isOwner()){var r=this.groupService.activeGroupObjectId,a={displayText:this.localizationService.get("GoToWorkbook"),action:function(){i.navigation.insertGroupAndNavigateToWorkbookByUniqueId(o.uniqueId,r)}};this.notificationToastService.notify({title:this.localizationService.get("WorkbookReadyNotificationTitle"),message:this.localizationService.format("WorkbookReadyNotificationMessageV2",[o.displayName]),notificationType:e.common.NotificationToastType.Success,actionButtons:[a]})}},t.prototype.showDashboardOrModelNotification=function(e){var t=this;this.dashboardService.getDashboards().then((function(i){var o=t.findDashboardsByPackageId(i,e);if(1===o.length&&o[0].isNew&&1===o[0].contract.packageIds.length&&!o[0].isNotified)t.notifyNewDashboardIsReady(o[0]);else{var r=t.modelService.findModelByPackageId(e);r?t.notifyNewDatasetIsReady(r,e):(t.pendingDatasetReadyNotification.push(e),t.unregisterModelWatch||(t.unregisterModelWatch=t.rootScope.$watch((function(){return t.modelService.lastUpdatedTimestamp}),(function(){t.pendingDatasetReadyNotification=_.filter(t.pendingDatasetReadyNotification,(function(e){var i=t.modelService.findModelByPackageId(e);return!i||(t.notifyNewDatasetIsReady(i,e),!1)})),_.isEmpty(t.pendingDatasetReadyNotification)&&(t.unregisterModelWatch(),t.unregisterModelWatch=null)}))))}}))},t.prototype.findDashboardsByPackageId=function(e,t){return _.filter(e,(function(e){return e.contract.packageIds&&e.contract.packageIds.indexOf(t)>=0}))},t.prototype.notifyNewDashboardIsReady=function(t){var i=this,o={description:t.displayName,displayText:this.localizationService.get("ToastNotification_GoToDashboard"),action:function(){i.navigation.navigateToDashboardByGUID(t.objectId)}};this.notificationToastService.notify({title:this.localizationService.get("Publish_Success"),message:this.localizationService.get("NotificationMessage_NewDashboardCreatedTitle"),notificationType:e.common.NotificationToastType.Success,actionButtons:[o]}),t.isNotified=!0},t.prototype.notifyNewDatasetIsReady=function(t,i){var r=this;if(t&&t.isNew&&!t.isHidden&&(t.getPermissions()&o.All)===o.All&&t.contract.insightsSupported){var a,n={displayText:this.localizationService.get("DatasetUploadedToast_ExploreInsights"),action:function(){return __awaiter(r,void 0,e.Promise,(function(){var o;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.lazy("insightsBootstrap")];case 1:return o=r.sent(),o.start(t.dbName,t.vsName,i,e.insights.constants.insightsSourceToast),[2]}}))}))}},s={displayText:this.localizationService.get("DatasetUploadedToast_ViewDataset"),action:function(){var e=r.modelService.findModel(t.id,i);r.navigationActions.openModel(e)}};a=this.notificationToastService.notify({title:this.localizationService.get("DatasetUploadedToast_ReadyToExploreTitle"),message:this.localizationService.get("DatasetUploadedToast_ReadyToExploreSubtitle"),notificationType:e.common.NotificationToastType.Success,actionButtons:[s],actionLinks:[n],sticky:!0});var c=this.rootScope.$on(e.constants.groupSwitchedEventName,(function(e,t,i){r.notificationToastService.hide(a),c()}))}},t})();t.BootstrapService=a})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a,n,s,c,d){return new l(e,t,i,o,r,a,n,s,c,d)}var o=e.common.constants,r=e.common.contracts.ContentProviderCategory,a=e.common.contracts.ContentProviderClientCategory,n=e.helpers.ContentProviderStoreHelper,s=e.telemetry.InstallSource,c=e.common.helpers.ModelConverterHelper;t.createContentProviderService=i;var l=(function(){function t(e,t,i,o,r,a,n,s,c,l){this.featureSwitchService=e,this.localizationService=t,this.contentProviderHttpService=i,this.telemetryService=o,this.errorService=r,this.notificationToast=a,this.lazy=n,this.appService=s,this.promiseFactory=c,this.licenseEnforcementService=l}return t.prototype.getDataAccessInfo=function(e){if(e){var t=c.getContentProviderClientCategory(e);if(t===a.Organizational)return{SID:"",DSID:""};var i=JSON.parse(e.providerConfig);return i.dataAccessInfo}},t.prototype.upgradeRequiredToConnect=function(e){if(!e)return!1;var t=c.getContentProviderClientCategory(e),i=t===a.Organizational,o=t===a.BigDataAndMore,r=i&&this.licenseEnforcementService.supportsConnectApps(e,!0),n=o&&this.licenseEnforcementService.supportsPremiumContentProviders(),s=!i&&!o,l=r||n||s;return!l},t.prototype.displayFeatureDisabledDialog=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o;return __generator(this,(function(r){switch(r.label){case 0:return e=this.appService.isAppCategory(t.category),i=c.getContentProviderClientCategory(t)===a.Organizational,[4,this.lazy("licenseHelper")];case 1:return o=r.sent(),o.displayConnectErrorMessage(e,i),[2]}}))}))},t.prototype.storeDataAccessInfo=function(t,i,l,d,p,u){var h=this,v=this.localizationService,g=this.notificationToast,m=this.promiseFactory.defer();return v.ensureLocalization((function(){var f,b=n.getStoreOperationType(t,i,h.appService,d);switch(b){case 2:f="AppModel_InstallApp";break;case 0:f="NotificationMessage_ImportingPackage";break;case 1:f="NotificationMessage_ConnectingPackage"}var y,S=g.notify({title:v.get(f),message:v.get("NotificationMessage_TakeAWhile"),notificationType:e.common.NotificationToastType.Loading}),w=t.ContentProviderIdOverride||i&&i.id||o.orgAppsContentProviderId,D=p,C=null;if(i){D=i.displayText||D;var T=c.getContentProviderClientCategory(i);T===a.Organizational?(C="OrgContent",y=i.providerKey):T===a.Service&&i.category!==r.BuiltIn?y=i.providerKey:i.id===o.groupOneDriveContentProviderId&&(C="OneDrive - Group")}C=C||D;var I=h.telemetryService,k=I.startEvent(e.telemetry.DashboardContentProviderPublish,w,i?i.providerKey:null,C,i?i.category:-1,l===s.AppAutoInstallLink||l===s.AppArtifactAutoInstallLink);t.DSID&&I.logChildEvent(k.event,e.telemetry.DashboardContentProviderPublishDSID,t.DSID),2===b&&I.logChildEvent(k.event,e.telemetry.AppsInstallApp,i&&i.providerKey,i?r[i.category]:"",l),h.contentProviderHttpService.storeConfiguration(u||0,w,t,k.event,y,i&&i.category,d).then((function(e){g.hide(S),k.resolve(),m.resolve(null)}),(function(e){g.hide(S),n.handleStoreConfigurationError(e,w,D,b,v,h.featureSwitchService,h.errorService);var t=e.data&&e.data.error&&e.data.error.code||"FailedToStoreConfiguration",i=e.data&&e.data.error&&e.data.error.message||"",o=jsCommon.StringExtensions.format("Status:{0} RequestId:{1} Details:{2}",e.status.toString(),i);k.reject({errorCode:t,errorMessage:o}),m.reject()}))})),m.promise},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.CollapsiblePaneExpandedWidth,o=e.common.constants,r=e.controllers.DashboardContainerController,a=e.dataServices.models.DashboardTileModel,n=e.constants.navigation.states,s=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y){this.$rootScope=e,this.dashboardDataService=t,this.dashboardService=i,this.dashboardWarningsService=o,this.errorService=r,this.groupService=n,this.inFocusService=s,this.licenseEnforcementService=c,this.localizationService=l,this.modelConverter=d,this.mostRecentlyUsedService=p,this.navigation=u,this.permissionService=h,this.timeout=v,this.telemetryService=g,this.userInfo=m,this.subscription=b,this.taskPaneSliderService=y}return t.prototype.bootstrap=function(){var e=this;this.$rootScope.$on(o.navigation.stateChangeSuccess,(function(t,i,o,r,a){e.handleStateChange(i,o,r,a)}))},t.prototype.registerDashboardContainerScope=function(e){this.dashboardContainerScope=e},t.prototype.unregisterDashboardContainerScope=function(){this.dashboardContainerScope=void 0},t.prototype.handleStateChange=function(t,o,a,s){var c=this;return o.dashboardGUID&&!o.hasOwnProperty("q")?this.dashboardWarningsService.showWarningsIfNeeded():this.dashboardWarningsService.hideDashboardWarnings(),a.name!==e.common.constants.navigation.states.reportPage&&a.name!==n.settingsGroup||this.subscription.collapseSubscriptionPane(),this.dashboardContainerScope&&this.dashboardService.updateDashboardMenuItems(this.dashboardContainerScope),t&&t.name===n.dashboardRequestAccess?(this.dashboardService.setAndUpdateActiveDashboard(null),void(this.dashboardContainerScope&&this.dashboardService.requestDashboardAccess(o.dashboardGUID))):void this.localizationService.ensureLocalization((function(){var l=c.dashboardService.dashboardContainerModel,d=c.dashboardDataService,p=c.navigation,u=s?s.dashboardGUID:null;if(o.groupGUID&&s.groupGUID&&o.groupGUID!==s.groupGUID)return void(d.activeDashboard=null);_.isEmpty(p.currentDashboardGUID)&&p.inDashboardPath()&&p.inAppArtifactView();var h=c.dashboardService.dashboardContainerModel.findDashboardByGUID(p.currentDashboardGUID),v=c.dashboardService.dashboardContainerModel.findDashboardByGUID(u);if(c.dashboardService.checkUserNeedsProLicenseAndShowError(h,c.userInfo,c.licenseEnforcementService,c.localizationService,p,e.telemetry.LicenseEnforcementOperation.SwitchDashboards,v),c.dashboardContainerScope&&a.name!==n.dashboard&&h&&h.tiles&&d.activeDashboard&&p.currentDashboardGUID===d.activeDashboard.objectId&&c.dashboardContainerScope.$broadcast(e.constants.populateDashboardWithReportTiles),h&&p&&h.objectId!==p.currentDashboardGUID&&c.navigation.navigateToDashboardByGUID(h.objectId,0,!1),t&&t.name===n.dashboards)return void(d.activeDashboard?p.navigateToDashboardByGUID(d.activeDashboard.objectId):c.permissionService.isActiveWorkspaceIsReadOnly||!_.isEmpty(c.dashboardService.dashboardContainerModel.visibleDashboards)||c.groupService.isDataInCurrentGroup()?p.navigateToContentListOrActiveDashboard():p.navigateToGroupWelcome());if(p.currentDashboardGUID&&(!d.activeDashboard||p.currentDashboardGUID!==d.activeDashboard.objectId))if(h){h.increaseHitCount();var g=l.contract;h.isLoaded&&!h.contract.cached||c.dashboardService.loadDashboard(h.id),g.activeViewMode=e.contracts.DashboardContainerViewMode.DashboardViewer,g.activeDashboardId=h.id,h.isNew=!1,h.isFilled()?h.runLayoutIfRequired():(c.modelConverter.fillDashboardChildren(h,l.contract.models,l.contract.reports,l.contract.workbooks),h.calculateLayout(),h.applyLayout()),d.activeDashboard=h,h.id>0&&(c.dashboardWarningsService.showWarningsIfNeeded(),c.dashboardService.updateActiveDashboard(h.id,!1),c.dashboardService.logRTelemetryDashboardEvent(e.telemetry.DashboardLoadDashboardWithScriptVisuals))}else c.dashboardService.shouldNavigateToRequestAccess()?(c.mostRecentlyUsedService.removeMRU(p.currentDashboardGUID),c.navigation.navigateToRequestDashboardAccessByGUID(p.currentDashboardGUID)):(c.mostRecentlyUsedService.removeMRU(p.currentDashboardGUID),r.showDashboardDoesNotExistDialog(c.errorService,c.localizationService,c.telemetryService,c.navigation),p.navigateToActiveDashboard());p.currentDashboardGUID&&d.activeDashboard&&c.dashboardService.notifyDashboardUpdate(),c.dashboardContainerScope&&c.taskPaneSliderService.collapsePane();var m=d.selectedDashboardTile;if(m){var f=m.tileModel;f&&f.isTemporary&&c.dashboardService.removeTemporaryTile(f),c.dashboardService.clearSelectedDashboardTile()}if(c.navigation.inSharingView()&&c.timeout((function(){c.dashboardService.navigateToShareDashboard(c.navigation.currentDashboardGUID)})),c.dashboardContainerScope&&c.navigation.inAlertsEditorView()){if(!d.activeDashboard||!d.activeDashboard.isLoaded)return;var b=c.setAndGetActiveTile();b&&c.taskPaneSliderService.expandPane(9,i.Small)}if(c.navigation.inInFocusView()||c.navigation.inInFocusInsightsView()){if(!d.activeDashboard||!d.activeDashboard.isLoaded)return;var b=c.setAndGetActiveTile();b&&c.inFocusService.view(b,void 0,c.navigation.inInFocusInsightsView())}o.dashboardGUID&&!o.hasOwnProperty("q")&&c.dashboardDataService.activeDashboard&&c.dashboardWarningsService.prepareCustomVisualsForLoading(c.dashboardDataService.activeDashboard)}))},t.prototype.setAndGetActiveTile=function(){var e=this.findTileToEdit();return e?(this.dashboardService.selectDashboardTile(new a(e)),e):void r.showTileDoesNotExistDialog(this.errorService,this.localizationService,this.telemetryService)},t.prototype.findTileToEdit=function(){var e=this.navigation.currentTileGUID,t=this.navigation.currentTileOriginalGUID;return this.dashboardDataService.activeDashboard.findTileByObjectIdOrOriginalObjectId(e,t)},t})();t.DashboardStateChangeService=s})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(){return{disableDashboardFavoriteButton:void 0,disableDashboardRefresh:void 0,disableSetFeaturedDashboard:void 0,disablePerfInspector:void 0}}e.createDashboardConfigurationService=t})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.contracts.TileType,o=(function(){function t(e,t,i,o,r,a,n,s,c,l,d){this.$rootScope=e,this.dashboardDataService=i,this.resourceGateService=o,this.notificationBar=n,this.resourcePackageListenerService=s,this.embedModeService=c,this.localizationService=l,this.dashboardNotificationIds=[],this.embedModeService.getEmbedTypeDescription()}return t.prototype.showWarningsIfNeeded=function(){this.hideDashboardWarnings();var e=this.dashboardDataService.activeDashboard;e&&(this.resourceGateService.shouldShowWarning(this.getResourceIds(),e.objectId)?(this.resourceGateService.resetResourceFlag(),this.displayCustomVisualWarning()):(this.resourceGateService.setResourceFlag(),this.prepareCustomVisualsForLoading(e)))},t.prototype.hideDashboardWarnings=function(){for(var e=this.dashboardNotificationIds;e.length>0;)this.notificationBar.hide(e.pop())},t.prototype.getResourceIds=function(){var e=this.dashboardDataService.activeDashboard;return e?this.resourcePackageListenerService.getAllRequiredResourcePackageIdStrings(e):[]},t.prototype.displayCustomVisualWarning=function(){var e=this.dashboardDataService.activeDashboard;if(e)for(var t=e.tiles,o=0,r=t;o<r.length;o++){var a=r[o];if(a.type===i.composite||a.type===i.report){var n=a.contract;if(n&&n.resourcePackageIds&&n.resourcePackageIds.length>0){this.createCustomVisualWarning();break}}}},t.prototype.createCustomVisualWarning=function(){var t=this,i=this.notificationBar.notify({message:this.localizationService.get("OpenDashboard_EnableCustomVisualWarningMessage"),notificationType:e.common.NotificationBarType.Warning,actions:[{displayText:this.localizationService.get("OpenDashboard_EnableCustomVisualButton"),linkId:1,action:function(){t.resourceGateService.setResourceFlag(),t.resourceGateService.addResourcePackageIdToDashboard(t.dashboardDataService.activeDashboard.objectId,t.getResourceIds()),t.notificationBar.hide(i),t.dashboardNotificationIds.splice(t.dashboardNotificationIds.indexOf(i),1),t.prepareCustomVisualsForLoading(t.dashboardDataService.activeDashboard)}}],secondaryLink:{displayText:this.localizationService.get("LearnMore"),urlString:"https://go.microsoft.com/fwlink/?LinkID=627490 "}});this.dashboardNotificationIds.push(i)},t.prototype.prepareCustomVisualsForLoading=function(t){var i=this,o=this.resourcePackageListenerService.getAllRequiredResourcePackageIdStrings(t);this.resourcePackageListenerService.getAndLoadVisualPluginsForDashboard(t).then((function(r){i.resourceGateService.shouldShowWarning(o,t.objectId)||_.isEmpty(r)||i.$rootScope.$emit(e.constants.reloadEmptyVisuals,{visualTypes:r})}))},t})();t.DashboardWarningsService=o})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var CollapsiblePaneExpandedWidth=powerbi.common.models.CollapsiblePaneExpandedWidth,EnumExtensions=jsCommon.EnumExtensions,FeatureNotSupportedDialogBuilder=powerbi.common.dialogs.FeatureNotSupportedDialogBuilder,Model=powerbi.common.models.Model,PublishOrRefreshStatus=powerbi.common.contracts.PublishOrRefreshStatus,RejectablePromise=powerbi.RejectablePromise;powerbi.define("services/datasetActions",(function(e){var t=powerbi.common.dialog.MessageDialogBuilder,i=powerbi.common.contracts.Permissions,o=powerbi.telemetry,r=powerbi.constants,a=(function(){function e(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m){this.$rootScope=e,this.analyzeInExcelService=t,this.contentPackService=i,this.downloadReport=o,this.errorService=r,this.lazy=a,this.localizationService=n,this.modalDialogService=s,this.modelService=c,this.navigation=l,this.permissionService=d,this.quota=p,this.realTimeModel=u,this.refreshService=h,this.settingsMetadataService=v,this.taskPaneSliderService=g,this.telemetryService=m}return e.prototype.analyzeInExcel=function(e){e&&(this.telemetryService.logEvent(o.DashboardAndReportsAnalyzeInExcel,"Dataset Navigation Pane List",e.contentProviderId,e.contract.modelFeatures,e.dbName),this.analyzeInExcelService.startAnalyzeInExcel(e))},e.prototype.delete=function(e){this.telemetryService.logEvent(o.DashboardDatasetClickDelete,e.contentProviderId);var t=e.id,r=e.packageId,a=this.permissionService.getModelEffectivePermissions(e.contract),n=(a&i.CopyOnWrite)===i.CopyOnWrite;e&&e.isUsedByContentPack?this.contentPackService.showDialogOnModelDeleteInContentPack(t):this.deleteModel(t,r,n?services.DeleteContentPackMessageType.Dataset:null)},e.prototype.deleteModel=function(e,t,i){var o,r,a=this,n=this.modelService.findModel(e,t),s=this.errorService.control(),c=[new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Delete"),function(i,o){s.hideDialog(),n&&n.realTimeMode?a.realTimeModel.deleteModel(e):a.modelService.deleteModel(e,t)}),new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Cancel"),function(e,t){s.hideDialog()})];switch(i){case services.DeleteContentPackMessageType.Dataset:o=this.localizationService.get("Model_DeleteConfirmationTitle"),r=this.localizationService.get("Model_DeleteOrgAppContentPack");break;default:n&&n.realTimeMode?(o=this.localizationService.get("StreamingDatasetModel_DeleteConfirmationTitle"),r=this.localizationService.format("StreamingDatasetModel_DeleteConfirmationMessage",[n.displayName])):(o=this.localizationService.get("Model_DeleteConfirmationTitle"),r=this.localizationService.format("Model_DeleteConfirmationMessage",n?[n.displayName]:[]))}s.showCustomDialog(o,$("<div/>").text(r),c,(function(e){e.parent().find('input[value="'+a.localizationService.get("ModalDialogButtonText_Cancel")+'"]').focus()}),!0)},e.prototype.downloadPbix=function(e){this.downloadReport.downloadModel({id:e.id.toString(),filename:e.displayName})},e.prototype.createReport=function(e){return null!=e.contract.packagePublishStatus&&e.contract.packagePublishStatus!==PublishOrRefreshStatus.FinishedSuccessfully&&e.contract.packagePublishStatus!==PublishOrRefreshStatus.RefreshInProgress&&e.contract.packagePublishStatus!==PublishOrRefreshStatus.RefreshError?void(e.contract.packagePublishStatus===PublishOrRefreshStatus.PublishError&&this.deleteModelOnPublishFailure(e.id)):(e.isNew=e.contract.isNew=!1,void(this.quota.checkQuotaExceeded(o.QuotaCheckOperation.OpenDataset)||(EnumExtensions.hasFlag(e.getPermissions(),i.CopyOnWrite)?this.$rootScope.$emit(r.personalizeEventName,e.packageId):this.navigation.navigateToDataset({datasetDBName:e.dbName,datasetId:e.id}))))},e.prototype.deleteModelOnPublishFailure=function(e){var t=this;this.deleteItemOnPublishFailure(this.localizationService.get("NavigationPane_ModelPublishErrorTitle"),this.localizationService.get("NavigationPane_ModelPublishErrorContent"),(function(){t.modelService.deleteModel(e)}))},e.prototype.deleteItemOnPublishFailure=function(e,t,i){var o=this,r=this.errorService.control(),a=[new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Delete"),function(e,t){r.hideDialog(),i()}),new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Cancel"),function(e,t){r.hideDialog()})];r.showCustomDialog(e,$("<div/>").text(t),a,(function(e){e.parent().find('input[value="'+o.localizationService.get("ModalDialogButtonText_No")+'"]').focus()}),!0)},e.prototype.getInsights=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:return this.telemetryService.logEvent(o.DashboardDatasetClickInsights,e.contentProviderId),[4,this.lazy("insightsBootstrap")];case 1:return t=i.sent(),t.start(e.dbName,e.vsName,e.packageId,powerbi.insights.constants.insightsSourceNavigationPane),[2]}}))}))},e.prototype.granularSecurity=function(e){return 6===e.contentProviderId?this.cloudRlsNotSupportedDialog():void(e.lastRefreshStatus===common.contracts.PublishOrRefreshStatus.RefreshInProgress||e.packagePublishStatus===common.contracts.PublishOrRefreshStatus.PublishInProgress?this.showRefreshInProgressDialog():this.navigation.showRowLevelSecuritySlider(e.id))},e.prototype.cloudRlsNotSupportedDialog=function(){return new FeatureNotSupportedDialogBuilder(this.modalDialogService).show("ModalDialog_CloudRlsUnSupportedTypeTitle","ModalDialog_CloudRlsUnSupportedTypeMessage","https://go.microsoft.com/fwlink/?LinkID=733530")},e.prototype.showRefreshInProgressDialog=function(){return new t(this.modalDialogService).show("RefreshInProgress",{titleText:"ModalDialog_CloudRlsDataRefreshTitle",messageText:"ModalDialog_CloudRlsDataRefreshMessage",okButtonText:"PBI_Button_Label_Close"})},e.prototype.handleDatasetAction=function(e,t){var i=null;switch(e){case 8:this.analyzeInExcel(t);break;case 1:this.createReport(t);break;case 7:case 16:this.delete(t);break;case 2:case 11:case 12:this.getInsights(t.contract);break;case 3:i=this.granularSecurity(t.contract);break;case 5:this.refreshNow(t.contract);break;case 4:this.rename(t.contract);break;case 6:this.refreshSchedule(t.contract);break;case 10:this.navigateToSettingsPage(t.contract);break;case 9:this.personalizeDataset(t);break;case 15:this.showStreamingDatasetEditorPane(t.id);break;case 14:this.showStreamingDatasetPushInfoPane(t.id);break;case 17:this.downloadPbix(t)}return i},e.prototype.navigateToSettingsPage=function(e){this.navigation.showSettingsSlider("datasets",e.dbName)},e.prototype.personalizeDataset=function(e){this.telemetryService.logEvent(o.DashboardClickPersonalize,e.contentProviderId),this.$rootScope.$emit(r.personalizeEventName,e.packageId)},e.prototype.refreshNow=function(e){this.telemetryService.logEvent(o.DashboardDatasetClickRefreshNow,e.contentProviderId),this.refreshService.tryRefreshNow(this.telemetryService,this.errorService,e,"datasets")},e.prototype.refreshSchedule=function(e){this.telemetryService.logEvent(o.DashboardDatasetClickScheduleRefresh,e.contentProviderId),this.navigation.showSettingsSlider("datasets",e.dbName)},e.prototype.rename=function(e){this.telemetryService.logEvent(o.DashboardDatasetClickRename,e.contentProviderId),this.settingsMetadataService.setSettings(4,e.dbName,e.id),this.taskPaneSliderService.expandPane(12,CollapsiblePaneExpandedWidth.Medium)},e.prototype.showStreamingDatasetEditorPane=function(e){this.realTimeModel.setSelected(e),this.taskPaneSliderService.expandPane(10)},e.prototype.showStreamingDatasetPushInfoPane=function(e){this.telemetryService.logEvent(o.RealTimeStreamingDatasetPushInfoPaneOpened),this.realTimeModel.setSelected(e),this.taskPaneSliderService.expandPane(11)},e})();return{create:function(e,t,i,o,r,n,s,c,l,d,p,u,h,v,g,m,f){return new a(e,t,i,o,r,n,s,c,l,d,p,u,h,v,g,m,f)}}}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.events,o=e.explore.services.events,r=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p){this.rootScope=e,this.timeout=t,this.modelConverter=i,this.explorationProxy=o,this.localizationService=r,this.telemetryService=a,this.navigation=n,this.modelService=s,this.packageService=c,
this.notificationBar=l,this.errorService=d,this.initialize()}return t.prototype.initialize=function(){var t=this;this.rootScope.$on(e.dataServices.constants.packageVersionChange,(function(e,i){return t.updateReportsWithPackageInfo(t.currentLoadReportContainerArgs,e,i)}))},t.prototype.load=function(e){this.currentLoadReportContainerArgs=e,this.verifyCompatiblityAndLoadExploration(e)},t.prototype.verifyCompatiblityAndLoadExploration=function(t){var i=this,r=t.report,a=t.openExplorationTelemetryEvent;t.instantiationMode!==e.common.contracts.reportServer.ReportInstantiationMode.Exploration&&t.instantiationMode!==e.common.contracts.reportServer.ReportInstantiationMode.NonTemplateForExistingTile?this.explorationProxy.get({id:r.id,model:r.model}).then((function(e){t.exploration=e,i.setCompatibilityModeAndLoadExploration(t)}),(function(r){if(r.error&&e.helpers.ReportUtility.shouldDisplayErrorAsNotificationBar(r.error.code)){var n=t.report,s=i.modelService.findModel(n.modelId,n.packageId),c={error:r.error,showNotification:!0};i.rootScope.$emit(o.reportVisualError.name,s,c,(function(){i.verifyCompatiblityAndLoadExploration(t)}))}else i.errorService.error(i.localizationService.get("ExplorationContainer_FailedToLoadReport"),"ExplorationContainer_FailedToLoadReport_DefaultDetails",{requestId:r?r.requestId:void 0},!1,e.telemetry.ErrorSource.PowerBI);i.rootScope.$emit(e.constants.openReportFinished,r&&r.error?r.error.message:"",!0),a&&a.reject({errorCode:r.error&&r.error.code?r.error.code:"FailToGetExploration",errorMessage:r.error&&r.error.message?r.error.message:null})})):this.setCompatibilityModeAndLoadExploration(t)},t.prototype.setCompatibilityModeAndLoadExploration=function(e){var t=this;this.timeout((function(){t.loadReportContainer(e)}),0),this.notifyReportUpdate(e.report.contract.packageId)},t.prototype.loadReportContainer=function(t){var o=null;this.navigation&&(o=this.navigation.additionalODataFilter);var r=t.report,a=this.modelService.findModel(r.modelId,r.packageId);a||(a=this.modelConverter.convertModel(r.model),this.modelService.addModel(a)),this.telemetryService.logEvent(e.telemetry.EXLoadReportContainer,r?r.objectId:null);var n={report:r,model:a,dashboardId:t.dashboardId,instantiationMode:t.instantiationMode,tileId:t.tileId,reportPage:t.reportPage,additionalODataFilter:o,exploration:t.exploration,openExplorationTelemetryEvent:t.openExplorationTelemetryEvent};this.rootScope.$emit(i.loadPowerViewReportEventName,n)},t.prototype.updateReportsWithPackageInfo=function(e,t,i){(this.navigation.inReportView()||this.navigation.inDatasetView())&&e&&e.report&&e.report.contract.packageId===i&&this.notifyReportUpdate(i)},t.prototype.notifyReportUpdate=function(e){if(e){var t=this.packageService.findPackage(e);if(t&&t.hasUpdate()){var i=jsCommon.StringExtensions.format(this.localizationService.get("DashboardContentPackNewVersion"),t.name);this.notificationBar.notify({message:i,hideOnStateChange:!0})}}},t})();t.ExplorationLoader=r})(t=e.services||(e.services={}))})(powerbi||(powerbi={})),define("powerBI/services/exportToPowerPointService",["require","exports"],(function(e,t){function i(e,t,i,o,r,n,s,c,l){return new a(e,t,i,o,r,n,s,c,l)}Object.defineProperty(t,"__esModule",{value:!0});var o=powerbi.common,r=15;t.create=i;var a=(function(){function e(e,t,i,o,r,a,n,s,c){this.telemetryService=e,this.notificationToast=t,this.errorService=i,this.localizationService=o,this.modalDialogService=r,this.rootScope=a,this.fileSaver=n,this.licenseEnforcementService=s,this.approvedResourcesService=c}return e.prototype.exportToPowerPoint=function(e){var t=this;if(this.licenseEnforcementService.supportsExportToPowerPoint(!0)){var i=this.telemetryService.startEvent(powerbi.telemetry.ExportToPowerPoint,!1,"",e.reportSectionsNumber);if(e.reportSectionsNumber>r)return this.showDialog(this.localizationService.get("ErrorTitle_CannotExportBigReports"),this.localizationService.get("ErrorMessage_CannotExportBigReports"),"ModalButton_ExportToPowerPoint_OK"),i.event.info.errorReason="tooManySections",void i.reject();var a=o.httpService.powerbiRequestOptions(i.event,"ExportPowerPoint");a.responseType=jsCommon.HttpConstants.ArrayBuffer,a.enableTelemetry=!0,a.retryCount=0;var n=this.notificationToast.notify({title:o.localize.get("NotificationMessage_ExportToPowerPointTitle"),message:o.localize.format("NotificationMessage_ExportToPowerPointSubtitle",[e.filename]),notificationType:o.NotificationToastType.Loading,sticky:!0}),s="/export/reports/"+e.reportId+"/pptx",c=this.getExportToPowerPointRequest();o.httpService.post(s,c,a).then((function(r){t.notificationToast.hide(n);var a=r.headers("Content-Type");if(a&&a.indexOf(jsCommon.HttpConstants.JsonContentType)>-1){var s=String.fromCharCode.apply(null,new Uint8Array(r.data)),c=s?jsCommon.JsonExtensions.tryParseJSON(s):null;if(c&&c.mailResponse===!0){i.event.info.mailResponse=!0;var l=t.localizationService.get("ModalTitle_ExportToPowerPoint_MailResponse"),d=t.localizationService.format("ModalMessage_ExportToPowerPoint_MailResponse",[e.filename,powerbi.session.UserInfoUtils.getEmailAddressForReceivingMail()]);t.showDialog(l,d,"ModalButton_ExportToPowerPoint_OK")}return void i.resolve()}i.resolve();var p=r.headers("Content-Disposition"),u=/filename[^;\n=]*=((['"]).*?\2|[^;\n]*)/,h=p?u.exec(p)[1]:e.filename+".pptx";t.fileSaver.saveAs(r.data,jsCommon.StringExtensions.normalizeFileName(h)),t.notificationToast.notify({title:t.localizationService.get("NotificationMessage_ExportToPowerPointSuccededTitle"),message:t.localizationService.format("NotificationMessage_ExportToPowerPointSuccededMessage",[e.filename]),notificationType:o.NotificationToastType.Success})}),(function(o){jsCommon.Trace.warning("could not retrieve powerpoint file for report: "+e.reportId),t.notificationToast.hide(n);var r=String.fromCharCode.apply(null,new Uint8Array(o.data)),a=r?jsCommon.JsonExtensions.tryParseJSON(r):null,s=a&&a.error?a.error.code:"",c=powerbi.common.exportToPowerPointErrorDialogTitle[s],l=powerbi.common.exportToPowerPointErrorDialogMessage[s];t.showError(c?c:"ErrorTitle_FailedToGeneratePowerPointFile",l?l:"ErrorMessage_FailedToGeneratePowerPointFile",o.requestId,o.status.toString()),i.event.info.errorReason=_.isEmpty(s)?"HttpStatus "+o.status.toString():s,i.reject()}))}},e.prototype.getExportToPowerPointRequest=function(){var e=function(e){return e&&e.phantomJSApproved},t=_.pick(this.approvedResourcesService.getAllApprovedResources(),e),i=_.keys(t),o={approvedResources:i};return o},e.prototype.showDialog=function(e,t,i){var o=this.rootScope.$new(),r=[new InJs.ModalDialogAction(this.localizationService.get(i),function(e,t){o.closeDialog()})];o.message=t;var a={dialogName:e,isDismissable:!0,scope:o,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",focusOnFirstButton:!0,dialogActions:r};this.modalDialogService.showLegacyWebModalDialog(a)},e.prototype.showError=function(e,t,i,r){this.errorService.error(o.localize.get(t),t,{requestId:i,statusCode:r,title:o.localize.get(e)})},e})()}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.CapacityLicenseSource,o=e.common.constants,r=o.navigation.states,a=e.constants.navigation.states,n=e.common.contracts.reportServer.ReportInstantiationMode,s=(function(){function t(e,t,i,r,a,n,s,c,l,d){var p=this;this.$location=e,this.$window=t,this.$state=r,this.stateParams=a,this.activeGroupIdService=s,this.home=c,this.navigationStateValidator=l,this.licenseEnforcementService=d,this.navigationStateValidator.setDefaultStateCallback((function(){return p.navigateToActiveDashboard()})),i.$on(o.showSettingsViewerEventName,(function(e,t,i){return p.showSettingsSlider(t,i)})),i.$on(o.navigation.stateChangeStart,(function(e,t,i,o,r){p.navigationStateValidator.validateStateChange(e,t.name,i,o.name,r)}));var u=i.$on(o.navigation.stateChangeSuccess,(function(){p.activeGroupIdService&&p.activeGroupIdService.initialGroupIdReadyPromise&&p.activeGroupIdService.initialGroupIdReadyPromise.then((function(){p.navigationStateValidator.validateState(p.stateService.current.name)})),u()}))}return t.prototype.convertLocationOption=function(e){var t;switch(e){case 1:t=!1;break;case 0:t=!0;break;case 2:t="replace";break;default:t=!0}return t},t.prototype.navigateToReport=function(t,i,o){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(a){switch(a.label){case 0:return[4,this.licenseEnforcementService.supportsReport(t.reportGUID,!0)];case 1:return(e=a.sent())?(r=_.cloneDeep(t),i&&l.optionalAdd(r,"initialLoad",1),this.navigateToReportInternal(r,o),[2]):[2]}}))}))},t.prototype.replaceHistoryWithDashboardAndNavigate=function(e,t,i){var o={location:this.convertLocationOption(0),inherit:!0},r=_.clone(this.stateService.params);r.dashboardGUID=e,!r.groupGUID&&i.groupGUID&&(r.groupGUID=i.groupGUID),this.stateService.go(a.dashboard,r,{location:this.convertLocationOption(2),inherit:!0}),this.stateService.go(t,i,o)},t.prototype.replaceHistoryWithDatasetAndNavigate=function(e,t,i){var o={location:this.convertLocationOption(0),inherit:!0},a=_.clone(this.stateService.params);a.datasetDBName=e,!a.groupGUID&&i.groupGUID&&(a.groupGUID=i.groupGUID),this.stateService.go(r.dataset,a,{location:this.convertLocationOption(2),inherit:!0}),this.stateService.go(t,i,o)},t.prototype.replaceHistoryWithGroupWelcomeAndNavigate=function(e,t,i){var o={location:this.convertLocationOption(0),inherit:!0},r=_.clone(this.stateService.params);r.groupGUID=e,this.stateService.go(a.groupWelcome,r,{location:this.convertLocationOption(2),inherit:!0}),this.stateService.go(t,i,o)},t.prototype.replaceAndLoadCurrentState=function(e,t){var i={location:this.convertLocationOption(2),inherit:!0},o=_.clone(this.stateService.params);_.extend(o,t),this.stateService.go(e,o,i)},t.prototype.navigateToContentListOrActiveDashboard=function(){var e=this.activeGroupIdService.activeGroupObjectId;this.navigateToContentList(e)},t.prototype.navigateToActiveDashboard=function(){this.stateService.go(a.dashboards,{groupGUID:this.activeGroupIdService.activeGroupObjectId},{inherit:!0})},t.prototype.navigateToApps=function(){this.stateService.go(a.apps,{groupGUID:e.constants.myWorkSpaceGroupId},{inherit:!0})},t.prototype.navigateToApp=function(e,t){t?this.stateService.go(a.appInstance,{appGUID:e,appInstanceId:t},{inherit:!0}):this.stateService.go(a.app,{appGUID:e},{inherit:!0})},t.prototype.toggleArchivedContent=function(e){void 0===e&&(e=null),window.initialDashboardContainer&&(window.location.href=window.location.protocol+"//"+window.location.host+"?tenantId="+window.initialDashboardContainer.previousTenantId)},t.prototype.insertGroupAndNavigateToDashboardByGUID=function(e,t,i){var o=this.inSharedWithMePath()&&this.currentDashboardGUID===e?a.sharedDashboard:a.dashboard;this.stateService.go(o,{dashboardGUID:e,groupGUID:t},{location:this.convertLocationOption(i),inherit:!0})},t.prototype.navigateToSharedDashboardByGUID=function(t,i){this.stateService.go(a.sharedDashboard,{dashboardGUID:t,groupGUID:e.constants.myWorkSpaceGroupId},{location:this.convertLocationOption(i),inherit:!0})},t.prototype.insertGroupAndNavigateToWorkbookByUniqueId=function(e,t){var i=this.inAppView()?r.appWorkbook:r.workbook,o=this.stateService.href(i,{workbookURLIdentifier:e,groupGUID:t},{inherit:!0});this.locationService.url(o)},t.prototype.navigateToGroupByGUID=function(e,t){this.stateService.go(a.group,{groupGUID:e},{location:this.convertLocationOption(t),inherit:!0})},t.prototype.resetToMyWorkspace=function(){this.navigateToGroupByGUID(e.constants.myWorkSpaceGroupId)},t.prototype.navigateToDashboardByGUID=function(e,t,i){void 0===i&&(i=!0);var o=this.inSharedWithMePath()&&this.currentDashboardGUID===e?a.sharedDashboard:a.dashboard;this.stateService.go(o,{dashboardGUID:e},{location:this.convertLocationOption(t),inherit:!0,notify:i})},t.prototype.navigateToDashboardMobileAuthoringByGUID=function(e,t,i){void 0===i&&(i=!0),this.stateService.go(a.dashboardMobileAuthoring,{dashboardGUID:e},{location:this.convertLocationOption(t),inherit:!0,notify:i})},t.prototype.navigateToAppDashboardByGUID=function(e,t,i,o,r,n,s){void 0===n&&(n=!0),void 0===s&&(s=null);var c={dashboardGUID:e,dashboardOriginalGUID:t,appGUID:i};l.optionalAdd(c,"groupGUID",o);var d;s?(d=a.appInstanceDashboard,l.optionalAdd(c,"appInstanceId",s)):d=a.appDashboard,this.stateService.go(d,c,{location:this.convertLocationOption(r),inherit:!0,notify:!0})},t.prototype.navigateToAppWorkbookByUniqueId=function(e,t,i,o){var a={workbookURLIdentifier:e,appGUID:t};l.optionalAdd(a,"groupGUID",i),this.stateService.go(r.appWorkbook,a,{location:this.convertLocationOption(o),inherit:!0,notify:!0})},t.prototype.navigateToHomeDashboard=function(e){this.insertGroupAndNavigateToDashboardByGUID(this.home.homeDashboard.dashboardObjectId,this.home.homeDashboard.groupId)},t.prototype.navigateToRequestDashboardAccessByGUID=function(e,t){var i=this.inSharedWithMePath()&&this.currentDashboardGUID==e?a.sharedDashboardRequestAccess:a.dashboardRequestAccess;this.stateService.go(i,{dashboardGUID:e},{location:this.convertLocationOption(t),inherit:!0})},t.prototype.navigateToGroupWelcome=function(e){e=e||this.currentGroupGUID,this.stateService.go(a.groupWelcome,{groupGUID:e},{inherit:!0})},t.prototype.navigateToDataset=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,o;return __generator(this,(function(a){switch(a.label){case 0:return[4,this.licenseEnforcementService.supportsDataset(t.datasetDBName,!0)];case 1:return(e=a.sent())?(o=_.cloneDeep(t),i?l.optionalAdd(o,"initialLoad",1):l.optionalAdd(o,"reloadCount",1),_.isNumber(t.instantiationMode)||(o.instantiationMode=n.Exploration),_.isNumber(t.datasetId)||(o.datasetId=null),this.stateService.go(r.dataset,o,{inherit:!0}),[2]):[2]}}))}))},t.prototype.navigateToFavorites=function(e){e?this.stateService.go(a.favorites,{groupGUID:e},{inherit:!0}):this.stateService.go(a.favorites,{},{inherit:!0})},t.prototype.navigateToContentList=function(e,t,i,o,r,n,s){var c={groupGUID:e};l.optionalAdd(c,"skipWelcome",t),l.optionalAdd(c,"contentListTab",i),l.optionalAdd(c,"instantiationMode",o),l.optionalAdd(c,"onlySharedWithMe",r),l.optionalAdd(c,"q",n),this.stateService.go(a.contentList,c,{location:this.convertLocationOption(s),inherit:!0})},t.prototype.navigateToContentListParams=function(e,t,i){void 0===i&&(i=!0);var o=_.clone(this.stateService.params);_.extend(o,e),this.stateService.go(a.contentListPivot,o,{location:this.convertLocationOption(t),inherit:!0,notify:i})},t.prototype.changeContentListPivot=function(e){var t=null;switch(e){case 0:t="dashboards";break;case 8:t="datasets";break;case 16:t="recent";break;case 2:t="reports";break;case 4:t="workbooks"}var i={pivot:t};this.stateService.go(a.contentListPivot,i,{location:this.convertLocationOption(2),inherit:!0,notify:!1})},t.prototype.navigateToEmptyFeaturedDashboard=function(){this.stateService.go(a.home,{},{inherit:!0})},t.prototype.navigateToRecentlyViewed=function(){this.stateService.go(a.recentlyViewed,{},{inherit:!0})},t.prototype.navigateToSharedWithMe=function(e){var t={};l.optionalAdd(t,"q",e),this.stateService.go(a.sharedWithMe,t,{inherit:!0})},t.prototype.navigateToWorkspaces=function(){this.stateService.go(e.constants.navigation.states.workspaces,{},{inherit:!0})},t.prototype.navigateToDashboardSubscriptionsPane=function(e,t,i,o){var a=o?r.appDashboardSubscription:r.dashboardSubscription;this.stateService.go(a,{dashboardGUID:e,groupGUID:t,dashboardOriginalGUID:i,appGUID:o},void 0)},t.prototype.navigateToReportSubscriptionsPane=function(e){this.navigateToReportInternal(e,void 0,void 0,!0)},t.prototype.navigateToDatasets=function(){this.navigateToContentList(this.currentGroupGUID,!0,8)},t.prototype.navigateToStreamingDatasets=function(e){this.navigateToContentList(this.currentGroupGUID,!0,8,e)},t.prototype.updateReportStateNoReload=function(e,t,i){if(t||this.inReportView())return this.navigateToReportInternal(e,i,{inherit:!0,notify:!1},this.inReportSubscriptionView())},t.prototype.navigateToGateways=function(){this.stateService.go(a.gateways)},t.prototype.navigateToGatewayItem=function(e,t,i){if(void 0===i&&(i=!0),e&&t){var o=this.convertLocationOption(2);this.stateService.go(a.dataSource,{gatewayId:e,dataSourceId:t,isNavigatingFromUi:i},{location:o,inherit:!0})}else e&&!t?this.stateService.go(a.gateway,{gatewayId:e},{inherit:!0,notify:!1}):this.navigateToGateways()},t.prototype.navigateToAdminPortal=function(e){var t=5===e?a.adminPortalCapacities:a.adminPortal;this.stateService.go(t,{adminPortalSettingsTab:e},{inherit:!0})},t.prototype.navigateToLicenseCapacities=function(e){var t=null;switch(e){case i.Azure:t=o.azureCapacityPivot;break;case i.Office365:t=o.officeCapacityPivot}var r={pivot:t,adminPortalSettingsTab:5};this.stateService.go(a.adminPortalCapacitiesPivot,r,{inherit:!0})},t.prototype.navigateToAdminPortalCapacity=function(e){this.stateService.go(a.adminPortalCapacity,{capacityId:e,adminPortalSettingsTab:5},{inherit:!0})},t.prototype.navigateToAdminPortalCreateCapacity=function(){this.stateService.go(a.adminPortalCreateCapacity,{adminPortalSettingsTab:5},{inherit:!0})},t.prototype.navigateToAppAutoInstall=function(){this.stateService.go(a.appAutoinstall,{},{inherit:!0})},t.prototype.navigateToWorkbookByUrlId=function(e,t,i,o){void 0===i&&(i=!1);var n;n=this.inAppView()?r.appWorkbook:i?a.sharedDashboardWorkbook:o?a.dashboardWorkbook:r.workbook,o=o||this.currentDashboardGUID;var s=this.stateService.href(n,{workbookURLIdentifier:e,activeSelection:t,dashboardGUID:o},{inherit:!0});this.locationService.url(s)},t.prototype.showQnaView=function(e,t,i){var o={q:e};"filter"in jsCommon.QueryStringUtil.parseQueryString()&&(o.filter=null);var r;r=this.inQnaModelView()?a.modelQna:this.inSharedWithMePath()?a.sharedDashboardQna:this.inAppInstanceView()?a.appInstanceDashboardQna:this.inAppView()?a.appDashboardQna:a.dashboardQna,this.stateService.go(r,o,{location:this.convertLocationOption(t),inherit:!0,notify:!i})},t.prototype.showInsightsPanel=function(e,t){var i=e.appGUID?a.appInsights:a.insights;this.stateService.go(i,e,{location:this.convertLocationOption(t),inherit:!0})},t.prototype.showAlertsEditor=function(e,t,i,o,r){var n={tileGUID:e,alertId:i,dashboardGUID:o};l.optionalAdd(n,"groupGUID",r),l.optionalAdd(n,"tileOriginalGUID",t),this.inAppInstanceView()?this.stateService.go(a.appInstanceAlertsEditor,n,{inherit:!0}):this.inAppView()?this.stateService.go(a.appAlertsEditor,n,{inherit:!0}):this.inSharedWithMePath()&&this.currentDashboardGUID==o?this.stateService.go(a.sharedAlertsEditor,n,{inherit:!0}):this.stateService.go(a.alertsEditor,n,{inherit:!0})},t.prototype.showInFocusMode=function(e,t,i,o,r){var n={tileGUID:e,dashboardGUID:i};l.optionalAdd(n,"groupGUID",r),l.optionalAdd(n,"tileOriginalGUID",t),l.optionalAdd(n,"dashboardOriginalGUID",o),this.inAppInstanceView()?this.stateService.go(a.appInstanceInFocusMode,n,{inherit:!0}):this.inAppView()?this.stateService.go(a.appInFocusMode,n,{inherit:!0}):this.inSharedWithMePath()&&this.currentDashboardGUID==i?this.stateService.go(a.sharedInFocusMode,n,{inherit:!0}):this.stateService.go(a.inFocusMode,n,{inherit:!0})},t.prototype.showInsightsInFocusMode=function(e,t,i,o){var r={tileGUID:e,dashboardGUID:i};l.optionalAdd(r,"groupGUID",o),l.optionalAdd(r,"tileOriginalGUID",t),this.inAppInstanceView()?this.stateService.go(a.appInstanceInFocusInsights,r,{inherit:!0}):this.inAppView()?this.stateService.go(a.appInFocusInsights,r,{inherit:!0}):this.inSharedWithMePath()&&this.currentDashboardGUID==i?this.stateService.go(a.sharedInFocusInsights,r,{inherit:!0}):this.stateService.go(a.inFocusInsights,r,{inherit:!0})},t.prototype.showSettingsSlider=function(e,t,i){var o=this.convertLocationOption(this.stateService.includes(a.settings)?2:0);this.stateService.go(t?a.settingsId:a.settingsGroup,{settingsGroup:e,settingsId:t},{location:o,inherit:!0,reload:i})},t.prototype.showPublishAppSlicer=function(){this.stateService.go(a.publishApp,{},{inherit:!0})},t.prototype.showPublishContentPackSlider=function(e){this.stateService.go(a.publishContent,{contentPackId:e},{inherit:!0})},t.prototype.showViewContentPackSlider=function(){this.stateService.go(a.viewContent,{},{inherit:!0})},t.prototype.showRowLevelSecuritySlider=function(e){this.stateService.go(a.rowLevelSecurity,{modelId:e},{inherit:!0})},t.prototype.showGetDataSlider=function(e,t,i){void 0===i&&(i=!0);var o=e||{getDataView:"getdata"};o.getDataView||(o.getDataView="getdata");var r=a.getData;o.categoryName&&(r=o.providerName?a.getDataCategoryProviderName:a.getDataCategory),this.stateService.go(r,o,{location:this.convertLocationOption(t),inherit:!0,notify:i})},t.prototype.showDevToolsSlider=function(){this.stateService.go(a.devTools,{},{inherit:!0})},t.prototype.showManageStorageSlider=function(){this.stateService.go(a.manageStorage)},t.prototype.showManageEmbedSlider=function(){this.stateService.go(a.manageEmbed)},t.prototype.navigateBack=function(e){void 0===e&&(e=-1),this.$window.history.go(e)},t.prototype.navigateForward=function(){this.$window.history.forward()},t.prototype.inAdminPortalView=function(){return this.stateService.includes(a.adminPortal)},t.prototype.inAppsDetailView=function(){return this.stateService.is(a.apps)},t.prototype.inAppsView=function(){return this.stateService.includes(a.apps)},t.prototype.inAppView=function(){return this.stateService.includes(a.app)},t.prototype.inAppInstanceView=function(){return this.stateService.includes(a.appInstance)},t.prototype.inAppArtifactView=function(){return(this.inAppView()||this.inAppInstanceView())&&!this.inAppDetailView()},t.prototype.inAppDetailView=function(){return this.stateService.is(a.app)||this.stateService.is(a.appInstance)},t.prototype.inCreateCapacityView=function(){return this.stateService.includes(a.adminPortalCreateCapacity)},t.prototype.inCapacitiesPivotView=function(){return this.stateService.is(a.adminPortalCapacitiesPivot)},t.prototype.inGroupView=function(){return this.stateService.includes(a.groups)},t.prototype.inLandingContainerView=function(){return this.stateService.is(a.landing)},t.prototype.inDashboardSubscription=function(){return this.stateService.includes(r.dashboardSubscription)||this.stateService.includes(r.appDashboardSubscription)},t.prototype.inDashboardView=function(){var e=this.stateService.includes(a.dashboards)&&!this.stateService.includes(a.dashboardReports)&&!this.stateService.includes(a.dashboardWorkbook)&&!this.stateService.is(a.dashboardMobileAuthoring),t=this.stateService.includes(a.sharedDashboard)&&!this.stateService.includes(a.sharedDashboardReports)&&!this.stateService.includes(a.sharedDashboardWorkbooks);return e||t||this.stateService.includes(a.appDashboards)||this.stateService.includes(a.appInstanceDashboards)},t.prototype.inDashboardAuthoringView=function(){return this.stateService.is(a.dashboardMobileAuthoring)},t.prototype.inDashboardPath=function(){return this.stateService.includes(a.dashboards)||this.stateService.includes(a.appDashboards)||this.stateService.includes(a.appInstanceDashboards)||this.stateService.includes(a.sharedDashboard)},t.prototype.inHomeDashboardView=function(){return this.stateService.includes(a.home)},t.prototype.inHybridView=function(){return this.stateService.includes(a.list)},t.prototype.inFavoritesView=function(){return this.stateService.includes(a.favorites)},t.prototype.inCapacitySettingsView=function(){return this.stateService.includes(a.adminPortalCapacities)},t.prototype.inContentListView=function(e){return!!this.stateService.includes(a.contentList)&&(!e||"true"===this.stateService.params.onlySharedWithMe)},t.prototype.inSharedWithMePath=function(){return this.stateService.includes(a.sharedWithMe)||this.inContentListView(!0)},t.prototype.inSharedWithMeView=function(){return this.stateService.is(a.sharedWithMe)||this.inContentListView(!0)},t.prototype.inPublishContentPackView=function(){return this.stateService.includes(a.publishContent)},t.prototype.inViewContentPackView=function(){return this.stateService.includes(a.viewContent)},t.prototype.inRowLevelSecurityView=function(){return this.stateService.includes(a.rowLevelSecurity)},t.prototype.inDashboardDetailView=function(){return this.stateService.is(a.dashboard)||this.stateService.is(a.appDashboard)||this.stateService.is(a.appInstanceDashboard)||this.stateService.is(a.sharedDashboard)},t.prototype.inGroupWelcomeView=function(){return this.stateService.is(a.groupWelcome)},t.prototype.inQnaView=function(){return this.stateService.includes(a.dashboardQna)||this.stateService.includes(a.sharedDashboardQna)||this.stateService.includes(a.appInstanceDashboardQna)||this.stateService.includes(a.appDashboardQna)},t.prototype.inQnaModelView=function(){return this.stateService.includes(a.modelQna)},t.prototype.inExtendTrial=function(){return this.stateService.includes(a.extendTrial)},t.prototype.inAccept2017ProTrial=function(){return this.stateService.includes(a.accept2017ProTrial)},t.prototype.inInsightsView=function(){return this.stateService.includes(a.insights)||this.stateService.includes(a.appInsights)},t.prototype.inRecentlyViewedView=function(){return this.stateService.includes(a.recentlyViewed)},t.prototype.inReportView=function(){return this.stateService.includes(r.reports)||this.stateService.includes(r.appReports)||this.stateService.includes(r.appInstanceReports)||this.stateService.includes(a.sharedDashboardReports)||this.stateService.includes(a.dashboardReports)},t.prototype.inReportDetailView=function(){return this.stateService.includes(r.report)||this.stateService.includes(r.appReport)||this.stateService.includes(r.appInstanceReport)||this.stateService.includes(a.sharedDashboardReport)||this.stateService.includes(a.dashboardReport)},t.prototype.inReportSubscriptionView=function(){return this.stateService.includes(r.reportSubscription)||this.stateService.includes(r.appReportSubscription)},t.prototype.inDatasetView=function(){return this.stateService.includes(r.dataset)},t.prototype.inGatewaysView=function(){return this.stateService.includes(a.gateways)},t.prototype.inDatasetDetailView=function(){return this.stateService.includes(r.dataset)},t.prototype.inWorkbookView=function(){return this.stateService.includes(r.workbook)||this.stateService.includes(r.appWorkbook)||this.stateService.includes(a.dashboardWorkbook)||this.stateService.includes(a.sharedDashboardWorkbook)},t.prototype.inWorkspacesView=function(){return this.stateService.includes(e.constants.navigation.states.workspaces)},t.prototype.inGetDataView=function(){return this.stateService.includes(a.getData)},t.prototype.inGetDataCategoryView=function(){return this.stateService.includes(a.getDataCategory)},t.prototype.inGetDataCategoryProviderView=function(){return this.stateService.includes(a.getDataCategoryProviderName)},t.prototype.inSharingView=function(){return this.stateService.includes(a.sharedDashboardShare)||this.stateService.includes(a.dashboardShare)},t.prototype.inAlertsEditorView=function(){return this.stateService.includes(a.alertsEditor)||this.stateService.includes(a.appAlertsEditor)||this.stateService.includes(a.appInstanceAlertsEditor)||this.stateService.includes(a.sharedAlertsEditor)},t.prototype.inInFocusView=function(){return this.stateService.includes(a.inFocusMode)||this.stateService.includes(a.appInFocusMode)||this.stateService.includes(a.appInstanceInFocusMode)||this.stateService.includes(a.sharedInFocusMode)},t.prototype.inInFocusInsightsView=function(){return this.stateService.includes(a.inFocusInsights)||this.stateService.includes(a.appInFocusInsights)||this.stateService.includes(a.appInstanceInFocusInsights)||this.stateService.includes(a.sharedInFocusInsights)},t.prototype.inFullPageSliderView=function(){return this.stateService.current.data&&this.stateService.current.data.fullPageSlider},t.prototype.inContentSliderView=function(){return this.stateService.current.data&&this.stateService.current.data.contentSlider},t.prototype.inManageStorageView=function(){return this.stateService.includes(a.manageStorage)},t.prototype.inSettingsView=function(){return this.stateService.includes(a.settings)},t.prototype.inManageEmbedView=function(){return this.stateService.includes(a.manageEmbed)},t.prototype.inRequestDashboardAccessView=function(){return this.stateService.includes(a.dashboardRequestAccess)||this.stateService.includes(a.sharedDashboardRequestAccess)},t.prototype.inReportEmbedView=function(){return!1},t.prototype.isRedirectedFromSignup=function(){return this.stateService.params.redirectedFromSignup},t.prototype.inManagePermissionsView=function(){return this.stateService.includes(e.common.constants.navigation.states.permissionCenter)||this.stateService.includes(e.common.constants.navigation.states.dashboardPermission)||this.stateService.includes(e.common.constants.navigation.states.reportPermission)||this.stateService.includes(e.common.constants.navigation.states.datasetPermission)||this.stateService.includes(e.common.constants.navigation.states.workbookPermission)},t.prototype.navigateToReportInternal=function(e,t,i,o){var n,s=_.extend({location:this.convertLocationOption(t),inherit:!0,notify:!0},i);return n=e.appGUID?e.appInstanceId?r.appInstanceReportPage:o||e.subscriptionGUID?r.appReportSubscription:r.appReportPage:o||e.subscriptionGUID?r.reportSubscription:e.dashboardGUID?this.inSharedWithMePath()&&e.dashboardGUID==this.currentDashboardGUID?a.sharedDashboardReportPage:a.dashboardReportPage:r.reportPage,_.isEmpty(e.filter)&&(e.filter=null),this.stateService.go(n,e,s)},Object.defineProperty(t.prototype,"contentListTab",{get:function(){var e=+this.stateService.params.contentListTab;return _.isNaN(e)?void 0:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentDatasetDBName",{get:function(){return this.stateService.params.datasetDBName},set:function(e){this.stateService.params.datasetDBName=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentDatasetId",{get:function(){return _.isEmpty(this.stateService.params.datasetId)?void 0:parseInt(this.stateService.params.datasetId)},set:function(e){this.stateService.params.datasetId=e},enumerable:!0,configurable:!0}),t.prototype.resetCurrentDatasetId=function(){this.stateService.go(this.stateService.current.name,{datasetId:void 0},{inherit:!0,notify:!1})},Object.defineProperty(t.prototype,"currentGroupGUID",{get:function(){return this.stateService.params.groupGUID||e.common.constants.myWorkspaceGroupId},set:function(e){this.stateService.params.groupGUID=e,this.stateParams.groupGUID=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentDashboardGUID",{get:function(){return this.stateService.params.dashboardGUID},set:function(e){this.stateService.params.dashboardGUID=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentDashboardOriginalGUID",{get:function(){return this.stateService.params.dashboardOriginalGUID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentAppGUID",{get:function(){return this.stateService.params.appGUID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentAppInstanceId",{get:function(){return parseInt(this.stateService.params.appInstanceId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTileGUID",{get:function(){return this.stateService.params.tileGUID},set:function(e){this.stateService.params.tileGUID=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTileOriginalGUID",{get:function(){return this.stateService.params.tileOriginalGUID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentAlertId",{get:function(){return parseInt(this.stateService.params.alertId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentReportGUID",{get:function(){return this.stateService.params.reportGUID},set:function(e){this.stateService.params.reportGUID=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentReportOriginalGUID",{get:function(){return this.stateService.params.reportOriginalGUID;
},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentWorkbookURLIdentifier",{get:function(){return this.stateService.params.workbookURLIdentifier},set:function(e){this.stateService.params.workbookURLIdentifier=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentWorkbookActiveSelection",{get:function(){return this.stateService.params.activeSelection},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentReportPage",{get:function(){return this.stateService.params.reportPage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSubscriptionGUID",{get:function(){return this.stateService.params.subscriptionGUID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentInviteId",{get:function(){return this.stateService.params.inviteid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentInviteObjectId",{get:function(){return this.stateService.params.inviteoid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentAdminPortalSettingsTab",{get:function(){return this.stateService.params.adminPortalSettingsTab},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantiationMode",{get:function(){return this.stateService.params.instantiationMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"categoryName",{get:function(){return this.stateService.params.categoryName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"getDataViewName",{get:function(){return this.stateService.params.getDataView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"providerName",{get:function(){return this.stateService.params.providerName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"settingsGroup",{get:function(){return this.stateService.params.settingsGroup},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"settingsId",{get:function(){return this.stateService.params.settingsId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentCapacityId",{get:function(){return this.stateService.params.capacityId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gatewayId",{get:function(){return parseInt(this.stateService.params.gatewayId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataSourceId",{get:function(){return parseInt(this.stateService.params.dataSourceId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"qnaQuery",{get:function(){return this.stateService.params.q},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"searchText",{get:function(){return this.stateService.params.q},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"insightsDataGUID",{get:function(){return this.stateService.params.dataGUID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"insightsSource",{get:function(){return this.stateService.params.insightsSource},enumerable:!0,configurable:!0}),t.prototype.resetInsightsSource=function(){this.stateService.go(this.stateService.current.name,{insightsSource:null},{location:this.convertLocationOption(2),inherit:!0,notify:!1})},Object.defineProperty(t.prototype,"contentPack",{get:function(){var e=parseInt(this.stateService.params.contentPackId);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowLevelSecurityModelId",{get:function(){var e=parseInt(this.stateService.params.modelId);return isNaN(e)?void 0:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"additionalODataFilter",{get:function(){return this.stateService.params.filter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collapseNavigation",{get:function(){return this.stateService.params.collapseNavigation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateService",{get:function(){return this.$state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"locationService",{get:function(){return this.$location},enumerable:!0,configurable:!0}),t})();t.Navigation=s;var c=(function(){function e(e,t,i){this.promiseFactory=t,this.$state=i,this.locationService=e}return e.prototype.navigateToReport=function(e,t,i){this.currentReportGUID=e.reportGUID,this.currentReportPage=e.reportPage,this.currentReportOriginalGUID=e.reportOriginalGUID,this.currentAppGUID=e.appGUID,this.currentAppInstanceId=e.appInstanceId,this.currentGroupGUID=e.groupGUID},e.prototype.replaceHistoryWithDashboardAndNavigate=function(e,t,i){this.currentDashboardGUID=e},e.prototype.replaceHistoryWithDatasetAndNavigate=function(e,t,i){},e.prototype.replaceHistoryWithGroupWelcomeAndNavigate=function(e,t,i){},e.prototype.replaceAndLoadCurrentState=function(e,t){},e.prototype.navigateToContentListOrActiveDashboard=function(){},e.prototype.navigateToActiveDashboard=function(){},e.prototype.navigateToGroupByGUID=function(e,t){},e.prototype.navigateToDatasets=function(){},e.prototype.navigateToStreamingDatasets=function(e){},e.prototype.navigateToDashboardByGUID=function(e,t,i){this.currentDashboardGUID=e},e.prototype.navigateToDashboardMobileAuthoringByGUID=function(e,t,i){this.currentDashboardGUID=e},e.prototype.navigateToAppDashboardByGUID=function(e,t,i,o,r,a,n){void 0===a&&(a=!0),void 0===n&&(n=null),this.currentDashboardGUID=e,this.currentDashboardOriginalGUID=t,this.currentAppGUID=i,_.isEmpty(o)||(this.currentGroupGUID=o)},e.prototype.navigateToAppWorkbookByUniqueId=function(e,t,i,o){this.currentWorkbookURLIdentifier=e,this.currentAppGUID=t,_.isEmpty(i)||(this.currentGroupGUID=i)},e.prototype.navigateToHomeDashboard=function(){},e.prototype.insertGroupAndNavigateToDashboardByGUID=function(e,t,i){this.currentDashboardGUID=e},e.prototype.navigateToSharedDashboardByGUID=function(e,t){this.currentDashboardGUID=e},e.prototype.insertGroupAndNavigateToWorkbookByUniqueId=function(e,t,i){},e.prototype.navigateToApps=function(){},e.prototype.navigateToApp=function(e){this.currentAppGUID=e},e.prototype.navigateToFavorites=function(){},e.prototype.navigateToContentList=function(e){},e.prototype.navigateToContentListParams=function(e,t,i){},e.prototype.changeContentListPivot=function(e){},e.prototype.navigateToEmptyFeaturedDashboard=function(){},e.prototype.navigateToRecentlyViewed=function(){},e.prototype.navigateToSharedWithMe=function(e){},e.prototype.navigateToWorkspaces=function(){},e.prototype.navigateToRequestDashboardAccessByGUID=function(e,t){},e.prototype.navigateToReportSubscriptionsPane=function(e){},e.prototype.navigateToDashboardSubscriptionsPane=function(e,t,i,o){},e.prototype.resetToMyWorkspace=function(){},e.prototype.updateReportStateNoReload=function(e,t,i){return this.promiseFactory.resolve(null)},e.prototype.initialLoadReportByGUID=function(e,t,i,o){},e.prototype.navigateToDataset=function(e,t){},e.prototype.navigateToGroupWelcome=function(e){},e.prototype.navigateToWorkbookByUrlId=function(e,t,i,o){},e.prototype.toggleArchivedContent=function(e){},e.prototype.navigateToGateways=function(){},e.prototype.navigateToAdminPortal=function(e){},e.prototype.navigateToLicenseCapacities=function(e){},e.prototype.navigateToAdminPortalCapacity=function(e){},e.prototype.navigateToAdminPortalCreateCapacity=function(){},e.prototype.navigateToAppAutoInstall=function(){},e.prototype.showQnaView=function(e,t,i){},e.prototype.showInsightsPanel=function(e,t){},e.prototype.showShareSlider=function(e){},e.prototype.showAlertsEditor=function(e,t,i,o,r){},e.prototype.showInFocusMode=function(e,t,i,o,r){},e.prototype.showInsightsInFocusMode=function(e,t,i,o){},e.prototype.showSettingsSlider=function(e,t){},e.prototype.showPublishAppSlicer=function(){},e.prototype.showPublishContentPackSlider=function(e){},e.prototype.showViewContentPackSlider=function(){},e.prototype.showGetDataSlider=function(e,t){},e.prototype.showDevToolsSlider=function(){},e.prototype.showAuthorCustomTileSlider=function(){},e.prototype.showRowLevelSecuritySlider=function(e){},e.prototype.showManageStorageSlider=function(e){},e.prototype.showManageEmbedSlider=function(){},e.prototype.inContentSliderView=function(){return!1},e.prototype.inFullPageSliderView=function(){return!1},e.prototype.navigateBack=function(e){},e.prototype.navigateForward=function(){},e.prototype.resetInsightsSource=function(){},e.prototype.resetCurrentDatasetId=function(){},e.prototype.inAdminPortalView=function(){return!1},e.prototype.inAppView=function(){return!1},e.prototype.inAppInstanceView=function(){return!1},e.prototype.inAppDetailView=function(){return!1},e.prototype.inAppsDetailView=function(){return!1},e.prototype.inAppsView=function(){return!1},e.prototype.inAppArtifactView=function(){return!1},e.prototype.inCreateCapacityView=function(){return!1},e.prototype.inCapacitiesPivotView=function(){return!1},e.prototype.inDatasetView=function(){return!1},e.prototype.inDatasetDetailView=function(){return!1},e.prototype.inGroupView=function(){return!1},e.prototype.inLandingContainerView=function(){return!1},e.prototype.inDashboardView=function(){return!1},e.prototype.inDashboardAuthoringView=function(){return!1},e.prototype.inDashboardSubscription=function(){return!1},e.prototype.inDashboardPath=function(){return!1},e.prototype.inDashboardDetailView=function(){return!1},e.prototype.inGroupWelcomeView=function(){return!1},e.prototype.inRecentlyViewedView=function(){return!1},e.prototype.inSharedWithMePath=function(){return!1},e.prototype.inSharedWithMeView=function(){return!1},e.prototype.inReportView=function(){return!1},e.prototype.inReportSubscriptionView=function(){return!1},e.prototype.inFavoritesView=function(){return!1},e.prototype.inContentListView=function(){return!1},e.prototype.inHomeDashboardView=function(){return!1},e.prototype.inHybridView=function(){return!1},e.prototype.inReportDetailView=function(){return!1},e.prototype.inWorkbookView=function(){return!1},e.prototype.inQnaView=function(){return!1},e.prototype.inQnaModelView=function(){return!1},e.prototype.inExtendTrial=function(){return!1},e.prototype.inAccept2017ProTrial=function(){return!1},e.prototype.inInsightsView=function(){return!1},e.prototype.inGetDataView=function(){return!1},e.prototype.inGetDataCategoryView=function(){return!1},e.prototype.inGetDataCategoryProviderView=function(){return!1},e.prototype.inPublishContentPackView=function(){return!1},e.prototype.inViewContentPackView=function(){return!1},e.prototype.inSharingView=function(){return!1},e.prototype.inInFocusView=function(){return!1},e.prototype.inInFocusInsightsView=function(){return!1},e.prototype.inManageStorageView=function(){return!1},e.prototype.inSettingsView=function(){return!1},e.prototype.inGatewaysView=function(){return!1},e.prototype.inManageEmbedView=function(){return!1},e.prototype.inRequestDashboardAccessView=function(){return!1},e.prototype.inReportEmbedView=function(){return!1},e.prototype.inRowLevelSecurityView=function(){return!1},e.prototype.inAlertsEditorView=function(){return!1},e.prototype.inWorkspacesView=function(){return!1},e.prototype.inCapacitySettingsView=function(){return!1},e.prototype.isRedirectedFromSignup=function(){return!1},e.prototype.inManagePermissionsView=function(){return!1},Object.defineProperty(e.prototype,"stateService",{get:function(){return this.$state},enumerable:!0,configurable:!0}),e.prototype.navigateToGatewayItem=function(e,t){},e})();t.MockNavigation=c;var l;!(function(e){function t(e,t,i){angular.isDefined(i)&&(e[t]=i)}e.optionalAdd=t})(l=t.NavigationHelper||(t.NavigationHelper={}))})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a,s,c,l,d,p,u,h,v,g,m,f,b){return new n(e,t,i,o,r,a,s,c,l,d,p,u,h,v,g,m,f,b)}var o,r=e.dataServices.constants,a=e.common.contracts.PublishOrRefreshStatus;!(function(e){e[e.Dashboard=1]="Dashboard",e[e.Report=2]="Report",e[e.Dataset=3]="Dataset"})(o=t.DeleteContentPackMessageType||(t.DeleteContentPackMessageType={})),t.createNavigationActions=i;var n=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f){this.$rootScope=e,this.contentPackService=t,this.dashboardService=i,this.datasetActions=o,this.errorService=r,this.featureSwitchService=a,this.localizationService=n,this.modalDialogService=s,this.modelService=c,this.navigation=l,this.packageService=d,this.quota=p,this.reportService=u,this.workbookService=v,this.ownershipService=g,this.navigationHelper=f}return t.prototype.initialize=function(){var t=this;this.$rootScope.$on(e.constants.openReportEventName,(function(e,i){e.stopPropagation(),e.preventDefault();var o=t.reportService.findReport(i);t.openReport(o)})),this.$rootScope.$on(e.constants.deleteReportEventName,(function(e,i){e.stopPropagation(),e.preventDefault(),t.deleteReport(i)})),this.$rootScope.$on(e.constants.deleteModelEventName,(function(e,i,o,r){e.stopPropagation(),e.preventDefault();var a=t.modelService.findModel(i,o);a&&a.isUsedByContentPack?t.contentPackService.showDialogOnModelDeleteInContentPack(i):t.deleteModel(i,o,r)})),this.$rootScope.$on(e.constants.renameModelEventName,(function(e,i,o,r){e.stopPropagation(),e.preventDefault(),t.modelService.renameModel(i,o,r)})),this.$rootScope.$on(e.constants.replaceLocalWorkbookEventName,(function(i,o){i.stopPropagation(),i.preventDefault(),t.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.GetData)||t.workbookService.replaceLocalWorkbook(o)})),this.$rootScope.$on(r.workbook.viewWorkbookEventName,(function(e,i,o){e.stopPropagation(),e.preventDefault();var r=t.workbookService.findWorkbook(i,o);t.viewWorkbook(r)})),this.$rootScope.$on(e.dataServices.constants.workbook.removeWorkbookEventName,(function(e,i,o){e.stopPropagation(),e.preventDefault();var r=t.workbookService.findWorkbook(i.id,i.packageId);r&&r.isUsedByContentPack?t.contentPackService.showDialogOnWorkbookRemoveInContentPack(i.id):t.removeWorkbook(r,o)}))},t.prototype.openReport=function(e){return e.isNew=!1,null!=e.packagePublishStatus&&e.packagePublishStatus!==a.FinishedSuccessfully&&e.packagePublishStatus!==a.RefreshInProgress&&e.packagePublishStatus!==a.RefreshError?void(e.packagePublishStatus===a.PublishError&&this.deleteReportOnPublishFailure(e.id)):void this.navigationHelper.navigateToReport(e)},t.prototype.openModel=function(e){this.datasetActions.createReport(e)},t.prototype.viewWorkbook=function(e){if(e.isNew=!1,this.featureSwitchService.featureSwitches.embedFullFidelityWorkbooks){var t=this.workbookService.getWorkbookUniqueId(e),i=this.ownershipService.isResourceSharedWithMe(e);this.navigation.navigateToWorkbookByUrlId(t,null,i)}else this.$rootScope.$emit(r.workbook.openWorkbookContextMenuEventName,e)},t.prototype.deleteItemOnPublishFailure=function(e,t,i){var o=this,r=this.errorService.control(),a=[new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Delete"),function(e,t){r.hideDialog(),i()}),new InJs.ModalDialogAction(this.localizationService.get("PBI_Button_Label_Cancel"),function(e,t){r.hideDialog()})];r.showCustomDialog(e,$("<div/>").text(t),a,(function(e){e.parent().find('input[value="'+o.localizationService.get("PBI_Button_Label_Cancel")+'"]').focus()}),!0)},t.prototype.deleteReport=function(e){var t=this,i=this.$rootScope.$new(),o=this.errorService.control(),r=[new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Delete"),function(i,r){o.hideDialog();var a=t.reportService.findReport(e);t.reportService.deleteReport(e),a&&a.objectId===t.navigation.currentReportGUID&&t.navigation.navigateToActiveDashboard()}),new InJs.ModalDialogAction(this.localizationService.get("PBI_Button_Label_Cancel"),function(e,t){o.hideDialog()})],a=this.reportService.findReport(e);i.message=this.localizationService.format("Report_DeleteConfirmationMessage",[a.displayName]);var n,s,c=this.dashboardService.hasTileForReportandSection(void 0,e);c&&(n=jsCommon.ModalDialogNotificationType.Warning,s=this.localizationService.get("PinLiveReport_DeleteReportWarning"));var l={dialogName:this.localizationService.get("Report_DeleteConfirmationTitle"),isDismissable:!0,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",focusOnFirstButton:!0,dialogActions:r,notificationType:n,notificationText:s};this.modalDialogService.showLegacyWebModalDialog(l)},t.prototype.deleteModel=function(e,t,i){var r,a,n=this,s=this.errorService.control(),c=[new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Delete"),function(i,o){s.hideDialog();var r=!!n.reportService.findReportByGUID(n.navigation.currentReportGUID),a=n.modelService.findModel(e,t),c=a?a.dbName:null,l=n.navigation;n.modelService.deleteModel(e,t),(n.reportService.currentActiveReport&&n.reportService.currentActiveReport.id===e||r&&!n.reportService.findReport(n.reportService.currentActiveReport.id)||l.inInsightsView()&&l.insightsDataGUID===c||l.inRowLevelSecurityView()&&l.rowLevelSecurityModelId===a.id)&&l.navigateToActiveDashboard()}),new InJs.ModalDialogAction(this.localizationService.get("PBI_Button_Label_Cancel"),function(e,t){s.hideDialog()})],l=this.modelService.findModel(e,t);switch(i){case o.Dashboard:r=this.localizationService.get("Dashboard_DeleteConfirmationTitle"),a=this.localizationService.get("Dashboard_DeleteOrgAppContentPack");break;case o.Report:r=this.localizationService.get("Report_DeleteConfirmationTitle"),a=this.localizationService.get("Report_DeleteOrgAppContentPack");break;case o.Dataset:r=this.localizationService.get("Model_DeleteConfirmationTitle"),a=this.localizationService.get("Model_DeleteOrgAppContentPack");break;default:r=this.localizationService.get("Model_DeleteConfirmationTitle"),a=this.localizationService.format("Model_DeleteConfirmationMessage",[l.displayName])}s.showCustomDialog(r,$("<div/>").text(a),c,(function(e){e.parent().find('input[value="'+n.localizationService.get("PBI_Button_Label_Cancel")+'"]').focus()}),!0)},t.prototype.deleteReportOnPublishFailure=function(e){var t=this;this.deleteItemOnPublishFailure(this.localizationService.get("NavigationPane_ReportPublishErrorTitle"),this.localizationService.get("NavigationPane_ReportPublishErrorContent"),(function(){t.reportService.deleteReport(e)}))},t.prototype.removeWorkbook=function(e,t){var i,r,a=this;switch(t){case o.Dashboard:i="Dashboard_DeleteConfirmationTitle",r="Dashboard_DeleteConfirmationTitle";break;default:i="Workbook_RemoveConfirmationTitle",r=e.isOwner()?this.packageService.isLocalWorkbook(e.packageId)?"Workbook_RemoveOwnedLocalConfirmationMessage":"Workbook_RemoveOwnedRemoteConfirmationMessage":e.isPersonalized()?"Workbook_RemovePersonalizedConfirmationMessage":"Workbook_RemoveInOrgPackConfirmationMessage"}var n=this.localizationService.get(i),s=this.localizationService.get(r),c=this.errorService.control(),l=[new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Remove"),function(t,i){c.hideDialog(),a.workbookService.removeWorkbook(e.id,e.packageId,a.packageService.getWorkbookStorageProvider(e.packageId),a.packageService.getWorkbookContentProvider(e.packageId));var o=a.workbookService.currentActiveWorkbook;o&&o.id===e.id&&o.packageId===e.packageId&&a.navigation.navigateToActiveDashboard()}),new InJs.ModalDialogAction(this.localizationService.get("PBI_Button_Label_Cancel"),function(e,t){c.hideDialog()})];c.showCustomDialog(n,$("<div/>").text(s),l,(function(e){e.parent().find('input[value="'+a.localizationService.get("PBI_Button_Label_Cancel")+'"]').focus()}),!0)},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={})),define("powerBI/services/performanceInspector",["require","exports"],(function(e,t){function i(e,t,i,r){return new o(e,t,i,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i;var o=(function(){function e(e,t,i,o){this.localize=e,this.dashboardService=t,this.visualPluginService=i,this.serverLatencyService=o}return e.prototype.analyzeActiveDashboard=function(){var e=this;return this.serverLatencyService.getServerLatencyInMs().then((function(t){var i=e.dashboardService.getActiveDashboard();if(!i)return[];var o=[];return o.push.apply(o,e.analyzeReportTiles(i)),o.push.apply(o,e.analyzeCustomVisuals(i)),o.push(e.analyzeAllTiles(i)),o.push(e.analyzeNetwork(t)),o=_.compact(o),e.mergeInfos(o)}),(function(){return[]}))},e.prototype.analyzeAllTiles=function(e){var t=_.size(e.tiles);if(t>20)return{code:9,summary:this.getTitle("TooManyTiles"),message:this.formatMessage("TooManyTiles",[t]),mood:0}},e.prototype.analyzeReportTiles=function(e){var t=_.filter(e.tiles,(function(e){return!!e.reportTile}));if(_.isEmpty(t))return[];for(var i=[this.warnReportTilesArePresent(t)],o=0,r=t;o<r.length;o++){var a=r[o];i.push(this.analyzeReportTileVisuals(a))}return i},e.prototype.analyzeReportTileVisuals=function(e){var t=e.reportTile.contract,i=e.reportTile.exploration,o=t.sectionId,r=_.find(i.sections,(function(e){return e.contract.id===o}));if(r){var a=_.size(r.contract.visualContainers);return 1===a?{code:0,summary:this.getTitle("SingleVisualReportTile"),message:this.getMessage("SingleVisualReportTile"),tileIds:[e.id],mood:1}:a>7?{code:1,summary:this.getTitle("ReportTileWithTooManyVisuals"),message:this.getMessage("ReportTileWithTooManyVisuals"),tileIds:[e.id],mood:0}:void 0}},e.prototype.warnReportTilesArePresent=function(e){var t=_.map(e,(function(e){return e.id}));return 1===e.length?{code:3,summary:this.getTitle("OneReportTile"),message:this.getMessage("OneReportTile"),tileIds:t,mood:1}:{code:2,summary:this.getTitle("MultipleReportTiles"),message:this.getMessage("MultipleReportTiles"),tileIds:t,mood:0}},e.prototype.analyzeCustomVisuals=function(e){var t=this,i=_.filter(e.tiles,(function(e){return e.composite&&e.composite.visual&&t.visualPluginService.isCustomVisual(e.composite.visual.type)}));if(i.length<5)return[];var o=_.map(i,(function(e){return e.id}));return[{code:5,summary:this.getTitle("CustomVisual"),message:this.getMessage("CustomVisual"),tileIds:o,mood:1}]},e.prototype.analyzeNetwork=function(e){var t,i;if(e=Math.round(e),null!=e&&e!==-1)return e<50?(t=this.getNetworkLatencyMessage(e,"Excellent"),i=2):e<200?(t=this.getNetworkLatencyMessage(e,"Good"),i=2):e<400?(t=this.getNetworkLatencyMessage(e,"Acceptable"),i=1):(t=this.getNetworkLatencyMessage(e,"Poor"),i=0),{code:8,summary:this.getTitle("Latency"),message:t,mood:i}},e.prototype.mergeInfos=function(e){for(var t=[],i=_.groupBy(e,(function(e){return e.code})),o=_.values(i),r=0,a=o;r<a.length;r++){var n=a[r],s=_.clone(n[0]);s.tileIds=_.reduce(n,(function(e,t){return e.push.apply(e,t.tileIds),e}),[]),t.push(s)}return t},e.prototype.formatMessage=function(e,t){return this.localize.format("PerfInspector_"+e,t)},e.prototype.getMessage=function(e){return this.localize.get("PerfInspector_"+e)},e.prototype.getTitle=function(e){return this.localize.get("PerfInspector_Title_"+e)},e.prototype.getNetworkLatencyMessage=function(e,t){var i=this.localize.get("PerfInspector_Latency_"+t);return this.formatMessage("Latency",[e,i])},e})()}));var powerbi;!(function(e){var t=e.dataServices.AppUtils,i=e.common.models.CollapsiblePaneExpandedWidth,o=e.common.helpers,r=e.common.constants.navigation.states,a=e.dataServices.constants,n=e.dataServices.models.Dashboard,s=e.controllers.DashboardContainerController,c=e.dataServices.models.DashboardTileModel,l=e.dataServices.DashboardUtils,d=e.errorDetailsHelper,p=e.dataServices.models.getDashboardGuidFromUrl,u=e.constants.navigation.states,h=e.dataServices.contracts.PackageType,v=e.common.contracts.Permissions,g=e.common.models.Report,m=e.visualHost.ResourcePackageReferenceResolver,f=e.common.constants.tileActions,b=e.dataServices.TileUtils,y=e.dataServices.models.Workbook,S=10,w=2e3,D=3,C=(function(){function C(t,i,o,r,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C,T,I,k,M,P,E,A,x,R,_,F,N,L,O,G,U,z,B,W,V,$,H,j,q,Q,K,J,X,Y,Z,ee){var te=this;this.$location=t,this.rootScope=i,this.navigation=o,this.timeout=r,this.telemetryService=n,this.errorService=s,this.modelMerger=c,this.modelConverter=l,this.syncService=d,this.dashboardConfigurationService=p,this.dashboardDataService=u,this.dashboardHttpService=h,this.dashboardSyncService=v,this.dashboardWarningsService=g,this.localizationService=f,this.mobileAuthoringService=b,this.modalDialogService=y,this.moduleLoader=S,this.promiseFactory=w,this.reportService=D,this.viralTenantMergeHelperService=T,this.groupService=I,this.featureSwitchService=k,this.modelService=M,this.licenseEnforcementService=P,this.userInfo=E,this.storageUsageService=x,this.appMetadataService=R,this.permissionService=_,this.workbookService=F,this.notificationBar=N,this.notificationToastService=L,this.resourcePackagesService=O,this.userSettingsService=G,this.visualPluginService=U,this.dashboardInvitationHttp=z,this.resourcePackageGateService=B,this.home=W,this.packageService=V,this.userActivityContextService=H,this.mostRecentlyUsedService=j,this.appService=q,this.editableFeatureSwitchService=Q,this.conceptualModelSetting=K,this.taskPaneSliderService=J,this.fileSaver=X,this.navigationHelper=Y,this.lazy=Z,this.dashboardInvitationService=ee,this.temporayObjectID=function(e){return"TEMP_ID"+e},this.temporaryDashboardId=-100,this.temporaryTileId=-100,this.modelIdsForTileRefresh=[],this.readyForConceptualModelInitializationDeferred=this.promiseFactory.defer(),this.readyForConceptualModelInitializationPromise=this.readyForConceptualModelInitializationDeferred.promise,this.dashboardsOwnersMergedDeferred=this.promiseFactory.defer(),this.dashboardsDeferred=this.promiseFactory.defer(),this.loadAndInitializeDashboardsOnInvitation(),this.mergeDashboardOwnerInfoOnPageLoad(),this.updateActiveDashboardPromise=void 0,this.dashboardSyncService.beforeDashboardDeleting=function(e){te.beforeDashboardDeletingHandler(e)},this.dashboardSyncService.afterDashboardDeleting=function(e){te.afterDashboardDeletingHandler(e)};var ie=this.rootScope.$on(e.constants.renameDashboardEventName,(function(e,t,i){return te.renameDashboard(t,i)})),oe=this.rootScope.$on(e.constants.groupSwitchedEventName,(function(e,t,i,o){return te.onGroupSwitched(t,i,o)})),re=this.rootScope.$on(e.constants.notifyDashboardUpdate,(function(e){return te.notifyDashboardUpdate()})),ae=this.rootScope.$on(a.onDashboardShallowEditEventName,(function(e,t,i){return te.onDashboardShallowEdit(t,i)})),ne=this.rootScope.$on(a.addOrUpdateDashboardEventName,(function(e,t,i){return te.addOrUpdateDashboard(t,i)})),se=this.rootScope.$on(a.mergeDashboardContainerModelsReportsAndPackagesEventName,(function(t,i){return e.contracts.mergeDashboardContainerModelsReportsAndPackages(i,te.dashboardContainerModel.contract)})),ce=this.rootScope.$on(a.updateDashboardContainerEventName,(function(e,t){return te.updateDashboardContainer(t)})),le=this.rootScope.$on(e.dataServices.constants.packageVersionChange,(function(e,t){return te.updateDashboardWithPackageInfo(e,t)}));this.rootScope.$on("$destroy",(function(){re(),oe(),ie(),le(),ae(),ne(),se(),ce(),le()}))}return C.prototype.getDashboards=function(){return this.dashboardsDeferred.promise.then((function(e){return e.dashboards}))},C.prototype.dashboardsOwnersMergedPromise=function(){return this.dashboardsOwnersMergedDeferred.promise},C.prototype.mergeDashboardOwnerInfoOnPageLoad=function(){var e=this;this.userInfo.userMetadataPromise.then((function(t){if(t)return e.appMetadataService.getAppMetadata().finally((function(){e.mergeDashboardOwnerInfo(t),e.dashboardsOwnersMergedDeferred.resolve(null)}))}))},C.prototype.mergeDashboardOwnerInfo=function(t){if(t&&t.dashboardOwnerInfo){for(var i=0,o=t.dashboardOwnerInfo;i<o.length;i++){var r=o[i],a=this.findDashboard(r.dashboardId);a&&this.modelMerger.mergeDashboardOwnerInfo(a,r)}this.rootScope.$emit(e.constants.notifyDashboardOwnerInfoLoaded)}},C.prototype.getActiveDashboard=function(){return this.dashboardDataService.activeDashboard},C.prototype.renameDashboard=function(t,i){var o=this;if(this.isDashboardNameValid(t,i)){var r=this.dashboardContainerModel,a=r.findDashboard(i),n=a.contract.displayName;if(n!==t){var s=this.telemetryService,c=s.startEvent(e.telemetry.DashboardRenameDashboard,angular.isUndefined(a.tiles)||!a.tiles?0:a.tiles.length,a.objectId);a.displayName=a.contract.displayName=t,this.dashboardHttpService.renameDashboard(a.contract,t,c.event).then((function(){a&&a.isUsedByContentPack&&o.rootScope.$emit(e.constants.contentPackDirtyShowNotification,i,e.dataServices.models.ContentPackItems.Dashboard),c.resolve()}),(function(t){t.status!==e.HttpStatusCode.Unauthorized&&(o.errorService.error(o.localizationService.get("Dashboard_FailToRenameDashboardMessage"),"Dashboard_FailToRenameDashboard",{requestId:t.requestId,statusCode:t.status.toString()}),a.displayName=n,a.contract.displayName=n),c.reject()}))}}},C.prototype.addDashboard=function(t,i){var o=this,r=void 0!==i;if(!this.storageUsageService.checkQuotaExceeded(this.dashboards,e.telemetry.QuotaCheckOperation.AddDashboard)&&this.isDashboardNameValid(t,null)){var a=this.telemetryService,n=a.startEvent(e.telemetry.DashboardAddDashboard,null,null),s={objectId:this.temporayObjectID(this.temporaryDashboardId),id:this.temporaryDashboardId--,displayName:t,version:"",tiles:[],permissions:v.All,isHidden:!1},c=this.modelConverter.convertDashboard(s);c.displayName=t,c.id=s.id,c.isLoaded=!0,r&&(c.isNew=!0,c.isNotified=!1),this.dashboardDataService.addDashboard(c),r||(this.navigation.navigateToDashboardByGUID(s.objectId,1),this.rootScope.$emit(e.constants.scrollNavPaneToActiveDashboardEventName)),this.dashboardHttpService.addDashboard(s,n.event).then((function(t){var a,l,d,p=t.data;o.dashboardContainerModel.cacheTemporaryDashBoardMapping(s.objectId,p.objectId),s.id=p.id,c.id=p.id,s.objectId=p.objectId,o.groupService.activeGroup.aadGroupId===e.constants.myWorkSpaceGroupId?(a=o.userInfo.name,l=o.userInfo.givenName,d=o.userInfo.surname):(l=o.groupService.activeGroup.displayName,a=o.groupService.activeGroup.contract.mailNickname);var u={dashboardId:s.id,emailAddress:a,givenName:l,familyName:d};o.modelMerger.mergeDashboardOwnerInfo(c,u),o.userInfo.addOrUpdateDashboardOwnerInfoCache(u),o.rootScope.$emit(e.constants.notifyDashboardOwnerInfoLoaded),o.dashboardWarningsService.showWarningsIfNeeded(),o.updateActiveDashboard(p.id,void 0,null,i);var h=n.event.info;h.pendingRequestCount=t.pendingRequestCount,h.dashboardGuid=s.objectId,n.resolve(),r||o.navigation.inContentListView()||(o.mostRecentlyUsedService.updateMRU(e.models.MRUArtifactType.Dashboards,s.objectId,s.displayName,s.permissions),o.navigation.navigateToDashboardByGUID(s.objectId,0))}),(function(e){o.errorService.error(o.localizationService.get("Dashboard_FailToCreateDashboardMessage"),"Dashboard_FailToCreateDashboard",{requestId:e.requestId,statusCode:e.status.toString()}),n.event.info.pendingRequestCount=e.pendingRequestCount,n.reject(d.getTelemetryErrorDetails(e.error))}))}},C.prototype.addOrUpdateDashboard=function(e,t){this.modelConverter.fillDashboardContainerDashboard(this.dashboardContainerModel,e);var i=this.dashboardContainerModel.visibleDashboards;t&&1===i.length&&this.inContentListViews()&&this.navigationHelper.navigateToDashboard(i[0]),this.dashboardContainerModel.calculateLayout(),this.dashboardContainerModel.applyLayout()},C.prototype.preloadLinkedDashboards=function(t){var i=this,o=this.promiseFactory.defer(),r=this.dashboardDataService,a=this.featureSwitchService.featureSwitches.preloadLinkedDashboardEnabled;if(!a)return o.reject(),o.promise;var n=r.findDashboard(t);if(!n||!n.isLoaded||_.isEmpty(n.tiles))return o.reject(),o.promise;for(var s=_.indexBy(r.dashboards,(function(e){return e.objectId.toLowerCase()})),c=[],l=0,u=n.tiles;l<u.length;l++){var h=u[l],v=h&&h.action;if(v&&v.action===f.custom.openUrlActionName){var g=p(v.targetUrl);if(g){var m=s[g.toLowerCase()];if(m&&!m.isLoaded&&(c.push(m.id),c.length>=S))break}}}if(0===c.length)return o.resolve(null),o.promise;c=_.uniq(c);var b=this.telemetryService.startEvent(e.telemetry.DashboardPreloadLinkedDashboard,c.length,n.objectId);return this.dashboardHttpService.batchGetDashboards(this.promiseFactory,c,b.event).then((function(e){i.updateDashboardContainer(e.data),
o.resolve(null),b.resolve()}),(function(e){o.reject(),b.reject(d.getTelemetryErrorDetails(e?e.error:null,e?e.status:null))})),o.promise},C.prototype.addOrUpdateTile=function(e,t,i){this.dashboardSyncService.addOrUpdateTile(e,t,i)},C.prototype.selectDashboardTile=function(e){e.tileModel.isSelected=!0,this.dashboardDataService.selectedDashboardTile=e},C.prototype.clearSelectedDashboardTile=function(){var e=this.dashboardDataService.selectedDashboardTile;null!=e&&(e.isSelected=!1,this.dashboardDataService.selectedDashboardTile=null)},C.prototype.scrollToSelectedTile=function(){this.rootScope.$emit(e.constants.scrollToSelectedTileEventName)},C.prototype.batchUpdateTileSizePosition=function(t,i){var o=this,r=this.telemetryService.startEvent(e.telemetry.DashboardTileLayoutChanged,i.length),a=this.dashboardHttpService.batchUpdateTileSizePosition(this.promiseFactory,t.contract,i,r.event);return a&&a.then((function(){r.resolve(),t&&t.isUsedByContentPack&&o.rootScope.$emit(e.constants.contentPackDirtyShowNotification,t.id,e.dataServices.models.ContentPackItems.Dashboard)}),(function(){r.reject()})),a},C.prototype.promptForDeleteDashboard=function(e,t){var i=this,o=this.errorService.control(),r=[new InJs.ModalDialogAction(t?this.localizationService.get("ModalDialogButtonText_Delete"):this.localizationService.get("ModalDialogButtonText_Remove"),function(r,a){o.hideDialog(),i.deleteDashboardInternal(e,t)}),new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Cancel"),function(e,t){o.hideDialog()})],a=this.findDashboard(e),n=t?this.localizationService.get("Dashboard_DeleteConfirmationTitle"):this.localizationService.get("Dashboard_RemoveConfirmationTitle"),s=this.localizationService.format(t?"Dashboard_DeleteConfirmationMessage":"Dashboard_RemoveConfirmationMessage",[a.displayName]);o.showCustomDialog(n,$("<div/>").text(s),r,(function(e){e.parent().find('input[value="'+i.localizationService.get("ModalDialogButtonText_Cancel")+'"]').focus()}),!0)},C.prototype.exportDashboard=function(t,i){var o,r=this,a=this.dashboardContainerModel,n=_.filter(a.dashboards,(function(e){return e.id===t}))[0];if(n){o=n.contract;var s="dashboardpackage.zip",c=this.telemetryService,l=c.startEvent(e.telemetry.DashboardExportDashboard,o.objectId),d=this.dashboardHttpService.exportDashboard(o,i,l.event);if(d){var p=this.notificationToastService.notify({title:this.localizationService.get("NotificationMessage_ExportingPackage"),notificationType:e.common.NotificationToastType.Loading});d.then((function(e){l.resolve(),r.notificationToastService.hide(p),r.fileSaver.saveAs(e.data,s)}),(function(t){t.status!==e.HttpStatusCode.Unauthorized&&r.errorService.error(r.localizationService.get("Dashboard_FailToExportDashboardMessage"),"Dashboard_FailToExportDashboard",{requestId:t.requestId,statusCode:t.status.toString()}),l.reject()}))}}else this.errorService.error(this.localizationService.get("Dashboard_FailToExportDashboardMessage"),"Dashboard_FailToExportDashboard")},C.prototype.hideDashboard=function(t,i){var o=t.getDashboardIndex(i),r=this.getDashboardContractIndex(t.contract,i);if(!(o<0||r<0)){var a=t.dashboards,n=a[o],s=n.getPermissions();n.isSharedFromSecurityGroup&&(s===v.Read||s===v.ReadReshare);n.contract.isHidden=!0,n.isHidden=!0,this.dashboardDataService.dropDashboardfromMemoryIfNotActive(i),this.afterDashboardDeletingHandler(i),this.navigateAfterDashboardDelete(t,i),this.mostRecentlyUsedService.removeMRU(n.contract.objectId),this.navigation.inSharedWithMeView()&&this.rootScope.$emit(e.constants.updateSharedWithMe)}},C.prototype.requestDashboardAccess=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return this.hasAccessRequestInfo(t)?(e=this.dashboardContainerModel.contract.accessRequestInfo,[4,this.lazy("requestAccess")]):[2,this.promiseFactory.reject(null)];case 1:return i=o.sent(),[2,i.handleRequestAccessFlow(e)]}}))}))},C.prototype.navigateAfterDashboardDelete=function(e,t){var i=this,o=this.dashboardDataService.activeDashboard;o&&t===o.id&&this.inArtefactView()&&this.rootScope.$applyAsync((function(){i.dashboardDataService.activeDashboard=null,e.contract.activeDashboardId=null,i.navigation.navigateToContentListOrActiveDashboard()}))},C.prototype.deleteDashboardInternal=function(t,i){var o=this,r=this.dashboardContainerModel,a=r.findDashboard(t),n=this.telemetryService,s=n.startEvent(e.telemetry.DashboardDeleteDashboard,a.objectId,angular.isUndefined(a.tiles)||!a.tiles?0:a.tiles.length);this.beforeDashboardDeletingHandler(t);var c=this.dashboards.filter((function(e){return e.id===t}));if(0===c.length)return void s.resolve();var l=a.getPermissions(),d=a.isSharedFromSecurityGroup&&(l===v.Read||l===v.ReadReshare),p=c[0].contract;i?this.dashboardDataService.deleteDashboardAtServerSide(t,s).then((function(){a&&(a.isUsedByContentPack&&o.rootScope.$emit(e.constants.contentPackDirtyShowNotification,a.id,e.dataServices.models.ContentPackItems.Dashboard),o.afterDashboardDeletingHandler(t))}),(function(t){t&&t.status!==e.HttpStatusCode.Unauthorized&&o.errorService.error(o.localizationService.get("Dashboard_FailToDeleteDashboardMessage"),"Dashboard_FailToDeleteDashboard",{requestId:t.requestId,statusCode:t.status.toString()})})):this.dashboardInvitationHttp.deleteUser(r.userId,t,s.event).then((function(e){s.resolve(),p&&o.modelService.removeModels(p.modelIds),o.tryResetHome(t)}),(function(e){o.errorService.error(o.localizationService.get("Dashboard_FailToRemoveDashboardMessage"),"Dashboard_FailToRemoveDashboard",{requestId:e.requestId,statusCode:e.status.toString()}),s.reject()})),d?this.hideDashboard(r,t):(this.dashboardDataService.deleteDashboard(t),this.syncService.stopMonitoringDashboard(t),this.navigateAfterDashboardDelete(r,t),this.mostRecentlyUsedService.removeMRU(p.objectId))},C.prototype.inArtefactView=function(){var e=this.navigation;return e.inDashboardView()||e.inReportView()||e.inWorkbookView()||e.inDatasetView()},C.prototype.inContentListViews=function(){var e=this.navigation;return e.inContentListView()||e.inFavoritesView()||e.inRecentlyViewedView()||e.inGroupWelcomeView()||e.inLandingContainerView()},C.prototype.tryResetHome=function(t){var i=this.home;i.getHomeDashboard(null).then((function(t){t.data?(i.homeDashboard.dashboardId=t.data.dashboardId,i.homeDashboard.groupId=t.data.groupId||e.constants.myWorkSpaceGroupId,i.homeDashboard.dashboardObjectId=t.data.dashboardObjectId):i.resetHomeAtClientSide()}),(function(e){}))},C.prototype.deleteTile=function(e,t){this.dashboardDataService.deleteTile(e,t)},C.prototype.duplicateDashboard=function(t,i){var o=this,r=this.promiseFactory.defer(),a=this.telemetryService.startEvent(e.telemetry.DashboardDuplicateDashboard);return this.dashboardHttpService.duplicateDashboard(t,i,a.event).then((function(e){var t=e.data;o.dashboardHttpService.addDashboardRequestToBatch(o.promiseFactory,e.data.id).done((function(i){o.dashboardSyncService.addOrUpdateDashboard(i),o.dashboardWarningsService.showWarningsIfNeeded(),o.updateActiveDashboard(t.id,!0),o.navigation.navigateToDashboardByGUID(t.objectId,0),a.resolve(),r.resolve(e.data)}),(function(){a.reject(),r.reject()}))}),(function(){a.reject(),r.reject()})),r.promise},C.prototype.findDashboard=function(e){return this.dashboardDataService.findDashboard(e)},C.prototype.findDashboardByGUID=function(e){return this.dashboardDataService.findDashboardByGUID(e)},C.prototype.findDashboardsByPackageId=function(e){var t=this.dashboardDataService.dashboards;return t?_.filter(t,(function(t){return!(!t.contract||!t.contract.originalPackageId)&&t.contract.originalPackageId===e})):null},Object.defineProperty(C.prototype,"dashboards",{get:function(){return this.dashboardDataService.dashboards},enumerable:!0,configurable:!0}),C.prototype.hasTileForReportandSection=function(e,t){var i,o=this.dashboardContainerModel.dashboards;return void 0!==e?i=_.filter(o,(function(t){return _.find(t.tiles,(function(t){return t.reportTile&&t.contract&&t.contract.sectionId===e}))})):void 0!==t&&(i=_.filter(o,(function(e){return _.find(e.tiles,(function(e){return e.reportTile&&e.contract&&e.contract.reportId===t}))}))),!!(i&&i.length>0)},C.prototype.initializeDashboardContainerModel=function(e,t){var i=this.dashboardContainerModel,o=i.contract;this.modelConverter.updateDashboardContainerContract(o,e),this.modelConverter.fillDashboardContainerDashboards(i,o),this.dashboardDataService.registerDashboards(this.dashboardContainerModel.dashboards),this.dashboardDataService.activeDashboard=i.findDashboard(o.activeDashboardId);var r=this.dashboardDataService.activeDashboard;if(r&&(r.isLoaded=!0),this.navigation.currentDashboardGUID){var a=this.findDashboardByGUID(this.navigation.currentDashboardGUID);a&&(a.isHidden=!1,a.contract.isHidden=!1)}return _.isEmpty(i.visibleDashboards)&&!this.permissionService.isActiveWorkspaceIsReadOnly?void this.setupNavigationWhenNoDashboardExists():void this.dashboardSyncService.clearSeenDashboards()},C.prototype.notifyDashboardUpdate=function(){var e=this.dashboardDataService,t=e.activeDashboard;if(t.hasUpdate){var i=_.find(this.dashboardContainerModel.contract.packages,(function(e){return e.id===t.contract.originalPackageId}));if(!i){var o=this.packageService.findPackage(t.contract.originalPackageId);o&&(i=o.contract)}if(i){var r=i.name,a=jsCommon.StringExtensions.format(this.localizationService.get("DashboardContentPackNewVersion"),r);this.notificationBar.notify({message:a,hideOnStateChange:!0})}}},C.prototype.loadDashboard=function(t){var i=this,o=this.promiseFactory.defer(),r=[],a=0,n=0;for(a=0;a<D;a++)r.push(this.timeout((function(){i.loadDashboardInternal(t).then((function(e){o.resolve(e);for(var t=r.length,a=0;a<t;a++)a!==n&&i.timeout.cancel(r[a])}),(function(t){n++>=D-1&&(o.reject(t),i.rootScope.$emit(e.constants.loadDashboardFailed))}))}),a*C.loadDashboardTimeout));return o.promise},C.prototype.loadDashboardInternal=function(t){var i=this,o=this.promiseFactory.defer(),r=this.telemetryService.startEvent(e.telemetry.DashboardLoadDashboard,null,null);return this.userActivityContextService.pushParentContext(r.event),this.dashboardHttpService.getDashboards(this.promiseFactory,[t],null).then((function(e){if(e.length>0&&e[0].data){var a=e[0],n=a.data;i.registerAndLoadResourcePackages(n).finally((function(){i.updateDashboardContainer([n]);var e=i.findDashboard(t);o.resolve(e),e&&(r.event.info.dashboardGuid=e.objectId),r.event.info.pendingRequestCount=a.pendingRequestCount,r.resolve(),i.userActivityContextService.popParentContext(r.event)}))}else{if(_.isEmpty(e))o.reject(),r.reject();else{var s=e[0];o.reject(s),r.event.info.pendingRequestCount=s.pendingRequestCount,r.reject(d.getTelemetryErrorDetails(s.error))}i.userActivityContextService.popParentContext(r.event)}})).catch((function(e){angular.isArray(e)&&(e=e[0]),o.reject(e),r.reject(),i.userActivityContextService.popParentContext(r.event)})),o.promise},C.prototype.notifyReadOnly=function(e,t){t?this.dashboardHttpService.notifyReadOnly(e,t):this.dashboardHttpService.notifyReadOnly(e)},C.prototype.onDashboardShallowEdit=function(e,t){if(e){var i=t.isHidden&&!e.isHidden,o=!t.isHidden&&e.isHidden;this.dashboardDataService.updateIsQnaEnabled(),i?this.hideDashboard(this.dashboardContainerModel,e.id):o&&1===this.dashboardContainerModel.visibleDashboards.length&&!this.inArtefactView()&&this.navigation.navigateToDashboardByGUID(e.objectId)}},C.prototype.registerAndUpdateTile=function(e,t,i){var o=i.findDashboard(e),r=$.map(t.resourcePackageIds,(function(e){return e.toString()})),a=this.resourcePackageGateService.shouldShowWarning(r,this.dashboardDataService.activeDashboard.objectId);if(this.modelConverter.resolveTilePackage(t,this.packageService.packages),t.resourcePackageIds&&t.resourcePackageIds.length>0)for(var n=t.resourcePackageIds.length,s=0;s<n;++s)this.dashboardSyncService.addOrUpdateCustomVisualTile(t.resourcePackageIds[s],o,t,a);else this.addOrUpdateTile(o,t,i.contract.models)},C.prototype.getSelectedDashboardTile=function(){var e=this.dashboardDataService.selectedDashboardTile;if(e&&e.isSelected)return e},C.prototype.updateDashboardWithPackageInfo=function(t,i){var o,r=this.dashboardContainerModel.dashboards;r&&(o=_.filter(r,(function(e){if(e.contract&&e.contract.originalPackageId)return e.contract.originalPackageId===i}))),_.isEmpty(o)||this.modelConverter.setDashboardsHasUpdate(o),this.navigation.inDashboardView()&&this.rootScope.$emit(e.constants.notifyDashboardUpdate)},C.prototype.setActiveDashboardId=function(t,i,o){var r=this;void 0===i&&(i=!1),void 0===o&&(o=null);var a=this.findDashboard(t),n=this.telemetryService.startEvent(e.telemetry.DashboardUpdateActiveDashboard,a.objectId);this.dashboardHttpService.setActiveDashboardId(t,o,n.event).then((function(e){i?r.dashboardHttpService.refreshTileData(t,r.modelIdsForTileRefresh,n.event).then((function(e){r.checkRefreshTileResponse(e.data),n.resolve()}),(function(e){n.reject()})):n.resolve(),r.preloadLinkedDashboardPromise&&r.timeout.cancel(r.preloadLinkedDashboardPromise),r.preloadLinkedDashboardPromise=r.timeout((function(){r.preloadLinkedDashboards(t)}),w)}),(function(e){n.reject()}))},C.prototype.refreshTileData=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o=this;return __generator(this,(function(r){switch(r.label){case 0:return t>0?(this.refreshTileDataPromise&&(this.timeout.cancel(this.refreshTileDataPromise),this.refreshTileDataPromise=null),[4,this.updateModelIdsForTileRefresh(i)]):[3,2];case 1:if(r.sent(),_.isEmpty(this.modelIdsForTileRefresh))return[2];this.refreshTileDataPromise=this.timeout((function(){var i=o.findDashboard(t),r=o.telemetryService.startEvent(e.telemetry.DashboardRefreshTileData,i.objectId);o.dashboardHttpService.refreshTileData(t,o.modelIdsForTileRefresh,r.event).then((function(e){o.checkRefreshTileResponse(e.data),o.dashboardDataService.onDashboardTileRefreshStarted(t),r.resolve()}),(function(e){r.reject(d.getTelemetryErrorDetails(e.error))})),o.modelIdsForTileRefresh=[]}),C.refreshTileDataDelayMs),r.label=2;case 2:return[2]}}))}))},C.prototype.allowQueryRefreshForModel=function(e){var t=_.first(this.modelService.findModels(e));return!!t&&!t.isRefreshDisabledDueToInactivity()},C.prototype.updateActiveDashboard=function(e,t,i,o){var r=this;if(void 0===t&&(t=!1),e>0){this.updateActiveDashboardPromise&&this.timeout.cancel(this.updateActiveDashboardPromise),this.groupService.activeGroup.lastViewedDashboard=e;var a=this.groupService.activeGroupObjectId;i&&!_.find(this.modelIdsForTileRefresh,(function(e){return e===i}))&&this.modelIdsForTileRefresh.push(i);var n=this.findDashboard(e);this.syncService.monitorDashboards(n?[n.contract]:[],null),this.updateActiveDashboardPromise=this.timeout((function(){return r.groupService.activeGroupObjectId!==a?void(r.updateActiveDashboardPromise=void 0):(r.setActiveDashboardId(e,t,r.modelIdsForTileRefresh),r.modelIdsForTileRefresh=[],o&&(o.dashboardId=e,r.pinTileWithoutNotification(o)),void(r.updateActiveDashboardPromise=void 0))}),C.updateActiveDashboardDelayMs)}},C.prototype.setAndUpdateActiveDashboard=function(e){if(this.dashboardDataService.activeDashboard=e,e){e.isLoaded&&!e.contract.cached||this.loadDashboard(e.id);var t=e.id;this.setActiveDashboardId(t)}},C.prototype.updateGroupsAppMetadata=function(t){var i=this.dashboardContainerModel,o=i.contract;this.modelConverter.updateDashboardContainerContractFromBasicDashboardContainer(o,t),this.modelConverter.fillDashboardContainerDashboardsFromBasicDashboardContainer(i,o),this.dashboardDataService.registerDashboards(i.dashboards),this.dashboardDataService.activeDashboard=i.findDashboard(t.activeDashboardId);var r=this.dashboardDataService.activeDashboard;r&&(r.isLoaded=!0),i.calculateLayout(),i.applyLayout(),this.syncService.monitorWorkspace(r?[r.contract]:[],t.userDashboardListVersion),this.telemetryService.logEvent(e.telemetry.DashboardInitializeContainer,"",!0,this.viralTenantMergeHelperService.viewingDataFromMergedViralTenant())},C.prototype.updateDashboardMenuItems=function(t){t.moreOptionsMenu=e.models.modelFactory.createDashboardMenuItems(this.localizationService,this.featureSwitchService,this.home,this.permissionService,this.dashboardConfigurationService,this.conceptualModelSetting,this.dashboardDataService.activeDashboard,this.navigation)},C.prototype.logRTelemetryDashboardEvent=function(e){var t=this.getVisualCountData(),i=t.scriptVisualsCount,o=t.reportTilesWithR;if(0!==i||0!==o){var r=this.dashboardDataService.activeDashboard.tiles.length;this.telemetryService.logEvent(e,i,r,o)}},C.prototype.getVisualCountData=function(){var e={totalVisualsCount:0,scriptVisualsCount:0,reportTilesWithR:0},t=this.dashboardDataService.activeDashboard,i=this.visualPluginService,o=t&&t.tiles;if(o){for(var r=0,a=o;r<a.length;r++){var n=a[r];b.isScriptVisualTile(n,i)?e.scriptVisualsCount++:b.reportTileContainsScriptVisuals(n,i)&&e.reportTilesWithR++}e.totalVisualsCount=o.length}return e},C.prototype.checkRefreshTileResponse=function(t){if(t&&!_.isEmpty(t.tileErrors))for(var i=0,o=t.tileErrors;i<o.length;i++){var r=o[i];r.errorResponse.error.code===e.common.constants.cloudRLSAccessDeniedErrorCode&&this.rootScope.$emit(e.constants.rowLevelSecurityAccessDeniedEventName,r.modelIds)}},C.prototype.setSpotlight=function(e){e.hasSpotlight=!0},C.prototype.clearSpotlights=function(){var e=this.getActiveDashboard();if(e)for(var t=0,i=e.tiles;t<i.length;t++){var o=i[t];o.hasSpotlight=!1}},C.prototype.registerAndLoadResourcePackages=function(t){var i=this.promiseFactory.defer(),o=t.dashboards;if(o)for(var r=0,a=o;r<a.length;r++){var n=a[r],s=this.getAllRequiredResourcePackages(n);if(s&&0!==s.length&&this.resourcePackageGateService.shouldShowWarning(s,n.objectId))return i.reject(null),i.promise}var c=t.resourcePackages;if(c&&c.length>0){for(var l=[],d=!1,p=0,u=c;p<u.length;p++){var h=u[p];if(!this.resourcePackagesService.getPackageById(h.id)){var v=0===h.type,g=m.isRegisteredResourcePackage(h);v&&(d=!0),(v||g)&&this.resourcePackagesService.registerPackages([h]),v&&l.push(this.visualPluginService.ensurePlugin(h,!1))}}return this.telemetryService.logEvent(e.telemetry.DashboardRegisterAndLoadResourcePackages,c?c.length:0,d),this.promiseFactory.allSettled(l)}return i.resolve(null),i.promise},C.prototype.getAllRequiredResourcePackages=function(t){var i=[],o="";if(t&&t.tiles){for(var r=0,a=t.tiles;r<a.length;r++){var n=a[r];o=o.concat(n.id.toString(),",");var s=n.resourcePackageIds;if(s&&0!==s.length)for(var c=0,l=s;c<l.length;c++){var d=l[c];i.push(d.toString())}}this.telemetryService.logEvent(e.telemetry.DashboardRecordDashboardTiles,o.length>0?o.substr(0,o.length-1):o,t.objectId)}return i},C.prototype.loadDashboardContainer=function(e,t,i){var o=this,r=this.promiseFactory.defer(),a=[this.appMetadataService.getAppMetadata()];return this.navigation.stateService.transition&&a.push(this.navigation.stateService.transition),this.promiseFactory.allSettled(a).then((function(a){var n=a[0];if(0===n.type){var s=n.value,c=o.initializeDashboardContainer(s,e,t,i);o.registerAndLoadResourcePackages(s).finally((function(){return r.resolve(c)}))}else o.dashboardHttpService.getDashboardContainer(e).then((function(a){a.data.models&&(o.modelService.mergeDatasetCollection(a.data.models),o.dashboardDataService.updateActiveDashboardModels()),a.data.featureSwitches&&o.editableFeatureSwitchService.registerFeatureSwitches(a.data.featureSwitches),o.userSettingsService.getUserSettings().then((function(e){a.data.userSettings=e.contract}));var n=o.initializeDashboardContainer(a.data,e,t,i);o.registerAndLoadResourcePackages(a.data).finally((function(){return r.resolve(n)}))}),(function(e){r.reject()}))})),r.promise},C.prototype.getDashboardContractIndex=function(e,t){for(var i=e.dashboards,o=0,r=i.length;o<r;o++)if(i[o].id===t)return o;return-1},C.prototype.initializeContainer=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a,n,s;return __generator(this,(function(c){switch(c.label){case 0:o=this.telemetryService.startEvent(e.telemetry.DashboardInitializeContainer,"",!1,this.viralTenantMergeHelperService.viewingDataFromMergedViralTenant()),initializeContainerStartTime&&(o.event.time=initializeContainerStartTime.getTime()),r={dashboards:[],activeViewMode:e.contracts.DashboardContainerViewMode.DashboardViewer,activityPane:e.staticContract.getActivityPaneContract()},a=this.dashboardContainerModel=this.modelConverter.convertDashboardContainer(r),a.calculateLayout(),a.applyLayout(),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.loadDashboardContainer(o.event,t,i)];case 2:return n=c.sent(),this.dashboardsDeferred.resolve(this),this.dashboardDataService.resolveDashboardDeferred(),n.deferEmitDashboardContainerLoadedEvent||this.rootScope.$emit(e.constants.dashboardContainerLoaded),o.resolve(),[3,4];case 3:return s=c.sent(),o.reject(),this.dashboardsDeferred.reject(),this.dashboardDataService.rejectDashboardDeferred(),[3,4];case 4:return[2]}}))}))},C.prototype.updateModelIdsForTileRefresh=function(e){if(e&&!_.any(this.modelIdsForTileRefresh,(function(t){return t===e}))){var t=this.allowQueryRefreshForModel(e);t&&!_.any(this.modelIdsForTileRefresh,(function(t){return t===e}))&&this.modelIdsForTileRefresh.push(e)}},C.prototype.initializeDashboardContainer=function(t,i,r,a){if(window.initialDashboardContainer||(window.initialDashboardContainer=t),t.downloadCenterLinkEnabled?(e.models.PowerBICompanionModel.enabled=!0,e.models.PowerBICompanionModel.downloadLink=o.powerBICompanionHelper.getDownloadCenterLink(t.downloadCenterX64Link,t.downloadCenterX86Link),this.rootScope.$emit(e.constants.enablePowerBICompanionApp)):t.companionAppEnabled&&(e.models.PowerBICompanionModel.enabled=!0,e.models.PowerBICompanionModel.downloadLink=o.powerBICompanionHelper.getDownloadLink(),this.rootScope.$emit(e.constants.enablePowerBICompanionApp)),jsCommon.Utility.is64BitOperatingSystem()&&(e.models.PowerBIConnectorModel.downloadLink=t.downloadCenterX64ConnectorLink,this.rootScope.$emit(e.constants.enablePowerBIASConnectorApp)),e.models.PowerBIOnPremGatewayModel.downloadLink=t.downloadOnpremGatewayLink,t.homeDashboardId!==-1){var n=!this.navigation.currentGroupGUID||this.navigation.currentGroupGUID===e.constants.myWorkSpaceGroupId,s=this.navigation.inLandingContainerView()||this.navigation.inHomeDashboardView(),c=r||!_.isEmpty(a);n&&s&&!c&&(t.homeGroupId?this.groupService.activeGroupObjectId=t.homeGroupId:this.groupService.isMyWorkspace()&&(this.groupService.activeGroupObjectId=e.constants.myWorkSpaceGroupId),r||(r=t.homeDashboardId)),this.home.homeDashboard.dashboardId=t.homeDashboardId,this.home.homeDashboard.groupId=t.homeGroupId||e.constants.myWorkSpaceGroupId}this.initializeDashboardContainerModel(t,i);var l=t.dashboards,d=_.find(l,(function(e){return e.id===t.activeDashboardId}));d||!l||_.isEmpty(this.dashboardContainerModel.visibleDashboards)||(d=l[0],t.activeDashboardId=d.id),this.syncService.monitorDashboards(d?[d]:[],t.userDashboardListVersion);var p=this.findDashboard(this.home.homeDashboard.dashboardId);p&&(this.home.homeDashboard.dashboardObjectId=p.objectId);var u=!1;return window.appLoadError&&window.appLoadError.error===e.constants.appLoadErrorGroupNotAccessible&&(u=!0),this.navigateToActiveDashboard(t,i,r,a,u)},C.prototype.isAllowedMobileUserAgent=function(){for(var e=["iphone","ipad","android"],t=["windows phone"],i=navigator.userAgent.toLowerCase(),o=0,r=t;o<r.length;o++){var a=r[o];if(i.indexOf(a)!==-1)return!1}for(var n=0,s=e;n<s.length;n++){var c=s[n];if(i.indexOf(c)!==-1)return!0}return!1},C.prototype.loadAndInitializeDashboardsOnInvitation=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o,r,a,n,s,c,l,d,p,u,h,v=this;return __generator(this,(function(g){switch(g.label){case 0:return t=this.dashboardInvitationService.getInvitationClaim(),t?[3,2]:[4,this.initializeContainer()];case 1:return g.sent(),[2];case 2:if(t.extshare&&!_.startsWith(this.$location.path(),"/invite")&&(location.href="/invite"+t.updatedQuery),_.isEmpty(t.invitationId))return[3,10];i=this.telemetryService,o=i.startEvent(e.telemetry.DashboardClaimInvitation,"",t.invitationId),r=void 0,g.label=3;case 3:return g.trys.push([3,5,7,8]),[4,this.dashboardInvitationHttp.claimInvite(t.tenantId,t.invitationId,t.redirectedFromSignup,o.event)];case 4:return r=g.sent(),[3,8];case 5:return a=g.sent(),n=a.headers(e.common.PowerBIErrorHeader),n===e.constants.quotaErrorCodes.PowerBIUserQuotaExceeded||n===e.constants.quotaErrorCodes.PowerBIGroupQuotaExceeded?(s=n===e.constants.quotaErrorCodes.PowerBIUserQuotaExceeded,c=this.storageUsageService,c.showQuotaExceedDialog(),l=c.getUsage(this.dashboards),i.logEvent(e.telemetry.QuotaExceeded,this.userInfo.isPremiumUser,s?e.telemetry.QuotaOpenManageStorageContext.Personal:e.telemetry.QuotaOpenManageStorageContext.Group,e.telemetry.QuotaCheckOperation.AcceptInvitation,l.ownedUsage,l.sharedUsage,c.quotaLimitInMB)):(d=n||"DashboardInvitationInvalidRequest",this.localizationService.ensureLocalization((function(){var t=v.localizationService.get(d);v.errorService.error(t,"DashboardInvitationInvalidRequest",{title:v.localizationService.get("DashboardInvitationErrorTitle")},!1,e.telemetry.ErrorSource.PowerBI),o.reject({errorCode:d,errorSource:"DashboardInvitationInvalidRequest"!==d?e.telemetry.ErrorSource.User:e.telemetry.ErrorSource.PowerBI})}))),[4,this.initializeContainer()];case 6:return[2,g.sent()];case 7:return this.rootScope.$emit(e.common.constants.invitation.invitationClaimed),[7];case 8:return p=parseInt(r.data,10),u=window.location,this.isAllowedMobileUserAgent()&&!t.extshare&&(i.logEvent(e.telemetry.DashboardClaimInvitationRedirectToMobileLandingPage,navigator.userAgent,t.invitationId),window.location.href=u.protocol+"//"+u.host+"/mobilelandingpage"+u.search),[4,this.initializeContainer(p)];case 9:return g.sent(),h=this.dashboardContainerModel.findDashboard(p),o.event.info.dashboardGuid=h?h.objectId:"",o.resolve(),t.extshare&&(this.navigation.inReportView()?this.navigation.navigateToReport({reportGUID:this.navigation.currentReportGUID,groupGUID:void 0,reportPage:this.navigation.currentReportPage},!0):this.navigation.navigateToDashboardByGUID(h.objectId)),[3,14];case 10:return _.isEmpty(t.dashboardObjectId)?[3,12]:[4,this.initializeContainer(void 0,t.dashboardObjectId)];case 11:return[2,g.sent()];case 12:return[4,this.initializeContainer()];case 13:return[2,g.sent()];case 14:return[2]}}))}))},C.prototype.navigateToActiveDashboard=function(e,t,i,o,r){var a=this,n={deferEmitDashboardContainerLoadedEvent:!1},s=this.dashboardContainerModel,c=s.findDashboard(e.activeDashboardId),l=this.conceptualModelSetting.isAppsEnabled(),d=c,p=void 0!==i?s.findDashboard(i):s.findDashboardByGUID(o),u=this.navigation,h=u.currentDashboardGUID,v=u.currentReportGUID,g=u.currentWorkbookURLIdentifier,m=u.currentDatasetDBName,f=l&&u.currentAppGUID,b=l&&u.currentAppInstanceId,y=l&&u.currentDashboardOriginalGUID,S=l&&u.currentReportOriginalGUID,w=!0;if(this.featureSwitchService.featureSwitches.permissionCenterEnabled&&this.navigation.inManagePermissionsView()){var D;return this.lazy("permissionNavigation").then((function(e){return D=e,a.lazy("permissionData")})).then((function(e){if(D.inManagePermissionsView()){var t=D.permissionArtifact,i=D.permissionArtifactGUID;D.navigateToManagePermissions(t,i)}})),n}if(this.shouldTriggerAppAutoInstall(e))return this.readyForConceptualModelInitializationDeferred.resolve(null),n.deferEmitDashboardContainerLoadedEvent=!0,n;if(p)d=p;else{if(!u.inReportView()&&!u.inQnaView()&&(h||f&&y))return this.navigateToDashboardOnInitialLoad(),n;if(v||f&&S)return this.navigateToReportOnInitialLoad(),w=!1,n;if(!g||u.inAppView()&&!l){if(f&&u.inAppDetailView())return w=!!u.inAppInstanceView()&&!!b,w||this.navigateToDefaultAppArtefact(f),n;m&&(w=!1,this.handleStateChangeForDataset(m))}else w=!1}if(!(d||u.inAdminPortalView()&&this.userInfo))return _.isEmpty(s.visibleDashboards)&&!this.permissionService.isActiveWorkspaceIsReadOnly&&this.setupNavigationWhenNoDashboardExists(),n;if(w=r||w&&(!d||h!==d.objectId||!u.inDashboardDetailView())){if(this.tryToNavigateToNonDashboard(d,i,l,f))return n;if(!i||!d||d.objectId===this.home.homeDashboard.dashboardObjectId)return this.readyForConceptualModelInitializationDeferred.resolve(null),n.deferEmitDashboardContainerLoadedEvent=!0,n;this.navigationToDashboard(d)}return n},C.prototype.handleStateChangeForDataset=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return e=this.navigation,[4,this.licenseEnforcementService.supportsDataset(t,!0)];case 1:return i=o.sent(),i&&(e.inQnaModelView()?e.replaceHistoryWithDatasetAndNavigate(e.currentDatasetDBName,u.modelQna,{q:e.qnaQuery}):e.navigateToDataset({datasetDBName:e.currentDatasetDBName,datasetId:e.currentDatasetId},!0)),[2]}}))}))},C.prototype.shouldTriggerAppAutoInstall=function(t){var i=this.navigation,o=i.currentAppGUID;if(!i.inAppView()||!o||this.groupService.activeGroupObjectId!==e.constants.myWorkSpaceGroupId||!this.conceptualModelSetting.isAppsEnabled())return!1;var r=_.find(t.apps,(function(e){return e.providerKey===o}));if(!r)return!0;var a=r.providerId,n=_.find(t.packages,(function(e){return(e.contentProviderRefId===a||e.serviceContentProviderId===a||e.contentProviderId===a)&&e.packageType===h.AppInstance}));return null==n},C.prototype.navigateToDefaultAppArtefact=function(i,o){return __awaiter(this,void 0,e.Promise,(function(){var e,a,s,c,l,d,p,h;return __generator(this,(function(v){switch(v.label){case 0:return e=this.appService,a=this.packageService,[4,this.promiseFactory.all([e.ensureAppsInitialization(),a.ensurePackagesInitialization()])];case 1:return v.sent(),(o=o||t.getPackageIDByOrgAppGUID(e,a,i))?(s=e.getAppInstance(o),this.licenseEnforcementService.supportsConnectApps(s.providerContract,!1,!0)?(c=t.getDefaultAppArtefact(s,e))?(l=this.navigation,d=this.groupService.activeGroupObjectId,p=!t.isOrgApp(s.providerContract),c instanceof n?(l.replaceAndLoadCurrentState(p?u.appInstanceDashboard:u.appDashboard,{appGUID:i,appInstanceId:o,dashboardGUID:c.objectId,dashboardOriginalGUID:c.contract.originalDashboardObjectId,groupGUID:d}),[3,5]):[3,2]):[2]:(this.navigation.navigateToApps(),[2])):[2];case 2:return c instanceof g?[4,this.licenseEnforcementService.supportsReport(c.objectId,!0)]:[3,4];case 3:return(h=v.sent())?(l.replaceAndLoadCurrentState(p?r.appInstanceReport:r.appReport,{appGUID:i,appInstanceId:o,reportGUID:c.objectId,reportOriginalGUID:c.contract.originalReportObjectId,groupGUID:d}),[3,5]):[2];case 4:c instanceof y&&l.replaceAndLoadCurrentState(r.appWorkbook,{appGUID:i,appInstanceId:o,workbookURLIdentifier:c.uniqueId,groupGUID:d}),v.label=5;case 5:return[2]}}))}))},C.prototype.tryToNavigateToNonDashboard=function(t,i,o,r){var a=this,n=this.navigation,s=this.groupService.activeGroupObjectId;if(n.inGetDataView())return!0;if(n.inQnaView()){var c=n.inAppView()?u.appDashboardQna:u.dashboardQna;return n.replaceHistoryWithDashboardAndNavigate(t.objectId,c,{q:n.qnaQuery}),!0}if(n.inInsightsView()){var c=n.inAppView()?u.appInsights:u.insights;return n.replaceHistoryWithDashboardAndNavigate(t.objectId,c,{dataGUID:n.insightsDataGUID,groupGUID:s,insightsSource:null,appGUID:n.currentAppGUID}),!0}return n.inManageStorageView()?(this.navigateToManageStoragePage(t.objectId),!0):n.inSettingsView()?(n.showSettingsSlider(n.settingsGroup,n.settingsId),!0):!!n.inGatewaysView()||(n.inFavoritesView()?(n.navigateToFavorites(this.groupService.activeGroupObjectId),!0):n.inRecentlyViewedView()?(n.navigateToRecentlyViewed(),!0):n.inSharedWithMePath()?(n.navigateToSharedWithMe(),!0):n.inAppsDetailView()&&o?(n.navigateToApps(),!0):n.inExtendTrial()?(this.lazy("licenseHelper").then((function(t){return t.displayDialogToExtendTrial(e.telemetry.LicenseEnforcementOperation.EmailLink)})),!0):n.inAccept2017ProTrial()?(this.acceptTrialAndRefresh(),!0):n.inContentListView()?(n.navigateToContentListParams({groupGUID:s}),!0):n.inCapacitySettingsView()?(this.featureSwitchService.featureSwitches.adminCapacityEnabled?this.navigateToCapacitySettings():this.navigationToDashboard(t),
!0):n.inAdminPortalView()&&this.userInfo?(this.userInfo.userMetadataPromise.then((function(e){e.isTenantAdmin||a.featureSwitchService.featureSwitches.adminCapacityEnabled?n.replaceHistoryWithGroupWelcomeAndNavigate(a.groupService.activeGroupObjectId,u.adminPortal,{adminPortalSettingsTab:0}):a.navigationToDashboard(t)}),(function(){a.navigationToDashboard(t)})),!0):n.inManageEmbedView()?(this.navigateToManageEmbedPage(t.objectId),!0):!!n.inRowLevelSecurityView()&&this.navigateToRowLevelSecurity())},C.prototype.acceptTrialAndRefresh=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.licenseEnforcementService.accept2017ProTrial()];case 1:return e.sent(),this.navigation.navigateToFavorites(this.groupService.activeGroupObjectId),window.location.reload(!0),[2]}}))}))},C.prototype.navigateToCapacitySettings=function(){this.navigation.currentCapacityId?this.navigation.navigateToAdminPortalCapacity(this.navigation.currentCapacityId):this.navigation.navigateToAdminPortal(5)},C.prototype.navigateToDashboardOnInitialLoad=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o,r,a,n;return __generator(this,(function(l){switch(l.label){case 0:return t=this.navigation,i=this.appService,o=this.packageService,t.currentDashboardGUID||t.currentDashboardOriginalGUID&&t.currentAppGUID&&this.conceptualModelSetting.isAppsEnabled()?[4,this.promiseFactory.all([i.ensureAppsInitialization(),o.ensurePackagesInitialization()])]:[2];case 1:return l.sent(),r=this.navigationHelper,r.ensureDashboardGUID(),(a=this.findDashboardByGUID(t.currentDashboardGUID))?((t.inInFocusView()||t.inInFocusInsightsView()||t.inAlertsEditorView())&&(r.ensureTileGUID(),n=a.findTileByObjectIdOrOriginalObjectId(t.currentTileGUID,t.currentTileOriginalGUID),n&&this.selectDashboardTile(new c(n))),[4,this.checkUserNeedsProLicenseAndShowError(a,this.userInfo,this.licenseEnforcementService,this.localizationService,t,e.telemetry.LicenseEnforcementOperation.InitialDashboardLoad)]):[3,3];case 2:return l.sent(),this.setAndUpdateActiveDashboard(a),this.groupService.activeGroup&&(this.groupService.activeGroup.lastViewedDashboard=a?a.id:-1),[3,4];case 3:this.shouldNavigateToRequestAccess()?(this.navigation.replaceAndLoadCurrentState(u.dashboardRequestAccess,{groupGUID:this.groupService.activeGroupObjectId,dashboardGUID:t.currentDashboardGUID}),this.setAndUpdateActiveDashboard(null)):s.showDashboardDoesNotExistDialog(this.errorService,this.localizationService,this.telemetryService,t),l.label=4;case 4:return[2]}}))}))},C.prototype.navigateToReportOnInitialLoad=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o,r,a,n;return __generator(this,(function(s){switch(s.label){case 0:return t=this.navigation,i=this.appService,o=this.packageService,r=this.reportService,[4,this.promiseFactory.all([i.ensureAppsInitialization(),o.ensurePackagesInitialization(),r.ensureReportsInitialization()])];case 1:return s.sent(),this.navigationHelper.ensureReportGUID(),a=t.currentReportGUID,[4,this.licenseEnforcementService.supportsReport(a,!0)];case 2:return n=s.sent(),n?t.navigateToReport({groupGUID:this.groupService.activeGroupObjectId,reportGUID:a,reportOriginalGUID:t.currentReportOriginalGUID,appGUID:t.currentAppGUID,appInstanceId:t.currentAppInstanceId,reportPage:t.currentReportPage,dashboardGUID:t.currentDashboardGUID,subscriptionGUID:t.currentSubscriptionGUID,filter:t.additionalODataFilter},!0):this.navigation.navigateToContentList(e.constants.myWorkSpaceGroupId),[2]}}))}))},C.prototype.navigationToDashboard=function(t){this.checkUserNeedsProLicenseAndShowError(t,this.userInfo,this.licenseEnforcementService,this.localizationService,this.navigation,e.telemetry.LicenseEnforcementOperation.ShareDashboard),this.navigation.insertGroupAndNavigateToDashboardByGUID(t.objectId,this.groupService.activeGroupObjectId,2),this.setAndUpdateActiveDashboard(t),this.groupService.activeGroup&&(this.groupService.activeGroup.lastViewedDashboard=t?t.id:-1)},C.prototype.navigateToActiveDashboardAfterGroupSwitch=function(e,i,o){var r=this.dashboardContainerModel.findDashboard(i);if(r&&r.isHidden&&(r=null),r||(o&&s.showDashboardDoesNotExistDialog(this.errorService,this.localizationService,this.telemetryService,this.navigation),_.isEmpty(this.dashboardContainerModel.visibleDashboards)||(r=this.dashboardContainerModel.visibleDashboards[0])),this.setAndUpdateActiveDashboard(r),r){var a=this.navigation.currentTileGUID,n=this.navigation.currentTileOriginalGUID,c=r.objectId,l=r.contract;if(this.navigation.inAlertsEditorView())this.navigation.showAlertsEditor(a,n,this.navigation.currentAlertId,c,this.groupService.activeGroupObjectId);else if(this.navigation.inInFocusView())this.navigation.showInFocusMode(a,n,c,l.originalDashboardObjectId,this.groupService.activeGroupObjectId);else if(this.navigation.inInFocusInsightsView())this.navigation.showInsightsInFocusMode(a,n,c,this.groupService.activeGroupObjectId);else if(this.home.isHomeDashboardSet&&r.id===this.home.homeDashboard.dashboardId)this.navigation.insertGroupAndNavigateToDashboardByGUID(this.home.homeDashboard.dashboardObjectId,this.home.homeDashboard.groupId,1);else{var d=t.getDashboardAppGUID(r,this.appService,this.packageService);d?this.navigation.navigateToAppDashboardByGUID(c,l.originalDashboardObjectId,d,this.groupService.activeGroupObjectId):this.navigation.replaceAndLoadCurrentState(u.dashboard,{groupGUID:this.groupService.activeGroupObjectId,dashboardGUID:r.objectId})}}else this.dashboardContainerModel.dashboards.length>0||this.groupService.isDataInCurrentGroup()?this.navigation.replaceAndLoadCurrentState(u.dashboards,{groupGUID:this.groupService.activeGroupObjectId}):this.navigation.replaceAndLoadCurrentState(u.groupWelcome,{groupGUID:this.groupService.activeGroupObjectId})},C.prototype.navigateToManageStoragePage=function(t){var i=!0;this.groupService.activeGroup&&(i=this.groupService.activeGroup.isMyWorkspace),this.telemetryService.logEvent(e.telemetry.QuotaOpenManageStoragePage,e.telemetry.QuotaOpenManageStorageInteraction.DirectUrl,i?e.telemetry.QuotaOpenManageStorageContext.Personal:e.telemetry.QuotaOpenManageStorageContext.Group),this.navigation.replaceHistoryWithDashboardAndNavigate(t,u.manageStorage,{groupGUID:this.groupService.activeGroupObjectId})},C.prototype.navigateToManageEmbedPage=function(e){this.navigation.replaceHistoryWithDashboardAndNavigate(e,u.manageEmbed,{groupGUID:this.groupService.activeGroupObjectId})},C.prototype.navigateToRowLevelSecurity=function(){var e=this.navigation.rowLevelSecurityModelId;return void 0!==e&&(this.navigation.showRowLevelSecuritySlider(e),!0)},C.prototype.onGroupSwitched=function(e,t,i){var o=this;this.updateGroupsAppMetadata(e);var r=this.navigation,a=r.currentReportGUID,n=r.currentWorkbookURLIdentifier,c=r.currentDatasetDBName,l=r.currentDashboardGUID;if(l){var d=this.findDashboardByGUID(l);d&&d.id?this.navigation.inSharingView()?this.timeout((function(){o.navigateToShareDashboard(l)})):this.navigateToActiveDashboardAfterGroupSwitch(e,d.id):a||n||c||(this.mostRecentlyUsedService.removeMRU(l),s.showDashboardDoesNotExistDialog(this.errorService,this.localizationService,this.telemetryService,this.navigation),this.navigateToActiveDashboardAfterGroupSwitch(e,this.groupService.activeGroup.lastViewedDashboard))}else a||n||c||(t?this.navigateToActiveDashboardAfterGroupSwitch(e,this.groupService.activeGroup.lastViewedDashboard,t):this.shouldStayOnCurrentState()||i||this.navigation.replaceAndLoadCurrentState(u.contentList,{groupGUID:this.groupService.activeGroupObjectId}));this.userInfo.userMetadataPromise.then((function(e){o.mergeDashboardOwnerInfo(e)}))},C.prototype.shouldStayOnCurrentState=function(){return this.navigation.inFavoritesView()||this.navigation.inRecentlyViewedView()||this.navigation.inAppsView()},C.prototype.setupNavigationWhenNoDashboardExists=function(){var t=this.navigation;if(t.inCapacitySettingsView())this.featureSwitchService.featureSwitches.adminCapacityEnabled?this.navigateToCapacitySettings():t.navigateToContentListOrActiveDashboard();else{if(t.inGetDataView())return;if(t.inManageStorageView())this.navigateToManageStoragePage(null);else if(t.inManageEmbedView())this.navigateToManageEmbedPage(null);else if(t.inSettingsView())t.showSettingsSlider(t.settingsGroup,t.settingsId);else{if(t.inGatewaysView())return;if(t.inFavoritesView())t.navigateToFavorites(this.groupService.activeGroupObjectId);else if(t.inRecentlyViewedView())t.navigateToRecentlyViewed();else if(t.inExtendTrial())this.lazy("licenseHelper").then((function(t){return t.displayDialogToExtendTrial(e.telemetry.LicenseEnforcementOperation.EmailLink)}));else if(t.inAccept2017ProTrial())this.acceptTrialAndRefresh();else if(_.isEmpty(this.reportService.copyAndEditReports)&&_.isEmpty(this.modelService.copyAndEditModels)&&_.isEmpty(this.workbookService.copyAndEditWorkbooks)&&!this.viralTenantMergeHelperService.viewingDataFromMergedViralTenant()&&window.initialDashboardContainer&&jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(window.initialDashboardContainer.previousTenantId)){var i=this.featureSwitchService.featureSwitches;i.contentAuthoringUIEnabled?i.ignoreGettingStartedPopups?t.navigateToContentListOrActiveDashboard():t.replaceHistoryWithGroupWelcomeAndNavigate(this.groupService.activeGroupObjectId,u.getDataCategory,{groupGUID:this.groupService.activeGroupObjectId,categoryName:e.constants.navigation.getDataWelcome,getDataView:"getdata"}):t.navigateToApps()}else if(this.navigation.inReportView())t.navigateToReport({groupGUID:this.groupService.activeGroupObjectId,reportGUID:t.currentReportGUID,reportOriginalGUID:t.currentReportOriginalGUID,appGUID:t.currentAppGUID,appInstanceId:t.currentAppInstanceId,reportPage:t.currentReportPage,dashboardGUID:t.currentDashboardGUID,subscriptionGUID:t.currentSubscriptionGUID,filter:t.additionalODataFilter},!0);else if(t.inDatasetView()&&!t.inQnaModelView())t.navigateToDataset({datasetDBName:t.currentDatasetDBName,datasetId:t.currentDatasetId},!0);else{if(t.inWorkbookView()||t.inAppsView()||t.inAppView())return;this.featureSwitchService.featureSwitches.contentAuthoringUIEnabled?t.navigateToContentListOrActiveDashboard():t.navigateToApps()}}}},C.prototype.shouldNavigateToRequestAccess=function(){var e=this.navigation;return(e.inDashboardDetailView()||e.inRequestDashboardAccessView())&&this.hasAccessRequestInfo(e.currentDashboardGUID)},C.prototype.hasAccessRequestInfo=function(e){var t=this.dashboardContainerModel.contract.accessRequestInfo;return t&&t.dashboardObjectId&&t.dashboardObjectId===e},C.prototype.updateDashboard=function(){var e=this.findDashboardByGUID(this.navigation.currentDashboardGUID);e&&!e.isFilled()&&(this.modelConverter.fillDashboardChildren(e,this.dashboardContainerModel.contract.models,this.reportService.getReportContracts(),this.workbookService.workbooks),e.calculateLayout(),e.applyLayout())},C.prototype.updateDashboardContainer=function(t){if(t){for(var i=this.dashboardContainerModel,o=i.contract,r=this.modelConverter,a=function(i,a){var s=t[i],c=s.dashboards[0],l=n.findDashboard(c.id);if(l.contract=c,n.modelMerger.mergeDashboard(l,c,s.models,s.reports,s.workbooks),l.contract.cached&&!c.cached&&(l.contract.cached=!1),l.contract.tiles){var d=t[i].packages||[];l.contract.tiles.map((function(e){r.resolveTilePackage(e,d)}));for(var p=0,u=l.tiles;p<u.length;p++){var h=u[p];h.invalidateLayout();var v=t[i].reports||[],m=r.getTileReport(h.contract.reportId,v);m&&(h.report=h.report||new g(m),r.fillReport(h.report,m))}}l.isLoaded=!0,e.contracts.mergeDashboardContainerModelsReportsAndPackages(s,o),n.reportService.mergeReportCollection(s.reports),n.modelService.mergeDatasetCollection(s.models),n.packageService.mergePackageCollection(s.packages),n.workbookService.mergeWorkbookCollection(s.workbooks)},n=this,s=0,c=t.length;s<c;s++)a(s,c);var l=this.modelMerger;l.mergeModelContentProviderId(o.models,o.packages),this.updateDashboard(),this.dashboardDataService.updateActiveDashboardModels()}},C.prototype.notifyForAddTile=function(t,i){var o=this,r=void 0===t?this.dashboardDataService.activeDashboard:this.dashboardDataService.findDashboard(t),a=r.contract,n=this.dashboardHttpService;if(r.getPermissions()===v.CopyOnWrite)return void this.rootScope.$emit(e.constants.personalizeEventName,r.contract.originalPackageId);if(e.dataServices.DashboardUtils.isWriteable(a)){if(!this.storageUsageService.checkQuotaExceeded(this.dashboards,e.telemetry.QuotaCheckOperation.AddTile,!0)){var s,c=l.containsLayout(0,1,r);if(!c){var d=function(){return o.navigation.navigateToDashboardMobileAuthoringByGUID(r.objectId)};s=function(t){o.moduleLoader.require({javascript:"MobileAuthoring/components/createMobileLayoutDialog/createMobileLayoutDialogBuilder"}).then((function(t){var i=t.createMobileLayoutDialogBuilder(o.modalDialogService);i.show().then((function(t){t&&(o.telemetryService.logEvent(e.telemetry.MobileAuthoringDashboardOpenedFromFlyout,e.telemetry.FlyoutOperationType.Pin,!0),d())}))}))}}return this.telemetryService.logEvent(e.telemetry.MobileAuthoringFlyoutShown,c,e.telemetry.OperationType.Pin),this.mobileAuthoringService.showMobileIndicationMessage(r.objectId,c?3:2,e.common.NotificationToastType.Default,!c,!c,s)}}else n.notifyReadOnly(a.id,!0)},C.prototype.pinTileWithoutNotification=function(t){if(!this.storageUsageService.checkQuotaExceeded(this.dashboards,e.telemetry.QuotaCheckOperation.AddTile)){var i=this.dashboardContainerModel,o=t.report;if(o){var r=this.reportService.findReport(o.id);r||(r=this.modelConverter.convertReport(o),this.reportService.addReport(r))}var a,n=this.modelConverter.convertTile(t.tile,i.contract.models,this.reportService.getReportContracts(),this.workbookService.getWorkbookContracts());t.showNotification&&(a=this.notifyForAddTile(t.dashboardId,t.isLiveReport));var s=null!=t.dashboardId?this.findDashboard(t.dashboardId):this.dashboardDataService.activeDashboard;if(s)if(n.contract.resourcePackageIds&&this.resourcePackageGateService.addResourcePackageIdToDashboard(s.objectId,n.contract.resourcePackageIds),this.addTileToDashboard(n,s),t.isTemporaryTile){var l=new c(n);this.selectDashboardTile(l),this.rootScope.$emit(e.constants.temporaryTilePinned)}else this.saveTile(n,s,t.parentEvent,a)}},C.prototype.addTileToDashboard=function(e,t){var i=t.contract;i.tiles||(i.tiles=[]);var o=t.tiles;if(e.contract.id=this.temporaryTileId--,i.tiles.push(e.contract),e.report&&e.report.id&&i.reportIds){var r=i.reportIds.indexOf(e.report.id);r===-1&&i.reportIds.push(e.report.id)}if(e.contract&&e.contract.workbookId&&i.workbookIds){var a=e.contract.workbookId,n=i.workbookIds.indexOf(a);n===-1&&i.workbookIds.push(a)}o.push(e),t.calculateLayout(),t.applyLayout()},C.prototype.saveTemporaryTile=function(e,t){this.saveTile(e,this.dashboardDataService.activeDashboard,t)},C.prototype.saveTile=function(t,i,o,r){var a=this;this.dashboardHttpService.addTile(i.contract,t.contract,this.dashboardContainerModel.contract.models,this.reportService.getReportContracts(),o.event).then((function(n){t.id=t.contract.id=n.data.id,t.contract.objectId=n.data.objectId,t&&t.contractsModel&&n&&n.data&&n.data.model&&(t.contractsModel.vsName=t.contractsModel.vsName||n.data.model.vsName,t.contractsModel.dbName=t.contractsModel.dbName||n.data.model.dbName),t.contract.workbookId&&a.dashboardSyncService.onTilesAddedOrUpdated(i.contract.id,[t.id]),t.invalidateLayout();var s=!!t.contract.modelId&&!_.any(i.tiles,(function(e){return e.contract.modelId===t.contract.modelId&&e!==t}));if(s&&a.updateDashboardToken(i),i&&(i.isUsedByContentPack&&a.rootScope.$emit(e.constants.contentPackDirtyShowNotification,i.id,e.dataServices.models.ContentPackItems.Dashboard),!r)){var c,d=l.containsLayout(0,1,i);if(!d){var p=function(){return a.navigation.navigateToDashboardMobileAuthoringByGUID(i.objectId)};c=function(){a.moduleLoader.require({javascript:"MobileAuthoring/components/createMobileLayoutDialog/createMobileLayoutDialogBuilder"}).then((function(t){var i=t.createMobileLayoutDialogBuilder(a.modalDialogService);i.show().then((function(t){t&&(a.telemetryService.logEvent(e.telemetry.MobileAuthoringDashboardOpenedFromFlyout,e.telemetry.FlyoutOperationType.Add,!0),p())}))}))}}a.telemetryService.logEvent(e.telemetry.MobileAuthoringFlyoutShown,d,e.telemetry.OperationType.Add),a.mobileAuthoringService.showMobileIndicationMessage(i.objectId,d?1:0,e.common.NotificationToastType.Add,!d,!1,c)}o.resolve()}),(function(n){var s,c;n.status===e.HttpStatusCode.RequestEntityTooLarge?(s=a.localizationService.get("PinTile_Error_TooLarge"),c=a.localizationService.get("PinTile_Error_TooLargeDetails")):(s=a.localizationService.get("PinTile_Error"),c=a.localizationService.get("PinTile_Error_DefaultDetails")),r&&a.notificationToastService.hide(r),a.notificationToastService.notify({title:s,message:c,notificationType:e.common.NotificationToastType.Error}),a.removeTileFromDashboard(t,i),o.reject(d.getTelemetryErrorDetails(n.error))}))},C.prototype.updateDashboardToken=function(e){var t=this,i=this.promiseFactory.defer();return this.dashboardHttpService.getDashboards(this.promiseFactory,[e.id]).then((function(o){var r=o[0].data;r&&(t.modelMerger.mergeDashboardShallow(e,r.dashboards[0]),t.dashboardDataService.updateActiveDashboardModels(),i.resolve(null))}),(function(){return i.reject()})),i.promise},C.prototype.removeTemporaryTile=function(e){this.removeTileFromDashboard(e,this.dashboardDataService.activeDashboard)},C.prototype.navigateToShareDashboard=function(t){return __awaiter(this,void 0,e.Promise,(function(){var o;return __generator(this,(function(r){switch(r.label){case 0:if(this.viralTenantMergeHelperService.viewingDataFromMergedViralTenant())this.viralTenantMergeHelperService.displayFeatureDisabledErrorMessage("ArchivedContent_ErrorMessageSharing");else if(this.storageUsageService.checkQuotaExceeded(this.dashboards,e.telemetry.QuotaCheckOperation.ShareDashboard))return[2];return[4,this.checkUserNeedsProLicenseAndShowError(this.dashboardContainerModel.findDashboardByGUID(t),this.userInfo,this.licenseEnforcementService,this.localizationService,this.navigation,e.telemetry.LicenseEnforcementOperation.ShareDashboard)];case 1:return o=r.sent(),o||this.taskPaneSliderService.expandPane(6,i.Large),[2]}}))}))},C.prototype.checkUserNeedsProLicenseAndShowError=function(t,i,o,r,a,n,s){return void 0===s&&(s=null),__awaiter(this,void 0,e.Promise,(function(){var i,r,a;return __generator(this,(function(c){switch(c.label){case 0:return t?(r=o.supportsDashboard,r?[4,o.supportsDashboard(t.contract,n,!0)]:[3,2]):[2,!1];case 1:r=c.sent(),c.label=2;case 2:return(i=r)?[3,5]:(a=s,a?[4,o.supportsDashboard(s.contract,n,!1)]:[3,4]);case 3:a=c.sent(),c.label=4;case 4:a?this.navigationHelper.navigateToDashboard(s):this.navigation.navigateToContentList(e.constants.myWorkSpaceGroupId),c.label=5;case 5:return[2,i]}}))}))},C.prototype.removeTileFromDashboard=function(e,t){var i=t.contract.tiles,o=_.findIndex(i,{id:e.id});o!==-1&&i.splice(o,1);var r=t.tiles,a=r.indexOf(e);a!==-1&&r.splice(a,1)},C.prototype.isDashboardNameValid=function(e,t){return!_.isEmpty(e)},C.prototype.beforeDashboardDeletingHandler=function(e){this.navigateAfterDashboardDelete(this.dashboardContainerModel,e)},C.prototype.afterDashboardDeletingHandler=function(t){this.tryResetHome(t),this.navigation.inFavoritesView()&&this.rootScope.$emit(e.constants.updateFavorites)},C.prototype.isAlertingEnabled=function(){return!0},C.prototype.isInFocusModeEnabled=function(){return!0},C.updateActiveDashboardDelayMs=500,C.refreshTileDataDelayMs=500,C.loadDashboardTimeout=3e4,C})();e.DashboardService=C})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,a,n){return new r(e,t,i,o,a,n)}var o=e.dataServices.AppUtils;t.createNavigationHelper=i;var r=(function(){function e(e,t,i,o,r,a){this.navigation=e,this.appService=t,this.packageService=i,this.activeGroupId=o,this.dashboardDataService=r,this.reportService=a}return e.prototype.navigateToDashboard=function(e,t){if(e&&e.contract){var i,r=e.objectId,a=e.contract.originalDashboardObjectId;a&&(i=o.getDashboardAppGUID(e,this.appService,this.packageService)),i?this.navigation.navigateToAppDashboardByGUID(r,a,i,t):t?this.navigation.insertGroupAndNavigateToDashboardByGUID(r,t):this.navigation.navigateToDashboardByGUID(r)}},e.prototype.navigateToReport=function(e,t,i,r,a){if(e&&e.contract){var n,s,c=e.objectId,l=e.contract.originalReportObjectId;if(l){n=o.getResourceAppGUID(e,this.appService,this.packageService);var d=e.packageId;s=n&&!o.isOrgAppInstance(d,this.appService)?d:null}this.navigation.navigateToReport({appGUID:n,appInstanceId:s,reportGUID:c,reportOriginalGUID:l,groupGUID:t||this.activeGroupId.activeGroupObjectId,reportPage:i,dashboardGUID:r,filter:a})}},e.prototype.ensureDashboardGUID=function(){var e=this.navigation;if(e.inDashboardView()&&e.inAppView()&&!e.currentDashboardGUID){var t=e.currentAppInstanceId||o.getPackageIDByOrgAppGUID(this.appService,this.packageService,e.currentAppGUID),i=this.dashboardDataService.retrieveDashboardForApp(t,e.currentDashboardOriginalGUID);e.currentDashboardGUID=i&&i.objectId}},e.prototype.ensureTileGUID=function(){var e=this.navigation;if((e.inInFocusView()||e.inInFocusInsightsView()||e.inAlertsEditorView())&&e.inAppView()&&!e.currentTileGUID){var t=this.dashboardDataService.findDashboardByGUID(e.currentDashboardGUID);if(t){var i=t.findTileByObjectIdOrOriginalObjectId(null,e.currentTileOriginalGUID);e.currentTileGUID=i&&i.objectId}}},e.prototype.ensureReportGUID=function(){var e=this.navigation;if(e.inReportView()&&e.inAppView()&&!e.currentReportGUID){var t=e.currentAppInstanceId||o.getPackageIDByOrgAppGUID(this.appService,this.packageService,e.currentAppGUID),i=this.reportService.retrieveReportForApp(t,e.currentReportOriginalGUID);e.currentReportGUID=i&&i.objectId}},e})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={})),define("powerBI/services/publishApp",["require","exports"],(function(e,t){function i(e,t,i,r,a,n,s){return new o(e,t,i,r,a,n,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i;var o=(function(){function e(e,t,i,o,r,a,n){this.promiseFactory=e,this.contentPackService=t,this.modelConverter=i,this.appService=o,this.syncService=r,this.groupService=a,this.publishAppHttp=n,this.publishedApps=[],this.publishedAppsDeferred=e.defer(),this.syncService.addContentPackRefreshListener(this),this.groupService.addGroupChangedHandler(this),this.loadPublishedApps()}return e.prototype.onContentPackDeleted=function(e){_.remove(this.publishedApps,(function(t){return t.providerId===e}))},e.prototype.onGroupChanged=function(){this.publishedApps=[],this.loadPublishedApps()},e.prototype.addPublishedApp=function(e){this.findPublishedApp(e.objectId)||this.publishedApps.push(e)},e.prototype.findPublishedApp=function(e){return _.find(this.publishedApps,(function(t){return t.objectId===e}))},e.prototype.getPublishedAppsForCurrentGroup=function(){return this.publishedAppsDeferred?this.publishedAppsDeferred.promise:this.promiseFactory.resolve(this.publishedApps)},e.prototype.deletePublishedApp=function(e,t){var i=this,o=_.find(this.publishedApps,(function(e){return e.providerContract.providerKey===t}));if(!o)return this.promiseFactory.reject();var r=this.promiseFactory.defer();return _.pull(this.publishedApps,o),this.publishAppHttp.deleteApp(e,t).then((function(){i.contentPackService.removeContentPacks([o.providerId]),i.contentPackService.markItemsUsedByContentPack(),r.resolve(null)}),(function(){i.publishedApps.push(o),r.reject()})),r.promise},e.prototype.publishOrUpdateApp=function(e,t,i){return t.objectId?this.publishAppHttp.updateApp(e,t,i):this.publishAppHttp.publishApp(e,t,i)},e.prototype.loadPublishedApps=function(){var e=this;this.publishedAppsDeferred&&this.publishedAppsDeferred.reject();var t=this.publishedAppsDeferred=this.promiseFactory.defer(),i=[this.groupService.ensureGroupsInitialization(),this.appService.ensureAppsInitialization()];this.promiseFactory.allSettled(i).then((function(){e.contentPackService.getContentPacksForCurrentGroup().then((function(i){if(e.publishedAppsDeferred===t){var o=_.filter(i,(function(t){return e.appService.isAppCategory(t.providerContract.category)}));e.publishedApps=o.map((function(t){return e.modelConverter.convertAppPublishModel(t.providerContract)})),t.resolve(e.publishedApps),e.publishedAppsDeferred=null}}),(function(){t.reject()}))}),(function(){t.reject()}))},e})()})),define("powerBI/services/requestAccess",["require","exports"],(function(e,t){function i(e,t,i,o,r,a,n,c,l,d,p,u,h){return new s(e,t,i,o,r,a,n,c,l,d,p,u,h)}Object.defineProperty(t,"__esModule",{value:!0});var o=powerbi,r=o.common,a=(o.dialogs,o.errorDetailsHelper),n=o.telemetry;t.create=i;var s=(function(){function e(e,t,i,o,r,a,n,s,c,l,d,p,u){this.localizationService=e,this.modalDialogService=t,this.telemetryService=i,this.dashboardInvitationHttp=o,this.bootstrapService=r,this.errorService=a,this.notificationToast=n,this.moduleLoader=s,this.userInfo=c,this.promiseFactory=l,this.dashboardDataService=d,this.dashboardSyncService=p,this.navigation=u}return e.prototype.handleRequestAccessFlow=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,i,o,r,a,n,s,c,l,d=this;return __generator(this,(function(p){switch(p.label){case 0:t=function(){return d.bootstrapService.bootstrapNavigation(!1)},p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.checkDashboardAccess(e)];case 2:return i=p.sent(),[3,4];case 3:return o=p.sent(),this.errorService.error(this.localizationService.get("RequestDashboardAccess_UnexpectedError"),"RequestDashboardAccess_FailedToCheckDashboardPermissions"),t(),[2];case 4:return 2===i?(t(),[2]):0===i?(r=e.dashboardObjectId,a=this.dashboardDataService,n=a.findDashboardByGUID(r),a.activeDashboard=n,this.navigation.navigateToDashboardByGUID(r),[2]):[4,this.moduleLoader.require({javascript:"PowerBIDialogs/components/errorDialog/errorDialogBuilder"})];case 5:return s=p.sent(),c=s.createErrorDialogBuilder(this.modalDialogService),[4,c.show("RequestDashboardAccessError","RequestDashboardAccess_CheckingPermissionsTitle","RequestDashboardAccess_NoAccessMessage","RequestDashboardAccess_RequestAccessButton","ModalDialog_Cancel")];case 6:return l=p.sent(),1===l?(t(),[2]):(this.requestDashboardAccess(e.dashboardObjectId),[2])}}))}))},e.prototype.checkDashboardAccess=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,i,o,r,a,n,s=this;return __generator(this,(function(c){switch(c.label){case 0:return t=e&&e.dashboardId,_.isNumber(t)?(i=this.promiseFactory.defer(),o=!1,[4,this.moduleLoader.require({javascript:"PowerBIDialogs/components/progressDialog/progressDialogBuilder"})]):[2,this.promiseFactory.reject(null)];case 1:return r=c.sent(),a=r.createProgressDialogBuilder(this.modalDialogService,this.promiseFactory),n=a.show("RequestDashboardAccess","RequestDashboardAccess_CheckingPermissionsTitle","RequestDashboardAccess_CheckingPermissionsMessage",!0),n.dialogClosedPromise.then((function(e){o=1===e,o&&i.resolve(2)})),this.userInfo.userMetadataPromise.then((function(r){if(!o){var c=_.find(r.dashboardOwnerInfo,(function(e){return e.dashboardId===t})),l=e.dashboardObjectId,d=function(e){a.hide(n.dialogVisiblePromise),n.dialogClosedPromise.finally((function(){return i.resolve(e)}))},p=function(){a.hide(n.dialogVisiblePromise),n.dialogClosedPromise.finally((function(){return i.reject()}))};if(!c)return void d(1);var u=s.dashboardDataService,h=function(){return!!u.findDashboardByGUID(l)};h()?d(0):s.dashboardSyncService.addOrDeepEditDashboard(t).then((function(){o||(h()?d(0):p())}),(function(){return p()}))}})),[2,i.promise]}}))}))},e.prototype.requestDashboardAccess=function(e){return __awaiter(this,void 0,powerbi.Promise,(function(){var t,i,o,s,c,l,d,p,u,h;return __generator(this,(function(v){switch(v.label){case 0:return[4,this.moduleLoader.require({javascript:"PowerBIDialogs/components/requestAccessDialog/requestAccessDialogBuilder"})];case 1:return t=v.sent(),i=t.createRequestAccessDialogBuilder(this.modalDialogService),[4,i.show("requestDashboardAccess","RequestDashboardAccessModal_RequestAccessTitle","RequestDashboardAccessModal_RequestAccessDescription","RequestDashboardAccessModal_Placeholder","RequestDashboardAccessModal_SendButton","ModalDialog_Cancel")];case 2:if(o=v.sent(),this.bootstrapService.bootstrapNavigation(!1),!o||!o.shouldRequestAccess)return[2];s=this.notificationToast,c=this.localizationService,l=s.notify({title:c.get("RequestDashboardAccess_SendingTitle"),message:c.get("RequestDashboardAccess_SendingMessage"),notificationType:r.NotificationToastType.Loading,sticky:!0}),d=o.requestAccessMessage,p=_.isEmpty(d),u=this.telemetryService.startEvent(n.DashboardRequestDashboardAccess,e,d.length,p),v.label=3;case 3:return v.trys.push([3,5,,6]),[4,this.dashboardInvitationHttp.requestDashboardAccess(e,d,u.event)];case 4:return v.sent(),u.resolve(),s.hide(l),s.notify({title:c.get("RequestDashboardAccess_SentTitle"),message:c.get("RequestDashboardAccess_SentMessage"),notificationType:r.NotificationToastType.Success,sticky:!1}),[3,6];case 5:return h=v.sent(),s.hide(l),u.reject(a.getTelemetryErrorDetails(h.error,h.status)),this.errorService.error(c.get("RequestDashboardAccess_FailedToRequestDashboardAccess"),"RequestDashboardAccess_FailedToRequestDashboardAccess",{requestId:h.requestId,statusCode:h.status.toString()}),[3,6];case 6:return[2]}}))}))},e})()}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i){return new r(e,t,i)}var o=jsCommon.FreezeUtility;t.createShellCapabilities=i;var r=(function(){function t(e,t,i){this.asyncFeatureSwitchService=e,this.userInfo=t,this.promiseFactory=i,this.init()}return t.prototype.ensureCapabilitiesInitialized=function(){return this.initializationDeferred.promise},t.prototype.getCapabilities=function(){return this.frozenCapabilities},t.prototype.init=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i,o;return __generator(this,(function(r){switch(r.label){case 0:return this.initializationDeferred=this.promiseFactory.defer(),[4,this.asyncFeatureSwitchService.getFeatureSwitches()];case 1:return r.sent(),e=!!this.asyncFeatureSwitchService.featureSwitches.contentAuthoringUIEnabled,t=this.userInfo.userMetadata,i=!(!t||!t.isGuest),o={showNavPane:!i,navPane:{showGetData:!i&&e,showGroupSwitcher:!i&&e,showQuickAccessPane:!i&&e},showNavBarSettings:!i,navBarSettings:{showQuotaManagement:!i&&e,showContentPacks:!i&&e,showManageGateways:!i&&e,showPublishToWeb:!i&&e},showNavBarNotifications:!i,showO365Launcher:!i},this.freeze(o),this.initializationDeferred.resolve(this),[2]}}))}))},t.prototype.freeze=function(e){o.deepFreeze(e),this.frozenCapabilities=e},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var pbi=powerbi,common=pbi.common,services=pbi.services;angular.module("powerbi.components",[]),angular.module("powerbi.controllers",[]),angular.module("powerbi.directives",[]),angular.module("powerbi.filters",[]);var modules=["angularFileUpload","powerbi.common","powerbi.common.directives","powerbi.connectivity","powerbi.components","powerbi.controllers","powerbi.dashboard","powerbi.directives","powerbi.filters","powerbi.visualHost","powerbi.dataServices","ui.router","ngSanitize"];powerbi.explore&&(modules.push("powerbi.explore"),modules.push("powerbi.infonavbootstrap")),powerbi.insights&&modules.push("powerbi.insights"),powerbi.gateways&&modules.push("powerbi.gateways"),powerbi.userNotifications&&modules.push("powerbi.userNotifications"),angular.module("powerbi",modules).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(new RegExp(e.aHrefSanitizationWhitelist().source+"|^s*(data):"))}]).config(["lazyProvider",function(e){var t=e.factories;t.alertHttpService={source:{javascript:"powerBI/proxies/alertsHttpService"},ng:["promiseFactory","telemetryService","errorService","localizationService"],fn:function(e,t,i,o,r){return e.createAlertHttpService(t,i,o,r)}},t.errorFormat={source:{javascript:"powerBI/services/errorFormat"},fn:function(e){return e.create()}},t.exportToPowerPoint={
source:{javascript:"powerBI/services/exportToPowerPointService"},ng:["telemetryService","notificationToast","errorService","localizationService","modalDialogService","$rootScope","fileSaver","licenseEnforcementService","approvedResourceService"],fn:function(e,t,i,o,r,a,n,s,c,l){return e.create(t,i,o,r,a,n,s,c,l)}},t.insightsBootstrap={source:{javascript:"powerBI/services/insightsBootstrap"},ng:["insightsService","modelService","navigation","telemetryService","notificationToast","localizationService","appService"],fn:function(e,t,i,o,r,a,n,s){return e.create(t,i,o,r,a,n,s)}},t.insightsRuntime={source:{javascript:"powerBI/proxies/insightsHttpRuntime"},ng:["promiseFactory","syncService","featureSwitchService"],fn:function(e,t,i,o){return e.create(common.httpService,t,i,o)}},t.permissionNavigation={source:{javascript:"PermissionsDataServices/services/permissionNavigation"},ng:["$location","$window","$rootScope","$state","featureSwitchService"],fn:function(e,t,i,o,r,a){return e.create(t,i,o,r,a)}},t.permissionHttp={source:{javascript:"PermissionsDataServices/proxies/permissionHttp"},fn:function(e){return e.create()}},t.permissionData={source:{javascript:"PermissionsDataServices/services/permissionData"},ng:["dashboardDataService","reportService","modelService","workbookService","promiseFactory","telemetryService"],modular:["permissionHttp"],fn:function(e,t,i,o,r,a,n,s){return e.create(t,i,o,r,a,n,s)}},t.publishAppHttp={source:{javascript:"powerBI/proxies/publishAppHttp"},fn:function(e){return e.create()}},t.perfInspector={source:{javascript:"powerBI/services/performanceInspector"},ng:["localizationService","dashboardService","visualPlugin","serverLatency"],fn:function(e,t,i,o,r){return e.create(t,i,o,r)}},t.publishApp={source:{javascript:"powerBI/services/publishApp"},ng:["promiseFactory","contentPackService","modelConverter","appService","syncService","groupService"],modular:["publishAppHttp"],fn:function(e,t,i,o,r,a,n,s){return e.create(t,i,o,r,a,n,s)}},t.previewFeatures={source:{javascript:"Settings/services/previewFeatures"},ng:["$window","telemetryService","tutorialDataStore"],fn:function(e,t,i,o){return e.create(t,i,o)}},t.requestAccess={source:{javascript:"powerBI/services/requestAccess"},ng:["localizationService","modalDialogService","telemetryService","dashboardInvitationHttp","bootstrapService","errorService","notificationToast","moduleLoader","userInfo","promiseFactory","dashboardDataService","dashboardSyncService","navigation"],fn:function(e,t,i,o,r,a,n,s,c,l,d,p,u,h){return e.create(t,i,o,r,a,n,s,c,l,d,p,u,h)}},t.embedCodesService={source:{javascript:"EmbedCodes/services/embedCodesService"},ng:["reportService","embedProxy","telemetryService","errorService","localizationService","modelService","promiseFactory"],fn:function(e,t,i,o,r,a,n,s){return e.create(t,i,o,r,a,n,s)}}}]).factory("syncService",["$timeout","promiseFactory","delayedQueryResultHandler","telemetryService","asyncFeatureSwitchService","pageVisibilityService",function(e,t,i,o,r,a){var n=common.createSyncService(e,t),s=powerbi.createDelayedQueryResultResolver(n,e,o);return i.setQueryResolver(s),r.getFeatureSwitches().then((function(e){e.autoPausedSyncService&&a.register(n)})),n}]).factory("userSettingsHttpService",[function(){return powerbi.createUserSettingsHttpService()}]).factory("favoritesHttp",["syncService","notificationToast",function(e,t){return powerbi.createFavoritesHttpService(e,t)}]).factory("settingsMetadataHttpService",[function(){return powerbi.createSettingsMetadataHttpService()}]).factory("o365ApplicationLauncherService",(function(){return powerbi.createO365ApplicationLauncherService()})).factory("refreshService",["modelHttpService","datasetsService","$rootScope","notificationToast","gatewaysMetadataService","featureSwitchService","promiseFactory","selectGatewayService","localizationService","modalDialogService",function(e,t,i,o,r,a,n,s,c,l){return powerbi.createRefreshService(e,t,i,o,r,a,n,s,c,l)}]).factory("geolocationService",powerbi.visuals.services.createGeolocation).factory("tileDisplay",["errorService",function(e){return powerbi.createTileDisplayService(e)}]).factory("modelConverter",["telemetryService","errorService","visualPlugin","promiseFactory","geolocationService","dataServiceModelConverter","localizationService",function(e,t,i,o,r,a,n){return powerbi.models.createModelConverter(e,t,i,o,r,a,n)}]).factory("contentProviderHttpService",["$http","promiseFactory","telemetryService","httpRequestWorker","featureSwitchService","activeGroupId",function(e,t,i,o,r,a){var n=new common.HttpService(e,t,i,a,o);return powerbi.common.createContentProviderHttpService(r,a,i,t,n)}]).factory("contentProviderService",["featureSwitchService","localizationService","contentProviderHttpService","telemetryService","errorService","notificationToast","lazy","appService","promiseFactory","licenseEnforcementService",function(e,t,i,o,r,a,n,s,c,l){return powerbi.services.createContentProviderService(e,t,i,o,r,a,n,s,c,l)}]).factory("alertRuleService",powerbi.createAlertRuleService).factory("realTimeDataHttp",[function(){return powerbi.createRealTimeDataHttpService()}]).factory("powerBIDesktopLauncher",[function(){return common.powerBIDesktopLauncher}]).factory("realTimeLongPollData",["$timeout","tabularDataCache","realTimeDataHttp","telemetryService","promiseFactory",function(e,t,i,o,r){return services.createRealTimeLongPollDataService(e,t,i,o,r,{enableDataRefresh:!0})}]).factory("realTimePubNubData",["promiseFactory","realTimeDataHttp","tabularDataCache","telemetryService","moduleLoader","$timeout",function(e,t,i,o,r,a){return services.createRealTimePubNubDataService(e,t,i,o,r,a)}]).factory("realTimeData",["$rootScope","modelService","realTimeLongPollData","realTimePubNubData","tabularDataCache","pageVisibilityService",function(e,t,i,o,r,a){var n=services.createRealTimeDataService(e,t,i,o,r);return a.register(n),n}]).factory("realTimeModel",["conceptualSchemaProxy","errorService","localizationService","modelService","promiseFactory","realTimeDataHttp","telemetryService","$timeout",function(e,t,i,o,r,a,n,s){return services.createRealTimeModelService(e,t,i,o,r,a,n,s)}]).factory("modelMerger",["modelConverter","dataServiceModelMerger","permissionService",function(e,t,i){var o=powerbi.models.createModelMerger(e,t,i);return e.setModelMerger(o),o}]).factory("navigationStateValidator",["$timeout","impersonationService","permissionService","reportService",function(e,t,i,o){return services.createNavigationStateValidator(e,t,i,o)}]).factory("conceptualModelSetting",["asyncFeatureSwitchService","tutorialDataStore",function(e){return powerbi.createConceptualModelSetting(e)}]).service("navigation",["$location","$window","$rootScope","$state","$stateParams","featureSwitchService","activeGroupId","home","navigationStateValidator","licenseEnforcementService",services.Navigation]).service("navigationActions",["$rootScope","contentPackService","dashboardService","datasetActions","errorService","featureSwitchService","localizationService","modalDialogService","modelService","navigation","packageService","quota","reportService","telemetryService","workbookService","ownership","lazy","navigationHelper",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f){return services.createNavigationActions(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f)}]).service("navigationHelper",["navigation","appService","packageService","activeGroupId","dashboardDataService","reportService",function(e,t,i,o,r,a){return services.createNavigationHelper(e,t,i,o,r,a)}]).service("datasetActions",["$rootScope","analyzeInExcel","contentPackService","downloadReport","errorService","lazy","localizationService","modalDialogService","modelService","navigation","permissionService","quota","realTimeModel","refreshService","settingsMetadataService","taskPaneSliderService","telemetryService",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m){return powerbi.requireSync("services/datasetActions").create(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m)}]).factory("fullScreen",["$rootScope","navigation","$document","notificationToast",function(e,t,i,o){return services.createFullScreenService(e,t,i,o)}]).factory("historyDialogService",["$rootScope","$compile",function(e,t){return powerbi.createHistoryDialogService(e,t)}]).factory("groupService",["$location","$rootScope","$timeout","telemetryService","errorService","localizationService","groupHttp","activeGroupId","featureSwitchService","userInfo","reportService","modelService","promiseFactory","navigation","workbookService","packageService","lazy","appMetadataService","home","appService",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y){var S={location:e,rootScope:t,timeout:i,telemetryService:o,errorService:r,localizationService:a,groupHttpService:n,activeGroupIdService:s,featureSwitchService:c,userInfo:l,appService:y,reportService:d,modelService:p,promiseFactory:u,navigation:h,workbookService:v,packageService:g,lazy:m,appMetadataService:f,home:b};return powerbi.createGroupService(S)}]).factory("groupContextMenuService",["$window","$rootScope","errorService","groupHttp","groupService","localizationService","modalDialogService","navigation","promiseFactory","taskPaneSliderService","telemetryService",function(e,t,i,o,r,a,n,s,c,l,d){var p={rootScope:t,$window:e,errorService:i,groupHttp:o,groupService:r,localizationService:a,modalDialogService:n,navigation:s,promiseFactory:c,taskPaneSliderService:l,telemetryService:d};return powerbi.createGroupContextMenuService(p)}]).factory("scriptVisuals",["featureSwitchService","localizationService","userInfo","visualPlugin","embedModeService",function(e,t,i,o,r){return powerbi.explore.services.createScriptVisualsService(o,e,t,i,r)}]).factory("embed",["$location","promiseFactory","featureSwitchService","dataReaderProvider","explorationSerializer","conceptualSchemaProxy","dataProxy","displayNameService","visualPlugin","aggrOps","telemetryService","scriptVisuals","activeGroupId",function(e,t,i,o,r,a,n,s,c,l,d,p,u){var h=powerbi.explore.services.createVisualPluginOps(c),v=powerbi.explore.services.createVisualRelationshipService(c,h),g=powerbi.explore.services.createSortService(s,i,c),m=powerbi.explore.services.createFilterGenerator(common.createEventBridge(),c,l,v,{getSelectedHostFilters:function(){return null}},d,p),f=powerbi.data.transforms.createTransformPluginService(),b=powerbi.explore.services.createVisualQueryGenerator({dataReaders:o,displayNameService:s,featureSwitchService:i,plugin:c,pluginOps:h,sortService:g,aggrOps:l,filterGenerator:m,transformPluginService:f,telemetryService:d});return powerbi.explore.services.createEmbedService(e,t,r,a,b,n,c,s,m,u)}]).factory("dynamicMessagingDataHttp",[function(){return powerbi.createDynamicMessagingDataHttpService()}]).service("dynamicMessagingData",["dynamicMessagingDataHttp","userNotificationInfo","userInfo","telemetryService","localizationService","asyncFeatureSwitchService",function(e,t,i,o,r,a){return powerbi.createDynamicMessagingDataService(e,t,i,o,r,a)}]).service("dashboardStateChangeService",["$rootScope","dashboardDataService","dashboardService","dashboardWarningsService","errorService","featureSwitchService","groupService","inFocusService","licenseEnforcementService","localizationService","modelConverter","mostRecentlyUsedService","navigation","permissionService","$timeout","telemetryService","userInfo","appService","subscription","taskPaneSliderService",services.DashboardStateChangeService]).service("dashboardConfigurationService",(function(){return services.createDashboardConfigurationService()})).service("dashboardWarningsService",["$rootScope","telemetryService","dashboardDataService","resourceGateService","featureSwitchService","tutorialDataStore","notificationBar","resourcePackageListenerService","embedModeService","localizationService","visualPlugin",services.DashboardWarningsService]).service("dashboardService",["$location","$rootScope","navigation","$timeout","telemetryService","errorService","modelMerger","modelConverter","syncService","dashboardConfigurationService","dashboardDataService","dashboardHttpService","dashboardSyncService","dashboardWarningsService","fullScreen","localizationService","mobileAuthoringService","modalDialogService","moduleLoader","promiseFactory","reportService","modelHttpService","viralTenantMergeHelperService","groupService","featureSwitchService","modelService","licenseEnforcementService","userInfo","contentProviderHttpService","storageUsageService","appMetadataService","permissionService","workbookService","notificationBar","notificationToast","resourcePackagesService","userSettingsService","visualPlugin","dashboardInvitationHttp","resourceGateService","home","packageService","inFocusService","userActivityContextService","mostRecentlyUsedService","appService","editableFeatureSwitchService","conceptualModelSetting","taskPaneSliderService","fileSaver","navigationHelper","lazy","dashboardInvitation",powerbi.DashboardService]).service("explorationLoader",["$rootScope","$timeout","modelConverter","explorationProxy","localizationService","telemetryService","navigation","modelService","packageService","notificationBar","errorService","userActivityContextService",services.ExplorationLoader]).factory("contentPackService",["$rootScope","appService","errorService","telemetryService","modelConverter","syncService","contentProviderHttpService","localizationService","navigation","dashboardService","featureSwitchService","userInfo","lazy","notificationToast","reportService","modelService","permissionService","workbookService","promiseFactory","quota","modalDialogService","groupService","licenseEnforcementService","moduleLoader",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C){return powerbi.createContentPackService(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C)}]).factory("storageUsageService",["$rootScope","telemetryService","errorService","dashboardHttpService","localizationService","featureSwitchService","reportService","modelService","promiseFactory","navigation","userInfo","groupService","workbookService","lazy","permissionService","appMetadataService",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g){return powerbi.createStorageUsageService(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g)}]).factory("quota",["storageUsageService","dashboardService",function(e,t){return services.createQuota(e,t)}]).factory("usageMetricsHttp",["$http","promiseFactory","telemetryService","activeGroupId","httpRequestWorker","featureSwitchService",function(e,t,i,o,r,a){var n=new common.HttpService(e,t,i,o,r);return powerbi.createUsageMetricsHttpService(i,t,n,a)}]).factory("groupHttp",["telemetryService","activeGroupId",function(e,t){return powerbi.createGroupHttpService(e,t)}]).factory("tutorialPopup",["telemetryService","userInfo","tutorialDataStore","applicationOptions","featureSwitchService","localizationService","navigation","conceptualModelSetting","rtl","appMetadataService","groupHttp","licenseEnforcementService",function(e,t,i,o,r,a,n,s,c,l,d,p){return powerbi.createTutorialPopupService(e,t,i,o,r,a,n,s,c,l,d,p)}]).factory("userSettingsService",["telemetryService","modelConverter","promiseFactory","userSettingsHttpService","errorService","localizationService","appMetadataService","networkAvailability","$rootScope",function(e,t,i,o,r,a,n,s,c){return powerbi.createUserSettingsService(e,t,i,o,r,a,n,s,c)}]).factory("settingsMetadataService",["promiseFactory","settingsMetadataHttpService","telemetryService",function(e,t,i){return powerbi.createSettingsMetadataService(e,t,i)}]).factory("licenseCheckStrategyFactory",["userInfo","reportService","modelService","lazy","localizationService","appService","activeGroupId",function(e,t,i,o,r,a,n){return new powerbi.LicenseCheckStrategyFactory(e,t,i,o,r,a,n)}]).factory("licenseEnforcementService",["analyzeInExcel","licenseCheckStrategyFactory","userInfo","lazy","checkUnsavedService","userNotificationInfo",function(e,t,i,o,r,a){return powerbi.createLicenseEnforcementSevice(e,t,i,o,r,a)}]).factory("pinTileService",["$rootScope","errorService","telemetryService","localizationService","modalDialogService","modelConverter","visualPlugin","themeService","visualStylePresetService","userSettingsService","reportService","modelService","workbookService","dashboardService","packageService","explorationSerializer","promiseFactory","moduleLoader","featureSwitchService","usageMetricsReport","$interval",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S){return powerbi.createPinTileService(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S)}]).factory("inFocusService",["$rootScope","telemetryService","modelConverter","modelService","reportService","localizationService","visualPlugin",function(e,t,i,o,r,a,n){return services.createInFocusService(e,t,i,o,r,a,n)}]).factory("home",["$rootScope","errorService","localizationService","notificationToast","telemetryService","promiseFactory",function(e,t,i,o,r,a){return services.createHome(e,t,i,o,r,a)}]).service("bootstrapService",["$rootScope","$timeout","dashboardService","dashboardDataService","modelService","telemetryService","localizationService","navigation","notificationToast","storageUsageService","errorService","favorites","mostRecentlyUsedService","home","groupService","promiseFactory","workbookService","storeAppInstall","packageService","appService","lazy","navigationActions","asyncFeatureSwitchService",services.BootstrapService]).factory("checkSigninService",[function(){return new common.DefaultCheckSigninService}]).factory("qrCodeService",["$rootScope","$compile","promiseFactory","localizationService","dashboardHttpService","reportHttpService","errorService","modalDialogService","telemetryService","moduleLoader",function(e,t,i,o,r,a,n,s,c,l){return powerbi.createQRCodeService(e,t,i,o,r,a,n,s,c,l)}]).factory("ownership",["packageService",function(e){return powerbi.createOwnershipService(e)}]).factory("filterPersistenceService",["promiseFactory","userSettingsService","telemetryService",function(e,t,i){return services.createFilterPersistenceService(e,t,i)}]).factory("mostRecentlyUsedService",["promiseFactory",function(e){return services.createMostRecentlyUsedServicePlaceholder(e)}]).factory("printService",["$rootScope",function(e){return powerbi.createPrintService(e)}]).factory("pageVisibilityService",["telemetryService","$document",function(e,t){return powerbi.createPageVisibilityService({logPageInactiveToTelemetry:!0},e,t)}]).factory("dashboardInvitationHttp",["promiseFactory","telemetryService",function(e,t){return powerbi.createDashboardInvitationHttpService(e,t)}]).factory("pageTitle",["localizationService","navigation","dashboardService","reportService","workbookService","$window","$rootScope",function(e,t,i,o,r,a,n){return services.createPageTitleService(e,t,i,o,r,a,n)}]).factory("shareSliderService",["navigation","$rootScope","taskPaneSliderService","licenseEnforcementService",function(e,t,i,o){return services.createShareSliderService(e,t,i,o)}]).factory("favorites",["telemetryService","favoritesHttp","activeGroupId","promiseFactory","dashboardService","$rootScope","featureSwitchService","notificationToast","localizationService","errorService","permissionService","appMetadataService","navigation","tutorialDataStore","dataClassificationService","appService","mostRecentlyUsedService",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m){return powerbi.createFavoritesService(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m)}]).factory("usageMetricsReport",["usageMetricsHttp","navigation","localizationService","notificationToast","dashboardService","errorService","reportService","promiseFactory","packageService","modelService","moduleLoader","featureSwitchService","contentProviderHttpService",function(e,t,i,o,r,a,n,s,c,l,d,p,u){return services.createUsageMetricsReport(e,t,i,o,r,a,n,s,c,l,d,p,u)}]).factory("contentList",["telemetryService","dashboardService","reportService","navigation","modelService","analyzeInExcel","workbookService","contentPackService","localizationService","packageService","errorService","$rootScope","modalDialogService","refreshService","permissionService","settingsMetadataService","$location","$window","favorites","shareSliderService","groupService","appService","promiseFactory","mostRecentlyUsedService","dashboardDataService","taskPaneSliderService","ownership","usageMetricsReport","lazy","licenseEnforcementService",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C,T,I,k,M,P,E){return powerbi.createContentListService(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C,T,I,k,M,P,E)}]).factory("visualPlugin",["asyncFeatureSwitchService","promiseFactory","resourceLoader","telemetryService",function(e,t,i,o){return powerbi.createDashboardVisualPluginService(e,t,i,o,{tooltipsEnabled:!0})}]).factory("visualStylePresetService",(function(){return powerbi.visualHost.services.createVisualStylePresetService()})).factory("exportStaticReportProxy",["promiseFactory","errorService","localizationService",function(e,t,i){return powerbi.proxies.createExportStaticReportProxy(e,t,i)}]).factory("exportStaticExplorationService",["exportStaticReportProxy","notificationToast","localizationService","fileSaver",function(e,t,i,o){return services.createExportStaticExplorationService(e,t,i,o)}]).factory("breadcrumbFactory",["localizationService","navigation","groupService","dashboardDataService","home","reportService","workbookService","modelService","permissionService","userInfo","asyncFeatureSwitchService","promiseFactory","ownership","appService","dataServiceModelConverter","packageService","usageMetricsReport","featureSwitchService","lazy",powerbi.models.factory.createBreadcrumbFactory]).factory("datasetsMenuFactory",["analyzeInExcel","appService","featureSwitchService","groupService","insightsService","localizationService","ownership","permissionService","usageMetricsReport",function(e,t,i,o,r,a,n,s,c){return powerbi.models.factory.createDatasetsMenuFactory(e,t,i,o,r,a,n,s,c)}]).factory("storeAppInstall",["appService","navigation","promiseFactory","contentProviderService","contentProviderHttpService","errorService","localizationService","telemetryService","quota","$rootScope","dashboardDataService","modelService","reportService","workbookService",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h){return services.createStoreAppInstallService(e,t,i,o,r,a,n,s,c,l,d,p,u,h)}]).factory("httpRequestWorker",["promiseFactory","telemetryService","localizationService","errorService","$timeout","$window","featureSwitchService","embedModeService","checkSigninService","clusterUriRetriever","httpUriRedirector","urlInterceptor","userActivityContextService","logger",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h){return powerbi.common.createHttpRequestWorker(e,t,i,o,r,a,n,s,null,c,l,d,p,u,h)}]).factory("trustedVisual",["promiseFactory","featureSwitchService","localizationService","resourceLoader","visualSandbox","visualConsent","approvedResourceService","$rootScope","errorService","modalDialogService","userSettingsService","telemetryService",function(e,t,i,o,r,a,n,s,c,l,d,p){var u=powerbi.visualHost.createTrustedVisualService(e,p,a,n,r,o);return u.registerTrustedVisual([powerbi.visualHost.EsriVisual],powerbi.helpers.EsriVisualHelper.createRegisterTrustedVisualOptions(e,s,c,l,t,i,d,p,u,a)),u.registerTrustedVisual([powerbi.visualHost.VisioVisual,powerbi.visualHost.VisioDFVisual],powerbi.explore.utils.VisioVisualHelper.createVisioVisualRegisterOptions()),u.registerTrustedVisual([powerbi.visualHost.PowerAppsVisual],powerbi.explore.utils.PowerAppsVisualHelper.createPowerAppsVisualRegisterOptions()),u.registerTrustedVisual([powerbi.visualHost.GlobeMapVisual],powerbi.explore.utils.GlobeMapVisualHelper.createGlobeMapVisualRegisterOptions()),u}]).factory("shellCapabilities",["asyncFeatureSwitchService","userInfo","promiseFactory",function(e,t,i){return services.createShellCapabilities(e,t,i)}]).run(["lazyScopedFactories",function(e){e.customVisualsStore={source:{javascript:"ExploreUIShell/services/customVisualsStoreService"},ng:["modalDialogService","promiseFactory"],scoped:["eventBridge"],fn:function(e,t,i,o){return e.create(o,t,i)}},e.customVisualsStoreMetadata={source:{javascript:"ExploreUIShell/services/customVisualsStoreMetadataService"},ng:["telemetryService"],scoped:[],fn:function(e,t){return e.create(t)}}}]).run(["$http","$rootScope","promiseFactory","telemetryService","errorService","activeGroupId","featureSwitchService","checkSigninService","clusterUriRetriever","httpUriRedirector","urlInterceptor","expiredTokenSink","$window","$timeout","logger","embedModeService","httpRequestWorker",function(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m){powerbi.common.localize=common.createLocalizationService(o,i),powerbi.common.httpService=new common.HttpService(e,i,o,a,m),powerbi.common.featureSwitchService=n,powerbi.notifyDashboardContainerReady=function(e){t.$emit(powerbi.dataServices.constants.initialDashboardContainerReadyEventName,e)},powerbi.visuals&&powerbi.explore.services.VisualHostServices.initialize(powerbi.common.localize)}]).run(["groupService",function(e){}]).run(["licenseEnforcementService",function(e){}]).run(["printService",function(e){}]).run(["pageVisibilityService",function(e){}]).run(["dynamicMessagingData",function(e){}]).run(["scopedProvider",function(e){e.register("exportData",{services:["promiseFactory","notificationToast","localizationService","conceptualSchemaProxy","featureSwitchService","visualPlugin","displayNameService","aggrOps","fileSaver"],scopedServices:["exportVisualData","filterRestatement","lazyScopedSync","visualPluginOps"],fn:function(e,t,i,o,r,a,n,s,c,l,d,p,u){return powerbi.createExportDataService(e,t,i,o,a,u,l,r,n,s,d,c,p)}})}]);var powerbi;!(function(e){function t(t,i){void 0===i&&(i=[]);var o="powerbi.controllers."+t;i.push(e.controllers[t]),angular.module("powerbi.controllers").controller(o,i)}function i(e,t){var i=_.camelCase(t);return e.get(i)}function o(t){var i=[{name:"AppActionMenu",blockType:2,consumerHostFlags:8},{name:"AppArtifactsList",blockType:2,consumerHostFlags:8},{name:"AppChannelHeader",blockType:2,consumerHostFlags:8},{name:"AppContainer",blockType:2,consumerHostFlags:8},{name:"AppLogo",blockType:2,consumerHostFlags:8},{name:"AppPlaceholder",blockType:2,consumerHostFlags:8},{name:"AppsContainer",blockType:2,consumerHostFlags:8},{name:"AuthoringDropDownMenu",blockType:2,consumerHostFlags:8},{name:"BackgroundImage",dependencies:["localizationService"],blockType:1,consumerHostFlags:232},{name:"Breadcrumbs",blockType:2,consumerHostFlags:8},{name:"CollapsiblePane",blockType:1,consumerHostFlags:232},{name:"CompositeTile",blockType:1,consumerHostFlags:232},{name:"ContentListContainerV2",blockType:2,consumerHostFlags:8},{name:"ContentListGallery",blockType:2,consumerHostFlags:8},{name:"ContentProviderSplash",dependencies:["telemetryService","navigation"],blockType:1,consumerHostFlags:8},{name:"ContentDatasetActions",blockType:2,consumerHostFlags:8},{name:"ContentTile",blockType:2,consumerHostFlags:8},{name:"ContentRow",blockType:2,consumerHostFlags:8},{name:"ContentHeader",blockType:2,consumerHostFlags:8},{name:"ContentTileContainer",blockType:2,consumerHostFlags:8},{name:"ContentTileOptionsMenu",blockType:2,consumerHostFlags:8},{name:"ContextMenu",dependencies:["rtl","windowMetrics"],blockType:1,consumerHostFlags:232},{name:"Dashboard",dependencies:["telemetryService","gridLayout","userActivityContextService","appService","packageService","$timeout","groupService","dashboardLoadingProgressTracking","modelService","permissionService","usageMetricsReport","asyncFeatureSwitchService"],blockType:1,consumerHostFlags:232},{name:"DashboardContainer",blockType:1,consumerHostFlags:232},{name:"DashboardNavigationPaneListItem",blockType:1,consumerHostFlags:8},{name:"DashboardPrinter",dependencies:["$rootScope","$compile","featureSwitchService","localizationService"],blockType:1,consumerHostFlags:72},{name:"DashboardTile",blockType:1,consumerHostFlags:232},{name:"DashboardTileOpenOptions",blockType:1,consumerHostFlags:72},{name:"DashboardTileOptionsMenu",blockType:1,consumerHostFlags:72},{name:"ClassificationLabel",blockType:2,consumerHostFlags:72},{name:"DatasetIconContainer",blockType:2,consumerHostFlags:8},{name:"DatasetNavigationPaneListItem",blockType:1,consumerHostFlags:8},{name:"DevToolsView",blockType:1,consumerHostFlags:8},{name:"ErrorPlaceholder",blockType:2,consumerHostFlags:72},{name:"ExcelUploadFormat",blockType:1,consumerHostFlags:8},{name:"ExplorationContainer",blockType:1,consumerHostFlags:330},{name:"ExploreCanvasPrinter",dependencies:["$rootScope","$compile","featureSwitchService","localizationService"],blockType:1,consumerHostFlags:8},{name:"ExportDataDialog",blockType:2,consumerHostFlags:330},{name:"FavoritesContainer",blockType:2,consumerHostFlags:8},{name:"FullScreenControls",dependencies:["fullScreen","navigation"],blockType:1,consumerHostFlags:72},{name:"FlyoutToggle",dependencies:["$window"],blockType:1,consumerHostFlags:8},{name:"GroupActions",blockType:2,consumerHostFlags:8},{name:"GroupIcon",blockType:2,consumerHostFlags:72},{name:"GroupList",blockType:2,consumerHostFlags:8},{name:"GroupNavigationPaneListItem",blockType:1,consumerHostFlags:8},{name:"GroupSwitcher",blockType:2,consumerHostFlags:8},{name:"GroupSwitcherV2",blockType:2,consumerHostFlags:8},{name:"HistoryDialog",blockType:1,consumerHostFlags:8},{name:"IframeTile",blockType:2,consumerHostFlags:232},{name:"ImageTile",blockType:1,consumerHostFlags:232},{name:"InFocus",dependencies:["promiseFactory"],blockType:1,consumerHostFlags:232},{name:"Insights",blockType:1,consumerHostFlags:72},{name:"InsufficientLicenseBar",blockType:2,consumerHostFlags:8},{name:"IntroduceAppBar",blockType:2,consumerHostFlags:8},{name:"Landing",blockType:2,consumerHostFlags:8},{name:"LandingContainer",blockType:1,consumerHostFlags:72},{name:"LoadNotificationDialog",blockType:1,consumerHostFlags:8},{name:"LocalFileBrowser",dependencies:["localizationService","errorService","featureSwitchService","$timeout"],blockType:1,consumerHostFlags:8},{name:"MakeACopyDialog",blockType:2,consumerHostFlags:8},{name:"ManageEmbedView",blockType:1,consumerHostFlags:8},{name:"ManageStorageView",blockType:1,consumerHostFlags:8},{name:"MarketplaceHost",blockType:2,consumerHostFlags:8},{name:"ModelTile",blockType:1,consumerHostFlags:232},{name:"NavigationBar",blockType:1,consumerHostFlags:8},{name:"NavigationPaneV2",blockType:2,consumerHostFlags:8},{name:"NavPaneFlyoutButton",blockType:2,consumerHostFlags:8},{name:"NpsHost",blockType:1,consumerHostFlags:8},{name:"O365ApplicationLauncher",blockType:1,consumerHostFlags:8},{name:"OnLoad",blockType:1,consumerHostFlags:232},{name:"PbiDataLoaderSpinner",dependencies:["localizationService","$timeout"],blockType:1,consumerHostFlags:72},{name:"PinTileDialog",dependencies:["$timeout"],blockType:1,consumerHostFlags:8},{name:"PopupNotificationDialog",blockType:2,consumerHostFlags:8},{name:"PrintableImage",blockType:2,consumerHostFlags:232},{name:"ProviderTile",blockType:1,consumerHostFlags:8},{name:"PublishTenantContentPackView",blockType:1,consumerHostFlags:8},{name:"QnaContainer",blockType:1,consumerHostFlags:72},{name:"QrCodeDialog",blockType:1,consumerHostFlags:8},{name:"QrCodeProgressDialog",blockType:1,consumerHostFlags:8},{name:"QuickAccessPane",dependencies:[],blockType:2,consumerHostFlags:8},{name:"RealTimeTile",blockType:2,consumerHostFlags:232},{name:"RecentlyViewedContainer",blockType:2,consumerHostFlags:8},{name:"ReportNavigationPaneListItem",blockType:1,consumerHostFlags:8},{name:"ReportTile",blockType:1,consumerHostFlags:232},{name:"SelectButton",blockType:2,consumerHostFlags:8},{name:"SelectArtifactFilter",blockType:2,consumerHostFlags:8},{name:"SelectTileSort",blockType:2,consumerHostFlags:8},{name:"SettingsDashboards",blockType:1,consumerHostFlags:8},{name:"SettingsDatasetFeaturedQuestions",blockType:1,consumerHostFlags:8},{name:"SettingsGeneral",blockType:1,consumerHostFlags:8},{name:"SettingsViewer",blockType:1,consumerHostFlags:8},{name:"SharedWithMeContainer",blockType:2,consumerHostFlags:8},{name:"SharePointUrlInput",blockType:1,consumerHostFlags:8},{name:"SharePointUrlModal",
blockType:1,consumerHostFlags:8},{name:"SharedByColumn",blockType:2,consumerHostFlags:8},{name:"SsrsTile",blockType:1,consumerHostFlags:232},{name:"TaskPaneSlider",blockType:1,consumerHostFlags:72},{name:"Tile",blockType:1,consumerHostFlags:232},{name:"TileOptionsMenu",blockType:2,consumerHostFlags:8},{name:"UsageBar",blockType:1,consumerHostFlags:8},{name:"UsageBarMenuItem",dependencies:["quota","modelService","workbookService","groupService","featureSwitchService"],blockType:1,consumerHostFlags:8},{name:"UserGroupHeader",blockType:1,consumerHostFlags:8},{name:"UserInfoContainer",blockType:1,consumerHostFlags:232},{name:"UserNotifications",blockType:2,consumerHostFlags:8},{name:"ViewTenantContentPackView",blockType:1,consumerHostFlags:8},{name:"WarningBar",blockType:1,consumerHostFlags:232},{name:"WaterMarkMessage",blockType:1,consumerHostFlags:72},{name:"WorkbookAppBar",blockType:1,consumerHostFlags:72},{name:"WorkbookContainer",blockType:1,consumerHostFlags:72},{name:"WorkbookContainer",blockType:1,consumerHostFlags:72},{name:"WorkbookDiscoverabilityToast",blockType:1,consumerHostFlags:72},{name:"WorkbookNavigationPaneListItem",blockType:1,consumerHostFlags:8},{name:"WorkbookNavigationPaneListItem",blockType:1,consumerHostFlags:8},{name:"WorkbookTile",dependencies:["networkAvailability","localizationService"],blockType:1,consumerHostFlags:232},{name:"WorkspacesContainer",dependencies:[],blockType:2,consumerHostFlags:8}];e.common.registerBuildingBlocksForHost(t,i,{componentsTarget:"powerbi.components",componentsMap:e.components,directivesTarget:"powerbi.directives",directivesMap:e.directives,filtersTarget:"powerbi.filters"})}e.registerController=t,e.getService=i,e.registerBuildingBlocksForHost=o})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,o,r,a,n,c,l){return new s(e,t,i,o,r,a,n,c,l)}var o,r=jsCommon.EnumExtensions,a=e.common.contracts.Permissions,n=e.common.contracts.RealTimeMode;!(function(e){e[e.APIPush=1]="APIPush",e[e.PubNub=2]="PubNub",e[e.Link=3]="Link"})(o=t.StreamingDatasetOptionType||(t.StreamingDatasetOptionType={})),t.createDatasetsMenuFactory=i;var s=(function(){function t(e,t,i,o,r,a,n,s,c){this.analyzeInExcel=e,this.appService=t,this.featureSwitchService=i,this.groupService=o,this.insightsService=r,this.localizationService=a,this.ownership=n,this.permissionService=s,this.usageMetricsReport=c,this.streamingDatasetActions={}}return t.prototype.getStreamingDatasetOptions=function(){var t=[{displayName:this.localizationService.get("StreamingDataset_API"),type:o.APIPush,cssClass:"real-time-push-api"},{displayName:e.constants.streamingDatasetModelPubNub,type:o.PubNub,cssClass:"real-time-pubnub"},{displayName:this.localizationService.get("StreamingDataset_ASA"),type:o.Link,cssClass:"real-time-asa",link:"https://go.microsoft.com/fwlink/?LinkID=808648"}];return t},t.prototype.getStreamingDatasetMenuItems=function(e){if(r.hasFlag(e.getPermissions(),a.All)){if(this.streamingDatasetActions[e.realTimeMode])return this.streamingDatasetActions[e.realTimeMode];var t=[];return e.realTimeMode===n.PersistAndCache&&t.push({text:this.localizationService.get("DashboardContextMenu_CreateReport"),action:1,iconClass:"pbi-glyph-create-report"}),e.realTimeMode!==n.PubNubCacheOnly&&t.push({text:this.localizationService.get("StreamingDatasetModel_APIInfo"),action:14,iconClass:"pbi-glyph-info"}),t.push({text:this.localizationService.get("StreamingDatasetModel_Edit"),action:15,iconClass:"pbi-glyph-edit"}),this.addDeleteToMenuActions(t,!0),this.streamingDatasetActions[e.realTimeMode]=t}return[]},t.prototype.getDatasetMenuItems=function(e,t,i){void 0===i&&(i={});var o=[],n=e.contract,s=!1,c=this.permissionService.getModelEffectivePermissions(e.contract),l=this.usageMetricsReport.modelOriginatedFromUsageMetricsContentPack(n);if(r.hasFlag(c,a.CopyOnWrite)){var d=this.appService.getAppInstance(e.packageId);null==d&&(o.push({text:this.localizationService.get("DatasetContextMenu_Personalize"),action:9}),i.excludeDelete||this.addDeleteToMenuActions(o),s=!0)}else this.ownership.permissionsArePersonalized(c,t)?i.excludeDelete||this.addDeleteToMenuActions(o):r.hasFlag(c,a.All)&&(l||o.push({text:this.localizationService.get("DatasetContextMenu_DatasetSettings"),action:10}),o.push({text:this.localizationService.get("DatasetContextMenu_Rename"),action:4}),i.excludeDelete||this.addDeleteToMenuActions(o),i.excludeRefresh||(n.onPremModelConnectionString||n.directQueryMode||o.push({text:this.localizationService.get("DatasetContextMenu_ManageRefresh"),action:6}),o.push({text:this.localizationService.get("DatasetContextMenu_RefreshNow"),action:5})));if(i.excludeRefresh||o.push({text:this.localizationService.get("DashboardContextMenu_RefreshInfo"),action:13}),this.analyzeInExcel.isAnalyzeInExcelSupported(this.featureSwitchService,e.getPermissions())&&o.push({text:this.localizationService.get("DatasetContextMenu_AnalyzeInExcel"),action:8}),s||i.excludeCreate||o.push({text:this.localizationService.get("DashboardContextMenu_CreateReport"),action:1,iconClass:"pbi-glyph-create-report"}),!n.insightsSupported||l||(e.getPermissions()&a.Read)!==a.Read&&!this.ownership.permissionsArePersonalized(e.getPermissions(),t)||o.push(this.findInsightItem(n)),r.hasFlag(c,a.All)&&(6===n.contentProviderId||7===n.contentProviderId)&&!n.onPremModelConnectionString){var p=this.groupService.activeGroup;(p.isMyWorkspace||p.contract.isOwner||!p.contract.isReadOnly)&&o.push({text:this.localizationService.get("DatasetContextMenu_GranularSecurity"),action:3})}return this.canDownloadPbix(e)&&o.push({text:this.localizationService.get("DatasetContextMenu_DownloadDataset"),action:17}),o},t.prototype.canDownloadPbix=function(t){return t.contentProviderId===e.common.constants.pbiDesktopContentProviderId&&_.isEmpty(t.contract.onPremModelConnectionString)&&r.hasFlag(t.getPermissions(),a.All)&&this.featureSwitchService.featureSwitches.datasetDownloadPbix},t.prototype.findInsightItem=function(e){var t=this.insightsService.getInsightsStatus(e);switch(t){case 2:return{text:this.localizationService.get("DatasetContextMenu_ViewInsights"),action:12};case 1:return{text:this.localizationService.get("DatasetContextMenu_GettingInsights"),action:11};default:return{text:this.localizationService.get("GetQuickInsights"),action:2}}},t.prototype.addDeleteToMenuActions=function(e,t){void 0===t&&(t=!1),t?e.push({text:this.localizationService.get("StreamingDatasetModel_Delete"),action:16,iconClass:"pbi-glyph-delete"}):e.push({text:this.localizationService.get("DatasetContextMenu_Delete"),action:7})},t})()})(i=t.factory||(t.factory={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i;!(function(t){function i(t,i,o,r){return r=r||0,{enabled:!0,isExpanded:!0,emailNotificationEnabled:!0,frequency:0,isNew:!0,measureName:i,operator:0,tileName:t,title:o,thresholdValue:r.toString(),alertFailureState:e.AlertFailureState.None}}t.createEmptyAlert=i})(i=t.AlertsModelFactory||(t.AlertsModelFactory={}))})(t=e.factory||(e.factory={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e[e.DashboardFormat=0]="DashboardFormat",e[e.ReportFormat=1]="ReportFormat"})(t=e.TileDialogPreviewFormats||(e.TileDialogPreviewFormats={}));var i;!(function(e){e[e.Report=0]="Report"})(i=e.ExternalConnectionContainerType||(e.ExternalConnectionContainerType={}));var o;!(function(e){e[e.Model=0]="Model"})(o=e.ExternalConnectionType||(e.ExternalConnectionType={}));var r;!(function(e){e[e.Dashboard=1]="Dashboard",e[e.Report=2]="Report",e[e.Workbook=3]="Workbook"})(r=e.LandingView||(e.LandingView={}));var a;!(function(e){e[e.DashboardViewer=0]="DashboardViewer",e[e.QnaVisualization=1]="QnaVisualization"})(a=e.DashboardContainerViewMode||(e.DashboardContainerViewMode={}));var n;!(function(e){e[e.Popup=0]="Popup",e[e.NotificationPane=1]="NotificationPane",e[e.NotificationBar=2]="NotificationBar"})(n=e.DynamicMessageNotificationType||(e.DynamicMessageNotificationType={}));var s;!(function(e){e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High"})(s=e.DynamicMessageNotificationLevel||(e.DynamicMessageNotificationLevel={}));var c;!(function(e){e[e.OpenLink=0]="OpenLink"})(c=e.DynamicMessageActionType||(e.DynamicMessageActionType={}))})(t=e.contracts||(e.contracts={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return[{id:0,iconClass:"pbi-glyph-barchart"},{id:1,iconClass:"pbi-glyph-paintbrush"}]}function i(e){return[{type:0,text:e.get("Realtime_VisualizationDesign")},{type:1,text:e.get("TileEditorPane_TileDetailsTabHeader")}]}function o(e){var t=e.localizationService;return[{iconClass:"pbi-glyph-securityalert",show:e.showWebContent,itemClass:"webContentIcon",tooltip:function(){return t.get("WebContentWarning_Widget")},action:2,hasBadge:!1},{iconClass:"pbi-glyph-warning",show:e.showWarning,itemClass:"warningIcon",tooltip:e.warningToolTipSetter,action:1,hasBadge:!1},{iconClass:"pbi-glyph-bell",show:e.showNotifications,itemClass:"notifications",tooltip:function(){return t.get("Alerts_NotificationTooltip")},action:0,badgeValueSetter:e.badgeTextSetter,hasBadge:!0},{iconClass:"pbi-glyph-realtime",show:e.showRealTime,itemClass:"",tooltip:function(){return t.get("Realtime_IconHoverText")},hasBadge:!1}]}e.realTimeConfigTabs=t,e.getRealTimeTileEditHeaderTabs=i,e.getDashboardTileIcons=o})(t=e.TileOptionsFactory||(e.TileOptionsFactory={}))})(t=e.factory||(e.factory={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e[e.AllContent=0]="AllContent",e[e.MyContent=1]="MyContent",e[e.SharedWithMe=2]="SharedWithMe"})(t=e.OwnershipFilterMenuFilter||(e.OwnershipFilterMenuFilter={}));var i=(function(){function e(){}return e})();e.NavigationPaneModel=i})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/tiles/providerTile.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(e.controllers.ProviderTileController)}return t})();t.ProviderTile=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o){return new r(e,t,i,o)}var o;!(function(e){e[e.None=0]="None",e[e.FitToContent=1]="FitToContent",e[e.FitToWidth=2]="FitToWidth"})(o=t.FullScreenFitStyle||(t.FullScreenFitStyle={})),t.createFullScreenService=i;var r=(function(){function t(t,i,r,a){var n=this;this.$rootScope=t,this.navigation=i,this.changeListeners=[],a&&a.addNotificationFilter&&a.addNotificationFilter((function(e){return!n.fullScreenMode})),this.document=r.get(0);for(var s=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange","mozfullscreenchange"],c=0,l=s;c<l.length;c++){var d=l[c];this.document.addEventListener(d,(function(e){return n.updateFullScreenFromBrowser()}))}this._fullScreenModeEnabled=!1,this._enterFullScreenSupported=this.fullScreenSupportedViews()||this.navigation.inReportEmbedView(),this.fitStyle=o.None,this.$rootScope.$on(e.common.constants.navigation.stateChangeSuccess,(function(){n._enterFullScreenSupported=n.fullScreenSupportedViews()})),this.forceFullScreen()&&this.enterFullScreen()}return t.prototype.subscribe=function(e){this.changeListeners.push(e)},t.prototype.unsubscribe=function(e){_.pull(this.changeListeners,e)},t.prototype.enterFullScreen=function(){this.setFullScreenMode(!0),this.fitStyle=o.None},t.prototype.exitFullScreen=function(){this.setFullScreenMode(!1),this.fitStyle=o.None},t.prototype.toggleFullScreen=function(){this.fullScreenMode?this.exitFullScreen():this.enterFullScreen()},t.prototype.fullScreenPreviousPage=function(){this.$rootScope.$emit(e.explore.constants.explorationPreviousPageEvent)},t.prototype.fullScreenNextPage=function(){this.$rootScope.$emit(e.explore.constants.explorationNextPageEvent)},Object.defineProperty(t.prototype,"enterFullScreenSupported",{get:function(){return this._enterFullScreenSupported},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullScreenMode",{get:function(){return this._fullScreenModeEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fitStyle",{get:function(){return this._fitStyle},set:function(e){this._fitStyle!==e&&(this._fitStyle=e,this.notifyListeners((function(e){return e.onFitStyleChanged()})))},enumerable:!0,configurable:!0}),t.prototype.notifyListeners=function(e){var t=this.changeListeners;if(!_.isEmpty(t)&&e)for(var i=t.length-1;i>=0;i--)e(t[i])},t.prototype.fullScreenSupportedViews=function(){return this.navigation.inDashboardDetailView()||this.navigation.inReportDetailView()||this.navigation.inDatasetDetailView()||this.navigation.inInFocusView()||this.navigation.inInFocusInsightsView()},t.prototype.forceFullScreen=function(){return null!=this.navigation.locationService&&null!=this.navigation.locationService.search().chromeless},t.prototype.updateFullScreenFromBrowser=function(){var e=this,t=this.document,i=null!=(t.fullScreenElement||t.msFullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement);i!==this.fullScreenMode&&this.$rootScope.$applyAsync((function(){return e.toggleFullScreen()}))},t.prototype.setFullScreenMode=function(e){var i=$("html"),o=$("body");if(!(i.length<=0||o.length<=0)){if(e){if(!this._enterFullScreenSupported&&!this.forceFullScreen())return;o.addClass(t.fullScreenCSSClass);var r=i.get(0);if(r){var a=r.requestFullscreen||r.msRequestFullscreen||r.webkitRequestFullscreen||r.mozRequestFullScreen;a&&a.call(r)}}else{o.removeClass(t.fullScreenCSSClass),$(".enterFullScreenBtn").blur();var n=this.document,s=n.exitFullscreen||n.msExitFullscreen||n.webkitExitFullscreen||n.mozCancelFullScreen;s&&s.call(n)}this._fullScreenModeEnabled=e,this.notifyListeners((function(e){return e.onFullScreenModeChanged()}))}},t.fullScreenCSSClass="fullScreen",t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.contracts.TileType,o=(function(){function t(t,i,o,r,a,n,s){var c=this;this.telemetryService=t,this.dashboardLoadingProgressTrackingService=r,this.modelService=a,this.usageMetricsReport=n,this.scope=s,this.hasResolved=!1,this.unsubcribeTileRepeatFinishedEvent=s.$on(e.common.constants.dashboardTileRepeatFinishedEvent,(function(){return c.onDashboardTileRepeatFinishedEvent()})),this.dashboardLoadingProgressCallback=function(e){c.onDashboardLoadingCompleted(e)},this.dashboardLoadingProgressTrackingService.registerLoadingProgressCallback(this.dashboardLoadingProgressCallback)}return t.prototype.recordOpenDashboardEvent=function(t,i,o,r,a){if(t&&!this.openDashboardTelemetryEvent&&!this.hasResolved){this.dashboardModel=t;var n=t.getPermissions();this.openDashboardTelemetryEvent=this.telemetryService.startActivity(this.scope,e.telemetry.DashboardOpenDashboard,!1,this.dashboardHasOnPremModel(t,this.modelService.models),0,0,0,0,0,0,0,0,0,0,this.getDashboardOpenSource(),o,r,n,0,"{}",a,t.contract&&t.contract.originalDashboardObjectId,i,t.objectId),t.isLoaded&&_.isEmpty(t.tiles)&&this.resolveOpenDashboardTelemetry(t,!1)}},t.prototype.getDashboardOpenSource=function(){var t=jsCommon.QueryStringUtil.getQueryStringValue("openDashboardSource");return"email"===t?e.telemetry.OpenDashboardSource.EmailSubscription:e.telemetry.OpenDashboardSource.Normal},t.prototype.onDashboardTileRepeatFinishedEvent=function(){var t=this.dashboardModel;if(this.openDashboardTelemetryEvent){for(var i=0,o=0,r=t.tiles;o<r.length;o++){var a=r[o];a.shouldBeIncludedInTelemetryMeasurement&&i++}this.loadDashboardTileTelemetryEvent=this.telemetryService.startChildEvent(this.openDashboardTelemetryEvent.event,e.telemetry.DashboardLoadDashboardTileVisual,i)}},t.prototype.onDashboardLoadingCompleted=function(t){for(var i=0,o=t.timedOutTiles;i<o.length;i++){var r=o[i],a=r.composite&&r.composite.visual&&r.composite.visual.type;this.telemetryService.logEvent(e.telemetry.DashboardLoadTileVisualTimedOut,a)}this.resolveOpenDashboardTelemetry(t.model,t.isCancelled)},t.prototype.resolveOpenDashboardTelemetry=function(e,t){if(this.openDashboardTelemetryEvent){var i=this.countTileTypes(e);if(this.openDashboardTelemetryEvent.event){var o=this.openDashboardTelemetryEvent.event.info;o&&(o.hasResourcePackages=i.hasResourcePackages,o.compositeTilesCount=i.composite,o.iframeTilesCount=i.iframe,o.imageTilesCount=i.image,o.modelTilesCount=i.model,o.ssrsTilesCount=i.ssrs,o.workbookTilesCount=i.workbook,o.reportTilesCount=i.report,o.workbookTileNoImage=i.workbookNoImage,o.otherTileTypes=i.unknown,o.realTimeTilesCount=i.realTime,o.usageMetricsTilesCount=i.usageMetrics,o.CompoundTileTypesAndCounts=JSON.stringify(i.CompoundTileTypesAndCounts),t&&(o.isCancelled=!0))}this.loadDashboardTileTelemetryEvent&&this.loadDashboardTileTelemetryEvent.resolve(),this.openDashboardTelemetryEvent.resolve(),this.openDashboardTelemetryEvent=null,this.loadDashboardTileTelemetryEvent=null,this.dashboardLoadingProgressTrackingService.unregisterLoadingProgressCallback(this.dashboardLoadingProgressCallback),this.hasResolved=!0,this.unsubcribeTileRepeatFinishedEvent()}},t.prototype.countTileTypes=function(e){var t={composite:0,iframe:0,image:0,model:0,realTime:0,ssrs:0,workbook:0,workbookNoImage:0,report:0,unknown:0,hasResourcePackages:!1,usageMetrics:0,CompoundTileTypesAndCounts:{}};if(_.isEmpty(e.tiles))return t;for(var i=0,o=e.tiles;i<o.length;i++){var r=o[i];this.incTileTypeCount(r,t),!t.hasResourcePackages&&r&&r.contract&&!_.isEmpty(r.contract.resourcePackageIds)&&(t.hasResourcePackages=!0)}return t},t.prototype.incTileTypeCount=function(e,t){switch(e.type){case i.composite:t.composite++,this.usageMetricsReport.reportOriginatedFromUsageMetricsContentPack(e.contractsReport)&&t.usageMetrics++;var o=e.config&&e.config.visual&&e.config.visual.visual?e.config.visual.visual:"undefined";t.CompoundTileTypesAndCounts[o]||(t.CompoundTileTypesAndCounts[o]=0),t.CompoundTileTypesAndCounts[o]++;break;case i.iframe:t.iframe++;break;case i.image:t.image++;break;case i.realTime:t.realTime++;break;case i.model:t.model++;break;case i.ssrs:t.ssrs++;break;case i.workbook:e.workbook?e.workbook.hasImages()&&t.workbook++:t.workbookNoImage++;break;case i.report:t.report++,this.usageMetricsReport.reportOriginatedFromUsageMetricsContentPack(e.contractsReport)&&t.usageMetrics++;break;default:t.unknown++}},t.prototype.dashboardHasOnPremModel=function(t,i){var o=t.contract.modelIds;if(_.isEmpty(o))return!1;for(var r={},a=0,n=i;a<n.length;a++){var s=n[a];if(s.vsName===e.common.constants.onPremiseVSName){var c=s.id;null!=c&&(r[c]=c)}}for(var l=0,d=o;l<d.length;l++){var p=d[l];if(r[p])return!0}return!1},t})();t.DashboardTelemetryHelper=o})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.FreezeUtility,i=(function(){function e(e,t,i){void 0===t&&(t=!1),this.columnName=e,this.reverse=t,this.toAngularFilter=i,this.toAngularFilter=i||this.toAngularFilterDefault}return e.prototype.toAngularFilterDefault=function(){var e=_.camelCase(this.columnName);return this.reverse?"-"+e:"+"+e},e})();e.SortPredicate=i;var o;!(function(e){e.TitleAlphabeticalPredicate=new i("displayName"),e.TitleReverseAlphabeticalPredicate=new i("displayName",(!0)),e.OwnerAlphabeticalPredicate=new i("ownerFullname"),e.OwnerReverseAlphabeticalPredicate=new i("ownerFullname",(!0)),e.LastAccessDatePredicate=new i("lastAccess"),e.LastAccessReverseDatePredicate=new i("lastAccess",(!0)),e.SharedTimePredicate=new i("sharedTime"),e.SharedReverseTimePredicate=new i("sharedTime",(!0)),e.OwnerInfoAlphabeticalPredicate=new i("ownerInfo"),e.OwnerInfoReverseAlphabeticalPredicate=new i("ownerInfo",(!0)),(function(){t.deepFreeze(e.TitleAlphabeticalPredicate),t.deepFreeze(e.TitleReverseAlphabeticalPredicate),t.deepFreeze(e.OwnerAlphabeticalPredicate),t.deepFreeze(e.OwnerReverseAlphabeticalPredicate),t.deepFreeze(e.LastAccessDatePredicate),t.deepFreeze(e.LastAccessReverseDatePredicate),t.deepFreeze(e.SharedTimePredicate),t.deepFreeze(e.SharedReverseTimePredicate),t.deepFreeze(e.OwnerInfoAlphabeticalPredicate),t.deepFreeze(e.OwnerInfoReverseAlphabeticalPredicate)})()})(o=e.ArtifactSortPredicates||(e.ArtifactSortPredicates={}));var r;!(function(e){function t(e,t){switch(t){case 8:return r(e);case 16:return a(e);case 64:return n(e);case 128:return s(e);default:return i(e)}}function i(e){return v(e),l}function r(e){return g(e),d}function a(e){return m(e),p}function n(e){return f(e),u}function s(e){return b(e),h}function c(e,t){var i;switch(e){case o.TitleAlphabeticalPredicate:i=t.get("Sort_Title_Alpabetical_Asc");break;case o.TitleReverseAlphabeticalPredicate:i=t.get("Sort_Title_Alpabetical_Desc");break;case o.OwnerAlphabeticalPredicate:case o.OwnerInfoAlphabeticalPredicate:i=t.get("Sort_Owner_Alpabetical_Asc");break;case o.OwnerReverseAlphabeticalPredicate:case o.OwnerInfoReverseAlphabeticalPredicate:i=t.get("Sort_Owner_Alpabetical_Desc");break;case o.LastAccessDatePredicate:i=t.get("Sort_Last_Access_Date_Asc");break;case o.LastAccessReverseDatePredicate:i=t.get("Sort_Last_Access_Date_Desc");break;case o.SharedTimePredicate:i=t.get("Sort_Shared_Time_Asc");break;case o.SharedReverseTimePredicate:i=t.get("Sort_Shared_Time_Desc")}return{predicate:e,text:i,type:DropDownMenuItemType.Item}}var l,d,p,u,h,v=_.once((function(e){l=[c(o.TitleAlphabeticalPredicate,e),c(o.TitleReverseAlphabeticalPredicate,e),c(o.OwnerAlphabeticalPredicate,e),c(o.OwnerReverseAlphabeticalPredicate,e)],Object.freeze(l)})),g=_.once((function(e){d=[c(o.TitleAlphabeticalPredicate,e),c(o.TitleReverseAlphabeticalPredicate,e)],Object.freeze(d)})),m=_.once((function(e){p=[c(o.LastAccessReverseDatePredicate,e),c(o.TitleAlphabeticalPredicate,e),c(o.TitleReverseAlphabeticalPredicate,e)],Object.freeze(p)})),f=_.once((function(e){u=[c(o.SharedReverseTimePredicate,e),c(o.SharedTimePredicate,e),c(o.TitleAlphabeticalPredicate,e),c(o.TitleReverseAlphabeticalPredicate,e),c(o.OwnerAlphabeticalPredicate,e),c(o.OwnerReverseAlphabeticalPredicate,e)],Object.freeze(u)})),b=_.once((function(e){h=[c(o.TitleAlphabeticalPredicate,e),c(o.TitleReverseAlphabeticalPredicate,e),c(o.OwnerInfoAlphabeticalPredicate,e),c(o.OwnerInfoReverseAlphabeticalPredicate,e)],Object.freeze(h)}));e.createPredicates=t,e.createDefaultPredicates=i})(r=e.SelectTileSortItemsFactory||(e.SelectTileSortItemsFactory={}))})(t=e.factory||(e.factory={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.AppUtils,o=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["appService","contentList","groupService","navigation","packageService"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,o,r,a,n,s;return __generator(this,(function(c){switch(c.label){case 0:return e=this.services.navigation,t=this.services.appService,o=this.services.packageService,e.inAppView()?(r=e.currentAppInstanceId||i.getPackageIDByOrgAppGUID(t,o,e.currentAppGUID),a=this.currentInstalledApp=this.services.appService.getAppInstance(r),n=this,[4,this.services.contentList.canEditContent(a)]):[3,3];case 1:return n.canEditApp=c.sent(),s=this,[4,this.services.contentList.isFavorite(a)];case 2:return s.canFavoriteApp=!c.sent(),[3,4];case 3:this.currentInstalledApp=null,c.label=4;case 4:return[2]}}))}))},t.prototype.toggleFavoriteApp=function(){this.canFavoriteApp?this.services.contentList.addFavorite(this.currentInstalledApp,this.services.groupService.activeGroupObjectId):this.services.contentList.removeFavorite(this.currentInstalledApp),this.canFavoriteApp=!this.canFavoriteApp},t.prototype.editApp=function(){this.canEditApp&&this.services.contentList.editContent(this.currentInstalledApp)},t.prototype.navigateToApp=function(){var e=this.currentInstalledApp,t=i.isOrgApp(e.providerContract)?void 0:e.packageId;this.services.navigation.navigateToApp(e.providerContract.providerKey,t)},t.prototype.getHeaderFontColor=function(){return i.getAppHeaderFontColor(this.currentInstalledApp.iconBackgroundColor)},t})();t.AppActionMenuController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.AppActionMenu={templateUrl:"components/appActionMenu/appActionMenu.html",controller:e.common.createController(e.controllers.AppActionMenuController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.helpers.ContentTileHelper,o=e.common.contracts.ContentTileType,r=e.constants.iconClasses.Dashboard,a=e.constants.iconClasses.Database,n=e.constants.iconClasses.Report,s=e.constants.iconClasses.Workbook,c="App_DashboardList_Title",l="App_ReportList_Title",d="App_WorkbookList_Title",p="App_DatasetList_Title",u=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["appService","contentList","dashboardDataService","groupService","modelService","reportService","workbookService"]}},t.prototype.$onInit=function(){var t=this,i=this.services;this.appInstanceService=e.dataServices.createAppInstanceService(this.viewModel.installedApp,i.dashboardDataService,i.modelService,i.reportService,i.workbookService),this.installedApp=this.appInstanceService.subscribe((function(e,i){return t.onAppUpdated(e,i)})),this.installedApp&&(this.artifacts=[],this.createDashboardsArtifactList(),this.createReportsArtifactList(),this.createWorkbooksArtifactList(),this.createDatasetArtifactList())},t.prototype.$onDestroy=function(){this.appInstanceService&&(this.appInstanceService.unsubscribe(),this.appInstanceService=null)},t.prototype.canOpenTile=function(t){return t.contentTileType!==e.common.contracts.ContentTileType.Dataset},t.prototype.openContentTile=function(e){this.canOpenTile(e)&&i.openContentTile(e,this.services.groupService,this.services.contentList,this.installedApp.providerContract.providerKey,this.installedApp.packageId)},t.prototype.isSectionTile=function(e){return e&&null!=e.title},t.prototype.canShowTile=function(e){return e&&(null==e.title||e.hasItems)},t.prototype.toggle=function(e){e.expanded=!e.expanded,e.expanded?this.addArtifacts(e):this.removeArtifacts(e)},t.prototype.addArtifacts=function(e){var t=_.indexOf(this.artifacts,e)+1;if(!(t<1)){e.title===c?(i=this.artifacts).splice.apply(i,[t,0].concat(_.sortBy(this.installedApp.dashboards,(function(e){return e.displayName})))):e.title===l?(o=this.artifacts).splice.apply(o,[t,0].concat(_.sortBy(this.installedApp.reports,(function(e){return e.displayName})))):e.title===d?(r=this.artifacts).splice.apply(r,[t,0].concat(_.sortBy(this.installedApp.workbooks,(function(e){return e.displayName})))):e.title===p&&(a=this.artifacts).splice.apply(a,[t,0].concat(_.sortBy(this.installedApp.models,(function(e){return e.displayName}))));var i,o,r,a}},t.prototype.removeArtifacts=function(e){var t=_.indexOf(this.artifacts,e);t<0||(e.title===c?_.remove(this.artifacts,(function(e){return e.contentTileType===o.Dashboard})):e.title===l?_.remove(this.artifacts,(function(e){return e.contentTileType===o.Report})):e.title===d?_.remove(this.artifacts,(function(e){return e.contentTileType===o.Workbook})):e.title===p&&_.remove(this.artifacts,(function(e){return e.contentTileType===o.Dataset})))},t.prototype.isNew=function(e){return i.isNew(e,this.services.modelService)},t.prototype.canShowOptionsMenu=function(e){return this.services.contentList.canShowTileOptions(e)},t.prototype.getClassName=function(t){switch(t.contentTileType){case e.common.contracts.ContentTileType.Dashboard:return r;case o.Report:return n;case o.Workbook:return s;case o.Dataset:return a}},t.prototype.isDataClassificationEnabled=function(e){return e.contentTileType===o.Dashboard},t.prototype.createDashboardsArtifactList=function(){this.dashboardSectionTile={title:c,uniqueId:c,expanded:!0,isDataClassificationEnabled:this.viewModel.dataClassificationEnabled,getPermissions:function(){return e.common.contracts.Permissions.None},hasItems:!1},this.artifacts.push(this.dashboardSectionTile);var t=this.installedApp;_.isEmpty(t.dashboards)||(this.dashboardSectionTile.hasItems=!0,(i=this.artifacts).push.apply(i,_.sortBy(t.dashboards,(function(e){return e.displayName}))));var i},t.prototype.createReportsArtifactList=function(){this.reportSectionTile={title:l,uniqueId:l,expanded:!0,isDataClassificationEnabled:!1,getPermissions:function(){return e.common.contracts.Permissions.None},hasItems:!1},this.artifacts.push(this.reportSectionTile);var t=this.installedApp;_.isEmpty(t.reports)||(this.reportSectionTile.hasItems=!0,(i=this.artifacts).push.apply(i,_.sortBy(t.reports,(function(e){return e.displayName}))));var i},t.prototype.createWorkbooksArtifactList=function(){this.workbookSectionTile={title:d,uniqueId:d,expanded:!0,isDataClassificationEnabled:!1,getPermissions:function(){return e.common.contracts.Permissions.None},hasItems:!1},this.artifacts.push(this.workbookSectionTile);var t=this.installedApp;_.isEmpty(t.workbooks)||(this.workbookSectionTile.hasItems=!0,(i=this.artifacts).push.apply(i,_.sortBy(t.workbooks,(function(e){return e.displayName}))));var i},t.prototype.createDatasetArtifactList=function(){this.modelSectionTile={title:p,uniqueId:p,expanded:!1,isDataClassificationEnabled:!1,getPermissions:function(){return e.common.contracts.Permissions.None},hasItems:!1},this.artifacts.push(this.modelSectionTile),_.isEmpty(this.installedApp.models)||(this.modelSectionTile.hasItems=!0)},t.prototype.onAppUpdated=function(e,t){0===t?this.addArtifact(e):1===t&&this.removeArtifact(e)},t.prototype.removeArtifact=function(e){switch(e.contentTileType){case o.Dashboard:this.dashboardSectionTile.hasItems=!_.isEmpty(this.installedApp.dashboards);break;case o.Report:this.reportSectionTile.hasItems=!_.isEmpty(this.installedApp.reports);break;case o.Workbook:this.workbookSectionTile.hasItems=!_.isEmpty(this.installedApp.workbooks);break;case o.Dataset:this.modelSectionTile.hasItems=!_.isEmpty(this.installedApp.models)}_.pull(this.artifacts,e)},t.prototype.addArtifact=function(e){switch(e.contentTileType){case o.Dashboard:if(this.dashboardSectionTile.hasItems=!0,this.dashboardSectionTile.expanded){var t=_.indexOf(this.artifacts,this.dashboardSectionTile)+1,i=_.indexOf(this.artifacts,this.reportSectionTile)-1;this.addArtifactHelper(t,i,e)}break;case o.Report:if(this.reportSectionTile.hasItems=!0,this.reportSectionTile.expanded){var t=_.indexOf(this.artifacts,this.reportSectionTile)+1,i=_.indexOf(this.artifacts,this.workbookSectionTile)-1;this.addArtifactHelper(t,i,e)}break;case o.Workbook:if(this.workbookSectionTile.hasItems=!0,this.workbookSectionTile.expanded){var t=_.indexOf(this.artifacts,this.workbookSectionTile)+1,i=_.indexOf(this.artifacts,this.modelSectionTile)-1;this.addArtifactHelper(t,i,e)}break;case o.Dataset:if(this.modelSectionTile.hasItems=!0,this.modelSectionTile.expanded){var t=_.indexOf(this.artifacts,this.modelSectionTile)+1,i=this.artifacts.length-1;this.addArtifactHelper(t,i,e)}}},t.prototype.addArtifactHelper=function(e,t,i){if(!(e<=0||t<0)){if(e===t+1)return void this.artifacts.splice(e,0,i);var o=this.artifacts.slice(e,t);if(!_.contains(o,i)){var r=_.sortedIndex(o,i,(function(e){return e.displayName}));this.artifacts.splice(e+r,0,i)}}},t})();t.AppArtifactsListController=u})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.AppArtifactsList={templateUrl:"components/appArtifactsList/appArtifactsList.html",bindings:{viewModel:"<"},controller:e.common.createController(e.controllers.AppArtifactsListController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.AppUtils,o=e.common.contracts.ContentTileType,r=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["contentList","groupService","localizationService","navigation"]
}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:return e=this.viewModel,this.reports=e.reportIds,this.dashboards=e.dashboardIds,this.workbooks=e.workbookIds,this.datasets=e.modelIds,this.isInstalledApp=!!e.contentTileType,this.isInstalledApp?(t=this,[4,this.services.contentList.canEditContent(e)]):[3,2];case 1:return t.canEditApp=i.sent(),[3,3];case 2:this.canEditApp=!1,i.label=3;case 3:return[2]}}))}))},t.prototype.getAppTitle=function(){var e=this.viewModel;if(e&&e.displayName)return e.displayName},t.prototype.getHeaderFontColor=function(){var e=this.viewModel;return i.getAppHeaderFontColor(e.iconBackgroundColor)},t.prototype.hasAppLogoImage=function(){return i.hasAppLogoImage(this.viewModel)},t.prototype.getArtifactCountTooltip=function(e){var t,i,r=this.services.localizationService;switch(e){case o.Dashboard:t=this.dashboards.length,i=t>1?"Dashboards_Label":"Dashboard_Label";break;case o.Report:t=this.reports.length,i=t>1?"Reports_Label":"Report_Label";break;case o.Workbook:t=this.workbooks.length,i=t>1?"Workbooks_Label":"Workbook_Label";break;case o.Dataset:t=this.datasets.length,i=t>1?"Datasets_Label":"Dataset_Label";break;default:return}return r.format(i,t.toString())},t.prototype.canFavorite=function(){return this.isInstalledApp&&!this.services.contentList.isFavorite(this.viewModel)},t.prototype.canUnFavorite=function(){return this.isInstalledApp&&this.services.contentList.isFavorite(this.viewModel)},t.prototype.favoriteApp=function(){this.services.contentList.addFavorite(this.viewModel,this.services.groupService.activeGroupObjectId)},t.prototype.unfavoriteApp=function(){this.services.contentList.removeFavorite(this.viewModel)},t.prototype.editApp=function(){var e=this.viewModel;e&&this.isInstalledApp&&this.canEditApp&&this.services.contentList.editContent(e)},t})();t.AppChannelHeaderController=r})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.AppChannelHeader={templateUrl:"components/appChannelHeader/appChannelHeader.html",bindings:{viewModel:"<"},controller:e.common.createController(e.controllers.AppChannelHeaderController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.AppUtils,o=(function(){function t(e,t){this.services=t,this.searchText=""}return t.createOptions=function(){return{additionalServices:["appService","dashboardDataService","dataClassificationService","groupService","modelConverter","modelService","mostRecentlyUsedService","navigation","packageService","promiseFactory","reportService","workbookService"]}},t.prototype.$onInit=function(){var e=this,t=this.services.appService,i=this.services.packageService,o=this.services.groupService;this.services.promiseFactory.all([i.ensurePackagesInitialization(),t.ensureAppsInitialization(),o.groupSwitchPromise()]).then((function(o){_.isEqual(o,[i,t,null])&&e.initHelper()}))},t.prototype.$onDestroy=function(){this.appInstanceService&&(this.appInstanceService.unsubscribe(),this.appInstanceService=null)},t.prototype.initHelper=function(){var t=this,o=this.services.appService,r=this.services.navigation.currentAppGUID,a=this.services.navigation.currentAppInstanceId;a||(a=i.getPackageIDByOrgAppGUID(o,this.services.packageService,r));var n=this.services,s=o.getAppInstance(a);s&&(this.appInstanceService=e.dataServices.createAppInstanceService(s,n.dashboardDataService,n.modelService,n.reportService,n.workbookService),this.installedApp=this.appInstanceService.subscribe(),n.dataClassificationService.isEnabledAsync().then((function(e){t.loadArtifactsLists(e,s)})),this.services.mostRecentlyUsedService.updateMRU(e.models.MRUArtifactType.AppInstance,s.objectId,s.displayName,s.getPermissions(),void 0,void 0,s.packageId))},t.prototype.loadArtifactsLists=function(e,t){this.installedApp;this.artifactList={installedApp:t,dataClassificationEnabled:e}},t.prototype.inAppArtifactsListView=function(){return this.services.navigation.inAppDetailView()},t})();t.AppContainerController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.AppContainer={templateUrl:"components/appContainer/appContainer.html",controller:e.common.createController(e.controllers.AppContainerController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.AppUtils,o=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["clusterUriRetriever"]}},e.prototype.hasAppLogoImage=function(){return i.hasAppLogoImage(this.viewModel)},e.prototype.getAppLogoImageUrlStyle=function(){return i.getAppLogoImageUrlStyle(this.viewModel,this.services.clusterUriRetriever)},e})();t.AppLogoController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.AppLogo={templateUrl:"components/appLogo/appLogo.html",bindings:{viewModel:"<",size:"@"},controller:e.common.createController(e.controllers.AppLogoController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){e.AppPlaceholder={templateUrl:"components/appPlaceholder/appPlaceholder.html"}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.ContentProviderClientCategory,o=e.common.contracts.ContentTileType,r=e.common.contracts.Permissions,a=(function(){function t(e,t){this.services=t,this.searchText=""}return t.createOptions=function(){return{additionalServices:["$window","appService","promiseFactory","groupService","localizationService","navigation","telemetryService","userInfo","featureSwitchService"]}},t.prototype.$onInit=function(){var e=this;this.getAppTile=this.getPlaceHolderTile(),this.providers=[],this.filteredProviders=[],this.initializeWatermark(),this.services.promiseFactory.all([this.services.appService.ensureAppsInitialization(),this.services.groupService.groupSwitchPromise()]).then((function(){return e.loadApplicationInstances()})),this.insufficientLicenseBarConfig={content:this.services.localizationService.get("UpgradeAccount_AppTopBarMessage")},this.listener={onInstanceInstalled:function(){return e.loadApplicationInstances()},onInstanceUninstalled:function(){return e.loadApplicationInstances()},onInstancesReset:function(){return e.loadApplicationInstances()}},this.services.appService.subscribeToInstanceEvents(this.listener)},t.prototype.$onDestroy=function(){this.services.appService.unsubscribeToInstanceEvents(this.listener)},t.prototype.onSearchTextChange=function(){this.isLoaded&&(this.ensureSearchTelemetry(),this.filterProviders())},t.prototype.resolveSearchTelemetry=function(){this.searchTelemetry&&(this.searchTelemetry.resolve(),this.searchTelemetry=null)},t.prototype.hasSufficientLicense=function(){return this.services.userInfo.isPremiumUser},t.prototype.getApps=function(){e.helpers.ContentProviderStoreHelper.navigateToCategoryAndProviderHelper(i.Organizational,e.contentProviderConstants.getAppsInteraction,0,this.services.telemetryService,this.services.navigation,this.services.rootScope,!0)},t.prototype.loadApplicationInstances=function(){this.providers=this.services.appService.appInstances,this.hasApps=!_.isEmpty(this.providers),this.isLoaded=!0,this.filterProviders()},t.prototype.filterProviders=function(){var e=this;if(this.isLoaded){var t=this.searchText.toLocaleLowerCase();this.filteredProviders.length=0,_.extend(this.filteredProviders,_(this.providers).filter((function(i){return e.containsSubstring(i.displayName,t)})).value()),this.updateWatermark()}},t.prototype.updateWatermark=function(){this.showWatermarkConfig=_.isEmpty(this.filteredProviders),this.watermarkConfig=this.searchText?this.emptySearchWatermarkConfig:this.emptyAppsWatermarkConfig},t.prototype.containsSubstring=function(e,t){return!!e&&_.contains(e.toLocaleLowerCase(),t)},t.prototype.ensureSearchTelemetry=function(){this.searchTelemetry||_.isEmpty(this.searchText)||(this.searchTelemetry=this.services.telemetryService.startEvent(e.telemetry.ContentListSearch))},t.prototype.initializeWatermark=function(){var t=this;this.emptyAppsWatermarkConfig={canEdit:!0,mode:!0,imgClass:"empty-apps-img",titleNonShared:this.services.localizationService.get("AppModel_NoAppsWarningTitle"),contentNonShared:this.services.localizationService.get("AppModel_NoAppsWarningContent"),linkText:this.services.localizationService.get("AppModel_NoAppsWarningLinkText"),linkAction:function(){return t.services.$window.open(e.constants.pbiAppsLink,"_blank")},btnLabelKey:"Get_App_Label",btnClick:function(){return t.getApp()}},this.emptySearchWatermarkConfig={canEdit:!0,mode:!0,imgClass:"empty-search-img",linkDescription:this.services.localizationService.get("ContentList_EmptySearchResults_SearchRedirectDescription"),linkText:this.services.localizationService.get("AppModel_SearchInAppSource"),linkAction:function(){return t.getApp()}},this.watermarkConfig=null,this.showWatermarkConfig=!1},t.prototype.getApp=function(){e.helpers.ContentProviderStoreHelper.navigateToCategoryAndProviderHelper(i.Organizational,e.contentProviderConstants.getAppsInteraction,0,this.services.telemetryService,this.services.navigation,this.services.rootScope,!0)},t.prototype.getPlaceHolderTile=function(){return{contentTileType:o.AppPlaceHolder,displayName:this.services.localizationService.get("Get_App_Description"),description:this.services.localizationService.get("Get_App_Tooltip"),getPermissions:function(){return r.None},uniqueId:"AppPlaceholderTile"}},t})();t.AppsContainerController=a})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.AppsContainer={templateUrl:"components/appsContainer/appsContainer.html",controller:e.common.createController(e.controllers.AppsContainerController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i="glyphicon",o="glyph-mini",r="pbi-glyph-tvmonitor",a="pbi-glyph-phone",n=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["dashboardDataService","dropdown","errorService","gridLayout","localizationService","modalDialogService","moduleLoader","navigation","permissionService","promiseFactory","telemetryService"]}},t.prototype.$onInit=function(){this.authorOptionsMenu=this.createAuthoringDashboardMenuItems()},t.prototype.showMenu=function(e,t){var i=this,o=this.services.dropdown,r=function(t,i){t(i),o.hideAll(),e.stopPropagation()},a=t.bind(this)($(e.currentTarget)),n={menuActionSelected:function(e){return r(a.menuActionSelected.bind(i),e)},getMenuActions:function(){return a.menuActions}};o.showMenu(n,a.templateName,a.displayOptions)},t.prototype.getAuthoringMenuProperties=function(e){return{displayOptions:{anchorElement:$(".anchorElementForAuthoring"),blurNeeded:!1,disableAnimation:!0,preferLeft:!0},menuActions:this.getAuthoringMenuActions(),menuActionSelected:this.onAuthoringMenuItemSelected,templateName:"appBarAuthoringMenu.html"}},t.prototype.numberOfNewTiles=function(){var e=this.services.dashboardDataService.activeDashboard,t=_.filter(e.tiles,(function(e){return e.hasLayoutDefinition(1)})).length;return t?e.tiles.length-t:0},t.prototype.getSelectedItem=function(){var e={text:"",iconClass:""},t=_.find(this.authorOptionsMenu,(function(e){return e.checked}));return t||e},t.prototype.shouldShowAuthoringDropDown=function(){var e=this.services.dashboardDataService.activeDashboard;return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&e&&e.canEdit},t.prototype.shouldShowNewTilesCounter=function(){return 0!==this.numberOfNewTiles()},t.prototype.onAuthoringMenuItemSelected=function(t){var i=this;if(null!=t.action&&!t.checked){var o=this.services.dashboardDataService.activeDashboard;switch(t.action){case 5:this.services.telemetryService.logEvent(e.telemetry.MobileAuthoringSwitchedState,"PhoneAuthoringView","WebView"),this.services.navigation.navigateToActiveDashboard(),this.selectMenuItem(t);break;case 6:this.services.telemetryService.logEvent(e.telemetry.MobileAuthoringSwitchedState,"WebView","PhoneAuthoringView"),_.any(o.tiles,(function(e){return e.gridLayouts&&e.hasLayoutDefinition(1)}))?(this.services.navigation.navigateToDashboardMobileAuthoringByGUID(this.services.navigation.currentDashboardGUID),this.selectMenuItem(t)):this.services.moduleLoader.require({javascript:"MobileAuthoring/components/createMobileLayoutDialog/createMobileLayoutDialogBuilder"}).then((function(e){var o=e.createMobileLayoutDialogBuilder(i.services.modalDialogService);o.show().then((function(e){e&&(i.services.navigation.navigateToDashboardMobileAuthoringByGUID(i.services.navigation.currentDashboardGUID),i.selectMenuItem(t))}))}))}}},t.prototype.getAuthoringMenuActions=function(){var e=_.filter(this.authorOptionsMenu,(function(e){return 6===e.action}));return _.isEmpty(e)||(e[0].numberOfNewTiles=this.numberOfNewTiles()),this.authorOptionsMenu},t.prototype.selectMenuItem=function(e){this.uncheckMenuItems(e),e.checked=!0},t.prototype.uncheckMenuItems=function(e){for(var t=0,i=this.authorOptionsMenu;t<i.length;t++){var o=i[t];o.checked=o.action===e.action}},t.prototype.createAuthoringDashboardMenuItems=function(){var e=this.services.localizationService,t=[];return t.push({text:e.get("Dashboard_Authoring_Web"),action:5,type:DropDownMenuItemType.Item,hasGlyph:!0,iconClass:[i,o,r].join(" "),checked:0===this.selectedItem,tooltip:e.get("Dashboard_Authoring_Phone_Tooltip"),numberOfNewTiles:0}),t.push({text:e.get("Dashboard_Authoring_Phone"),action:6,type:DropDownMenuItemType.Item,hasGlyph:!0,iconClass:[i,o,a].join(" "),checked:1===this.selectedItem,tooltip:e.get("Dashboard_Authoring_Web_Tooltip"),numberOfNewTiles:0}),t},t})();t.AuthoringDropDownMenuController=n})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.AuthoringDropDownMenu={templateUrl:"components/authoringDropDownMenu/authoringDropDownMenu.html",bindings:{selectedItem:"<"},controller:e.common.createController(e.controllers.AuthoringDropDownMenuController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){var i=this;this.$scope=e,this.services=t,this.breadcrumbs=[],this.breadcrumbFilter=function(e){return!_.isEmpty(_.trim(e.label))&&null!=e.tooltipConfig&&null!=e.tooltipTemplateConfig},this.setBreadcrumbs=function(){i.breadcrumbs=i.services.breadcrumbFactory.createCurrentBreadcrumbs()||[]},this.setReportBreadreadcrumb=function(e,t){i.services.navigation.inReportView()&&t.guid===i.services.navigation.currentReportGUID&&(i.breadcrumbs=i.services.breadcrumbFactory.createCurrentBreadcrumbs({reportId:t.id,reportGUID:t.guid,reportName:t.displayName,subsituteReportForDataset:!0})||[])}}return t.createOptions=function(){return{additionalServices:["breadcrumbFactory","telemetryService","navigation"]}},t.prototype.$onInit=function(){this.setBreadcrumbs(),this.unregisterStateChange=this.$scope.$on(e.common.constants.navigation.stateChangeSuccess,this.setBreadcrumbs),this.unregisterGroupSwitch=this.services.rootScope.$on(e.constants.groupSwitchedEventName,this.setBreadcrumbs),this.unreigsterReportChange=this.services.rootScope.$on(e.common.constants.currentActiveReportInfoChangedEventName,this.setReportBreadreadcrumb)},t.prototype.$onDestroy=function(){this.unregisterGroupSwitch(),this.unregisterStateChange(),this.unreigsterReportChange()},t.prototype.getTemplate=function(e,t){return t||_.isEmpty(_.trim(e.uiSref))?"components/breadcrumbs/breadcrumbLabel.html":"components/breadcrumbs/breadcrumbLink.html"},t.prototype.logTelemetry=function(t){var i=this.services.navigation.stateService.current.name;this.services.telemetryService.logEvent(e.telemetry.NavigationClickBreadcrumb,i,t)},t})();t.BreadcrumbsController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.Breadcrumbs={templateUrl:"components/breadcrumbs/breadcrumbs.html",controller:e.common.createController(e.controllers.BreadcrumbsController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.ArtifactType,o=e.common.models.CollapsiblePaneExpandedWidth,r=e.common.contracts.Permissions,a=e.common.contracts.PublishOrRefreshStatus,n=(function(){function t(t,i){this.deleteEnabled=!0,this.viewRelatedEnabled=!0,this.scope=t,this.services=i,this.menuSelected=!1,this.services.telemetryService.logEvent(e.telemetry.DashboardManageDatasetsLanding),this.modelDashboards={},this.isOrgApp=!1,this.rowId=_.uniqueId("datasetMenu")}return t.createOptions=function(){return{additionalServices:["datasetActions","datasetsMenuFactory","overlayService","packageService","taskPaneSliderService","telemetryService","usageMetricsReport","permissionService"]}},t.prototype.$onInit=function(){this.activeModelContract=this.viewModel.contract,this.activeModelPackage=this.services.packageService.findPackage(this.activeModelContract.packageId)},t.prototype.onDestroy=function(){this.modalDialogPromise&&this.modalDialogPromise.pending&&this.modalDialogPromise.reject("ContentDatasetActionsController destroyed")},t.prototype.isPackagePublishInProgress=function(){return this.activeModelContract.packagePublishStatus===a.PublishInProgress},t.prototype.canCreateReport=function(){var e=this.viewModel;return this.services.permissionService.isExplorableModel(e)&&(e.getPermissions()&r.CopyOnWrite)!==r.CopyOnWrite},t.prototype.canRefreshNow=function(){var e=this.viewModel;return(!e.contract||null==e.contract.originalModelId)&&(!this.services.usageMetricsReport.modelOriginatedFromUsageMetricsContentPack(e)&&(e.getPermissions()&r.Write)===r.Write)},t.prototype.canScheduleRefresh=function(){var e=this.viewModel;return(!e.contract||null==e.contract.originalModelId)&&(!this.services.usageMetricsReport.modelOriginatedFromUsageMetricsContentPack(e)&&((e.getPermissions()&r.Write)===r.Write&&null!==e.contract.onPremModelConnectionString))},t.prototype.datasetMenuActionSelected=function(e){this.services.datasetActions.handleDatasetAction(e.action,this.viewModel),this.services.overlayService.hideAllDropdowns()},t.prototype.streamingDatasetActionSelected=function(e){this.datasetMenuActionSelected(e)},t.prototype.getStreamingDatasetActions=function(){return this.services.datasetsMenuFactory.getStreamingDatasetMenuItems(this.viewModel)},t.prototype.showOptions=function(){this.menuSelected=!0;var e={excludeDelete:!this.deleteEnabled,excludeCreate:!0,excludeRefresh:!0};this.datasetMenuActions=this.services.datasetsMenuFactory.getDatasetMenuItems(this.viewModel,this.activeModelPackage,e)},t.prototype.createReport=function(){this.services.datasetActions.createReport(this.viewModel)},t.prototype.refreshNow=function(){this.services.datasetActions.refreshNow(this.activeModelContract)},t.prototype.refreshSchedule=function(){this.services.datasetActions.refreshSchedule(this.activeModelContract)},t.prototype.viewRelatedContent=function(){var e={id:this.viewModel.id.toString(),artifactType:i.Model,displayName:this.viewModel.displayName};this.services.taskPaneSliderService.expandPane(17,o.Default,e)},t})();t.ContentDatasetActionsController=n})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ContentDatasetActions={templateUrl:"components/contentDatasetActions/contentDatasetActions.html",controller:e.common.createController(e.controllers.ContentDatasetActionsController),bindings:{deleteEnabled:"<?",viewModel:"=",viewRelatedEnabled:"<?",streamingDataset:"<"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.constants.iconClasses.Apps,o=e.helpers.ContentTileHelper,r=e.common.contracts.ContentTileType,a=e.constants.iconClasses.Dashboard,n=e.constants.iconClasses.Database,s=e.common.utils.DateFormatter,c=e.common.contracts.GroupType,l=e.common.models.Model,d=e.common.helpers.ModelConverterHelper,p=e.common.contracts.PublishOrRefreshStatus,u=e.common.contracts.RealTimeMode,h=e.constants.iconClasses.Report,v=e.constants.iconClasses.Workbook,g=new Date(1),m=(function(){function t(e,t){var i=this;this.services=t,this.inViewport=!1,this.isFavoriting=!1,this.isTileActionsVisible=!1,this.openContentTile=function(){i.viewModel.contentTileType===r.Workspace&&i.openWorkspace(),o.openContentTile(i.viewModel,i.services.groupService,i.services.contentList)},this.unfavoriteContentTile=function(){var e=i.viewModel;i.services.contentList.removeFavorite(e)},this.favoriteContentTile=function(){i.isFavoriting=!0;var e=o.getGroupId(i.viewModel,i.services.groupService);i.services.contentList.addFavorite(i.viewModel,e).finally((function(){i.isFavoriting=!1}))},this.hasGroupIconSet=!1,this.hasUserIconSet=!1,this.hasOwnerPhotoSet=!1,this.hasOwnerPhoto=!1,this.streamingDataset=!1,this.apiAccessType=this.services.localizationService.get("ContentList_Datasets_Dashes"),this.dashboardTitle=this.services.localizationService.get("Favorites_Dashboard")}return t.createOptions=function(){return{additionalServices:["contentList","dataClassificationService","groupService","localizationService","modelService","navigation","ownership","userInfo","dashboardService","reportService","workbookService","appService","licenseEnforcementService"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return 8===this.tabType&&this.initializeDatasetMetadata(this.viewModel),16===this.tabType?(this.isDataClassified=!1,[2]):(e=this,[4,this.isDataClassificationEnabled()]);case 1:return e.isDataClassified=t.sent(),[2]}}))}))},t.prototype.isWorkbookOrReport=function(){return 2===this.tabType||4===this.tabType},t.prototype.getGlyphClass=function(){switch(this.getActualContentType()){case r.Dashboard:return a;case r.Report:return h;case r.Workbook:return v;case r.Dataset:return n;case r.OrgApp:return i}},t.prototype.getTitleTooltip=function(){switch(this.getActualContentType()){case r.Dashboard:return"Artifact_Dashboard";case r.Report:return"Artifact_Report";case r.Workbook:return"Artifact_Workbook";case r.Dataset:return"Artifact_Dataset";case r.OrgApp:return"Artifact_InstalledApp"}},t.prototype.isRefreshRelated=function(){return 4===this.tabType},t.prototype.getTileTypeName=function(){if(this.viewModel&&this.viewModel.contentTileType)return r[this.viewModel.contentTileType].toLowerCase()},t.prototype.getOwnerNameOrMailForDashboard=function(){if(this.viewModel){if(this.viewModel.ownerFullname)return this.viewModel.ownerFullname;if(this.viewModel instanceof e.dataServices.models.Dashboard)return this.viewModel.ownerMail}},t.prototype.onceInViewport=function(){this.inViewport=!0},t.prototype.setUserPhoto=function(){var e=this;this.isMyWorkspace=!0,this.services.userInfo.getUserPhoto().then((function(t){e.hasUserIconSet=!0,e.userIcon=t})),this.groupName=this.getGroupName()},t.prototype.setGroupIcon=function(e){var t=this;this.isMyWorkspace=!1,this.services.userInfo.findGroupIcon(e).then((function(e){t.groupIcon=e,t.hasGroupIconSet=!0})),this.groupName=this.getGroupName(e)},t.prototype.getGroupName=function(e){var t=this.services.ownership;if(t.isResourceShareableWithMe(this.viewModel)&&t.isResourceSharedWithMe(this.viewModel))return this.services.localizationService.get("NavigationPane_SharedWithMe");if(this.isMyWorkspace)return this.services.localizationService.get("NavigationPane_Groups_MyWorkspace");var i=_.find(this.services.groupService.groups,(function(t){return t.aadGroupId===e}));return i?i.displayName:""},t.prototype.openWorkspace=function(){var t=this.viewModel;t.aadGroupId!==this.services.groupService.activeGroup.aadGroupId?t.isMyWorkspace||this.services.licenseEnforcementService.supportsGroups()?this.services.navigation.navigateToGroupByGUID(t.aadGroupId):this.services.groupService.showGroupUpsellMessage(e.telemetry.LicenseEnforcementOperation.SwitchGroups):this.services.navigation.navigateToContentList(t.aadGroupId,!1,null,null,!1)},t.prototype.canShowOptionsMenu=function(){return this.services.contentList.canShowTileOptions(this.viewModel)},t.prototype.publishInProgress=function(){return this.services.contentList.publishInProgress(this.viewModel)},t.prototype.canUnFavorite=function(){if(o.isFavoritableContent(this.viewModel))return this.services.contentList.isFavorite(this.viewModel)},t.prototype.canFavorite=function(){if(o.isFavoritableContent(this.viewModel))return!this.services.contentList.isFavorite(this.viewModel)},t.prototype.isFavoriteDisabled=function(){return!!this.isFavoriting||o.isFavoriteDisabled(this.viewModel,this.services.contentList)},t.prototype.convertRefreshTimeToLocaleString=function(e,t){return void 0===t&&(t=!0),t?d.convertRefreshTimeToLocaleString(e):this.services.localizationService.get("ManageDatasets_NextRefresh_NA")},t.prototype.getPrettyDate=function(e){return s.getPrettyRelativeDate(e,this.services.localizationService)},t.prototype.getPrettySharedDate=function(e){var t=d.convertRefreshTimeToJsDateTime(e);return t<g?this.services.localizationService.get("SharedWithMe_SharedTime_Older"):this.getPrettyDate(t)},t.prototype.getLocalizedDate=function(e){return jsCommon.DateExtensions.GetFullDateWithTime(this.services.localizationService.currentLanguageLocale,e)},t.prototype.initializeDatasetMetadata=function(e){null!=e&&(e.realTimeMode&&e.realTimeMode===u.CacheOnly?(this.streamingDataset=!0,this.apiAccessType=this.services.localizationService.get("ContentList_Datasets_Streaming")):e.realTimeMode&&e.realTimeMode===u.PersistAndCache?(this.streamingDataset=!0,this.apiAccessType=this.services.localizationService.get("ContentList_Datasets_Hybrid")):e.realTimeMode&&e.realTimeMode===u.PubNubCacheOnly?(this.streamingDataset=!0,this.apiAccessType=this.services.localizationService.get("ContentList_Datasets_Streaming")):e.contract.pushDataVersion&&(this.apiAccessType=this.services.localizationService.get("ContentList_Datasets_Push")))},t.prototype.isNew=function(){return this.viewModel instanceof l?this.viewModel.isNew&&this.viewModel.contract.packagePublishStatus!==p.PublishError&&this.viewModel.contract.packagePublishStatus!==p.RefreshError&&!this.isRefreshInProgress():this.viewModel.isNew},t.prototype.isRefreshInProgress=function(){if(this.viewModel instanceof l){var e=this.services.modelService.findModel(this.viewModel.contract.id,this.viewModel.contract.packageId);return!!e&&e.isRefreshInProgress}return!1},t.prototype.toggleTileActionsVisibility=function(e){e.stopPropagation(),this.isTileActionsVisible=!this.isTileActionsVisible},t.prototype.initializeMruRow=function(){this.viewModel.workspaceId===e.constants.myWorkSpaceGroupId?this.setUserPhoto():this.setGroupIcon(this.viewModel.workspaceId),this.isItemAvailable=!!this.getOriginalContentTileOrViewModel()},t.prototype.initializeFavoriteRow=function(){this.viewModel.workspaceId?this.setGroupIcon(this.viewModel.workspaceId):this.setUserPhoto()},t.prototype.getOriginalContentTileOrViewModel=function(){var e=this.services;return o.getMRUOriginalContentTile(this.viewModel,e.dashboardService,e.reportService,e.workbookService,e.appService)},t.prototype.getActualContentType=function(){return o.getActualType(this.viewModel)},t.prototype.navigateToGroup=function(){var e=this.services.ownership.isResourceShareableWithMe(this.viewModel)&&this.services.ownership.isResourceSharedWithMe(this.viewModel);this.services.navigation.navigateToContentList(this.viewModel.workspaceId,!0,null,null,e)},t.prototype.getOwnershipTextForWorkspace=function(){if(this.viewModel.contentTileType===r.Workspace){var e=this.viewModel;return e.contract.isOwner||e.isMyWorkspace?this.services.localizationService.get("GroupEditor_RoleOptions_Admin"):this.services.localizationService.get("GroupEditor_RoleOptions_Member")}},t.prototype.getGroupTypeTextForWorkspace=function(){if(this.viewModel.contentTileType===r.Workspace){var e=this.viewModel;switch(e.contract.groupType){case c.Unknown:return"";case c.SecurityGroup:return this.services.localizationService.get("ContentList_Workspaces_GroupType_SecurityGroup");case c.DistributionList:return this.services.localizationService.get("ContentList_Workspaces_GroupType_DistributionList");case c.EmailEnabledSecurityGroup:return this.services.localizationService.get("ContentList_Workspaces_GroupType_EmailEnabledSecurityGroup");case c.O365Group:return this.services.localizationService.get("ContentList_Workspaces_GroupType_O365Group")}}},t.prototype.hasCapacity=function(){var e=this.viewModel.workspaceId;this.viewModel.contentTileType!==r.Dashboard||e||(e=this.viewModel.ownerGroupObjectId);var t=this.services.groupService.getGroup(e),i=t&&!!t.capacity,o=this.viewModel.contentTileType===r.OrgApp&&this.viewModel,a=o&&o.providerContract&&1===o.providerContract.sharedFromEnterpriseCapacitySkuTier;return i||a},t.prototype.isDataClassificationEnabled=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.viewModel.contentTileType===r.Dashboard?[2,!0]:[4,this.services.dataClassificationService.isEnabledAsync()];case 1:return[2,e.sent()]}}))}))},t})();t.ContentTileController=m})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ContentTile={restrict:"E",templateUrl:"components/contentTile/contentTile.html",bindings:{viewModel:"<",inViewport:"<?disableLazyLoading"},controller:e.common.createController(e.controllers.ContentTileController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ContentRow={templateUrl:"components/contentRow/contentRow.html",bindings:{viewModel:"<",tabType:"<",inViewport:"<?disableLazyLoading"},controller:e.common.createController(e.controllers.ContentTileController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){}return e.prototype.showSharedTime=function(){return 64===this.tabType},e.prototype.showOwner=function(){var e=this.tabType;return 0===e||128===e||2===e||64===e||4===e},e.prototype.showRecentlyUsedInfo=function(){return 16===this.tabType},e.prototype.showClassification=function(){var e=this.tabType;return 0===e||128===e||64===e},e.prototype.showRefreshInfo=function(){return 8===this.tabType},e})();e.ContentHeaderController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ContentHeader={templateUrl:"components/contentHeader/contentHeader.html",bindings:{tabType:"<"},controller:e.common.createController(e.controllers.ContentHeaderController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.models.factory.ArtifactSortPredicates,o=e.common.constants,r=e.common.dialog.MessageDialogBuilder,a=e.models.OwnershipFilterMenuFilter,n=e.common.contracts.PermissionArtifactType,s=e.dataServices.PermissionsUtils,c=e.telemetry.SelectSort,l=e.common.contracts.ContentTileType,d=(function(){function t(o,n){var s=this;this.services=n,this.sortPredicateMap={},this.allTypes=l.Dashboard|l.Report|l.Workbook,this.dashboards=[],this.reports=[],this.workbooks=[],this.datasets=[],this.dashboardCount=0,this.reportCount=0,this.workbookCount=0,this.datasetCount=0,this.searchText="",this.sortPredicate=i.TitleAlphabeticalPredicate,this.typeFilter=this.allTypes,this.ownership=a.AllContent,this.galleryViewModel={},this.filteredDashboards=[],this.filteredReports=[],this.filteredWorkbooks=[],this.filteredDatasets=[],this.initializeArtifacts=function(){s.shouldDisplayAppBtn=!1;var e=s.services.contentList,t=e.getDashboards().then((function(e){return s.dashboards=e,e})),i=e.getReports().then((function(e){
return s.reports=e,e})),o=e.getWorkbooks().then((function(e){return s.workbooks=e,e})),r=e.getDatasets().then((function(e){return s.datasets=e,e})),a=s.services.promiseFactory.all([t,i,o,r]);s.dashboardsLoadedDefer=s.services.promiseFactory.defer(),s.reportsLoadedDefer=s.services.promiseFactory.defer(),s.workbooksLoadedDefer=s.services.promiseFactory.defer(),s.datasetLoadedDefer=s.services.promiseFactory.defer(),s.contentListDataReadyPromise=a.then(s.navigateToGetDataPageIfEmptyContent),a.then((function(){return s.updateArtifacts()})),s.groupService.ensureGroupsInitialization().then((function(){var e=s.services.groupService.activeGroup;s.groupName=e.displayName,s.updateShouldDisplayIntroduceAppBar(),e.isMyWorkspace||s.isActiveWorkspaceReadOnly||!s.isAppsEnabled()||s.updateAppPublishBtn()})),s.setCanManageDatasets(),s.initOnAppMetadata()},this.mapResourceOwnerFullnames=function(){s.services.resourceOwnershipService.mapReportOwnerFullnames(s.reports,s.dashboards,s.groupService.activeGroupObjectId,s.groupName),s.services.resourceOwnershipService.mapWorkbookOwnerFullnames(s.workbooks,s.dashboards,s.groupService.activeGroupObjectId,s.groupName)},this.startTelemetry=function(){s.scope.$on(e.constants.contentListDashboardsLoadedEvent,(function(){s.dashboardsLoadedDefer.resolve(null)})),s.scope.$on(e.constants.contentListReportsLoadedEvent,(function(){s.reportsLoadedDefer.resolve(null)})),s.scope.$on(e.constants.contentListWorkbooksLoadedEvent,(function(){s.workbooksLoadedDefer.resolve(null)})),s.scope.$on(e.constants.contentListDatasetsLoadedEvent,(function(){s.datasetLoadedDefer.resolve(null)}));var t=s.telemetryService.startActivity(s.scope,e.telemetry.ContentListLoaded);s.telemetryService.logEvent(e.telemetry.ContentListArtifactsCount,s.dashboards?s.dashboards.length:-1,s.reports?s.reports.length:-1,s.workbooks?s.workbooks.length:-1);var i;switch(s.activeTab){case 0:i=s.dashboardsLoadedDefer.promise;break;case 2:i=s.reportsLoadedDefer.promise;break;case 4:i=s.workbooksLoadedDefer.promise;break;case 8:i=s.datasetLoadedDefer.promise}i&&i.then((function(){t.resolve(),s.groupService.resolveGroupSwitchTelemetry()}))},this.navigateToGetDataPageIfEmptyContent=function(i){if(_.every(i,_.isEmpty)&&!s.navigation.stateService.params[t.skipWelcome]){var o={groupGUID:s.services.groupService.activeGroupObjectId};s.services.navigation.replaceAndLoadCurrentState(e.constants.navigation.states.groupWelcome,o)}},this.resolveTelemetry=function(e,t,i){return 0===s[t]&&s[i].resolve(null),e},this.searchProperties=function(e){var t=s.searchText.toLocaleLowerCase();return s.containsSubstring(e.displayName,t)||s.containsSubstring(e.ownerFullname,t)},this.setCanManageDatasets=function(){s.services.groupService.ensureGroupsInitialization().then((function(){s.canManageDatasets=!s.services.groupService.activeGroup.contract.isReadOnly||s.services.groupService.activeGroup.contract.isOwner}))},this.selectSort=function(t){s.sortPredicate=t,s.filterArtifacts(s.activeTab);var i=s.sortPredicateMap[t.toAngularFilter()];s.services.telemetryService.logEvent(e.telemetry.ContentListSelectSort,i),s.persistFilter()},this.ownershipPredicate=function(e){return s.ownership===a.AllContent||s.ownership===a.SharedWithMe&&s.ownershipService.isResourceSharedWithMe(e)||s.ownership===a.MyContent&&!s.ownershipService.isResourceSharedWithMe(e)},this.onSearchTextChange=function(){s.filterArtifacts(s.activeTab),s.ensureSearchTelemetry()},this.ensureSearchTelemetry=function(){s.searchTelemetry||_.isEmpty(s.searchText)||(s.searchTelemetry=s.telemetryService.startEvent(e.telemetry.ContentListSearch))},this.resolveSearchTelemetry=function(){s.searchTelemetry&&(s.searchTelemetry.resolve(),s.searchTelemetry=null)},this.isVisible=function(e){return s.services.contentList.isVisible(e)},this.emptySharedDashboards={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptySharedWithMeTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptySharedWithMeMessage"),imgClass:"empty-shared-with-me-img"},this.emptyDashboards={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptyDashboardsTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptyDashboardsMessage"),imgClass:"empty-dashboards-img"},this.emptyReports={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptyReportsTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptyReportsMessage"),imgClass:"empty-reports-img"},this.emptyWorkbooks={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptyWorkbooksTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptyWorkbooksMessage"),imgClass:"empty-workbooks-img"},this.emptyDatasets={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptyDatasetsTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptyDatasetsMessage"),imgClass:"empty-datasets-img"},this.emptySearch={canEdit:!0,mode:!1,linkDescription:this.services.localizationService.get("ContentList_EmptySearchResults_SearchRedirectDescription"),linkText:this.services.localizationService.format("SearchIn",[this.services.localizationService.get("NavigationPane_SharedWithMe")]),linkAction:function(){return s.switchWorkspaceFromEmptySearch()},imgClass:"empty-search-img"},this.scope=o,this.navigation=n.navigation,this.localizationService=n.localizationService,this.errorService=n.errorService,this.groupService=n.groupService,this.telemetryService=n.telemetryService,this.groupHttp=n.groupHttp,this.ownershipService=n.ownership,this.rootScope=n.rootScope,this.modalDialogService=n.modalDialogService,this.modelService=n.modelService,this.userMetadataLoaded=!1,this.setActiveTab(this.getCurrentTab()),this.initializeArtifacts();var c=this.services.contentList.subscribeDashboards((function(){return s.updateArtifacts()})),d=this.services.contentList.subscribeReports((function(){return s.updateArtifacts()})),p=this.services.contentList.subscribeWorkbooks((function(){return s.updateArtifacts()})),u=this.services.contentList.subscribeModels((function(){return s.updateArtifacts()}));this.messageDialogBuilder=new r(this.services.modalDialogService),this.buildCreateDropdownMenuItems();var h=this.rootScope.$on(e.constants.groupSwitchedEventName,this.initializeArtifacts),v=this.services.rootScope.$on(e.common.constants.navigation.stateChangeSuccess,(function(e,t,i,o,r){return s.handleStateChange(t,i,o,r)}));this.unregisterListeners=function(){s.services.contentList.unsubscribeDashboards(c),s.services.contentList.unsubscribeReports(d),s.services.contentList.unsubscribeWorkbooks(p),s.services.contentList.unsubscribeModels(u),v(),h()}}return t.createOptions=function(){return{additionalServices:["$rootScope","appMetadataService","appService","conceptualModelSetting","contentList","groupService","navigation","permissionService","promiseFactory","ownership","localizationService","telemetryService","errorService","groupHttp","modalDialogService","resourceOwnershipService","filterPersistenceService","featureSwitchService","modelService","realTimeModel","overlayService","userInfo","quota","taskPaneSliderService","usageMetricsReport","notificationToast","tutorialDataStore","dropdown","lazy","moduleLoader"]}},t.prototype.$onInit=function(){var e=this;this.sortPredicateMap[i.TitleAlphabeticalPredicate.toAngularFilter()]=c.TitleAlpabetical,this.sortPredicateMap[i.TitleReverseAlphabeticalPredicate.toAngularFilter()]=c.TitleReverseAlphabetical,this.sortPredicateMap[i.OwnerAlphabeticalPredicate.toAngularFilter()]=c.OwnerAlphabetical,this.sortPredicateMap[i.OwnerReverseAlphabeticalPredicate.toAngularFilter()]=c.OwnerReverseAlphabetical,1===this.services.navigation.instantiationMode&&this.showStreamingDatasetGalleryPane(),this.processSharedWithMeParameter(),this.services.userInfo.userMetadataPromise.finally((function(){e.userMetadataLoaded=!0})),this.initialized=!0},t.prototype.$onDestroy=function(){this.unregisterListeners()},Object.defineProperty(t.prototype,"showSpinner",{get:function(){return this.isOnlySharedWithMe()?this.dashboardsArePresent&&(!this.userMetadataLoaded||!this.initialized):!this.initialized},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActiveWorkspaceReadOnly",{get:function(){return this.services.permissionService.isActiveWorkspaceIsReadOnly},enumerable:!0,configurable:!0}),t.prototype.isOnlySharedWithMe=function(){return this.services.navigation.inContentListView(!0)},t.prototype.processSharedWithMeParameter=function(){this.navigation.searchText&&(this.searchText=this.navigation.searchText),this.isOnlySharedWithMe()?(this.setActiveTab(0),this.ownership=a.SharedWithMe,this.sortPredicate=i.OwnerAlphabeticalPredicate):(this.setActiveTab(this.getCurrentTab()),this.ownership=a.MyContent,this.sortPredicate=i.TitleAlphabeticalPredicate)},t.prototype.handleStateChange=function(e,t,i,o){this.processSharedWithMeParameter()},t.prototype.updateAppPublishBtn=function(){var e=this;this.services.lazy("publishApp").then((function(t){t.getPublishedAppsForCurrentGroup().then((function(t){_.isEmpty(t)?e.appBtnResourceKey="CreateApp_Publish":e.appBtnResourceKey="UpdateApp_Publish",e.shouldDisplayAppBtn=!0}))}))},t.prototype.updateShouldDisplayIntroduceAppBar=function(){var t=this;this.shouldDisplayIntroduceAppBar=this.isAppsEnabled()&&!this.services.groupService.isMyWorkspace()&&!this.isActiveWorkspaceReadOnly&&!this.services.tutorialDataStore.getKey(o.HideIntroduceAppBarKey),this.shouldDisplayIntroduceAppBar&&!this.introduceAppBarConfig&&(this.introduceAppBarConfig={title:this.services.localizationService.get("AppModel_IntroduceAppAndAppWorkspaces"),content:this.services.localizationService.get("AppModel_IntroduceAppDescriptionInWorkspace"),learnMoreText:this.services.localizationService.get("LearnMore"),closeBarCallback:function(){var i=t.telemetryService.startEvent(e.telemetry.AppsHideIntroduceAppBar);t.services.tutorialDataStore.setKey(o.HideIntroduceAppBarKey,!0,i),t.shouldDisplayIntroduceAppBar=!1,t.introduceAppBarConfig=null}})},t.prototype.containsSubstring=function(e,t){return!!e&&_.contains(e.toLocaleLowerCase(),t)},t.prototype.$postLink=function(){this.contentListDataReadyPromise.then(this.startTelemetry)},t.prototype.initOnAppMetadata=function(){var e=this;this.services.appMetadataService.getAppMetadata().then((function(){e.initialized=!0}))},t.prototype.getNumberOfShownItems=function(){var e=0;return this.shouldHideType(l.Dashboard)||(e+=this.dashboardCount),this.shouldHideType(l.Report)||(e+=this.reportCount),this.shouldHideType(l.Workbook)||(e+=this.workbookCount),e},t.prototype.shouldHideType=function(e){return 0===(this.typeFilter&e)},t.prototype.persistFilter=function(){this.services.filterPersistenceService.setFilter(this.navigation.currentGroupGUID,{contentTileType:this.typeFilter,ownershipFilter:this.ownership,sortPredicate:this.sortPredicate.toAngularFilter()})},t.prototype.switchWorkspaceFromEmptySearch=function(){this.services.navigation.navigateToSharedWithMe(this.searchText)},t.prototype.setActiveTab=function(e){this.activeTab=e,e!==this.getCurrentTab()&&this.services.navigation.changeContentListPivot(e),this.updateSortPredicates(),this.updateArtifacts()},t.prototype.getCurrentTab=function(){var e=this.services.navigation.stateService.params[t.pivot];switch(e){case"dashboards":return 0;case"datasets":return 8;case"recent":return 16;case"reports":return 2;case"workbooks":return 4}return this.services.navigation.contentListTab||0},t.prototype.updateSortPredicates=function(){this.sortPredicates=e.models.factory.SelectTileSortItemsFactory.createPredicates(this.localizationService,this.activeTab)},t.prototype.updateArtifacts=function(){this.services.promiseFactory.all([this.contentListDataReadyPromise,this.groupService.ensureGroupsInitialization(),this.services.contentList.dashboardsOwnersMergedPromise(),this.services.appService.ensureAppsInitialization()]).then(this.mapResourceOwnerFullnames),this.filterArtifacts(this.activeTab)},t.prototype.filterArtifacts=function(e){switch(e){case 0:this.filterDashboards();break;case 2:this.filterReports();break;case 4:this.filterWorkbooks();break;case 8:this.filterDatasets()}this.updateGalleryViewModel()},t.prototype.filterDashboards=function(){var e=this,t=_(this.dashboards).filter((function(t){return e.isVisible(t)&&e.ownershipPredicate(t)}));this.dashboardsArePresent=t.any(),this.filteredDashboards=this.filterSearchTextAndSort(t).value(),this.dashboardCount=this.filteredDashboards.length},t.prototype.filterReports=function(){var e=this,t=_(this.reports).filter((function(t){return e.isVisible(t)&&e.ownershipPredicate(t)}));this.reportsArePresent=t.any(),this.filteredReports=this.filterSearchTextAndSort(t).value(),this.reportCount=this.filteredReports.length},t.prototype.filterWorkbooks=function(){var e=this,t=_(this.workbooks).filter((function(t){return e.isVisible(t)&&e.ownershipPredicate(t)}));this.workbooksArePresent=t.any(),this.filteredWorkbooks=this.filterSearchTextAndSort(t).value(),this.workbookCount=this.filteredWorkbooks.length},t.prototype.filterDatasets=function(){var e=_(this.datasets).filter(this.isVisible);this.datasetsArePresent=e.any(),this.filteredDatasets=this.filterSearchTextAndSort(e).value(),this.datasetCount=this.filteredDatasets.length},t.prototype.filterSearchTextAndSort=function(e){var t=this,i=e.filter(this.searchProperties).sortBy((function(e){return e.hasOwnProperty(t.sortPredicate.columnName)?e[t.sortPredicate.columnName].toLocaleLowerCase():""}));return this.sortPredicate.reverse&&(i=i.reverse()),i},t.prototype.updateGalleryViewModel=function(){var t=this;switch(this.galleryViewModel.tabType=this.activeTab,this.galleryViewModel.collapsiblePaneMode=this.collapsiblePaneMode,this.activeTab){case 0:this.galleryViewModel.getTiles=function(){return t.filteredDashboards},this.galleryViewModel.finishLoadEvent=e.constants.contentListDashboardsLoadedEvent;break;case 2:this.galleryViewModel.getTiles=function(){return t.filteredReports},this.galleryViewModel.finishLoadEvent=e.constants.contentListReportsLoadedEvent;break;case 4:this.galleryViewModel.getTiles=function(){return t.filteredWorkbooks},this.galleryViewModel.finishLoadEvent=e.constants.contentListWorkbooksLoadedEvent;break;case 8:this.galleryViewModel.getTiles=function(){return t.filteredDatasets},this.galleryViewModel.finishLoadEvent=e.constants.contentListDatasetsLoadedEvent}},t.prototype.getNumberOfShownTabItems=function(){var e=0;switch(this.activeTab){case 0:return e+=this.dashboardCount;case 2:return e+=this.reportCount;case 4:return e+=this.workbookCount;case 8:return e+=this.datasetCount;default:return e}},t.prototype.showCreateDropdownMenu=function(t){var i=this;e.common.DropdownUtils.showLegacyDropdownItems(this.services.dropdown,"contentListCreateDropdownMenu",this.createDropdownMenuItems,"contentListCreateDropdownMenu",(function(e){return i.onCreateDropdownMenuItemSelected(e)}),{anchorElement:$(t.currentTarget),horizontal:!1})},t.prototype.buildCreateDropdownMenuItems=function(){this.createDropdownMenuItems=[{text:this.localizationService.get("ContentList_Dashboard"),action:0,type:DropDownMenuItemType.Item},{text:this.localizationService.get("ContentList_Report"),action:1,type:DropDownMenuItemType.Item},{text:this.localizationService.get("ContentList_Dataset"),action:2,type:DropDownMenuItemType.Item},{text:this.localizationService.get("ContentList_StreamingDataset"),action:3,type:DropDownMenuItemType.Item}]},t.prototype.onCreateDropdownMenuItemSelected=function(e){switch(e.action){case 0:this.addDashboard();break;case 1:this.addReport();break;case 2:this.showGetDataSlider();break;case 3:this.showStreamingDatasetGalleryPane()}},t.prototype.addDashboard=function(){var t=this;this.services.overlayService.hideAllDropdowns();var i=this.services.localizationService;e.explore.controllers.showSaveAsDialog(this.services.errorService,i,i.get("ContentList_CreateDashboard_DialogTitle"),i.get("ContentList_CreateDashboard_DialogDetails"),i.get("ContentList_CreateDashboard_DialogButton")).then((function(e){t.services.contentList.addDashboard(e)}),(function(){}))},t.prototype.addReport=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o;return __generator(this,(function(r){switch(r.label){case 0:return t=this.services,t.overlayService.hideAllDropdowns(),t.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.OpenDataset)?[2]:[4,t.moduleLoader.require({javascript:"PowerBIDialogs/components/createReportDialog/createReportDialogBuilder"})];case 1:return i=r.sent(),o=i.createReportDialogBuilder(t.telemetryService,t.navigation,t.permissionService,(function(e){return t.usageMetricsReport.modelBelongsToUsageMetricsContentPack(e)}),t.modalDialogService,t.modelService,t.moduleLoader),o.show(),[2]}}))}))},t.prototype.showGetDataSlider=function(){this.services.overlayService.hideAllDropdowns(),this.services.navigation.showGetDataSlider()},t.prototype.showStreamingDatasetGalleryPane=function(){this.services.overlayService.hideAllDropdowns(),this.services.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.CreateStreamingDataset)||(this.services.realTimeModel.setSelected(null),this.services.taskPaneSliderService.expandPane(13))},t.prototype.addChannel=function(){var t=this,i=_.filter(this.dashboards,(function(e){return!e.contract.isHidden&&s.canReshare(e.getPermissions(),n.Dashboard)})),o=_.filter(this.reports,(function(e){return s.canReshare(t.services.permissionService.getReportEffectivePermissions(e.contract),n.Report)})),a=_.filter(this.workbooks,(function(e){return s.canReshare(t.services.permissionService.getWorkbookEffectivePermissions(e.contract),n.Workbook)})),c=_.filter(e.helpers.ContentPackAuthoringHelper.getUsedDatasets(this.datasets,i,o),(function(e){return!e.contract.isHidden&&s.canReshare(t.services.permissionService.getModelEffectivePermissions(e.contract),n.Dataset)}));if(_.isEmpty(i)&&_.isEmpty(o)&&_.isEmpty(a)&&_.isEmpty(c)){var l=new r(this.services.modalDialogService);l.show("PublishAppConfirmDialog",{titleText:"AppModel_CannotCreateTitle",messageText:"AppModel_CannotCreatContent",okButtonText:"PBI_Button_Label_Close"})}else this.services.navigation.showPublishAppSlicer()},t.prototype.isAppsEnabled=function(){return this.services.conceptualModelSetting.isAppsEnabled()},t.prototype.getWatermarkConfig=function(){switch(this.activeTab){case 0:return this.internalGetWatermarkMessage("Dashboard");case 2:return this.internalGetWatermarkMessage("Report");case 4:return this.internalGetWatermarkMessage("Workbook");case 8:return this.internalGetWatermarkMessage("Dataset")}},t.prototype.internalGetWatermarkMessage=function(e){var t=_.camelCase(e);return 0!==this[t+"Count"]||_.isEmpty(this.searchText)?this[t+"sArePresent"]?void 0:"dashboard"===t&&this.isOnlySharedWithMe()?this.emptySharedDashboards:this["empty"+e+"s"]:this.emptySearch},t.skipWelcome="skipWelcome",t.pivot="pivot",t})();t.ContentListContainerV2Controller=d})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ContentListContainerV2={templateUrl:"components/contentListContainerV2/contentListContainerV2.html",controller:e.common.createController(e.controllers.ContentListContainerV2Controller),bindings:{collapsiblePaneMode:"<"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){var i=this;this.disableLazyLoading=!1,this.shouldShowAddDashboardBtn=function(){i.services.groupService.ensureGroupsInitialization().then((function(){i.showAddDashboardBtn=!i.services.groupService.activeGroup.contract.isReadOnly||i.services.groupService.activeGroup.contract.isOwner}))},this.scope=e,this.services=t,this.shouldShowAddDashboardBtn()}return t.createOptions=function(){return{additionalServices:["contentList","localizationService","errorService","groupService"]}},t.prototype.activeAddDashboard=function(){var t=this,i=this.services.localizationService;e.explore.controllers.showSaveAsDialog(this.services.errorService,i,i.get("ContentList_CreateDashboard_DialogTitle"),i.get("ContentList_CreateDashboard_DialogDetails"),i.get("ContentList_CreateDashboard_DialogButton")).then((function(e){t.services.contentList.addDashboard(e)}),(function(){}))},t})();t.ContentTileContainerController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e})();e.ContentListGalleryViewModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t="dashboardsGallery",i="reportsGallery",o="workbooksGallery",r="datasetsGallery",a="recentlyUsedGallery",n="sharedWithMeGallery",s="favoritesGallery",c=(function(){function e(e,t){}return Object.defineProperty(e.prototype,"galleryContainerStyle",{get:function(){switch(this.viewModel.tabType){case 0:return t;case 2:return i;case 4:return o;case 8:return r;case 16:return a;case 64:return n;case 128:return s}},enumerable:!0,configurable:!0}),e})();e.ContentListGalleryController=c})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ContentListGallery={templateUrl:"components/contentListGallery/contentListGallery.html",bindings:{viewModel:"<"},controller:e.common.createController(e.controllers.ContentListGalleryController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ContentTileContainer={templateUrl:"components/contentTileContainer/contentTileContainer.html",controller:e.common.createController(e.controllers.ContentTileContainerController),transclude:{title:"?sectionTitle"},bindings:{getTiles:"&tiles",collapsiblePaneMode:"<",finishLoadEvent:"@",disableLazyLoading:"<?",placeHolderTile:"<?"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.isDataClassificationFeatureEnabled=t.featureSwitchService.featureSwitches.dataClassificationEnabled,this.dataClassificationService=t.dataClassificationService}return e.createOptions=function(){return{additionalServices:["featureSwitchService","dataClassificationService"]}},e.prototype.$onInit=function(){this.updateDataClassificationById(this.classificationId)},e.prototype.$onChanges=function(e){e.classificationId&&this.updateDataClassificationById(e.classificationId.currentValue)},e.prototype.updateDataClassificationById=function(e){var t=this;this.dataClassificationService.getDataClassificationsAsync().then((function(i){t.dataClassification=_.find(i,(function(t){return void 0!==e&&t.id===e}))||_.find(i,(function(e){return e.default}))}))},e})();e.DataClassificationLabelController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ClassificationLabel={templateUrl:"components/dataClassificationLabel/dataClassificationLabel.html",controller:e.common.createController(e.controllers.DataClassificationLabelController),bindings:{classificationId:"<"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.models.factory.ArtifactSortPredicates,o=e.telemetry.SelectSort,r=(function(){function t(t,o){var r=this;this.services=o,this.sortPredicateMap={},this.selectSort=function(t){r.sortPredicate=t;var i=r.sortPredicateMap[t.toAngularFilter()];r.services.telemetryService.logEvent(e.telemetry.ContentListSelectSort,i),r.filterArtifacts()},this.onSearchTextChange=function(){r.filterArtifacts(),r.ensureSearchTelemetry()},this.listener={onFavoriteAdded:function(){return r.updateArtifacts()},onFavoriteDeleted:function(){return r.updateArtifacts()},onFavoritesReset:function(){return r.updateArtifacts()}},this.services.favorites.subscribe(this.listener),this.searchText="",this.sortPredicate=i.TitleAlphabeticalPredicate,this.sortPredicates=e.models.factory.SelectTileSortItemsFactory.createPredicates(this.services.localizationService,128),this.galleryViewModel={getTiles:function(){return r.filteredFavorites},tabType:128,finishLoadEvent:e.constants.contentListFavoritesLoadedEvent,collapsiblePaneMode:null},this.services.favorites.reloadFavorites(!0).then((function(e){return r.updateArtifacts()})),this.allFavoritesCache=this.services.favorites.favoritesCache,this.filteredFavorites=this.allFavoritesCache||[]}return t.createOptions=function(){return{additionalServices:["favorites","localizationService","telemetryService"]}},t.prototype.$onInit=function(){this.sortPredicateMap[i.TitleAlphabeticalPredicate.toAngularFilter()]=o.TitleAlpabetical,this.sortPredicateMap[i.TitleReverseAlphabeticalPredicate.toAngularFilter()]=o.TitleReverseAlphabetical,this.sortPredicateMap[i.OwnerInfoAlphabeticalPredicate.toAngularFilter()]=o.OwnerAlphabetical,this.sortPredicateMap[i.OwnerInfoReverseAlphabeticalPredicate.toAngularFilter()]=o.OwnerReverseAlphabetical,this.emptySearchWatermarkConfig={canEdit:!0,mode:!1,contentNonShared:this.services.localizationService.get("ContentList_EmptySearchResults"),imgClass:"empty-search-img"}},t.prototype.$onDestroy=function(){this.services.favorites.unsubscribe(this.listener)},t.prototype.ensureSearchTelemetry=function(){this.searchTelemetry||_.isEmpty(this.searchText)||(this.searchTelemetry=this.services.telemetryService.startEvent(e.telemetry.ContentListSearch))},t.prototype.resolveSearchTelemetry=function(){this.searchTelemetry&&(this.searchTelemetry.resolve(),this.searchTelemetry=null)},Object.defineProperty(t.prototype,"initialized",{get:function(){return!!this.allFavoritesCache},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showEmptyFavoritesWatermark",{get:function(){return this.initialized&&_.isEmpty(this.allFavoritesCache)},enumerable:!0,configurable:!0}),t.prototype.updateArtifacts=function(e){this.allFavoritesCache=this.services.favorites.favoritesCache,this.filterArtifacts()},t.prototype.filterArtifacts=function(){var e=this,t=_(this.allFavoritesCache).filter((function(t){return e.containsSearchText(t)})).sortBy((function(t){return t.hasOwnProperty(e.sortPredicate.columnName)?t[e.sortPredicate.columnName].toLocaleLowerCase():""}));this.sortPredicate.reverse&&(t=t.reverse()),this.filteredFavorites=t.value(),this.showEmptySearchWatermarkConfig=!_.isEmpty(this.allFavoritesCache)&&!!this.searchText&&_.isEmpty(this.filteredFavorites)},t.prototype.containsSearchText=function(e){var t=this.searchText.toLocaleLowerCase();return this.containsSubstring(e.displayName,t)||this.containsSubstring(e.ownerInfo,t)},t.prototype.containsSubstring=function(e,t){return!!e&&_.contains(e.toLocaleLowerCase(),t)},t})();t.FavoritesContainerController=r})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.FavoritesContainer={templateUrl:"components/favoritesContainer/favoritesContainer.html",bindings:{collapsiblePaneMode:"<"},controller:e.common.createController(e.controllers.FavoritesContainerController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.GroupLinkType,o=e.common.dialog.MessageDialogBuilder,r=(function(){function t(e,t){this.services=t,this.dropdownOrientation="horizontal",this.allowUnpublishApp=!1}return t.createOptions=function(){return{additionalServices:["$rootScope","errorService","groupHttp","groupService","localizationService","modalDialogService","navigation","promiseFactory","telemetryService","userInfo","viralTenantMergeHelperService","groupContextMenuService","conceptualModelSetting","notificationToast","permissionService","lazy","licenseEnforcementService"]}},t.prototype.$onInit=function(){this.items=this.buildContextMenu(this.group),this.messageDialogBuilder=new o(this.services.modalDialogService)},t.prototype.$onChanges=function(e){(e.group||e.allowUnpublishApp)&&(this.items=this.buildContextMenu(this.group))},t.prototype.onGroupNavigationPaneMenuItemSelected=function(e,t){var o=this.services.licenseEnforcementService;switch(e.action){case 0:o.supportsGroups(!0)&&this.services.groupContextMenuService.performActionWithNonUrlGroupLinkType(i.EditGroup,t);break;case 1:o.supportsGroups(!0)&&this.services.groupContextMenuService.performActionWithNonUrlGroupLinkType(i.ViewGroup,t);break;case 2:o.supportsGroups(!0)&&this.services.groupContextMenuService.performActionWithNonUrlGroupLinkType(i.LeaveGroup,t);break;case 4:this.services.groupContextMenuService.performActionWithNonUrlGroupLinkType(i.EditMyWorkspace,t);break;case 3:o.supportsAppsAuthoring(!0)&&this.unpublishApp()}},t.prototype.buildContextMenu=function(e){var t=this;if(e){var o=e.metadata,r=[],a=0,n=!0;return o?o.contextMenuItemList.forEach((function(e){if(0===a&&o.contextMenuSeparatorPosition===-1)n=!1;else if(a++===o.contextMenuSeparatorPosition){var s={type:DropDownMenuItemType.Separator};r.push(s),n=!1}var c;if(!n)switch(e.linkType){case i.EditGroup:c=0;break;case i.ViewGroup:c=1;break;case i.LeaveGroup:c=2;break;case i.EditMyWorkspace:c=4}var l={text:t.getMenuItemText(e.linkType),labelClass:"groupMenuItem",action:c,href:n?e.url:void 0,type:DropDownMenuItemType.Item};r.push(l)})):(r.push({text:this.getMenuItemText(i.EditGroup),labelClass:"groupMenuItem",action:0,type:DropDownMenuItemType.Item}),r.push({text:this.getMenuItemText(i.LeaveGroup),labelClass:"groupMenuItem",action:2,type:DropDownMenuItemType.Item})),this.allowUnpublishApp&&this.services.conceptualModelSetting.isAppsEnabled()&&this.appendUnpublishAppItem(r),r}},t.prototype.appendUnpublishAppItem=function(e){var t=this;this.services.groupService.groupSwitchPromise().then((function(){t.group===t.services.groupService.activeGroup&&(t.services.groupService.isMyWorkspace()||t.services.permissionService.isActiveWorkspaceIsReadOnly||t.services.lazy("publishApp").then((function(o){o.getPublishedAppsForCurrentGroup().then((function(o){_.isEmpty(o)||(t.publishedApp=o[0],e.push({text:t.getMenuItemText(i.UnpublishApp),labelClass:"groupMenuItem",action:3,type:DropDownMenuItemType.Item}))}))})))}))},t.prototype.unpublishApp=function(){var t=this;this.messageDialogBuilder.show("unpublishAppConfirmationDialog",{titleText:this.services.localizationService.get("AppModel_UnpublishingAppTitle"),messageText:this.services.localizationService.get("AppModel_UnpublishingAppMessage"),okButtonText:this.services.localizationService.get("Unpublish"),cancelButtonText:this.services.localizationService.get("PBI_Button_Label_Close")}).then((function(i){if(0===i){t.unpublishAppInProgress=!0;var o=t.services.notificationToast.notify({message:t.services.localizationService.get("AppModel_UnpublishingAppToastMessage"),notificationType:e.common.NotificationToastType.Loading});t.services.lazy("publishApp").then((function(i){i.deletePublishedApp(void 0,t.publishedApp.objectId).then((function(){t.services.notificationToast.hide(o),t.services.notificationToast.notify({message:t.services.localizationService.get("AppModel_UnpublishingAppSuccessToastMessage"),notificationType:e.common.NotificationToastType.Success}),_.remove(t.items,(function(e){return 3===e.action})),t.publishedApp=null}),(function(){t.services.notificationToast.hide(o),t.services.notificationToast.notify({message:t.services.localizationService.get("App_Delete_FailedMessage"),notificationType:e.common.NotificationToastType.Error})})).finally((function(){t.unpublishAppInProgress=!1}))}))}}))},t.prototype.getMenuItemText=function(e){return this.services.groupContextMenuService.getTextForGroupLinkType(e)},t})();t.GroupActionsController=r})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.GroupActions={templateUrl:"components/groupActions/groupActions.html",controller:e.common.createController(e.controllers.GroupActionsController),bindings:{group:"<",dropdownOrientation:"@?",allowUnpublishApp:"<?",unpublishAppInProgress:"=?"}}})(t=e.components||(e.components={}));
})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["userInfo"]}},t.prototype.$onInit=function(){this.updatePhoto(),this.updatePlaceholder()},t.prototype.$onChanges=function(e){e.group&&(this.updatePhoto(),this.updatePlaceholder())},t.prototype.updatePlaceholder=function(){this.placeholder=this.isMyWorkspace()?"user":"group"},t.prototype.updatePhoto=function(){var e=this;this.isMyWorkspace()?this.services.userInfo.getUserPhoto().then((function(t){e.src=t.substring(4,t.length-1)})):this.group?this.src=this.group.icon:this.src=null},t.prototype.isMyWorkspace=function(){return this.group&&this.group.aadGroupId===e.common.constants.myWorkspaceGroupId},t})();t.GroupIconController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.GroupIcon={templateUrl:"components/groupIcon/groupIcon.html",bindings:{group:"<",placeholderSize:"@"},controller:e.common.createController(e.controllers.GroupIconController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.CollapsiblePaneExpandedWidth,o=(function(){function t(t,i){var o=this;this.services=i,this.groupService=i.groupService,this.updateTenantCapacityInfo();var r=this.services.$rootScope.$on(e.constants.groupDeletedEventName,(function(e){e.stopPropagation(),o.updateGroupList()}));this.services.$rootScope.$on(e.common.constants.scopeDestroyEventName,(function(){r()}))}return t.createOptions=function(){return{additionalServices:["$rootScope","groupService","userInfo","navigation","viralTenantMergeHelperService","taskPaneSliderService","licenseEnforcementService","appMetadataService"]}},t.prototype.$onChanges=function(e){(e.activeGroup||e.isExpanded&&this.isExpanded)&&this.updateGroupList()},t.prototype.isGroupSelected=function(e){return!!this.activeGroup&&this.activeGroup.aadGroupId===e.aadGroupId},t.prototype.switchGroup=function(e){this.toggleGroupListPane(!1),e.aadGroupId!==this.activeGroup.aadGroupId?(e.isMyWorkspace||this.isGroupFeatureEnabled())&&this.services.navigation.navigateToGroupByGUID(e.aadGroupId):this.services.navigation.navigateToContentList(e.aadGroupId,!1,null,null,!1)},t.prototype.toggleGroupListPane=function(e){this.onToggled&&this.onToggled({isExpanded:e})},t.prototype.addGroup=function(){this.services.viralTenantMergeHelperService.viewingDataFromMergedViralTenant()?this.services.viralTenantMergeHelperService.displayFeatureDisabledErrorMessage("ArchivedContent_ErrorMessageGroup"):this.isGroupFeatureEnabled()&&this.services.taskPaneSliderService.expandPane(2,i.Large)},t.prototype.isActiveGroup=function(e){return e===this.activeGroup},t.prototype.updateTenantCapacityInfo=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.services.appMetadataService.getAppMetadata()];case 1:return e=t.sent(),this.tenantHasCapacities=e.tenantHasCapacities,[2]}}))}))},t.prototype.updateGroupList=function(){this.myWorkspace=this.groupService.groups[0],this.groups=_(this.groupService.groups).filter((function(e){return!e.isMyWorkspace})).sortBy((function(e){return e.displayName})).value()},t.prototype.isGroupFeatureEnabled=function(){return this.services.licenseEnforcementService.supportsGroups(!0)},t})();t.GroupListController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.GroupList={templateUrl:"components/groupList/groupList.html",controller:e.common.createController(e.controllers.GroupListController),bindings:{activeGroup:"<",isExpanded:"<",onToggled:"&"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t,this.groupService=t.groupService}return e.createOptions=function(){return{additionalServices:["groupService","navigation"]}},e.prototype.navigateToWorkspaces=function(){this.onToggled({isExpanded:!1}),this.services.navigation.navigateToWorkspaces()},e})();e.GroupSwitcherController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.GroupSwitcher={templateUrl:"components/groupSwitcher/groupSwitcher.html",controller:e.common.createController(e.controllers.GroupSwitcherController),bindings:{onToggled:"&"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.CollapsiblePaneExpandedWidth,o=(function(){function t(e,t){var i=this;this.scope=e,this.services=t,this.userInfo=t.userInfo,this.groupService=t.groupService,this.isExpanded=!1,this.userInfo.getUserPhoto().then((function(e){i.userPhoto=e}))}return t.createOptions=function(){return{additionalServices:["groupService","userInfo","navigation","viralTenantMergeHelperService","taskPaneSliderService","licenseEnforcementService"]}},t.prototype.$onChanges=function(e){e.canExpand&&e.canExpand.currentValue&&this.toggleGroupSwitcherPane(!0)},t.prototype.getGroups=function(){for(var e,t=[],i=this.groupService.groups,o=0,r=i.length;o<r;o++)i[o].isMyWorkspace?e=i[o]:t.push(i[o]);var a=[];a.push(e),t=_.sortBy(t,(function(e){return e.displayName}));for(var o=0,r=t.length;o<r;o++)a.push(t[o]);return a},t.prototype.isGroupSelected=function(e){return!!this.groupService.activeGroup&&this.groupService.activeGroup.aadGroupId===e.aadGroupId},t.prototype.switchGroup=function(t){t.aadGroupId!==this.services.groupService.activeGroupObjectId?t.isMyWorkspace||this.isGroupFeatureEnabled()?(this.services.navigation.navigateToGroupByGUID(t.aadGroupId),this.onGroupSelected&&this.onGroupSelected()):this.services.groupService.showGroupUpsellMessage(e.telemetry.LicenseEnforcementOperation.SwitchGroups):this.services.navigation.navigateToContentList(t.aadGroupId,!1,null,null,!1)},t.prototype.toggleGroupSwitcherPane=function(e){this.isExpanded=void 0===e?!(this.isExpanded&&this.canExpand):e,this.onToggled&&this.onToggled({isExpanded:this.isExpanded})},t.prototype.addGroup=function(){this.services.viralTenantMergeHelperService.viewingDataFromMergedViralTenant()?this.services.viralTenantMergeHelperService.displayFeatureDisabledErrorMessage("ArchivedContent_ErrorMessageGroup"):this.isGroupFeatureEnabled()?this.services.taskPaneSliderService.expandPane(2,i.Large):this.services.groupService.showGroupUpsellMessage(e.telemetry.LicenseEnforcementOperation.CreateGroups)},t.prototype.isGroupFeatureEnabled=function(){return this.services.licenseEnforcementService.supportsGroups()},t})();t.GroupSwitcherV2Controller=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.GroupSwitcherV2={templateUrl:"components/groupSwitcherV2/groupSwitcherV2.html",controller:e.common.createController(e.controllers.GroupSwitcherV2Controller),bindings:{onGroupSelected:"&",onToggled:"&",canExpand:"<"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.services=t,this.scope=e}return t.createOptions=function(){return{additionalServices:["$window","networkAvailability","localizationService","$element"]}},t.prototype.$onInit=function(){function t(e){i.postMessage({embedCode:e},"*")}var i,o=this,r=!1;if(this.iframeSource=embeddedWebContentIframeSource,!this.services.networkAvailability.isNetworkAvailable()){var a=this.services.localizationService.get("Tile_ErrorText");return void this.scope.$emit(e.common.constants.tileErrorEventName,a)}var n=function(e){e.data&&e.data.iframeLoaded&&(i=o.services.$element.find("iframe").first()[0].contentWindow,i&&e.source===i&&(r=!0,t(o.viewModel.embedCode),o.services.$window.removeEventListener(jsCommon.DOMConstants.messageEventName,n)))};this.services.$window.addEventListener(jsCommon.DOMConstants.messageEventName,n),this.scope.$watch("$ctrl.viewModel.embedCode",(function(e){r&&t(e)}))},t})();t.IFrameTileController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.IframeTile={bindings:{viewModel:"<"},controller:e.common.createController(e.controllers.IFrameTileController),templateUrl:"components/iframeTile/iframeTile.html"}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.services=t}return t.createOptions=function(){return{additionalServices:["$window","licenseEnforcementService","userInfo"]}},t.prototype.$onInit=function(){this.content=this.config&&this.config.content},t.prototype.upgrade=function(){return this.config&&this.config.upgradeCallback?void this.config.upgradeCallback():void this.services.$window.open("https://go.microsoft.com/fwlink/?linkid=847283","_blank")},t.prototype.startTrial=function(){return this.config&&this.config.startTrialCallback?void this.config.startTrialCallback():void this.services.licenseEnforcementService.showTrialDialog(e.telemetry.LicenseEnforcementOperation.ConnectApps)},t.prototype.showTrialButton=function(){var e=this.services.userInfo;return!e.userFreeTrialExpired&&!e.userHasFreeTrial&&!e.isPremiumUser},t})();t.InsufficientLicenseBarController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.InsufficientLicenseBar={templateUrl:"components/insufficientLicenseBar/insufficientLicenseBar.html",bindings:{config:"<?"},controller:e.common.createController(e.controllers.InsufficientLicenseBarController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.services=t,this.showIntroduceAppBar=this.services.conceptualModelSetting.isAppsEnabled()}return t.createOptions=function(){return{additionalServices:["conceptualModelSetting","localizationService"]}},t.prototype.$onInit=function(){this.title=this.config&&this.config.title?this.config.title:this.services.localizationService.get("AppModel_IntroduceApp"),this.content=this.config&&this.config.content?this.config.content:this.services.localizationService.get("AppModel_IntroduceAppDescription"),this.learnMoreText=this.config&&this.config.learnMoreText?this.config.learnMoreText:this.services.localizationService.get("AppModel_WhatAreApps"),this.learnMoreLink=this.config&&this.config.learnMoreLink?this.config.learnMoreLink:e.constants.pbiAppsLink},t.prototype.hideBar=function(){this.showIntroduceAppBar=!1,this.config&&this.config.closeBarCallback&&this.config.closeBarCallback()},t})();t.IntroduceAppBarController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.IntroduceAppBar={templateUrl:"components/introduceAppBar/introduceAppBar.html",bindings:{config:"<?"},controller:e.common.createController(e.controllers.IntroduceAppBarController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService","modalDialogService"]}},e.prototype.$onInit=function(){var e=this.services.localizationService,t=_.map(this.dashboards,(function(t){return e.format("PersonalizeOrgApp_Dashboard",[t.displayName])})),i=_.map(this.models,(function(t){return e.format("PersonalizeOrgApp_Dataset",[t.displayName])})),o=_.map(this.reports,(function(t){return e.format("PersonalizeOrgApp_Report",[t.displayName])}));this.itemNames=t.concat(o).concat(i)},e.prototype.save=function(){this.services.modalDialogService.close(0)},e.prototype.cancel=function(){this.services.modalDialogService.close(1)},e})();e.MakeACopyDialogController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.MakeACopyDialog={templateUrl:"components/makeACopyDialog/makeACopyDialog.html",bindings:{titleKey:"<",messageKey:"<",itemsIntroKey:"<",dashboards:"<",reports:"<",models:"<"},controller:e.common.createController(e.controllers.MakeACopyDialogController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.modalDialogService=e}return e.prototype.show=function(e,t,i,o,r,a,n){var s={titleKey:t,messageKey:i,itemsIntroKey:o,dashboards:r,reports:a,models:n},c={dialogName:e,definitionTemplateCachePath:"components/makeACopyDialog/makeACopyDialogDefinition.html",bindings:s};return this.modalDialogService.showWebModalDialog(c)},e})();e.MakeACopyDialogBuilder=t})(t=e.dialogbuilders||(e.dialogbuilders={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.ContentProviderClientCategory,o="marketplaceActive",r=1e4,a="iframe#marketplaceFrame",n="{{saasMarketplaceUrl}}",s='<iframe name="marketplaceFrame" id="marketplaceFrame" sandbox="allow-scripts allow-popups allow-forms allow-same-origin" src="'+n+'"></iframe>',c=(function(){function t(e,t){this.services=t,this.iFrameLoadedOrTimeout=!1}return t.createOptions=function(){return{additionalServices:["$element","$rootScope","$timeout","$window","activeGroupId","applicationOptions","asyncFeatureSwitchService","localizationService","navigation","telemetryService"]}},t.prototype.$onInit=function(){var t=this;this.services.asyncFeatureSwitchService.getFeatureSwitches().then((function(i){i.saasMarketplace&&(t.listener=function(e){return t.receiveMessage(e)},t.marketplaceConnectListener=t.services.rootScope.$on(e.constants.saasMarketplace.initSaasMarketplaceEventName,(function(e){t.marketplaceIframe||t.init()})))}))},t.prototype.$onDestroy=function(){this.destroyIframeListener(),this.marketplaceConnectListener&&this.marketplaceConnectListener()},t.prototype.init=function(){var t=supportedSaasMarketplaceRedirects.split(";").map((function(e){return e.toLowerCase()})),o=this.services.navigation.stateService.params.saasMarketplace;if(o&&_.indexOf(t,o.toLowerCase())>=0?this.redirectRoot=o:this.redirectRoot=saasMarketplaceUrlOrigin,this.redirectRoot){this.marketplaceIframe=null;var r=this.services.navigation,a=r.providerName,n="getapps"===r.getDataViewName,s=e.contentProviderConstants.CategoryNameToEnumMap[r.categoryName],c=e.contentProviderConstants.saasMarketplacePublicCategory;s===i.Organizational&&(c=e.contentProviderConstants.saasMarketplacePrivateCategory);var l=this.services.localizationService.currentLanguageLocale,d="/embed/"+l;if(a)d+="/product/power-bi/"+a+"?product=power-bi";else if(s){var p=e.contentProviderConstants.saasMarketplacePrivateCategory;d+="/marketplace?product=power-bi&showPrivateApps="+(c===p?"true":"false")}else d+="/marketplace?product=power-bi&showPrivateApps=false";this.saasMarketplaceUrl=this.redirectRoot+d,this.hostData={},this.hostData.accessToken=window.powerBIAccessToken,this.hostData.correlationId=this.services.telemetryService.root.id,this.hostData.context={groupId:this.services.activeGroupId.headerActiveGroupObjectId};var u=this.services.applicationOptions.cpcode;u&&(this.hostData.context.cpcode=u),n===!0?this.hostData.backendUrlOverride=clusterUri+"/v1.0/orgapp":this.hostData.backendUrlOverride=clusterUri,this.connectToMarketplace()}},t.prototype.initListener=function(){this.services.$window.addEventListener("message",this.listener)},t.prototype.connectToMarketplace=function(){var e=this;this.initListener(),this.removeMarketplaceIframe();var t=$(s.replace(n,this.saasMarketplaceUrl)),i=this.services.$element;i.addClass(o).append(t);var r=i.find(a);r.load((function(){e.marketplaceIframe=r[0].contentWindow,e.postInitialMarketplaceContext()}))},t.prototype.removeMarketplaceIframe=function(){this.services.$element.find(a).remove()},t.prototype.disconnectMarketplace=function(){this.services.$element.removeClass(o),this.removeMarketplaceIframe()},t.prototype.postInitialMarketplaceContext=function(){var t=this;this.marketplaceIframe&&(this.iFrameLoadedOrTimeout=!1,this.marketplaceOpenEvent=this.services.telemetryService.startEvent(e.telemetry.MarketplaceEmbeddedOpened),this.services.$timeout((function(){!t.iFrameLoadedOrTimeout&&t.marketplaceOpenEvent&&(t.iFrameLoadedOrTimeout=!0,t.marketplaceOpenEvent.reject({errorCode:"Timeout",errorMessage:"Timeout after "+r.toString()+" ms"}))}),r),this.marketplaceIframe.postMessage({msgType:"loadMarketplace",hostData:this.hostData},"*"))},t.prototype.destroyIframeListener=function(){this.services.$window.removeEventListener("message",this.listener),this.disconnectMarketplace(),this.marketplaceIframe=null},t.prototype.receiveMessage=function(t){if(t&&t.origin&&!(this.services.$window.location.href.indexOf(t.origin)>=0)){!this.marketplaceIframe&&t.source&&(this.marketplaceIframe=t.source);var i=t.data;if(i&&i.msgType){var o=e.constants.saasMarketplace.actionTypes;switch(i.msgType){case o.acquireApp:i.data&&i.data.applicationId&&i.data.category&&(this.destroyIframeListener(),this.services.telemetryService.logEvent(e.telemetry.MarketplaceEmbeddedClosedWithAppAcquired),this.services.rootScope.$emit(e.constants.saasMarketplace.updateHostUrl,i.data.applicationId,i.data.category),this.services.rootScope.$emit(e.constants.saasMarketplace.acquireAppEventName,i.data.applicationId,i.data.category));break;case o.externalRedirect:break;case o.updateUrl:i.data&&i.data.applicationId&&i.data.category&&this.services.rootScope.$emit(e.constants.saasMarketplace.updateHostUrl,i.data.applicationId,i.data.category);break;case o.closeSaasMarketplace:this.destroyIframeListener(),this.services.telemetryService.logEvent(e.telemetry.MarketplaceEmbeddedClosedWithoutAppAcquired);var r=this.services.navigation;"getapps"===r.getDataViewName?r.navigateToApps():r.showGetDataSlider();break;case o.finishedLoadingContentProviderList:!this.iFrameLoadedOrTimeout&&this.marketplaceOpenEvent&&(this.iFrameLoadedOrTimeout=!0,this.marketplaceOpenEvent.resolve())}}}},t})();t.MarketplaceHostController=c})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.MarketplaceHost={controller:e.common.createController(e.controllers.MarketplaceHostController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.NavigationPaneExpandSettingKey="NavExpanded";var i=5,o=(function(){function o(e,t){var i=this;this.services=t,this.getExpandButtonTitle=function(){return i.isExpanded?i.services.localizationService.get("NavigationPane_Minimize"):i.services.localizationService.get("NavigationPane_Expand")},this.navigation=t.navigation,this.home=t.home,this.groupService=t.groupService,this.rootScope=t.rootScope}return o.createOptions=function(){return{additionalServices:["conceptualModelSetting","navigation","home","groupService","telemetryService","localizationService","$rootScope","userSettingsService","featureSwitchService","shellCapabilities"]}},o.prototype.$onInit=function(){var t=this;this.rootScope.$on(e.constants.groupSwitchedEventName,(function(){return t.updateButtonVisibility()})),this.initializeIsExpanded(),this.updateButtonVisibility(!0)},o.prototype.navigateToApps=function(){this.onGroupSwitcherToggled(!1),this.services.navigation.navigateToApps()},o.prototype.navigateToFavorites=function(){this.onGroupSwitcherToggled(!1),this.services.navigation.navigateToFavorites()},o.prototype.navigateToRecentlyViewed=function(){this.onGroupSwitcherToggled(!1),this.services.navigation.navigateToRecentlyViewed()},o.prototype.navigateToOnlySharedWithMe=function(){this.onGroupSwitcherToggled(!1),this.services.navigation.navigateToSharedWithMe()},o.prototype.navigateToGetData=function(){this.onGroupSwitcherToggled(!1),this.services.telemetryService.logEvent(e.telemetry.DashboardOpenGetDataPage,e.telemetry.OpenGetDataPageInteraction.NavigatorPaneAddDatasetButton),this.services.navigation.showGetDataSlider()},o.prototype.navigateToWorkspaces=function(){this.onGroupSwitcherToggled(!1),this.services.navigation.navigateToWorkspaces()},o.prototype.isOnApps=function(){return this.services.navigation.inAppsView()},o.prototype.isOnFavorites=function(){return this.services.navigation.inFavoritesView()},o.prototype.isOnRecentlyViewed=function(){return this.services.navigation.inRecentlyViewedView()},o.prototype.isOnSharedWithMe=function(){return this.services.navigation.inSharedWithMePath()},o.prototype.isOnWorkspace=function(){return!(this.isOnSharedWithMe()||this.isOnRecentlyViewed()||this.isOnFavorites()||this.isOnApps()||this.isOnWorkspaces())},o.prototype.isOnWorkspaces=function(){return this.services.navigation.inWorkspacesView()},o.prototype.isAppsEnabled=function(){return this.services.conceptualModelSetting.isAppsEnabled()},o.prototype.onToggleClicked=function(){this.toggleNavigationPane(),this.onGroupSwitcherToggled(!1);var i=this.services.telemetryService.startEvent(e.telemetry.NavigationToggle,this.isExpanded);this.services.userSettingsService.updateExtendedSettings(t.NavigationPaneExpandSettingKey,this.isExpanded,i)},o.prototype.onGroupSwitcherToggled=function(e){void 0===e&&(e=!this.isGroupSwitcherExpanded),this.isGroupSwitcherExpanded=e,e&&!this.isExpanded&&this.toggleNavigationPane(!0)},Object.defineProperty(o.prototype,"shouldShowLargeGroupList",{get:function(){return this.groupService.groups.length>i},enumerable:!0,configurable:!0}),o.prototype.updateButtonVisibility=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.groupService.ensureGroupsInitialization()];case 1:return r.sent(),[4,this.services.shellCapabilities.ensureCapabilitiesInitialized()];case 2:return r.sent(),e=this.groupService.activeGroup,i=this.services.shellCapabilities.getCapabilities(),o=!e.contract.isReadOnly||e.contract.isOwner,this.showGetDataBtn=i.navPane.showGetData&&o,this.showQuickAccessPane=i.navPane.showQuickAccessPane&&!!e,t&&(this.showGroupSwitcher=i.navPane.showGroupSwitcher),[2]}}))}))},o.prototype.toggleNavigationPane=function(e){this.isExpanded=void 0===e?!this.isExpanded:e;var t={isExpanded:this.isExpanded};this.onToggled&&this.onToggled(t)},o.prototype.initializeIsExpanded=function(){var e=this,i=this.services.navigation.collapseNavigation;void 0!==i?(this.isExpanded="true"!==i.toLowerCase(),this.toggleNavigationPane(this.isExpanded)):this.services.userSettingsService.getExtendedSettingByKey(t.NavigationPaneExpandSettingKey).then((function(t){null!=t&&_.isBoolean(t)&&(e.isExpanded=t),e.toggleNavigationPane(e.isExpanded)}))},o})();t.NavigationPaneV2Controller=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.NavigationPaneV2={templateUrl:"components/navigationPaneV2/navigationPaneV2.html",controller:e.common.createController(e.controllers.NavigationPaneV2Controller),bindings:{onToggled:"&",isExpanded:"<"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.models.factory.ArtifactSortPredicates,o=e.helpers.ContentTileHelper,r=5,a=(function(){function e(e,t){this.services=t,this.oldExpandedState=!1,this.isExpanded=!1,this.items=[],this.showRecent=!0,this.sortPredicate=i.TitleAlphabeticalPredicate}return e.createOptions=function(){return{additionalServices:["contentList","favorites","groupService","mostRecentlyUsedService"]}},e.prototype.$onInit=function(){var e=this;this.showRecent||(this.favoritesListener={onFavoriteAdded:void 0,onFavoriteDeleted:void 0,onFavoritesReset:function(){return e.loadFavorites()}},this.services.favorites.subscribe(this.favoritesListener))},e.prototype.$onDestroy=function(){this.favoritesListener&&this.services.favorites.unsubscribe(this.favoritesListener)},e.prototype.openContent=function(e){o.openContentTile(e,this.services.groupService,this.services.contentList),this.isExpanded=!1},e.prototype.mouseDownToggle=function(){this.oldExpandedState=this.isExpanded},e.prototype.navigateToArea=function(){this.isExpanded=!1,this.navigateTo()},e.prototype.toggleFlyout=function(){this.oldExpandedState||(this.showRecent?this.loadRecents():this.loadFavorites(),this.isExpanded=!0)},e.prototype.getActualType=function(e){return o.getActualType(e)},e.prototype.loadFavorites=function(){var e=this,t=this.services.favorites.favoritesCache;t&&(this.items=_(t).sortBy((function(t){return t.hasOwnProperty(e.sortPredicate.columnName)?t[e.sortPredicate.columnName].toLocaleLowerCase():""})).take(r).value())},e.prototype.loadRecents=function(){var e=this;this.services.mostRecentlyUsedService.getMRUModels().then((function(t){e.items=_(t).take(r).value()}))},e})();t.NavPaneFlyoutButtonController=a})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.NavPaneFlyoutButton={templateUrl:"components/navPaneFlyoutButton/navPaneFlyoutButton.html",controller:e.common.createController(e.controllers.NavPaneFlyoutButtonController),bindings:{icon:"@",label:"@",navigateTo:"&",onToggled:"&",showRecent:"<?"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.ok=function(){this.services.modalDialogService.close(0)},e.prototype.close=function(){this.services.modalDialogService.close(1)},e})();e.PopupNotificationDialogController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.PopupNotificationDialog={templateUrl:"components/popupNotificationDialog/popupNotificationDialog.html",bindings:{config:"<"},controller:e.common.createController(e.controllers.PopupNotificationDialogController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.modalDialogService=e}return e.prototype.show=function(e,t){var i={config:t},o={dialogName:e,definitionTemplateCachePath:"components/popupNotificationDialog/popupNotificationDialogDefinition.html",bindings:i};return this.modalDialogService.showHostModalDialog(o)},e})();e.PopupNotificationDialogBuilder=t})(t=e.dialog||(e.dialog={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){var i=this;this.scope=e,this.services=t,this.imageLoaded=!1,this.scope.$watch((function(){return i.source}),(function(e){e&&!i.disableAnimation&&(i.imageLoaded=!1)}))}return t.createOptions=function(){return{additionalServices:["localizationService"]}},t.prototype.onLoad=function(){this.imageLoaded=!0},t.prototype.onError=function(){this.scope.$emit(e.common.constants.tileErrorEventName,this.services.localizationService.get("Tile_ErrorText"))},t})();t.PrintableImageController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.PrintableImage={controller:e.common.createController(e.controllers.PrintableImageController),bindings:{source:"@",disableAnimation:"<?"},templateUrl:"components/printableImage/printableImage.html"}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.RealTimeMode,o=(function(){function t(e,t){this.$scope=e,this.services=t,this.paneExpanded=!1,this.dashboardsExpanded=!0,this.reportsExpanded=!0,this.workbooksExpanded=!0,this.datasetsExpanded=!0,this.isInitialized=!1,this.groupService=t.groupService,this.navigation=t.navigation}return t.createOptions=function(){return{additionalServices:["contentList","groupService","localizationService","navigation","navigationActions","promiseFactory","quota","permissionService"]}},Object.defineProperty(t.prototype,"isActiveWorkspaceReadOnly",{get:function(){return this.services.permissionService.isActiveWorkspaceIsReadOnly},enumerable:!0,configurable:!0}),t.prototype.openItem=function(e){this.closeMenus(),this.services.contentList.openContent(e,this.services.navigation.currentGroupGUID)},t.prototype.openModel=function(e){this.closeMenus(),e.realTimeMode&&e.realTimeMode!==i.PersistAndCache||this.services.navigationActions.openModel(e)},t.prototype.togglePane=function(){this.paneExpanded=!this.paneExpanded,this.paneExpanded&&!this.isInitialized&&this.initialize()},t.prototype.toggleDashboards=function(){this.dashboardsExpanded=!this.dashboardsExpanded},t.prototype.toggleReports=function(){this.reportsExpanded=!this.reportsExpanded},t.prototype.toggleWorkbooks=function(){this.workbooksExpanded=!this.workbooksExpanded},t.prototype.toggleDatasets=function(){this.datasetsExpanded=!this.datasetsExpanded},t.prototype.navigateToContentList=function(){this.closeMenus(),this.services.navigation.navigateToContentList(this.groupService.activeGroupObjectId,!1,null,null,!1)},t.prototype.initialize=function(){var t=this;this.updateCurrentObject(),this.updateObjects(),this.services.navigationActions.initialize(),this.reportListener=this.services.contentList.subscribeReports((function(){return t.updateState()})),this.dashboardListener=this.services.contentList.subscribeDashboards((function(){return t.updateState()})),this.modelListener=this.services.contentList.subscribeModels((function(){return t.updateState()})),this.workbookListener=this.services.contentList.subscribeWorkbooks((function(){return t.updateState()})),this.$scope.$root.$on(e.common.constants.navigation.stateChangeSuccess,(function(e,i,o,r,a){return t.updateCurrentObject()})),this.$scope.$root.$on(e.constants.groupSwitchedEventName,(function(){t.updateCurrentObject(),t.updateObjects()})),this.isInitialized=!0},t.prototype.$onDestroy=function(){this.unregisterListeners()},t.prototype.updateState=function(){this.updateObjects(),this.updateCurrentObject()},t.prototype.unregisterListeners=function(){this.isInitialized&&(this.services.contentList.unsubscribeReports(this.reportListener),this.services.contentList.unsubscribeDashboards(this.dashboardListener),this.services.contentList.unsubscribeModels(this.modelListener),this.services.contentList.unsubscribeWorkbooks(this.workbookListener))},t.prototype.updateCurrentObject=function(){this.services.navigation.inDashboardView()?this.currentObjectId=this.services.navigation.currentDashboardGUID:this.services.navigation.inWorkbookView()?this.currentObjectId=this.services.navigation.currentWorkbookURLIdentifier:this.services.navigation.inReportView()?this.currentObjectId=this.services.navigation.currentReportGUID:this.services.navigation.inDatasetView()?this.currentObjectId=this.services.navigation.currentDatasetDBName:this.currentObjectId=null},t.prototype.updateObjects=function(){this.updateDashboards(),this.updateDatasets(),this.updateReports(),this.updateWorkbooks()},t.prototype.updateReports=function(){var e=this;this.services.contentList.getReports().then((function(t){return e.reports=e.filterItems(t)}))},t.prototype.updateDashboards=function(){var e=this;this.services.contentList.getDashboards().then((function(t){return e.dashboards=e.filterItems(t)}))},t.prototype.updateDatasets=function(){var e=this;this.services.contentList.getDatasets().then((function(t){return e.datasets=e.filterItems(t)}))},t.prototype.updateWorkbooks=function(){var e=this;this.services.contentList.getWorkbooks().then((function(t){return e.workbooks=e.filterItems(t)}))},t.prototype.filterItems=function(e){var t=this;return _(e).filter((function(e){return t.services.contentList.isVisibleAndOwned(e)})).sortBy((function(e){return e.displayName.toLocaleLowerCase()})).value()},t})();t.QuickAccessPaneController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.QuickAccessPane={templateUrl:"components/quickAccessPane/quickAccessPane.html",controller:e.common.createController(e.controllers.QuickAccessPaneController),bindings:{selected:"<",closeMenus:"&"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.contracts.TileType,o=(function(){
function t(e,t){this.services=t,this.scope=e}return t.createOptions=function(){return{additionalServices:["dataProxy","realTimeData","conceptualSchemaProxy","telemetryService","modelService"],scopedDependencies:["visualQueryGenerator"]}},t.prototype.$onInit=function(){var e=this,t=this.services;this.viewModel.setRealTimeModelDependencies(t.dataProxy,t.visualQueryGenerator,t.conceptualSchemaProxy,t.realTimeData,t.modelService),this.viewModel.onErrorDelegate=function(){return e.onErrorChanged()},this.viewModel.initialize()},t.prototype.$onDestroy=function(){var e=this.services,t=e.realTimeData,i=this.viewModel;i&&i.realTimeModelId&&t.unsubscribe(i.realTimeModelId,i)},t.prototype.onErrorChanged=function(){var t=this.viewModel;t&&(t.isError?(this.services.telemetryService.logEvent(e.telemetry.DashboardTileError,i[i.realTime],t.errorText),this.scope.$emit(e.common.constants.tileErrorEventName,t.errorText,t.errorDetails)):this.scope.$emit(e.common.constants.clearTileErrorEventName))},t})();t.RealTimeTileController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.RealTimeTile={bindings:{viewModel:"="},controller:e.common.createController(e.controllers.RealTimeTileController),templateUrl:"components/realTimeTile/realTimeTile.html"}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.models.factory.ArtifactSortPredicates,o=e.telemetry.SelectSort,r=20,a=(function(){function t(t,o){var a=this;this.services=o,this.recentlyUsedArtifacts=[],this.sortPredicateMap={},this.filteredRecentlyUsedArtifacts=[],this.searchText="",this.sortPredicate=i.LastAccessReverseDatePredicate,this.showWatermarkConfig=!1,this.selectSort=function(t){a.sortPredicate=t;var i=a.sortPredicateMap[t.toAngularFilter()];a.services.telemetryService.logEvent(e.telemetry.ContentListSelectSort,i),a.updateRecentlyUsedArtifacts()},this.services.mostRecentlyUsedService.getMRUModels().then((function(t){for(var i=Math.min(t.length,r),o=function(i){var o=t[i];o.displayDoNotExistDialogAndRemove=function(){var t=a.getArtifactLocStringValue(o.type);e.helpers.ArtifactNotFoundHelper.showArtifactDoesNotExistDialog(t,a.services.errorService,a.services.localizationService,a.services.telemetryService),a.services.mostRecentlyUsedService.removeMRU(o.objectId,o.workspaceId),_.remove(a.recentlyUsedArtifacts,(function(e){return e.objectId===o.objectId&&e.workspaceId===o.workspaceId})),a.updateRecentlyUsedArtifacts()},a.recentlyUsedArtifacts.push(o)},n=0;n<i;n++)o(n);a.filteredRecentlyUsedArtifacts=a.recentlyUsedArtifacts,a.updateRecentlyUsedArtifacts()})),this.galleryViewModel={getTiles:function(){return a.filteredRecentlyUsedArtifacts},tabType:16,finishLoadEvent:e.constants.contentListRecentlyUsedLoadedEvent,collapsiblePaneMode:null},this.sortPredicates=e.models.factory.SelectTileSortItemsFactory.createPredicates(this.services.localizationService,16)}return t.createOptions=function(){return{additionalServices:["errorService","localizationService","mostRecentlyUsedService","telemetryService"]}},t.prototype.$onInit=function(){this.sortPredicateMap=(e={},e[i.TitleAlphabeticalPredicate.toAngularFilter()]=o.TitleAlpabetical,e[i.TitleReverseAlphabeticalPredicate.toAngularFilter()]=o.TitleReverseAlphabetical,e[i.LastAccessReverseDatePredicate.toAngularFilter()]=o.LastAccessReverseDate,e),this.emptySearchWatermarkConfig={canEdit:!0,mode:!1,contentNonShared:this.services.localizationService.get("ContentList_EmptySearchResults"),imgClass:"empty-search-img"},this.emptyRecentWatermarkConfig={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptyRecentTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptyRecentMessage"),imgClass:"empty-recent-img"};var e},t.prototype.ensureSearchTelemetry=function(){this.searchTelemetry||_.isEmpty(this.searchText)||(this.searchTelemetry=this.services.telemetryService.startEvent(e.telemetry.ContentListSearch)),this.updateRecentlyUsedArtifacts()},t.prototype.resolveSearchTelemetry=function(){this.searchTelemetry&&(this.searchTelemetry.resolve(),this.searchTelemetry=null)},t.prototype.searchProperties=function(e,t){return this.containsSubstring(e.displayName,t.toLocaleLowerCase())},t.prototype.compareDates=function(e,t){return e>t?-1:e<t?1:0},t.prototype.containsSubstring=function(e,t){return!!e&&_.contains(e.toLocaleLowerCase(),t)},t.prototype.updateRecentlyUsedArtifacts=function(){var e=this,t=_.filter(this.recentlyUsedArtifacts,(function(t){return e.searchProperties(t,e.searchText)}));switch(this.sortPredicate){case i.TitleAlphabeticalPredicate:t.sort((function(e,t){return e.displayName.localeCompare(t.displayName)}));break;case i.TitleReverseAlphabeticalPredicate:t.sort((function(e,t){return t.displayName.localeCompare(e.displayName)}));break;case i.LastAccessReverseDatePredicate:default:t.sort((function(t,i){return e.compareDates(t.lastAccess,i.lastAccess)}))}this.filteredRecentlyUsedArtifacts=t,this.updateWatermark()},t.prototype.updateWatermark=function(){this.showWatermarkConfig=_.isEmpty(this.filteredRecentlyUsedArtifacts),this.showWatermarkConfig&&(this.watermarkConfig=_.isEmpty(this.searchText)?this.emptyRecentWatermarkConfig:this.emptySearchWatermarkConfig)},t.prototype.getArtifactLocStringValue=function(t){switch(t){case e.models.MRUArtifactType.Dashboards:return"ArtifactKind_Dashboard";case e.models.MRUArtifactType.Reports:return"ArtifactKind_Report";case e.models.MRUArtifactType.Workbooks:return"ArtifactKind_Workbook";case e.models.MRUArtifactType.AppInstance:return"Artifact_InstalledApp";default:return""}},t})();t.RecentlyViewedContainerController=a})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.RecentlyViewedContainer={templateUrl:"components/recentlyViewedContainer/recentlyViewedContainer.html",controller:e.common.createController(e.controllers.RecentlyViewedContainerController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.$scope=e,this.services=t,this.dropdownOpen=!1}return t.createOptions=function(){return{additionalServices:["$document","overlayService"]}},t.prototype.toggleDropdown=function(t){var i=this,o=this.services.$document.find(t.delegateTarget),r=o.find(".js-anchor"),a=this.services.overlayService.getOverlayElement(this.overlayName);this.services.overlayService.toggleDropdown(t,{anchorElement:r,element:a,preferLeft:!0,horizontal:!1}),this.dropdownOpen=!this.dropdownOpen,this.dropdownOpen&&a.on(e.common.constants.OverlayCloseEventName,(function(){i.$scope.$applyAsync((function(){a.off(e.common.constants.OverlayCloseEventName),i.dropdownOpen=!1}))}))},t})();t.SelectButtonController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.SelectButton={transclude:!0,bindings:{overlayName:"@"},templateUrl:"components/selectButton/selectButton.html",controller:e.common.createController(e.controllers.SelectButtonController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.PermissionArtifactType,o=(function(){function e(e,t){this.Dashboard=i.Dashboard,this.Report=i.Report,this.Workbook=i.Workbook,this.Dataset=i.Dataset,this.overlayService=t.overlayService}return e.createOptions=function(){return{additionalServices:["overlayService"]}},e.prototype.isSelectedType=function(e){return(this.selectedType&e)===e},Object.defineProperty(e.prototype,"showContentFilter",{get:function(){return this._showContentFilter},enumerable:!0,configurable:!0}),e})();t.SelectArtifactFilterController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.SelectArtifactFilter={bindings:{selectedType:"<",selectType:"&onSelectType"},templateUrl:"components/selectArtifactFilter/selectArtifactFilter.html",controller:e.common.createController(e.controllers.SelectArtifactFilterController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.services=t,this.titleDropdownItem={text:this.services.localizationService.get("SortBy"),type:DropDownMenuItemType.Title,predicate:void 0,containerClass:"dropdownListHeader"}}return t.createOptions=function(){return{additionalServices:["dropdown","localizationService","overlayService"]}},t.prototype.$onInit=function(){this.updateDropdownItems(),this.updateTitle()},t.prototype.$onChanges=function(e){e.predicates&&this.updateDropdownItems(),e.selectedPredicate&&this.updateTitle()},t.prototype.showDropdownItems=function(t){var i=this;if(this.dropdownOpen)return void this.services.dropdown.hideAll();var o=$(t.currentTarget).children(".anchorContainer"),r=[this.titleDropdownItem].concat(this.dropdownItems);e.common.DropdownUtils.showLegacyDropdownItems(this.services.dropdown,"selectTileSortDropdownMenu",r,"selectTileSortDropdownMenu",(function(e){return i.onCreateDropdownMenuItemSelected(e)}),{anchorElement:o,horizontal:!1,preferLeft:!0},(function(){return i.dropdownOpen=!1})),this.dropdownOpen=!0},t.prototype.updateDropdownItems=function(){this.dropdownItems=_.isEmpty(this.predicates)?e.models.factory.SelectTileSortItemsFactory.createDefaultPredicates(this.services.localizationService):this.predicates;var t=_.find(this.dropdownItems,{predicate:this.selectedPredicate});t||(t=this.dropdownItems[0],this.onSelect()(t.predicate)),this.setItemAsChecked(t)},t.prototype.updateTitle=function(){var e=_.find(this.dropdownItems,{predicate:this.selectedPredicate});e&&(this.title=e.text,this.setItemAsChecked(e))},t.prototype.onCreateDropdownMenuItemSelected=function(e){e.predicate&&(this.setItemAsChecked(e),this.onSelect()(e.predicate),this.services.overlayService.hideAllDropdowns(),this.dropdownOpen=!1)},t.prototype.setItemAsChecked=function(e){this.dropdownItems.forEach((function(e){return e.checked=!1})),e.checked=!0},t})();t.SelectTileSortController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.SelectTileSort={bindings:{selectedPredicate:"<",onSelect:"&",predicates:"<?"},templateUrl:"components/selectTileSort/selectTileSort.html",controller:e.common.createController(e.controllers.SelectTileSortController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.AllSharedOwnerObjectId="";var t=(function(){function t(i,o,r){i?(this.userObjectId=i.ownerUserObjectId,this.groupObjectId=i.ownerGroupObjectId,this.fullname=i.ownerFullname,this.mail=i.ownerMail,this.objectId=t.getDashboardOwnerId(i),this.name=this.fullname||this.mail,this.userInfoService=o):(this.objectId=e.AllSharedOwnerObjectId,this.name=r?r.get("SharedBy_AllShared"):"All Shared")}return t.getDashboardOwnerId=function(e){return e.ownerUserObjectId||e.ownerGroupObjectId},Object.defineProperty(t.prototype,"icon",{get:function(){return this.iconString||!this.userInfoService||this.photoRequestSent||this.getIcon(this.userInfoService),this.iconString},enumerable:!0,configurable:!0}),t.prototype.isUser=function(){return null!=this.userObjectId},t.prototype.getIcon=function(e){var t=this,i=this.isUser()?e.findOrGetUserPhoto(this.userObjectId):e.getGroupIcon(this.groupObjectId);i.then((function(e){t.iconString=e})),this.photoRequestSent=!0},t})();e.OwnerInfo=t})(t=e.sharedByColumn||(e.sharedByColumn={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.models.sharedByColumn.OwnerInfo,o=(function(){function e(e,t){var o=this;this.dashboardToOwnerInfo={},this.services=t,this.defaultOwnerInfos=[new i((void 0),(void 0),this.services.localizationService)],this.ownerInfos=this.defaultOwnerInfos,this.services.dashboardService.dashboardsOwnersMergedPromise().finally((function(){o.updateOwnerInfos(),o.ownerInfoMerged=!0}))}return e.createOptions=function(){return{additionalServices:["dashboardService","localizationService","userInfo"]}},Object.defineProperty(e.prototype,"showSpinner",{get:function(){return!this.ownerInfoMerged},enumerable:!0,configurable:!0}),e.prototype.$onChanges=function(e){e.sharedDashboards&&this.updateOwnerInfos()},e.prototype.getOrCreateOwnerInfo=function(e){var t=i.getDashboardOwnerId(e);if(t)return this.dashboardToOwnerInfo[t]||(this.dashboardToOwnerInfo[t]=new i(e,this.services.userInfo)),this.dashboardToOwnerInfo[t]},e.prototype.updateOwnerInfos=function(){var e=this,t=_.map(this.sharedDashboards,(function(t){return e.getOrCreateOwnerInfo(t)}));t=_(t).compact().uniq("objectId").sortBy((function(e){return e.name.toLocaleLowerCase()})).value(),this.ownerInfos=this.defaultOwnerInfos.concat(t)},e})();t.SharedByColumnController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.SharedByColumn={templateUrl:"components/sharedByColumn/sharedByColumn.html",controller:e.common.createController(e.controllers.SharedByColumnController),bindings:{sharedDashboards:"<",selectedOwner:"<",onSelectedOwnerChanged:"&"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.models.factory.ArtifactSortPredicates,o=e.models.OwnershipFilterMenuFilter,r=e.telemetry.SelectSort,a=e.common.contracts.ContentTileType,n=(function(){function t(t,r){var n=this;if(this.services=r,this.sortPredicateMap={},this.allTypes=a.Dashboard|a.Report|a.Workbook,this.allDashboards=[],this.sharedDashboardsAll=[],this.sharedDashboardsPrefiltered=[],this.sharedDashboardsFiltered=[],this.dashboardCount=0,this.searchText="",this.sortPredicate=i.TitleAlphabeticalPredicate,this.typeFilter=this.allTypes,this.ownership=o.SharedWithMe,this.galleryViewModel={},this.initializeArtifacts=function(){var e=n.services.contentList,t=e.getDashboards();n.dashboardsLoadedDefer=n.services.promiseFactory.defer(),n.contentListDataReadyPromise=t.then((function(e){n.allDashboards=e,n.updateArtifacts()})),n.groupService.ensureGroupsInitialization(),n.services.contentList.dashboardsOwnersMergedPromise(),n.initOnAppMetadata()},this.onSortPredicateChanged=function(t){n.sortPredicate=t;var i=n.sortPredicateMap[t.toAngularFilter()];n.services.telemetryService.logEvent(e.telemetry.ContentListSelectSort,i),n.filterArtifacts(!1),n.persistFilter()},this.onSearchTextChange=function(){n.selectedSharedByOwner=e.models.sharedByColumn.AllSharedOwnerObjectId,n.filterArtifacts(!0),n.ensureSearchTelemetry()},this.startTelemetry=function(){n.scope.$on(e.constants.contentListDashboardsLoadedEvent,(function(){n.dashboardsLoadedDefer.resolve(null)}));var t=n.telemetryService.startActivity(n.scope,e.telemetry.ContentListLoaded);n.telemetryService.logEvent(e.telemetry.ContentListArtifactsCount,n.allDashboards?n.allDashboards.length:-1,0,0),n.dashboardsLoadedDefer.promise.then((function(){t.resolve(),n.groupService.resolveGroupSwitchTelemetry()}))},this.resolveTelemetry=function(e,t,i){return 0===n[t]&&n[i].resolve(null),e},this.ensureSearchTelemetry=function(){n.searchTelemetry||_.isEmpty(n.searchText)||(n.searchTelemetry=n.telemetryService.startEvent(e.telemetry.ContentListSearch))},this.resolveSearchTelemetry=function(){n.searchTelemetry&&(n.searchTelemetry.resolve(),n.searchTelemetry=null)},this.emptySharedDashboards={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptySharedWithMeTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptySharedWithMeMessage"),imgClass:"empty-shared-with-me-img"},this.emptySearch={canEdit:!0,mode:!1,linkDescription:this.services.localizationService.get("ContentList_EmptySearchResults_SearchRedirectDescription"),linkText:this.services.localizationService.format("SearchIn",[this.services.localizationService.get("NavigationPane_Groups_MyWorkspace")]),linkAction:function(){return n.switchWorkspaceFromEmptySearch()},imgClass:"empty-search-img"},this.scope=t,this.navigation=r.navigation,this.localizationService=r.localizationService,this.groupService=r.groupService,this.telemetryService=r.telemetryService,this.groupHttp=r.groupHttp,this.ownershipService=r.ownership,this.rootScope=r.rootScope,this.modalDialogService=r.modalDialogService,this.userActivityContextService=r.userActivityContextService,this.selectedSharedByOwner=e.models.sharedByColumn.AllSharedOwnerObjectId,this.groupService.activeGroupObjectId!==e.constants.myWorkSpaceGroupId){var s=_.find(this.groupService.groups,(function(e){return e.isMyWorkspace})),c=this.services.telemetryService.startEvent(e.telemetry.GroupsSwitchGroup,s.aadGroupId);this.groupService.switchGroup(s,!1,c,!0).then((function(){n.services.navigation.navigateToSharedWithMe(),n.groupSwitchComplete=!0}))}else this.groupSwitchComplete=!0;this.initializeArtifacts();var l={onDashboardAdded:function(e){return n.updateArtifacts()},onDashboardDeleted:function(e){return n.updateArtifacts()},onDashboardsReset:function(){return n.updateArtifacts()}};this.services.dashboardDataService.subscribe(l);var d=this.rootScope.$on(e.constants.updateSharedWithMe,(function(){return n.updateArtifacts()})),p=this.rootScope.$on(e.constants.groupSwitchedEventName,this.initializeArtifacts),u=this.services.rootScope.$on(e.common.constants.navigation.stateChangeSuccess,(function(e,t,i,o,r){return n.handleStateChange(t,i,o,r)}));this.scope.$on(e.common.constants.scopeDestroyEventName,(function(){n.services.dashboardDataService.unsubscribe(l),d(),p(),u()}))}return t.createOptions=function(){return{additionalServices:["$window","$rootScope","appMetadataService","conceptualModelSetting","contentList","groupService","navigation","promiseFactory","ownership","localizationService","telemetryService","groupHttp","modalDialogService","filterPersistenceService","userActivityContextService","modelService","userInfo","dashboardDataService","usageMetricsReport","featureSwitchService","permissionService"]}},t.prototype.$onInit=function(){this.activeTab=64,this.updateSortPredicates(),this.updateGalleryViewModel(),this.sortPredicateMap[i.TitleAlphabeticalPredicate.toAngularFilter()]=r.TitleAlpabetical,this.sortPredicateMap[i.TitleReverseAlphabeticalPredicate.toAngularFilter()]=r.TitleReverseAlphabetical,this.sortPredicateMap[i.OwnerAlphabeticalPredicate.toAngularFilter()]=r.OwnerAlphabetical,this.sortPredicateMap[i.OwnerReverseAlphabeticalPredicate.toAngularFilter()]=r.OwnerReverseAlphabetical,this.sortPredicateMap[i.SharedTimePredicate.toAngularFilter()]=r.SharedTime,this.sortPredicateMap[i.SharedReverseTimePredicate.toAngularFilter()]=r.SharedReverseTime,this.processSharedWithMeParameter(),this.initialized=!0},Object.defineProperty(t.prototype,"showSpinner",{get:function(){return!this.initialized||!this.groupSwitchComplete},enumerable:!0,configurable:!0}),t.prototype.hasSufficientLicense=function(){return this.services.userInfo.isPremiumUser},t.prototype.processSharedWithMeParameter=function(){this.navigation.searchText&&(this.searchText=this.navigation.searchText),this.sortPredicate=i.SharedReverseTimePredicate},t.prototype.handleStateChange=function(e,t,i,o){this.processSharedWithMeParameter()},t.prototype.initOnAppMetadata=function(){var e=this;this.services.appMetadataService.getAppMetadata().then((function(){e.initialized=!0}))},t.prototype.updateArtifacts=function(){var e=this;this.sharedDashboardsAll=_.filter(this.allDashboards,(function(t){return e.ownershipService.isResourceSharedWithMe(t)&&!t.isHidden})),this.dashboardsArePresent=!_.isEmpty(this.sharedDashboardsAll),this.filterArtifacts(!0)},t.prototype.filterArtifacts=function(t){var i=this,o=_(this.sharedDashboardsAll);this.searchText&&(o=o.filter((function(e){return i.containsSearchText(e)}))),t&&(this.sharedDashboardsPrefiltered=o.value()),this.selectedSharedByOwner!==e.models.sharedByColumn.AllSharedOwnerObjectId&&(o=o.filter((function(t){return i.selectedSharedByOwner===e.models.sharedByColumn.OwnerInfo.getDashboardOwnerId(t)}))),o=o.sortByOrder(this.sortPredicate.columnName,!this.sortPredicate.reverse),this.sharedDashboardsFiltered=o.value(),this.dashboardCount=this.sharedDashboardsFiltered.length,this.hasResults=this.dashboardCount>0},t.prototype.containsSearchText=function(e){var t=this.searchText.toLocaleLowerCase();return this.containsSubstring(e.displayName,t)||this.containsSubstring(e.ownerFullname,t)},t.prototype.onSelectedOwnerChanged=function(e){this.selectedSharedByOwner=e,this.filterArtifacts(!1)},t.prototype.containsSubstring=function(e,t){return!!e&&_.contains(e.toLocaleLowerCase(),t)},t.prototype.$postLink=function(){this.contentListDataReadyPromise.then(this.startTelemetry)},t.prototype.persistFilter=function(){this.services.filterPersistenceService.setFilter(this.navigation.currentGroupGUID,{contentTileType:this.typeFilter,ownershipFilter:this.ownership,sortPredicate:this.sortPredicate.toAngularFilter()})},t.prototype.switchWorkspaceFromEmptySearch=function(){this.services.navigation.navigateToContentList(e.constants.myWorkSpaceGroupId,!0,null,null,!1,this.searchText)},t.prototype.updateSortPredicates=function(){this.sortPredicates=e.models.factory.SelectTileSortItemsFactory.createPredicates(this.localizationService,64)},t.prototype.updateGalleryViewModel=function(){var t=this;this.galleryViewModel.tabType=64,this.galleryViewModel.collapsiblePaneMode=this.collapsiblePaneMode,this.galleryViewModel.getTiles=function(){return t.sharedDashboardsFiltered},this.galleryViewModel.finishLoadEvent=e.constants.contentListDashboardsLoadedEvent},t.prototype.getNumberOfShownTabItems=function(){return this.dashboardCount},t.prototype.getWatermarkConfig=function(){return _.isEmpty(this.searchText)||0!==this.dashboardCount?this.dashboardsArePresent?void 0:this.emptySharedDashboards:this.emptySearch},t.prototype.shouldShowWatermark=function(){return!this.showSpinner&&(!_.isEmpty(this.searchText)&&0===this.dashboardCount||!this.dashboardsArePresent)},t})();t.SharedWithMeContainerController=n})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.SharedWithMeContainer={templateUrl:"components/sharedWithMeContainer/sharedWithMeContainer.html",controller:e.common.createController(e.controllers.SharedWithMeContainerController),bindings:{collapsiblePaneMode:"<"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,o,r){var a=[];e.canOpen&&a.push(i(e.openActionType,e.openActionDescription,o,t,r)),e.canShowAlerts&&a.push({text:r.get("ManageAlerts_Tooltip"),iconClass:"pbi-glyph-bell",buttonClass:"vcAlertBtn",action:function(e){return o.alerts(e)}}),e.canExport&&a.push({text:r.get("ExportToExcel"),iconClass:"pbi-glyph-export",buttonClass:"vcExportBtn",action:function(e){return o.export(e)}}),e.canEdit&&a.push({text:r.get("TileEditor_PaneTitle_Details"),iconClass:"pbi-glyph-edit",buttonClass:"editTileBtn",action:function(e){return o.edit(e)}}),e.canShowInsights&&a.push({text:r.get("TileMenuOption_Insights"),iconClass:"pbi-glyph-insight",buttonClass:"insightsBtn",action:function(e){return o.insights(e)}}),e.canPin&&a.push({text:r.get("PinVisual_ToolTip"),iconClass:"pbi-glyph-pinned",buttonClass:"vcPinBtn",action:function(e){return o.pin(e)}}),e.canEdit&&a.push({text:r.get("TileEditor_DeleteTile"),iconClass:"pbi-glyph-delete",buttonClass:"deleteTileBtn",action:function(e){return o.delete(e)}}),a=_.compact(a);for(var n=0,s=a;n<s.length;n++){var c=s[n];c.title=c.title||c.text}return a}function i(e,t,i,o,r){var a=function(e){return i.open(e)},n="openActionHeader";switch(e){case 0:if(!o.href||!o.hrefTarget)return;return{text:r.get("TileMenuOption_GoToURL"),iconClass:"pbi-glyph-link",buttonClass:n,action:a,title:t,link:{href:o.href,target:o.hrefTarget}};case 1:return{text:r.get("TileMenuOption_GoToQnA"),iconClass:"pbi-glyph-comment",buttonClass:n,title:t,action:a};case 2:return{text:r.get("TileMenuOption_GoToReport"),iconClass:"pbi-glyph-barchart",buttonClass:n,title:t,action:a};case 3:return{text:r.get("GoToWorkbook"),iconClass:"pbi-glyph-excel",buttonClass:n,title:t,action:a};case 4:return{text:r.get("TileMenuOption_GoToDataset"),iconClass:"pbi-glyph-dataset",buttonClass:n,title:t,action:a}}}e.createViewModel=t})(t=e.TileOptionsViewModelFactory||(e.TileOptionsViewModelFactory={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.Permissions,o=e.telemetry.PinTileSource,r=e.common.constants.tileActions,a=e.models.TileOptionsViewModelFactory,n=e.dataServices.contracts.TileType,s=e.dataServices.TileUtils,c=(function(){function c(e,t){this.services=t}return c.createOptions=function(){return{additionalServices:["$element","auditing","contentProviderHttpService","dashboardDataService","dashboardService","dropdown","featureSwitchService","groupService","inFocusService","licenseEnforcementService","localizationService","modelService","navigation","pinTileService","reportService","taskPaneSliderService","telemetryService","userInfo","userNotificationInfo","workbookService"],scopedDependencies:["exportData"]}},c.prototype.$onInit=function(){var e=this.viewModel;this.isModelTile=e&&e.model&&e.contract&&!e.contract.config,this.isWorkbookTile=e&&e.workbook&&e.contract&&"number"==typeof e.contract.workbookId},c.prototype.showOptionsMenu=function(e){var t=this.services.dropdown,i=this.isReadOnly,o=this.model.tileModel,r=o.isLoading||o.composite&&o.composite.isLoading,n=this.getOpenActionType(),s={canExport:this.canExport,canEdit:!r&&!i,canShowInsights:!r&&this.shouldShowInfocusButton()&&this.isInsightsSupported(),canPin:!r&&!i&&this.shouldShowPinButton(),canShowAlerts:!r&&this.shouldShowAlertsButton(),canOpen:this.isTileOpenable&&void 0!==n,openActionType:n,openActionDescription:this.getOpenTileDescription()},c=a.createViewModel(s,this.viewModel,this,this.services.localizationService);if(!_.isEmpty(c)){var l={items:c};t.showMenu(l,"tileOptionsMenu.html",{showInsideVisibleArea:!0,position:this.getMenuPosition()})}},c.prototype.getMenuPosition=function(){var e=this.services.$element,t=e.offset();return{x:t.left+e.width(),y:t.top+e.height()}},c.prototype.delete=function(i){this.dismiss(i);var o=this.services.rootScope;o.$emit(e.constants.hideTileEditorEventName),o.$emit(t.DashboardTileController.Events.DeleteTile,this.model),o.$emit(e.constants.removeTileEventName,this.model.tileModel)},c.prototype.alerts=function(e){this.dismiss(e),this.services.dashboardService.selectDashboardTile(this.model),this.services.taskPaneSliderService.expandPane(9,CollapsiblePaneExpandedWidth.Small)},c.prototype.open=function(t){this.dismiss(t),this.services.rootScope.$emit(e.constants.openTileEventName,this.model.tileModel)},c.prototype.dismiss=function(e){this.services.dropdown.hideAll(),e&&e.stopPropagation&&e.stopPropagation()},c.prototype.shouldShowPinButton=function(){var e=this.viewModel,t=null!==this.isModelTile&&this.isModelTile;return!t&&!this.isTileInError&&(!e.workbook||this.shouldShowPinButtonForWorkbookTile())},c.prototype.shouldShowAlertsButton=function(){var t=this.viewModel.datasetModel;if(!t||!this.services.dashboardService.isAlertingEnabled())return!1;var i=this.viewModel;if(i.type===n.realTime)return!1;var o=s.getVisualType(i.config);return o===e.visuals.plugins.card.name||o===e.visuals.plugins.gauge.name||o===e.visuals.plugins.kpi.name},c.prototype.shouldShowInfocusButton=function(){return 1===this.services.inFocusService.getInFocusState(this.viewModel)&&this.services.dashboardService.isInFocusModeEnabled()},c.prototype.shouldShowPinButtonForWorkbookTile=function(){var e=this.viewModel,t=this.isWorkbookTile&&e.config&&!e.config.workbookTile,i=!1;if(e.workbook&&e.workbook.contract){var o=this.services.workbookService.findWorkbook(e.workbook.contract.workbookId,e.workbook.contract.packageId);i=!o||!o.isOwner()}return!t&&!i},c.prototype.edit=function(t){this.dismiss(t),this.services.rootScope.$emit(e.constants.showTileEditorEventName,this.model)},c.prototype.export=function(t){this.dismiss(t);var i=this.services,o=i.licenseEnforcementService;if(!o.supportsExportData||o.supportsExportData(!0)){var r=this.viewModel,a=s.getVisualType(r.config),n=this.services.userInfo.isPremiumUser,c=r.contract&&r.contract.id,l=i.telemetryService.startEvent(e.telemetry.EXExportVisualData,a,e.telemetry.ExportVisualSource.Dashboard,!1,0,n,!1,0);this.services.exportData.exportTileDataToCsv(this.viewModel).then((function(e){l.event.info.isPartialResult=e.isPartialResult,l.resolve()}),(function(e){l.reject({errorCode:e.error.toString()})})),this.services.auditing.auditEvent(c,e.common.contracts.AuditEntityType.Tile,e.common.contracts.AuditActivityType.exportDashboardTile)}},c.prototype.pin=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,r,a,n,s,c,l,d;return __generator(this,(function(p){switch(p.label){case 0:return this.dismiss(t),i=this.services.contentProviderHttpService.getBuiltInContentProviders(),r=this.model.tileModel,a=r.model&&r.model.contentProviderId,n=e.common.findContentProviderName(i,a),s=r.contract.resourcePackageIds,c=!!(s&&s.length>0),l=r.config&&r.config.widget?r.config.widget.name:"",d=this.services.telemetryService.startEvent(e.telemetry.DashboardPinTile,r.composite?r.composite.visual.type:void 0,o.Dashboard,"",!1,n,c,l,!1),[4,this.services.pinTileService.showPinVisualFromDashboardDialog(r,d)];case 1:return[2,p.sent()]}}))}))},c.prototype.isInsightsSupported=function(){var e=this.viewModel,t=e.datasetModel;return!e.workbook&&!e.realTime&&t&&!t.isHidden&&t.contract.insightsSupported&&EnumExtensions.hasFlag(t.getPermissions(),i.Read)},c.prototype.getOpenTileDescription=function(){var e=this.viewModel,t=e.action.action,i=this.services;if(t===r.custom.openUrlActionName)return e.action.targetUrl;if(t===r.openQnAActionName)return e.utterance;if(t===r.openReportActionName&&!this.isModelTile){var o=e.report&&e.report.objectId,a=i.reportService.findReportByGUID(o);return a&&a.displayName||""}if(t===r.openReportActionName||t===r.openInFocusActionName||t===r.openInsightsActionName){var n=void 0;return e.contractsModel&&(n=i.modelService.findModel(e.contractsModel.id,e.contractsModel.packageId)),n&&n.displayName||""}if(t===r.openWorkbookActionName){var s=e.contract&&e.contract.workbookId,c=i.workbookService.findWorkbook(s);return c&&c.displayName||""}return t?void 0:i.localizationService.get("TileMenuOption_NoAction")},c.prototype.insights=function(e){this.dismiss(e);var t=this.model.tileModel;this.services.dashboardService.selectDashboardTile(this.model);var i=t.objectId,o=t.contract.originalTileObjectId,r=this.services.groupService.activeGroupObjectId,a=this.services.dashboardDataService.activeDashboard.objectId;this.services.navigation.showInsightsInFocusMode(i,o,a,r)},c.prototype.getOpenActionType=function(){var e=this.viewModel,t=e.action.action;return t===r.custom.openUrlActionName?0:t===r.openQnAActionName?1:t===r.openReportActionName&&!this.isModelTile&&e.report?2:t===r.openReportActionName&&!e.report&&this.isModelTile?4:t===r.openReportActionName&&(e.report||this.isModelTile)?2:t===r.openWorkbookActionName&&e.workbook?3:void 0},c})();t.TileOptionsMenuController=c})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.TileOptionsMenu={templateUrl:"components/tileOptionsMenu/tileOptionsMenu.html",controller:e.common.createController(e.controllers.TileOptionsMenuController),bindings:{isReadOnly:"<",model:"<",viewModel:"<",canExport:"<",isTileInError:"<",isTileOpenable:"<"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){var o=this;this.services=i,this.userNotifications={notifications:[],dismissNotification:function(t){o.services.userNotificationInfo.dismissNotification(t.contract),t.contract.notificationCategory===e.userNotifications.contracts.NotificationCategory.DynamicMessage&&o.services.dynamicMessagingData.postData(e.constants.dynamicMessaging.userDismissedAction);
},showDismissAllDialog:function(){o.confirmDismissAll()},showLoadMore:!1,disableLoadMore:!1,loadingData:!0,loadMoreNotification:function(){o.userNotifications.disableLoadMore=!0,o.userNotifications.loadingData=!0,o.services.userNotificationInfo.getNextPageData()},performAction:function(e){o.navigateToState(e)},loadIcon:function(e){o.services.userNotificationInfo.loadIcon(e.contract)},moreOptionsMenu:[{text:this.services.localizationService.get("UsersNotifications_Options"),type:DropDownMenuItemType.Title},{action:0,text:this.services.localizationService.get("UsersNotifications_DismissAll"),type:DropDownMenuItemType.Item}],menuEnabled:!1},this.mapUserNotifications(),this.services.userNotificationInfo.registerNotificationsUpdatedListener((function(){o.mapUserNotifications()})),t.$watch((function(){return o.services.userNotificationInfo.hidePaneOnClick}),(function(e){t.$applyAsync((function(){e&&o.hideNotifications()}))}))}return t.createOptions=function(){return{additionalServices:["$window","asyncFeatureSwitchService","errorService","promiseFactory","telemetryService","localizationService","userNotificationInfo","navigation","lazy","userNotificationTileFilterService","dynamicMessagingData"]}},t.prototype.moreOptionsMenuSelected=function(e){var t=e.action;if(null!=t)switch(t){case 0:this.userNotifications.showDismissAllDialog()}},t.prototype.hideNotifications=function(){if(this.services.userNotificationInfo.userNotifications)if(this.services.userNotificationTileFilterService.tileId){var e=_.filter(this.userNotifications.notifications,(function(e){return!e.seen}));if(!_.isEmpty(e)){var t=_.map(e,(function(e){return e.contract.id}));this.services.userNotificationInfo.updateSeenNotifications(t)}}else this.services.userNotificationInfo.userNotifications.unseenCount>0&&this.services.userNotificationInfo.updateLastSeenDate();this.services.userNotificationTileFilterService.tileId=null,this.services.userNotificationInfo.showPane=!1},t.prototype.navigateToState=function(t){var i,o,r=e.userNotifications.contracts;switch(t.actionType){case 0:this.services.navigation.insertGroupAndNavigateToDashboardByGUID(t.actionPath[0],e.constants.myWorkSpaceGroupId);break;case 1:this.displayLicenseDialog();break;case 2:var a=t.actionPath;o=a[2],i=a[3],this.services.navigation.showInFocusMode(a[1],i,a[0],o,e.constants.myWorkSpaceGroupId),t.contract.message.filterProperties&&t.contract.message.filterProperties.UserDataAlertRuleId&&this.services.telemetryService.logEvent(e.telemetry.DataAlertsNotificationAction,e.telemetry.DataAlertNotificationSource.UnifiedNotificationPane,e.telemetry.DataAlertNotificationAction.OpenTile,parseInt(t.contract.message.filterProperties.UserDataAlertRuleId,10));break;case 3:var n=t.actionPath;o=n[3],i=n[4],this.services.navigation.showInFocusMode(n[2],i,n[1],o,n[0]),t.contract.message.filterProperties&&t.contract.message.filterProperties.UserDataAlertRuleId&&this.services.telemetryService.logEvent(e.telemetry.DataAlertsNotificationAction,e.telemetry.DataAlertNotificationSource.UnifiedNotificationPane,e.telemetry.DataAlertNotificationAction.OpenTile,parseInt(t.contract.message.filterProperties.UserDataAlertRuleId,10));break;case 4:this.services.navigation.insertGroupAndNavigateToDashboardByGUID(t.actionPath[0],t.actionPath[1]);break;case 5:t.contract.notificationCategory===r.NotificationCategory.DynamicMessage&&this.services.dynamicMessagingData.postData(e.constants.dynamicMessaging.userClickedAction),this.services.$window.open(t.actionPath[0],"_blank")}this.services.telemetryService.logEvent(e.telemetry.UserNotificationsLinkClicked,r.NotificationCategory[t.contract.notificationCategory]),this.services.userNotificationInfo.hidePaneOnClick=!0},t.prototype.displayLicenseDialog=function(){return __awaiter(this,void 0,e.Promise,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.services.lazy("licenseHelper")];case 1:return t=i.sent(),t.displayDialogToUpgrade(e.telemetry.LicenseEnforcementOperation.NotificationBar),[2]}}))}))},t.prototype.mapUserNotifications=function(){if(this.userNotifications.notifications=[],this.services.userNotificationInfo.userNotifications){var t=this.services.userNotificationInfo.userNotifications.notifications.filter((function(e){return null==e.notificationType||1===e.notificationType}));if(this.services.userNotificationTileFilterService.tileId&&(t=this.services.userNotificationTileFilterService.filterNotifications(t)),!_.isEmpty(t))for(var i=this.services.localizationService,o=0,r=t;o<r.length;o++){var a=r[o],n=new e.userNotifications.models.UserNotificationModel(a,i);this.userNotifications.notifications.push(n)}this.userNotifications.showLoadMore=this.userNotifications.notifications.length<this.services.userNotificationInfo.userNotifications.totalCount,this.userNotifications.disableLoadMore=!1,this.userNotifications.loadingData=!1}},t.prototype.confirmDismissAll=function(){var e=this,t=this.services.errorService,i=t.control(),o=[new InJs.ModalDialogAction(this.services.localizationService.get("UsersNotifications_DismissAll"),function(t,o){e.services.userNotificationInfo.dismissAll(),i.hideDialog()}),new InJs.ModalDialogAction(this.services.localizationService.get("UsersNotifications_Cancel"),function(e,t){i.hideDialog()})],r=this.services.localizationService.get("UsersNotifications_DismissAllConfirmation"),a=this.services.localizationService.get("UsersNotifications_ConfirmDismissAll");i.showCustomDialog(r,$("<div/>").text(a),o,(function(t){t.parent().find('input[value="'+e.services.localizationService.get("UsersNotifications_Cancel")+'"]').focus()}),!0)},t})();t.UserNotificationController=i})(i=t.userNotifications||(t.userNotifications={}))})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.UserNotifications={templateUrl:"components/userNotifications/userNotificationsView.html",controller:e.common.createController(e.controllers.userNotifications.UserNotificationController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){var i=this;this.searchText="",this.onSearchTextChange=function(){i.ensureSearchTelemetry(),i.updateGroupList()},this.resolveSearchTelemetry=function(){i.searchTelemetry&&(i.searchTelemetry.resolve(),i.searchTelemetry=null)},this.services=t}return t.createOptions=function(){return{additionalServices:["groupService","localizationService","telemetryService"]}},t.prototype.$onInit=function(){var t=this;this.services.groupService.ensureGroupsInitialization().then((function(){return t.updateGroupList()})),this.unregisterGroupDeletedEvent=this.services.rootScope.$on(e.constants.groupDeletedEventName,(function(e,i){e.stopPropagation(),t.updateGroupList()})),this.watermarkConfig={canEdit:!0,mode:!1,contentNonShared:this.services.localizationService.get("ContentList_EmptySearchResults"),imgClass:"empty-search-img"},this.initialized=!0},t.prototype.$onDestroy=function(){this.unregisterGroupDeletedEvent()},t.prototype.containsSubstring=function(e,t){return!!e&&_.contains(e.toLocaleLowerCase(),t)},t.prototype.ensureSearchTelemetry=function(){this.searchTelemetry||_.isEmpty(this.searchText)||(this.searchTelemetry=this.services.telemetryService.startEvent(e.telemetry.ContentListSearch))},t.prototype.updateGroupList=function(){var e=this,t=_(this.services.groupService.groups);if(this.searchText){var i=this.searchText.toLocaleLowerCase();t=t.filter((function(t){return e.containsSubstring(t.displayName,i)}))}this.groups=t.sortBy((function(e){return e.displayName})).sortBy((function(e){return!e.isMyWorkspace})).value(),this.updateWatermark()},t.prototype.updateWatermark=function(){this.showWatermarkConfig=_.isEmpty(this.groups)},t})();t.WorkspacesContainerController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.WorkspacesContainer={templateUrl:"components/workspacesContainer/workspacesContainer.html",controller:e.common.createController(e.controllers.WorkspacesContainerController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["errorService"]}},e.prototype.seeErrorDetails=function(){var e=this.errorText,t=this.errorText,i=this.errorDetails.displayableErrorInfo;if(this.errorDetails&&i)for(var o=0,r=i.length;o<r;o++){var a=i[o];if(a.errorInfoValue){e=a.errorInfoKey,t=a.errorInfoValue;break}}this.services.errorService.error(t,"Tile_FailedToDisplay",{title:e,helpLink:this.errorDetails.helpLink})},e})();e.ErrorPlaceholderController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ErrorPlaceholder={bindings:{errorText:"=",errorDetails:"=?"},templateUrl:"components/errorPlaceholder/errorPlaceholder.html",controller:e.common.createController(e.controllers.ErrorPlaceholderController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.helpers.ModelConverterHelper,o=e.common.contracts.PublishOrRefreshStatus,r=e.common.contracts.ContentTileType,a=e.common.contracts.Permissions,n=(function(){function t(e,t){this.services=t,this.canShowNew=!0}return t.createOptions=function(){return{additionalServices:["localizationService","modelService","telemetryService","errorService","lazy","ownership","modelHttpService","dashboardService","reportService","workbookService"]}},t.prototype.$onInit=function(){this.initViewModelContract(),this.icon=this.isViewModelShared()?e.models.NavigationPaneListItemIcon.Shared:e.models.NavigationPaneListItemIcon.None,this.tooltipConfig={tooltipLocalizeDescription:"NavigationPane_RefreshError",tooltipArrowPosition:e.common.ArrowPosition.arrowBottomLeft}},t.prototype.isShared=function(){return(!this.viewModel.contentTileType||this.viewModel.contentTileType===r.Favorite)&&(this.viewModelContract?this.icon===e.models.NavigationPaneListItemIcon.Shared&&this.viewModelContract.packagePublishStatus!==o.PublishError&&this.viewModelContract.lastRefreshStatus!==o.RefreshError:this.icon===e.models.NavigationPaneListItemIcon.Shared)},t.prototype.isNew=function(){return this.viewModelContract?this.canShowNew&&this.viewModel.isNew&&this.viewModelContract.packagePublishStatus!==o.PublishError&&this.viewModelContract.packagePublishStatus!==o.RefreshError&&!this.isRefreshInProgress():this.canShowNew&&this.viewModel.isNew},t.prototype.isPublishError=function(){return!!this.viewModelContract&&this.getPackagePublishStatus()===o.PublishError},t.prototype.showIcon=function(){if(this.viewModelContract){var t=this.services.modelService.findModel(this.viewModelContract.id,this.viewModelContract.packageId);if(t)return t.packagePublishStatus!==e.common.contracts.PublishOrRefreshStatus.PublishError&&t.contract.lastRefreshStatus!==e.common.contracts.PublishOrRefreshStatus.RefreshError}return!1},t.prototype.showRefreshError=function(){if(this.viewModelContract){var t=this.services.modelService.findModel(this.viewModelContract.id,this.viewModelContract.packageId);if(t)return t.packagePublishStatus===e.common.contracts.PublishOrRefreshStatus.RefreshError||t.contract.lastRefreshStatus===e.common.contracts.PublishOrRefreshStatus.RefreshError}return!1},t.prototype.isRefreshInProgress=function(){if(this.viewModelContract){var e=this.services.modelService.findModel(this.viewModelContract.id,this.viewModelContract.packageId);return!!e&&e.isRefreshInProgress}return!1},t.prototype.getPackagePublishStatus=function(){var t=this.services.modelService.findModel(this.viewModelContract.id,this.viewModelContract.packageId);return t?t.packagePublishStatus:e.common.contracts.PublishOrRefreshStatus.FinishedSuccessfully},t.prototype.showRefreshErrorDialog=function(){var t=this,i=this.services.telemetryService,r=i.startEvent(e.telemetry.DashboardGetRefreshHistoriesOnRefreshFailures);this.viewModelContract.lastRefreshStatus===o.RefreshError&&this.viewModelContract.packagePublishStatus===o.RefreshError?this.services.modelHttpService.getModelRefreshHistories(this.viewModelContract.id.toString(),r.event).then((function(e){t.processModelAndPackageRefreshHistories(r,e)}),(function(e){t.processModelAndPackageRefreshHistories(r)})):this.viewModelContract.lastRefreshStatus===o.RefreshError?this.services.modelHttpService.getModelRefreshHistories(this.viewModelContract.id.toString(),r.event).then((function(e){t.displaySuccessHistoryResult(e.data).then((function(){return r.resolve()}))}),(function(e){t.displayErrorHistoryResult(),r.reject()})):this.viewModelContract.packagePublishStatus===o.RefreshError&&this.services.modelHttpService.getPackageRefreshHistories(this.viewModelContract.packageId.toString(),r.event).then((function(e){t.displaySuccessHistoryResult(e.data).then((function(){return r.resolve()}))}),(function(e){t.displayErrorHistoryResult(),r.reject()}))},t.prototype.isViewModelShared=function(){return this.viewModel.contentTileType===r.Favorite?this.viewModel.permissions===a.Read||this.viewModel.permissions===a.ReadReshare:this.services.ownership.isResourceSharedWithMe(this.viewModel)},t.prototype.displaySuccessHistoryResult=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o;return __generator(this,(function(r){switch(r.label){case 0:return _.isEmpty(t)?[3,4]:[3,1];case 1:return[4,this.services.lazy("errorFormat")];case 2:return e=r.sent(),i=e.getFriendlyErrorMessage(t[0].serviceExceptionJson),[4,this.parseAdditionalErrorInfo(t[0].serviceExceptionJson)];case 3:o=r.sent(),this.services.errorService.errorNoDefaultAdditionalErrorInfo(i,"RefreshFailure",{displayableErrorInfo:o}),r.label=4;case 4:return[2]}}))}))},t.prototype.displayErrorHistoryResult=function(){this.services.errorService.error(this.services.localizationService.get("RefreshError_Unknown"),"RefreshFailure_FailedToGetHistories")},t.prototype.parseAdditionalErrorInfo=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.services.lazy("errorFormat")];case 1:return e=r.sent(),i=e.convertErrorDetailsJson(t),o=[],i.forEach((function(e){o.push({errorInfoKey:e.Name,errorInfoValue:e.Value})})),[2,o]}}))}))},t.prototype.processModelAndPackageRefreshHistories=function(e,t){var o=this;this.services.modelHttpService.getPackageRefreshHistories(this.viewModelContract.packageId.toString(),e.event).then((function(r){var a;if(!t||_.isEmpty(t.data)||t.data[0].isSuccessful)a=!1;else if(_.isEmpty(r.data)||r.data[0].isSuccessful)a=!0;else{var n=i.convertRefreshTimeToJsDateTime(t.data[0].endTime).getTime(),s=i.convertRefreshTimeToJsDateTime(r.data[0].endTime).getTime();a=n>s}a?o.displaySuccessHistoryResult(t.data).then((function(){return e.resolve()})):o.displaySuccessHistoryResult(r.data).then((function(){return e.resolve()}))}),(function(){t?o.displaySuccessHistoryResult(t.data).then((function(){return e.resolve()})):(o.displayErrorHistoryResult(),e.reject())}))},t.prototype.initViewModelContract=function(){var e=this.viewModel;switch(e.contentTileType){case r.Dashboard:case r.Report:e.modelIds&&e.packageIds&&e.modelIds.length>0&&e.packageIds.length>0&&(this.viewModelContract=this.services.modelService.findModel(this.viewModel.modelIds[0],this.viewModel.packageIds[0]));break;case r.Workbook:var t=this.viewModel,i=this.services.workbookService.findWorkbookByUniqueId(t.uniqueId);this.viewModelContract=this.services.modelService.findModel(i.modelId,i.packageId);break;default:this.viewModelContract=this.viewModel.contract}},t})();t.DatasetIconContainerController=n})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.DatasetIconContainer={templateUrl:"components/datasetIconContainer/datasetIconContainer.html",controller:e.common.createController(e.controllers.DatasetIconContainerController),bindings:{viewModel:"=",refreshRelated:"=",canShowNew:"<?"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.ArtifactType,o=e.common.models.CollapsiblePaneExpandedWidth,r=e.helpers.ContentTileHelper,a=e.common.contracts.ContentTileType,n=jsCommon.EnumExtensions,s=e.common.contracts.Permissions,c=(function(){function t(i,o){var r=this;this.viewRelated=!0,this.canRewrite=function(e){return n.hasFlag(e,s.All)||n.hasFlag(e,s.ReadWrite)},this.canExportPowerPoint=function(e){return!1},this.canRefreshNow=function(){var e=r.viewModel;return(e.contentTileType===a.Dataset||e.contentTileType===a.Workbook)&&r.services.contentList.canRefreshNow(e)},this.isExportAllowed=function(e){if(e===a.Dashboard){var i=r.services.$location.search()[t.isDasboardExportAllowedQueryString];return i&&"1"===i}return!1},this.canEditWorkbook=function(t){return t===a.Workbook&&r.viewModel instanceof e.dataServices.models.Workbook&&r.viewModel.isEditable()},this.canReplaceWorkbook=function(e){return e===a.Workbook&&r.services.contentList.canReplaceWorkbook(r.viewModel)},this.canOpenUsageMetricsReport=function(e){var t=r.services.licenseEnforcementService.supportsUsageMetrics();return r.services.featureSwitchService.featureSwitches.usageMetricsEnabled&&t&&!r.services.permissionService.isActiveWorkspaceIsReadOnly&&(r.viewModel.getPermissions()&s.Write)===s.Write&&(e===a.Dashboard||e===a.Report)},this.shareReport=function(e,t){r.services.contentList.shareReport(e)},this.unfavoriteContentTile=function(e){r.services.contentList.removeFavorite(r.viewModel)},this.deleteContentTile=function(e){var t=r.viewModel;switch(e){case a.Dashboard:n.hasFlag(t.getPermissions(),s.All)||n.hasFlag(t.getPermissions(),s.ReadWrite)?r.services.contentList.deleteContent(t,!0):n.hasFlag(t.getPermissions(),s.CopyOnWrite)?r.services.contentList.identifyAndDeleteContent(t):r.services.contentList.deleteContent(t,!1);break;case a.Report:(t.getPermissions()&s.CopyOnWrite)===s.CopyOnWrite?r.services.contentList.identifyAndDeleteContent(t):r.services.contentList.deleteContent(t);break;case a.Workbook:case a.OrgApp:r.viewModel.appPush||r.services.contentList.identifyAndDeleteContent(t)}},this.contentTileRename=function(e){r.services.overlayService.hideAllDropdowns(),r.services.contentList.showRename(r.viewModel)},this.refreshNow=function(){r.services.contentList.refreshNow(r.viewModel)},this.scheduleRefresh=function(){r.services.contentList.scheduleRefresh(r.viewModel)},this.exportDashboard=function(e){r.services.contentList.exportDashboard(r.viewModel)},this.editWorkbook=function(e){r.services.contentList.editWorkbook(r.viewModel)},this.replaceWorkbook=function(e){r.services.contentList.replaceWorkbook(r.viewModel)},this.favoriteContentTile=function(e){var t=r.viewModel.workspaceId||r.services.groupService.activeGroupObjectId;r.services.contentList.addFavorite(r.viewModel,t)},this.scope=i,this.services=o}return t.createOptions=function(){return{additionalServices:["$location","activeGroupId","analyzeInExcel","conceptualModelSetting","contentList","favorites","featureSwitchService","groupContextMenuService","groupService","impersonationService","localizationService","navigation","overlayService","permissionService","quota","taskPaneSliderService","userInfo","licenseEnforcementService","usageMetricsReport","modalDialogService","moduleLoader","lazy","telemetryService"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t,i;return __generator(this,(function(o){switch(o.label){case 0:return(e=this.viewModel)?(t=this.tileType=e.contentTileType,this.deleteEnabled=!(this.services.navigation.inAppDetailView()||this.services.navigation.inRecentlyViewedView()),t===a.OrgApp&&(this.deleteTooltip=this.viewModel.appPush?"PushAppDeleteDisabled":"ContentTileOptions_Delete"),this.viewRelated=(this.services.navigation.inContentListView()||this.services.navigation.inAppDetailView())&&!this.services.navigation.inSharedWithMeView(),t===a.OrgApp||this.isAppFavorite(e)?(i=this,[4,this.services.contentList.canEditContent(e)]):[3,2]):[2];case 1:i.canEditApp=o.sent(),o.label=2;case 2:return[2]}}))}))},t.prototype.canUnFavorite=function(){return!!this.isFavoritable()&&this.services.contentList.isFavorite(this.viewModel)},t.prototype.canFavorite=function(){return!!this.isFavoritable()&&!this.services.contentList.isFavorite(this.viewModel)},t.prototype.isFavoritable=function(){return!this.inListView&&r.isFavoritableContent(this.viewModel)},t.prototype.isFavoriteDisabled=function(){return r.isFavoriteDisabled(this.viewModel,this.services.contentList)},t.prototype.canShare=function(e,t){var i=this;if(t!==a.Dashboard&&t!==a.Favorite)this.canShareTile=!1;else{var o,r=n.hasFlag(e.getPermissions(),s.ReShare),c=void 0;c=t===a.Favorite?e.workspaceId:this.services.groupService.activeGroupObjectId,c?this.services.groupService.ensureGroupsInitialization().then((function(){o=i.services.groupService.getGroup(i.viewModel.workspaceId),o?i.canShareTile=!i.services.permissionService.isGroupWorkspaceReadOnly(o.contract.isReadOnly,o.contract.isOwner)&&r:i.canShareTile=r})):this.canShareTile=r}},t.prototype.canShareReport=function(){return this.services.featureSwitchService.featureSwitches.reportSharingEnabled},t.prototype.canRewriteWorkbook=function(e){return e.contentTileType===a.Workbook&&e.isOwner()},t.prototype.canPersonalize=function(){var t=this.viewModel;if(this.services.navigation.inAppDetailView())return!1;var i=n.hasFlag(t.getPermissions(),s.CopyOnWrite);return e.helpers.ContentTileHelper.getActualType(t)===a.Workbook&&i&&n.hasFlag(t.getPermissions(),s.All)||i},t.prototype.canAnalyzeInExcel=function(){var e=this.viewModel;switch(e.contentTileType){case a.Report:case a.Dataset:return this.services.analyzeInExcel.isAnalyzeInExcelSupported(this.services.featureSwitchService,e.getPermissions());default:return!1}},t.prototype.canRunInsights=function(){var e=this.viewModel;if(e.contentTileType===a.Report||e.contentTileType===a.Dataset){var t=this.services.contentList.getModels(e),i=t&&t[0];return i&&!this.services.usageMetricsReport.modelOriginatedFromUsageMetricsContentPack(i)&&i.contract.insightsSupported&&n.hasFlag(i.getPermissions(),s.Read)}return!1},t.prototype.runInsights=function(){this.services.contentList.runInsights(this.viewModel)},t.prototype.canScheduleRefresh=function(){var e=this.viewModel;return(e.contentTileType===a.Dataset||e.contentTileType===a.Workbook)&&this.services.contentList.canScheduleRefresh(this.viewModel)},t.prototype.editApp=function(){this.viewModel&&this.canEditApp&&this.services.contentList.editContent(this.viewModel)},t.prototype.viewRelatedContent=function(){var e=this.viewModel.contentTileType===a.Dashboard?i.Dashboard:i.Report,t={id:this.viewModel.objectId,artifactType:e,displayName:this.viewModel.displayName,workspaceId:this.viewModel.workspaceId};this.services.taskPaneSliderService.expandPane(17,o.Default,t)},t.prototype.shareContentTile=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,n,s,c,l;return __generator(this,(function(d){switch(d.label){case 0:return o=i===a.Favorite?t.workspaceId:this.services.groupService.activeGroupObjectId,this.services.featureSwitchService.featureSwitches.permissionCenterEnabled?[4,this.services.lazy("permissionData")]:[3,4];case 1:return r=d.sent(),[4,r.getPermissionArtifactByObjectId(1,this.viewModel.objectId,0)];case 2:return n=d.sent(),s=n.hasReshareForAllUnderlyingArtifacts(),s?[3,4]:[4,this.services.moduleLoader.require({javascript:"PermissionsUI/components/permissionCannotShareDialog/permissionCannotShareDialogBuilder"})];case 3:return c=d.sent(),l=c.createPermissionCannotShareDialogBuilder(this.services.modalDialogService),l.show(n),[2];case 4:return this.services.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.ShareDashboard)||(o||(o=e.constants.myWorkSpaceGroupId),this.services.contentList.shareContent(t,o)),[2]}}))}))},t.prototype.personalize=function(){this.services.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.PersonalizeContentPack)||this.services.contentList.personalizeContent(this.viewModel)},t.prototype.analyzeInExcel=function(){this.services.contentList.analyzeContentInExcel(this.viewModel)},t.prototype.exportToPowerPoint=function(){var e=this.services;e.licenseEnforcementService.supportsExportToPowerPoint(!0)&&this.services.contentList.exportToPowerPoint(this.viewModel)},t.prototype.openUsageMetricsReport=function(){var e=this.viewModel,t=this.viewModel.workspaceId||this.services.groupService.activeGroupObjectId;this.services.contentList.openUsageMetricsReport(e,t)},t.prototype.getIconForGroupContextMenuItem=function(e){return this.services.groupContextMenuService.getIconNameForGroupLinkType(e.linkType)},t.prototype.getTooltipForGroupContextMenuItem=function(e){return this.services.groupContextMenuService.getTextForGroupLinkType(e.linkType)},t.prototype.onGroupContextMenuItemSelected=function(e){this.services.groupContextMenuService.performActionWithGroupContextMenuItem(e,this.viewModel)},t.prototype.isAppFavorite=function(e){return e&&e.contentTileType===a.Favorite&&3===e.favoriteType},t.isDasboardExportAllowedQueryString="exportallowed",t})();t.ContentTileOptionsMenuController=c})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ContentTileOptionsMenu={templateUrl:"components/contentTileOptionsMenu/contentTileOptionsMenu.html",controller:e.common.createController(e.controllers.ContentTileOptionsMenuController),bindings:{deleteEnabled:"<?",viewModel:"=",inListView:"<?"}}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.ArrowPosition,o=e.common.models.TooltipTheme,r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.close=function(){this.services.modalDialogService.close()},e.prototype.exportData=function(){this.services.modalDialogService.close({dataType:this.viewModel.dataType,format:this.convertStringToExportResultFormat(this.viewModel.dataFormat)})},e.prototype.update=function(e){this.viewModel.isCsvFormatDisabled=e===this.viewModel.options[1]},e.prototype.isDataTypeDisabled=function(e){return e===this.viewModel.options[1]&&(this.viewModel.isUnderlyingDisabled||this.viewModel.dataFormat===1..toString())},e.prototype.getTooltipConfigForDataType=function(e){if(!this.isDataTypeDisabled(e))return{tooltipDisable:!0};var t;return t=this.viewModel.isUnderlyingDisabled&&!this.viewModel.isExlFormatDisabled?"UnderlyingData_UnsupportedDataTooltipDescription":"SupportOnlyExlFormat_ToolTipDescription",{tooltipArrowPosition:i.arrowTopMiddle,tooltipDelay:100,tooltipLocalizeTitle:"UnderlyingData_Title",tooltipLocalizeDescription:t,tooltipTheme:o.Dark,isTooltipForModalDialog:!0}},e.prototype.convertStringToExportResultFormat=function(e){return e===(0).toString()?1:0},e})();t.ExportDataDialogController=r})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.ExportDataDialog={templateUrl:"components/exportDataDialog/exportDataDialog.html",bindings:{viewModel:"<"},controller:e.common.createController(e.controllers.ExportDataDialogController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.modalDialogService=e,this.localizationService=t}return t.prototype.show=function(t,i){var o=e.viewModels.ExportDataDialogViewModelFactory.create(this.localizationService,t,i),r={viewModel:o},a={dialogName:"ExportDataDialog",definitionTemplateCachePath:"components/exportDataDialog/exportDataDialogDefinition.html",bindings:r};return this.modalDialogService.showWebModalDialog(a)},t})();t.ExportDataDialogBuilder=i})(t=e.dialogbuilders||(e.dialogbuilders={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){var o=0===t;return{options:[e.get("ModalDialog_ExportDataSummarized"),e.get("ModalDialog_ExportDataUnderlying")],dataType:0,dataFormat:o?(0).toString():1..toString(),isExlFormatDisabled:!o,isUnderlyingDisabled:!i,isCsvFormatDisabled:!1,exportXlsxUnsupportedType:t}}e.create=t})(t=e.ExportDataDialogViewModelFactory||(e.ExportDataDialogViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,e.togglePane=function(){return t.togglePane()}}return e.prototype.togglePane=function(){var e=this.scope.viewModel;this.setCollapsePane(e.isExpanded!==!0)},e.prototype.setCollapsePane=function(e){var t=this.scope.viewModel;t.isExpanded=e},e})();e.CollapsiblePaneController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(e){e[e.Welcome=0]="Welcome",e[e.GetData=1]="GetData",e[e.GroupWelcome=2]="GroupWelcome"})(i=t.ContentProviderSplashState||(t.ContentProviderSplashState={}));var o=(function(){function t(e,t){var i=this;this.scope=e,this.services=t,this.scope.getCurrentGroupName=function(){return i.getCurrentGroupName()},this.scope.getSplashTitleForCurrentGroup=function(){return i.getSplashTitleForCurrentGroup()},this.scope.showIntroductionVideoModal=function(){return i.showIntroductionVideoModal()},this.scope.navigateToContentList=function(){return i.navigateToContentList()},this.scope.inGroupWelcomeView=function(){return i.services.navigation.inGroupWelcomeView()},this.scope.navigateToCategory&&this.scope.navigateToCategoryAndProvider||(this.scope.navigateToCategory=function(e,t){return i.navigateToCategoryAndProvider(e,"",t)},this.scope.navigateToCategoryAndProvider=function(e,t,o){return i.navigateToCategoryAndProvider(e,t,o)},this.scope.isMyWorkspace=function(){return i.isMyWorkspace()})}return t.createOptions=function(){return{additionalServices:["groupService","localizationService","navigation","telemetryService","modalDialogService"]}},t.prototype.navigateToContentList=function(){this.services.navigation.navigateToContentList(this.services.groupService.activeGroupObjectId,!0)},t.prototype.getCurrentGroupName=function(){return this.services.groupService.activeGroup?this.services.groupService.activeGroup.displayName:""},t.prototype.getSplashTitleForCurrentGroup=function(){return this.services.groupService.activeGroup.isMyWorkspace?this.services.localizationService.get("GetData_GetData"):this.services.localizationService.format("Groups_Splash_Title",[this.getCurrentGroupName()])},t.prototype.isMyWorkspace=function(){return this.services.groupService.activeGroup.isMyWorkspace},t.prototype.navigateToCategoryAndProvider=function(t,i,o){var r=e.contentProviderConstants.categoryEnumToNameMap[t],a=e.contentProviderConstants.categoryInteractionTelemetryMap[o];this.services.telemetryService.logEvent(e.telemetry.DashboardGetDataCategorySelect,r,a,"");var n=this.services.navigation;n.showGetDataSlider({categoryName:r,providerName:i,getDataView:n.getDataViewName||"getdata"},0)},t.prototype.showIntroductionVideoModal=function(){var e={dialogName:this.services.localizationService.get("GetData_PowerBI_In_60_Seconds"),templateUrl:"views/contentProviderStore/contentProviderSplashIntroVideoModal.html",scope:this.scope.$new(!0),dialogCssClass:"introVideo",onCloseDialog:_.noop};this.services.modalDialogService.showLegacyWebModalDialog(e)},t})();t.ContentProviderSplashController=o})(i=t.contentProviderStore||(t.contentProviderStore={}))})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.CollapsiblePaneExpandedWidth,o=e.common.constants,r=e.dataServices.models.ContentPackItems,a=e.services.FullScreenFitStyle,n=e.dataServices.TileUtils,s=(function(){function t(t,i){var o=this,r=this.scope=t;this.services=i,r.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},r.tileTrackerFn=function(e){return n.tileTrackerFn(e,r.viewModel.objectId);
},r.useCustomScrollbar=function(){return 0!==r.displayLayout&&1===r.mobileLayout},r.fullScreen=i.fullScreen,r.permissionServices=i.permissionService,r.showReloadDashboard=!1,r.filteredTiles=function(){return o.filteredTiles()},r.removeTileFromMobileView=function(e){return o.removeTileFromMobile(e)},r.canEditTiles=function(){return o.canEditTiles()},r.gridLayoutChangeHandler=function(e){return o.onGridLayoutChanged(e)};var s=i.rootScope,c=s.$on(e.constants.openTileEventName,(function(e,t){return o.onOpenTile(e,t)})),l=s.$on(e.constants.temporaryTilePinned,(function(e){return o.beginTemporaryTileFlow(e)})),d=s.$on(e.constants.removeTileEventName,(function(e,t){return o.onRemoveTile(e,t)})),p=s.$on(e.constants.scrollToSelectedTileEventName,(function(e){return o.scrollToSelectedTile()})),u=s.$on(e.constants.loadDashboardFailed,(function(){r.showReloadDashboard=!0})),h=r.$on(e.constants.refreshTileData,(function(e,t){var o=i.dashboardDataService.activeDashboard;o&&i.dashboardService.refreshTileData(o.id,t)})),v=function(){switch(r.fullScreen.fitStyle){case a.FitToContent:r.scaleDashboard();break;case a.FitToWidth:r.scaleDashboard(!0)}};$(i.$window).on("resize",v),r.$on("$destroy",(function(){r.onDestroy&&r.onDestroy(),c(),d(),l(),h(),u(),p(),$(i.$window).off("resize",v)})),r.reloadActiveDashboard=function(){return o.reloadActiveDashboard()},i.dashboardDataService.InEditMobileLayoutMode=r.inEditMobileLayoutMode,r.$watch("viewModel.isLoaded",(function(t){t&&e.helpers.TrustedVisualUtil.acquireTrustedVisuals(r.viewModel,i.trustedVisual).then((function(e){return o.reloadTrustedVisuals(e)}))}))}return t.createOptions=function(){return{additionalServices:["dashboardDataService","dashboardHttpService","dashboardService","errorService","modalDialogService","modelConverter","navigation","telemetryService","userSettingsService","visualPlugin","$element","localizationService","fullScreen","permissionService","$window","featureSwitchService","promiseFactory","trustedVisual","taskPaneSliderService","notificationToast","mobileAuthoringService"]}},t.prototype.reloadTrustedVisuals=function(t){_.isEmpty(t)||(this.services.visualPlugin.ensureTrustedVisualPlugins(t),this.services.rootScope.$emit(e.constants.reloadEmptyVisuals,{visualTypes:t.map((function(e){return e.name}))}))},t.prototype.onOpenTile=function(t,i){t&&t.stopPropagation&&t.stopPropagation();var o=this.scope.viewModel;this.scope.$emit(e.constants.actualOpenTileEventName,i,o.id)},t.prototype.beginTemporaryTileFlow=function(e){e&&e.stopPropagation&&e.stopPropagation();var t=1,o=this.services,r=o.dashboardDataService.selectedDashboardTile;r&&r.tileModel.realTime&&(t=7),this.services.taskPaneSliderService.expandPane(t,i.Large)},t.prototype.scrollToSelectedTile=function(){var e=this.services.$element,t=e.find(".dashboardTile.selected");if(t.length>0){var i=e.offset(),o=t.offset();e.animate({scrollTop:o.top-i.top+e.scrollTop(),scrollLeft:o.left-i.left+e.scrollLeft()})}},t.prototype.onRemoveTile=function(t,i){var o=this,a=this.scope.viewModel,n=a.contract,s=this.services.telemetryService.startEvent(e.telemetry.DashboardDeleteTile);this.deleteTile(i.id),this.services.dashboardHttpService.deleteTile(n,i.id,s.event).then((function(){a&&(o.updateDashboardContract(i,a),a.isUsedByContentPack&&o.services.rootScope.$emit(e.constants.contentPackDirtyShowNotification,a.id,r.Dashboard),a.hasModel(i.contract.modelId)||o.services.dashboardService.updateDashboardToken(a),i.hasLayoutPosition(1)&&(o.services.telemetryService.logEvent(e.telemetry.MobileAuthoringFlyoutShown,!0,e.telemetry.OperationType.Remove),o.services.mobileAuthoringService.showMobileIndicationMessage(a.objectId,4,e.common.NotificationToastType.Delete,!1)),s.resolve())}),(function(){s.reject()}))},t.prototype.updateDashboardContract=function(e,t){if(t&&e.report){var i=e.report.id,o=_.filter(t.tiles,(function(e){if(e.report)return e.report.id===i}));if(o&&0===o.length&&t.contract.reportIds){var r=t.contract.reportIds.indexOf(i);r!==-1&&this.services.modelConverter.updateDashboardsReportContract(r,t.contract)}}if(t&&e.contract&&e.contract.workbookId){var a=e.contract.workbookId,o=_.filter(t.tiles,(function(e){return!!e.contract&&e.contract.workbookId===a}));if(o&&0===o.length&&t.contract.workbookIds){var n=t.contract.workbookIds.indexOf(a);n!==-1&&this.services.modelConverter.removeDashboardsWorkbookContract(n,t.contract)}}},t.prototype.deleteTile=function(e){var t=this.scope.viewModel;this.services.dashboardDataService.deleteTile(t.id,e)},t.prototype.canEditDashboard=function(e){return e.canEdit&&!this.services.permissionService.isActiveWorkspaceIsReadOnly&&!this.services.fullScreen.fullScreenMode},t.prototype.canEditTiles=function(){return this.scope.viewModel.canEdit&&!this.scope.permissionServices.isActiveWorkspaceIsReadOnly&&!this.scope.fullScreen.fullScreenMode},t.prototype.onGridLayoutChanged=function(t){return this.scope.$emit(e.common.constants.domLayoutChangedEvent),this.services.dashboardService.batchUpdateTileSizePosition(this.scope.viewModel,t)},t.prototype.filteredTiles=function(){var e=this.scope.viewModel&&this.scope.viewModel.tiles;if(_.isEmpty(e))return[];this.scope.enableStrategySwap&&this.swapLayoutIfNeeded();var t=this.scope.displayLayout||0;return 0===t?e:_.filter(e,(function(e){return e.hasLayoutPosition(t)}))},t.prototype.swapLayoutIfNeeded=function(){var t=this.scope.viewModel.gridLayoutService;if(t){var i=this.scope.viewModel,r=_.any(i.tiles,(function(e){return e.hasLayoutDefinition(1)}));(t.strategy instanceof e.dataServices.models.PhonePortraitTileLayoutStrategy&&r||t.strategy.isDynamic()&&!r)&&this.scope.$emit(o.needStrategySwapEventName)}},t.prototype.removeTileFromMobile=function(e){if(1===this.scope.displayLayout&&e.gridLayoutContext){var t=[];t.push(e.removeLayoutPosition()),this.services.dashboardService.batchUpdateTileSizePosition(this.scope.viewModel,t),this.services.mobileAuthoringService.onUnpinTileFromMobileSimulator()}},t.prototype.reloadActiveDashboard=function(){this.scope.showReloadDashboard=!1,this.services.dashboardService.loadDashboard(this.scope.viewModel.id)},t})();t.DashboardController=s})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.services=t,this.initialize()}return e.createOptions=function(){return{additionalServices:["errorService","navigation","telemetryService","localizationService"]}},e.prototype.initialize=function(){var e=this;this.scope.switchToDashboardView=function(){return e.switchToDashboardView()}},e.prototype.switchToDashboardView=function(){this.services.navigation.navigateBack()},e})();e.DevToolsViewController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e){var t=this;this.scope=e,this.scope.chooseFormat=function(e){return t.chooseFormat(e)},this.scope.inProgress=!1}return t.prototype.chooseFormat=function(t){this.scope.inProgress=!0,this.scope.$emit(e.constants.uploadFormatChosenEventName,t)},t})();t.ExcelUploadFormatController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.constants,o=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.$on("$destroy",(function(){i.unRegisterDirtyStateNavigationHandler()}))}return e.prototype.unRegisterDirtyStateNavigationHandler=function(){this.reportChangedEventHandler&&(this.resetRouteChangeListeners(),this.reportChangedEventHandler())},e.prototype.registerDirtyStateNavigationHandler=function(){var e=this;this.unRegisterDirtyStateNavigationHandler(),this.reportChangedEventHandler=this.services.rootScope.$on(i.onReportChangedEventName,(function(t,o){e.resetRouteChangeListeners(),e.reportChanged=o&&(e.scope.viewModel.isEditing||1===e.services.viewModeState.getMode()),e.services.checkUnsavedService.setReportSavedState(o),e.reportChanged&&(e.routeStateChangeEvent=e.services.rootScope.$on(i.navigation.stateChangeStart,(function(t,o,r,a,n){a.name!==i.navigation.states.report&&a.name!==i.navigation.states.reports&&a.name!==i.navigation.states.reportPage&&a.name!==i.navigation.states.dashboardReport&&a.name!==i.navigation.states.dashboardReports&&a.name!==i.navigation.states.dashboardReportPage&&a.name!==i.navigation.states.dataset&&a.name!==i.navigation.states.datasets&&a.name!==i.navigation.states.sharedDashboardReports&&a.name!==i.navigation.states.sharedDashboardReports&&a.name!==i.navigation.states.sharedDashboardReportPage&&a.name!==i.navigation.states.reportSubscription||(e.showSavePrompt(o,r),t.preventDefault())})))}))},e.prototype.resetRouteChangeListeners=function(){this.routeStateChangeEvent&&(this.routeStateChangeEvent(),this.routeStateChangeEvent=null)},e.prototype.navigateAway=function(e,t){var i=this;this.services.rootScope.$applyAsync((function(){e&&e.name&&i.services.navigation.stateService.go(e.name,t)}))},e.prototype.showSavePrompt=function(e,t,i,o){},e.prototype.getSaveDialogTemplate=function(){var e=this,t="";return this.services.localizationService.ensureLocalization((function(){t='<div class="explorationSaveDialog"><div class="title">'+e.services.localizationService.get("ReportContainer_UnsavedChangeWarningTitle")+'</div><div class="message">'+e.services.localizationService.get("ReportContainer_UnsavedChangeWarningMessage")+"</div></div>"})),$(t)},e})();t.ExplorationContainerBaseController=o})(i=t.controllers||(t.controllers={}))})(t=e.common||(e.common={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.constants,o=e.common.events,r=e.dataServices.models.ContentPackItems,a=e.explore.contracts.DataSource,n=e.explore.constants.DefaultBaseThemeName,s=e.errorDetailsHelper,c=e.explore.services.events,l=e.explore.constants.explorationLoadedEventName,d=e.explore.util.ExplorationTrustedVisualUtil,p=e.dialogbuilders.ExportDataDialogBuilder,u=e.common.dialogs.FeatureNotSupportedDialogBuilder,h=e.common.constants.onReportChangedEventName,v=e.common.contracts.Permissions,g=e.explore.constants.pinVisualContainerEventName,m=e.explore.ScopeUtils,f=e.explore.util.ScriptVisualsUtil,b=e.explore.SectionUtils,y=e.visualHost.ThemeUtils,S=e.common.constants.tileActions,w=e.explore.viewModels.ViewModelFactory,D=e.explore.viewModels,C=e.explore.util.VisualContainerUtils,T=(function(t){function T(r,a){var n=t.call(this,r,a)||this;n.changeToEditMode=function(t){var o=n.scope.viewModel,r=t?1:0;n.services.viewModeState.setMode(r),t&&(o.taskPane.isPaneExpanded=!0,o.visualizationPane.isPaneExpanded=!0,n.services.featureSwitchService.featureSwitches.pivotTableVisualEnabled&&T.hasLegacyTableOrMatrix(o.exploration.contract)&&n.showConvertTableTutorial()),n.displayCustomVisualWarning(t);var a=f.getVisualStasInExploration(n.exploration,n.services.scriptVisuals);t||n.logRTelemetry(e.telemetry.EXLoadReportWithScriptVis,a),n.services.rootScope.$emit(e.common.constants.navigation.stateChangeStart,{},{},{name:i.navigation.states.reportPage},{}),o.isNavPaneCollapsed=!t,n.services.eventBridge.publishToChannel(c.changeViewMode,r)},n.scope.$on("destroy",(function(){n.modalDialogPromise&&n.modalDialogPromise.pending&&n.modalDialogPromise.reject("ExplorationContainerController destroyed")})),n.scope.$on(e.explore.constants.exploreCanvasVisualRendered,(function(){n.resolveOpenExplorationTelemetryEvent()})),n.scope.viewModeState=n.services.viewModeState,n.isSaveDialogOpened=!1,n.scope.exploreUIShellConfig=e.explore.modules.ExploreUIShellModule,n.warningBarNotified=!1,m.defineDataSourcesOnScopeLegacy(n.scope,n.services.dataSources);var s=D.createFieldListViewModelFactory(D.createFieldListMenuItemFactory(n.services.localizationService,n.services.featureSwitchService),D.createFieldListPropertyTemplateGenerator(),n.services.localizationService,n.services.featureSwitchService);n.scope.fieldListConfig={viewModelFactory:s,alwaysHasActiveItem:!0},n.initialize(n.scope.viewModel),n.unregisterViewModelWatch=n.scope.$watch("viewModel",(function(e){n.initialize(e)}));var l=n.services.rootScope.$on(o.loadPowerViewReportEventName,(function(e,t){e.stopPropagation(),n.onLoadPowerViewReport(t)})),d=n.services.rootScope.$on(o.refreshReportData,(function(e){e.stopPropagation(),n.onRefreshReportData()})),p=n.services.eventBridge.setBubblingScope(r).subscribe(c.saveExploration,(function(e,t){return n.save(e,t)})).subscribe(c.saveAsExploration,(function(e,t){return n.saveAs(e,t)})).subscribe(c.generateReportQR,(function(e){return n.generateQR(e)})).subscribe(c.refreshExploration,(function(e){return n.refresh(e)})).subscribe(c.deleteVisual,(function(e,t){return n.deleteVisual(e,t)})).subscribe(c.deleteCustomVisuals,(function(e){return n.deleteCustomVisuals(e)})).subscribe(c.pauseQueriesChanged,(function(e){return n.pauseQueriesChanged(e)})).subscribe(c.reportVisualError,(function(e,t){return n.showErrorNotification(e,t)})).subscribe(c.exportToPowerPoint,(function(e){return n.exportToPowerPoint(e)})).subscribe(c.exportAsImage,(function(e){return n.exportAsImage(e)})),u=n.services.eventBridge.createChannelSubscriptionManager().subscribe(c.sectionChanged,(function(e,t){return n.onSectionChange(t)})).subscribe(c.requestViewModeChange,(function(e,t){return n.onRequestViewModeChange(t)})).subscribe(c.addCustomVisual,(function(e,t){return n.onAddCustomVisual(e,t)})).subscribe(c.saveKeyPressedEvent,(function(e){return n.saveOnKeypress(e)})).subscribe(c.deleteSectionInitiated,(function(e,t){return n.onDeleteSection(t)})).subscribe(c.addVisualContainer,(function(e,t){return n.onAddVisualContainer(e,t)})).subscribe(c.addInsightContainer,(function(e,t){return n.onAddInsightContainer(e,t)})).subscribe(c.importVisual,(function(e){return n.importVisual(e)})).subscribe(c.downloadVisual,(function(e){return n.downloadCustomVisual(e)})).subscribe(c.installVisual,(function(e,t){return n.installCustomVisual(e,t)})).subscribe(c.visualRelationshipsModeChanged,(function(e){n.services.viewModeState.updateConfig((function(e){e.showRelationships=!e.showRelationships}))})).subscribe(c.exportVisualData,(function(e,t){return n.exportVisualData(e,t)})).subscribe(c.visibilityChanged,(function(){var e=!!n.services.visibility.get();!!n.isPopOutMode===e||n.isActiveSectionTransient?n.isPopOutMode=e:(n.isPopOutMode=e,n.updateNavigationPaneVisibility())})).subscribe(c.createBasicShape,(function(e,t){return n.onCreateBasicShape(e,t)})).subscribe(c.createTextbox,(function(e){return n.onCreateTextbox(e)})).subscribe(c.refreshExploration,(function(e){return n.refresh(e)})).subscribe(c.deleteCustomVisual,(function(e,t){return n.onDeleteCustomVisual(t)})).subscribe(c.newQueryCacheResultAvailable,(function(e,t){return n.onNewQueryCacheResultAvailable(e,t)})).subscribe(c.filterContainerChanged,(function(e,t){return n.filterContainerChanged(t)}));n.services.pinVisual.setHandler({pinVisual:function(e){n.pinVisual(e)}}),n.services.connectionSetupService=e.explore.services.createConnectionSetupService(n.services.conceptualSchemaProxy,n.services.dataProxy,n.services.visualAuthoring,n.services.visualQueryGenerator),$(window).on(jsCommon.DOMConstants.beforeUnload,(function(){return n.onWindowUnload()}));var h=n.services.rootScope.$on(e.constants.saveReportFromPinDialog,(function(e,t){n.saveAsInternalWithName(t).then((function(e){n.services.pinTileService.setSavedReportId(e.reportId)}))})),v=n.services.rootScope.$on(c.reportVisualError.name,(function(e,t,i,o){n.showErrorNotificationWithModel(i,t,o)}));n.scope.fullScreen=n.services.fullScreen,n.scope.featureSwitchService=n.services.featureSwitchService,n.scope.isFooterVisible=function(){return n.isFooterVisible()},n.scope.isVisualizationPaneVisible=function(){return n.isVisualizationPaneVisible()};var g=n.services.fullScreen,b={onFitStyleChanged:_.noop,onFullScreenModeChanged:function(){return n.onFullScreenChange(g.fullScreenMode)}};g.subscribe(b),n.onFullScreenChange(n.services.fullScreen.fullScreenMode);var y=n.scope.$on(i.navigation.stateChangeSuccess,(function(e,t,i,o,r){return n.handleStateChange(e,t,i,o,r)}));return n.scope.$on("$destroy",(function(){g.unsubscribe(b),n.removeKeyHandler(),l(),y(),h(),v(),n.unregisterViewModelWatch&&n.unregisterViewModelWatch(),d(),p.unsubscribeAll(),u.unsubscribeAll()})),n.embedTypeDescription=n.services.embedModeService.getEmbedTypeDescription(),n.scope.inAppArtifactView=function(){return n.services.conceptualModelSetting.isAppsEnabled()&&n.services.navigation.inAppArtifactView()},n}return __extends(T,t),T.createOptions=function(){return{additionalServices:["checkUnsavedService","conceptualModelSetting","conceptualSchemaProxy","dashboardService","dataProxy","embedModeService","errorService","explorationProxy","explorationSerializer","exportStaticExplorationService","featureSwitchService","fullScreen","gatewaysMetadataService","groupService","localizationService","modalDialogService","modelConverter","modelHttpService","moduleLoader","navigation","notificationBar","notificationToast","overlayService","packageService","pbiLazyLoad","permissionService","pinTileService","promiseFactory","qrCodeService","reportService","modelService","resourceGateService","resourcePackagesService","selectGatewayService","tutorialPopup","quota","telemetryService","themeService","userInfo","visualStylePresetService","auditing","mostRecentlyUsedService","trustedVisual","subscription","usageMetricsReport","activeGroupId","licenseEnforcementService","viewRelatedContentService","lazy","lazySync"],scopedServiceRoot:!0,scopedDependencies:["canvasKeyHandler","clipboard","colorPicker","dataSources","deleteVisual","eventBridge","explorationCapabilities","explorationNavigation","exportData","filterGenerator","formFactor","importVisual","layoutAuthoring","lazyScopedSync","modelChangeHandler","pinVisual","visibility","registeredResourceReferences","resourceLoader","resourceRegistration","scriptVisuals","selection","sort","undoRedo","viewModeState","visualAuthoring","visualPlugin","visualQueryGenerator","lazyScoped"]}},T.prototype.isFooterVisible=function(){var e=this.scope.viewModel;return!!e&&((e.options.showNavContentPane||this.services.viewModeState.getViewState().bookmarkView)&&!this.services.viewModeState.getConfig().displayOptions.hideNavigationPane)},T.prototype.isVisualizationPaneVisible=function(){var e=this.scope.viewModel;return!!e&&(e.options.showVisualizationPane&&!this.services.viewModeState.getConfig().displayOptions.hideVisualizationPane)},T.prototype.showOptionsDialog=function(e){var t=this,i="exportDataDialog",o=[{name:this.services.localizationService.get("ModalDialog_ExportDataFormatXL"),action:function(){return 1===t.services.exportData.getExportDataToExcelUnsupportedType(e.visualConfig,t.scope.viewModel.datasetModel)?void(t.modalDialogPromise=new u(t.services.modalDialogService).show("ExlFormat_UnsupportedDatasetDialogTitle","ExlFormat_ToolTipDescription_AsOnPrem","https://go.microsoft.com/fwlink/?linkid=834313")):void t.exportVisualDataToFile(e,1,0)}},{name:this.services.localizationService.get("ModalDialog_ExportDataFormatCsv"),action:function(){t.exportVisualDataToFile(e,0,0)}}];this.services.modalDialogService.showActionSelectionDialog(this.services.localizationService.get("ModalDialog_ExportDataTitle"),this.services.localizationService.get("ModalDialog_ExportDataText"),i,o,this.services.localizationService.get("ModalDialogButtonText_Export"),this.services.localizationService.get("PBI_Button_Label_Cancel"))},T.prototype.showExportDataDialogFromVisual=function(e){var t,i=this,o=new p(this.services.modalDialogService,this.services.localizationService),r=this.services.exportData.getExportDataToExcelUnsupportedType(e.visualConfig,this.scope.viewModel.datasetModel);0===r&&(t=this.services.lazyScopedSync("drillToDetails").getDetailsTableTargetMeasures(e.visualConfig)),o.show(r,_.any(t)).then((function(o){o&&i.exportVisualDataToFile(e,o.format,o.dataType,t)}))},T.prototype.isVisualInSeeRecordsMode=function(e){return C.hasGroupByItems(e)},T.prototype.exportVisualData=function(e,t){e.stopPropagation();var i=this.services,o=i.licenseEnforcementService;if(!o.supportsExportData||o.supportsExportData(!0)){var r=i.featureSwitchService.featureSwitches,a=i.explorationCapabilities.getCapabilities();r.exportVisualToExcelEnabled&&!a.disableExportToExcel?this.isVisualInSeeRecordsMode(t.visualConfig.query)?this.showOptionsDialog(t):r.enableExportDataNewDialog?this.showExportDataDialogFromVisual(t):this.exportVisualDataToFile(t,0,0):this.exportVisualDataToFile(t,0,0)}},T.prototype.exportVisualDataToFile=function(t,i,o,r){var a,n=this.services.dataSources.get(),s=this.services,c=s.userInfo.isPremiumUser,l=s.telemetryService.startEvent(e.telemetry.EXExportVisualData,t.visualConfig.visualType,e.telemetry.ExportVisualSource.Report,!1,i,c,this.isVisualInSeeRecordsMode(t.visualConfig.query),o),d=1===o;a=0===i?s.exportData.exportVisualDataToCsv(t.visualTitle,t.dataViewSource,n,t.visualConfig,t.transformActions,t.additionalFilters):s.exportData.exportVisualDataToExcel(t.visualTitle,n,t.visualConfig,t.additionalFilters,d,r),a.then((function(e){l.event.info.isPartialResult=e.isPartialResult,l.resolve()}),(function(e){l.reject({errorCode:e.error.toString()})})),this.services.auditing.auditEvent(this.reportId,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.exportReportTile)},T.prototype.exportToPowerPoint=function(e){e.stopPropagation();var t=this.services,i=t.reportService.findReport(this.reportId),o={reportId:this.reportId,filename:i.displayName,reportSectionsNumber:this.exploration&&this.exploration.sections?this.exploration.sections.length:void 0};this.services.lazy("exportToPowerPoint").then((function(e){e.exportToPowerPoint(o)}))},T.prototype.exportAsImage=function(e){e.stopPropagation();var t=this.services.reportService.findReport(this.reportId),i=this.services.explorationNavigation.getCurrentSection().name;this.services.exportStaticExplorationService.exportToPng(t.displayName,t.objectId,i)},T.prototype.onDeleteSection=function(t){var i=this;if(t.supportMinervaDialog){var o=t.sectionIndex,r=this.services.rootScope.$new(),a=this.scope.viewModel,n=this.services.errorService.control(),s=[new InJs.ModalDialogAction(this.services.localizationService.get("ExplorationNavigationTab_Delete"),function(t,r){n.hideDialog();var a={targetSectionIndex:o,userAction:!0};i.services.rootScope.$emit(e.explore.constants.deleteSectionEvent,a)}),new InJs.ModalDialogAction(this.services.localizationService.get("PBI_Button_Label_Cancel"),function(e,t){n.hideDialog()})];r.message=this.services.localizationService.get("ExplorationNavigationTab_DeleteWarningMessage");var c=a&&a.exploration&&a.exploration.sections&&a.exploration.sections[o]&&a.exploration.sections[o].contract?a.exploration.sections[o].contract.id:void 0,l=void 0;this.services.dashboardService.hasTileForReportandSection&&(l=this.services.dashboardService.hasTileForReportandSection(c));var d=void 0,p=void 0;l&&(d=jsCommon.ModalDialogNotificationType.Warning,p=this.services.localizationService.get("PinLiveReport_DeleteSectionWarning"));var u={dialogName:this.services.localizationService.get("ExplorationNavigationTab_DeleteWarningTitle"),isDismissable:!0,scope:r,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",dialogActions:s,notificationType:d,notificationText:p};this.services.modalDialogService.showLegacyWebModalDialog(u)}},T.prototype.onNewQueryCacheResultAvailable=function(t,i){var o=this.scope.viewModel.exploration,r=this.services.explorationCapabilities.getCapabilities();o&&!r.disableCacheUpdates&&(this.visualContainerQueryUpdater||(this.visualContainerQueryUpdater=new e.helpers.VisualContainerQueryUpdater(o.contract.id,this.services.explorationProxy)),this.visualContainerQueryUpdater.onNewQueryCacheResultAvailable(i)),t.stopPropagation&&t.stopPropagation()},T.prototype.filterContainerChanged=function(t){if(1===t.changeType&&5===t.filter.howCreated&&this.scope.viewModel&&this.scope.viewModel.exploration){var i=this.services.explorationNavigation.getCurrentSection(),o=_.any(i.visualContainers,(function(t){var i=t.config&&t.config.singleVisual&&t.config.singleVisual.visualLink;return i&&i.show&&i.type===e.explore.contracts.VisualLink.Back}));o||this.services.visualAuthoring.addVisualContainerDrillthroughBackButton(this.scope.viewModel.exploration.exploreCanvas)}},T.prototype.initialize=function(e){if(this.scope.explorationContainerOptions&&this.services.explorationCapabilities.setCapabilities(this.scope.explorationContainerOptions),e){e.showSpinner=!0,e.options||(e.options=this.services.explorationCapabilities.getCapabilities());var t=e.options;this.explorationNotificationIds=[];var i=this.services.featureSwitchService;this.services.viewModeState.updateConfig((function(e){e.supportsPinning=!t.visualContainerOptions.disablePin,e.supportsDeletion=!0,e.supportsExportData=!t.disableExport&&i.featureSwitches.exportDataEnabled})),e.shouldHideFilterPane&&(e.options.showVisualizationPane=!1),e.options.showAppBar=!e.shouldHideAppBar&&t.showAppBar,this.isPopOutMode&&this.services.visibility.clear(),this.updateNavigationPaneVisibility(),e.shouldHideTileMenu&&(e.options.visualContainerOptions.hideHeader=!0),e.options.overrideSectionSize=e.overrideSectionSize||e.options.overrideSectionSize,e.options.disableViewRelatedContent=this.services.viewRelatedContentService.disableViewRelated}},T.prototype.notifyIfModelRefreshDisabledBySelectiveRefresh=function(){var t=this.services;if(t.featureSwitchService.featureSwitches.selectiveModelRefresh){var i=this.scope.viewModel.datasetModel;if(i&&i.isRefreshDisabledDueToInactivity()){var o={notificationName:"inactiveModelRefreshDisabled",notificationId:t.notificationBar.notify({message:t.localizationService.get("Notification_InactiveModelRefreshDisabled"),notificationType:e.common.NotificationBarType.Warning,secondaryLink:{displayText:t.localizationService.get("LearnMore"),urlString:e.constants.configureScheduledRefreshLink}})};this.addNotification(o)}}},T.prototype.deleteVisual=function(e,t){var i=this.services.rootScope.$new(),o=this.scope.viewModel.exploration.contract;i.deleteVisualService=this.services.deleteVisual,i.errorService=this.services.errorService,i.explorationContract=o,i.customVisuals=[t.visual],i.deleteVisualButtonText=this.services.localizationService.get("DeleteVisual_Delete");var r=this.getCustomVisualContainerCount(t.visual);r>0?i.deleteVisualWarningText=this.services.localizationService.format("DeleteVisual_CustomVisualUsedMessage",[r]):i.deleteVisualWarningText=this.services.localizationService.format("DeleteVisual_CustomVisualNotUsedMessage",[r]);var a={dialogName:this.services.localizationService.get("DeleteVisual_DialogHeader"),isDismissable:!0,scope:i,template:"<delete-visual-warning-dialog></delete-visual-warning-dialog>",dialogCssClass:"deleteVisualWarning"};this.services.modalDialogService.showLegacyWebModalDialog(a),e.stopPropagation()},T.prototype.deleteCustomVisuals=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,o,r,a,n,s=this;return __generator(this,(function(c){switch(c.label){case 0:return i=this.services.rootScope.$new(),o=this.scope.viewModel.exploration.contract,i.deleteVisualService=this.services.deleteVisual,i.errorService=this.services.errorService,i.localizationService=this.services.localizationService,i.modalDialogService=this.services.modalDialogService,i.explorationContract=o,r={selectedVisualCount:0,customVisuals:[]},a=_.filter(w.getCustomVisualTypes(this.services.visualPlugin.getConvertibleVisuals()),(function(e){return!s.services.trustedVisual.isAutomaticallyImportedVisual(e.plugin.name)})),r.customVisuals=a,this.getCustomVisualsTileCounts(r.customVisuals),i.viewModel=r,t.stopPropagation(),[4,this.services.pbiLazyLoad.load(e.explore.modules.ExploreUIShellModule)];case 1:return c.sent(),n={dialogName:this.services.localizationService.get("DeleteVisuals_DialogHeader"),isDismissable:!0,scope:i,template:"<delete-custom-visuals-dialog></delete-custom-visuals-dialog>",dialogCssClass:"deleteCustomVisuals"},this.services.modalDialogService.showLegacyWebModalDialog(n),[2]}}))}))},T.prototype.importVisual=function(e){var t=this.services.rootScope.$new();t.importVisualService=this.services.importVisual,t.errorService=this.services.errorService,t.explorationContract=this.scope.viewModel.exploration.contract;var i={dialogName:this.services.localizationService.get("ImportVisual_CautionDialogHeader"),isDismissable:!0,scope:t,template:"<import-visual-warning-dialog></import-visual-warning-dialog>",dialogCssClass:"importVisualWarning"};this.services.modalDialogService.showLegacyWebModalDialog(i),e.stopPropagation()},T.prototype.downloadCustomVisual=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o=this;return __generator(this,(function(r){switch(r.label){case 0:return t.stopPropagation(),[4,this.services.lazyScoped("customVisualsStore")];case 1:return e=r.sent(),[4,this.services.lazyScoped("customVisualsStoreMetadata")];case 2:return i=r.sent(),i.getCustomVisualsStoreLocation().then((function(t){o.modalDialogPromise=e.obtainCustomVisualId(t.data.url)})),[2]}}))}))},T.prototype.installCustomVisual=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a=this;return __generator(this,(function(n){switch(n.label){case 0:return t.stopPropagation(),[4,this.services.lazyScoped("customVisualsStoreMetadata")];case 1:return o=n.sent(),this.services.localizationService.ensureLocalization((function(){r=a.services.notificationToast.notify({title:a.services.localizationService.get("ImportCustomVisualLoadingTitle"),message:a.services.localizationService.get("ImportCustomVisualLoadingMessage"),notificationType:e.common.NotificationToastType.Loading})})),o.getCustomVisual(i.assetId).then((function(e){return a.services.importVisual.import(a.scope.viewModel.exploration.contract,e.data)})).finally((function(){return a.services.notificationToast.hide(r)})),[2]}}))}))},T.prototype.onAddCustomVisual=function(e,t){this.services.undoRedo.clear();var i=this.scope.viewModel.exploration.contract.resourcePackages;i?_.find(i,(function(e){return e.name===t.name}))||i.push(t):i=this.scope.viewModel.exploration.contract.resourcePackages=[],this.services.resourcePackagesService.registerPackages([t]),e.stopPropagation()},T.prototype.onDeleteCustomVisual=function(e){var t=[];this.scope.viewModel.exploration.sections.forEach((function(i){i.contract.visualContainers.forEach((function(i){i.config.singleVisual.visualType===e.visual.name&&t.push(i)}))})),this.services.visualAuthoring.deleteVisualContainers(t,this.scope.viewModel.exploration),this.services.rootScope.$emit(i.onReportChangedEventName,!0)},T.prototype.onCreateTextbox=function(e){this.onAddVisualContainer(e,{visualType:"textbox",telemetrySource:4})},T.prototype.onCreateBasicShape=function(e,t){this.services.visualAuthoring.addVisualContainerBasicShape(this.scope.viewModel.exploration.exploreCanvas,t.shapeType,null)},T.prototype.onAddVisualContainer=function(t,i){e.explore.util.CanvasVisualsUtility.addVisualContainerToCanvas(i,this.scope.viewModel.exploration.exploreCanvas,this.services.dataSources.get(),this.services.visualAuthoring,this.services.telemetryService),t.stopPropagation&&t.stopPropagation()},T.prototype.onAddInsightContainer=function(e,t){e.stopPropagation&&e.stopPropagation(),this.services.visualAuthoring.addVisualContainerFromConfig(t.visualContainer.config,t.visualContainer.filters,this.scope.viewModel.exploration.exploreCanvas)},T.prototype.onWindowUnload=function(){if(this.reportChanged&&1===this.services.viewModeState.getMode())return this.services.localizationService.get("ReportContainer_WindowUnload")},T.prototype.onFullScreenChange=function(e){if(this.scope.viewModel&&this.scope.viewModel.options){var t=this.scope.viewModel.options;if(e)this.services.navigation.inReportDetailView()&&1===this.services.viewModeState.getMode()&&this.onRequestViewModeChange(0),this.oldFullScreenOptions=_.cloneDeep(this.scope.viewModel.options),t.visualContainerOptions.showPin=!1,t.showAppBar=!1,t.showTaskPane=!1,t.showVisualizationPane=!this.services.navigation.inReportEmbedView(),
this.isReportInEmbedView=this.services.navigation.inReportEmbedView(),this.updateNavigationPaneVisibility(!1);else if(this.oldFullScreenOptions){var i=this.oldFullScreenOptions,o=this.services.explorationCapabilities.getCapabilities();t.visualContainerOptions.showPin=o.visualContainerOptions.showPin=i.visualContainerOptions.showPin,t.showAppBar=o.showAppBar=i.showAppBar,t.showTaskPane=o.showTaskPane=i.showTaskPane,t.showVisualizationPane=o.showVisualizationPane=i.showVisualizationPane,t.visualContainerOptions.disablePin=!this.scope.viewModel.canEdit,this.oldFullScreenOptions=null}}},T.prototype.showUnsupportedVisualSaveError=function(){this.services.errorService.infoCustom(this.services.localizationService.get("ExploreCompatibility_UnsupportedVisualSaveErrorTitle"),this.services.localizationService.get("ExploreCompatibility_UnsupportedVisualSaveErrorMessage"))},T.prototype.showSavePrompt=function(t,i,o,r){var a=this,n=this.services.errorService.control();_.isFunction(r)||(r=_.noop);var s=[new InJs.ModalDialogAction(this.services.localizationService.get("ReportContainer_Save"),function(o,s){if(n.hideDialog(),a.isSaveDialogOpened=!1,e.helpers.ReportUtility.HasUnsupportedExploreVisuals(a.scope.viewModel.exploration.contract,a.services.visualPlugin))a.showUnsupportedVisualSaveError();else{var c=a.services.promiseFactory.defer();a.triggerSaveOrSaveAs(c),c.promise.then((function(){r(),a.navigateAway(t,i)})).finally((function(){a.hideSaveMask()}))}}),new InJs.ModalDialogAction(this.services.localizationService.get("ReportContainer_Dontsave"),function(e,o){r(),n.hideDialog(),a.services.rootScope.$emit(h,!1),a.navigateAway(t,i),a.isSaveDialogOpened=!1}),new InJs.ModalDialogAction(this.services.localizationService.get("PBI_Button_Label_Cancel"),function(e,t){n.hideDialog(),a.isSaveDialogOpened=!1})];this.isSaveDialogOpened===!1&&(n.showCustomDialog(null,this.getSaveDialogTemplate(),s,null,!0,null,null,null,(function(){a.isSaveDialogOpened=!1})),this.isSaveDialogOpened=!0)},T.prototype.removeKeyHandler=function(){this.currentKeyHandler&&($(window).off("keydown",this.currentKeyHandler),this.currentKeyHandler=void 0)},T.prototype.addKeyHandler=function(){var e=this;this.currentKeyHandler||(this.currentKeyHandler=function(t){if(e.scope.viewModel&&e.scope.viewModel.exploration&&!$(t.target).is(jsCommon.DOMConstants.EditableTextElements)&&!$(t.target).is(jsCommon.DOMConstants.EditableNumericElements))return e.services.canvasKeyHandler.onKeyDown(t,e.scope.viewModel.exploration.exploreCanvas)},$(window).on("keydown",this.currentKeyHandler))},T.prototype.handleStateChange=function(e,t,i,o,r){this.scope.viewModel.showSpinner=!0,this.hideAllExplorationWarnings();var a=this.services.navigation.inReportView()||this.services.navigation.inDatasetView();a||(this.removeKeyHandler(),this.clearExploration()),this.services.overlayService.hideAllDropdowns()},T.prototype.pinVisual=function(e){if(e){var t=this.services.explorationNavigation.getCurrentSection().name;e.reportId=this.reportId;var i=this.services.dataSources.get();i.length>0&&(e.modelId=i[0].id,e.packageId=this.packageId);var o,r=this.getReportContract();r&&this.services.featureSwitchService.featureSwitches.usageMetricsEnabled&&this.services.usageMetricsReport.reportBelongsToUsageMetricsContentPack&&this.services.usageMetricsReport.reportBelongsToUsageMetricsContentPack(r)&&(o=this.services.navigation.additionalODataFilter),e.action={action:S.openReportActionName,targetSlideId:t,filter:o},this.services.rootScope.$emit(g,e)}},T.prototype.onSectionChange=function(e){var t=this.services.navigation;t.updateReportStateNoReload({appGUID:t.currentAppGUID,appInstanceId:t.currentAppInstanceId,reportGUID:t.currentReportGUID,reportOriginalGUID:t.currentReportOriginalGUID,groupGUID:this.services.groupService.activeGroupObjectId,reportPage:e.name,dashboardGUID:t.currentDashboardGUID,filter:t.additionalODataFilter},!1,2);var i,o=this.scope.viewModel,r=o.exploration.contract,a=this.services.featureSwitchService.featureSwitches;a&&a.trackUserInfo&&!a.usageMetricsTrackUserLevelInfoEnabled&&(i=!0);var n={exploration:r,section:e.name,reportGUID:this.services.navigation.currentReportGUID,reportPermissions:o.reportPermission,groupObjectId:this.services.groupService.activeGroupObjectId,isReadonlyGroup:this.services.permissionService.isActiveWorkspaceIsReadOnly,scrubUserInfo:i};this.services.layoutAuthoring.updateExplorationActiveSectionIndex(n);var s=this.services.explorationNavigation.getCurrentSection(),c=s&&s.transient;!!this.isActiveSectionTransient==!!c||this.isPopOutMode?this.isActiveSectionTransient=c:(this.isActiveSectionTransient=c,this.updateNavigationPaneVisibility())},T.prototype.logRTelemetry=function(e,t){this.scope.viewModel.options.disableLogRTelemetry||this.services.telemetryService.logEvent(e,t.totalVisualsCount,t.scriptVisualsUniqueIds.length,JSON.stringify(t.scriptVisualsUniqueIds),this.services.userInfo.userLicense())},T.prototype.onRequestViewModeChange=function(e){var t=this,o=1===e;o&&!this.scope.viewModel.canEdit||(this.reportChanged?this.showSavePrompt({},i.navigation.states.reportPage,"",(function(){t.changeToEditMode(o)})):this.changeToEditMode(o))},T.prototype.hideAllExplorationWarnings=function(){for(var e=this.explorationNotificationIds;e.length>0;)this.services.notificationBar.hide(e.pop().notificationId);this.explorationNotificationIds=[]},T.prototype.hideExplorationWarning=function(e){for(var t=this.explorationNotificationIds,i=0,o=t;i<o.length;i++){var r=o[i];if(e&&r.notificationName===e){this.services.notificationBar.hide(r.notificationId),t.splice(t.indexOf(r),1);break}}this.explorationNotificationIds=t},T.prototype.isNotificationShown=function(e){for(var t=this.explorationNotificationIds,i=0,o=t;i<o.length;i++){var r=o[i];if(e&&r.notificationName===e)return r.notificationId}},T.prototype.addNotification=function(e){e&&(this.isNotificationShown(e.notificationName)&&this.hideExplorationWarning(e.notificationName),this.explorationNotificationIds.push(e))},T.prototype.createCustomVisualWarningHelper=function(t,i){var o=this;if(this.scope.viewModel.options.customVisualsAlwaysEnabled)t&&this.onEnsureCustomViz(t.resourcePackages,i);else if(!this.warningBarNotified){this.warningBarNotified=!0;var r={notificationName:"lastEnableCustomVizNotifyId",notificationId:this.services.notificationBar.notify({message:this.services.localizationService.get("OpenReport_EnableCustomVisualWarningMessage"),notificationType:e.common.NotificationBarType.Warning,actions:[{displayText:this.services.localizationService.get("OpenReport_EnableCustomVisualButton"),linkId:1,action:function(){o.services.resourceGateService.addResourcePackageIdToDashboard(t.id.toString(),t.resourcePackages.map((function(e){return e.id.toString()}))),o.onEnsureCustomViz(t.resourcePackages,i)}}],secondaryLink:{displayText:this.services.localizationService.get("LearnMore"),urlString:"https://go.microsoft.com/fwlink/?LinkID=627490"}})};this.addNotification(r)}},T.prototype.createCustomVisualWarning=function(e,t){this.services.resourceGateService.shouldShowWarning(e.resourcePackages.map((function(e){return e.id.toString()})),e.id.toString())?this.createCustomVisualWarningHelper(this.exploration,t):this.onEnsureCustomViz(e.resourcePackages,t)},T.prototype.updateNavigationPaneVisibility=function(e){if(void 0===e&&(e=!0),e)if(this.isPopOutMode||this.isActiveSectionTransient)this.oldNavPaneOptions=_.cloneDeep(this.scope.viewModel.options);else if(this.oldNavPaneOptions){var t=this.services.explorationCapabilities.getCapabilities();t.showNavContentPane=this.oldNavPaneOptions.showNavContentPane,this.oldNavPaneOptions=null}var i=!this.isPopOutMode&&!this.isActiveSectionTransient&&this.services.explorationCapabilities.getCapabilities().showNavContentPane;this.scope.viewModel.options.showNavContentPane=!this.scope.viewModel.shouldHideSlideBar&&i},T.prototype.displayCustomVisualWarning=function(e){if(this.exploration&&this.exploration.resourcePackages&&this.exploration.resourcePackages.length>0)if(!e&&this.exploration.sections)for(var t=this.exploration.sections,i=0,o=t;i<o.length;i++){var r=o[i];if(r.visualContainers){var a=r.visualContainers;if(this.containsCustomVisual(a)){this.createCustomVisualWarning(this.exploration,e);break}}}else this.createCustomVisualWarning(this.exploration,e)},T.prototype.showConvertTableTutorial=function(){var t=e.createConvertTableTutorialModel(this.services.localizationService);this.services.tutorialPopup.startTutorial(t)},T.hasLegacyTableOrMatrix=function(e){var t=e.sections;if(_.isEmpty(t))return!1;for(var i=0,o=t;i<o.length;i++){var r=o[i],a=r.visualContainers;if(!_.isEmpty(a))for(var n=0,s=a;n<s.length;n++){var c=s[n],l=c.config.singleVisual.visualType;if("table"===l||"matrix"===l)return!0}}return!1},T.prototype.containsCustomVisual=function(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];if(o.config&&o.config.singleVisual&&o.config.singleVisual.visualType){var r=o.config.singleVisual.visualType;if(this.resourcePackageContainsCustomVisual(r))return!0}}return!1},T.prototype.getCustomVisualContainerCount=function(e){var t=0;return this.scope.viewModel.exploration.contract.sections.forEach((function(i){i.visualContainers.forEach((function(i){i.config.singleVisual.visualType===e.name&&++t}))})),t},T.prototype.getCustomVisualsTileCounts=function(e){var t=this;e.forEach((function(e){e.tileCount=0,t.scope.viewModel.exploration.contract.sections.forEach((function(t){for(var i=0,o=t.visualContainers;i<o.length;i++){var r=o[i];r.config.singleVisual.visualType===e.plugin.name&&(e.tileCount+=1)}})),e.tileCountMessage=t.services.localizationService.format("DeleteVisual_AssociatedTiles",[e.tileCount]),e.selected=!1}))},T.prototype.resourcePackageContainsCustomVisual=function(e){if(this.exploration&&this.exploration.resourcePackages)for(var t=this.exploration.resourcePackages,i=0,o=t;i<o.length;i++){var r=o[i];if(r.name===e)return!0}return!1},T.prototype.notifyForSave=function(t,i,o){var r=this;this.services.localizationService.ensureLocalization((function(){r.services.notificationToast.notify({title:r.services.localizationService.get(t),message:r.services.localizationService.get(o),notificationType:e.common.NotificationToastType.Success})}))},T.prototype.triggerSaveOrSaveAs=function(t){var i=this;if(this.reportId){var o,a=this.services.telemetryService.startEvent(e.telemetry.EXSaveExploration,!1);return this.showSaveMask(),this.prepareToSave(),this.services.explorationProxy.save(this.originalExploration,this.scope.viewModel.exploration.contract,this.reportId).then((function(e){return e||t.reject(),o=e,i.services.lazySync("linguisticSchemaProxy").save(e.reportId)})).then((function(){i.lastLoadedReport.contract.hasExploration=!0,i.onSaveSuccessCommon(o),i.notifyForSave("SaveReport_Success",0,"SaveReport_Success_DefaultDetails");var n=i.services.reportService.findReport(i.reportId);n&&n.isUsedByContentPack&&i.services.rootScope.$emit(e.constants.contentPackDirtyShowNotification,i.reportId,r.Report),a.resolve(),t.resolve(null)}),(function(e){i.showError(e,i.services.localizationService.get("ExplorationContainer_FailedToSaveReport"),"ExplorationContainer_FailedToSaveReportDefaultDetails"),a.reject(s.getTelemetryErrorDetails(e?e.error:null,e?e.httpStatusCode:null)),t.reject()}))}return this.saveAsInternal().then((function(){i.notifyForSave("SaveReport_Success",0,"SaveReport_Success_DefaultDetails"),t.resolve(null)}),(function(){t.reject()}))},T.prototype.saveOnKeypress=function(e){if(this.scope.viewModel.canEdit){var t=this.scope.viewModel.options,i={overrideSaveRouting:this.services.explorationCapabilities.getCapabilities().overrideSaveRouting};0!==this.scope.viewModeState.getMode()||t.disableSaveOnKeyPress?this.save(e,i):this.saveAs(e,i)}},T.prototype.refresh=function(t){var i={changes:[],isSchemaChangeListComplete:!1};this.services.modelChangeHandler.applyChange({change:this.services.promiseFactory.resolve(i),leaveUndo:!0}),this.hideExplorationWarning("lastErrorNotifyId"),t&&t.stopPropagation&&t.stopPropagation();var o=f.getVisualStasInExploration(this.exploration,this.services.scriptVisuals);this.logRTelemetry(e.telemetry.EXExplorationRefresh,o)},T.prototype.prepareToSave=function(){},T.prototype.save=function(t,i){var o=this;if(!i||!i.overrideSaveRouting){if(this.reportId)if(e.helpers.ReportUtility.HasUnsupportedExploreVisuals(this.scope.viewModel.exploration.contract,this.services.visualPlugin))this.showUnsupportedVisualSaveError();else{var a,n=this.services.telemetryService.startEvent(e.telemetry.EXSaveExploration,!1);this.showSaveMask(),this.prepareToSave(),this.services.explorationProxy.save(this.originalExploration,this.scope.viewModel.exploration.contract,this.reportId).then((function(e){return e||o.services.promiseFactory.reject(),a=e,o.services.lazySync("linguisticSchemaProxy").save(e.reportId)})).then((function(){o.lastLoadedReport.contract.hasExploration=!0,o.onSaveSuccessCommon(a),o.notifyForSave("SaveReport_Success",0,"SaveReport_Success_DefaultDetails");var t=o.services.reportService.findReport(o.reportId);t&&t.isUsedByContentPack&&o.services.rootScope.$emit(e.constants.contentPackDirtyShowNotification,o.reportId,r.Report),n.resolve()}),(function(e){o.showError(e,o.services.localizationService.get("ExplorationContainer_FailedToSaveReport"),"ExplorationContainer_FailedToSaveReportDefaultDetails"),n.reject(s.getTelemetryErrorDetails(e?e.error:null,e?e.httpStatusCode:null))})).finally((function(){o.hideSaveMask()}))}else this.saveAsInternal().then((function(){o.notifyForSave("SaveReport_Success",0,"SaveReport_Success_DefaultDetails")}),(function(){}));this.services.overlayService.hideAllDropdowns(),t.stopPropagation&&t.stopPropagation()}},T.prototype.generateQR=function(e){this.services.qrCodeService.showDialogForReport(this.scope,this.services.explorationNavigation.getCurrentExploration().report,this.scope.viewModel.displayName,this.services.groupService.activeGroupObjectId,this.services.navigation.currentReportPage,this.services.navigation.currentAppGUID)},T.prototype.saveAs=function(t,i){var o=this;i&&i.overrideSaveRouting||this.services.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.ReportSaveAs)||(this.saveAsInternal(i.saveAsWithoutPrompt).then((function(){o.notifyForSave("SaveReport_Success",0,"SaveReport_Success_DefaultDetails")}),(function(){})),this.services.overlayService.hideAllDropdowns(),t.stopPropagation&&t.stopPropagation())},T.prototype.synchronizeExplorationIds=function(e,t){t.id=e.id,t.reportId=e.reportId,b.synchronizeSectionsIds(e.sections,t.sections)},T.prototype.onSaveSuccessCommon=function(e){this.synchronizeExplorationIds(e,this.scope.viewModel.exploration.contract);var t={featureUsage:{}},i=this.services.explorationSerializer,o=i.serializeExploration(e,t);this.originalExploration=i.deserializeExploration(o,[],!0),this.services.rootScope.$emit(h,!1)},T.prototype.confirmSaveAs=function(t,o){var r=this;this.showSaveMask();var a,n=this.services.telemetryService.startEvent(e.telemetry.EXSaveExploration,!0),c=this.services,l=this.scope.viewModel.exploration.contract.reportId;this.prepareToSave();var d=this.services.dataSources.get(),p=d[0].id;this.services.explorationProxy.saveAs(this.scope.viewModel.exploration.contract,t,p,this.packageId).then((function(e){e&&e.reportId||o.reject(),a=e;var t=r.services.lazySync("linguisticSchemaProxy");if(l){var i=t.getSchema(l);t.setSchema(e.reportId,i)}return t.save(e.reportId)})).then((function(){var s=c.navigation;if(r.scope.viewModel.displayName=t,r.reportId=a.reportId,r.reportGUID=a.report.objectId,r.onSaveSuccessCommon(a),r.services.usageMetricsReport.isUsageMetricsContentProvider&&r.services.usageMetricsReport.isUsageMetricsContentProvider(r.scope.viewModel.datasetModel.contentProviderId))r.services.reportService.mergeReportCollection([a.report]),r.services.modelService.mergeDatasetCollection([a.report.model]),s.navigateToReport({groupGUID:c.groupService.activeGroupObjectId,reportGUID:a.report.objectId,reportPage:s.currentReportPage,filter:null});else{var l={id:r.reportId,displayName:t,objectId:r.reportGUID,modelId:p,permissions:e.common.contracts.Permissions.All|e.common.contracts.Permissions.Explore},d=r.services.reportService.tryAddReport(l);d&&(r.scope.viewModel.exploration.contract.report=d.contract);var u={id:r.reportId,displayName:t,guid:r.reportGUID};s.updateReportStateNoReload({reportGUID:r.reportGUID,groupGUID:c.groupService.activeGroupObjectId,reportPage:s.currentReportPage},!0).then((function(){return c.rootScope.$emit(i.currentActiveReportInfoChangedEventName,u)})),r.updateReportInfo(u),c.mostRecentlyUsedService.updateMRU(e.models.MRUArtifactType.Reports,r.reportGUID,t,a.report.permissions)}n.resolve(),o.resolve(a)}),(function(e){r.showError(e,r.services.localizationService.get("ExplorationContainer_FailedToSaveReport"),"ExplorationContainer_FailedToSaveReportDefaultDetails"),n.reject(s.getTelemetryErrorDetails(e?e.error:null,e?e.httpStatusCode:null)),o.reject()}))},T.prototype.updateReportInfo=function(e){var t=this.scope&&this.scope.viewModel&&this.scope.viewModel.exploration&&this.scope.viewModel.exploration.contract&&this.scope.viewModel.exploration.contract.report;t&&(t.id=e.id,t.objectId=e.guid,t.displayName=e.displayName)},T.prototype.saveAsInternal=function(t){var i=this,o=this.services.promiseFactory.defer();return t?this.confirmSaveAs(void 0,o):e.explore.controllers.showSaveAsDialog(this.services.errorService,this.services.localizationService).then((function(e){i.confirmSaveAs(e,o)}),(function(){o.reject()})),o.promise.finally((function(){i.hideSaveMask()})),o.promise},T.prototype.saveAsInternalWithName=function(e){var t=this,i=this.services.promiseFactory.defer();return e||i.reject(),this.confirmSaveAs(e,i),i.promise.finally((function(){t.hideSaveMask()})),i.promise},T.prototype.loadModelAndNotifyIfFailed=function(){var t=this,i=this.services.telemetryService.startActivity(this.scope,e.telemetry.EXLoadExplorationSchema),o=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(o).then((function(){i.resolve()})).catch((function(o){var r={errorCode:t.getErrorInfoCode(o)};t.rejectOpenExplorationTelemetryEvent(r),i.reject(r),o&&o.serviceError&&e.helpers.ReportUtility.shouldDisplayErrorAsNotificationBar(o.serviceError.errorCode)?t.services.eventBridge.publishBubbling(t.scope,c.reportVisualError,{error:{code:o.serviceError.errorCode,"pbi.error":{code:o.serviceError.errorCode,parameters:[],details:o.serviceError.errorDetails}},showNotification:!0}):e.explore.util.handleConceptualSchemaError(o,t.services.errorService,t.services.localizationService.get("ExplorationContainer_FailedToLoadModel"),"ExplorationContainer_FailedToLoadModel_DefaultDetails")}))},T.prototype.loadLinguisticSchemaAndNotifyIfFailed=function(e){var t=this;this.services.lazySync("linguisticSchemaProxy").init(e.reportId,e.reportHasLinguisticSchema).catch((function(e){return t.showError(e,t.services.localizationService.get("ExplorationContainer_FailedToLoadReport"),"ExplorationContainer_FailedToLoadReport_DefaultDetails")}))},T.prototype.initializeExploration=function(t,i,o,r,a,c,p,u,h,v){return __awaiter(this,void 0,e.Promise,(function(){var g,m,f,y,S,D=this;return __generator(this,(function(C){switch(C.label){case 0:return this.warningBarNotified=!1,this.services.visualPlugin.removeAllCustomVisuals&&this.services.visualPlugin.removeAllCustomVisuals(),this.services.resourceGateService.setResourceFlag(),g=this.scope.viewModel.options,r?(this.scope.viewModel.showSpinner=!1,m={width:e.explore.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:e.explore.constants.ExploreCanvasConstants.DefaultCanvasHeight,dataSources:e.explore.contracts.createDataSourceArray(),sections:[{name:"ReportSection",displayName:void 0,visualContainers:[],filters:[],size:{displayOption:1,width:e.explore.constants.ExploreCanvasConstants.DefaultWidescreenWidth,height:e.explore.constants.ExploreCanvasConstants.DefaultWidescreenHeight}}]},this.services.featureSwitchService.featureSwitches.baseTheme&&(m.baseTheme=n),b.fillDefaultSectionDisplayNames(m,this.services.localizationService),[4,this.addODataFilterFromQuery(m,u)]):[3,4];case 1:return C.sent(),[4,this.initializeThemes(m)];case 2:return C.sent(),this.scope.viewModel.exploration=w.convertExploration(m,this.services.formFactor.getCurrentLayout()),this.services.telemetryService.logEvent(e.telemetry.EXInitExploration,v,c&&c.directQueryMode===!0,c&&!_.isEmpty(c.onPremModelConnectionString)),this.setSectionStatus(0),this.setVisualThemeColors(m.theme,m.baseTheme),this.setDataSource(c),[4,this.tryAddJsonFilters(m,h)];case 3:return C.sent(),this.services.explorationNavigation.loadExploration(m),g.disableLinguisticSchemaInitialization||this.loadLinguisticSchemaAndNotifyIfFailed(m),this.scope.$broadcast(l),this.setupConnection(c),this.loadModelAndNotifyIfFailed(),b.gotoSection(this.scope.viewModel,0,this.services.selection,this.services.explorationNavigation,this.services.formFactor.getCurrentLayout()),this.resolveOpenExplorationTelemetryEventWhenNoVisualContainers(),[3,8];case 4:return this.scope.viewModel.showSpinner=!0,f=function(t){return __awaiter(D,void 0,e.Promise,(function(){var r,n,s,p,m,f,y=this;return __generator(this,(function(S){switch(S.label){case 0:for(g.disableLinguisticSchemaInitialization||this.loadLinguisticSchemaAndNotifyIfFailed(t),r=0,n=t.sections;r<n.length;r++)s=n[r],p=this.scope.viewModel.options.overrideSectionSize,p&&_.isNumber(p.displayOption)?s.size={displayOption:p.displayOption,width:p.width||s.size.width,height:p.height||s.size.height}:null!=this.scope.viewModel.options.defaultDisplayOption&&0===s.size.displayOption&&(s.size.displayOption=this.scope.viewModel.options.defaultDisplayOption);return i?m=b.findSectionIndexForSectionName(t,i):o?m=b.findSectionIndexForSectionName(t,o):_.isNumber(t.activeSectionIndex)&&(m=t.activeSectionIndex),null==m&&(m=0),b.fillDefaultSectionDisplayNames(t,this.services.localizationService),[4,this.addODataFilterFromQuery(t,u)];case 1:return S.sent(),this.setSectionStatus(m),this.setVisualThemeColors(t.theme,t.baseTheme),f=this.services.explorationSerializer.serializeExploration(t),this.originalExploration=this.services.explorationSerializer.deserializeExploration(f,[],!0),this.scope.viewModel.exploration=w.convertExploration(t,this.services.formFactor.getCurrentLayout(),m),this.services.telemetryService.logEvent(e.telemetry.EXInitExploration,v,c&&c.directQueryMode===!0,c&&!_.isEmpty(c.onPremModelConnectionString)),this.setDataSource(c),[4,this.tryAddJsonFilters(t,h)];case 2:return S.sent(),this.loadModelAndNotifyIfFailed(),this.changeToEditMode(a),this.scope.viewModel.showSpinner=!1,this.services.explorationNavigation.loadExploration(t),d.acquireTrustedVisuals(t,this.services.trustedVisual).then((function(e){return y.reloadTrustedVisuals(e)})),this.scope.$broadcast(l),b.gotoSection(this.scope.viewModel,m,this.services.selection,this.services.explorationNavigation,this.services.formFactor.getCurrentLayout()),this.resolveOpenExplorationTelemetryEventWhenNoVisualContainers(),this.setupConnection(c),this.services.rootScope.$emit(e.constants.openReportFinished,"",!1),this.services.navigation.inReportSubscriptionView()&&this.services.subscription.expandPaneForReportSubscription({currentSection:this.services.explorationNavigation.getCurrentSection(),report:this.services.explorationNavigation.getCurrentExploration().report,modelId:this.services.explorationNavigation.getCurrentExploration().dataSources[0].id,sections:this.services.explorationNavigation.getCurrentExploration().sections},this.services.navigation.currentSubscriptionGUID),[2]}}))}))},this.exploration=p,p?[4,this.initializeThemes(p)]:[3,7];case 5:return C.sent(),[4,f(p)];case 6:return C.sent(),[3,8];case 7:y=this.services.telemetryService.startEvent(e.telemetry.EXFetchExploration,v),S={id:t,model:c},this.services.explorationProxy.get(S).then((function(t){return __awaiter(D,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.exploration=t,[4,this.initializeThemes(t)];case 1:return e.sent(),[4,f(t)];case 2:return e.sent(),y.resolve(),[2]}}))}))}),(function(t){D.showError(t,D.services.localizationService.get("ExplorationContainer_FailedToLoadReport"),"ExplorationContainer_FailedToLoadReport_DefaultDetails"),D.scope.viewModel.showSpinner=!1,D.services.rootScope.$emit(e.constants.openReportFinished,t&&t.error?t.error.message:"",!0),y.reject(),D.rejectOpenExplorationTelemetryEvent(s.getTelemetryErrorDetails(t&&t.error))})),C.label=8;case 8:return[2]}}))}))},T.prototype.getErrorInfoCode=function(t){if(t){if(t.serviceError)return t.serviceError.errorCode?t.serviceError.errorCode:e.constants.modelFailedGenericServiceError;if(t.clientError)return t.clientError.code?t.clientError.code:e.constants.modelFailedGenericClientError}return e.constants.modelFailednoErrorInfo},T.prototype.setupConnection=function(e){if(!_.isEmpty(e.onPremModelConnectionString)){var t=this.services.dataSources.get();this.services.connectionSetupService.setup(t)}},T.prototype.onEnsureCustomViz=function(t,i){var o=this;if(this.services.telemetryService.logEvent(e.telemetry.EXEnableCustomViz,this.embedTypeDescription),this.services.resourceGateService.setResourceFlag(),this.services.resourcePackagesService.registerPackages(t),!i){var r=this.getVisualTypeUsageTable();t=_.filter(t,(function(e){return r[e.name]}))}this.services.visualPlugin.ensurePlugins(t).finally((function(){o.services.eventBridge.publishToChannel(e.explore.services.events.visualPluginsChanged);var i=_.chain(t).filter((function(e){return 0===e.type})).map((function(e){return e.name})).value();_.isEmpty(i)||o.services.rootScope.$emit(e.constants.reloadEmptyVisuals,{visualTypes:i})})),this.hideExplorationWarning("lastEnableCustomVizNotifyId"),this.hideExplorationWarning("lastErrorNotifyId")},T.prototype.getVisualTypeUsageTable=function(){for(var e=this.scope.viewModel.exploration.contract.sections,t={},i=0,o=e;i<o.length;i++)for(var r=o[i],a=r.visualContainers,n=0,s=a;n<s.length;n++){var c=s[n],l=c.config.singleVisual.visualType;t[l]=!0}return t},T.prototype.pauseQueriesChanged=function(e){var t=!this.scope.viewModeState.getConfig().pauseQueryExecution;this.scope.viewModeState.updateConfig((function(e){e.pauseQueryExecution=t})),t?this.services.dataProxy.stopCommunication(i.dsrDataReaderType):this.services.dataProxy.resumeCommunication(i.dsrDataReaderType),e.stopPropagation()},T.prototype.tryAddJsonFilters=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a,n,s,c,l,d,p,u,h;return __generator(this,(function(v){switch(v.label){case 0:return i&&_.isArray(i)?(o=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(o)]):[2];case 1:return r=v.sent(),[4,e.explore.jsonFilter.createJSONFilterParser(this.services.promiseFactory,this.services.moduleLoader,this.services.telemetryService)];case 2:for(a=v.sent(),n=[],s=0,c=i;s<c.length;s++){if(l=c[s],d=a.tryCreateFilterContainer(t,r,l),!d)return[2];n.push(d)}if(n&&n.length>0)for(t.filters=t.filters||[],p=0,u=n;p<u.length;p++)h=u[p],t.filters.push(h);return[2]}}))}))},T.prototype.addODataFilterFromQuery=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a,n,s,c,l,d,p,u;return __generator(this,(function(h){switch(h.label){case 0:return i?[4,this.loadODataFilterDependencies()]:[3,2];case 1:if(h.sent(),!e.explore.odata)return[2];if(o=void 0,r=this.services.featureSwitchService.featureSwitches,a=this.services.reportService.findReport&&this.services.reportService.findReport(t.reportId).contract,(r.multipleODataPredicates||r.usageMetricsEnabled&&this.services.usageMetricsReport.reportBelongsToUsageMetricsContentPack&&this.services.usageMetricsReport.reportBelongsToUsageMetricsContentPack(a))&&(o={supportMultiplePredicates:!0}),r.numericalOdataPredicates&&(o=o||{},o.supportNumericalPredicates=!0),n=e.explore.odata.createODataFilterParser(o),s=n.tryGetFilters(i),_.isEmpty(s))return[2];for(t.filters||(t.filters=[]),c=0,l=s;c<l.length;c++)d=l[c],t.filters.push(d);p=this.services.explorationCapabilities,u=p.getCapabilities(),u.visualContainerOptions.disableQueryCacheUpdates=!0,this.services.explorationCapabilities.setCapabilities(u),h.label=2;case 2:return[2]}}))}))},T.prototype.loadODataFilterDependencies=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e=this.services.moduleLoader,[4,this.services.promiseFactory.all([e.require({javascript:"odataFilterParser"}),e.require({javascript:"odataExplore"})])];case 1:return t.sent(),[2]}}))}))},T.prototype.setSectionStatus=function(e){this.scope.viewModel.sectionStatus.currentSectionNumber=e},T.prototype.setVisualThemeColors=function(e,t){var i=this.services.themeService,o=i.getDataColors(e,t);this.services.colorPicker.setDataColors(o)},T.prototype.initializeThemes=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,y.loadThemeAndBaseTheme(this.services.promiseFactory,this.services.resourceLoader,this.services.themeService,t.resourcePackages,t.theme,t.baseTheme,this.services.featureSwitchService.featureSwitches.loadBaseTheme)];case 1:return e.sent(),[2,t]}}))}))},T.prototype.setDataSource=function(t){this.packageId=t.packageId;var o=this.scope.viewModel.exploration.contract,r=o.dataSources;if(!r.withId(t.id)){var a=e.explore.constants.DefaultSchemaName;if(r.push({type:i.dsrDataReaderType,id:t.id,name:a,dsr:{schemaName:a,vsName:t.vsName,dbName:t.dbName,modelId:t.id}}),this.services.featureSwitchService.featureSwitches.reportMeasures&&null!=o.id){var n=e.explore.constants.ExplorationSchemaName;r.push({type:e.explore.dataReaderPlugins.ExplorationDataReaderType,id:o.id,name:n,extends:a,exploration:{schemaName:n,extends:a,getModelExtensions:function(){return o.modelExtensions}}})}}this.services.dataSources.set(r)},T.prototype.showError=function(t,i,o){this.services.errorService.error(i,o,{requestId:t?t.requestId:void 0},!1,e.telemetry.ErrorSource.PowerBI)},T.prototype.clearExploration=function(){this.rejectOpenExplorationTelemetryEvent({errorSource:e.telemetry.ErrorSource.User,errorMessage:"cancelled by user",errorCode:"cancelled"}),this.originalExploration=null,this.scope.viewModel.exploration=null,this.setSectionStatus(-1),this.services.dataSources.set(null),this.legacyReportExists=!1,this.services.eventBridge.publishToChannel(c.explorationUnloaded)},T.prototype.showSaveMask=function(){this.scope.viewModel.showMask=!0},T.prototype.hideSaveMask=function(){this.scope.viewModel.showMask=!1},T.prototype.canWrite=function(e){return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&e&&e.canWrite},T.prototype.canExplore=function(e,t){return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&e&&e.contract&&(e.canExplore||this.canWrite(e))&&this.services.permissionService.isExplorableModel(t)},T.prototype.canCopy=function(e){return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&e&&e.canCopy},T.prototype.isReportFromPbix=function(e){return e&&e.contract&&e.contract.isFromPbix},T.prototype.reloadTrustedVisuals=function(t){t&&t.length>0&&(this.services.visualPlugin.ensureTrustedVisualPlugins(t),this.services.eventBridge.publishToChannel(e.explore.services.events.visualPluginsChanged),this.services.rootScope.$emit(e.constants.reloadEmptyVisuals,{visualTypes:t.map((function(e){return e.name}))}))},T.prototype.resolveOpenExplorationTelemetryEventWhenNoVisualContainers=function(){this.scope.viewModel.exploration.exploreCanvas&&!_.isEmpty(this.scope.viewModel.exploration.exploreCanvas.visualContainers)||this.resolveOpenExplorationTelemetryEvent()},T.prototype.resolveOpenExplorationTelemetryEvent=function(){if(this.openExplorationTelemetryEvent){var t=this.openExplorationTelemetryEvent.event.info,i=this.scope.viewModel.exploration.contract,o=e.explore.util.VisualContainerUtils.getVisualTypesAndCountsFromActiveSection(i);t.visualTypesAndCounts=JSON.stringify(o),this.exploration&&this.exploration.tags&&(t.tags=JSON.stringify(this.exploration.tags).substr(0,300)),
this.openExplorationTelemetryEvent.resolve(),this.openExplorationTelemetryEvent=null}},T.prototype.rejectOpenExplorationTelemetryEvent=function(e){this.openExplorationTelemetryEvent&&(this.openExplorationTelemetryEvent.reject(e),this.openExplorationTelemetryEvent=null)},T.prototype.setOpenExplorationTelemetryEvent=function(e){this.resolveOpenExplorationTelemetryEvent(),this.openExplorationTelemetryEvent=e},T.prototype.onLoadPowerViewReport=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,o,r,a,n,s,c,l,d,p=this;return __generator(this,(function(u){switch(u.label){case 0:return[4,this.services.activeGroupId.initialGroupPermissionReadyPromise];case 1:return u.sent(),this.registerDirtyStateNavigationHandler(),this.services.rootScope.$emit(h,!1),i=t.instantiationMode!==e.common.contracts.reportServer.ReportInstantiationMode.None,t.report.objectId&&(o=this.services.groupService.activeGroupObjectId,r=t.report.contract.originalReportObjectId,i=!1,a=!1,this.services.reportService.findReportByGUID&&(n=this.services.reportService.findReportByGUID(t.report.objectId),a=n&&this.services.usageMetricsReport.reportBelongsToUsageMetricsContentPack&&this.services.usageMetricsReport.reportBelongsToUsageMetricsContentPack(n.contract)),a||this.services.mostRecentlyUsedService.updateMRU(e.models.MRUArtifactType.Reports,t.report.objectId,t.report.displayName,t.report.getPermissions(),o,r,t.report.packageId)),this.clearExploration(),this.addKeyHandler(),s=t.instantiationMode!==e.common.contracts.reportServer.ReportInstantiationMode.None,this.reportId=i?void 0:t.report.id,this.packageId=t.model.packageId,this.lastLoadedReport=t.report,this.legacyReportExists=!e.helpers.ReportUtility.IsReportSavedAsExploration(t.report.contract),this.scope.viewModel.displayName=i?void 0:t.report.contract.displayName,this.scope.viewModel.canEdit=this.canExplore(t.report,t.model),this.scope.viewModel.canCopy=this.canCopy(t.report),this.scope.viewModel.canWrite=this.canWrite(t.report),t.model&&t.model.getPermissions()===v.CopyOnWrite&&(this.scope.viewModel.options.visualContainerOptions.disablePin=!0),this.services.viewModeState.setMode(s?1:0),this.scope.viewModel.taskPane.isPaneExpanded=s,this.scope.viewModel.visualizationPane.isPaneExpanded=s,this.scope.viewModel.isNavPaneCollapsed=!s,this.scope.viewModel.datasetModel=t.model,this.scope.viewModel.reportPermission=t.report.getPermissions(),this.scope.viewModel.isReportFromPbix=this.isReportFromPbix(t.report),c=this.scope.viewModel.datasetModel,l=this.services.packageService.findPackage(this.packageId),l&&(c.packagePublishStatus=l.publishOrRefreshStatus,c.contract.isPackageRefreshEnabled=l.contract.IsRefreshEnabled),d=this.scope.viewModel.options,d.visualContainerOptions.disablePin=!this.scope.viewModel.canEdit,this.services.viewModeState.updateConfig((function(e){e.supportsExportData=!d.disableExport&&p.services.featureSwitchService.featureSwitches.exportDataEnabled})),this.setOpenExplorationTelemetryEvent(t.openExplorationTelemetryEvent),[4,this.initializeExploration(t.report.id,t.reportPage,t.report.activeSlideId,i,s,t.report.model,t.exploration,t.additionalODataFilter,t.additionalJsonFilters,t.report.objectId)];case 2:return u.sent(),this.services.selection.clearSelection(),this.services.undoRedo.setHandler(e.explore.util.ExploreUndoRedoHandlerUtility.createUndoRedoHandler(this.scope.viewModel,this.services.timeout,this.services.selection,this.services.lazyScopedSync,this.services.formFactor,this.services.explorationSerializer,this.services.explorationNavigation,this.services.lazySync("linguisticSchemaProxy"),this.services.eventBridge,this.services.visualPlugin,this.services.registeredResourceReferences)),this.services.clipboard.setHandler(e.explore.util.ExploreClipboardHandlerUtility.createClipboardHandler(this.scope.viewModel,this.services.explorationSerializer,this.services.selection,this.services.visualAuthoring,this.services.visualPlugin,this.services.filterGenerator,this.services.formFactor,this.services.visualStylePresetService)),this.notifyIfModelRefreshDisabledBySelectiveRefresh(),[2]}}))}))},T.prototype.showErrorNotification=function(e,t){if(t.error.code&&t.showNotification){var i=this.scope.viewModel.datasetModel;this.showErrorNotificationWithModel(t,i),e.stopPropagation()}},T.prototype.showErrorNotificationWithModel=function(e,t,i){var o=this;e&&e.showNotification&&(t.contract.creatorUser?this.notifyError(e.error,t,i):this.services.modelHttpService.getModel(t.id,t.packageId,null).then((function(r){r.data.creatorUser&&(t.contract.creatorUser=r.data.creatorUser,o.notifyError(e.error,t,i))})))},T.prototype.notifyError=function(e,t,i){var o=this;i||(i=function(){o.refresh()}),this.requiresGatewayInfo(e.code)?this.services.gatewaysMetadataService.getModelDataSources(t.id).then((function(r){var a=o.services.selectGatewayService.getSelectedGateway(r);o.notify(e,t,a,i)}),(function(r){o.notify(e,t,null,i)})):this.notify(e,t,null,i)},T.prototype.notify=function(e,t,i,o){var r=this.getErrorNotificationParameter(e,t,i,o);if(r){var a={notificationName:"lastErrorNotifyId",notificationId:this.services.notificationBar.notify(r)};this.addNotification(a)}},T.prototype.requiresGatewayInfo=function(t){return t===e.DM_GWPipeline_Client_GatewayUnreachable},T.prototype.getErrorNotificationParameter=function(t,i,o,r){var a=this,n=t.code,s=i.contract.creatorUser,c=s.emailAddress;c.match(e.common.controllers.EmailValidator)||(c=s.AlternateEmailAddress);var l,d,p=c===e.session.UserInfoUtils.getUPN();switch(n){case e.DMTS_NoGatewayWithAllDatasourcesToBindError:var u=this.getServerName(t),h=this.getDatabaseName(t);l=this.services.localizationService.format("ExplorationContainer_Notification_DMTS_NoGatewayWithAllDatasourcesToBindError_Message",[u,h]),d={displayText:this.services.localizationService.get("ExplorationContainer_Notification_DMTS_NoGatewayWithAllDatasourcesToBindError_ActionText"),urlString:e.models.learnMoreAboutEnterpriseGatewaysHelpLink};break;case e.DMTS_MultipleGatewaysWithAllDatasourcesToBindError:l=p?this.services.localizationService.get("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_Message"):this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",[s.givenName]),d=p?{displayText:this.services.localizationService.get("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_ActionText"),action:function(){a.services.selectGatewayService.bindModelToGateway(i.id,(function(){r(),a.hideExplorationWarning("lastErrorNotifyId")}),(function(){a.services.errorService.error(a.services.localizationService.get("ExplorationContainer_FailedToBindToGatewayMessage"),"ExplorationContainer_FailedToBindToGateway")}),(function(){}))}}:{displayText:this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_ActionText",[s.givenName]),urlString:"mailto:"+c};break;case e.DMTS_DatasourceHasNoCredentialError:l=p?this.services.localizationService.get("ExplorationContainer_Notification_CredentialsRequired_Message"):this.services.localizationService.get("ExplorationContainer_Notification_CredentialsRequired_NotOwner_Message"),d=p?{displayText:this.services.localizationService.get("ExplorationContainer_Notification_CredentialsRequired_ActionText"),action:function(){a.services.navigation.showSettingsSlider("datasets",i.dbName)}}:{displayText:this.services.localizationService.get("ExplorationContainer_Notification_CredentialsRequired_NotOwner_ActionText"),urlString:"mailto:"+c};break;case e.DM_GWPipeline_Client_GatewayUnreachable:if(p){var v=this.getContactInfo(o);l=v?this.services.localizationService.format("ExplorationContainer_Notification_DM_GWPipeline_Client_GatewayUnreachable_WithContactInfo",[v]):this.services.localizationService.get("ExplorationContainer_Notification_DM_GWPipeline_Client_GatewayUnreachable")}else l=this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",[s.givenName]);d=p?{displayText:this.services.localizationService.get("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_ActionText"),action:function(){a.services.selectGatewayService.bindModelToGateway(i.id,(function(){r(),a.hideExplorationWarning("lastErrorNotifyId")}),(function(){a.services.errorService.error(a.services.localizationService.get("ExplorationContainer_FailedToBindToGatewayMessage"),"ExplorationContainer_FailedToBindToGateway")}),(function(){}))}}:{displayText:this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_ActionText",[s.givenName]),urlString:"mailto:"+c};break;case e.DM_GWPipeline_Gateway_DataSourceConnectionError:l=p?this.services.localizationService.get("ExplorationContainer_Notification_DMTS_DatasourceConnectionError_Message"):this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",[s.givenName]),d=null;break;case e.RS_CannotRetrieveModel:l=this.services.localizationService.get("DsrError_CanNotRetrieveModelMessage"),d=null;break;case e.RS_AccessDeniedDueToRLSGroup:l=this.services.localizationService.get("DsrError_NoPermissionDueToRLSGroupMessage"),d=null;break;case e.RS_AccessDenied:l=this.services.localizationService.get("DsrError_NoPermissionToViewMessage"),d=null;break;case e.DMTS_UserNotFoundInADGraphError:l=this.services.localizationService.format("ExplorationContainer_Notification_DMTS_UserNotFoundInADGraphError_Message",[s.givenName]),d=null;break;case e.DMTS_UserLostPermissionToDatasourceError:case e.DM_GWPipeline_Gateway_ImpersonationError:l=p?this.services.localizationService.get("ExplorationContainer_Notification_DMTS_UserLostPermissionToDatasourceError_Message"):this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",[s.givenName]),d=p?{displayText:this.services.localizationService.get("ExplorationContainer_Notification_DMTS_UserLostPermissionToDatasourceError_ActionText"),action:function(){a.services.selectGatewayService.bindModelToGateway(i.id,(function(){a.refresh(),a.hideExplorationWarning("lastErrorNotifyId")}),(function(){a.services.errorService.error(a.services.localizationService.get("ExplorationContainer_FailedToBindToGatewayMessage"),"ExplorationContainer_FailedToBindToGateway")}),(function(){}))}}:{displayText:this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_ActionText",[s.givenName]),urlString:"mailto:"+c};break;case e.DM_GWPipeline_Gateway_DataSourceAccessError:l=p?this.services.localizationService.get("ExplorationContainer_Notification_DMTS_DatasourceAccessError_Message"):this.services.localizationService.format("ExplorationContainer_Notification_DMTS_MultipleGatewaysWithAllDatasourcesToBindError_NotOwner_Message",[s.givenName]),d=null;break;case e.DM_GWPipeline_Gateway_InvalidMashupConnectionString:case e.DM_GWPipeline_Gateway_DatabaseLoginError:case e.DM_GWPipeline_Gateway_SqlTimeoutException:case e.DM_GWPipeline_Gateway_AdomdTimeoutException:case e.DM_GWPipeline_Gateway_InvalidObjectNameException:case e.DM_GWPipeline_Gateway_ConnectionBrokenException:case e.DM_GWPipeline_Gateway_MemoryError:case e.DM_GWPipeline_Gateway_MissingStructureError:case e.DM_GWPipeline_Gateway_UnprocessedStructureError:case e.DM_GWPipeline_Gateway_ModelLoadError:case e.DM_GWPipeline_Gateway_CancellationError:case e.DM_GWPipeline_Gateway_QueryExecutionError:case e.DM_GWPipeline_Gateway_RecalculationRequiredError:case e.DM_GWPipeline_Gateway_AdomdConnectError:case e.DM_GWPipeline_Gateway_MashupDataAccessError:default:l=this.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+n),d=null}if(l)return{message:l,notificationType:e.common.NotificationBarType.Error,secondaryLink:d}},T.prototype.getContactInfo=function(t){if(t){var i=e.gateways.models.GatewayModelConverter.getGatewayAnnotation(t);if(i){var o=i.gatewayContactInformation,r="";if(o)for(var a=0,n=0,s=o;n<s.length;n++){var c=s[n];r+=c,a<o.length-1&&(r+="; "),a++}return r}}return""},T.prototype.getServerName=function(e){if(e["pbi.error"]){var t=e["pbi.error"].details;if(t&&t.length>0)return t[0].detail.value}return""},T.prototype.getDatabaseName=function(e){if(e["pbi.error"]){var t=e["pbi.error"].details;if(t&&t.length>1)return t[1].detail.value}return""},T.prototype.onRefreshReportData=function(){var t=a.dataReaderDataSources(a.queried(this.services.dataSources.get(),null));t&&(this.services.dataProxy.clearCache(i.dsrDataReaderType,t),this.services.eventBridge.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(){return!0}}))},T.prototype.getReportContract=function(){return this.scope&&this.scope.viewModel&&this.scope.viewModel.exploration&&this.scope.viewModel.exploration.contract&&this.scope.viewModel.exploration.contract.report},T})(e.common.controllers.ExplorationContainerBaseController);t.ExplorationContainerController=T})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.explore.services.createVisualQueryGenerator,o=e.explore.viewModels,r=e.common.NotificationToastType,a=e.common.contracts.Permissions,n=e.visualHost.ResourcePackageReferenceResolver,s=e.explore.ScopeUtils,c=e.dataServices.contracts.TileType,l=(function(){function t(t,r){var a=this;this.scope=t,this.services=r;var n=this.initializeSection("InFocusSection","InFocusSection");t.viewModel=e.models.inFocusViewModelFactory.createInFocus(n,r.filterGenerator,this.services.formFactor.getCurrentLayout()),t.hide=function(){return a.exitAndHide()},t.updateTile=function(e){return a.updateTile(e)},t.openReport=function(){return a.openReport()},s.defineDataSourcesOnScopeLegacy(this.scope,this.services.dataSources),this.setDataSources();var c=this.services.featureSwitchService;t.pinVisual=function(){return a.pinVisual()},t.getRelatedInsights=function(){return a.getRelatedInsights(e.telemetry.InsightEntryPoint.InFocusMode)},t.logInsightFeedback=function(e){return a.logInsightFeedback(e)},t.qrCode=function(){return a.qrCode()},t.viewModeState=this.services.viewModeState,t.showRefreshErrorDetails=function(){return a.showRefreshErrorDetails()},t.inFocusMenuItems=e.models.inFocusViewModelFactory.createInFocusMenuItems(this.services.localizationService,this.scope.canExport),t.inFocusMenuItemSelected=function(e){return a.onInFocusMenuItemSelected(e)},t.showPreviousVisual=function(){return a.showPreviousVisual()};var l=o.createFieldListViewModelFactory(o.createFieldListMenuItemFactory(this.services.localizationService,c),o.createFieldListPropertyTemplateGenerator(),this.services.localizationService,c);this.scope.fieldListConfig={viewModelFactory:l,alwaysHasActiveItem:!0},this.sortService=e.explore.services.createSortService(this.services.displayNameService,c,this.services.visualPlugin),this.dataProxy=this.services.singleExecutableDataProxyFactory.create(),this.visualQueryGenerator=i({dataReaders:this.services.dataReaderProvider,displayNameService:this.services.displayNameService,plugin:this.services.visualPlugin,pluginOps:this.services.visualPluginOps,sortService:this.sortService,featureSwitchService:c,aggrOps:this.services.aggrOps,filterGenerator:this.services.filterGenerator,transformPluginService:e.data.transforms.createTransformPluginService(),telemetryService:this.services.telemetryService}),this.services.undoRedo.setHandler({rollback:function(){},takeSnapshot:function(){return null}});var d=this.scope.$on(e.common.constants.navigation.stateChangeSuccess,(function(e,t,i,o,r){return a.handleStateChangeSuccess(e,t,i,o,r)})),p=this.services.rootScope.$on(e.constants.openInFocusTileActionName,(function(e,t){return a.onOpenTile(e,t)})),u=this.services.rootScope.$on(e.constants.openInFocusWorkbookTileActionName,(function(e,t){return a.onOpenWorkbookTile(e,t)})),h=this.services.rootScope.$on(e.constants.openInFocusRealTimeTileActionName,(function(e,t){return a.onOpenRealTimeTile(e,t)})),v=this.scope.$on(e.insights.constants.insightSelectedEvent,(function(e,t){return a.onInsightSelected(e,t)})),g=this.scope.$on(e.insights.constants.insightClosePaneEvent,(function(e){return a.onInsightClosePane()})),m=this.scope.$on(e.insights.constants.insightsOnSelectionEvent,(function(t){return a.getRelatedInsights(e.telemetry.InsightEntryPoint.InFocusMode)}));this.scope.$on("$destroy",(function(){d(),p(),u(),v(),g(),m(),h()})),t.viewModeState.setMode(0),this.visualAuthoringCore=e.explore.services.createVisualAuthoringCore(this.services.visualPlugin,this.services.geoTaggingAnalyzerService,this.services.aggrOps,c),this.services.pinVisual.setHandler({pinVisual:function(e){a.pinVisualHandler(e)}})}return t.createOptions=function(){return{scopedServiceRoot:!0,scopedDependencies:["dataSources","eventBridge","filterGenerator","viewModeState","undoRedo","selection","pinVisual","visualPlugin","visualPluginOps","explorationNavigation","explorationCapabilities","exportData","hostFiltersService","formFactor"],additionalServices:["aggrOps","conceptualSchemaProxy","inFocusService","dashboardHttpService","dashboardDataService","singleExecutableDataProxyFactory","dataReaderProvider","modelMerger","displayNameService","dashboardService","featureSwitchService","geoTaggingAnalyzerService","localizationService","modelService","packageService","notificationToast","reportService","explorationProxy","explorationSerializer","modelConverter","telemetryService","errorService","qrCodeService","groupService","insightsService","navigation","$timeout","resourcePackagesService","navigationHelper","licenseEnforcementService"]}},t.prototype.toggleViewMode=function(t){var i=this.scope.viewModel;this.scope.$emit(e.constants.inFocusExitEvent),i.taskPane.isPaneExpanded=!1,i.visualizationPane.isPaneExpanded=!1,this.services.viewModeState.setMode(0)},t.prototype.onInsightClosePane=function(){this.scope.viewModel.showInsightsPane=!1},t.prototype.onInsightSelected=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var t;return __generator(this,(function(o){return i.rerunInsights||(this.scope.viewModel.showPreviousVisualButton=!0),t={entryPoint:i.rerunInsights?e.telemetry.InsightEntryPoint.InsightsPaneTile:e.telemetry.InsightEntryPoint.InFocusMode,insightContainerModel:i.insightContainerModel,showInsightsEvent:i.showInsightsEvent,canPin:this.scope.viewModel.openInsightArgs?this.scope.viewModel.openInsightArgs.canPin:this.scope.canEdit},this.services.rootScope.$emit(e.insights.constants.viewInsightInFocus,i.pinData,t,i.rerunInsights),[2]}))}))},t.prototype.showPreviousVisual=function(){this.services.inFocusService.inFocusTile=this.originalTile,this.generateVisual(this.originalViewTileArgs),this.scope.viewModel.showPreviousVisualButton=!1,this.scope.$broadcast(e.insights.constants.clearInsightSelectionEvent)},t.prototype.onOpenTile=function(t,i){var o=this;t.stopPropagation(),this.currentViewTileArgs=i,i.openInsightArgs&&i.openInsightArgs.entryPoint===e.telemetry.InsightEntryPoint.InFocusMode?this.scope.$applyAsync((function(){o.scope.showInFocusMode=!0,o.generateVisual(i)})):this.scope.performTransitionAnimation(this.services.inFocusService.inFocusTile.id).then((function(){o.scope.$applyAsync((function(){o.scope.showInFocusMode=!0,o.generateVisual(i)}))}))},t.prototype.onOpenWorkbookTile=function(t,i){t.stopPropagation(),this.scope.relatedInsightsEnabled=!1;var o=i.workbook,r=this.services.inFocusService.inFocusTile;this.services.telemetryService.logEvent(e.telemetry.DashboardInFocusWorkbook,r.contract.id,o.contract.workbookId,o.contract.packageId),this.setExportableState(r),this.scope.showInFocusMode=!0,this.scope.viewModel.inFocusTile=r,this.scope.viewModel.workbook=o,this.scope.viewModel.displayText=o.displayText,this.scope.viewModel.subDisplayText=o.subDisplayText;var a=this.services.dashboardDataService.activeDashboard;this.scope.viewModel.dashboardText=this.services.localizationService.format("InFocus_ToDashboard",[a.displayName])},t.prototype.onOpenRealTimeTile=function(t,i){var o=this;t.stopPropagation(),this.scope.relatedInsightsEnabled=!1;var r=this.services.modelConverter.convertTile(i.contract);this.scope.viewModel.realTime=r.realTime,this.setExportableState(r),this.scope.viewModel.inFocusTile=r,this.scope.viewModel.displayText=r.displayText,this.scope.viewModel.subDisplayText=r.subDisplayText;var a=this.services.dashboardDataService.activeDashboard;this.scope.viewModel.dashboardText=this.services.localizationService.format("InFocus_ToDashboard",[a.displayName]),this.scope.performTransitionAnimation(this.services.inFocusService.inFocusTile.id).then((function(){o.scope.showInFocusMode=!0,o.scope.$applyAsync((function(){o.scope.$emit(e.constants.inFocusEnterEvent),o.scope.clearTransitionAnimation()}))}))},t.prototype.generateVisual=function(t){var i=this,o=this.scope.viewModel;o.inFocusTile=this.services.inFocusService.inFocusTile,this.setDataSources(o.inFocusTile),this.updateTile(o.inFocusTile,t.openInsightArgs),this.tileContractOriginal=o.inFocusTile.contract;var r=this.services.telemetryService.startEvent(e.telemetry.DashboardInFocusModeSelected,c[this.services.inFocusService.inFocusTile.composite.visual.type]);this.scope.openInFocusEvent||(this.scope.openInFocusEvent=r.event),this.scope.clearTransitionAnimation().then((function(){i.services.visualPlugin.loadPluginByNameIfAny(i.services.inFocusService.inFocusTile.composite.visual.type),i.setVisualContainerProperties(t,r)}))},t.prototype.setVisualContainerProperties=function(t,i){var o=this,r=this.scope,a=r.viewModel,n=a.inFocusTile.config.visualContainer,s=this.services.explorationSerializer.deserializeVisualContainer(this.services.explorationSerializer.serializeVisualContainer(n.$visualContainer)),c=a.canvas,l=c.exploration,d=l.contract,p=l.exploreCanvas,u=this.initializeSection("fakeSection","fakeSection");this.services.explorationNavigation.loadExploration(d),p.contract=u,p.preventSelectionClearing=!0,d.theme=n.themeName,d.baseTheme=n.baseThemeName,s.layouts=jsCommon.ArrayExtensions.extendWithId([{id:0,position:{x:0,y:0,width:u.size.width,height:u.size.height}}]);var h=e.explore.viewModels.ViewModelFactory.convertVisualContainer(d,l.sections[0].contract,s,0);if(!this.validateDrillableVisual(h)){var v={errorCode:"drillable visual in inFocus mode isn't correctly generated"};i.reject(v),i=null,r.inFocusDrillableError=!0,this.setErrorMessage()}h.disableResize=!0;var g=this.tileContractOriginal.tileDataSet;e.data.dsr.containsRestartToken(g)||(h.dataViewSource=g),h.contract.config.singleVisual.title={show:!1};var m=this.services.modelConverter.convertModel(a);e.explore.services.selectionUtils.selectVisualContainer(h.contract,this.services.selection),c.visual.visualContainer=h,c.visual.model=m,p.visualContainers[0]=h,p.visualContainers[0].options=this.services.explorationCapabilities.getCapabilities().visualContainerOptions;var f={showAppBar:!0,showTaskPane:!0,showVisualizationPane:!0,showNavContentPane:!0,visualContainerOptions:{showMenu:!1,showPin:!1,showContextMenu:!1,disablePin:!0,hideHeader:!0},showBackButtonOnAppBar:!1};this.services.explorationCapabilities.setCapabilities(f),a.showVisualEnabled=!0,r.$emit(e.constants.inFocusEnterEvent),t.runScopedInsights&&(this.services.$timeout((function(){var i=e.telemetry.InsightEntryPoint.DashboardTile;t.openInsightArgs&&t.openInsightArgs.entryPoint&&(i=t.openInsightArgs.entryPoint),o.getRelatedInsights(i)})),t.runScopedInsights=!1),null!=i&&i.resolve()},t.prototype.setErrorMessage=function(){var e=this.services.localizationService;this.scope.errorMessageConfig={canEdit:this.scope.canEdit,mode:!0,titleShared:e.get("InFocusEMHeader"),titleNonShared:e.get("InFocusEMHeader"),contentShared:e.get("InFocusEMContentShared"),contentNonShared:e.get("InFocusEMContentNonShared"),contact:e.get("InFocusEMContentSharedContact")}},t.prototype.validateDrillableVisual=function(t){var i=this.services.visualPlugin.capabilities(t.contract.config.singleVisual.visualType),o=e.explore.util.DrillUtils.getDrillableRoles(i);if(o.length>0)for(var r=t.contract.config.singleVisual.query.projections,a=0,n=o;a<n.length;a++){var s=n[a],c=r[s];if(!_.isEmpty(c)&&c.all().length>1&&_.isEmpty(c.activeProjectionRefs))return!1}return!0},t.prototype.setDataSources=function(t){var i=[];if(t){var o=e.explore.constants.DefaultSchemaName,r={type:e.common.constants.dsrDataReaderType,id:t.contract.modelId,name:e.explore.constants.DefaultSchemaName,dsr:{schemaName:e.explore.constants.DefaultSchemaName,vsName:t.vsName,dbName:t.dbName,modelId:t.contract.modelId}};if(i.push(r),this.services.featureSwitchService.featureSwitches.reportMeasures){var a=t.contract.$config.visualContainer.$modelExtensions,n=e.explore.constants.ExplorationSchemaName;i.push({type:e.explore.dataReaderPlugins.ExplorationDataReaderType,id:t.contract.id,name:n,extends:o,exploration:{schemaName:n,extends:o,getModelExtensions:function(){return a}}})}}var s=e.explore.contracts.createDataSourceArray(i);this.services.dataSources.set(s)},t.prototype.initializeSection=function(e,i){var o={name:e,displayName:i,size:t.getDefaultSize(),visualContainers:[],filters:[]};return this.services.explorationNavigation.goto(o,!1),o},t.getDefaultSize=function(){return{displayOption:0,width:e.explore.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:e.explore.constants.ExploreCanvasConstants.DefaultCanvasHeight}},t.prototype.exitAndHide=function(){var e=this.services,t=e.dashboardDataService.activeDashboard;t&&!e.navigation.inInsightsView()&&e.navigationHelper.navigateToDashboard(t),this.hide()},t.prototype.hide=function(){this.scope.showInFocusMode=!1,this.scope.viewModel.showInsightsPane=!1,this.scope.viewModel.showPreviousVisualButton=!1,this.scope.viewModel.inFocusTile=null,this.scope.viewModel.canvas.visual.visualContainer=null,this.scope.viewModel.canvas.exploration&&(this.scope.viewModel.canvas.exploration.exploreCanvas.visualContainers=jsCommon.ArrayExtensions.createWithId()),this.toggleViewMode(!0),this.scope.inFocusDrillableError=!1,this.services.inFocusService.exit()},t.prototype.updateTile=function(t,i){this.services.filterGenerator.clearCrossHighlight(this.scope.viewModel.canvas.exploration.contract.sections[0]);var o=this.scope.viewModel;if(o.inFocusTile=t,o.openInsightArgs=i,o.inFocusTile){o.displayText=t.getDisplayText(),o.subDisplayText=t.getSubDisplayText();var r=o.inFocusTile;o.source=null!=r.report?this.services.localizationService.format("InFocus_SourceReport",[r.report.displayName]):this.services.localizationService.format("InFocus_SourceQna",[r.utterance]);var n=this.services.dashboardDataService.activeDashboard;this.setExportableState(r),i?i.entryPoint!==e.telemetry.InsightEntryPoint.InFocusMode&&(this.scope.viewModel.dashboardText=this.services.localizationService.format("InFocus_ToDashboard",[r.contractsModel.displayName])):this.scope.viewModel.dashboardText=null!=n?this.services.localizationService.format("InFocus_ToDashboard",[n.displayName]):this.services.localizationService.get("InFocus_DefaultDashboard"),o.pinVisualText=this.services.localizationService.get("PinVisual_ToolTip"),o.getRelatedInsightsText=this.services.localizationService.get("Insights_GetRelatedInsights");var s=r.contract;r.setDatasetModelAndPackageInfo(this.services.modelService.findModel(s.modelId,s.packageId),this.services.packageService.findPackage(s.packageId)),this.scope.relatedInsightsEnabled=r.datasetModel.contract.insightsSupported&&!r.datasetModel.isHidden&&(r.datasetModel.getPermissions()&a.Read)===a.Read&&!r.workbook,this.scope.relatedInsightsEnabled}},t.prototype.handleStateChangeSuccess=function(e,t,i,o,r){var a=this.services.navigation.inInFocusView(),n=this.services.navigation.inInFocusInsightsView(),s=!a&&!n;s&&this.hide()},t.prototype.openReport=function(){this.services.rootScope.$emit(e.constants.openTileEventName,this.services.inFocusService.inFocusTile)},t.prototype.getRelatedInsights=function(t){this.originalTile=this.scope.viewModel.inFocusTile,this.originalViewTileArgs=this.currentViewTileArgs,this.scope.viewModel.showPreviousVisualButton=!1,this.services.insightsService.setScopedInsightsSource(t),this.scope.viewModel.showInsightsPane?this.scope.$broadcast(e.insights.constants.getRelatedInsightsEvent):this.scope.viewModel.showInsightsPane=!0},t.prototype.logInsightFeedback=function(t){var i=this.scope.viewModel.openInsightArgs.showInsightsEvent,o=this.scope.viewModel.canvas.visual.visualContainer.contract;if(i&&o){var a=e.insights.utils.InsightsUtils,n=a.convertFilters(o&&o.filters),s=a.getFiltersFromHighlights(o.config.singleVisual.objects),c=a.getNumberOfColumns(o);this.services.telemetryService.logChildEvent(i,e.telemetry.InsightsFeedback,t?e.telemetry.InsightFeedback.Yes:e.telemetry.InsightFeedback.No,n.length,s.length,c,this.scope.viewModel.openInsightArgs.insightContainerModel.source),this.services.notificationToast.notify({notificationType:r.Success,title:this.services.localizationService.get("Insights_FeedbackToastTitle"),message:this.services.localizationService.get("Insights_FeedbackToastMessage")})}},t.prototype.pinVisual=function(){var t=this,i=this.scope.viewModel,o=this.services.dataSources.get(),r=i.canvas.visual.visualContainer,a=r.contract.config.singleVisual.visualType;if(this.services.conceptualSchemaProxy.get(o).then((function(e){var i=r.hostServices.getFilters(t.services.filterGenerator,e);t.services.pinVisual.pinVisualContainer(o,r.contract,i,r.baseThemeName,r.themeName,n.getRegisteredResourcePackage(t.services.resourcePackagesService.getAllPackages()))})),i.openInsightArgs){var s=i.openInsightArgs.insightContainerModel,c=e.insights.utils.InsightsUtils.convertInsightTypeToString(s.contract.insight.Type);this.services.telemetryService.logChildEvent(i.openInsightArgs.showInsightsEvent,e.telemetry.InsightsPinInsight,s.contract.id,a,c,e.telemetry.PinInsightEntryPoint.InFocusMode,i.openInsightArgs.insightContainerModel.source,i.openInsightArgs.entryPoint===e.telemetry.InsightEntryPoint.InFocusMode?s.contract.relevance.Score:null)}},t.prototype.pinVisualHandler=function(t){if(t){var i=this.scope.viewModel,o=i.inFocusTile.contract;t.reportId=o.reportId,this.scope.dataSources.length>0&&(t.modelId=this.scope.dataSources[0].id,t.packageId=o.packageId);var r=this.scope.viewModel.inFocusTile;t.action=r.action,r.utterance&&(t.utterance=r.utterance),this.services.rootScope.$emit(e.explore.constants.pinVisualContainerEventName,t)}},t.prototype.showRefreshErrorDetails=function(){var e=this;this.services.localizationService.ensureLocalization((function(){e.services.errorService.error(e.services.localizationService.get("TileEditor_InFocusDatasetRefreshErrorMessage"),"InFocus_DatasetRefreshError",{title:e.services.localizationService.get("TileEditor_InFocusDatasetRefreshErrorTitle")})}))},t.prototype.onInFocusMenuItemSelected=function(e){switch(e.action){case 0:this.qrCode();break;case 1:this.exportData()}},t.prototype.qrCode=function(){this.services.qrCodeService.showDialogForTile(this.scope.$parent,this.services.inFocusService.inFocusTile,this.services.dashboardDataService.activeDashboard.contract,this.services.groupService.activeGroupObjectId,this.services.navigation.currentAppGUID)},t.prototype.exportData=function(){var e=this.scope.viewModel,t=this.services,i=t.licenseEnforcementService;i.supportsExportData&&!i.supportsExportData(!0)||t.exportData.exportTileDataToCsv(e.inFocusTile)},t.prototype.setExportableState=function(t){var i=!1,o=this.services.exportData;o&&(i=o.canExportTileData(t)),this.scope.canExport=i,this.scope.inFocusMenuItems=e.models.inFocusViewModelFactory.createInFocusMenuItems(this.services.localizationService,i)},t})();t.InFocusController=l})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;
!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){var o=this;this.scope=t,this.services=i;var r=t.$watch((function(){return o.services.modelService.models.length}),(function(){o.services.modelService.models.length>0&&(r(),o.updateViewModel())})),a=this.scope.$on(e.common.constants.navigation.stateChangeSuccess,(function(e){e.stopPropagation(),o.updateViewModel()}));this.scope.$on("$destroy",(function(){a()}))}return t.createOptions=function(){return{additionalServices:["modelService","navigation","telemetryService"]}},t.prototype.updateViewModel=function(){var t=e.telemetry.InsightEntryPoint.DirectNavigation;if(this.services.navigation.insightsSource){switch(this.services.navigation.insightsSource){case e.insights.constants.insightsSourceDesktop:t=e.telemetry.InsightEntryPoint.Desktop;break;case e.insights.constants.insightsSourceNavigationPane:t=e.telemetry.InsightEntryPoint.NavigationPane;break;case e.insights.constants.insightsSourceToast:t=e.telemetry.InsightEntryPoint.Notification}this.services.navigation.resetInsightsSource()}var i=this.services.modelService.findModelByDBName(this.services.navigation.insightsDataGUID).contract,o=e.insights.models.ViewModelFactory.createInsightCanvasModel({model:i});o.entryPoint=t,this.scope.viewModel=new e.models.insights.InsightsModel,this.scope.viewModel.insightsCanvasModel=o},t})();t.InsightsController=i})(i=t.insights||(t.insights={}))})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.AppUtils,o=e.common.models.CollapsiblePaneExpandedWidth,r=e.common.constants,a=e.dataServices.constants,n=e.common.contracts.Permissions,s=e.explore.contracts.PinData,c=e.telemetry.PinTileSource,l=e.common.constants.TaskPaneSlider,d=e.common.constants.tileActions,p=e.dataServices.models.TileFactory,u=(function(){function t(e,t){var i=this;this.scope=e,this.services=t,t.dashboardStateChangeService&&t.dashboardStateChangeService.bootstrap(),t.asyncFeatureSwitchService.getFeatureSwitches().then((function(){i.initialize(),i.scope.isInitialized=!0}))}return t.createOptions=function(){return{additionalServices:["$timeout","appService","appMetadataService","asyncFeatureSwitchService","bootstrapService","contentPackService","contentProviderHttpService","dashboardDataService","dashboardService","dashboardStateChangeService","errorService","explorationLoader","favorites","fullScreen","groupService","home","impersonationService","inFocusService","licenseEnforcementService","localizationService","modelConverter","modelService","mostRecentlyUsedService","navigation","pageTitle","permissionService","pinTileService","reportService","rtl","syncService","telemetryService","userNotificationInfo","visualPlugin","workbookService","conceptualModelSetting","appService","packageService","taskPaneSliderService","usageMetricsReport","navigationHelper","tutorialDataStore","tutorialPopup"]}},t.prototype.initialize=function(){var t=this,i=this.services,n=i.navigation,s=this.scope;s.inAppsView=function(){return t.services.conceptualModelSetting.isAppsEnabled()&&t.services.navigation.inAppsDetailView()},s.inAppDetailView=function(){return t.services.conceptualModelSetting.isAppsEnabled()&&t.services.navigation.inAppDetailView()},s.isScrollable=function(){return n.inAppDetailView()},s.inFavoritesView=function(){return n.inFavoritesView()},s.inContentListView=function(){return n.inContentListView()},s.inDashboardView=function(){return n.inDashboardView()},s.inDashboardAuthoringView=function(){return i.navigation.inDashboardAuthoringView()},s.inGroupWelcomeView=function(){return n.inGroupWelcomeView()},s.inReportView=function(){return n.inReportView()||n.inDatasetView()},s.inWorkbookView=function(){return n.inWorkbookView()},s.inDashboardSliderView=function(){return n.inFullPageSliderView()},s.inQnaModelView=function(){return n.inQnaModelView()},s.inQnaView=function(){return n.inQnaView()},s.inWorkspacesView=function(){return n.inWorkspacesView()},s.dashboardDataService=i.dashboardDataService,s.navigation=n,s.groupService=i.groupService,s.fullScreen=i.fullScreen,s.impersonation=i.impersonationService,s.permissionService=i.permissionService,s.showLoadingForDashboard=function(){return t.showLoadingForDashboard()},s.quitImpersonation=function(){return t.quitImpersonation()},s.exitFullScreen=function(){return i.fullScreen.exitFullScreen()},s.showLoadingSpinner=function(){return i.groupService.isGroupTransitionDelayed&&!n.inAppsDetailView()&&!n.inAppDetailView()||s.isDashboardLandingContainerActive&&t.showLoadingForDashboard()};var c=i.telemetryService.startActivity(this.scope,e.telemetry.AppInitialAppLoad,i.navigation.stateService.current.name,void 0);c.event.id=window.initialAppLoadActivityId||c.event.id,initializeContainerStartTime&&initializeContainerStartTime.getTime&&c&&c.event&&c.event.time&&(c.event.time=initializeContainerStartTime.getTime()),this.initializeContainer(c),s.$watch("inDashboardView() || inDashboardSliderView()",(function(e){return t.scope.isDashboardLandingContainerActive=!!e}));var d=i.rootScope;d.$on(e.constants.updateFavorites,(function(){i.favorites.reloadFavorites(!0)})),s.$watch("inContentListView()",(function(e){return s.isContentListActive=!!e,t.scope.isContentListActive})),s.newQnaEnabled=!i.rtl.isRtlLayout,this.usageMetricsEnabled=i.asyncFeatureSwitchService.featureSwitches.usageMetricsEnabled,d.$on(e.constants.personalizeEventName,(function(e,i){t.onPersonalizePackage(e,i)})),s.$on(r.onReportPersonalizedEventName,(function(e,i){t.onPersonalizeReport(e,i)})),d.$on(r.openUsageMetricsReport,(function(e,i,o){t.openUsageMetricsReport(i,o)})),d.$on(r.pinReportPageToDashboard,(function(e,i){t.pinReportPage(i)})),s.$on(a.workbook.bindToExcelWorkbookEventName,(function(e,i){return t.onBindToExcelWorkbook(e,i)}));var p,u=s.$on(r.navigation.stateChangeSuccess,(function(e,i,o,r,a){return t.handleStateChange(i,o,r,a)}));e.explore&&(p=d.$on(e.explore.constants.pinVisualContainerEventName,(function(e,i){return t.pinVisual(i)})));var h,v;e.insights&&(v=d.$on(e.insights.constants.pinInsightContainer,(function(e,i){return t.pinVisual(i)})),h=d.$on(e.insights.constants.viewInsightInFocus,(function(e,i,o,r){return t.showVisualInFocus(i,o,r)})));var g=d.$on(r.currentActiveReportInfoChangedEventName,(function(e,i){return t.updateCurrentReportInfo(e,i)})),m=d.$on(e.constants.showTileEditorEventName,(function(e,t){e&&e.stopPropagation(),i.dashboardService.selectDashboardTile(t),i.taskPaneSliderService.expandPane(1,o.Large)})),f=d.$on(e.constants.hideTileEditorEventName,(function(e){e&&e.stopPropagation(),i.dashboardService.clearSelectedDashboardTile(),i.taskPaneSliderService.collapsePane()})),b=s.$on(e.gateways.constants.showGatewayUserMappingPaneEventName,(function(){i.taskPaneSliderService.expandPane(8,o.Large)})),y=s.$on(e.gateways.constants.hideGatewayUserMappingPaneEventName,(function(){i.taskPaneSliderService.collapsePane()})),S=s.$on(l.ShowShareDashboardPaneEventName,(function(e){e&&e.stopPropagation();var i=t.services;i.licenseEnforcementService.supportsSharing(!0)&&i.taskPaneSliderService.expandPane(6,o.Large)}));i.appMetadataService.getAppMetadata().then((function(e){e&&e.userMetadata&&i.syncService.monitorUserChanges(e.userMetadata.version,e.userMetadata.tenantMetadata?e.userMetadata.tenantMetadata.version:null,e.userMetadata.groups?e.userMetadata.groups:[])})),s.$on("$destroy",(function(){p&&p(),h&&h(),v&&v(),g&&g(),u&&u(),m(),f(),b(),y(),S()})),this.isNavigationPaneExpanded=!0,i.bootstrapService&&i.bootstrapService.bootstrap()},t.prototype.toggleNavigationPane=function(e){this.isNavigationPaneExpanded=e},t.prototype.findModel=function(e,t,i){void 0===i&&(i=!0);var o=this.services.modelService.findModel(e,t,i);return o&&o.contract||_.find(this.dashboardContainerModel.contract.models,(function(i){return i.id===e&&i.packageId===t}))},Object.defineProperty(t.prototype,"contentProviders",{get:function(){return this.services.contentProviderHttpService.getBuiltInContentProviders()},enumerable:!0,configurable:!0}),t.prototype.handleStateChange=function(t,i,o,r){var a=this;this.openExplorationEvent&&(this.openExplorationEvent.event&&this.openExplorationEvent.event.info&&(this.openExplorationEvent.event.info.isCancelled=!0,this.openExplorationEvent.event.info.errorCode="NavigateAway"),this.openExplorationEvent.resolve(),this.openExplorationEvent=void 0),this.services.taskPaneSliderService.collapsePane();var n=this.services.navigation;if(t.name===e.constants.navigation.states.home){var s=this.services.home;if(s.isHomeDashboardSet&&(!r.groupGUID||r.groupGUID===s.homeDashboard.groupId))return void n.insertGroupAndNavigateToDashboardByGUID(s.homeDashboard.dashboardObjectId,s.homeDashboard.groupId,1)}else if(t.name===e.constants.navigation.states.group)return void n.navigateToContentListOrActiveDashboard();if(n.inReportView())this.services.groupService.groupSwitchPromise().then((function(){a.services.navigationHelper.ensureReportGUID();var t=a.services.reportService.findReportByGUID(n.currentReportGUID);if(!t)return a.services.mostRecentlyUsedService.removeMRU(n.currentReportGUID),e.helpers.ArtifactNotFoundHelper.showArtifactDoesNotExistDialog("ArtifactKind_Report",a.services.errorService,a.services.localizationService,a.services.telemetryService),void n.navigateToContentListOrActiveDashboard();t.isNew=!1;var i=a.services.modelConverter.convertReport(t.contract);a.services.modelConverter.fillReport(i,t.contract),i.model=a.findModel(t.modelId,t.packageId),a.onBindToPowerViewReport(null,i,n.instantiationMode,null,n.currentReportPage)}));else if(n.inDatasetView()&&!n.inQnaModelView()){if(n.currentDatasetDBName){var c=this.services.modelService.findFirstExplorableModelByDBName(n.currentDatasetDBName);if(!c)return e.helpers.ArtifactNotFoundHelper.showArtifactDoesNotExistDialog("ArtifactKind_Dataset",this.services.errorService,this.services.localizationService,this.services.telemetryService),void n.navigateToContentListOrActiveDashboard();if(this.services.usageMetricsReport.modelBelongsToUsageMetricsContentPack(c)){if(!_.isNumber(n.currentDatasetId))return n.resetCurrentDatasetId(),void n.navigateToContentListOrActiveDashboard();c=this.services.modelService.findModel(n.currentDatasetId)}else n.resetCurrentDatasetId();var l=this.services.modelConverter.convertReport(c.contract);this.services.modelConverter.fillReport(l,c.contract),l.model=c.contract,this.onBindToPowerViewReport(null,l,n.instantiationMode)}}else if(n.inDashboardView()){var d=this.services.dashboardDataService;this.services.navigationHelper.ensureDashboardGUID();var p=d.findDashboardByGUID(n.currentDashboardGUID);!p||d.activeDashboard&&d.activeDashboard.objectId===p.objectId||(d.activeDashboard=p),n.inQnaView()&&(this.scope.viewModel.qnaContainer.models=d.activeDashboardModels,this.scope.viewModel.qnaContainer.title=d.activeDashboard.displayName)}else n.inDatasetView()&&n.inQnaModelView()&&this.services.modelService.modelsPromise.then((function(e){var t=n.currentDatasetDBName,i=_(e).filter((function(e){return e.dbName===t})).map((function(e){return e.contract})).value();a.scope.viewModel.qnaContainer.models=i,a.scope.viewModel.qnaContainer.title=i[0].displayName}))},t.prototype.showVisualInFocus=function(e,t,i){if(e){var o=e.modelId,r=e.packageId,a=o?this.findModel(o,r):void 0,n=p.createTileForPinData(this.services.visualPlugin,e,a),s=this.services.modelConverter.convertTile(n,this.services.modelService.getModelContracts());this.services.inFocusService.view(s,t,i)}},t.prototype.isPinningSupported=function(e,t,i){var o,r=this.services.permissionService,a=r&&r.getModelEffectivePermissions(t);if(e&&e.getPermissions()===n.CopyOnWrite?o=e.packageId:t&&a===n.CopyOnWrite&&(o=t.packageId),null!=o)return this.onPersonalize(o),!1;var s=i&&i.action,c=s===d.openQnAActionName||s===d.openInsightsActionName;return!(this.services.permissionService.isActiveWorkspaceIsReadOnly||e&&(e.getPermissions()&n.Write)!==n.Write||c&&t&&!r.isExplorableModelContract(t))||(this.services.pinTileService.showNotSupportedDialog(),!1)},t.prototype.pinVisual=function(t){if(t){var i,o=this.services.telemetryService,r=t.modelId,a=t.packageId,n=r?this.findModel(r,a):void 0,c=n?n.contentProviderId:void 0,l=e.common.findContentProviderName(this.contentProviders,c),d=!!(t.resourcePackageIds&&t.resourcePackageIds.length>0),p=o.startEvent(e.telemetry.DashboardPinTile,s.getVisualType(t),this.getSource(t),"",!1,l,d,"",!1);t.reportId&&(i=this.services.reportService.findReport(t.reportId),i||this.services.reportService.addReport(this.services.modelConverter.convertReport({id:t.reportId,permissions:e.common.contracts.Permissions.All|e.common.contracts.Permissions.Explore}))),this.isPinningSupported(i,n,t.action)&&this.services.pinTileService.showPinVisualDialog(t,i,n,void 0,p)}},t.prototype.pinReportPage=function(e){var t=this.services.reportService.findReport(e.reportId),i=this.findModel(e.modelId,e.packageId);this.usageMetricsEnabled&&this.belongsToUsageMetricsContentPack(t)&&(e.additionalODataFilter=this.services.navigation.additionalODataFilter),this.isPinningSupported(t,i,e.action)&&this.services.pinTileService.showPinReportPageDialog(e)},t.prototype.getSource=function(e){switch(e.action.action){case d.openQnAActionName:return c.QnA;case d.openInsightsActionName:return c.Insights;default:return c.Exploration}},t.prototype.updateCurrentReportInfo=function(e,t){null!=e&&e.stopPropagation(),this.services.reportService.currentActiveReport=t},t.prototype.onPersonalizePackage=function(e,t){null!=e&&e.stopPropagation(),this.onPersonalize(t)},t.prototype.onPersonalizeReport=function(e,t){null!=e&&e.stopPropagation();var i=this.services.reportService.findReport(t);null!=i&&this.onPersonalize(i.packageId)},t.prototype.onPersonalize=function(e){this.services.contentPackService.onPersonalizeContentPack(e)},t.prototype.onBindToPowerViewReport=function(t,o,r,a,n){var s=this;null!=t&&t.stopPropagation(),this.updateCurrentReportInfo(null,{id:o.id,displayName:o.displayName});var c,l=this.services.dashboardDataService.activeDashboard;l&&(c=l.id);var d=this.services.modelConverter,p=d.convertReport(o.contract);d.fillReport(p,o.contract),p.packageId=o.contract.packageId,p.reportActiveSlideId=o.reportActiveSlideId,p.isNew=o.isNew,p.model=o.model,p.modelId=o.modelId;var u,h=p.contract&&i.getResourceAppGUID(p.contract,this.services.appService,this.services.packageService),v=this.belongsToUsageMetricsContentPack(o),g=this.services.permissionService.isActiveWorkspaceIsReadOnly,m=p.getPermissions(),f=this.services.asyncFeatureSwitchService.featureSwitches;f&&f.trackUserInfo&&!f.usageMetricsTrackUserLevelInfoEnabled&&(u=!0),this.openExplorationEvent=this.services.telemetryService.startActivity(this.scope,e.telemetry.EXOpenExploration,p.objectId,p.contract&&p.contract.originalReportObjectId,h,p.model&&p.model.directQueryMode===!0,!1,p.model&&!_.isEmpty(p.model.onPremModelConnectionString),this.getReportOpenSource(),v,this.services.groupService.activeGroupObjectId,null,void 0,g,m,u);var b={report:p,dashboardId:c,instantiationMode:r,tileId:a,reportPage:n,openExplorationTelemetryEvent:this.openExplorationEvent},y=this.scope.viewModel;this.scope.explorationContainerOptions={showAppBar:void 0,showTaskPane:!v,showVisualizationPane:!v,showNavContentPane:void 0,showBackButtonOnAppBar:void 0,isUsageMetricsReport:v,visualContainerOptions:void 0,insights:!0},y.explorationContainer=e.explore.viewModels.ViewModelFactory.createExplorationContainer(),this.services.explorationLoader.load(b);var S=e.contracts.LandingView.Report,w=this.services.telemetryService,D=w.startEvent(e.telemetry.DashboardSwitchView,y.contract.activeView,S);y.contract.activeView=S;var C=d.convertLandingContainerShallow(y.contract);C.calculateLayout(),this.services.localizationService.ensureLocalization((function(){s.scope.reportName=s.getReportTitleForNavigationBar(o)})),this.scope.viewModel.reportContainer.isActiveView=!0,D.resolve()},t.prototype.getReportOpenSource=function(){var t=jsCommon.QueryStringUtil.getQueryStringValue("openReportSource");return"email"===t?e.telemetry.OpenExplorationSource.EmailSubscription:e.telemetry.OpenExplorationSource.Normal},t.prototype.getReportTitleForNavigationBar=function(t){var i=t.displayName;return i?i:e.common.localize.get("Landing_DefaultReportName")},t.prototype.onBindToExcelWorkbook=function(t,i){t.stopPropagation(),this.services.workbookService.currentActiveWorkbook={id:i.id,packageId:i.packageId,uniqueId:i.uniqueId,displayName:i.displayName};var o=this.scope.viewModel,r=e.contracts.LandingView.Workbook,a=this.services.telemetryService,n=a.startEvent(e.telemetry.DashboardSwitchView,o.contract.activeView,r);this.scope.viewModel.contract.activeView=r,n.resolve()},t.prototype.initializeContainer=function(i){var o=this;if(!this.scope.viewModel){var r={dashboards:[],activeViewMode:e.contracts.DashboardContainerViewMode.DashboardViewer,activityPane:e.staticContract.getActivityPaneContract()},a={activeView:e.contracts.LandingView.Dashboard,dashboardContainer:r,reportContainer:{},workbookContainer:{},qnaContainer:{}},n=this.services.modelConverter,s=this.scope.viewModel=n.convertLandingContainer(a);s.calculateLayout(),s.applyLayout()}i&&this.logBootstrapEvents(i),this.services.rootScope.$on(e.constants.dashboardContainerLoaded,(function(e,r){o.scope.viewModel.dashboardContainer=o.services.dashboardService.dashboardContainerModel,i&&(t.logGetAppMetadataTelemetry(o.services.telemetryService,i,window.getAppMetadataInfo),o.services.$timeout((function(){i.event.info.finalState=r||o.services.navigation.stateService.current.name,o.scope.$applyAsync((function(){i.resolve(),o.scope.appDataReady=!0,o.services.pageTitle.refresh(),o.services.tutorialDataStore.onReady((function(){return o.services.tutorialPopup.showStartupTutorial()}))}))})))}))},Object.defineProperty(t.prototype,"dashboardContainerModel",{get:function(){return this.scope.viewModel.dashboardContainer=this.services.dashboardService.dashboardContainerModel,this.scope.viewModel.dashboardContainer},enumerable:!0,configurable:!0}),t.prototype.showLoadingForDashboard=function(){var e=this.services.dashboardDataService;return e.activeDashboard&&e.activeDashboard.id<0},t.prototype.quitImpersonation=function(){var e=this.services.impersonationService,t=e.getImpersonationState().modelId;e.clearImpersonation(),this.services.fullScreen.fullScreenMode&&this.scope.exitFullScreen(),this.services.navigation.showRowLevelSecuritySlider(t)},t.logGetAppMetadataTelemetry=function(t,i,o){if(!_.isEmpty(o))for(var r=0,a=o;r<a.length;r++){var n=a[r];if(n&&n.start&&n.end){var s=n.initialDashboardContainer,c=t.startChildEvent(i.event,e.telemetry.AppGetAppMetadata,n.url,n.groupGUID,n.size,_.size(s&&s.dashboards),_.size(s&&s.reports),_.size(s&&s.models),_.size(s&&s.workbooks),_.size(s&&s.favorites),n.start.toISOString(),n.end.toISOString());c.event.id=n.requestId,n.parseStart&&n.parseEnd&&t.logChildEvent(c.event,e.telemetry.AppParseAppMetadata,n.parseStart.toISOString(),n.parseEnd.toISOString()),n.isError?c.reject(e.errorDetailsHelper.getTelemetryErrorDetails({code:n.code,message:n.errorMessage})):c.resolve()}}},t.prototype.logBootstrapEvents=function(t){for(var i=this.services.telemetryService,o=e.common.perfMarkers.getJsParseTimes(window.parseTimeMarkers),r=0,a=o;r<a.length;r++){var n=a[r];i.logChildEvent(t.event,e.telemetry.AppJavaScriptParse,n.fileName,n.start,n.end)}},t.prototype.openUsageMetricsReport=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r;return __generator(this,(function(a){switch(a.label){case 0:o=this.services.telemetryService.startEvent(e.telemetry.UsageMetricsViewUsageMetricsReport,e.constants.usageMetrics_Report,t.objectId,e.constants.usageMetrics_Report),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.services.usageMetricsReport.openReportUsageMetricsReport(t,i,o)];case 2:return a.sent(),o.resolve(),[3,4];case 3:return r=a.sent(),o.reject(e.errorDetailsHelper.getTelemetryErrorDetails(r.error)),[3,4];case 4:return[2]}}))}))},t.prototype.belongsToUsageMetricsContentPack=function(e){return e&&e.contract&&this.services.usageMetricsReport.reportBelongsToUsageMetricsContentPack(e.contract)},t})();t.LandingContainer=u})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.constants,o=(function(){function t(t,i){var o=this;this.scope=t,this.services=i,this.scope.viewModel.ownedByMeSelected=!0,this.scope.tryItFree=function(){return o.tryItForFree()},this.scope.deleteModel=function(e){return o.deleteModel(e)},this.scope.userGroupHeader=new e.models.UserGroupHeaderModel,this.scope.isInVisibleDashboard=function(e){return o.services.quota.isInVisibleDashboard(e)},this.scope.allowProTrial=function(){return o.allowProTrial()},this.scope.upgrade=function(){return o.upgrade()},this.loadUserMetadata(),this.updateView(),t.$watchGroup([function(){return o.services.workbookService.lastUpdatedTimestamp},function(){return o.services.modelService.lastUpdatedTimestamp},function(){return o.scope.dashboardContainer.dashboards}],(function(){o.updateView()})),t.$watch((function(){return o.services.groupService.activeGroup}),(function(){o.loadUserMetadata(),o.updateView()})),this.logUsageEvent()}return t.createOptions=function(){return{additionalServices:["errorService","modelConverter","navigation","promiseFactory","telemetryService","localizationService","quota","modelService","modelHttpService","groupService","featureSwitchService","userInfo","workbookService","workbookHttpService","contentPackService","lazy","dashboardInvitationHttp","packageService","usageMetricsReport","licenseEnforcementService"]}},t.prototype.deleteModel=function(t){if(t&&t.modelId){var i=this.services.modelService.findModel(t.modelId,t.packageId);i&&i.isUsedByContentPack?this.showDialogOnModelUsedByContentPack(t.modelId):this.scope.viewModel.ownedByMeSelected&&t.storageType===e.storageType.Dataset?this.deleteOwnedModel(t):this.scope.viewModel.ownedByMeSelected&&t.storageType===e.storageType.Report?this.deleteWorkbook(t):this.removeOthersModel(t)}},t.prototype.tryItForFree=function(){return __awaiter(this,void 0,e.Promise,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.services.lazy("licenseHelper")];case 1:return t=i.sent(),this.services.userInfo.userFreeTrialExpired?t.displayDialogToExtendTrial(e.telemetry.LicenseEnforcementOperation.ManageStorageView):t.displayDialogToAcceptTrialTerms(e.telemetry.LicenseEnforcementOperation.ManageStorageView),[2]}}))}))},t.prototype.showDialogOnModelUsedByContentPack=function(e){this.services.contentPackService.showDialogOnModelDeleteInContentPack(e)},t.prototype.getUsageModelIndex=function(e,t){var i=this.scope.viewModel.usageDetails;if(i)for(var o=0,r=i.length;o<r;o++)if(i[o].modelId===e&&(!t||i[o].packageId===t))return o;return-1},t.prototype.deleteOwnedModel=function(t){var o=this,r=this.services.errorService.control(),a=[new InJs.ModalDialogAction(this.services.localizationService.get("QuotaManagement_DeleteButtonText"),function(a,n){o.logDeleteEvent(e.telemetry.QuotaDeleteItemType.DeleteOwnedModel,t.sizeInMBs),r.hideDialog();var s=o.getUsageModelIndex(t.modelId,t.packageId);s>=0&&o.scope.viewModel.usageDetails.splice(s,1);var c=o.services.telemetryService.startEvent(e.telemetry.DashboardDeleteDataset),l=o.services.modelService.findModel(t.modelId,t.packageId);o.services.modelHttpService.deleteModel(l.contract,c.event).then((function(){c.resolve(),o.updateUsage()}),(function(r){r.status===e.HttpStatusCode.Unauthorized?o.services.errorService.error(o.services.localizationService.get("Model_NoPermissionToDeleteMessage"),"Model_NoPermissionToDelete",{requestId:r.requestId,statusCode:r.status.toString()}):r.status===e.HttpStatusCode.BadRequest&&r.headers(e.common.PowerBIErrorHeader)===i.CannotDeleteModelPublishedToOrganizationalAppHeader?o.services.errorService.error(o.services.localizationService.get("Model_DeleteWaitMessage"),"Model_DeleteWaitMessage",{requestId:r.requestId,statusCode:r.status.toString()}):o.services.errorService.error(o.services.localizationService.get("Model_FailToDeleteModelMessage"),"Model_FailToDeleteModel",{requestId:r.requestId,statusCode:r.status.toString()}),o.scope.viewModel.usageDetails.push(t),c.reject()}))}),new InJs.ModalDialogAction(this.services.localizationService.get("QuotaManagement_CancelButtonText"),function(e,t){r.hideDialog()})],n=this.services.localizationService.get("QuotaManagement_DeleteConfirmationTitle"),s=this.services.localizationService.get("QuotaManagement_DeleteConfirmationMessage");r.showCustomDialog(n,$("<div/>").text(s),a,(function(e){e.parent().find('input[value="'+o.services.localizationService.get("QuotaManagement_CancelButtonText")+'"]').focus()}),!0)},t.prototype.removeOthersModel=function(t){var i=this,o=this.services.errorService.control(),r=[new InJs.ModalDialogAction(this.services.localizationService.get("QuotaManagement_RemoveButtonText"),function(r,a){i.logDeleteEvent(e.telemetry.QuotaDeleteItemType.RemoveSharedItem,t.sizeInMBs),o.hideDialog();var n=t.dashboardsFromModel,s=[];if(n)for(var c=0,l=n.length;c<l;c++){var d=n[c],p=d.contract.modelIds;s=s.concat(p);var u=i.services.telemetryService.startEvent(e.telemetry.DashboardDeleteDashboardUser);i.services.dashboardInvitationHttp.deleteUser(i.scope.dashboardContainer.userId,d.id,u.event).then((function(e){u.resolve(),i.updateUsage()}),(function(e){i.services.errorService.error(i.services.localizationService.get("Dashboard_FailToRemoveDashboardMessage"),"Dashboard_FailToRemoveDashboard",{requestId:e.requestId,statusCode:e.status.toString()}),u.reject()}))}for(var c=0,l=s.length;c<l;c++){var h=i.getUsageModelIndex(s[c]);h>-1&&i.scope.viewModel.usageDetails.splice(h,1)}i.services.modelService.removeModels(s)}),new InJs.ModalDialogAction(this.services.localizationService.get("QuotaManagement_CancelButtonText"),function(e,t){o.hideDialog()})],a=this.services.localizationService.get("QuotaManagement_RemoveConfirmationTitle"),n=this.services.localizationService.get("QuotaManagement_RemoveConfirmationMessage");o.showCustomDialog(a,$("<div/>").text(n),r,(function(e){e.parent().find('input[value="'+i.services.localizationService.get("QuotaManagement_CancelButtonText")+'"]').focus()}),!0)},t.prototype.deleteWorkbook=function(t){var i=this,o=this.services.errorService.control(),r=[new InJs.ModalDialogAction(this.services.localizationService.get("QuotaManagement_DeleteButtonText"),function(r,a){i.logDeleteEvent(e.telemetry.QuotaDeleteItemType.DeleteOwnedWorkbook,t.sizeInMBs),o.hideDialog();var n=i.getUsageModelIndex(t.modelId,t.packageId);n>=0&&i.scope.viewModel.usageDetails.splice(n,1);var s=i.services.workbookService.workbooks,c=_.filter(s,(function(e){return e.modelId===t.modelId}));if(c&&c.length>0){var l=i.services.telemetryService.startEvent(e.telemetry.DashboardRemoveWorkbook,i.services.packageService.getWorkbookStorageProvider(c[0].contract.packageId),i.services.packageService.getWorkbookContentProvider(c[0].contract.packageId));i.services.workbookHttpService.deleteWorkbook(c[0].contract,l.event).then((function(){l.resolve(),i.updateUsage()}),(function(o){o.status===e.HttpStatusCode.Unauthorized?i.services.errorService.error(i.services.localizationService.get("Workbook_NoPermissionToRemoveMessage"),"Workbook_NoPermissionToRemove",{requestId:o.requestId,statusCode:o.status.toString()}):i.services.errorService.error(i.services.localizationService.get("Workbook_FailToRemoveWorkbookMessage"),"Workbook_FailToRemoveWorkbook",{requestId:o.requestId,statusCode:o.status.toString()}),i.scope.viewModel.usageDetails.push(t),l.reject()}))}}),new InJs.ModalDialogAction(this.services.localizationService.get("QuotaManagement_CancelButtonText"),function(e,t){o.hideDialog()})],a=this.services.localizationService.get("QuotaManagement_DeleteConfirmationTitle"),n=this.services.localizationService.get("QuotaManagement_DeleteConfirmationMessage");o.showCustomDialog(a,$("<div/>").text(n),r,(function(e){e.parent().find('input[value="'+i.services.localizationService.get("QuotaManagement_CancelButtonText")+'"]').focus()}),!0)},t.prototype.updateUsage=function(){var t=this.services.quota,i=t.getUsage();this.scope.viewModel.selfUsageInMB=i.ownedUsage,this.scope.viewModel.otherUsageInMB=i.sharedUsage,this.scope.viewModel.totalUsageInMB=i.totalUsage;var o={selfUsageInPercent:this.scope.viewModel.selfUsageInMB/this.scope.viewModel.quotaLimitInMB,otherUsageInPercent:this.scope.viewModel.otherUsageInMB/this.scope.viewModel.quotaLimitInMB,selfUsageInUnit:e.StorageUsageService.convertToUsageWithUnit(this.scope.viewModel.selfUsageInMB),otherUsageInUnit:e.StorageUsageService.convertToUsageWithUnit(this.scope.viewModel.otherUsageInMB),usageDescription:this.services.localizationService.format("QuotaManagement_UsageDescription",[e.StorageUsageService.convertToUsageWithUnit(i.totalUsage),e.StorageUsageService.convertToUsageWithUnit(this.scope.viewModel.quotaLimitInMB)])};this.scope.viewModel.usageBarModel=o},t.prototype.updateView=function(){this.scope.viewModel.usageDetails=this.services.quota.getUsageModels();var e=this.services.featureSwitchService.featureSwitches.showHiddenUsageMetricsModels;if(!e){var t=this.services.packageService,i=this.services.usageMetricsReport;this.scope.viewModel.usageDetails=_.filter(this.scope.viewModel.usageDetails,(function(e){var o=t.findPackage(e.packageId);return!i.packageIsUsageMetricsContentPack(o)}))}this.updateUsage()},t.prototype.loadUserMetadata=function(){this.services.groupService.activeGroup?this.scope.viewModel.isMyWorkspace=this.services.groupService.activeGroup.isMyWorkspace:this.scope.viewModel.isMyWorkspace=!0,this.scope.viewModel.isPremiumUser=this.services.userInfo.isPremiumUser,this.scope.viewModel.quotaLimitInMB=this.services.quota.quotaLimitInMB,this.scope.viewModel.quotaLimitInUnit=e.StorageUsageService.convertToUsageWithUnit(this.scope.viewModel.quotaLimitInMB),this.scope.viewModel.tryItFreeText=this.services.userInfo.userFreeTrialExpired?this.services.localizationService.get("ExtendTrial_RequestExtensionButtonText"):this.services.localizationService.get("UpgradeAccount_TryfreeButton")},t.prototype.allowProTrial=function(){var e=this.services.userInfo;return!e.isPremiumUser&&!e.userFreeTrialExpired},t.prototype.upgrade=function(){window.open("https://go.microsoft.com/fwlink/?linkid=847283","_blank")},t.prototype.logDeleteEvent=function(t,i){var o=this.scope.viewModel.isMyWorkspace?e.telemetry.QuotaOpenManageStorageContext.Personal:e.telemetry.QuotaOpenManageStorageContext.Group,r=this.services.telemetryService;r.logEvent(e.telemetry.QuotaManageStorageDelete,this.scope.viewModel.isPremiumUser,o,t,i,this.scope.viewModel.selfUsageInMB,this.scope.viewModel.otherUsageInMB,this.scope.viewModel.quotaLimitInMB)},t.prototype.logUsageEvent=function(){var t=this.scope.viewModel.isMyWorkspace?e.telemetry.QuotaOpenManageStorageContext.Personal:e.telemetry.QuotaOpenManageStorageContext.Group,i=this.services.telemetryService;i.logEvent(e.telemetry.QuotaStorageUsage,this.scope.viewModel.isPremiumUser,t,this.scope.viewModel.selfUsageInMB,this.scope.viewModel.otherUsageInMB,this.scope.viewModel.quotaLimitInMB)},t})();t.ManageStorageView=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.constants,o=e.common.DropdownUtils,r=e.constants.dynamicMessaging,a=e.models.factory.NavigationBarMenuAction,n=e.models.factory.NavigationBarMenuFactory,s=e.dialog.PopupNotificationDialogBuilder,c=jsCommon.StringExtensions,l="noChrome",d="#EMAIL",p='<div class="aboutPbiDialog"><div class="logo"></div><div class="info"><div class="title">{0}</div><div class="copyright">&copy;{1}</div><span class="field">{2}</span><span class="value">{{version}}</span><br><span class="field">{3}</span><span class="value">{4}</span><br><span class="field">{5}</span><span class="value">{6}</span><br><span class="field">{7}</span><span class="value">{8}</span></div></div>',u=(function(){function t(o,r){
var n=this;this.scope=o,this.services=r;var s=this.services.$window;this.scope.featureSwitchPublishToWeb=!1,this.scope.logoConfig={operator:s.powerBIOperator,operatorLocale:s.powerBIOperatorLocale},this.scope.navigateToLanding=function(){n.services.bootstrapService.bootstrapNavigation(!1,!0),n.services.telemetryService.logEvent(e.telemetry.NavigationClickLogo)},this.services.asyncFeatureSwitchService.getFeatureSwitches().then((function(e){n.scope.featureSwitchPublishToWeb=!(!e.publishToWebEnabled||!e.anonymousEmbeddingEnabled)})),this.services.shellCapabilities.ensureCapabilitiesInitialized().then((function(){return o.shellCapabilities=n.services.shellCapabilities.getCapabilities()})),this.scope.fullScreen=this.services.fullScreen,this.scope.enterFullScreen=function(){n.services.fullScreen.enterFullScreen(),n.services.telemetryService.logEvent(e.telemetry.SettingsEnterFullScreen,n.services.navigation.stateService.current.name)},this.bindNavigationBarMenus(),this.scope.powerBICompanionAppEnable=!1,this.scope.canWrite=function(){return!n.services.permissionService.isActiveWorkspaceIsReadOnly},this.services.appMetadataService.getAppMetadata().then((function(e){n.showArchivedContentLink=!c.isNullOrUndefinedOrWhiteSpaceString(e.previousTenantId)})),this.services.userInfo.getUserPhoto().then((function(e){n.scope.userPhoto=e}));var l=this.services.$location.host();this.scope.isSelfhostInternal=0===l.indexOf("dxt.powerbi.com")||0===l.indexOf("portal.analysis.windows-int.net")||0===l.indexOf("powerbi-df.analysis-df.windows.net"),this.initializeUserNotifications(),this.services.userNotificationInfo.registerNotificationsUpdatedListener((function(){return n.notificationChangeHandler()})),this.services.localizationService.ensureLocalization((function(){t.FeedbackMessage=n.services.localizationService.get("FeedbackTicket_Message").replace("{{startLink}}",' <a href="https://support.powerbi.com/tos" target="_blank">').replace("{{endLink}}","</a> ")+" (#EMAIL).",t.SupportTicketMessage=n.services.localizationService.get("SupportTicket_Message").replace("{{startLink}}",' <a href="https://support.powerbi.com/tos" target="_blank">').replace("{{endLink}}","</a> ")+" (#EMAIL)."})),this.scope.showMenu=function(e,t,i){return n.showMenu(e,t,i)},this.scope.showSettingsMenu=function(e){return n.showSettingsMenu(e)},this.scope.showHelpMenu=function(e){return n.showHelpMenu(e)},this.scope.showUserInfoMenu=function(e){return n.showUserInfoMenu(e)},this.scope.showFeedbackContextMenu=function(e){return n.showFeedbackMenu(e)},this.scope.getProTrialStatus=function(){return n.getProTrialStatus()},this.scope.promptForUpgrade=function(){return n.promptForUpgrade()};var d=this.services.rootScope.$on(e.constants.enablePowerBICompanionApp,(function(t){n.services.timeout((function(){n.scope.powerBICompanionAppEnable=!0;var t=_.filter(n.scope.downloadMenu,(function(e){return e.action===a.DownloadCompanionApp}))[0];t&&(t.href=e.models.PowerBICompanionModel.downloadLink)}))})),p=this.services.rootScope.$on(i.onReportChangedEventName,(function(e,t){n.scope.reportChanged=t}));this.scope.$on("$destroy",(function(){d(),p()}))}return t.createOptions=function(){return{additionalServices:["$location","$window","appMetadataService","asyncFeatureSwitchService","modalDialogService","dropdown","errorService","lazy","navigation","telemetryService","localizationService","userInfo","groupService","overlayService","userSettingsHttpService","fullScreen","permissionService","userNotificationInfo","bootstrapService","dynamicMessagingData","licenseEnforcementService","shellCapabilities"]}},t.prototype.initializeUserNotifications=function(){var t=this;this.scope.showUserNotifications=function(){t.services.userNotificationInfo.showPane?t.services.userNotificationInfo.hidePaneOnClick=!0:(t.services.userNotificationInfo.showPane=!0,t.services.telemetryService.logEvent(e.telemetry.UserNotificationsLoadNotificationPane,t.services.userNotificationInfo.userNotifications.unseenCount))},this.scope.getUserNotificationsCount=function(){return _.size(t.scope.userNotifications)},this.scope.getHighestNotificationLevel=function(e){return t.services.userNotificationInfo.getHighestNotificationLevel(e)},this.popupNotificationDialog=new s(this.services.modalDialogService)},t.prototype.notificationChangeHandler=function(){var e=this,t=this.services.userNotificationInfo.userNotifications.notifications;if(this.scope.userNotifications=_.filter(t,(function(e){return!e.seen&&(1===e.notificationType||null==e.notificationType)})),this.scope.popupNotifications=_.filter(t,(function(e){return!e.seen&&0===e.notificationType})),!(_.isEmpty(this.scope.popupNotifications)||this.modalDialogPromise&&this.modalDialogPromise.pending())){var i=this.scope.popupNotifications[0];i.seen=!0;var o={title:i.message.title.text,subtitle:i.message.subTitle&&i.message.subTitle.text,message:i.message.message.text,imgUrl:i.message.image&&i.message.image.imagePath,okButton:{text:i.action.resource.text,url:i.action.path[0]},cancelButton:i.subAction?{text:i.subAction.resource.text,url:i.subAction.path[0]}:null};this.modalDialogPromise=this.popupNotificationDialog.show("popupNotificationDialog",o),this.modalDialogPromise.then((function(t){0===t?e.services.dynamicMessagingData.postData(r.userClickedAction).finally((function(){e.handleDynamicMessageAction(i.action)})):e.services.dynamicMessagingData.postData(r.userDismissedAction)}))}},t.prototype.handleDynamicMessageAction=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:if(!t)return[2];switch(e=t.actionType){case 7:return[3,1]}return[3,3];case 1:return[4,this.services.licenseEnforcementService.accept2017ProTrial()];case 2:return i.sent(),this.services.$window.location.reload(!0),[3,4];case 3:return this.services.$window.open(t.path[0],"_self"),[3,4];case 4:return[2]}}))}))},t.prototype.showAdminPortal=function(){return!!this.services.asyncFeatureSwitchService.featureSwitches.adminCapacityEnabled||this.services.userInfo.userMetadata.isTenantAdmin},t.prototype.showSettingsMenu=function(e){var t=this,i=this.scope,o=function(i){i(),t.services.dropdown.hideAll(),e.stopPropagation()},r=this.services.shellCapabilities.getCapabilities().navBarSettings,a={canWrite:function(){return i.canWrite()},onManageStorageSelected:function(){return o((function(){return t.manageStorage()}))},onCreateContentPackSelected:function(){return o((function(){return t.services.navigation.showPublishContentPackSlider()}))},onViewContentPackSelected:function(){return o((function(){return t.services.navigation.showViewContentPackSlider()}))},onAdminPortalSelected:function(){return o((function(){return t.openAdminPortal()}))},onManageGatewaysSelected:function(){return o((function(){return t.openManageGateways()}))},onPowerBISettingsSelected:function(){return o((function(){return t.openGeneralSettings()}))},onManageEmbedSelected:function(){return o((function(){return t.manageEmbed()}))},showQuotaManagement:function(){return r.showQuotaManagement},showContentPacks:function(){return r.showContentPacks},showManageGateways:function(){return r.showManageGateways},showAdminPortal:function(){return t.showAdminPortal()},showArchivedContentLink:this.showArchivedContentLink,showArchivedContent:function(){return t.services.navigation.toggleArchivedContent()},showPublishToWeb:function(){return i.featureSwitchPublishToWeb&&r.showPublishToWeb}};this.services.dropdown.showMenu(a,"navigationBarSettingsMenu.html",this.getMenuDisplayOptions(e))},t.prototype.showHelpMenu=function(e){this.showMenu("helpMenu",n.createHelpMenu(this.services.localizationService,this.services.$window),e)},t.prototype.showUserInfoMenu=function(e){this.showMenu("powerBIUserInfo",n.createUserInfoMenu(this.services.localizationService),e)},t.prototype.showFeedbackMenu=function(e){this.showMenu("feedbackContextMenu",n.createFeedbackMenuItems(this.services.localizationService),e)},t.prototype.showMenu=function(e,t,i){var r=this;o.showLegacyDropdownItems(this.services.dropdown,e,t,"navigationBar-contextMenu",(function(e){return r.scope.navigationBarMenuItemSelected(e,void 0)}),this.getMenuDisplayOptions(i))},t.prototype.getProTrialStatus=function(){var e=this.services.userInfo,t=this.services.localizationService;if(!e.userHasPremiumPlan&&e.userHasFreeTrial)return e.userFreeTrialDaysRemaining>1?t.format("UpgradeAccount_TrialDaysLeftStatue",[e.userFreeTrialDaysRemaining]):1===e.userFreeTrialDaysRemaining?t.get("UpgradeAccount_TrialDayLeftStatue"):void 0},t.prototype.promptForUpgrade=function(){this.services.licenseEnforcementService.showUpgradeDialog(e.telemetry.LicenseEnforcementOperation.NavigationBar)},t.prototype.getMenuPosition=function(e){var t=e.currentTarget;return{x:t.offsetLeft+t.offsetWidth,y:t.offsetTop+t.offsetHeight}},t.prototype.getMenuDisplayOptions=function(e){return{preferLeft:!0,showInsideVisibleArea:!0,position:this.getMenuPosition(e)}},t.prototype.showSupportWidget=function(){var i=this;e.UserVoiceService.ensureUserVoice(this.services.telemetryService,(function(){e.UserVoicePopover.show();var o=e.session.UserInfoUtils.getEmailAddressForReceivingMail();e.UserVoicePopover.setFooterText(t.SupportTicketMessage.replace(d,o)),i.services.localizationService.ensureLocalization((function(){e.UserVoiceService.api.push(["embed","#popovermain",{mode:"contact",forum_id:e.session.UserInfoUtils.isInternalUser()===!0?265200:262210,contact_title:i.services.localizationService.get("TopNav_HelpMenu_ContactSupport"),height:"325px",width:"325px"}])}))}))},t.prototype.showAboutDialog=function(){var i=this,o=this.services.errorService.control(),r=e.helpers.ClusterLocationHelper.getClusterLocation(clusterUri,this.services.localizationService);if(this.services.localizationService.ensureLocalization((function(){var e=new Date;t.AboutDialogTemplate=c.format(p,i.services.localizationService.get("TopNav_PowerBILogoTextNoPreview"),i.services.localizationService.format("PowerBI_Copyright_Text",[e.getFullYear().toString()]),i.services.localizationService.get("PowerBI_Build_Version_Text"),i.services.localizationService.get("AdditionalErrorInfo_ActivityIdText"),i.services.telemetryService.sessionId,i.services.localizationService.get("AdditionalErrorInfo_TimestampText"),e.toString(),i.services.localizationService.get("AdditionalErrorInfo_DataLocationText"),r)})),e.build){var a=[new InJs.ModalDialogAction(this.services.localizationService.get("TopNav_HelpMenu_AboutDialog_Close"),function(e,t){o.hideDialog()})],n=t.AboutDialogTemplate.replace("{{version}}",e.build);o.showCustomDialog(null,$(n),a,null,!0)}},t.prototype.downloadIOSApp=function(){var i=this,o=this.services.telemetryService,r=this.services.errorService.control();if(this.services.localizationService.ensureLocalization((function(){t.AboutDownloadPowerBIDialogTemplate='<div class="aboutPbiDownloadDialog"><div class="title">'+i.services.localizationService.get("PowerBIDownloadMobileTxt")+'</div><div class="dialoglogo mobileLogo"></div><div class="message">'+i.services.localizationService.get("PowerBIDownloadMobileMessage")+"</div></div>"})),e.build){var a=[new InJs.ModalDialogAction(this.services.localizationService.get("TopNav_DownloadMenu_AboutDialog_SendEmail"),function(e,t){r.hideDialog(),i.sendPowerBIDownloadLink()}),new InJs.ModalDialogAction(this.services.localizationService.get("LearnMore"),function(e,t){r.hideDialog(),i.services.$window.open(downloadPageFWlink,"_blank")})],n=t.AboutDownloadPowerBIDialogTemplate;r.showCustomDialog(null,$(n),a,(function(e){e.parent().find('input[value="'+i.services.localizationService.get("LearnMore")+'"]').focus()}),!0,null,l)}o.logEvent(e.telemetry.DashboardDownloadIOSApp,"Navigation Bar")},t.prototype.downloadAnalyzeInExcelUpdates=function(){var i=this,o=this.services.telemetryService,r=this.services.errorService.control();this.services.localizationService.ensureLocalization((function(){t.AboutDownloadPowerBIDialogTemplate='<div class="aboutPbiDownloadDialog"><div class="title">'+i.services.localizationService.get("TopNav_SettingsMenu_AnalyzeInExcelUpdates")+'</div><div class="dialoglogo analyzeInExcelLogo"></div><div class="message">'+i.services.localizationService.get("PowerBIDownloadAnalyzeInExcelMessage_Part1")+'</div><div class="message">'+i.services.localizationService.get("PowerBIDownloadAnalyzeInExcelMessage_Part2")+"</div></div>"}));var a=[new InJs.ModalDialogAction(this.services.localizationService.get("AnalyzeInExcelToast_DownloadUpdate"),function(t,a){o.logEvent(e.telemetry.DashboardAndReportsDownloadExcelUpdates,e.common.AnalyzeInExcelService.getOperatingSystemArch(),"Download Menu"),r.hideDialog(),i.services.$window.open(e.common.AnalyzeInExcelService.getDownloadLink(),"_blank")}),new InJs.ModalDialogAction(this.services.localizationService.get("LearnMore"),function(e,t){r.hideDialog(),i.services.$window.open("https://go.microsoft.com/fwlink/?LinkID=786428","_blank")})],n=t.AboutDownloadPowerBIDialogTemplate;r.showCustomDialog(null,$(n),a,null,!0,null,l)},t.prototype.sendPowerBIDownloadLink=function(){var t=this,i=e.session.UserInfoUtils.getEmailAddressForReceivingMail(),o=this.services.telemetryService.startEvent(e.telemetry.PrivacySendPowerBIEmail);this.services.userSettingsHttpService.sendEmailForDownloadPowerBI(i,o.event).then((function(e){o.resolve();var r=t.services.errorService.control(),a=t.services.localizationService.get("PowerBISendDownloadEmailTxt"),n=t.services.localizationService.format("PowerBISendDownloadEmailSubmittedTo",[i]),s=[];r.showCustomDialog(a,$("<div/>").text(n),s,null,!0)}),(function(e){o.reject()}))},t.prototype.openGeneralSettings=function(){this.services.navigation.showSettingsSlider("general")},t.prototype.openManageGateways=function(){this.services.navigation.navigateToGateways()},t.prototype.logDownloadTelemetry=function(e){var t=this.services.telemetryService;t.logEvent(e,"Navigation Bar")},t.prototype.manageStorage=function(){var t=e.telemetry.QuotaOpenManageStorageContext.Personal;this.services.groupService.activeGroup&&!this.services.groupService.activeGroup.isMyWorkspace&&(t=e.telemetry.QuotaOpenManageStorageContext.Group),this.services.telemetryService.logEvent(e.telemetry.QuotaOpenManageStoragePage,e.telemetry.QuotaOpenManageStorageInteraction.NavigatorBarManageStorage,t),this.services.navigation.showManageStorageSlider()},t.prototype.manageEmbed=function(){this.services.navigation.showManageEmbedSlider()},t.prototype.upgradeAccount=function(){this.services.telemetryService.logEvent(e.telemetry.OpenUpgradeAccountPage,e.telemetry.OpenUpgradeAccountInteraction.NavigatorBarManageStorage)},t.prototype.signOut=function(){var t=this.services.$window[i.liveClientIdKey];if(null!=t){var o=c.format(i.liveLogoutUrl,t,location.protocol+"//"+location.host);e.common.httpService.get(o,e.common.httpService.defaultRetryRequestOptions())}},t.prototype.openAdminPortal=function(){this.services.navigation.navigateToAdminPortal(0)},t.prototype.bindNavigationBarMenus=function(){var e=this;this.services.asyncFeatureSwitchService.getFeatureSwitches().then((function(t){e.scope.downloadMenu=n.createDownloadMenu(e.services.localizationService,t)})),this.scope.navigationBarMenuItemSelected=function(t){return e.onNavigationBarMenuItemSelected(t)}},t.prototype.onNavigationBarMenuItemSelected=function(t){switch(t.action){case a.ContactSupport:this.showSupportWidget();break;case a.DownloadIOSApp:this.downloadIOSApp();break;case a.DownloadCompanionApp:this.logDownloadTelemetry(e.telemetry.DashboardDownloadCompanionApp);break;case a.OpenGeneralSettings:this.openGeneralSettings();break;case a.DownloadGateways:this.logDownloadTelemetry(e.telemetry.DashboardDownloadGateways);break;case a.DownloadExcelPublisher:this.logDownloadTelemetry(e.telemetry.DashboardDownloadExcelPublisher);break;case a.DownloadAnalyzeInExcelUpdates:this.downloadAnalyzeInExcelUpdates();break;case a.ShowAboutDialog:this.showAboutDialog();break;case a.ManageStorage:this.manageStorage();break;case a.UpgradeAccount:this.upgradeAccount();break;case a.SignOut:this.signOut();break;case a.PublishContentPack:this.services.navigation.showPublishContentPackSlider();break;case a.ViewContentPack:this.services.navigation.showViewContentPackSlider();break;case a.ManageEmbed:this.manageEmbed()}this.services.overlayService.hideAllDropdowns()},t})();t.NavigationBarController=u})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.CollapsiblePaneExpandedWidth,o=e.dataServices.constants,r=e.common.contracts.Permissions,a=(function(){function t(i,o){var r=this;this.scope=i,this.services=o,this.dashboardModel=i.viewModel,this.model=new e.models.DashboardNavigationPaneListItemModel(this.dashboardModel),this.updateDashboardMetadata(),this.model.actions=t.getDashboardActions(this.scope,this.services,this.model,this.dashboardModel),this.model.icon=this.services.ownership.isResourceSharedWithMe(this.dashboardModel)?e.models.NavigationPaneListItemIcon.Shared:this.model.icon=e.models.NavigationPaneListItemIcon.None,this.scope.model=this.model,this.scope.showContextMenu=!1,this.scope.tooltipConfig={tooltipLocalizeDescription:"NavigationPane_RefreshError",tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft},this.scope.rename=function(t){r.scope.$emit(e.constants.renameDashboardEventName,t,r.scope.model.source.id)},this.scope.isContextMenuEnabled=function(){return!r.services.permissionService.isActiveWorkspaceIsReadOnly},this.scope.isNameValid=function(e){return!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)},this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){r.scope.model.isNameEditable=!1}));var a=this.services.rootScope.$on(e.constants.notifyDashboardOwnerInfoLoaded,(function(){a(),a=null,r.updateDashboardMetadata()}));this.services.rootScope.$on("$destroy",(function(){a&&a()}))}return t.createOptions=function(){return{additionalServices:["$location","navigation","localizationService","quota","groupService","featureSwitchService","permissionService","workbookService","dashboardService","ownership","taskPaneSliderService","licenseEnforcementService"]}},t.prototype.updateDashboardMetadata=function(){var t=this,i=this.model.metadata=[];this.dashboardModel.hasOwnerInfo()&&i.push({name:"ownerInfo",type:e.common.models.ContextMenuItemMetadataType.Link,label:this.services.localizationService.get("DashboardContextMenu_OwnedBy").toLocaleUpperCase(),linkUrl:function(){return jsCommon.StringExtensions.format("mailto:{0}",t.dashboardModel.ownerMail)},linkText:function(){return t.dashboardModel.ownerMail},value:function(){return t.dashboardModel.ownerFullname?jsCommon.StringExtensions.format("{0} -",t.dashboardModel.ownerFullname):""},linkTarget:"_self"})},t.getDashboardActions=function(a,n,s,c){var l=[];return n.localizationService.ensureLocalization((function(){l.push({text:n.localizationService.get("DashboardContextMenu_Open"),action:function(){n.navigation.navigateToDashboardByGUID(c.objectId)}});var d=(c.getPermissions()&r.ReShare)===r.ReShare;d&&l.push({text:n.localizationService.get("DashboardContextMenu_Share"),action:function(){n.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.ShareDashboard)||(n.navigation.navigateToDashboardByGUID(c.objectId),n.timeout((function(){n.licenseEnforcementService.supportsSharing(!0)&&n.taskPaneSliderService.expandPane(6,i.Large)})))}}),(c.getPermissions()&r.All)===r.All||(c.getPermissions()&r.ReadWrite)===r.ReadWrite?(l.push({text:n.localizationService.get("DashboardContextMenu_Rename"),action:function(){s.isNameEditable=!0}}),l.push({text:n.localizationService.get("DashboardContextMenu_Delete"),action:function(){n.dashboardService.promptForDeleteDashboard(c.id,!0)}}),l.push({text:n.localizationService.get("DashboardContextMenu_Settings"),action:function(){n.navigation.showSettingsSlider("dashboards",c.objectId)}})):(c.getPermissions()&r.CopyOnWrite)===r.CopyOnWrite?(l.push({text:n.localizationService.get("ContextMenu_Personalize"),action:function(){a.$emit(e.constants.personalizeEventName,c.contract.originalPackageId)}}),l.push({text:n.localizationService.get("DashboardContextMenu_Delete"),action:function(){if(c.contract.modelIds[0])a.$emit(e.constants.deleteModelEventName,c.contract.modelIds[0],c.contract.originalPackageId,1);else if(c.contract.workbookIds[0]){var t=n.workbookService.findWorkbook(c.contract.workbookIds[0],c.contract.originalPackageId);a.$emit(o.workbook.removeWorkbookEventName,t,1)}}})):l.push({text:n.localizationService.get("DashboardContextMenu_Remove"),action:function(){n.dashboardService.promptForDeleteDashboard(c.id,!1)}});var p=n.$location.search()[t.isDasboardExportAllowedQueryString];p&&"1"===p&&l.push({text:n.localizationService.get("DashboardContextMenu_Export"),action:function(){var e=n.$location.search()[t.packageTypeString];e||(e="XMLA"),n.dashboardService.exportDashboard(c.id,e)}})})),l},t.isDasboardExportAllowedQueryString="exportallowed",t.packageTypeString="packageType",t})();t.DashboardNavigationPaneListItemController=a})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=jsCommon.EnumExtensions,o=e.common.helpers.ModelConverterHelper,r=e.common.contracts.Permissions,a=e.common.contracts.PublishOrRefreshStatus,n=e.common.contracts.RealTimeMode,s=(function(){function t(t,i){var o=this;this.scope=t,this.services=i,this.scope.$on("destroy",(function(){o.modalDialogPromise&&o.modalDialogPromise.pending&&o.modalDialogPromise.reject("DatasetNavigationPaneListItemController destroyed")})),this.datasetContractModel=t.viewModel,this.datasetModel=t.viewModel,this.model=new e.models.DatasetNavigationPaneListItemModel(this.datasetContractModel),this.refreshDatasetModel={},this.model.historyDialogParameters=this.services.historyDialogService.historyDialogParameters,this.scope.showHistoryDialog=function(){return o.showHistoryDialog(o.refreshDatasetModel)},this.model.metadata=this.getDatasetMetadata(this.datasetContractModel),this.datasetContractPackage=this.services.packageService.findPackage(this.datasetContractModel.packageId),this.scope.model=this.model,this.scope.showContextMenu=!1,this.scope.tooltipConfig={tooltipLocalizeDescription:"NavigationPane_RefreshError",tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft},this.scope.isRefreshInProgress=function(){return o.isRefreshInProgress()},this.scope.rename=function(t){o.scope.$emit(e.constants.renameModelEventName,t,o.scope.model.source.id,o.scope.model.source.packageId)},this.scope.isNameValid=function(e){return!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)},this.scope.isContextMenuEnabled=function(){return o.getDatasetMetadata(o.datasetContractModel,o.model.metadata),1!==o.model.source.packagePublishStatus},this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){o.scope.model.isNameEditable=!1})),this.model.icon=this.services.ownership.isResourceSharedWithMe(this.datasetContractModel)?e.models.NavigationPaneListItemIcon.Shared:this.model.icon=e.models.NavigationPaneListItemIcon.None,t.$watch((function(){return o.datasetContractModel.contract.currentRefreshStartingTime}),(function(){o.updateDatasetMetadata()})),this.scope.showRefreshErrorDialog=function(){o.showRefreshErrorDialog()},this.scope.showRefreshError=function(){return o.showRefreshError()},this.scope.showIcon=function(){return o.showIcon()},this.scope.getPackagePublishStatus=function(){return o.getPackagePublishStatus()}}return t.createOptions=function(){return{additionalServices:["refreshService","errorService","modelConverter","modelHttpService","telemetryService","lazy","localizationService","navigation","modelService","packageService","historyDialogService","featureSwitchService","insightsService","analyzeInExcel","modalDialogService","ownership","groupService","permissionService","downloadReport","datasetActions","usageMetricsReport"]}},t.prototype.getPackagePublishStatus=function(){var t=this.services.modelService.findModel(this.model.source.id,this.model.source.packageId);return t?t.packagePublishStatus:e.common.contracts.PublishOrRefreshStatus.FinishedSuccessfully},t.prototype.showIcon=function(){var t=this.services.modelService.findModel(this.model.source.id,this.model.source.packageId);return!!t&&(t.packagePublishStatus!==e.common.contracts.PublishOrRefreshStatus.PublishError&&t.contract.lastRefreshStatus!==e.common.contracts.PublishOrRefreshStatus.RefreshError)},t.prototype.showRefreshError=function(){var t=this.services.modelService.findModel(this.model.source.id,this.model.source.packageId);return!!t&&(t.packagePublishStatus===e.common.contracts.PublishOrRefreshStatus.RefreshError||t.contract.lastRefreshStatus===e.common.contracts.PublishOrRefreshStatus.RefreshError)},t.prototype.displaySuccessHistoryResult=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o;return __generator(this,(function(r){switch(r.label){case 0:return _.isEmpty(t)?[3,2]:[4,this.services.lazy("errorFormat")];case 1:return e=r.sent(),i=e.getFriendlyErrorMessage(t[0].serviceExceptionJson),o=this.parseAdditionalErrorInfo(t[0].serviceExceptionJson,e),this.services.errorService.errorNoDefaultAdditionalErrorInfo(i,"RefreshFailure",{displayableErrorInfo:o}),[3,3];case 2:r.label=3;case 3:return[2]}}))}))},t.prototype.displayErrorHistoryResult=function(){this.services.errorService.error(this.services.localizationService.get("RefreshError_Unknown"),"RefreshFailure_FailedToGetHistories")},t.prototype.processModelAndPackageRefreshHistories=function(e,t){var i=this;this.services.modelHttpService.getPackageRefreshHistories(this.datasetContractModel.packageId.toString(),e.event).then((function(r){var a;if(!t||_.isEmpty(t.data)||t.data[0].isSuccessful)a=!1;else if(_.isEmpty(r.data)||r.data[0].isSuccessful)a=!0;else{var n=o.convertRefreshTimeToJsDateTime(t.data[0].endTime).getTime(),s=o.convertRefreshTimeToJsDateTime(r.data[0].endTime).getTime();a=n>s}a?i.displaySuccessHistoryResult(t.data).then((function(){return e.resolve()})):i.displaySuccessHistoryResult(r.data).then((function(){return e.resolve()}))}),(function(o){t?i.displaySuccessHistoryResult(t.data).then((function(){return e.resolve()})):(i.displayErrorHistoryResult(),e.reject())}))},t.prototype.showRefreshErrorDialog=function(){var t=this,i=this.services.modelHttpService,o=this.services.telemetryService,r=o.startEvent(e.telemetry.DashboardGetRefreshHistoriesOnRefreshFailures);this.datasetModel.contract.lastRefreshStatus===a.RefreshError&&this.datasetModel.contract.packagePublishStatus===a.RefreshError?i.getModelRefreshHistories(this.datasetContractModel.id.toString(),r.event).then((function(e){t.processModelAndPackageRefreshHistories(r,e)}),(function(e){t.processModelAndPackageRefreshHistories(r)})):this.datasetModel.contract.lastRefreshStatus===a.RefreshError?i.getModelRefreshHistories(this.datasetContractModel.id.toString(),r.event).then((function(e){t.displaySuccessHistoryResult(e.data).then((function(){return r.resolve()}))}),(function(e){t.displayErrorHistoryResult(),r.reject()})):this.datasetModel.contract.packagePublishStatus===a.RefreshError&&i.getPackageRefreshHistories(this.datasetContractModel.packageId.toString(),r.event).then((function(e){t.displaySuccessHistoryResult(e.data).then((function(){return r.resolve()}))}),(function(e){t.displayErrorHistoryResult(),r.reject()}))},t.prototype.parseAdditionalErrorInfo=function(e,t){var i=t.convertErrorDetailsJson(e),o=[];return i.forEach((function(e){o.push({errorInfoKey:e.Name,errorInfoValue:e.Value})})),o},t.prototype.isRefreshInProgress=function(){var e=this.services.modelService.findModel(this.datasetContractModel.id,this.datasetContractModel.packageId);return!!e&&e.isRefreshInProgress},t.prototype.updateDatasetMetadata=function(){this.getDatasetMetadata(this.datasetContractModel,this.model.metadata)},t.prototype.getDatasetMetadata=function(i,r){var a=this,n=this.services.refreshService,s=this.services.modelConverter,c=this.services.localizationService,l=this.services.historyDialogService,d=[],p=function(o){i.contentProviderId=o.contentProviderId,i.onPremModelConnectionString=o.onPremModelConnectionString,i.directQueryMode=o.directQueryMode,i.currentRefreshStartingTime=o.currentRefreshStartingTime,i.refreshSchedule=o.refreshSchedule,i.refreshHistories=o.refreshHistories,i.insightsSupported=o.insightsSupported,i.storageProviderType=o.storageProviderType,d=i.onPremModelConnectionString?t.addRefreshInfoForOnPremAnalysisServicesToMetadata(r):i.directQueryMode?t.addRefreshInfoForDirectQueryModel(r):t.addRefreshStatusToMetadata(s,o,c,l,a.refreshDatasetModel,r),n.isModelRefreshInProgress(o)?t.updateMetadataValue(r,"refreshInProgress",e.common.models.ContextMenuItemMetadataType.Text,(function(){return c.get("SettingsDataset_ScheduleRefresh_FlyoutMessage_RefreshInProgress")})):t.deleteMetadataItem(r,"refreshInProgress",e.common.models.ContextMenuItemMetadataType.Text)},u=this.services.modelService.findModel(i.id,i.packageId);return u&&(this.setMissingPropertiesOnContractModelFromPackage(u),p(u.contract),this.refreshDatasetModel.dataset=o.convertModelToDataset(u.contract),this.model.actions=this.getDatasetActions(this.datasetContractModel,this.datasetContractPackage)),d},t.prototype.setMissingPropertiesOnContractModelFromPackage=function(e){var t=this.services.packageService.findPackage(e.packageId);t&&(void 0===e.contract.storageProviderType&&(e.contract.storageProviderType=t.contract.storageProviderType),e.contract.isPackageRefreshEnabled=t.contract.IsRefreshEnabled)},t.prototype.getDatasetActions=function(t,o){var a=this,s=[];return this.services.localizationService.ensureLocalization((function(){var c=a.services.featureSwitchService,l=a.services.localizationService,d=a.services.telemetryService,p=a.services.permissionService.getModelEffectivePermissions(t.contract);if(t.realTimeMode)i.hasFlag(p,r.All)&&(s.push({text:l.get("DashboardContextMenu_Settings"),action:function(){a.services.datasetActions.showStreamingDatasetEditorPane(t.id)}}),s.push({text:l.get("DashboardContextMenu_Remove"),action:function(){a.services.datasetActions.delete(t)}}),t.realTimeMode===n.PersistAndCache&&s.push({text:l.get("DashboardContextMenu_Open"),action:function(){a.services.datasetActions.createReport(t)}}),t.realTimeMode!==n.PubNubCacheOnly&&s.push({text:l.get("DashboardContextMenu_ApiInfo"),action:function(){a.services.datasetActions.showStreamingDatasetPushInfoPane(t.id)}}));else if(i.hasFlag(p,r.CopyOnWrite)?(s.push({text:l.get("ContextMenu_Personalize"),action:function(){a.services.datasetActions.personalizeDataset(t)}}),s.push({text:l.get("DashboardContextMenu_Delete"),action:function(){d.logEvent(e.telemetry.DashboardDatasetClickDelete,t.contentProviderId),a.scope.$emit(e.constants.deleteModelEventName,t.id,t.packageId,3)}})):a.services.ownership.permissionsArePersonalized(p,o)?s.push({text:a.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){d.logEvent(e.telemetry.DashboardDatasetClickDelete,t.contentProviderId),a.scope.$emit(e.constants.deleteModelEventName,t.id,t.packageId)}}):i.hasFlag(p,r.All)&&(s.push({text:l.get("DashboardContextMenu_Rename"),action:function(){d.logEvent(e.telemetry.DashboardDatasetClickRename,t.contentProviderId),a.model.isNameEditable=!0}}),s.push({text:l.get("DashboardContextMenu_Delete"),action:function(){d.logEvent(e.telemetry.DashboardDatasetClickDelete,t.contentProviderId),a.scope.$emit(e.constants.deleteModelEventName,t.id,t.packageId)}}),a.datasetContractModel.contract.onPremModelConnectionString||a.services.usageMetricsReport.modelOriginatedFromUsageMetricsContentPack(t)||s.push({text:a.datasetContractModel.contract.directQueryMode?l.get("DashboardContextMenu_DatasetSettings"):l.get("DashboardContextMenu_ManageRefresh"),action:function(){a.services.telemetryService.logEvent(e.telemetry.DashboardDatasetClickScheduleRefresh,t.contentProviderId),a.services.datasetActions.navigateToSettingsPage(t)}}),a.services.usageMetricsReport.modelOriginatedFromUsageMetricsContentPack(t)||s.push({text:l.get("DashboardContextMenu_RefreshNow"),
action:function(){a.services.datasetActions.refreshNow(t)}})),c&&(a.services.analyzeInExcel.isAnalyzeInExcelSupported(c,p)&&s.push({text:l.get("DashboardContextMenu_AnalyzeInExcel"),action:function(){a.services.datasetActions.analyzeInExcel(t)}}),t.contract.insightsSupported&&i.hasFlag(p,r.Read)&&!a.services.usageMetricsReport.modelOriginatedFromUsageMetricsContentPack(t)&&s.push({text:a.getInsightsText(),action:function(){a.services.datasetActions.getInsights(t)},descriptor:e.constants.insightsDescriptor}),t.contentProviderId===e.common.constants.pbiDesktopContentProviderId&&_.isEmpty(t.contract.onPremModelConnectionString)&&i.hasFlag(p,r.All)&&a.services.featureSwitchService.featureSwitches.datasetDownloadPbix&&s.push({text:l.get("DashboardContextMenu_DownloadDataset"),action:function(){a.services.downloadReport.downloadModel({id:t.id.toString(),filename:t.displayName})}}),i.hasFlag(p,r.All)&&(6===t.contentProviderId||7===t.contentProviderId)&&!t.contract.onPremModelConnectionString)){var u=a.services.groupService.activeGroup;(u.isMyWorkspace||u.contract.isOwner||!u.contract.isReadOnly)&&s.push({text:l.get("DashboardContextMenu_GranularSecurity"),action:function(){var e=a.services.datasetActions.granularSecurity(t);e&&(a.modalDialogPromise=e)}})}})),s},t.prototype.getInsightsText=function(){var e,t=this.services.insightsService.getInsightsStatus(this.datasetModel.contract);switch(t){case 2:e=this.services.localizationService.get("DashboardContextMenu_ViewInsights");break;case 1:e=this.services.localizationService.get("DashboardContextMenu_GettingInsights");break;default:e=this.services.localizationService.get("DashboardContextMenu_GetInsights")}return e},t.prototype.showHistoryDialog=function(e){this.services.historyDialogService.showHistoryDialog(e)},t.addRefreshStatusToMetadata=function(i,r,n,s,c,l){var d,p,u,h=[],v=o.convertRefreshTimeToJsDateTime(r.lastRefreshTime),g=!1;r.lastRefreshStatus===a.RefreshError?(d=e.common.models.ContextMenuItemMetadataType.Action,u=n.format("SettingsDataset_ScheduleRefresh_FlyoutMessage_LastRefreshFailed",[""]),p=""+v,g=!0):r.lastRefreshStatus===a.PublishError?(d=e.common.models.ContextMenuItemMetadataType.Action,u="",p=n.get("SettingsDataset_ScheduleRefresh_FlyoutMessage_LastPackagePublishFailed")):(d=e.common.models.ContextMenuItemMetadataType.Text,u=n.format("SettingsDataset_ScheduleRefresh_FlyoutMessage_LastRefreshSucceeded",[""]),p=""+v),h.push({name:"lastRefreshStatus",type:d,label:u.toLocaleUpperCase(),isWarning:g,value:function(){return p},actionOnClick:function(){s.showHistoryDialog(c)},actionText:function(){return p}}),t.updateMetadataValue(l,"lastRefreshStatus",d,(function(){return p}),g,void 0,void 0,void 0,(function(){s.showHistoryDialog(c)}),void 0,u.toLocaleUpperCase());var m=t.isModelScheduledRefreshEnabled(r),f=t.doesStorageSourceAllowRefresh(r),b=t.isStorageSourceRefreshEnabled(r);if(f)if(b&&m){var y=n.get("SettingsDataset_ScheduleRefresh_FlyoutMessage_NextRefresh")+o.convertRefreshTimeToJsDateTime(r.nextRefreshTime);t.showNextRefresh(y,h,l)}else if(!b&&m){var y=n.get("SettingsDataset_ScheduleRefresh_FlyoutMessage_NotOneDriveNextScheduled")+o.convertRefreshTimeToJsDateTime(r.nextRefreshTime);t.showNextRefresh(y,h,l)}else if(b&&!m){var y=n.get("SettingsDataset_ScheduleRefresh_FlyoutMessage_OneDriveEnabledRefreshNotEnabled");t.showRefreshDisabled(y,h,l)}else{var y=n.get("SettingsDataset_ScheduleRefresh_FlyoutMessage_NotOneDriveAndScheduleRefreshNotEnabled");t.showRefreshDisabled(y,h,l)}else if(m){var y=n.get("SettingsDataset_ScheduleRefresh_FlyoutMessage_NextRefresh")+o.convertRefreshTimeToJsDateTime(r.nextRefreshTime);t.showNextRefresh(y,h,l)}else{var y=n.get("SettingsDataset_ScheduleRefresh_FlyoutMessage_RefreshNotEnabled");t.showRefreshDisabled(y,h,l)}return h},t.getNextRefreshTimeName=function(){var e="nextRefreshTime";return e},t.getRefreshScheduleNotSetupName=function(){var e="refreshScheduleNotSetUp";return e},t.showNextRefresh=function(i,o,r){var a=t.getNextRefreshTimeName();t.deleteMetadataItem(r,"refreshScheduleNotSetUp",e.common.models.ContextMenuItemMetadataType.Text),o.push({name:a,type:e.common.models.ContextMenuItemMetadataType.Text,value:function(){return i}}),t.updateMetadataValue(r,a,e.common.models.ContextMenuItemMetadataType.Text,(function(){return i})),t.deleteMetadataItem(r,t.getRefreshScheduleNotSetupName(),e.common.models.ContextMenuItemMetadataType.Text)},t.showRefreshDisabled=function(i,o,r){var a=t.getRefreshScheduleNotSetupName();t.deleteMetadataItem(r,t.getNextRefreshTimeName(),e.common.models.ContextMenuItemMetadataType.Text),o.push({name:a,type:e.common.models.ContextMenuItemMetadataType.Text,value:function(){return i}}),t.updateMetadataValue(r,a,e.common.models.ContextMenuItemMetadataType.Text,(function(){return i}))},t.isModelScheduledRefreshEnabled=function(e){return e.refreshSchedule.refreshEnabled!==!1&&(9===e.contentProviderId||e.isAllDataSourcesSupportedForRefresh!==!1)},t.doesStorageSourceAllowRefresh=function(t){return t.storageProviderType===e.common.contracts.StorageProviderType.OneDrive||t.storageProviderType===e.common.contracts.StorageProviderType.SharePoint},t.isStorageSourceRefreshEnabled=function(e){return e.isPackageRefreshEnabled},t.addRefreshInfoForOnPremAnalysisServicesToMetadata=function(i){var o=[],r=e.common.localize.get("SettingsDataset_DisableEntireRefreshPageErrorMessage_OnPremAnalysisServicesScheduleInfo");return o.push({name:"OnPremASRefreshInfo",type:e.common.models.ContextMenuItemMetadataType.Text,value:function(){return r}}),t.updateMetadataValue(i,"OnPremASRefreshInfo",e.common.models.ContextMenuItemMetadataType.Text,(function(){return r})),o},t.addRefreshInfoForDirectQueryModel=function(i){var o=[],r=e.common.localize.get("SettingsDataset_DisableEntireRefreshPageErrorMessage_DirectQueryScheduleInfo");return o.push({name:"DirectQueryRefreshInfo",type:e.common.models.ContextMenuItemMetadataType.Text,value:function(){return r}}),t.updateMetadataValue(i,"DirectQueryRefreshInfo",e.common.models.ContextMenuItemMetadataType.Text,(function(){return r})),o},t.updateMetadataValue=function(e,t,i,o,r,a,n,s,c,l,d){if(void 0===r&&(r=!1),e){for(var p=void 0,u=0,h=e.length;u<h;u++){var v=e[u];if(v.name===t){p=v;break}}p?(p.value=o,p.isWarning=r,p.linkText=a,p.linkUrl=n,p.linkTitle=s,p.actionOnClick=c,p.type=i,p.infoTooltipConfig=l,p.label=d):e.push({name:t,type:i,value:o,linkText:a,linkUrl:n,linkTitle:s,linkTarget:"_blank",actionOnClick:c,isWarning:r,infoTooltipConfig:l,label:d})}},t.deleteMetadataItem=function(e,t,i){if(e){for(var o=void 0,r=0,a=e.length;r<a;r++){var n=e[r];if(n.name===t&&n.type===i){o=r;break}}o&&e.splice(o,1)}},t})();t.DatasetNavigationPaneListItemController=s})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t,i){this.scope=t,this.services=i,this.groupModel=t.viewModel,this.model=new e.models.GroupNavigationPaneListItemModel(this.groupModel),this.scope.model=this.model,this.scope.showContextMenu=!1,this.scope.tooltipConfig={tooltipLocalizeDescription:"NavigationPane_RefreshError",tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft},this.scope.isNameValid=function(e){return _.isEmpty(e)},this.scope.isContextMenuEnabled=function(){return!1},this.services.userInfo.getUserPhoto().then((function(e){t.userPhoto=e}))}return t.createOptions=function(){return{additionalServices:["navigation","localizationService","userInfo"]}},t})();t.GroupNavigationPaneListItemController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t,i){var o=this;this.scope=t,this.services=i;var r=t.viewModel;this.reportContract=r.contract,this.model=new e.models.ReportNavigationPaneListItemModel(r),this.model.actions=this.getReportActions(this.reportContract),this.scope.model=this.model,this.scope.showContextMenu=!1,this.scope.tooltipConfig={tooltipLocalizeDescription:"NavigationPane_RefreshError",tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft},this.scope.rename=function(e){o.services.reportService.renameReport(e,o.scope.model.source.id)},this.scope.isNameValid=function(e){return!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)},this.scope.isContextMenuEnabled=function(){return!o.services.permissionService.isActiveWorkspaceIsReadOnly&&o.model.source.packagePublishStatus!==e.common.contracts.PublishOrRefreshStatus.PublishInProgress},this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){o.scope.model.isNameEditable=!1}))}return t.createOptions=function(){return{additionalServices:["localizationService","reportService","permissionService","featureSwitchService","modelService","analyzeInExcel","telemetryService"]}},t.prototype.getReportActions=function(t){var i=this,o=[];return this.services.localizationService.ensureLocalization((function(){var r=i.services.featureSwitchService;o.push({text:i.services.localizationService.get("DashboardContextMenu_Open"),action:function(){i.scope.$emit(e.constants.openReportEventName,t.id)}}),(t.permissions&e.common.models.ReportPermissions.All)===e.common.models.ReportPermissions.All||(t.permissions&e.common.models.ReportPermissions.Personalized)===e.common.models.ReportPermissions.Personalized?(o.push({text:i.services.localizationService.get("DashboardContextMenu_Rename"),action:function(){i.model.isNameEditable=!0}}),o.push({text:i.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){i.scope.$emit(e.constants.deleteReportEventName,t.id)}})):(t.permissions&e.common.models.ReportPermissions.CopyOnWrite)===e.common.models.ReportPermissions.CopyOnWrite&&(o.push({text:i.services.localizationService.get("ContextMenu_Personalize"),action:function(){i.scope.$emit(e.constants.personalizeEventName,t.packageId)}}),o.push({text:i.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){i.scope.$emit(e.constants.deleteModelEventName,t.modelId,t.packageId,2)}})),r&&i.services.analyzeInExcel.isAnalyzeInExcelSupported(r,t.permissions)&&o.push({text:i.services.localizationService.get("DashboardContextMenu_AnalyzeInExcel"),action:function(){var o=i.services.modelService.findModel(t.modelId,t.packageId);i.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsAnalyzeInExcel,"Report Navigation Pane List",o.contentProviderId,o.contract.modelFeatures,o.dbName),i.services.analyzeInExcel.startAnalyzeInExcel(o)}})})),o},t})();t.ReportNavigationPaneListItemController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=jsCommon.EnumExtensions,o=e.common.helpers.ModelConverterHelper,r=e.common.contracts.Permissions,a=e.common.models.ContextMenuItemMetadataType,n=e.dataServices.constants,s=(function(){function s(t,i){var o=this;this.scope=t,this.services=i,this.workbookModel=t.viewModel,this.model=new e.models.WorkbookNavigationPaneListItemModel(this.workbookModel),this.refreshDatasetModel={},this.model.historyDialogParameters=this.services.historyDialogService.historyDialogParameters,this.scope.showHistoryDialog=function(){return o.showHistoryDialog(o.refreshDatasetModel)},this.model.metadata=this.getWorkbookMetadata(this.workbookModel),this.model.actions=this.getWorkbookActions(this.workbookModel),this.scope.model=this.model,this.scope.showContextMenu=!1,this.scope.isRefreshInProgress=function(){return o.isRefreshInProgress()},this.scope.tooltipConfig={tooltipLocalizeDescription:"NavigationPane_RefreshError",tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft},this.scope.rename=function(e){o.services.workbookService.renameWorkbook(e,o.scope.model.source.id,o.scope.model.source.packageId)},this.scope.isNameValid=function(e){return!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)},this.scope.isContextMenuEnabled=function(){return o.getWorkbookMetadata(o.workbookModel,o.model.metadata),!o.services.permissionService.isActiveWorkspaceIsReadOnly},this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){o.scope.model.isNameEditable=!1})),this.services.rootScope.$on(n.workbook.openWorkbookContextMenuEventName,(function(e,t){t.id===o.model.source.id&&t.packageId===o.model.source.packageId&&(o.getWorkbookMetadata(o.workbookModel,o.model.metadata),o.scope.showContextMenu=!0)})),this.model.icon=this.workbookModel.isOwner()?e.models.NavigationPaneListItemIcon.Workbook:e.models.NavigationPaneListItemIcon.Shared,this.scope.showRefreshError=function(){return o.showRefreshError()},this.scope.showIcon=function(){return o.showIcon()},this.scope.getPackagePublishStatus=function(){return o.getPackagePublishStatus()}}return s.createOptions=function(){return{additionalServices:["refreshService","errorService","telemetryService","localizationService","workbookService","modelService","packageService","historyDialogService","featureSwitchService","ownership","permissionService"]}},s.prototype.getPackagePublishStatus=function(){if(!this.workbookModel.modelId)return e.common.contracts.PublishOrRefreshStatus.FinishedSuccessfully;var t=this.services.modelService.findModel(this.workbookModel.modelId,this.workbookModel.packageId);return t?t.packagePublishStatus:e.common.contracts.PublishOrRefreshStatus.FinishedSuccessfully},s.prototype.showRefreshError=function(){if(!this.workbookModel.modelId)return!1;var t=this.services.modelService.findModel(this.workbookModel.modelId,this.workbookModel.packageId);return!!t&&(t.packagePublishStatus===e.common.contracts.PublishOrRefreshStatus.RefreshError||t.contract.lastRefreshStatus===e.common.contracts.PublishOrRefreshStatus.RefreshError)},s.prototype.showIcon=function(){if(!this.workbookModel.modelId)return!0;var t=this.services.modelService.findModel(this.workbookModel.modelId,this.workbookModel.packageId);return!t||t.packagePublishStatus!==e.common.contracts.PublishOrRefreshStatus.PublishError&&t.contract.lastRefreshStatus!==e.common.contracts.PublishOrRefreshStatus.RefreshError},s.prototype.isRefreshInProgress=function(){if(this.workbookModel.packageId){var t=this.services.packageService.findPackage(this.workbookModel.packageId);if(t&&t.publishOrRefreshStatus===e.common.contracts.PublishOrRefreshStatus.RefreshInProgress)return!0}if(this.workbookModel.modelId){var i=this.services.modelService.findModel(this.workbookModel.modelId,this.workbookModel.packageId);if(i&&i.isRefreshInProgress)return!0}return!1},s.prototype.getWorkbookMetadata=function(e,i){var r=this,n=this.services.localizationService,c=this.services.historyDialogService,l=[],d=this.services.workbookService.findWorkbook(e.id,e.packageId);if(this.services.packageService.isLocalWorkbook(this.workbookModel.packageId)){l=l.concat(s.addExcelLocalFileInfo("WorkbookContextMenu_LocalFileName",i,"localFileName",a.Text,this.workbookModel.contract.sourceFilePath)),l=l.concat(s.addExcelLocalFileInfo("WorkbookContextMenu_Source",i,"FileSource",a.Text,this.services.localizationService.get("WorkbookContextMenu_Source_LocalFile")));var p=this.services.packageService.findPackage(this.workbookModel.packageId);if(p){var u=""+o.convertRefreshTimeToJsDateTime(p.lastRefreshTime);l=l.concat(s.addExcelLocalFileInfo("WorkbookContextMenu_LocalFile_LastUpdateTime",i,"localFileLastUpdated",a.Text,u))}return l}d.contract.sourceFilePath&&(l=l.concat(s.addSpoFileName(d.contract.sourceFilePath,d.viewUrl,i))),d.isOwner()&&(l=l.concat(s.addExcelLocalFileInfo("WorkbookContextMenu_Source",i,"FileSource",a.Text,this.services.localizationService.get("WorkbookContextMenu_Source_SharePointOneDrive"))));var h=this.services.modelService.findModel(this.workbookModel.modelId,this.workbookModel.packageId);if(!h){var p=this.services.packageService.findPackage(this.workbookModel.packageId);return p&&(l=l.concat(s.addLastRefreshForNonModelWorkbook(p.lastRefreshTime,i))),l}if(!this.workbookModel.contract.isPowerPivotVersionSupportsRefresh)return l=s.addRefreshInfoForNotSupportedModelWorkbook(i);var v=h.contract,g=function(e){v.contentProviderId=e.contentProviderId,v.onPremModelConnectionString=e.onPremModelConnectionString,v.directQueryMode=e.directQueryMode,v.refreshSchedule=e.refreshSchedule,v.refreshHistories=e.refreshHistories,v.storageProviderType=e.storageProviderType,l=l.concat(t.DatasetNavigationPaneListItemController.addRefreshStatusToMetadata(null,e,n,c,r.refreshDatasetModel,i))};return g(v),this.refreshDatasetModel.dataset=o.convertModelToDataset(v),l},s.prototype.showHistoryDialog=function(e){this.services.historyDialogService.showHistoryDialog(e)},s.prototype.getWorkbookActions=function(t){var o=this,a=[],s=this.services.localizationService.get("WorkbookContextMenu_View"),c=this.services.workbookService.findWorkbook(t.id,t.packageId);return this.services.localizationService.ensureLocalization((function(){var l=c.getPermissions();c.isOwner()?(o.services.featureSwitchService.featureSwitches.embedFullFidelityWorkbooks?a.push({text:s,action:function(){o.scope.$emit(n.workbook.viewWorkbookEventName,t.id,t.packageId)}}):a.push({text:s,link:c.viewUrl,action:function(){o.services.telemetryService.logEvent(e.telemetry.DashboardViewWorkbook,c.contract.etagHash,l,o.services.packageService.getWorkbookStorageProvider(c.packageId),o.services.packageService.getWorkbookContentProvider(c.packageId))}}),c.isEditable()&&a.push({text:o.services.localizationService.get("WorkbookContextMenu_Edit"),link:c.editUrl,action:function(){o.services.telemetryService.logEvent(e.telemetry.DashboardEditWorkbook,c.contract.etagHash)}}),a.push({text:o.services.localizationService.get("WorkbookContextMenu_Rename"),action:function(){o.model.isNameEditable=!0}}),o.services.packageService.isLocalWorkbook(c.packageId)&&a.push({text:o.services.localizationService.get("WorkbookContextMenu_Replace"),action:function(){o.scope.$emit(e.constants.replaceLocalWorkbookEventName,c.uniqueId)}}),o.services.packageService.isScheduleRefreshEnabledForWorkbook(c)&&a.push({text:o.services.localizationService.get("WorkbookContextMenu_ScheduleRefresh"),action:function(){var t=o.services.modelService.findModel(c.modelId,c.packageId);t&&(o.services.telemetryService.logEvent(e.telemetry.DashboardWorkbookClickScheduleRefresh,t.contentProviderId),o.services.rootScope.$emit(e.common.constants.showSettingsViewerEventName,"workbooks",t.dbName))}}),o.services.packageService.isRefreshNowEnabledForWorkbook(c)&&a.push({text:o.services.localizationService.get("WorkbookContextMenu_RefreshNow"),action:function(){var t=o.services.modelService.findModel(c.modelId,c.packageId);t&&(o.services.telemetryService.logEvent(e.telemetry.DashboardWorkbookClickRefreshNow,t.contentProviderId),o.services.refreshService.tryRefreshNow(o.services.telemetryService,o.services.errorService,t,"workbooks"))}}),a.push({text:o.services.localizationService.get("WorkbookContextMenu_Remove"),action:function(){o.scope.$emit(n.workbook.removeWorkbookEventName,t)}})):(i.hasFlag(l,r.CopyOnWrite)&&a.push({text:o.services.localizationService.get("ContextMenu_Personalize"),action:function(){o.services.telemetryService.logEvent(e.telemetry.DashboardClickPersonalize,c.contentProviderId),o.scope.$emit(e.constants.personalizeEventName,c.packageId)}}),o.services.featureSwitchService.featureSwitches.embedFullFidelityWorkbooks?a.push({text:s,action:function(){o.scope.$emit(n.workbook.viewWorkbookEventName,t.id,t.packageId)}}):a.push({text:s,link:c.viewUrl,action:function(){o.services.telemetryService.logEvent(e.telemetry.DashboardViewWorkbook,c.contract.etagHash,l,o.services.packageService.getWorkbookStorageProvider(c.packageId),o.services.packageService.getWorkbookContentProvider(c.packageId))}}),a.push({text:o.services.localizationService.get("WorkbookContextMenu_Remove"),action:function(){o.scope.$emit(n.workbook.removeWorkbookEventName,c)}}))})),a},s.addLastRefreshForNonModelWorkbook=function(t,i){var r=o.convertRefreshTimeToJsDateTime(t),a=e.common.localize.format("SettingsDataset_ScheduleRefresh_FlyoutMessage_LastRefreshSucceeded",[""]);return s.addInfoForWorkbook("WorkbookIsUpToDate",""+r,i,null,a.toLocaleUpperCase())},s.addRefreshInfoForNotSupportedModelWorkbook=function(t){var i=e.common.localize.get("WorkbookContextMenu_NotSupportedModel_RefreshNotSupported");return s.addInfoForWorkbook("WorkbookIsUpToDate",i,t)},s.addExcelLocalFileInfo=function(t,i,o,r,a){var n;return a?(n=e.common.localize.format(t,[""]),s.addInfoForWorkbook(o,a,i,r,n.toLocaleUpperCase())):(n=e.common.localize.get(t),s.addInfoForWorkbook(o,n,i,r))},s.addInfoForWorkbook=function(e,i,o,r,n){var s=[];return s.push({name:e,type:a.Text,label:n,value:function(){return i},infoToolTipConfig:r}),t.DatasetNavigationPaneListItemController.updateMetadataValue(o,e,a.Text,(function(){return i}),null,null,null,null,null,r,n),s},s.addSpoFileName=function(i,o,r){var a=[],n=e.common.localize.get("WorkbookContextMenu_SpoFileName"),s=i.substring(i.lastIndexOf("/")+1);return a.push({name:"spoFileNameAndLink",type:e.common.models.ContextMenuItemMetadataType.Link,value:function(){return""},label:n.toLocaleUpperCase(),linkText:function(){return s},linkUrl:function(){return o},linkTitle:function(){return i},linkTarget:"_blank"}),t.DatasetNavigationPaneListItemController.updateMetadataValue(r,"spoFileNameAndLink",e.common.models.ContextMenuItemMetadataType.Link,(function(){return""}),!1,(function(){return s}),(function(){return o}),(function(){return i}),void 0,void 0,n.toLocaleUpperCase()),a},s})();t.WorkbookNavigationPaneListItemController=s})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.constants.nps,o=jsCommon.QueryStringUtil,r=(function(){function t(t,r){var a=this;if(this.appLoadedWaitInterval=3e4,this.services=r,this.scope=t,this.listener=function(e){return a.receiveMessage(e)},this.scope.initListener=function(){return a.services.$window.addEventListener("message",a.listener)},this.scope.$on("$destroy",(function(){a.destroyIframeListener()})),"undefined"!=typeof npsUrlOrigin&&(this.redirectRoot=npsUrlOrigin,this.redirectRoot)){var n=e.session.userInfo.puid,s=this.redirectRoot+i.renderPath,c={};c[i.languageParam]=this.services.localizationService.currentLanguageLocale,c[i.puidParam]=n;var l=this.redirectRoot+i.displayPath,d={};d[i.puidParam]=n,this.scope.renderUrl=o.addOrUpdateQueryStringToUrl(s,c);var p=o.addOrUpdateQueryStringToUrl(l,d);this.services.applicationOptions.isE2ERun||this.services.appMetadataService.getAppMetadata().then((function(){a.services.$timeout((function(){e.npsHttpService.showNpsDialog(p).then((function(t){if(t&&t.data){var i=t.data;if(i.display){if(a.services.fullScreen.fullScreenMode)return;a.services.telemetryService.logEvent(e.telemetry.NPSShowDialog),a.scope.connectToNps()}}}))}),a.appLoadedWaitInterval)}))}}return t.createOptions=function(){return{additionalServices:["$window","$timeout","localizationService","appMetadataService","applicationOptions","fullScreen","telemetryService"]}},t.prototype.destroyIframeListener=function(){this.services.$window.removeEventListener("message",this.listener),this.scope.closeNpsHostIframe()},t.prototype.receiveMessage=function(e){if(e&&e.origin&&!(this.redirectRoot.indexOf(e.origin)<0)){var t=e.data;t&&t.msgType&&(t.msgType===i.closeNpsDialog?this.destroyIframeListener():t.msgType===i.resizeNpsDialog&&this.scope.resizeNpsHostIframe())}},t})();t.NpsHostController=r})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){var i=this.scope=e;this.services=t,i.showAppLauncherContainer=!1,i.loadingAppLauncher=!1,i.o365NavigationBarData=null,this.attachEventHandlers(this.services.$element)}return e.createOptions=function(){return{additionalServices:["o365ApplicationLauncherService","$element"]}},e.prototype.getApplicationLauncher=function(){var e=this;null!==this.scope.o365NavigationBarData||this.scope.loadingAppLauncher||(this.scope.loadingAppLauncher=!0,this.services.o365ApplicationLauncherService.getApplicationLauncher().then((function(t){var i=$("<link rel='stylesheet' type='text/css' href='"+t.data.cssUrl+"'>");$("head").append(i),$.getScript(t.data.jsUrl,(function(){var e=$.parseJSON(t.data.navBarDataJson);O365Shell.SetData(e),O365Shell.RenderAsync({launcher:"o365AppLauncherContent",switcher:"o365AppLauncherContainer"},_.noop,_.noop)})),e.scope.o365NavigationBarData=t,e.scope.loadingAppLauncher=!1,e.scope.loadingError=!1}),(function(t){e.scope.loadingAppLauncher=!1,e.scope.loadingError=!0})))},e.prototype.attachEventHandlers=function(e){var t=this,i=this.scope,o=e.find(".o365AppLauncherContainer"),r=!1;e.mousedown((function(){r=!0})),e.bind("click",(function(e){i.showAppLauncherContainer?o.removeClass("fadein").addClass("fadeout"):(t.getApplicationLauncher(),o.removeClass("fadeout").addClass("fadein").focus()),i.showAppLauncherContainer=!i.showAppLauncherContainer,r=!1})),o.on("blur",(function(e){r?r=!1:(o.removeClass("fadein"),o.addClass("fadeout"),i.showAppLauncherContainer=!1)}))},e})();e.O365ApplicationLauncherController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.DashboardUtils,o=(function(){function t(t,i){var o=this;this.scope=t,this.services=i,this.scope.dashboardDataService=i.dashboardDataService,this.scope.pin=function(){return o.pin()},this.scope.cancel=function(){return o.cancel()},this.scope.saveAndContinue=function(){return o.saveAndContinue()},this.scope.isDashboardPinnable=function(e){return o.isDashboardPinnable(e)},this.scope.noPinnableDashboard=function(){return o.noPinnableDashboard()},this.scope.getDefaultSelectedDashboardId=function(){return o.getDefaultSelectedDashboardId()},this.scope.getSortedPinnableDashboards=function(){return o.getSortedPinnableDashboards()},this.scope.getDashboards=function(){return o.getDashboards()},this.scope.updateFormatting=function(){return o.updateFormatting()},this.scope.isLiveReport=this.services.pinTileService.isLiveReport,this.scope.pinButtonText=this.scope.isLiveReport?this.services.localizationService.get("PinLiveReport_PinLive"):this.services.localizationService.get("ReportContainer_Pin"),this.scope.viewModel.isPinned=!1,this.updateView();var r=this.scope.viewModel;r.useExistingDashboard=!0,this.services.userSettingsService.getUserSettings().then((function(t){r.useDashboardFormatting=null==t.tileDialogPreviewFormat||t.tileDialogPreviewFormat===e.contracts.TileDialogPreviewFormats.DashboardFormat,o.updateFormatting()})),this.scope.$watch("dashboardDataService.dashboards.length",(function(){o.updateView()}))}return t.createOptions=function(){return{additionalServices:["dashboardDataService","pinTileService","localizationService","userSettingsService"],scopedServiceRoot:!0}},t.prototype.updateView=function(){this.sortedPinnableDashboards=this.getSortedPinnableDashboards(),this.scope.viewModel.selectedDashboardId=this.getDefaultSelectedDashboardId()},t.prototype.pin=function(){this.scope.viewModel.isPinned=!0,this.services.pinTileService.onPinButtonClickedActions()},t.prototype.saveAndContinue=function(){this.scope.viewModel.needSaveReport&&this.services.pinTileService.onSaveAndContinueButtonClickedActions()},t.prototype.cancel=function(){this.services.pinTileService.hideDialog()},t.prototype.updateFormatting=function(){this.services.pinTileService.updateTile(this.scope.viewModel.useDashboardFormatting)},t.prototype.isDashboardPinnable=function(e){if(e.contract){var t=i.isWriteable(e.contract),o=this.services.dashboardDataService.activeDashboard;return this.services.pinTileService.isPinFromDashboard&&o?t&&e.id!==o.id:t}return!1},t.prototype.getDefaultSelectedDashboardId=function(){var e=this.services.dashboardDataService.activeDashboard;if(!this.services.pinTileService.isPinFromDashboard&&e&&this.isDashboardPinnable(e))return e.id.toString();var t=this.sortedPinnableDashboards;return t.length>0?t[0].id.toString():null},t.prototype.noPinnableDashboard=function(){return 0===this.sortedPinnableDashboards.length&&(this.scope.viewModel.useExistingDashboard=!1,!0)},t.prototype.getSortedPinnableDashboards=function(){var e=this.services.dashboardDataService.activeDashboard,t=this.services.dashboardDataService.dashboards,o=_.sortBy(_.filter(t,(function(e){return i.isWriteable(e.contract)})),(function(e){return e.displayName.toLowerCase()}));return this.services.pinTileService.isPinFromDashboard&&e&&_.pull(o,e),o},t.prototype.getDashboards=function(){return this.services.dashboardDataService.dashboards},t})();t.PinTileDialogController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.hideDialog=function(){return i.hideDialog()},this.scope.tryIEDownloadQRCodeImage=function(){return i.tryIEDownloadQRCodeImage()},this.initialize()}return e.createOptions=function(){return{additionalServices:["qrCodeService"]}},e.prototype.initialize=function(){var e=this;this.services.qrCodeService.getQRCodeCanvas(this.scope.viewModel.url).then((function(t){e.scope.qrCodeCanvas=t,void 0!==e.scope.viewModel.subDisplayText?e.scope.qrCodeImageFileName=e.scope.viewModel.displayText+" - "+e.scope.viewModel.subDisplayText+".jpg":e.scope.qrCodeImageFileName=e.scope.viewModel.displayText+".jpg",e.scope.qrCodeImageDataUrl=e.scope.qrCodeCanvas.toDataURL("image/jpeg",1)}))},e.prototype.hideDialog=function(){this.services.qrCodeService.hideQRCodeDialog()},e.prototype.tryIEDownloadQRCodeImage=function(){if(this.scope.qrCodeCanvas.msToBlob){var e=this.scope.qrCodeCanvas.msToBlob();return window.navigator.msSaveBlob(e,this.scope.qrCodeImageFileName),!1}return!0},e})();e.QrCodeDialogController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.hideDialog=function(){return i.hideDialog()}}return e.createOptions=function(){return{additionalServices:["qrCodeService"]}},e.prototype.hideDialog=function(){this.services.qrCodeService.hideQRProgressDialog()},e})();e.QRCodeProgressDialogController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.helpers.ModelConverterHelper,o=(function(){function t(e,t){var i=this;this.scope=e,this.model=this.scope.viewModel,this.services=t,this.scope.isScheduledRefresh=function(e){return i.isScheduledRefresh(e)},this.initModalDialog(),this.modelRefreshHistories=[],this.packageRefreshHistories=[],this.errorService=this.services.errorService,this.datasetsService=this.services.datasetsService,this.modelHttpService=this.services.modelHttpService,this.telemetryService=this.services.telemetryService,this.promiseFactory=this.services.promiseFactory,this.getRefreshHistories(),this.scope.getSelectedHistories=function(e){return i.selectHistories(e)}}return t.createOptions=function(){return{additionalServices:["datasetsService","lazy","modelHttpService","telemetryService","errorService","localizationService","promiseFactory"]}},t.prototype.getRefreshHistories=function(){var t=this,i=this.promiseFactory.defer(),o=this.promiseFactory.defer(),r=this.telemetryService.startEvent(e.telemetry.DashboardGetRefreshHistory,e.telemetry.RefreshType.Models),a=this.telemetryService.startEvent(e.telemetry.DashboardGetRefreshHistory,e.telemetry.RefreshType.Packages);this.services.modelHttpService.getModelRefreshHistories(this.model.datasetModel.dataset.modelId.toString(),r.event).then((function(e){i.resolve(e),r.resolve()}),(function(e){i.resolve(e),r.reject()})),this.services.modelHttpService.getPackageRefreshHistories(this.model.datasetModel.dataset.contract.packageId.toString(),a.event).then((function(e){o.resolve(e),a.resolve()}),(function(e){o.resolve(e),a.reject()}));var n=this.services.lazy("errorFormat");this.promiseFactory.all([i.promise,o.promise,n]).then((function(e){t.model.showSpinner=!1;var i=e[0],o=e[1],r=e[2];i.data||o.data||t.errorModalConfig(i,"HistoryDialog_ScheduledAndOneDriveRefreshHistoryError"),
i.data&&!o.data&&(t.modelRefreshHistories=t.convertRefreshHistories(i.data,r),t.scope.refreshTypeSelected=0,t.errorModalConfig(o,"HistoryDialog_OneDriveRefreshHistoryError")),!i.data&&o.data&&(t.packageRefreshHistories=t.convertRefreshHistories(o.data,r),t.scope.refreshTypeSelected=1,t.errorModalConfig(i,"HistoryDialog_ScheduledRefreshHistoryError")),i.data&&o.data&&(t.modelRefreshHistories=t.convertRefreshHistories(i.data,r),t.packageRefreshHistories=t.convertRefreshHistories(o.data,r),i.data.length<=0&&o.data.length>0?t.scope.refreshTypeSelected=1:t.scope.refreshTypeSelected=0)}))},t.prototype.errorModalConfig=function(t,i){this.errorService.error(e.common.localize.get(i),i,{requestId:t.requestId,statusCode:t.status.toString(),displayLearnMoreHelpLink:!0,helpLink:"https://go.microsoft.com/fwlink/?LinkId=799819"})},t.prototype.selectHistories=function(e){return 0===e?this.modelRefreshHistories:1===e?this.packageRefreshHistories:void 0},t.prototype.initModalDialog=function(){var t=this;this.model.showModalDialog=!0,this.scope.dialogModel=new e.common.models.ModalDialogModel((!1),this.services.localizationService.get("TopNav_HelpMenu_AboutDialog_Close"),(!0),(!1),(!1),(!0)),this.scope.closeDialog=function(){return t.closeDialog()}},t.prototype.closeDialog=function(){var e=this;this.model.showModalDialog=!1,setTimeout((function(){e.model.showHistoryDialog=!1,e.scope.$apply()}),0)},t.prototype.isScheduledRefresh=function(t){return t.refreshType===e.common.contracts.RefreshType.Scheduled},t.prototype.convertRefreshHistories=function(t,o){var r=[];if(t)for(var a=t.length,n=0;n<a;n++){var s=t[n];r.push({id:s.id,refreshType:s.refreshType?s.refreshType:e.common.contracts.RefreshType.Scheduled,startTime:i.convertRefreshTimeToLocaleString(s.startTime),endTime:s.endTime?i.convertRefreshTimeToLocaleString(s.endTime):"",isSuccessful:s.isSuccessful,friendlyErrorMessage:this.getFriendlyErrorMessage(s,o),details:o.convertErrorDetailsJson(s.serviceExceptionJson),status:this.getStatusMessage(s)})}return r},t.prototype.getFriendlyErrorMessage=function(e,t){return 4===e.status?this.services.localizationService.get("HistoryDialog_RefreshDisabledMessage"):t.getFriendlyErrorMessage(e.serviceExceptionJson)},t.prototype.getStatusMessage=function(e){var i=this.services.localizationService;if(t.isRefreshInProgress(e))return i.get("HistoryDialog_RefreshStatus_InProgress");if(t.isRefreshTimedOut(e))return i.get("HistoryDialog_RefreshStatus_TimedOut");switch(e.status){case 1:return i.get("HistoryDialog_RefreshStatus_Completed");case 4:return i.get("Disabled");case 2:return i.get("HistoryDialog_RefreshStatus_Failed");default:return""}},t.isRefreshInProgress=function(t){var o=i.convertRefreshTimeToJsDateTime(t.startTime);return!(t.endTime||!o)&&o.getTime()+e.constants.refreshHistoryDialogTimeoutValue>=Date.now()},t.isRefreshTimedOut=function(t){var o=i.convertRefreshTimeToJsDateTime(t.startTime);return!(t.endTime||!o)&&o.getTime()+e.constants.refreshHistoryDialogTimeoutValue<Date.now()},t})();t.HistoryDialogController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t,i){this.scope=t,this.services=i;var o=t.viewModel;t.onDashboardSelected=function(e){return i.navigation.showSettingsSlider("dashboards",e)},i.navigation.settingsId?o.currentDashboardId=i.navigation.settingsId:!o.currentDashboardId&&o.dashboards.length>0&&(o.currentDashboardId=_.sortBy(o.dashboards,(function(e){return e.name.toUpperCase()}))[0].objectId);var r=t.$on(e.common.constants.navigation.stateChangeSuccess,(function(){"dashboards"===i.navigation.settingsGroup&&(o.currentDashboardId=i.navigation.settingsId)}));t.$on("$destroy",(function(){r()}))}return t.createOptions=function(){return{additionalServices:["localizationService","navigation"]}},t.prototype.$onInit=function(){this.scope.watermarkConfig={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptyDashboardsTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptyDashboardsMessage"),imgClass:"empty-dashboards-img"}},t})();t.SettingsDashboardsController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t,i,o){var r=this;this.scope=t,this.services=i,this.settingsGroupsType=o;var a=this.scope.viewModel;this.scope.onDatasetSelected=function(e){return r.onDatasetSelected(e)},i.navigation.settingsId?a.currentDatasetId=this.getIdFromDbName(this.services.navigation.settingsId):!a.currentDatasetId&&this.scope.filteredModels.length>0&&(a.currentDatasetId=_.sortBy(this.scope.filteredModels,(function(e){return e.displayName.toUpperCase()}))[0].id);var n=this.scope.$on(e.common.constants.navigation.stateChangeSuccess,(function(){i.navigation.settingsGroup===r.settingsGroupsType&&(r.scope.viewModel.currentDatasetId=r.getIdFromDbName(r.services.navigation.settingsId))}));this.scope.$on("$destroy",(function(){n()}))}return t.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","localizationService","modelService","packageService","navigation","usageMetricsReport","permissionService"]}},t.prototype.$onInit=function(){this.scope.watermarkConfig={canEdit:!0,mode:!1,titleNonShared:this.services.localizationService.get("ContentList_EmptyDatasetsTitle"),contentNonShared:this.services.localizationService.get("ContentList_EmptyDatasetsMessage"),imgClass:"empty-datasets-img"}},t.prototype.getIdFromDbName=function(e){var t=_.find(this.scope.viewModel.datasets,(function(t){return t.contract.dbName===e}));if(t)return t.modelId},t.prototype.onDatasetSelected=function(e){var t=this,i=_.find(this.scope.viewModel.datasets,(function(e){return e.modelId===t.scope.viewModel.currentDatasetId}));i&&(i.isDirty||i.isQnaDirty)?this.displayLeaveConfirmationModal(e):this.setCurrentDataset(e)},t.prototype.displayLeaveConfirmationModal=function(e){var t=this,i=this.services.errorService.control(),o=this.services.localizationService.get("SettingsDataset_DiscardChangesWarning_YesOption"),r=this.services.localizationService.get("SettingsDataset_DiscardChangesWarning_CancelOption"),a=[new InJs.ModalDialogAction(o,function(o,r){i.hideDialog(),t.setCurrentDataset(e)}),new InJs.ModalDialogAction(r,function(e,t){i.hideDialog()})],n=this.services.localizationService.get("SettingsDataset_DiscardChangesWarning_Title"),s=this.services.localizationService.get("datasets"===this.settingsGroupsType?"SettingsDataset_DiscardChangesWarning_DatasetMessage":"SettingsDataset_DiscardChangesWarning_WorkbookMessage");i.showCustomDialog(n,$("<div/>").text(s),a,(function(e){e.parent().find('input[value="'+r+'"]').focus()}),!0)},t.prototype.setCurrentDataset=function(e){this.services.navigation.showSettingsSlider(this.settingsGroupsType,e)},t})();t.SettingsDataModelsController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.helpers.ModelConverterHelper,o=10,r=300,a=(function(){function t(e,t){var a=this;this.scope=e,this.services=t,e.modelSupportsQna=i.getIsQnaSupported(e.viewModel.contract,this.services.featureSwitchService.featureSwitches),e.sectionExpanded=!1,e.maxQuestions=o,e.maxUtteranceLength=r,this.generateQuestionsFromViewModel(),e.deleteQuestion=function(e){return a.deleteQuestion(e)},e.addQuestion=function(){return a.addQuestion()},e.onChange=function(e){return a.onChange(e)},e.applyChanges=function(){return a.applyChanges()},e.discardChanges=function(){return a.discardChanges()},e.isDirty=!1,t.localizationService.ensureLocalization((function(){e.inputAriaLabel=t.localizationService.get("SettingsDataset_FeaturedQuestions_FeaturedQuestionInputLabel")}))}return t.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","lazy","localizationService","modelService","navigation"]}},t.prototype.deleteQuestion=function(e){var t=this.scope;t.isDirty=!0,t.questions.splice(e,1),this.checkForValid()},t.prototype.addQuestion=function(){var e=this.scope;e.isDirty=!0;var t={utterance:"",validationMessage:null,isValid:!1};e.questions.push(t),this.onChange(t),e.focusOnLastInput&&this.services.timeout((function(){return e.focusOnLastInput()}),0)},t.prototype.onChange=function(e){if(this.scope.isDirty=!0,!e||_.isEmpty(e.utterance)){var t=this.services.localizationService;t.ensureLocalization((function(){e.validationMessage=t.get("SettingsDataset_FeaturedQuestions_EmptyError")})),e.isValid=!1}else e.validationMessage=null,e.isValid=!0;this.checkForValid()},t.prototype.applyChanges=function(){var t=this,i=this.scope,o=_.map(i.questions,(function(e,t){return{utterance:e.utterance,order:t}}));this.services.modelService.updateFeaturedQuestions(i.viewModel.modelId,o).then((function(){i.isDirty=!1;var e=i.viewModel;e.contract.featuredQuestions=o,t.services.modelService.updateContractModel(t.scope.viewModel.contract)}),(function(){t.services.errorService.error(e.common.localize.get("SettingsGeneral_Error_FailedToSave"),"SettingsGeneral_Error_FailedToSave")}))},t.prototype.discardChanges=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o;return __generator(this,(function(r){switch(r.label){case 0:return this.generateQuestionsFromViewModel(),t=this.services.navigation,[4,this.services.lazy("errorFormat")];case 1:return r.sent(),this.scope.isDirty?(i=new e.common.dialog.MessageDialogBuilder(null),o=this.services.localizationService,i.show("SettingsDataset_DiscardChangesWarning",{titleText:o.get("SettingsDataset_DiscardChangesWarning_Title"),messageText:o.get("SettingsDataset_DiscardChangesWarning_DatasetMessage"),okButtonText:o.get("SettingsDataset_DiscardChangesWarning_YesOption"),cancelButtonText:o.get("SettingsDataset_DiscardChangesWarning_CancelOption")}).then((function(e){0===e&&t.navigateBack()}))):t.navigateBack(),this.scope.isDirty=!1,[2]}}))}))},t.prototype.checkForValid=function(){var e=this.scope;e.isValid=_.all(e.questions,(function(e){return e.isValid}))},t.prototype.generateQuestionsFromViewModel=function(){var e=this.scope;e.questions=_(e.viewModel.contract.featuredQuestions).sortBy((function(e){return e.order})).map((function(e){return{utterance:e.utterance||"",validationMessage:null,isValid:!0}})).value();for(var t=0,i=e.questions;t<i.length;t++){var o=i[t];this.onChange(o)}},t})();t.SettingsDatasetFeaturedQuestionsController=a})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t,i){var o=this;this.scope=t,this.services=i,t.subGroups=[],e.common.localize.ensureLocalization((function(){o.addSubGroup(new e.models.GeneralSubGroup(e.models.SettingsGeneralSubgroupType.Privacy,e.common.localize.get("SettingsGeneral_Privacy_Title"))),o.addSubGroup(new e.models.GeneralSubGroup(e.models.SettingsGeneralSubgroupType.Language,e.common.localize.get("SettingsGeneral_Language_Title"))),o.services.featureSwitchService.featureSwitches.closeAccountEnabled&&o.addSubGroup(new e.models.GeneralSubGroup(e.models.SettingsGeneralSubgroupType.CloseAccount,e.common.localize.get("Settings_CloseAccount"))),o.addSubGroup(new e.models.GeneralSubGroup(e.models.SettingsGeneralSubgroupType.Plugins,e.common.localize.get("SettingsGeneral_Plugins_Title"))),o.services.featureSwitchService.featureSwitches.esriEnabled&&o.addSubGroup(new e.models.GeneralSubGroup(e.models.SettingsGeneralSubgroupType.Esri,e.common.localize.get("ArcGISMapsForPowerBI")))})),t.onSubgroupSelected=function(e){return o.onSubgroupSelected(e)};var r=this.services.navigation.settingsId;if(r){r=r.charAt(0).toUpperCase()+r.slice(1);var a=e.models.SettingsGeneralSubgroupType[r];t.viewModel.selectedSubgroupType=a?a:e.models.SettingsGeneralSubgroupType.Privacy}else t.viewModel.selectedSubgroupType||(t.viewModel.selectedSubgroupType=e.models.SettingsGeneralSubgroupType.Privacy)}return t.createOptions=function(){return{additionalServices:["featureSwitchService","navigation"]}},t.prototype.onSubgroupSelected=function(t){var i=e.models.SettingsGeneralSubgroupType[t];this.services.navigation.showSettingsSlider("general",i.charAt(0).toLowerCase()+i.slice(1)),this.scope.viewModel.selectedSubgroupType=t},t.prototype.getSelectedSubgroupType=function(){return this.scope.viewModel.selectedSubgroupType},t.prototype.addSubGroup=function(e){this.scope.subGroups.push(e)},t})();t.SettingsGeneralController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t,i){var o=this;this.scope=t,this.services=i,t.onSettingsGroupSelected=function(e){return o.onSettingsGroupSelected(e)},t.settingsGroups=this.getSettingsGroups(),t.isLoading=!0;var r=t.$on(e.common.constants.navigation.stateChangeSuccess,(function(){return o.handleStateChange()}));this.handleStateChange(),t.$on("$destroy",(function(){r()})),i.settingsMetadataService.getSettings().then((function(e){t.viewModel=i.modelConverter.convertSettingsMetadata(e),t.isLoading=!1}),(function(){i.errorService.error(e.common.localize.get("SettingsGeneral_Error_FailedToLoad"),"SettingsGeneral_Error_FailedToLoad"),i.navigation.navigateBack()}))}return t.createOptions=function(){return{additionalServices:["errorService","navigation","modelConverter","settingsMetadataService","permissionService","telemetryService","featureSwitchService"]}},t.prototype.handleStateChange=function(){this.scope.currentSettingsGroup=this.services.navigation.settingsGroup},t.prototype.onSettingsGroupSelected=function(t){this.services.navigation.showSettingsSlider(t),this.scope.currentSettingsGroup!==t&&this.services.telemetryService.logEvent(e.telemetry.DashboardSettingGroupChanged,this.scope.currentSettingsGroup,t)},t.prototype.getSettingsGroups=function(){var t=this,i=[],o=e.common.localize;return o.ensureLocalization((function(){i.push(new e.models.SettingsGroup("general",o.get("SettingsGroupsNames_General"))),t.services.permissionService.isActiveWorkspaceIsReadOnly||(i.push(new e.models.SettingsGroup("dashboards",o.get("SettingsGroupsNames_Dashboards"))),i.push(new e.models.SettingsGroup("datasets",o.get("SettingsGroupsNames_Datasets"))),i.push(new e.models.SettingsGroup("workbooks",o.get("SettingsGroupsNames_Workbooks"))),i.push(new e.models.SettingsGroup("alerts",o.get("SettingsGroupsNames_Alerts"))),t.services.featureSwitchService.featureSwitches.emailSubscriptionEnabled&&i.push(new e.models.SettingsGroup("communications",o.get("SettingsGroupsNames_Subscriptions"))))})),i},t})();t.SettingsViewerController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.CollapsiblePaneExpandedWidth,o=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.isPaneExpanded=function(){return i.isPaneExpanded()},this.scope.getModuleConfig=function(){return i.getModuleConfig()},this.services.taskPaneSliderService.registerPaneVisibilityChangeObserver((function(e,t,o,r){return i.updatePaneVisibility(e,t,o,r)}))}return e.createOptions=function(){return{additionalServices:["taskPaneSliderService"]}},e.prototype.updatePaneVisibility=function(e,t,o,r){var a=this.scope.viewModel;a.collapsiblePane.isExpanded=e,a.collapsiblePane.expandedWidth=o||i.Large,a.previousMode=this.scope.viewModel.collapsiblePaneMode,a.collapsiblePaneMode=t||0,a.parameters=r||{}},e.prototype.isPaneExpanded=function(){return this.services.taskPaneSliderService.isPaneExpanded()},e.prototype.getModuleConfig=function(){return this.services.taskPaneSliderService.isShareReportPane()?{name:"powerbi.sharing",dependency:{javascript:"Sharing/module",css:["sharing"]}}:{name:"powerbi.sidePanes",namespace:"powerbi.sidePanes",dependency:{javascript:"powerBISidePanes",css:["powerBISidePanes"]}}},e.prototype.expandCollapsiblePane=function(){var e=this.scope.viewModel;this.updatePaneVisibility(!0,e.collapsiblePaneMode,e.collapsiblePaneWidth,e.parameters)},e.prototype.hideTaskPaneSlider=function(){this.updatePaneVisibility(!1,0,i.Large)},e})();t.TaskPaneSliderController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.constants,o=e.dataServices.contracts.TileType,r=(function(){function t(t,o){var r=this;this.tileRefreshRetryCount=0,this.scope=t;var a=this.services=o,n=t.viewModel,s=n.visual&&n.visual.type;if(a.trustedVisual.isTrustedVisual(s)){this.onTrustedVisualErrorChanged();var c=a.rootScope.$on(e.explore.constants.trustedVisualConsentStateChangedEventName,(function(){r.onTrustedVisualErrorChanged()}));this.scope.$on("$destroy",(function(){c()}))}n.updateVisualInteractivityOptions("true"===t.allowInteractivity),this.onViewModelChanged();var l=t.$watch("viewModel",(function(){return r.onViewModelChanged()}));t.$on(i.visualReady,(function(e){r.onVisualDataChanged(e)})),t.$on(i.scopeDestroyEventName,(function(){l()})),this.themeLoaded=!1,e.visualHost.ThemeUtils.loadThemeAndBaseTheme(a.promiseFactory,a.resourceLoader,a.themeService,a.resourcePackagesService.getAllPackages(),n.getThemeName(),n.getBaseThemeName(),this.services.featureSwitchService.featureSwitches.loadBaseTheme).finally((function(){r.themeLoaded=!0,r.scope.$applyAsync()}))}return t.createOptions=function(){return{additionalServices:["dataProxy","localizationService","modelConverter","telemetryService","visualPlugin","modelService","featureSwitchService","promiseFactory","resourcePackagesService","themeService","trustedVisual"],scopedDependencies:["resourceLoader"]}},t.prototype.readyToRender=function(){return!this.scope.viewModel.isLoading&&this.themeLoaded},t.prototype.onViewModelChanged=function(){var t=this,i=this.scope,o=i.viewModel;if(o){this.initTileData();var r=o.contract,a=this.services.modelService.findModel(r.modelId,r.packageId),n=!!r.queryResultError,s=this.services.featureSwitchService.featureSwitches.selectiveRefreshEnabled,c=s&&!n&&o.isDataStale(a?a.lastRefreshEpochTime:void 0);this.shouldRefreshData(n,c)&&(this.tileRefreshRetryCount++,o.isLoading=!o.tileData.data,this.scope.$emit(e.constants.refreshTileData,o.contract.modelId),o.setDataLoadEventDelegate((function(){return t.services.telemetryService.startEvent(e.telemetry.DashboardLoadTileData,o.contract.id,o.contract.modelId)}))),o.setDependencies(this.services.dataProxy),e.tileDataRefreshWorker(this.scope,this.services.modelConverter,o),o.errorText=o.errorText||this.services.localizationService.get("Tile_ErrorText"),o.onErrorDelegate=function(){return t.onErrorChanged()};var l=o.visual&&o.visual.type;i.allowDeferredRendering=l&&!this.services.visualPlugin.isLightWeightRenderingVisual(l),o.onErrorDelegate(),o.shouldBeIncludedInTelemetryMeasurement=!(!o.tileData||!o.tileData.data||n)}},t.prototype.onErrorChanged=function(){var t=this.scope.viewModel;t&&t.isError?(this.services.telemetryService.logEvent(e.telemetry.DashboardTileError,o[o.composite],t.errorText),this.scope.$emit(i.tileErrorEventName,t.errorText,t.errorDetails)):this.scope.$emit(i.clearTileErrorEventName)},t.prototype.shouldRefreshData=function(e,i){if(this.tileRefreshRetryCount>=t.tileRefreshRetryMaxCount)return!1;if(e)return!1;var o=this.scope.viewModel;return!!o.tileData&&(!!o.requiresData()&&(!o.tileData.data||i))},t.prototype.initTileData=function(){var e=this.scope.viewModel;if(!e.tileData){var t=this.services;try{e.tileData=t.modelConverter.convertTileData(e.contract)}catch(i){e.isError=!0,e.errorText=t.localizationService.get("Tile_DsrParseErrorText")}}},t.prototype.onVisualDataChanged=function(e){e.stopPropagation();var t=this.scope.viewModel;this.scope.$emit(i.tileVisualLoadedEventName,t.contract.id)},t.prototype.onTrustedVisualErrorChanged=function(){var e=this.scope.viewModel.visual.type;if(this.services.trustedVisual.isTrustedVisual(e)){var t=this.services.trustedVisual.validate(e);t?(this.scope.viewModel.errorDetails=t,this.scope.viewModel.errorText=t.message,this.scope.viewModel.isError=!0):this.scope.viewModel.isError=!1,this.onErrorChanged()}},t.tileRefreshRetryMaxCount=1,t})();t.CompositeTileController=r})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.constants,o=e.common.models.CollapsiblePaneExpandedWidth,r=e.dataServices.models.DashboardTileModel,a=jsCommon.EnumExtensions,n=e.common.contracts.Permissions,s=e.telemetry.PinTileSource,c=e.common.constants.tileActions,l=e.dataServices.contracts.TileType,d=e.dataServices.TileUtils,p=7,u=6,h=(function(){function h(o,a){var n=this;this.scope=o,this.services=a;var s=o.viewModel;this.isHovered=!1,o.isTileError=!1,o.optionsMenuVisible=!1,o.inFocusState=a.inFocusService.getInFocusState(s),o.model=new r(s),o.editTile=function(e){return n.editTile(e)},o.deleteTile=function(){return n.deleteTile()},o.openTile=function(e,t){return n.openTile(e,t)},o.showAlertsEditor=function(e){return n.showAlertsEditor(e)},o.tileOptionsClicked=function(e){return n.tileOptionsClicked(e)},o.toggleLegacyOptions=function(e,t){return n.toggleLegacyOptions(e,t)},o.pinTileFromDashboard=function(e){return n.pinTileFromDashboard(e)},o.inFocusTile=function(e,t){return n.inFocusTile(e,t)},o.isInsightsSupported=function(){return n.isInsightsSupported()},o.openNotifications=function(e){return n.openNotifications(e)},o.isReadOnly=function(){return n.isReadOnly()},o.isOpenable=function(e){return n.isOpenable(!0)},o.isNonActionable=function(){return n.isNonActionable()},o.displayDashboardTileOptionsMenuVisible=function(){return n.displayDashboardTileOptionsMenuVisible()},o.displayDashboardTileOpenOptions=function(){return n.displayDashboardTileOpenOptions()},o.setHover=function(e){return n.setHover(e)},o.displayDashboardTileShowIcon=function(){return n.displayDashboardTileShowIcon()},o.inEditMobileLayoutMode=function(){return n.inEditMobileLayoutMode()},o.viewportContextSelector=o.viewportContextSelector||i.dashboardSelector;var c=s.contract;s.setDatasetModelAndPackageInfo(this.services.modelService.findModel(c.modelId,c.packageId),this.services.packageService.findPackage(c.packageId)),o.getOpenActionType=function(){return n.getOpenActionType()},o.getOpenActionDescriptionText=function(){return n.getOpenActionDescriptionText()};var l=this.services.rootScope.$on(e.constants.setDashboardTileOptionsMenuVisibility,(function(e,t){n.updateOptionsMenu(e,t)})),d=this.services.rootScope.$on(t.DashboardTileController.Events.DeleteTile,(function(e,t){t===n.scope.model&&(e.stopPropagation&&e.stopPropagation(),n.services.$element.hide())}));o.hasSpotlight=function(){return!(!s||!s.hasSpotlight)},o.isModelTile=s&&s.model&&s.contract&&!s.contract.config,o.isWorkbookTile=s&&s.workbook&&s.contract&&"number"==typeof s.contract.workbookId,o.shouldShowPinButton=function(){return n.shouldShowPinButton()},o.shouldShowAlertsButton=function(){return n.shouldShowAlertsButton()},o.shouldShowInfocusButton=function(){return n.shouldShowInfocusButton()},o.exportVisualData=function(e){return n.exportVisualData(e)},this.setCanExportVisualData(),this.updateReportModel(s),this.setShowLockedTile(s),this.isReportTile()&&this.setReportTileContext(s),o.$on(i.scopeDestroyEventName,(function(){l(),d()})),this.setInViewPort()}return h.createOptions=function(){return{additionalServices:["pinTileService","contentProviderHttpService","telemetryService","$element","inFocusService","featureSwitchService","localizationService","reportService","modelService","packageService","workbookService","userNotificationInfo","userNotificationTileFilterService","groupService","navigation","dashboardDataService","userInfo","dashboardService","auditing","platformCapabilities","taskPaneSliderService","licenseEnforcementService"],scopedDependencies:["exportData"]}},h.prototype.setShowLockedTile=function(e){var t=20===e.errorCode;this.scope.showLockedTile=t,t&&(this.scope.moduleConfig={name:"powerbi.permissions",namespace:"powerbi.permissions",dependency:{javascript:"permissions",css:["permissions"]}})},h.prototype.setInViewPort=function(){var t=this.scope.viewModel,i=e.dataServices.ContractUtils.getMasterLayoutPosition(t.contract);i&&(this.scope.inViewport=i.x+i.width<=p&&i.y+i.height<=u)},h.prototype.isReadOnly=function(){return!this.scope.canEdit||this.scope.disableInteractions},h.prototype.isNonActionable=function(){var e=this.scope.viewModel;return!e||!e.action||!e.action.action||this.scope.disableInteractions},h.prototype.setHover=function(e){this.isHovered=e},h.prototype.displayDashboardTileOpenOptions=function(){if(this.scope.showLockedTile)return!1;var e=this.scope.viewModel,t=this.services.platformCapabilities.supportsMouseover;return this.scope.inViewport&&(this.isHovered||!t)&&e&&!this.scope.optionsMenuVisible&&!e.isTemporary&&!this.scope.disableInteractions&&!this.inEditMobileLayoutMode()},h.prototype.displayDashboardTileOptionsMenuVisible=function(){return this.scope.optionsMenuVisible&&!this.scope.disableInteractions},h.prototype.displayDashboardTileShowIcon=function(){return this.scope.disableInteractions},h.prototype.inEditMobileLayoutMode=function(){return this.services.dashboardDataService.InEditMobileLayoutMode},h.prototype.isReportTile=function(){var e=this.scope.viewModel;return e&&null!=e.reportTile},h.prototype.setCanExportVisualData=function(){var e=this,t=this.services.exportData,i=this.scope.viewModel;if(i.type!==l.composite)return void(this.scope.canExport=t.canExportTileData(i));var o=this.scope.$watch("viewModel.composite.tileData",(function(r){r&&(e.scope.canExport=t.canExportTileData(i),o())}))},h.prototype.exportVisualData=function(t){t.stopPropagation();var i=this.services,o=i.licenseEnforcementService;if(!o.supportsExportData||o.supportsExportData(!0)){var r=this.scope.viewModel,a=d.getVisualType(r.config);this.scope.optionsMenuVisible=!1;var n=this.services.userInfo.isPremiumUser,s=r.contract&&r.contract.id,c=i.telemetryService.startEvent(e.telemetry.EXExportVisualData,a,e.telemetry.ExportVisualSource.Dashboard,!1,0,n,!1,0);this.services.exportData.exportTileDataToCsv(this.scope.viewModel).then((function(e){c.event.info.isPartialResult=e.isPartialResult,c.resolve()}),(function(e){c.reject({errorCode:e.error.toString()})})),this.services.auditing.auditEvent(s,e.common.contracts.AuditEntityType.Tile,e.common.contracts.AuditActivityType.exportDashboardTile)}},h.prototype.shouldShowPinButtonForWorkbookTile=function(){var e=this.scope.viewModel,t=this.scope.isWorkbookTile&&e.config&&!e.config.workbookTile,i=!1;if(e.workbook&&e.workbook.contract){var o=this.services.workbookService.findWorkbook(e.workbook.contract.workbookId,e.workbook.contract.packageId);i=!o||!o.isOwner()}return!t&&!i},h.prototype.shouldShowPinButton=function(){var e=this.scope.viewModel,t=null!==this.scope.isModelTile&&this.scope.isModelTile;return!t&&!this.scope.isTileError&&(!e.workbook||this.shouldShowPinButtonForWorkbookTile())},h.prototype.updateReportModel=function(e){e&&e.report&&(e.report=this.services.reportService.findReport(e.report.id))},h.prototype.setReportTileContext=function(e){if(this.scope.isTileError=e.reportTile.isError,e.report&&e.action.action===c.openReportActionName){var t=this.services.reportService.findReport(e.report.id);t||this.services.reportService.addReport(e.report);var i=this.services.modelService.findModel(e.report.modelId);i||this.services.modelService.addContractModel(e.contractsModel)}},h.prototype.getOpenActionType=function(){var e=this.scope.viewModel;return e.action.action===this.tileActionCache?this.tileActionTypeCache:(this.updateTileActionProperties(),this.tileActionTypeCache)},h.prototype.getOpenActionDescriptionText=function(){var e=this.scope.viewModel;return e.action.action===this.tileActionCache&&e.action.targetUrl===this.tileActionTargetUrlCache&&null!=this.tileActionDescriptionCache?this.tileActionDescriptionCache:(this.updateTileActionProperties(),this.tileActionDescriptionCache)},h.prototype.updateTileActionProperties=function(){var e=this.scope.viewModel;this.tileActionCache=e.action.action,this.tileActionTargetUrlCache=e.action.targetUrl,this.updateTileActionType(),this.updateTileActionText()},h.prototype.updateTileActionType=function(){var e=this.scope.viewModel,t=e.action.action;t===c.custom.openUrlActionName?this.tileActionTypeCache=0:t===c.openQnAActionName?this.tileActionTypeCache=1:t===c.openReportActionName&&!this.scope.isModelTile&&e.report?this.tileActionTypeCache=2:t===c.openReportActionName&&!e.report&&this.scope.isModelTile?this.tileActionTypeCache=4:t===c.openReportActionName&&(e.report||this.scope.isModelTile)?this.tileActionTypeCache=2:t===c.openWorkbookActionName&&e.workbook?this.tileActionTypeCache=3:t||(this.tileActionTypeCache=null)},h.prototype.updateTileActionText=function(){var e=this.scope.viewModel,t=e.action.action;if(t===c.custom.openUrlActionName)this.tileActionDescriptionCache=e.action.targetUrl;else if(t===c.openQnAActionName)this.tileActionDescriptionCache=e.utterance;else if(t!==c.openReportActionName||this.scope.isModelTile)if(t===c.openReportActionName||e.action.action===c.openInFocusActionName||e.action.action===c.openInsightsActionName){var i=null;e.contractsModel&&(i=this.services.modelService.findModel(e.contractsModel.id,e.contractsModel.packageId)),this.tileActionDescriptionCache=i?i.displayName:""}else if(t===c.openWorkbookActionName){var o=e.contract&&e.contract.workbookId,r=this.services.workbookService.findWorkbook(o);this.tileActionDescriptionCache=r?r.displayName:""}else t||(this.tileActionDescriptionCache=this.services.localizationService.get("TileMenuOption_NoAction"));else{var a=e.report&&e.report.objectId,n=this.services.reportService.findReportByGUID(a);this.tileActionDescriptionCache=n?n.displayName:""}},h.prototype.updateOptionsMenu=function(e,t){t!==this.scope.model.tileModel.id&&(this.scope.optionsMenuVisible=!1)},h.prototype.tileOptionsClicked=function(e){this.toggleLegacyOptions(!0,e)},h.prototype.toggleLegacyOptions=function(t,i){i.stopPropagation(),this.scope.optionsMenuVisible=t,this.services.rootScope.$emit(e.constants.setDashboardTileOptionsMenuVisibility,this.scope.model.tileModel.id)},h.prototype.isOpenable=function(e,t){var i=this.scope.model.tileModel,o=i&&i.composite&&i.composite.isError;if(this.scope.disableInteractions||this.inEditMobileLayoutMode())return!1;if(!e&&this.scope.showLockedTile)return!1;if(!e&&o)return!1;if(!e&&this.isReportTile())return!1;if(this.scope.isTileElementChanging())return!1;if(i.isLoading)return!1;if(t)try{var r=$(t.target||t.srcElement);if(r.is("a")&&!r.hasClass("dashboardTileLayout"))return!1}catch(e){}return!0},h.prototype.openTile=function(t,i){var o=this.scope;if(o.disableInteractions||this.inEditMobileLayoutMode())return i&&i.preventDefault&&i.preventDefault(),!1;o.optionsMenuVisible=!1;var r=this.isOpenable(t,i);return r&&(o.$emit(e.constants.openTileEventName,o.model.tileModel),i&&i.stopPropagation&&i.stopPropagation()),r},h.prototype.editTile=function(t){t&&t.stopPropagation&&t.stopPropagation(),this.scope.optionsMenuVisible=!1,this.services.rootScope.$emit(e.constants.showTileEditorEventName,this.scope.model)},h.prototype.deleteTile=function(){this.scope.optionsMenuVisible=!1;var t=this.services.rootScope;t.$emit(e.constants.hideTileEditorEventName),t.$emit(h.Events.DeleteTile,this.scope.model),t.$emit(e.constants.removeTileEventName,this.scope.model.tileModel)},h.prototype.pinTileFromDashboard=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,o,r,a,n,c,l,d;return __generator(this,(function(p){switch(p.label){case 0:return t.stopPropagation(),this.scope.optionsMenuVisible=!1,i=this.services.contentProviderHttpService.getBuiltInContentProviders(),o=this.scope.model.tileModel,r=o.model&&o.model.contentProviderId,a=e.common.findContentProviderName(i,r),n=o.contract.resourcePackageIds,c=!!(n&&n.length>0),l=o.config&&o.config.widget?o.config.widget.name:"",d=this.services.telemetryService.startEvent(e.telemetry.DashboardPinTile,o.composite?o.composite.visual.type:void 0,s.Dashboard,"",!1,a,c,l,!1),[4,this.services.pinTileService.showPinVisualFromDashboardDialog(o,d)];case 1:return[2,p.sent()];
}}))}))},h.prototype.inFocusTile=function(e,t){e.stopPropagation(),this.scope.optionsMenuVisible=!1;var i=this.scope.model.tileModel;this.services.dashboardService.selectDashboardTile(this.scope.model);var o=i.objectId,r=i.contract.originalTileObjectId,a=this.services.groupService.activeGroupObjectId,n=this.services.dashboardDataService.activeDashboard.objectId,s=this.services.dashboardDataService.activeDashboard.contract.originalDashboardObjectId;t?this.services.navigation.showInsightsInFocusMode(o,r,n,a):this.services.navigation.showInFocusMode(o,r,n,s,a)},h.prototype.isInsightsSupported=function(){var e=this.scope.viewModel,t=e.datasetModel;return!e.workbook&&!e.realTime&&t&&!t.isHidden&&t.contract.insightsSupported&&a.hasFlag(t.getPermissions(),n.Read)},h.prototype.showAlertsEditor=function(e){e&&e.stopPropagation&&e.stopPropagation(),this.scope.optionsMenuVisible=!1,this.services.dashboardService.selectDashboardTile(this.scope.model),this.services.taskPaneSliderService.expandPane(9,o.Small)},h.prototype.shouldShowAlertsButton=function(){var t=this.scope.viewModel.datasetModel;if(!t||!this.services.dashboardService.isAlertingEnabled())return!1;var i=this.scope.viewModel;if(i.type===l.realTime)return!1;var o=d.getVisualType(i.config);return o===e.visuals.plugins.card.name||o===e.visuals.plugins.gauge.name||o===e.visuals.plugins.kpi.name},h.prototype.shouldShowInfocusButton=function(){return 1===this.scope.inFocusState&&this.services.dashboardService.isInFocusModeEnabled()},h.prototype.openNotifications=function(t){t&&t.stopPropagation&&t.stopPropagation();var i=this.scope.viewModel.contract.id,o=this.services.userNotificationInfo.userNotifications.notifications,r=_.filter(this.services.userNotificationTileFilterService.filterNotifications(o,i),(function(e){return!e.seen}));if(!_.isEmpty(r))for(var a=0,n=r;a<n.length;a++){var s=n[a];s.message.filterProperties&&s.message.filterProperties.UserDataAlertRuleId&&this.services.telemetryService.logEvent(e.telemetry.DataAlertsTileBadgeClicked,parseInt(s.message.filterProperties.UserDataAlertRuleId,10))}this.services.userNotificationTileFilterService.tileId=i,this.services.userNotificationInfo.showPane=!0},h.Events={DeleteTile:"DeleteTile"},h})();t.DashboardTileController=h})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.element=t}return e})();e.ImageTileController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.element=t}return e})();e.ModelTileController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e){var t=this;this.scope=e,this.scope.openTile=function(){return t.openTile()}}return t.prototype.openTile=function(){var t=this.scope.viewModel;this.scope.$emit(e.constants.openProviderTileEventName,t)},t})();t.ProviderTileController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common,o=e.explore.util.ExplorationTrustedVisualUtil,r=e.dataServices.contracts.TileType,a=e.explore.ScopeUtils,n=e.dataServices.models.TileFactory,s=e.visualHost.ThemeUtils,c=e.explore.FilterUtils,l=(function(){function t(t,o){var r=this;this.scope=t,this.services=o,a.defineDataSourcesOnScopeLegacy(this.scope,this.services.dataSources);var n=this.services.viewModeState;n.setMode(0);var s=this.scope.$on(e.constants.populateDashboardWithReportTiles,(function(){r.populateReportTiles()}));this.services.undoRedo.setHandler({rollback:function(){},takeSnapshot:function(){return null}});var c=this.scope.viewModel,l=this.services.eventBridge.createChannelSubscriptionManager();l.subscribe(i.events.liveReportTileReady,(function(){r.scope.$emit(i.constants.tileVisualLoadedEventName,c.contract.id)})),this.scope.$on("$destroy",(function(){s(),l.unsubscribeAll()})),this.populateReportTiles();var d={showAppBar:!1,showTaskPane:!1,showVisualizationPane:!1,showNavContentPane:!0,visualContainerOptions:{showMenu:!1,showPin:!1,showContextMenu:!1,disablePin:!1,hideHeader:!0},showBackButtonOnAppBar:!1};this.services.explorationCapabilities.setCapabilities(d)}return t.createOptions=function(){return{scopedDependencies:["dataSources","viewModeState","undoRedo","selection","visualPlugin","explorationNavigation","explorationCapabilities","resourceLoader","shell","eventBridge"],scopedServiceRoot:!0,additionalServices:["conceptualSchemaProxy","promiseFactory","localizationService","modelService","reportService","modelConverter","pinTileService","reportTileService","resourcePackagesService","explorationSerializer","featureSwitchService","visualPlugin","telemetryService","trustedVisual","themeService"]}},t.prototype.reloadTrustedVisuals=function(t){_.isEmpty(t)||(this.services.visualPlugin.ensureTrustedVisualPlugins(t),this.services.rootScope.$emit(e.constants.reloadEmptyVisuals,{visualTypes:t.map((function(e){return e.name}))}))},t.prototype.populateExploration=function(e,i,r,a,n){var s=this;this.setDataSources(e,i);var c={withData:!0,withQuery:!0},l=this.services.explorationSerializer.deepCopyExploration(i,c),d=this.services.pinTileService.mapCanvasSize(l,r);this.applySectionParameterFilters(d,r,a,n);var p=t.getReferencedResourcePackages(d,r);this.resolveExploration(p,d,r),o.acquireTrustedVisuals(i,this.services.trustedVisual).then((function(e){return s.reloadTrustedVisuals(e)}))},t.prototype.resolveExploration=function(t,i,o){if(_.isEmpty(t))this.resolveExplorationWithoutResourcePackage(i,o);else{var r=this.scope.viewModel;this.services.telemetryService.logEvent(e.telemetry.DashboardRegisterAndLoadResourcePackagesForReportTiles,t.length,r&&r.contract?r.contract.id:-1,!0),this.resolveExplorationWithResourcePackages(t,i,o)}},t.prototype.applySectionParameterFilters=function(t,i,o,r){if(t&&t.sections){var a=e.explore.SectionUtils.findSectionIndexForSectionId(t,i),n=null!=a&&t.sections[a];if(n){c.mergeExplorationSectionFilters(t,n);var s=e.explore.PodUtils.findPodIndexForPodName(t,o),l=null!=s&&t.pods[s];c.applySectionParameterFilters(n,l,r)}}},t.prototype.resolveExplorationWithResourcePackages=function(e,t,i){var o=this;this.services.resourcePackagesService.registerPackages(e),this.services.visualPlugin.ensurePlugins(e,!1).finally((function(){o.resolveExplorationWithoutResourcePackage(t,i)}))},t.prototype.populateReportTiles=function(){var e=this,t=this.scope.viewModel;if(t.isError=!1,t&&t.contract){var i=t.contract;if(!i||i.type!==r.report)return;var o=this.services.modelConverter.convertTileConfig(i),a=i.reportId,n=this.services.reportService.findReport(a),s=i.sectionId;if(!n)return void this.setErrorText();var c=this.services.modelService.findModel(n.modelId,n.packageId);this.services.reportTileService.getExploration(a,s).then((function(t){return e.initializeExplorationTheme(t)})).then((function(t){var i=o&&o.reportTile&&o.reportTile.sectionId,r=t.sections;if(null==s&&null!=i&&null!=r&&i<r.length){var a=t.sections[i];if(!a)return void e.setErrorText();s=a.id}var n=null,l=null;if(o&&o.reportTile&&(n=o.reportTile.pod,o.reportTile.filters)){var d=[];l=e.services.explorationSerializer.deserializeFilterCollection(o.reportTile.filters,d,!1)}e.populateExploration(c.contract,t,s,n,l)}),(function(){return e.setErrorText()}))}},t.prototype.initializeExplorationTheme=function(e){return s.loadThemeAndBaseTheme(this.services.promiseFactory,this.services.resourceLoader,this.services.themeService,e.resourcePackages,i.isLegacyThemeName(e.theme)?void 0:e.theme,e.baseTheme,this.services.featureSwitchService.featureSwitches.loadBaseTheme).then((function(){return e}))},t.prototype.resolveExplorationWithoutResourcePackage=function(t,i){var o=this.scope.viewModel,r=t.sections,a=r.length,s=[];this.services.explorationNavigation.loadExploration(t);for(var c=0;c<a;c++)r[c].crossHighlight=void 0,s[c]={contract:r[c],selected:!0,displayName:r[c].displayName};if(void 0===i)return void this.setErrorText();var l=e.explore.SectionUtils.findSectionById(t,i);if(!l)return void this.setErrorText();this.services.explorationNavigation.goto(l);for(var d=new e.explore.viewModels.ExploreCanvas(l),p=jsCommon.ArrayExtensions.createWithId(),u=l.visualContainers.length,c=0;c<u;c++){var h=e.explore.viewModels.ViewModelFactory.convertVisualContainer(t,d.contract,l.visualContainers[c],0);h.allowDeferredRendering=!0,h.options=this.services.explorationCapabilities.getCapabilities().visualContainerOptions,p.push(h)}d.visualContainers=p,o.exploration={contract:t,exploreCanvas:d,sections:s},o.isLoading=n.isTileLoading(o.contract)},t.prototype.setDataSources=function(t,i){var o=i.dataSources.withId(t.id);if(!o){var r=e.explore.constants.DefaultSchemaName;if(o={type:e.common.constants.dsrDataReaderType,id:t.id,name:e.explore.constants.DefaultSchemaName,dsr:{schemaName:e.explore.constants.DefaultSchemaName,vsName:t.vsName,dbName:t.dbName,modelId:t.id}},i.dataSources.push(o),this.services.featureSwitchService.featureSwitches.reportMeasures){var a=e.explore.constants.ExplorationSchemaName;i.dataSources.push({type:e.explore.dataReaderPlugins.ExplorationDataReaderType,id:i.id,name:a,extends:r,exploration:{schemaName:a,extends:r,getModelExtensions:function(){return i.modelExtensions}}})}}var n=i.dataSources;this.services.dataSources.set(n)},t.prototype.setErrorText=function(){var e=this.scope.viewModel;e.isError=!0,e.errorText=this.services.localizationService.get("ReportTile_DataUnavailable")},t.getReferencedResourcePackages=function(e,i){var o=t.getReferencedVisualsInSection(e,i);if(!_.isEmpty(o))return _.filter(e.resourcePackages,(function(e){return 0===e.type&&o[e.name]}))},t.getReferencedVisualsInSection=function(e,t){var i=e.sections,o={};if(_.isEmpty(i))return o;for(var r=0,a=i;r<a.length;r++){var n=a[r];if(n.id===t){_.map(n.visualContainers,(function(e){var t=e&&e.config&&e.config.singleVisual&&e.config.singleVisual.visualType;_.isEmpty(t)||(o[t]=!0)}));break}}return o},t})();t.ReportTileController=l})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.element=t}return e})();e.SsrsTileController=t})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=jsCommon.UrlUtils,o=(function(){function t(e,t){var i=this;this.scope=e,this.services=t,this.scope.workbookTileUrl=this.workbookTileUrl,this.scope.workbookTileImageUrl=this.workbookTileImageUrl,this.scope.useLiveEwaControl=!!this.services.featureSwitchService.featureSwitches.liveWorkbookTiles;var o=this.scope.$watch("viewModel.tileModel.size",(function(){return i.services.workbookService.setModelDynamicImageUrl(i.scope.viewModel)}),!0),r=this.scope.$watch("viewModel",(function(){return i.services.workbookService.setModelDynamicImageUrl(i.scope.viewModel)}));this.scope.$on("$destroy",(function(){o(),r()})),this.initWorkbookTile()}return t.createOptions=function(){return{additionalServices:["$sce","workbookService","featureSwitchService"]}},t.prototype.constructWorkbookWopiUrl=function(e,t){if(this.scope.viewModel.contract.$config.workbookTile){var i=e.replace(/ExcelJs.ashx/i,"xlEmbed.aspx");return i=i+"&access_token="+t+"&item="+this.scope.viewModel.contract.$config.workbookTile.item+"&action=embedView"}return""},t.prototype.shouldPreparePreviewImage=function(){return!this.scope.viewModel.previewImageUrl&&!this.scope.viewModel.image&&!this.scope.viewModel.hasImages()},t.prototype.initWorkbookTile=function(){var t=this;this.scope.viewModel.isLoading=!0,this.shouldPreparePreviewImage()&&this.services.workbookService.getWorkbookTilePreviewImageUrl(this.scope.viewModel.contract).then((function(i){var o=i.indexOf("?")===-1?"?":"&";t.scope.viewModel.previewImageUrl=i+o+(new Date).getTime(),t.services.workbookService.setModelDynamicImageUrl(t.scope.viewModel),t.scope.onTileImageReady((function(i){t.scope.viewModel.isLoading=!1;var o=e.dataServices.ContractUtils.getMasterLayoutPosition(t.scope.viewModel.contract);o.width=Math.min(e.common.models.gridLayoutConstants.gridDefaultCols,e.common.GridLayoutConstants.getDefaultColSpanFromWidth(i.width)),o.height=Math.min(e.common.models.gridLayoutConstants.gridMaxRowSpan,e.common.GridLayoutConstants.getDefaultRowSpanFromHeight(i.height))}))})),this.scope.useLiveEwaControl&&this.services.workbookService.getWorkbookEmbedAccessData(this.scope.viewModel.contract.workbookId,this.scope.viewModel.contract.packageId).then((function(e){if(e&&i.isValidHttpUrl(e.url)){var o=t.constructWorkbookWopiUrl(e.url,e.accessToken);t.scope.workbookTileUrl=t.services.$sce.trustAsResourceUrl(o)}}))},t})();t.WorkbookTileController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.constants,o=e.common.constants.tileActions,r=e.dataServices.models.Tile,a=e.models.factory.TileOptionsFactory,n=e.dataServices.TileUtils,s=e.dataServices.contracts.TileType,c=(function(){function t(t,o){var r=this;this.scope=t,this.services=o,this.model=t.viewModel,this.tileId="tile"+this.model.id,this.updateTileHref(),this.scope.hasWarning=function(){return r.hasWarning()},this.scope.shouldShowTileVisual=function(){return r.shouldShowTileVisual()},this.scope.$watchCollection("viewModel.action",(function(){return r.updateTileHref()}));var a=this.services.rootScope.$on(i.reportDeletedEventName,(function(e,t){r.model.report&&r.model.report.id===t&&(r.model.report=null)}));this.scope.$on(e.common.constants.scopeDestroyEventName,(function(){a()})),this.updateModelTileHeaderSize(),this.scope.$root.$on(e.common.constants.needStrategySwapEventName,(function(){r.updateModelTileHeaderSize()})),this.scope.$on(e.common.constants.tileErrorEventName,(function(t,i,o){r.scope.isError=!0,r.scope.errorText=i,r.scope.errorDetails=o||{message:r.scope.errorText,displayableErrorInfo:[]},r.model.resetTileErrors=function(){r.scope.isError=!1},r.scope.$emit(e.constants.dashboardTileErrorEventName,r.model,r.scope.errorDetails)})),this.scope.$on(e.common.constants.clearTileErrorEventName,(function(t){var i=r.scope.errorDetails;r.scope.isError&&i&&r.scope.$emit(e.constants.removeDashboardTileErrorEventName,r.model,i),r.model.resetTileErrors&&r.model.resetTileErrors()})),this.services.rootScope.$on(e.constants.rowLevelSecurityAccessDeniedEventName,(function(e,t){r.model.composite&&_.find(t,(function(e){return r.scope.viewModel.contract.modelId===e}))&&(r.scope.isError=!0,r.scope.errorText=r.services.localizationService.get("Tile_RLS_NoAccess"),r.model.composite.tileData.data=null,r.model.resetTileErrors=function(){r.scope.isError=!1})})),this.scope.getUnseenCount=function(){return r.getUnseenCount()},this.scope.getIcons=function(){return r.getIcons()},this.scope.getWebContentIcon=function(){return r.getWebContentIcon()},this.scope.onIconClick=function(e,t){return r.onIconClick(e,t)}}return t.createOptions=function(){return{additionalServices:["localizationService","userInfo","visualPlugin","dashboardDataService","modelService","userNotificationInfo","featureSwitchService","userNotificationTileFilterService","tileDisplay","errorService","gridLayout","licenseEnforcementService"],scopedDependencies:["scriptVisuals"]}},t.prototype.updateTileHref=function(){this.model.intraDomainNavigationParameters=null;var t=this.model.action;t.action===o.custom.openUrlActionName&&r.isValidUrl(t.targetUrl,!0)?this.scope.$emit(e.constants.updateTileHrefEventName,this.model,t.targetUrl):this.model.href=void 0},t.prototype.hasLostReportConnection=function(){var e="bingSocial",t=this.scope.viewModel,i=t.action;return t.type===s.composite&&i&&!(i.action&&i.action===o.openQnAActionName)&&(!i.action||i.action===o.openReportActionName&&!t.report)&&t.contract.name!==e&&!t.config.widget},t.prototype.hasWarning=function(){var e=this.services.visualPlugin,t=this.services.userInfo,i=this.scope.viewModel;if(this.scope.isError&&this.services.tileDisplay.isVisualSupportedInErrorState(i)){var o=i.composite;return this.scope.warning={tooltip:this.services.localizationService.format("DashboardAppBar_TileError_ErrorTooltip",[o.errorText])},!0}if(n.tileContainsScriptVisuals(this.scope.viewModel,e)){if(this.services.scriptVisuals.shouldBlockScriptVisual()){var r=t&&!Array.isArray(t)&&this.services.licenseEnforcementService.supportsScriptVisuals();return this.scope.warning={tooltip:r&&this.services.localizationService.get("Tile_RVis_RefreshDisabled")||this.services.localizationService.get("Tile_RVis_RefreshDisabledForNonPro")},!0}}else{if(this.hasLostReportConnection())return this.scope.warning={tooltip:this.services.localizationService.get("Tile_LoseReportConnection")},!0;if(this.scope.viewModel.errorCode)return this.scope.warning={tooltip:this.model.details.getErrorLocId(this.model.errorCode,this.services.localizationService)},!0}return!1},t.prototype.getUnseenCount=function(){var e=this.scope.viewModel.contract.id,t=this.services.userNotificationInfo;if(!e||!t||!t.userNotifications||_.isEmpty(t.userNotifications.notifications))return 0;var i=t.userNotifications.notifications,o=_.filter(this.services.userNotificationTileFilterService.filterNotifications(i,e),(function(e){return!e.seen}));return o.length},t.prototype.onIconClick=function(e,t){t.stopPropagation();var i=this.scope;switch(e.action){case 0:this.scope.headerClickTarget({event:t,openNotification:!0});break;case 2:this.services.tileDisplay.onErrorIconClicked({message:e.tooltip()});break;case 1:this.services.tileDisplay.onErrorIconClicked({isError:i.isError,errorTitle:i.errorText,errorDetails:i.errorDetails,message:e.tooltip()})}},t.prototype.getIcons=function(){var t=this;if(this.icons)return this.icons;var i={badgeTextSetter:this.getUnseenCount.bind(this),localizationService:this.services.localizationService,showNotifications:function(){return t.getUnseenCount()>0},showWarning:this.hasWarning.bind(this),showWebContent:function(){var e=t.scope.viewModel;return e&&e.type===s.iframe&&!e.isTemporary&&e.hasTitle()},showRealTime:function(){var e=t.scope.viewModel;return e&&e.type===s.realTime},warningToolTipSetter:function(){return t.scope.warning&&t.scope.warning.tooltip}};return this.icons=a.getDashboardTileIcons(i),i.showWarning()&&this.scope.$emit(e.constants.dashboardTileErrorEventName,this.model,{message:i.warningToolTipSetter(),displayableErrorInfo:[]}),this.icons},t.prototype.getWebContentIcon=function(){return _.find(this.getIcons(),(function(e){return 2===e.action}))},t.prototype.shouldShowTileVisual=function(){return!!this.services.tileDisplay.shouldShowTileVisual(this.scope.viewModel)&&(!this.scope.isError||this.services.tileDisplay.isVisualSupportedInErrorState(this.scope.viewModel))},t.prototype.updateModelTileHeaderSize=function(){var e=1;this.services.gridLayout.strategy.isDynamic()||this.services.dashboardDataService.InEditMobileLayoutMode?e=2:this.scope.largeHeader&&(e=0),this.model.setTileHeaderSize(e)},t})();t.Tile=c})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.scope=e,this.services=t,this.loadUserMetadata()}return t.createOptions=function(){return{additionalServices:["groupService","featureSwitchService","userInfo","localizationService"]}},t.prototype.loadUserMetadata=function(){this.scope.viewModel.userName=e.session.UserInfoUtils.getFullName(),this.services.groupService.activeGroup?(this.scope.viewModel.activeGroup=this.services.groupService.activeGroup,this.scope.viewModel.isMyWorkspace=this.scope.viewModel.activeGroup.isMyWorkspace):this.scope.viewModel.isMyWorkspace=!0,this.scope.viewModel.isPremiumUser=this.services.userInfo.isPremiumUser,this.scope.viewModel.userHasFreeTrial=this.services.userInfo.userHasFreeTrial,this.scope.viewModel.userHasPremiumPlan=this.services.userInfo.userHasPremiumPlan},t})();t.UserGroupHeaderController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t){this.scope=t,t.userName=e.session.UserInfoUtils.getFullName()}return t})();t.UserInfoController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t){var i=this;this.scope=t,this.scope.onYesClick=function(){return i.scope.viewModel.onButtonClick(e.models.WarningBarResult.Yes)},this.scope.onNoClick=function(){return i.scope.viewModel.onButtonClick(e.models.WarningBarResult.No)},this.scope.onFixItClick=function(){return i.scope.viewModel.onButtonClick(e.models.WarningBarResult.FixIt)}}return t})();t.WarningBarController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=e.common.helpers.ModelConverterHelper,r=e.dataServices.constants.workbook,a="WorkbookAppBar_DataRefreshNotSupported_LocalFile_Tooltip",n="WorkbookAppBar_DataRefreshNotSupported_SharedWorkbooks_Tooltip",s="WorkbookAppBar_DataRefreshNotSupported_NoModel_Tooltip",c="WorkbookAppBar_DataRefreshNotSupported_PowerPivotVersion_Tooltip",l="WorkbookAppBar_DataRefreshNotSupported";!(function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure",e[e.NotSupported=2]="NotSupported",e[e.MissingData=3]="MissingData"})(i=t.DataRefreshStatus||(t.DataRefreshStatus={}));var d;!(function(e){e[e.Supported=0]="Supported",e[e.NotSupportedNotOwned=1]="NotSupportedNotOwned",e[e.NotSupportedLocalWorkbook=2]="NotSupportedLocalWorkbook",e[e.NotSupportedNoModel=3]="NotSupportedNoModel",e[e.NotSupportedPowerPivotOldVersion=4]="NotSupportedPowerPivotOldVersion"})(d||(d={}));var p;!(function(e){e[e.Supported=0]="Supported",e[e.NotSupportedNotOwned=1]="NotSupportedNotOwned",e[e.NotSupportedLocalWorkbook=2]="NotSupportedLocalWorkbook",e[e.NotSupportedNotLoaded=3]="NotSupportedNotLoaded",e[e.StatusNotKnown=4]="StatusNotKnown"})(p||(p={}));var u=(function(){function t(e,t){var i=this;this.scope=e,this.services=t,this.model=this.scope.viewModel,this.services.localizationService.ensureLocalization((function(){i.bindMenuActions()})),this.scope.inAppArtifactView=function(){return i.services.conceptualModelSetting.isAppsEnabled()&&i.services.navigation.inAppArtifactView()}}return t.createOptions=function(){return{additionalServices:["localizationService","featureSwitchService","modelService","historyDialogService","packageService","telemetryService","navigation","conceptualModelSetting"]}},t.prototype.isEditEnabled=function(){return this.model.workbook&&this.getEditSupportedStatus(this.model.workbook)===p.Supported},t.prototype.isWorkbookLoaded=function(){return this.model&&this.model.workbookLoaded},t.prototype.bindMenuActions=function(){var e=this,i=this.scope,o=t.WorkbookAppBarActions;i.editMenuActions=[{text:this.services.localizationService.get("WorkbookAppBar_EditInExcel"),description:this.services.localizationService.get("WorkbookAppBar_EditInExcelDescription"),action:o.EditInExcel,itemClass:"editInExcel",type:DropDownMenuItemType.Item},{text:this.services.localizationService.get("WorkbookAppBar_EditInExcelOnline"),description:this.services.localizationService.get("WorkbookAppBar_EditInExcelOnlineDescription"),action:o.EditInExcelOnline,itemClass:"editInExcelOnline",type:DropDownMenuItemType.Item}],i.dataMenuActions=[{text:this.services.localizationService.get("WorkbookAppBar_Calculate"),description:this.services.localizationService.get("WorkbookAppBar_CalculateDetails"),action:o.Calculate,itemClass:"calculate",type:DropDownMenuItemType.Item}],i.editMenuActionSelected=function(t){return e.onEditMenuActionSelected(t)},i.dataMenuActionSelected=function(t){return e.onDataMenuActionSelected(t)},i.pinClicked=function(){return e.pinClicked()},i.reloadClicked=function(){return e.reloadClicked()},i.isPinToDashboardEnabled=function(){return e.isPinToDashboardEnabled()},i.getPinButtonTooltipLocId=function(){return e.getPinButtonTooltipLocId()},i.isWorkbookLoaded=function(){return e.isWorkbookLoaded()},i.isEditEnabled=function(){return e.isEditEnabled()},i.getEditButtonTooltipLocId=function(){return e.getEditButtonTooltipLocId()},i.getRefreshDataStatus=function(){return e.updateLastRefreshInformationAndGetStatus()}},t.prototype.onEditMenuActionSelected=function(e){var i=t.WorkbookAppBarActions;switch(e.action){case i.EditInExcelOnline:this.EditInExcelOnline();break;case i.EditInExcel:this.EditInExcel()}},t.prototype.onDataMenuActionSelected=function(e){var i=t.WorkbookAppBarActions;switch(e.action){case i.Calculate:this.CalculateClicked()}},t.prototype.CalculateClicked=function(){this.services.telemetryService.logEvent(e.telemetry.DashboardCalculateWorkbook),this.scope.$emit(t.Events.CalculateWorkbookClicked)},t.prototype.EditInExcelOnline=function(){this.scope.$emit(t.Events.EditInExcelOnlineClicked)},t.prototype.EditInExcel=function(){this.scope.$emit(t.Events.EditInExcelClicked)},t.prototype.pinClicked=function(){this.scope.$emit(t.Events.PinClicked)},t.prototype.reloadClicked=function(){this.services.telemetryService.logEvent(e.telemetry.DashboardReloadWorkbook),this.scope.$emit(t.Events.ReloadClicked)},t.prototype.getDataRefreshSupportStatus=function(e){return e.isOwner()?e.contract.modelId?e.contract.isPowerPivotVersionSupportsRefresh?d.Supported:d.NotSupportedPowerPivotOldVersion:d.NotSupportedNoModel:d.NotSupportedNotOwned},t.prototype.getEditSupportedStatus=function(e){return this.model.workbookLoaded&&e.isEditable()?p.Supported:this.model.workbookLoaded?e.isOwner()?this.services.packageService.isLocalWorkbook(e.packageId)?p.NotSupportedLocalWorkbook:p.StatusNotKnown:p.NotSupportedNotOwned:p.NotSupportedNotLoaded},t.prototype.isPinToDashboardEnabled=function(){return this.model.workbook.isOwner()&&this.isWorkbookLoaded()},t.prototype.getPinButtonTooltipLocId=function(){return this.model.workbookLoaded?this.model.workbook.isOwner()?this.model.workbookChanged?"WorkbookAppBar_PinTooltip_Disabled_WorkbookChanged":this.model.workbookRangeSelected?"WorkbookAppBar_PinTooltip_Enabled":"WorkbookAppBar_PinTooltip_Disabled_NoSelection":"WorkbookAppBar_PinTooltip_NotOwner":""},t.prototype.getEditButtonTooltipLocId=function(){var e,t=this.getEditSupportedStatus(this.model.workbook);switch(t){case p.Supported:e="";break;case p.NotSupportedNotLoaded:e="";break;case p.NotSupportedLocalWorkbook:e="WorkbookAppBar_EditToolTip_NotEditable_Local";break;case p.NotSupportedNotOwned:e="WorkbookAppBar_EditToolTip_NotEditable_NotOwned";break;case p.StatusNotKnown:e=""}return e},t.prototype.updateLastRefreshInformationAndGetStatus=function(){if(!this.model||!this.model.workbook)return i.MissingData;var t=this.getDataRefreshSupportStatus(this.model.workbook);if(t!==d.Supported){var o=void 0;switch(t){case d.NotSupportedLocalWorkbook:o=a;break;case d.NotSupportedNotOwned:o=n;break;case d.NotSupportedNoModel:o=s;break;case d.NotSupportedPowerPivotOldVersion:o=c;break;default:o=""}return this.scope.refreshNotSupportedTooltip={tooltipLocalizeDescription:o,tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft},this.scope.refreshInformationText=this.services.localizationService.get(l),i.NotSupported}var r=this.services.modelService.findModel(this.model.workbook.modelId,this.model.workbook.packageId);return r?this.getLastRefreshText(r.contract):i.MissingData},t.prototype.getLastRefreshText=function(t){var r,a,n=this;if(t.lastRefreshStatus===e.common.contracts.PublishOrRefreshStatus.RefreshError){r=this.services.localizationService.get("WorkbookAppBar_LastDataRefreshFailed"),a=i.Failure;var s={};s.dataset=o.convertModelToDataset(t),this.scope.showRefreshHistory=function(){return n.services.historyDialogService.showHistoryDialog(s)}}else if(t.lastRefreshStatus===e.common.contracts.PublishOrRefreshStatus.PublishError)a=i.MissingData,r="";else{var c=o.convertRefreshTimeToLocaleString(t.lastRefreshTime);a=i.Success,r=this.services.localizationService.format("WorkbookAppBar_LastDataRefreshSucceded",[c])}return this.scope.refreshInformationText=r,a},t.WorkbookAppBarActions={Calculate:"Calculate",EditInExcel:"EditInExcel",EditInExcelOnline:"EditInExcelOnline",Pin:"Pin",Reload:"Reload"},t.Events={PinClicked:r.pinClickedEventName,EditInExcelOnlineClicked:r.editInExcelOnlineClickedEventName,EditInExcelClicked:r.editInExcelClickedEventName,CalculateWorkbookClicked:r.calculateWorkbookClickedEventName,ReloadClicked:r.reloadExcelWorkbookEventName},t})();t.WorkbookAppBarController=u})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.constants,o=e.dataServices.EwaNamedItemType,r=e.common.constants.tileActions,a=e.dataServices.contracts.TileType,n=(function(){function e(e,t,i){this.workbook=e,this.range=t,this.promiseFactory=i}return e.prototype.getTileData=function(){return this.getTileDataDeferred=this.promiseFactory.defer(),this.verifyIntersections(0),this.getTileDataDeferred.promise},e.prototype.verifyIntersections=function(e){var t=this,i=this.workbook.getNamedItems();if(e>=i.getCount()){var r={elementName:this.range.getAddressA1(),elementRange:this.range.getAddressA1(),smartSelection:!1,sheetName:this.range.getSheet().getName()};return void this.getTileDataDeferred.resolve(r)}var a=i.getItem(e),n=a.getNamedItemType();return n!==o.NamedRange&&n!==o.Table&&n!==o.PivotTable?void this.verifyIntersections(e+1):void a.getRefersToRangeAsync((function(e){return t.verifyNamedItemIntersection(e)}),e)},e.prototype.verifyNamedItemIntersection=function(e){var t=e.getReturnValue(),i=e.getUserContext();if(this.rangesIntersect(this.range,t)){var o={elementName:this.workbook.getNamedItems().getItem(i).getName(),elementRange:t.getAddressA1(),smartSelection:!0,namedItemType:this.workbook.getNamedItems().getItem(i).getNamedItemType(),sheetName:this.workbook.getActiveSheet().getName()};return void this.getTileDataDeferred.resolve(o)}this.verifyIntersections(i+1)},e.prototype.rangesIntersect=function(e,t){return null!=e&&null!=t&&(e.getSheet()===t.getSheet()&&e.getRow()===t.getRow()&&e.getRowCount()===t.getRowCount()&&e.getColumn()===t.getColumn()&&e.getColumnCount()===t.getColumnCount())},e})(),s=(function(){function e(e,t,i){this.workbook=e,this.item=t,this.promiseFactory=i}return e.prototype.getTileData=function(){var e=this,t=this.promiseFactory.defer(),i=this.item.getNamedItemType();if(i===o.NamedRange||i===o.Table||i===o.PivotTable)this.item.getRefersToRangeAsync((function(o){var r=o.getReturnValue(),a={elementName:e.item.getName(),elementRange:r.getAddressA1(),smartSelection:!1,namedItemType:i,sheetName:r.getSheet().getName()};t.resolve(a)}),void 0);else{var r={elementName:this.item.getName(),elementRange:this.workbook.getActiveSheet().getRange(0,0,1,1).getAddressA1(),smartSelection:!1,namedItemType:i,sheetName:this.workbook.getActiveSheet().getName()};t.resolve(r)}return t.promise},e})(),c=(function(){function o(t,i){var r=this;this.scope=t,this.services=i,this.scope.appBarArgs={selection:null},this.resetSelectionArgs(),this.unsubscribeList=[],this.subscribeToAppBarEvents(),this.setWorkbookAppBarIfNeeded(),this.scope.isEmbeddedWorkbookReady=!1,this.scope.embeddedWorkbookFailed=!1,this.scope.isEmbeddedWorkbookDataReady=!1,this.scope.dismissToast=function(){e.models.WorkbookContainer.DiscoverabilityToastDismissed=!0;var t=r.services.telemetryService.startEvent(e.telemetry.DashboardWorkbookPinabilityShown);r.services.tutorialDataStore.setKey(o.WorkbookPinToastShown,!0,t),r.scope.viewModel.showDiscoverabilityToast=!1},this.scope.showPinDashboardDialog=function(){return r.showPinDashboardDialog()};var a;this.services.groupService.groupSwitchPromise().then((function(){r.services.workbookService.ensureWorkbookInitialization().then((function(){r.navigateToWorkbookPage(),a=r.scope.$on(e.common.constants.navigation.stateChangeSuccess,(function(e,t,i,o,a){return r.handleStateChange(t,i,o,a)}))}))})),this.scope.$on("$destroy",(function(){r.unsubscribeToAppBarEvents(),a&&a()}))}return o.createOptions=function(){return{additionalServices:["$rootScope","$window","applicationOptions","contentProviderHttpService","dashboardHttpService","dashboardService","errorService","featureSwitchService","groupService","localizationService","modelConverter","mostRecentlyUsedService","navigation","notificationToast","packageService","permissionService","pinTileService","promiseFactory","telemetryService","tutorialDataStore","workbookService"]
}},o.prototype.handleStateChange=function(t,i,o,r){t.name===e.common.constants.navigation.states.workbook&&this.navigateToWorkbookPage()},o.prototype.resetSelectionArgs=function(){this.scope.appBarArgs.selection=void 0},o.prototype.navigateToWorkbookPage=function(){var t,o=this.services.navigation.currentWorkbookURLIdentifier;if(t=this.services.workbookService.findWorkbookByEtagHash(o),t||(t=this.services.workbookService.findWorkbookByUniqueId(o)),!t)return this.services.mostRecentlyUsedService.removeMRU(o),e.helpers.ArtifactNotFoundHelper.showArtifactDoesNotExistDialog("ArtifactKind_Workbook",this.services.errorService,this.services.localizationService,this.services.telemetryService),void this.services.navigation.navigateToContentListOrActiveDashboard();this.scope.$emit(i.workbook.bindToExcelWorkbookEventName,t);var r=t.contract.packageId,a=this.services.groupService.activeGroup,n=a&&a.aadGroupId;this.services.mostRecentlyUsedService.updateMRU(e.models.MRUArtifactType.Workbooks,t.uniqueId,t.displayName,t.getPermissions(),n,t.uniqueId,r);var s=this.services.navigation.currentWorkbookActiveSelection;this.onLoadExcelWorkbook(t,s)},o.prototype.subscribeToAppBarEvents=function(){var i=this,o=this.scope,r=o.$on(t.WorkbookAppBarController.Events.PinClicked,(function(e){return i.pinButtonResponse()}));this.unsubscribeList.push(r);var a=o.$on(t.WorkbookAppBarController.Events.EditInExcelOnlineClicked,(function(e){return i.openWorkbookInExcelOnline()}));this.unsubscribeList.push(a);var n=o.$on(t.WorkbookAppBarController.Events.EditInExcelClicked,(function(e){return i.openWorkbookInExcel()}));this.unsubscribeList.push(n);var s=this.services.rootScope.$on(e.constants.groupSwitchedEventName,(function(){return i.setWorkbookAppBarIfNeeded()}));this.unsubscribeList.push(s);var c=this.services.rootScope.$on(t.WorkbookAppBarController.Events.CalculateWorkbookClicked,(function(){return i.calculateWorkbook()}));this.unsubscribeList.push(c);var l=this.services.rootScope.$on(t.WorkbookAppBarController.Events.ReloadClicked,(function(){return i.onLoadExcelWorkbook(i.scope.viewModel.workbook,null)}));this.unsubscribeList.push(l)},o.prototype.unsubscribeToAppBarEvents=function(){var e=-1,t=this.unsubscribeList.length;if(t){for(e=t;t;)this.unsubscribeList[--t]();this.unsubscribeList.splice(0,e)}},o.prototype.embedWorkbook=function(t,i,r){var a=this,n=this.scope.viewModel.workbook.contract,s=!!n.modelId;this.services.workbookService.embedWorkbook(n.etagHash,this.scope.getEwaTargetWindow(),t.url,t.accessToken,t.accessTokenTtl,this.services.packageService.getWorkbookStorageProvider(n.packageId),this.services.packageService.getWorkbookContentProvider(n.packageId),n.permissions,s,i).then((function(t){a.scope.isEmbeddedWorkbookReady=!0,t.ewaControl&&(e.models.WorkbookContainer.DiscoverabilityToastDismissed=a.services.tutorialDataStore.hasKey(o.WorkbookPinToastShown),a.scope.viewModel.showDiscoverabilityToast=a.scope.workbookAppBarIncluded,a.onEwaApplicationReady(t)),r.resolve()}),(function(){r.reject(),a.scope.viewModel.workbook=null,a.scope.embeddedWorkbookFailed=!0}))},o.prototype.onWopiDataError=function(t,i){var o=this.services.$window,r=this.services.telemetryService,a=this.services.navigation;this.services.errorService.error(this.services.localizationService.get("Workbook_FailToEmbedWorkbookMessage"),"Workbook_FailToEmbedWorkbook",{title:this.services.localizationService.get("Workbook_FailToEmbedWorkbookTitle"),dismissCallback:function(n){"openInXL"===n&&(r.logChildEvent(i,e.telemetry.DashboardWorkbookViewedExternallyDueToAnError,t.contract.etagHash),o.open(t.viewUrl,"_blank")),a.navigateBack()},dialogOptions:[{label:this.services.localizationService.get("Workbook_FailToEmbedWorkbookActionOpenInExcel"),resultValue:"openInXL"},{label:this.services.localizationService.get("PowerViewError_Close"),resultValue:"close"}]})},o.prototype.ensureExpressionApplied=function(e){var t=this,i=this.services.promiseFactory.defer();return this.services.timeout((function(){var o=e();t.services.timeout((function(){i.resolve(o)}),0,!1)})),i.promise},o.prototype.getWopiAccessData=function(e,t){return this.services.workbookService.getWorkbookEmbedAccessData(e.id,e.packageId,t)},o.prototype.loadExcelWorkbook=function(t,i){var o=this,r=this.services.telemetryService,a=r.startEvent(e.telemetry.DashboardViewWorkbook,t.contract.etagHash,t.getPermissions(),this.services.packageService.getWorkbookStorageProvider(t.packageId),this.services.packageService.getWorkbookContentProvider(t.packageId));this.getWopiAccessData(t,a.event).then((function(e){o.ensureExpressionApplied((function(){o.scope.isEmbeddedWorkbookDataReady=!0})).then((function(){o.embedWorkbook(e,i,a)}))}),(function(){o.onWopiDataError(t,a.event),o.scope.viewModel.workbook=null,a.reject()}))},o.prototype.setWorkbookAppBarIfNeeded=function(){this.scope.workbookAppBarIncluded=!this.services.permissionService.isActiveWorkspaceIsReadOnly},o.prototype.calculateWorkbook=function(){this.workbook.recalcAsync()},o.prototype.onLoadExcelWorkbook=function(e,t){var i=this;this.resetSelectionArgs(),this.scope.viewModel.workbook=e,this.scope.viewModel.workbookRangeSelected=!1,this.scope.viewModel.workbookChanged=!1,this.scope.viewModel.workbookLoaded=!1,this.scope.viewModel.loadedWorkbookOrdinal=e.contract.etagOrdinal,this.workbook=null,this.scope.isEmbeddedWorkbookDataReady=!1,this.scope.isEmbeddedWorkbookReady=!1,this.scope.embeddedWorkbookFailed=!1,this.anyWorkbookChangesOccurred=!1,this.ensureExpressionApplied((function(){})).then((function(){i.loadExcelWorkbook(e,t)}))},o.prototype.openWorkbookInExcel=function(){this.services.$window.open("ms-excel:ofe|u|"+this.scope.viewModel.workbook.contract.sourceFilePath,"_self")},o.prototype.openWorkbookInExcelOnline=function(){this.services.$window.open(this.scope.viewModel.workbook.editUrl,"_blank")},o.prototype.showPinDashboardDialog=function(){var t=this;this.scope.appBarArgs.selection&&this.scope.appBarArgs.selection.getTileData().then((function(o){var n={item:o.elementName,itemType:o.namedItemType,hideGridlines:!1,hideRowAndColumnHeaders:!0,allowTyping:!1,activeSelection:o.elementRange,keepOriginalContentSize:i.workbook.defaultKeepOriginalContentSize,sheetName:o.sheetName.replace(/\'/g,"''")},s={version:e.dataServices.constants.upgrader.TileConfigVersion,workbookTile:n},c={action:r.openWorkbookActionName},l=s.workbookTile.item,d=t.scope.viewModel.workbook,p=e.dataServices.ContractUtils.createMasterLayoutConfig({width:e.common.GridLayoutConstants.gridItemMediumLandscapeColSpan,height:e.common.GridLayoutConstants.gridItemMediumLandscapeRowSpan}),u={type:a.workbook,workbookId:t.scope.viewModel.workbook.id,packageId:t.scope.viewModel.workbook.contract.packageId,displayText:t.services.workbookService.getDefaultTileTitle(s.workbookTile,d.contract.displayName),subDisplayText:t.services.workbookService.getDefaultTileSubtitle(l),config:JSON.stringify(s),$config:s,action:JSON.stringify(c),layoutConfig:JSON.stringify(p),$layoutConfig:p};t.services.modelConverter.resolveTilePackage(u,t.services.packageService.packages);var h=t.services.packageService.getWorkbookContentProvider(d.packageId),v=e.common.findContentProviderName(t.services.contentProviderHttpService.getBuiltInContentProviders(),h),g=t.services.telemetryService.startEvent(e.telemetry.DashboardPinTile,"",e.telemetry.PinTileSource.Workbook,"",!1,v,!1,"",!1);t.services.pinTileService.showPinVisualDialog(void 0,void 0,void 0,t.scope.viewModel.workbook.contract,g,u)}))},o.prototype.onEwaApplicationReady=function(e){var t=this;this.resetSelectionArgs();var i=e.ewaControl;this.workbook=i.getActiveWorkbook(),i.add_activeSelectionChanged((function(e){return t.onWorkbookSelectionChange(e)})),i.add_workbookChanged((function(e){return t.onWorkbookChanged(e)})),this.scope.viewModel.workbookLoaded=!0,this.scope.appBarArgs.selection=new n(this.workbook,i.getActiveWorkbook().getActiveSelection(),this.services.promiseFactory)},o.prototype.onWorkbookSelectionChange=function(e){var t=this;if(this.scope.viewModel.workbookRangeSelected=!0,0===e.getSelectionType()){var i=e;this.scope.$applyAsync((function(){return t.scope.appBarArgs.selection=new n(t.workbook,i.getRange(),t.services.promiseFactory)}))}else if(1===e.getSelectionType()){var o=e;this.scope.$applyAsync((function(){return t.scope.appBarArgs.selection=new s(t.workbook,o.getNamedItem(),t.services.promiseFactory)}))}},o.prototype.onWorkbookChanged=function(t){var i=this.scope.viewModel;!this.anyWorkbookChangesOccurred&&i.workbookRangeSelected&&(this.services.telemetryService.logEvent(e.telemetry.DashboardWorkbookEditedInPowerBICausedPinBlock),this.anyWorkbookChangesOccurred=!0),i.workbookChanged||(i.workbookChanged=!0,this.scope.$digest())},o.prototype.pinButtonResponse=function(){if(this.scope.viewModel.workbookChanged)this.services.pinTileService.pinTileScenario=0,this.showPinDashboardDialog();else if(this.scope.viewModel.workbookRangeSelected||this.services.applicationOptions.isE2ERun)this.services.pinTileService.pinTileScenario=2,this.showPinDashboardDialog();else{this.services.pinTileService.pinTileScenario=1;var e=this.services.localizationService.get("PinTile_RangeNotSelected"),t=this.services.localizationService.get("PinTile_RangeNotSelected_Title");this.services.errorService.infoCustom(t,e)}},o.WorkbookPinToastShown="workbookPinToastShown",o})();t.WorkbookContainerController=c})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this.scope=e,this.services=t}return t.createOptions=function(){return{additionalServices:["asyncFeatureSwitchService","fullScreen","impersonationService","modelConverter","navigation","rtl","taskPaneSliderService","userNotificationInfo","$state","shellCapabilities","$rootScope"]}},t.prototype.$onInit=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o,r=this;return __generator(this,(function(a){switch(a.label){case 0:return this.initializeViewModel(),t=this.services,[4,t.asyncFeatureSwitchService.getFeatureSwitches()];case 1:return a.sent(),[4,t.shellCapabilities.ensureCapabilitiesInitialized()];case 2:return a.sent(),this.impersonation=t.impersonationService,this.navigation=t.navigation,this.navigationPaneSide=t.rtl.isRtlLayout?"right":"left",i=this.scope,i.$watch((function(){return t.userNotificationInfo.showPane}),(function(e){i.$applyAsync((function(){r.handleNotificationPane(e)}))})),o=t.$state.current,o&&!_.isEmpty(o.name)?(this.isInitialized=!0,this.showNavPane=t.shellCapabilities.getCapabilities().showNavPane):this.unregisterStateChangeSuccessListener=t.$rootScope.$on(e.common.constants.navigation.stateChangeSuccess,(function(e,i,o,a,n){r.isInitialized=!0,r.showNavPane=t.shellCapabilities.getCapabilities().showNavPane,r.unregisterStateChangeListener()})),[2]}}))}))},t.prototype.$onDestroy=function(){this.unregisterStateChangeListener()},t.prototype.unregisterStateChangeListener=function(){this.unregisterStateChangeSuccessListener&&(this.unregisterStateChangeSuccessListener(),this.unregisterStateChangeSuccessListener=void 0)},t.prototype.initializeViewModel=function(){var t={dashboards:[],activeViewMode:e.contracts.DashboardContainerViewMode.DashboardViewer,activityPane:e.staticContract.getActivityPaneContract()},i={activeView:e.contracts.LandingView.Dashboard,dashboardContainer:t,reportContainer:{},workbookContainer:{},qnaContainer:{}},o=this.services.modelConverter,r=this.viewModel=o.convertLandingContainer(i);r.calculateLayout(),r.applyLayout()},t.prototype.hideTaskPaneSliderOnClick=function(){this.services.taskPaneSliderService.collapsePane(),this.scope.$broadcast(e.constants.hideTaskPaneSliderOnClickEventName)},t.prototype.hideNotificationPaneOnClick=function(){this.services.userNotificationInfo.hidePaneOnClick=!0},t.prototype.toggleNavigationPane=function(e){this.isNavigationPaneExpanded=e},t.prototype.quitImpersonation=function(){var e=this.impersonation,t=e.getImpersonationState().modelId;e.clearImpersonation();var i=this.services.fullScreen;i.fullScreenMode&&i.exitFullScreen(),this.navigation.showRowLevelSecuritySlider(t)},t.prototype.handleNotificationPane=function(e){this.viewModel.notificationPane.isExpanded=e,this.viewModel.showNotificationPane=e,this.viewModel.notificationPane.expandedWidth=e?CollapsiblePaneExpandedWidth.Small:CollapsiblePaneExpandedWidth.Default,e||(this.services.userNotificationInfo.hidePaneOnClick=!1)},t})();t.LandingController=i})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){t.Landing={templateUrl:"components/landing/landing.html",transclude:!0,controller:e.common.createController(e.controllers.LandingController)}})(t=e.components||(e.components={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t){var i=this;this.restrict="A",this.scope={backgroundImage:"@"},this.link=function(t,o,r){o.css({opacity:"0"});var a=!0;t.$watch("backgroundImage",(function(n){if(!_.isEmpty(n)){var s=o.visible()&&"visible"===document.visibilityState&&"false"!==r.backgroundAnimation,c=$("<img/>");c.one("error",(function(){$(i).remove();var o=i.localizationService.get("Tile_ErrorText");t.$emit(e.common.constants.tileErrorEventName,o)})).attr("src",n),s?c.one("load",(function(){return a?(a=!1,o.css({"background-image":"url("+n+")"}),void o.animate({opacity:"1"},1e3)):void o.animate({opacity:"1"}).animate("transition.slideLeftBigOut",500,(function(){o.css({"background-image":"url("+n+")"}),o.animate("transition.slideRightBigIn",500)}))})).attr("src",n):o.css({"background-image":"url("+n+")",opacity:"1"})}}))},this.localizationService=t}return t})();t.BackgroundImage=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/collapsiblePane.html",this.transclude=!0,this.replace=!0,this.scope={viewModel:"=",isExpanderHidden:"="},this.controller=e.common.createController(e.controllers.CollapsiblePaneController)}return t})();t.CollapsiblePane=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.controllers.contentProviderStore.ContentProviderSplashState,o=(function(){function t(t,o){var r=this;this.restrict="E",this.templateUrl="views/contentProviderStore/contentProviderSplash.html",this.replace=!0,this.controller=e.common.createController(e.controllers.contentProviderStore.ContentProviderSplashController),this.link=function(t,o,a){var n=t.$eval(a.screenState);n?(t.screenState=n,n===i.GroupWelcome&&r.telemetryService.logEvent(e.telemetry.DashboardGetDataSplash,e.telemetry.GetDataSplashState.GroupWelcome)):r.navigation.categoryName===e.constants.navigation.getDataWelcome?(t.screenState=i.Welcome,r.telemetryService.logEvent(e.telemetry.DashboardGetDataSplash,e.telemetry.GetDataSplashState.Welcome)):(t.screenState=i.GetData,r.telemetryService.logEvent(e.telemetry.DashboardGetDataSplash,e.telemetry.GetDataSplashState.GetData))},this.telemetryService=t,this.navigation=o}return t})();t.ContentProviderSplash=o})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.templateUrl="views/contentProviderStore/customConfigHandlers/sharePointUrlModal.html"}return e})();e.SharePointUrlModal=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(e){e[e.left=0]="left",e[e.right=1]="right"})(i||(i={}));var o=(function(){function t(){this.controller=e.common.createController(r),this.restrict="A",this.scope={context:"=",arrowDirection:"=?",showContextMenu:"=?"}}return t})();t.ContextMenu=o;var r=(function(){function e(t,o){var r=this;this.scope=t,this.services=o,this.element=this.services.$element,this.rtl=this.services.rtl,this.windowMetrics=this.services.windowMetrics,this.rtl&&this.rtl.isRtlLayout&&(t.arrowDirection=e.rightArrowDirection),this.arrowDirection=t.arrowDirection?i[t.arrowDirection]:i.left,this.scope.contextMenuStyle=e.contextMenuInactiveStyle,this.scope.close=function(){return r.hideDialog()},t.$on("$destroy",(function(){return r.dispose()})),$(window).on("resize",(function(){return r.blurAnchor()})),$(window).on(jsCommon.DOMConstants.keyDownEventName,(function(e){return r.keyDownHideDialog(e)})),$(window).on(jsCommon.DOMConstants.mouseDownEventName,(function(e){return r.mouseDownHideDialog(e)})),angular.isUndefined(t.showContextMenu)?this.element.bind(jsCommon.DOMConstants.mouseClickEventName,(function(e){return r.showDialog(e)})):this.scope.$watch((function(){return r.scope.showContextMenu}),(function(t,i){t&&!i&&r.scope.contextMenuStyle===e.contextMenuInactiveStyle?r.showDialog():!t&&i&&r.scope.contextMenuStyle===e.contextMenuActiveStyle&&r.hideDialog()}))}return e.createOptions=function(){return{additionalServices:["$element","$templateCache","rtl","windowMetrics"]}},e.prototype.clickOutsideContextMenu=function(t){var i=t.pageX,o=t.pageY;if(this.contextMenuElement&&this.scope.contextMenuStyle===e.contextMenuActiveStyle){var r=this.contextMenuElement.offset(),a=r.left,n=r.top,s=a+this.contextMenuElement.width(),c=n+this.contextMenuElement.height();return a>i||i>s||n>o||o>c}return!1},e.prototype.blurAnchor=function(){this.element.is(":focus")&&this.element.blur()},e.prototype.dispose=function(){this.contextMenuElement&&this.contextMenuElement.remove(),$(window).off("resize",this.blurAnchor),$(window).off(jsCommon.DOMConstants.keyDownEventName,this.keyDownHideDialog),$(window).off(jsCommon.DOMConstants.mouseDownEventName,this.mouseDownHideDialog)},e.prototype.showDialog=function(t){var o=this;t&&(t.preventDefault(),t.stopPropagation()),this.contextMenuElement||(this.template=angular.element(this.services.$templateCache.get("views/contextMenu.html")),this.contextMenuElement=this.services.compile(this.template)(this.scope),this.arrowElement=this.contextMenuElement.find(e.arrowSelector),$("body").append(this.contextMenuElement));var r=this.element.offset();this.services.timeout((function(){switch(o.arrowDirection){case i.left:r.left+=o.element.width()+e.arrowWidth+e.positionOffset.left,r.top-=o.contextMenuElement.height()/2-o.element.height()/2-e.positionOffset.top;break;case i.right:var t=o.contextMenuElement.width();if(r.left-=t+e.arrowWidth+e.positionOffset.left,r.top-=o.contextMenuElement.height()/2-o.element.height()/2-e.positionOffset.top,o.rtl&&o.rtl.isRtlLayout){var a=o.windowMetrics.windowWidth-(r.left+t);r.left=null,o.contextMenuElement.css("right",a)}}r.top=o.adjustPositionTop(r),o.contextMenuElement.css(r),o.scope.contextMenuStyle=e.contextMenuActiveStyle,o.scope.showContextMenu=!0}))},e.prototype.adjustPositionTop=function(t){var i=0,o=i+$(document).height()-this.contextMenuElement.height();return t.top<i?(this.arrowElement.css({top:t.top+this.contextMenuElement.height()/2-i+e.arrowPositionOffset.top}),i):t.top>o?(this.arrowElement.css({top:t.top+this.contextMenuElement.height()/2-o+e.arrowPositionOffset.top}),o):(this.arrowElement.removeAttr("style"),t.top)},e.prototype.hideDialog=function(){this.contextMenuElement&&(this.scope.contextMenuStyle=e.contextMenuInactiveStyle,this.scope.showContextMenu=!1)},e.prototype.mouseDownHideDialog=function(e){var t=this;this.clickOutsideContextMenu(e)&&this.scope.$apply((function(){t.hideDialog()}))},e.prototype.keyDownHideDialog=function(t){var i=this;this.scope.contextMenuStyle===e.contextMenuActiveStyle&&27===t.keyCode&&this.scope.$apply((function(){i.hideDialog()}))},e.arrowPositionOffset={left:0,top:-10},e.arrowWidth=17,e.positionOffset={left:-22,top:0},e.contextMenuActiveStyle="active",e.contextMenuInactiveStyle="inactive",e.arrowSelector=".wrapper .arrow",e.rightArrowDirection="right",e})()})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.dataServices.AppUtils,o=e.common.models,r=e.helpers.DashboardTelemetryHelper,a=e.services.FullScreenFitStyle,n=e.common.directives.InViewport,s=(function(){function t(s,c,l,d,p,u,h,v,g,m,f,b){var y=this;this.telemetryService=s,this.gridLayout=c,this.userActivityContextService=l,this.appService=d,this.packageService=p,this.timeout=u,this.groupService=h,this.dashboardLoadingProgressTrackingService=v,this.modelService=g,this.permissionService=m,this.usageMetricsReport=f,this.asyncFeatureSwitchService=b,this.restrict="E",this.templateUrl="views/dashboard.html",this.replace=!0,this.scope={viewModel:"=",displayLayout:"<",mobileLayout:"<?",inEditMobileLayoutMode:"<?",isGroupTransitionDelayed:"<",enableStrategySwap:"<?"},this.controller=e.common.createController(e.controllers.DashboardController),this.link=function(s,c,l,d){var p=-1,u=!1,h=!0;s.disablePointerEvents="true"===l.disablePointerEvents;var v=n.getRefreshAllHandler();s.scaleDashboard=function(e){var i=s.gridLayoutContainer.containerWidth+t.TileContainerPixelPadding,o=s.gridLayoutContainer.containerHeight,r=c.parent().width(),a=c.parent().height(),n=t.calculateDashboardScaleFactor(i,o,r,a,e);if(!(n<=0)){var l={transform:"scale("+n+")",width:i+"px",height:e?a/n+"px":o+"px"};c.css(l).addClass(t.DashboardFitToScreenCSSClass),v()}};var g=s.fullScreen,m={onFitStyleChanged:function(){switch(g.fitStyle){case a.FitToContent:s.scaleDashboard();break;case a.FitToWidth:s.scaleDashboard(!0);break;case a.None:c.removeAttr("style").removeClass(t.DashboardFitToScreenCSSClass)}},onFullScreenModeChanged:_.noop};g.subscribe(m),s.$watch("viewModel",(function(e,a){if(e&&a&&e.id!==a.id){e.gridLayoutService=a.gridLayoutService,e.gridLayoutService.strategy=new o.DefaultGridLayoutStrategy,e.gridLayoutService.displayLayout=0;var n=e.tiles;if(n)for(var l=0,d=n;l<d.length;l++){var v=d[l];v.gridLayoutContext&&v.gridLayoutContext.setActiveLayout(0),v.invalidateLayout()}}if(e){var g=null;y.appService&&e.contract&&(g=i.getDashboardAppGUID(e,y.appService,y.packageService)),y.dashboardLoadingProgressTrackingService.cancelTracking(),y.telemetryHelper=new r(y.telemetryService,y.userActivityContextService,y.timeout,y.dashboardLoadingProgressTrackingService,y.modelService,y.usageMetricsReport,s),y.asyncFeatureSwitchService.getFeatureSwitches().then((function(t){var i;t&&t.trackUserInfo&&!t.usageMetricsTrackUserLevelInfoEnabled&&(i=!0),y.telemetryHelper.recordOpenDashboardEvent(e,g,y.groupService.activeGroupObjectId,y.permissionService.isActiveWorkspaceIsReadOnly,i)})),y.dashboardLoadingProgressTrackingService.startTracking(e),y.gridLayout&&(e.gridLayoutService=y.gridLayout);var m=s.displayLayout||0;e.currentDisplayLayout=m}u=!0,window.clearTimeout(p),c.scrollTop(0).scrollLeft(0).addClass(t.TransitioningCSSClass),h||c.css("opacity","0")})),s.$watch("viewModel.isLoaded",(function(t,i){var o=y.doesModelContainsTilesByLayout(s.viewModel,s.displayLayout);t&&!i&&o&&s.$emit(e.common.constants.dashboardTileRepeatFinishedEvent)})),s.onDestroy=function(){y.dashboardLoadingProgressTrackingService.cancelTracking(),g.unsubscribe(m)},s.$on(e.common.constants.dashboardTileRepeatFinishedEvent,(function(){s.fullScreen.fitStyle!==a.None&&m.onFitStyleChanged(),d.scrollToSelectedTile(),u&&(h||c.animate(t.DashboardAnimationUITransitionType,t.DashboardTransitionDurationMs),p=window.setTimeout((function(){c.removeClass(t.TransitioningCSSClass)}),2e3),u=!1,s.$emit(e.common.constants.domLayoutChangedEvent))}))}}return t.calculateDashboardScaleFactor=function(e,t,i,o,r){var a=i/e;if(r)return a;var n=o/t;return a<n?a:n},t.prototype.doesModelContainsTilesByLayout=function(e,t){return e&&(!e.tiles||void 0===t||0===_.filter(e.tiles,(function(e){return e.hasLayoutPosition(t)})).length)},t.TransitioningCSSClass="transitioning",t.DashboardTransitionDurationMs=150,t.DashboardAnimationUITransitionType="transition.fadeIn",t.TileContainerPixelPadding=40,t.DashboardFitToScreenCSSClass="fitToScreen",t})();t.Dashboard=s})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.constants,o=(function(){function t(){this.restrict="E",this.templateUrl="views/dashboardContainer.html",this.replace=!0,this.scope={viewModel:"=",collapsiblePaneMode:"=",isActive:"="},this.controller=e.common.createController(e.controllers.DashboardContainerController),this.link=function(e,t,o){var r=e.rootScope.$on(i.inFocusEnterEvent,(function(){t.hide()})),a=e.rootScope.$on(i.inFocusExitEvent,(function(){t.show()})),n=e.$on("$destroy",(function(){r(),a(),n()}))}}return t})();t.DashboardContainer=o})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.replace=!0,this.controller=e.common.createController(e.controllers.DevToolsViewController),this.templateUrl="views/devToolsView.html"}return t})();t.DevToolsView=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/excelUploadFormat.html",this.replace=!0,this.controller=e.common.createController(e.controllers.ExcelUploadFormatController)}return t})();t.ExcelUploadFormat=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",canvasOptions:"<",explorationContainerOptions:"<"},this.controller=e.common.createController(e.controllers.ExplorationContainerController),this.templateUrl="views/explorationContainer.html"}return t})();t.ExplorationContainer=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=jsCommon.DOMConstants,i=(function(){function e(e){var i=this;this.restrict="A",this.scope={flyoutToggle:"="},this.link=function(e,o,r){function a(t){var i=$(t.target).parents().addBack().is(o);i||(e.flyoutToggle=!1,e.$applyAsync())}e.$watch("flyoutToggle",(function(e,o){e!==o&&e===!0?i.$window.on(t.mouseDownEventName,a):e!==o&&e===!1&&i.$window.off(t.mouseDownEventName,a)}))},this.$window=$(e)}return e})();e.FlyoutToggle=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.replace=!0,this.templateUrl="views/historyDialogView.html",this.scope={viewModel:"="},this.controller=e.common.createController(e.controllers.HistoryDialogController)}return t})();t.HistoryDialog=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=300,o=20,r=(function(){function t(t){var r=this;this.promiseFactory=t,this.restrict="A",this.templateUrl="views/inFocus.html",this.scope={canEdit:"="},this.controller=e.common.createController(e.controllers.InFocusController),this.link=function(e,t){e.performTransitionAnimation=function(e){var t=$.Deferred();0===$(".inFocusTransition.begin").length&&$('<div class="inFocusTransition begin"></div>').insertAfter($("[in-focus]"));var i=$(".dashboardTile[data-id="+e+"]");if(0===i.length)return t.resolve(),t;var o=i.offset(),r=o.top,a=o.left,n=i.width(),s=i.height();return $(".inFocusTransition.begin").animate({opacity:1,top:0,left:0,width:"100%",height:"100%"},{duration:250,begin:function(){$(".begin").css({top:r,left:a,width:n,height:s})},complete:function(){t.resolve()}}),t},e.clearTransitionAnimation=function(){var e=r.promiseFactory.defer();return $(".inFocusTransition.begin").animate({opacity:0},{duration:350,complete:function(){$(".inFocusTransition.begin").css({width:0,height:0}),e.resolve(null)}}),e.promise};var a=function(t){var i=e.viewModel.inFocusTile,r=i&&i.realTime;if(r){var a=e.onResizeViewport||t;if(a){var n=a.width-2*o,s=a.height-2*o;if(!(n<=0||s<=0)){var c={width:n,height:s};i.calculateLayout(c),i.applyLayout()}}}},n=_.throttle(a,i);e.handleResize=function(e,t){n({width:e,height:t})}}}return t})();t.InFocus=r})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/insights/insights.html",this.scope={activeDashboard:"=activeDashboard"},this.replace=!0,this.controller=e.common.createController(e.controllers.insights.InsightsController)}return t})();t.Insights=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.replace=!0,this.transclude=!0,this.controller=e.common.createController(e.controllers.LandingContainer),this.templateUrl="views/landingContainer.html",this.controllerAs="$ctrl",this.scope=!0}return t})();t.LandingContainer=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=".xlsx,.xlsm,.pbix,.csv",o=(function(){function t(t,o,r,a){var n=this;this.localizationService=t,this.errorService=o,this.applicationOptions=r,this.timeoutService=a,this.restrict="E",this.templateUrl="views/localFileBrowser.html",this.replace=!0,this.link=function(t,o,r){t.fileDialogFilter=i,n.input=o.find(".browseFileInput"),n.input.val(""),n.input.bind("change",(function(){return n.onFileSelected(t)})),n.input.bind("click",(function(e){e.stopPropagation()})),t.$on(e.common.constants.chooseLocalFileEventName,(function(e,i){t.fileDialogFilter=i,n.timeoutService((function(){return n.selectFile(t)}))}))}}return t.prototype.onFileSelected=function(t){var i,o=this.input[0];o.files&&(i=o.files[0]),t.$emit(e.common.constants.localFileSelectedEventName,i)},t.prototype.selectFile=function(e){this.input.val("");try{this.applicationOptions.isE2ERun||this.input.click()}catch(e){var t=this.errorService.control();t.showCustomDialog(this.localizationService.get("GetData_FileCannotBeUploadedTitle"),angular.element("<div/>").text(this.localizationService.get("GetData_FileCannotBeUploadedText")),[new InJs.ModalDialogAction(this.localizationService.get("GetData_OK"),function(e,i){t.hideDialog()})],(function(e){e.parent().find('input[type="button"]').focus()}),!0)}},t})();t.LocalFileBrowser=o})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/manageStorageView.html",this.scope={viewModel:"=",dashboardContainer:"="},this.replace=!0,this.controller=e.common.createController(e.controllers.ManageStorageView)}return t})();t.ManageStorageView=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/navigationBar.html",this.transclude=!0,this.replace=!0,this.scope={currentDashboard:"=",currentReport:"=",currentWorkbook:"="},this.controller=e.common.createController(e.controllers.NavigationBarController)}return t})();t.NavigationBar=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function i(){this.restrict="E",this.templateUrl="views/navigationPaneListItem.html",this.replace=!0,this.scope={newStyle:"<",viewModel:"=",selected:"=?"},this.link=function(e,i,o){t.NavigationPaneListItem.link(e,i,o)},this.controller=e.common.createController(e.controllers.DashboardNavigationPaneListItemController)}return i})();t.DashboardNavigationPaneListItem=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function i(){this.restrict="E",this.templateUrl="views/navigationPaneListItem.html",this.replace=!0,this.scope={newStyle:"<",viewModel:"=",selected:"=?"},this.link=function(e,i,o){t.NavigationPaneListItem.link(e,i,o)},this.controller=e.common.createController(e.controllers.DatasetNavigationPaneListItemController)}return i})();t.DatasetNavigationPaneListItem=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function i(){this.restrict="E",this.templateUrl="views/groupNavigationPaneListItem.html",this.replace=!0,this.scope={viewModel:"=",
selected:"=?"},this.link=function(e,i,o){t.NavigationPaneListItem.link(e,i,o)},this.controller=e.common.createController(e.controllers.GroupNavigationPaneListItemController)}return i})();t.GroupNavigationPaneListItem=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){}return t.link=function(t,i,o){t.showContextMenuIfEnabled=function(){t.$emit(e.constants.scrollToNavPaneListItemEventName,i),t.showContextMenu=t.isContextMenuEnabled()},t.$on(e.constants.navPaneScrollEventName,(function(e,o){t.showContextMenu&&o.length>0&&o[0]===i[0]&&t.$apply((function(){t.showContextMenu=!1}))}))},t})();t.NavigationPaneListItem=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function i(){this.restrict="E",this.templateUrl="views/navigationPaneListItem.html",this.replace=!0,this.scope={newStyle:"<",viewModel:"=",selected:"=?"},this.link=function(e,i,o){t.NavigationPaneListItem.link(e,i,o)},this.controller=e.common.createController(e.controllers.ReportNavigationPaneListItemController)}return i})();t.ReportNavigationPaneListItem=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function i(){this.restrict="E",this.templateUrl="views/navigationPaneListItem.html",this.replace=!0,this.scope={newStyle:"<",viewModel:"=",selected:"=?"},this.link=function(e,i,o){t.NavigationPaneListItem.link(e,i,o)},this.controller=e.common.createController(e.controllers.WorkbookNavigationPaneListItemController)}return i})();t.WorkbookNavigationPaneListItem=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/npsHost.html",this.replace=!0,this.scope={},this.link=function(e,t,i){var o='<iframe name="npsFrame" id="npsFrame" sandbox="allow-same-origin allow-scripts allow-popups allow-forms" src="{{npsUrl}}"></iframe>',r=function(){var e=t.find("iframe#npsFrame");e&&e.remove()};e.closeNpsHostIframe=function(){t.removeClass("npsActive"),r()},e.resizeNpsHostIframe=function(){$("#npsFrame").addClass("short")},e.connectToNps=function(){e.initListener(),r();var i=$(o.replace("{{npsUrl}}",e.renderUrl));t.append(i),$("#npsFrame").load((function(){t.addClass("npsActive")}))}},this.controller=e.common.createController(e.controllers.NpsHostController)}return t})();t.NpsHost=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.restrict="E",this.templateUrl="views/loadNotificationDialog.html",this.replace=!0,this.scope={message:"="},this.scope=e}return e})();e.LoadNotificationDialog=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/o365ApplicationLauncher.html",this.replace=!0,this.scope={},this.controller=e.common.createController(e.controllers.O365ApplicationLauncherController)}return t})();t.O365ApplicationLauncher=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="A",this.scope={onLoad:"&",onError:"&?"},this.link=function(t,i){i.on("load",(function(){t.$applyAsync((function(){t.onLoad()}))})),t.onError&&i.on("error",(function(){t.$applyAsync((function(){t.onError()}))})),t.$on(e.common.constants.scopeDestroyEventName,(function(){i.off()}))}}return t})();t.OnLoad=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t){var i=this;this.restrict="E",this.templateUrl="views/pinTileDialog.html",this.replace=!0,this.controller=e.common.createController(e.controllers.PinTileDialogController),this.link=function(e,t,o){i.$timeout((function(){t.find('input[type="text"]').focus(),$(".inputReportTitle").keypress((function(e){if(13===e.keyCode){var t=$(".saveAndContinueBtn");t.prop("disabled")||t.click()}})),$(".inputDashboardTitle").keypress((function(e){if(13===e.keyCode){var t=$(".pinTile");t.prop("disabled")||t.click()}})),$(".newDashRadio").click((function(e){$(".inputDashboardTitle").focus()}))}),500),i.$timeout((function(){var e=t.find(".tilePreviewFrame .dashboardTile");e.length>0&&e.fadeIn(300)}))},this.$timeout=t}return t})();t.PinTileDialog=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=jsCommon.BrowserUtils,o=e.common.constants,r="@media print {{0}{ {1} }}",a="explore-canvas-printer",n="dashboard-printer",s=(function(){function t(e,t,i,r){var s=this;this.restrict="A",this.link=function(e,t,i){if(i.disablePrint===(!0).toString())return t.removeAttr(a),void t.removeAttr(n);var r=s.rootScope,c=r.$on(o.enterPrintModeEvent,(function(i){i.stopPropagation(),s.insertPrintStylingInDOM(e,t)})),l=r.$on(o.exitPrintModeEvent,(function(e){e.stopPropagation(),s.removePrintStylingFromDOM(t)})),d=e.$on("$destroy",(function(){c(),l(),s.removePrintStylingFromDOM(t),d()}))},this.rootScope=e,this.compileService=t,this.featureSwitchService=i,this.localizationService=r}return t.getPrintTargetViewPort=function(t){var o={width:e.constants.defaultPortraitPrintWidth,height:e.constants.defaultPortraitPrintHeight},r=t.width(),a=t.height();if(r>a&&(o.width=e.constants.defaultLandscapePrintWidth,o.height=e.constants.defaultLandscapePrintHeight),i.isChrome()){var n=t.parent();o.width=n.width(),o.height=n.height()}return o},t.calculateScaleFactor=function(e,t,i){var o=t.width/e.width,r=t.height/e.height;return i?Math.max(o,r):Math.min(o,r)},t.prototype.calculateStyle=function(e,t){return null},t.prototype.getStyleString=function(e){for(var t=Object.keys(e),i="",o=0,r=t.length;o<r;o++){var a=t[o];i=i+a+":"+e[a]+"; "}return i},t.prototype.insertPrintStylingInDOM=function(e,t){var i=this;if(null!=this.printContainerSelector){if(this.featureSwitchService.featureSwitches.printingEnabled===!1)return this.printMediaQueryElement||this.localizationService.ensureLocalization((function(){var e=i.localizationService.get("PrintingIsDisabledForThisTenantMessage"),t=$("<div>").addClass("errorTitle").text(e),o=$("<div>").attr("id","printDisabledOverlay").append(t);i.printMediaQueryElement=o,$("body").append(i.printMediaQueryElement)})),void t.hide();this.printMediaQueryElement||(this.printMediaQueryElement=$("<style></style>").attr("type","text/css"),$("body").append(this.printMediaQueryElement));var o=this.calculateStyle(t,e),a=this.getStyleString(o),n=jsCommon.StringExtensions.format(r,this.printContainerSelector,a);this.printMediaQueryElement.html(n)}},t.prototype.removePrintStylingFromDOM=function(e){this.printMediaQueryElement&&(this.printMediaQueryElement.remove(),this.printMediaQueryElement=void 0),this.featureSwitchService.featureSwitches.printingEnabled===!1&&e.show()},t})();t.BasePrinter=s})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=40,i=(function(i){function o(){var e=null!==i&&i.apply(this,arguments)||this;return e.printContainerSelector="[dashboard-printer]",e}return __extends(o,i),o.prototype.calculateStyle=function(i,o){var r=o.gridLayoutContainer.containerWidth+t,a=o.gridLayoutContainer.containerHeight,n=e.BasePrinter.getPrintTargetViewPort(i),s=e.BasePrinter.calculateScaleFactor({width:r,height:a},n);return s<=0?{}:{transform:"scale("+s+") !important","-webkit-transform":"scale("+s+") !important",width:r+"px !important",height:a+"px !important",overflow:"visible !important"}},o})(e.BasePrinter);e.DashboardPrinter=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=40,i=(function(i){function o(){var e=null!==i&&i.apply(this,arguments)||this;return e.printContainerSelector="[explore-canvas-printer]",e}return __extends(o,i),o.prototype.calculateStyle=function(i,o){var r=i.width()+t,a=i.height(),n=e.BasePrinter.getPrintTargetViewPort(i),s=i.find(".visualContainer");if(s.length>0){var c=0,l=0;s.each((function(e,t){var i=$(t),o=i.position(),r=Math.max(0,o.left),a=Math.max(0,o.top);c=Math.max(c,r+i.width()),l=Math.max(l,a+i.height())}));var d=e.BasePrinter.calculateScaleFactor({width:r,height:a},{width:c,height:l},!0);r*=d,a*=d}var p=e.BasePrinter.calculateScaleFactor({width:r,height:a},n),u=r*p,h=a*p,v=(n.width-u)/2,g=(n.height-h)/2;return{width:r+"px !important",height:a+"px !important",transform:"translate("+v+"px, "+g+"px) scale("+p+") !important","-webkit-transform":"translate("+v+"px, "+g+"px) scale("+p+") !important","transform-origin":"left top !important","-webkit-transform-origin":"left top !important",left:"auto !important",top:"auto !important",right:"auto !important",bottom:"auto !important"}},o})(e.BasePrinter);e.ExploreCanvasPrinter=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/qrCodeDialog.html",this.replace=!0,this.controller=e.common.createController(e.controllers.QrCodeDialogController)}return t})();t.QrCodeDialog=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/qrCodeProgressDialog.html",this.replace=!0,this.controller=e.common.createController(e.controllers.QRCodeProgressDialogController)}return t})();t.QrCodeProgressDialog=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/settings/settingsDashboardsView.html",this.scope={viewModel:"="},this.replace=!0,this.controller=e.common.createController(e.controllers.SettingsDashboardsController)}return t})();t.SettingsDashboards=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/settings/settingsDatasetFeaturedQuestionsView.html",this.scope={viewModel:"="},this.replace=!0,this.controller=e.common.createController(e.controllers.SettingsDatasetFeaturedQuestionsController),this.link=function(e,t,i){e.focusOnLastInput=function(){t.find('input[type="text"]').last().focus()}}}return t})();t.SettingsDatasetFeaturedQuestions=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/settings/settingsGeneralView.html",this.scope={viewModel:"="},this.replace=!0,this.controller=e.common.createController(e.controllers.SettingsGeneralController)}return t})();t.SettingsGeneral=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/settings/settingsViewerView.html",this.scope={},this.replace=!0,this.controller=e.common.createController(e.controllers.SettingsViewerController)}return t})();t.SettingsViewer=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/taskPaneSliderView.html",this.scope={viewModel:"="},this.controller=e.common.createController(e.controllers.TaskPaneSliderController)}return t})();t.TaskPaneSlider=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/tiles/compositeTile.html",this.replace=!0,this.scope={viewModel:"=",allowInteractivity:"@"},this.controllerAs="$ctrl",this.controller=e.common.createController(e.controllers.CompositeTileController)}return t})();t.CompositeTile=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.constants,o=e.dataServices.constants,r=(function(){function t(){this.restrict="E",this.templateUrl="views/tiles/dashboardTile.html",this.replace=!0,this.scope={viewModel:"=",canEdit:"=",disableInteractions:"=?",addTileToMobileView:"&?",removeTileFromMobileView:"&?",viewportContextSelector:"<?"},this.link=function(e,r,a){var n=e.viewModel.report;n&&r.attr("data-report-id",n.id),e.disableInteractions="true"===a.disableInteractions,e.disablePointerEvents="true"===a.disablePointerEvents||e.disableInteractions,e.onceInViewport=function(){e.inViewport=!0};var s=e.$root.$on(o.deleteModelStartedEventName,(function(t,i){var o=e.viewModel.datasetModel;o&&o.id===i&&r.hide()})),c=e.$root.$on(o.deleteModelFailedEventName,(function(t,i){var o=e.viewModel.datasetModel;o&&o.id===i&&r.show()}));e.$watch("canEdit",(function(e,i){var o=e?"false":"true";r.attr(t.DragResizeDisabledAttr,o)})),e.isTileElementChanging=function(){return r.hasClass("changing")};var l=e.viewModel,d=r.find(".tileContent")[0],p=function(t){e.openTile(!1,t)&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)};l&&!l.reportTile&&d&&d.addEventListener("click",p,!0),e.$on(i.scopeDestroyEventName,(function(){d&&d.removeEventListener("click",p,!0),c(),s()}))},this.controller=e.common.createController(e.controllers.DashboardTileController)}return t.DragResizeDisabledAttr="drag-resize-disabled",t})();t.DashboardTile=r})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.templateUrl="views/tiles/imageTile.html",this.replace=!0,this.scope={viewModel:"="}}return e})();e.ImageTile=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/tiles/modelTile.html",this.replace=!0,this.scope={viewModel:"="},this.link=function(t){t.imageUrl=e.dataServices.constants.modelPlaceholderImageUrl}}return t})();t.ModelTile=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/tiles/reportTile.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(e.controllers.ReportTileController)}return t})();t.ReportTile=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.templateUrl="views/tiles/ssrsTile.html",this.replace=!0,this.scope={viewModel:"="}}return e})();e.SsrsTile=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/tiles/tile.html",this.replace=!0,this.scope={viewModel:"=",headerClickTarget:"&"},this.controller=e.common.createController(e.controllers.Tile),this.link=function(e,t,i){e.disablePointerEvents="true"===i.disablePointerEvents,e.largeHeader=i.hasOwnProperty("largeHeader"),e.allowInteractivity=i.allowInteractivity,e.largeHeader&&e.viewModel.setTileHeaderSize(0)}}return t})();t.Tile=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/tiles/workbookTile.html",this.replace=!0,this.scope={viewModel:"=",title:"="},this.controller=e.common.createController(e.controllers.WorkbookTileController),this.link=function(e,t,i){e.onTileImageReady=function(e){t.find("img.internalWorkbookTileImage").load((function(t){e(t.currentTarget)}))}}}return t})();t.WorkbookTile=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){var e=this;this.restrict="E",this.templateUrl="views/usageBarView.html",this.replace=!0,this.scope={usageBarModel:"=",viewModel:"="},this.link=function(t,i,o){t.$watch("usageBarModel.selfUsageInPercent",(function(){e.updateBar(t,i)})),t.$watch("usageBarModel.otherUsageInPercent",(function(){e.updateBar(t,i)}))}}return e.prototype.updateBar=function(e,t){var i=e.usageBarModel.selfUsageInPercent,o=e.usageBarModel.otherUsageInPercent,r=t.find(".usageBar"),a=t.find(".legends"),n=r.outerWidth(!0),s=n*i,c=n*o,l=r.children();r.hasClass("threebars")&&r.removeClass("threebars"),r.hasClass("twobars")&&r.removeClass("twobars"),r.hasClass("onebar")&&r.removeClass("onebar"),a.hasClass("threebars")&&a.removeClass("threebars"),a.hasClass("twobars")&&a.removeClass("twobars"),i+o<=1?($(l[0]).css("width",s+"px"),$(l[1]).css("width",c+"px"),$(l[2]).css("width",n-s-c+"px"),r.addClass("threebars"),a.addClass("threebars")):i>1?($(l[0]).css("width",n+"px"),$(l[1]).css("width","0px"),$(l[2]).css("width","0px"),r.addClass("onebar"),a.addClass("twobars")):($(l[0]).css("width",s+"px"),$(l[1]).css("width",n-s+"px"),$(l[2]).css("width","0px"),r.addClass("twobars"),a.addClass("twobars"))},e})();e.UsageBar=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,i,o,r){var a=this;this.restrict="E",this.templateUrl="views/usageBarMenuItemView.html",this.replace=!0,this.scope={text:"=?",usageDescription:"=?",labelClass:"=?"},this.link=function(e,t,i){a.updateBar(e,t),e.$watchGroup([function(){return a.quota.quotaLimitInMB},function(){return a.modelService.lastUpdatedTimestamp},function(){return a.workbookService.lastUpdatedTimestamp}],(function(){a.updateBar(e,t)})),e.$watch((function(){return a.groupService.activeGroup}),(function(){a.updateBar(e,t)}))},this.quota=e,this.modelService=t,this.workbookService=i,this.groupService=o,this.featureSwitchService=r}return e.prototype.updateBar=function(t,i){var o=this.quota.getUsageBarMenuItemViewModel();t.text=o.text,t.usageDescription=o.usageDescription;var r=o.usageInMB/o.quotaLimitInMB,a=i.find(".usageBar"),n=a.outerWidth(!0),s=n*r,c=a.children();a.hasClass(e.onebarClass)&&a.removeClass(e.onebarClass),a.hasClass(e.twobarsClass)&&a.removeClass(e.twobarsClass),r<=1?($(c[0]).css("width",s+"px"),$(c[1]).css("width",n-s+"px"),a.addClass(e.twobarsClass)):($(c[0]).css("width",n+"px"),$(c[1]).css("width","0px"),a.addClass(e.onebarClass))},e.onebarClass="onebar",e.twobarsClass="twobars",e})();e.UsageBarMenuItem=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/userGroupHeaderView.html",this.scope={viewModel:"="},this.replace=!0,this.controller=e.common.createController(e.controllers.UserGroupHeaderController)}return t})();t.UserGroupHeader=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.replace=!0,this.transclude=!0,this.controller=e.common.createController(e.controllers.UserInfoController),this.template='<div ng-transclude class="userInfo"></div>'}return t})();t.UserInfoContainer=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/warningBar.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(e.controllers.WarningBarController)}return t})();t.WarningBar=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.templateUrl="views/waterMarkMessage.html",this.scope={config:"="}}return e})();e.WaterMarkMessage=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.replace=!0,this.templateUrl="views/workbookAppBar.html",this.scope={viewModel:"="},this.controller=e.common.createController(e.controllers.WorkbookAppBarController)}return t})();t.WorkbookAppBar=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/workbookContainer.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(e.controllers.WorkbookContainerController),this.link=function(e,t,i){e.getEwaTargetWindow=function(){var e=t.find("iframe.workbookEWAIsolation")[0];return e.contentWindow}}}return t})();t.WorkbookContainer=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.templateUrl="views/workbookDiscoverabilityToast.html"}return e})();e.WorkbookDiscoverabilityToast=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(t,i,o,r){o.ensureLocalization((function(){var a=o.get(t),n=o.format("ArtifactDoesNotExistTitleFormat",[a]),s=o.get("ArtifactDoesNotExistMessage");r.logEvent(e.telemetry.ArtifactNotFound,t);var c={label:o.get("PBI_Button_Label_OK"),resultValue:"ok",cssClass:"primary"};i.error(s,"artifactNotFound",{title:n,dialogOptions:[c],isDismissable:!0,showAdditionalErrorInfo:!1})}))}t.showArtifactDoesNotExistDialog=i})(i=t.ArtifactNotFoundHelper||(t.ArtifactNotFoundHelper={}))})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){}return t.HasUnsupportedExploreVisuals=function(e,t){var i=!1;if(e){var o=e.sections;if(o)for(var r=0,a=o.length;r<a;r++){var n=o[r],s=n.visualContainers;if(s)for(var c=0,l=s.length;c<l;c++){var d=s[c],p=d.config.singleVisual.visualType;if(p&&!t.getPlugin(p)){if(e.resourcePackages&&e.resourcePackages.some((function(e){return e.name===p})))continue;i=!0;break}}}}return i},t.IsReportSavedAsExploration=function(e){return e.hasExploration||!e.reportUrl},t.shouldDisplayErrorAsNotificationBar=function(t){return t===e.DMTS_NoGatewayWithAllDatasourcesToBindError||t===e.DMTS_MultipleGatewaysWithAllDatasourcesToBindError||t===e.DMTS_DatasourceHasNoCredentialError||t===e.DM_GWPipeline_Client_GatewayUnreachable||t===e.DMTS_UserLostPermissionToDatasourceError||t===e.DMTS_UserNotFoundInADGraphError||t===e.DM_GWPipeline_Gateway_DataSourceConnectionError||t===e.DM_GWPipeline_Gateway_DataSourceAccessError||t===e.DM_GWPipeline_Gateway_ImpersonationError||t===e.DM_GWPipeline_Gateway_InvalidMashupConnectionString||t===e.DM_GWPipeline_Gateway_DatabaseLoginError||t===e.DM_GWPipeline_Gateway_SqlTimeoutException||t===e.DM_GWPipeline_Gateway_AdomdTimeoutException||t===e.DM_GWPipeline_Gateway_InvalidObjectNameException||t===e.DM_GWPipeline_Gateway_ConnectionBrokenException||t===e.DM_GWPipeline_Gateway_MemoryError||t===e.DM_GWPipeline_Gateway_MissingStructureError||t===e.DM_GWPipeline_Gateway_UnprocessedStructureError||t===e.DM_GWPipeline_Gateway_ModelLoadError||t===e.DM_GWPipeline_Gateway_CancellationError||t===e.DM_GWPipeline_Gateway_QueryExecutionError||t===e.DM_GWPipeline_Gateway_RecalculationRequiredError||t===e.DM_GWPipeline_Gateway_AdomdConnectError||t===e.DM_GWPipeline_Gateway_MashupDataAccessError||t===e.RS_CannotRetrieveModel||t===e.RS_AccessDeniedDueToRLSGroup||t===e.RS_AccessDenied},t})();t.ReportUtility=i})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=2e3,i=(function(){function e(e,t){this.newQueryResultUpdates=[],this.explorationId=e,this.explorationProxy=t}return e.prototype.onNewQueryCacheResultAvailable=function(e){var i=this;this.newQueryResultUpdates.push(e),1===this.newQueryResultUpdates.length&&setTimeout((function(){var e={visualQueryResults:_.map(i.newQueryResultUpdates,(function(e){var t={visualContainerId:e.visualContainerId,query:e.query,dataTransforms:e.dataTransforms};return t}))};i.explorationProxy.saveVisualContainerQueries(i.explorationId,e),i.newQueryResultUpdates=[]}),t)},e})();e.VisualContainerQueryUpdater=i})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){var e=this;this.reports=[],this.dashboards=[],this.tiles=[],this.models=[],this.isReportExpanded=!0,this.isDashboardExpanded=!1,this.isTileExpanded=!1,this.onCuratedContentExpanded=function(t){e.openOneAtTime(t)}}return Object.defineProperty(e.prototype,"dashboardCount",{get:function(){return this.dashboards.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileCount",{get:function(){return this.tiles.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reportCount",{get:function(){return this.reports.length},enumerable:!0,configurable:!0}),e.prototype.addModels=function(e){e=e||[];for(var t=0,i=e;t<i.length;t++){var o=i[t];this.models.push(o)}},e.prototype.addReports=function(e){e=e||[];for(var t=0,i=e;t<i.length;t++){var o=i[t];o.reportUrl&&this.reports.push(o)}},e.prototype.addDashboards=function(e){e=e||[];for(var t=0,i=e;t<i.length;t++){var o=i[t];this.dashboards.push(o)}},e.prototype.addTiles=function(e){e=e||[];for(var t=0,i=e;t<i.length;t++){var o=i[t];this.tiles.push(o)}},e.prototype.openOneAtTime=function(e){"report"===e?(this.isReportExpanded=!this.isReportExpanded,this.isReportExpanded&&(this.isDashboardExpanded=!1,this.isTileExpanded=!1)):"dashboard"===e?(this.isDashboardExpanded=!this.isDashboardExpanded,this.isDashboardExpanded&&(this.isReportExpanded=!1,this.isTileExpanded=!1)):"tile"===e&&(this.isTileExpanded=!this.isTileExpanded,this.isTileExpanded&&(this.isReportExpanded=!1,this.isDashboardExpanded=!1))},e})();e.ActivityPaneCuratedContentModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function i(){this._connectionOptionsTag=-1}return Object.defineProperty(i.prototype,"connectionOptionsTag",{get:function(){return this._connectionOptionsTag},enumerable:!0,configurable:!0}),i.prototype.onPackageSelectionChange=function(e){this.packageSelectionEvent=e},i.prototype.updatePackagesData=function(e){if(e){var t=-1,i=null;this.packageItems&&(t=this.packageItems.selectedIndex,i=this.packageItems.selectedItem),this.packageModels=[],this.activityPaneData=e.activityPaneData,this.packageItems=this.initializePackageNames(i),t!==-1?this.packageItems.selectedIndex=t:this.packageItems.itemsCount>0&&(this.packageItems.selectedIndex=0)}},i.prototype.initializePackageNames=function(i){var o=this,r=[];if(this.activityPaneData.length>0){r=this.activityPaneData.map((function(e){return new t.ComboBoxItem(e.packageName,e.packageId)})),this.packageItems||(this.packageItems=new t.ComboBoxModel),this.packageItems.clearItems(),r.sort((function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())}));for(var a=0,n=r;a<n.length;a++){var s=n[a];this.packageItems.addItem(s)}this.packageItems.selectedIndex===-1&&this.packageItems.itemsCount>0&&(this.packageItems.selectedIndex=0),this.packageItems.addSeparator(),this.packageItems.addItem(new t.ComboBoxItem(e.common.localize.get("ActivityPane_ConnectionOptionsText"),this.connectionOptionsTag,t.ComboBoxItemType.Text,(!1))),i=i||this.packageItems.selectedItem,this.populateSelectedPackageModels(i)}return this.packageItems.onClickEvent=function(e){return o.onPackageItemSelected(e)},this.packageItems.onDropDownEvent=function(){return o.onPackageItemSelected()},this.packageItems},i.prototype.onPackageItemSelected=function(e){e=e||this.packageItems.selectedItem,this.populateSelectedPackageModels(e),this.packageSelectionEvent&&this.packageSelectionEvent(e)},i.prototype.populateSelectedPackageModels=function(t){if(t.tag!==this.connectionOptionsTag)for(var i=this.activityPaneData,o=0,r=i;o<r.length;o++){var a=r[o];if(a.packageId===t.tag){if(!a.models)return;if(this.packageModels=[],1===a.models.length){var n=a.models[0];this.packageModels[0]={modelId:n.id,modelName:e.common.localize.get("ActivityPane_Explore")}}else for(var s=0;s<a.models.length;s++){var n=a.models[s];this.packageModels[s]={modelId:n.id,modelName:e.common.localize.get("ActivityPane_Explore")+" "+n.displayName}}break}}},i})();t.ActivityPaneDataPackagesModel=i;var o=(function(){function e(e,t){this.modelId=e,this.modelName=t}return e})();t.ActivityPanePackageModel=o})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.contract=e}return e})();e.ActivityPaneModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e[e.None=0]="None",e[e.Create=1]="Create",e[e.Update=2]="Update",e[e.Delete=3]="Delete"})(t=e.AlertFailureState||(e.AlertFailureState={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Text=1]="Text",e[e.Separator=2]="Separator"})(t=e.ComboBoxItemType||(e.ComboBoxItemType={}));var i=(function(){function e(e,i,o,r){this._name=e,this._tag=i,this._type=o||t.Text,this._selectable="undefined"==typeof r||r}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tag",{get:function(){return this._tag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectable",{get:function(){return this._selectable},enumerable:!0,configurable:!0}),e})();e.ComboBoxItem=i;var o=(function(){function e(){this._items=[],this._dialogVisible=!1,this._selectedIndex=-1,this._separatorTag=-9}return Object.defineProperty(e.prototype,"separatorTag",{get:function(){return this._separatorTag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._dialogVisible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItem",{get:function(){return this._items[this._selectedIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(e){this._selectedIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemsCount",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onClickEvent",{set:function(e){this._onClickEvent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDropDownEvent",{set:function(e){this._onDropDownEvent=e},enumerable:!0,configurable:!0}),e.prototype.clearItems=function(){this._items=[]},e.prototype.addItem=function(e){this._items.push(e)},e.prototype.addSeparator=function(){this._items.push(new i("",(-9),t.Separator,(!1)))},e.prototype.collapse=function(){this._dialogVisible=!1},e.prototype.toggle=function(e){this._dialogVisible||this._onDropDownEvent&&this._onDropDownEvent(),this._dialogVisible=!this._dialogVisible,e.stopPropagation()},e})();e.ComboBoxModel=o})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function i(i){var o=this;this.contract=i,this.contentProviderDialogModel=new e.common.models.ModalDialogModel((!1),"Ok",(!0),(!0),(!0),(!1)),this.sharePane=new t.ShareViewModel,this.manageStoragePane=new t.ManageStorageViewModel,this.publishPane=new t.PublishContentPackViewModel,this.temporaryDashboardMap=null,this.viewMode=0,e.common.localize.ensureLocalization((function(){o.contentProviderDialogModel.confirmButtonText=e.common.localize.get("DashboardContainer_Ok")}))}return Object.defineProperty(i.prototype,"dashboards",{get:function(){return this._dashboards},set:function(e){this._dashboards=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visibleDashboards",{get:function(){return _.filter(this._dashboards,(function(e){
return!e.isHidden}))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"models",{get:function(){return this.contract.models},enumerable:!0,configurable:!0}),i.prototype.cacheTemporaryDashBoardMapping=function(e,t){this.temporaryDashboardMap={temporaryId:e,resolvedId:t}},i.prototype.calculateLayout=function(){if(this._dashboards)for(var e=0,t=this._dashboards;e<t.length;e++){var i=t[e];i.calculateLayout()}},i.prototype.applyLayout=function(e){if(this._dashboards)for(var t=0,i=this._dashboards;t<i.length;t++){var o=i[t];o.applyLayout()}},i.prototype.findDashboard=function(e){return this.dashboards[this.getDashboardIndex(e)]},i.prototype.findDashboardByGUID=function(e){var t=this.dashboards;this.temporaryDashboardMap&&this.temporaryDashboardMap.resolvedId&&this.temporaryDashboardMap.temporaryId&&this.temporaryDashboardMap.temporaryId===e&&(e=this.temporaryDashboardMap.resolvedId);for(var i=0,o=t.length;i<o;i++)if(t[i].objectId===e)return t[i]},i.prototype.getDashboardIndex=function(e){for(var t=this.dashboards,i=0,o=t.length;i<o;i++)if(t[i].id===e)return i;return-1},i})();t.DashboardContainer=i})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e[e.ImportData=0]="ImportData",e[e.ViewExcel=1]="ViewExcel"})(t=e.UploadFormat||(e.UploadFormat={}));var i;!(function(e){e[e.Local=0]="Local",e[e.OneDrive=1]="OneDrive",e[e.DropBox=2]="DropBox",e[e.OneDrivePro=3]="OneDrivePro",e[e.SharePoint=4]="SharePoint"})(i=e.HostType||(e.HostType={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.EmailsListModel,o=(function(){function t(e){this.isAdmin=!(!e||!e.contract)&&e.contract.isOwner,this.groupName=e?e.displayName:"",this.groupId="",this.emailsList=new i,this.displayMemberList=[],this.originalDisplayMemberList=[],this.invalidEmailAddressesErrorMessage="",this.notExitingEmailAddressesErrorMessage="",this.privacyOption=e&&e.contract&&e.contract.isPublic?0:1,this.accessControlOption=e&&e.contract&&e.contract.isReadOnly?1:0,this.isCapacityEnabled=e&&e.contract&&!!e.contract.capacityObjectId,this.capacity=e&&e.capacity,this.initPrivacyOptions(),this.initAccessControlOptions(),this.initMemberRoleOptions()}return t.prototype.initPrivacyOptions=function(){this.privacyOptions=[{key:0,value:e.common.localize.get("GroupEditor_PrivacyOptions_Public")},{key:1,value:e.common.localize.get("GroupEditor_PrivacyOptions_Private")}]},t.prototype.initAccessControlOptions=function(){this.accessControlOptions=[{key:0,value:e.common.localize.get("GroupEditor_AccessControlOptions_ReadWrite")},{key:1,value:e.common.localize.get("GroupEditor_AccessControlOptions_ReadOnly")}]},t.prototype.initMemberRoleOptions=function(){this.groupMemberRoleOptions=[{key:1,value:e.common.localize.get("GroupEditor_RoleOptions_Admin")},{key:0,value:e.common.localize.get("GroupEditor_RoleOptions_Member")}]},t})();t.GroupEditorModel=o})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(t){var i=this;return this.contextMenuItemList=[],t&&t.metadata&&(t.metadata.contextMenuItemList.forEach((function(e){i.contextMenuItemList.push(e)})),this.contextMenuSeparatorPosition=t.metadata.contextMenuItemList.length),0===this.contextMenuItemList.length&&(this.contextMenuSeparatorPosition=-1),t&&t.isMyWorkspace?void this.contextMenuItemList.push({linkType:e.common.contracts.GroupLinkType.EditMyWorkspace}):(t.isOwner||t.isPublic?this.contextMenuItemList.push({linkType:e.common.contracts.GroupLinkType.EditGroup}):this.contextMenuItemList.push({linkType:e.common.contracts.GroupLinkType.ViewGroup}),void this.contextMenuItemList.push({linkType:e.common.contracts.GroupLinkType.LeaveGroup}))}return t})();t.GroupMetadata=i})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.ContentTileType,o=(function(){function o(o){this.contract=o,o&&(this.aadGroupId=this.uniqueId=o.objectId,this.displayName=o.displayName,this.metadata=new t.GroupMetadata(o),this.capacity=o.capacityObjectId&&{id:o.capacityObjectId,name:o.capacityName}),this.isMyWorkspace=!(!o||!o.isMyWorkspace),this.lastViewedDashboard=-1,this.lastOwnershipFilter=e.models.OwnershipFilterMenuFilter.AllContent,this.contentTileType=i.Workspace}return o.prototype.getPermissions=function(){},o})();t.Group=o})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.showHistoryDialog=!1,this.showSpinner=!1}return e})();e.HistoryDialogModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e})();e.InsightsModel=t})(t=e.insights||(e.insights={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.models.CollapsiblePaneModel,o=(function(){function e(e){this.collapsiblePaneMode=0,this.contract=e,this.showDashboardName=!1,this.collapsiblePane=new i,this.notificationPane=new i,this.showNotificationPane=!1}return e.prototype.calculateLayout=function(){this.dashboardContainer.calculateLayout(),this.reportContainer.calculateLayout()},e.prototype.applyLayout=function(){this.dashboardContainer.applyLayout(),this.reportContainer.applyLayout()},e})();t.LandingContainer=o})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e})();e.UsageBarModel=t;var i=(function(){function e(){this.ownedByMeSelected=!0}return e})();e.ManageStorageViewModel=i})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(i){function o(e,t,i,o,r,a,n){return new g(e,t,i,o,r,a,n)}var r=e.common.constants,a=e.common.contracts,n=a.ContentProviderCategory,s=jsCommon.DateExtensions,c=e.common.helpers.ModelConverterHelper,l=e.common.models.ReportContainer,d=e.dataServices.models.Dashboard,p=e.common.controllers.EmailsListController,u=e.common.models.EmailsListModel,h=jsCommon.JsonExtensions,v=jsCommon.EnumExtensions;i.createModelConverter=o;var g=(function(){function o(e,t,i,o,r,a,n){this.telemetryService=e,this.errorService=t,this.visualPlugins=i,this.promiseFactory=o,this.geolocationService=r,this.dataServiceModelConverter=a,this.localizationService=n}return o.prototype.setModelMerger=function(e){this.modelMerger=e},o.prototype.convertAppPublishModel=function(t){var i=this.convertContentPack(t);if(i){var o=this.dataServiceModelConverter.convertAppModelBase(t),r=__assign({url:e.helpers.UrlHelper.getAppUrl(t.providerKey),displayName:t.displayText,objectId:t.providerKey,emailsList:new u,publishAsTemplate:t.category===n.OrganizationalTemplateApp,getPermissions:function(){return a.Permissions.Read|a.Permissions.CopyOnWrite}},i,o);if(_.isEmpty(t.accessPermissions.adUserMetadataList))r.emailsList.inputUserList=p.emailsToUsers(t.accessPermissions.listOfGroupsOrPrincipals);else{r.emailsList.inputUserList=t.accessPermissions.adUserMetadataList;for(var s=0,c=r.emailsList.inputUserList;s<c.length;s++){var l=c[s];l.userPrincipalName&&l.groupType!==a.GroupType.SecurityGroup&&l.groupType!==a.GroupType.EmailEnabledSecurityGroup||(l.isSecurityGroup=!0)}}return r}},o.prototype.convertLandingContainer=function(t){var o=new i.LandingContainer(t);return o.dashboardContainer=this.convertDashboardContainer(t.dashboardContainer),o.reportContainer=this.convertReportContainer(t.reportContainer),o.workbookContainer=this.convertWorkbookContainer(t.workbookContainer),o.qnaContainer=this.convertQnaContainer(t.qnaContainer),o.explorationContainer=e.explore.viewModels.ViewModelFactory.createExplorationContainer(),o},o.prototype.convertLandingContainerShallow=function(t){var o=new i.LandingContainer(t);return o.dashboardContainer=this.convertDashboardContainerShallow(t.dashboardContainer),o.reportContainer=this.convertReportContainerShallow(t.reportContainer),o.explorationContainer=e.explore.viewModels.ViewModelFactory.createExplorationContainer(),o},o.prototype.convertReportContainerShallow=function(e){var t=new l(e);return t},o.prototype.convertReportContainer=function(e){var t=this.convertReportContainerShallow(e);return this.fillReportContainerChildren(t,e),t},o.prototype.fillReportContainerChildren=function(e,t){t&&(e.report=this.convertReport(t),this.fillReport(e.report,t))},o.prototype.fillReport=function(e,t){this.dataServiceModelConverter.fillReport(e,t)},o.prototype.fillModel=function(e,t){this.dataServiceModelConverter.fillModel(e,t)},o.prototype.convertReport=function(e){return this.dataServiceModelConverter.convertReport(e)},o.prototype.convertPackage=function(e){return this.dataServiceModelConverter.convertPackage(e)},o.prototype.convertQnaContainerShallow=function(e){var t=new i.QnaContainer(e);return t},o.prototype.convertQnaContainer=function(e){var t=this,i=this.convertQnaContainerShallow(e);return e.models&&(i.models=e.models.map((function(e){return t.convertModel(e)}))),i},o.prototype.convertWorkbookContainerShallow=function(e){var t=new i.WorkbookContainer(e);return t},o.prototype.convertWorkbookContainer=function(e){var t=this.convertWorkbookContainerShallow(e);return this.fillWorkbookContainerChildren(t,e),t},o.prototype.fillWorkbookContainerChildren=function(e,t){t&&(e.workbook=this.convertWorkbook(t))},o.prototype.convertWorkbook=function(e){return this.dataServiceModelConverter.convertWorkbook(e)},o.prototype.convertWorkbookShallow=function(e){return this.dataServiceModelConverter.convertWorkbookShallow(e)},o.prototype.convertModel=function(e){return this.dataServiceModelConverter.convertModel(e)},o.prototype.convertContentPack=function(e){var t=this.dataServiceModelConverter.convertContentPackBase(e);if(e){var i=__assign({publishedTo:this.findPublishedTo(e.accessPermissions),isDirty:e.isDirty,listOfGroupPrincipals:e.accessPermissions.listOfGroupsOrPrincipals,isSharedToEntireOrg:e.accessPermissions.isSharedToEntireOrganization},t);return i}},o.prototype.findPublishedTo=function(e){if(e.isSharedToEntireOrganization)return this.localizationService.get("GetData_MyOrganization");var t=this.localizationService.get("PowerBI_Semicolon_Delimiter");if(e.adUserMetadataList)return _.map(e.adUserMetadataList,(function(e){return e.displayName||e.userPrincipalName})).join(t);var i=e.listOfGroupsOrPrincipals;return i.join(t)},o.prototype.convertReportShallow=function(e){return this.dataServiceModelConverter.convertReportShallow(e)},o.prototype.convertModelShallow=function(e){return this.dataServiceModelConverter.convertModelShallow(e)},o.prototype.convertPackageShallow=function(e){return this.dataServiceModelConverter.convertPackageShallow(e)},o.prototype.convertDashboardContainerShallow=function(e){var t=new i.DashboardContainer(e);return t.activeViewMode=e.activeViewMode,t.userId=e.userId,t},o.prototype.fillDashboardContainerDashboard=function(e,t){var i=this;if(t.dashboards&&1===t.dashboards.length){var o=t.packages||[],r=t.dashboards[0];r.tiles&&r.tiles.map((function(e){i.resolveTilePackage(e,o)}))}},o.prototype.setDashboardHasUpdate=function(e,t){e.hasUpdate=!1;var i=_.find(t,(function(t){return t.id===e.contract.originalPackageId}));i&&i.latestVersion&&i.version!==i.latestVersion&&(e.hasUpdate=!0)},o.prototype.setDashboardsHasUpdate=function(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];o.hasUpdate=!0}},o.prototype.fillDashboardContainerDashboards=function(e,t){t.dashboards&&(e.userId=t.userId,this.fillDashboardContainerDashboardsFromBasicDashboardContainer(e,t))},o.prototype.fillDashboardContainerDashboardsFromBasicDashboardContainer=function(e,t){var i=this;if(t.dashboards){var o=t.reports||[],r=t.workbooks||[],a=t.models||[],n=t.packages||[];e.dashboards=t.dashboards.map((function(e){var s=i.convertDashboard(e,a,o,r);return i.setDashboardHasUpdate(s,n),e.id===t.activeDashboardId&&s.contract.tiles&&s.contract.tiles.map((function(e){i.resolveTilePackage(e,n)})),s}))}},o.prototype.updateDashboardContainerContract=function(e,t){this.updateDashboardContainerContractFromBasicDashboardContainer(e,t),e.groups=t.groups,e.userId=t.userId,e.previousTenantId=t.previousTenantId,e.accessRequestInfo=t.accessRequestInfo},o.prototype.updateDashboardsReportContract=function(e,t){t.reportIds.splice(e,1)},o.prototype.removeDashboardsWorkbookContract=function(e,t){t.workbookIds.splice(e,1)},o.prototype.updateDashboardContainerContractFromBasicDashboardContainer=function(e,t){var i=t.dashboards;void 0===t.activeDashboardId&&i&&i.length>0&&(t.activeDashboardId=i[0].id),this.modelMerger.mergeModelContentProviderId(t.models,t.packages),e.dashboards=i,e.activeDashboardId=t.activeDashboardId,e.models=t.models,e.reports=t.reports,e.workbooks=t.workbooks,e.packages=t.packages},o.prototype.resolveTilePackage=function(e,t){this.dataServiceModelConverter.resolveTilePackage(e,t)},o.prototype.getTileModel=function(e,t){return this.dataServiceModelConverter.getTileModel(e,t)},o.prototype.getTileReport=function(e,t){return this.dataServiceModelConverter.getTileReport(e,t)},o.prototype.getTileWorkbook=function(e,t,i){return this.dataServiceModelConverter.getTileWorkbook(e,t,i)},o.prototype.fillDashboardContainerDashboardsShallow=function(e,t){var i=this;t.dashboards&&(e.dashboards=t.dashboards.map((function(e){return i.convertDashboardShallow(e)})))},o.prototype.convertDashboardContainer=function(e){var t=this.convertDashboardContainerShallow(e);return this.fillDashboardContainerDashboards(t,e),e.activityPane&&(t.activityPane=this.convertActivityPane(e.activityPane)),t},o.prototype.convertActivityPane=function(e){var t=this,i=this.convertActivityPaneShallow(e);return e.contentProviders||(i.contentProviders=e.contentProviders.map((function(e){return t.convertContentProvider(e)}))),i},o.prototype.convertActivityPaneShallow=function(e){var t=new i.ActivityPaneModel(e);return t},o.prototype.convertContentProvider=function(t){if(!t)return null;var o=new i.ProviderTileModel(t);return o.backgroundImageUrl=e.build+t.iconUrl,o.displayText=t.displayText,o},o.prototype.convertContentProviderContractToContentProviderTileModel=function(e){var t=null;if(e){var i=this.promiseFactory.defer();e.authentication||i.resolve(""),t={contract:e,id:e.id,title:e.displayText,category:e.category,clientCategory:c.getContentProviderClientCategory(e),providerName:e.providerName,iconUrl:e.iconUrl?jsCommon.Utility.urlCombine(clusterUri,e.iconUrl):null,iconCSSClass:e.iconCSSClass,descriptionLocalizationKey:e.description,learnMoreUrl:e.learnMoreUrl,searchKeywords:e.searchKeywords,publisher:e.publisher,publishDate:e.publishDate,emailAddress:null,emailAddressAsLink:null,visible:!1,disableDetailPane:e.disableDetailPane,sortPriority:null!==e.sortPriority&&void 0!==e.sortPriority?e.sortPriority:r.contentProviderStoreTileMaxSortPriority,authentication:e.authentication,authenticationInitializationDeferred:i,authenticationInitializationInProgress:!0,finePrint:e.finePrint,autoRedirectUrlParams:e.autoRedirectUrlParams,customConfigurationHandler:e.customConfigurationHandler,tileGrouping:null,usePBIDesktop:e.usePBIDesktop}}return t},o.prototype.convertContentProviderContractToContentProviderTileModelWithGrouping=function(e){var t=null;return e&&(t={contract:e,id:e.id,title:e.grouping.groupingName,category:e.category,clientCategory:c.getContentProviderClientCategory(e),providerName:e.providerName,iconUrl:e.iconUrl?jsCommon.Utility.urlCombine(clusterUri,e.iconUrl):null,iconCSSClass:e.iconCSSClass,descriptionLocalizationKey:e.grouping.groupingDescription,learnMoreUrl:e.learnMoreUrl,searchKeywords:e.searchKeywords||"",publisher:e.publisher,publishDate:null,emailAddress:null,emailAddressAsLink:null,visible:!1,disableDetailPane:e.disableDetailPane,sortPriority:null!==e.sortPriority&&void 0!==e.sortPriority?e.sortPriority:r.contentProviderStoreTileMaxSortPriority,authentication:null,authenticationInitializationDeferred:null,authenticationInitializationInProgress:!1,finePrint:e.finePrint,autoRedirectUrlParams:null,customConfigurationHandler:null,tileGrouping:{groupingChildItems:[]}}),t},o.prototype.groupContentProviderTileModels=function(e){for(var t,i,o=[],a={},n=[],s=0,c=e;s<c.length;s++){var l=c[s];l.contract.grouping&&l.contract.grouping.groupingName&&l.contract.grouping.groupingName.length>0?(t=l.contract.grouping.groupingName,a[t]||(i=this.convertContentProviderContractToContentProviderTileModelWithGrouping(l.contract),a[t]=i,n.push(t),o.push(i)),i=a[t],i.searchKeywords=i.searchKeywords.concat(" ",l.searchKeywords||""," ",l.title.toLowerCase()),l.sortPriority=l.contract.grouping.groupingIndex,jQuery.isNumeric(l.sortPriority)||(l.sortPriority=r.contentProviderStoreTileMaxSortPriority),i.tileGrouping.groupingChildItems.push(l)):o.push(l)}return o},o.prototype.convertDashboardShallow=function(e){var t=new d(e);return this.modelMerger.mergeDashboardShallow(t,e),t},o.prototype.convertDashboard=function(e,t,i,o){return this.dataServiceModelConverter.convertDashboard(e,t,i,o)},o.prototype.fillDashboardChildren=function(e,t,i,o){return this.dataServiceModelConverter.fillDashboardChildren(e,t,i,o)},o.prototype.convertTileShallow=function(e,t,i){return this.dataServiceModelConverter.convertTileShallow(e,t,i)},o.prototype.convertSpecificTileShallow=function(e,t){return this.dataServiceModelConverter.convertSpecificTileShallow(e,t)},o.prototype.convertTile=function(e,t,i,o){return this.dataServiceModelConverter.convertTile(e,t,i,o)},o.prototype.convertCompositeTile=function(e){return this.dataServiceModelConverter.convertCompositeTile(e)},o.prototype.convertTileData=function(e){return this.dataServiceModelConverter.convertTileData(e)},o.prototype.convertImageTile=function(e){return this.dataServiceModelConverter.convertImageTile(e)},o.prototype.convertWorkbookTile=function(e,t,i){return this.dataServiceModelConverter.convertWorkbookTile(e,t,i)},o.prototype.convertReportTile=function(e){return this.dataServiceModelConverter.convertReportTile(e)},o.prototype.convertModelTile=function(e){return this.dataServiceModelConverter.convertModelTile(e)},o.prototype.convertIframeTile=function(e){return this.dataServiceModelConverter.convertIframeTile(e)},o.prototype.convertSsrsTile=function(e){return this.dataServiceModelConverter.convertSsrsTile(e)},o.prototype.convertRealTimeTile=function(e){return this.dataServiceModelConverter.convertRealTimeTile(e)},o.prototype.convertTileConfig=function(e){return this.dataServiceModelConverter.convertTileConfig(e)},o.prototype.convertTileAction=function(e){return this.dataServiceModelConverter.convertTileAction(e)},o.prototype.convertUserSettings=function(e){var t=new i.UserSettings(e);return t.allowQnaDataCollection=null==e.allowQnaDataCollection||e.allowQnaDataCollection,t.tileDialogPreviewFormat=e.tileDialogPreviewFormat,t.preferredLanguage=e.preferredLanguage,t.extendedSettings=h.tryParseJSON(e.extendedSettings),t.esriVisualEnabled=null!=e.esriVisualEnabled&&e.esriVisualEnabled,t},o.prototype.convertSettingsMetadata=function(e){return{dashboards:this.convertSettingsDashboards(e.dashboards),general:this.convertSettingsGeneral(e.userSettings),datasets:this.convertSettingsDatasets(e.datasetModels||[]),workbooks:this.convertSettingsDatasets(e.workbookModels||[])}},o.prototype.convertSettingsDashboards=function(e){var t=this;return{dashboards:_.map(e,(function(e){return t.convertSettingsDashboard(e)}))}},o.prototype.convertSettingsDashboard=function(e){return{dashboardId:e.id,hasQnaSupportedModel:e.hasQnaSupportedModel,name:e.displayName,objectId:e.objectId,qnaEnabled:e.qnaEnabled,gravityEnabled:e.gravityEnabled,dataClassificationId:e.dataClassificationId}},o.prototype.convertSettingsEsri=function(e){return{esriVisualEnabled:null!=e.esriVisualEnabled&&e.esriVisualEnabled}},o.prototype.convertSettingsGeneral=function(e){return{privacy:this.convertSettingsPrivacy(e),language:this.convertSettingsLanguage(e),esri:this.convertSettingsEsri(e)}},o.prototype.convertSettingsPrivacy=function(e){return{allowQnaDataCollection:null==e.allowQnaDataCollection||e.allowQnaDataCollection}},o.prototype.convertSettingsLanguage=function(e){return{preferredLanguage:e.preferredLanguage}},o.prototype.convertSettingsDatasets=function(e){var t=this;return{datasets:_.map(e,(function(e){return t.convertSettingsDataset(e)}))}},o.prototype.convertSettingsDataset=function(e){return e&&!e.contentProviderId&&e.packageContentProviderId&&(e.contentProviderId=e.packageContentProviderId),c.convertModelToDataset(e)},o.prototype.getImageUrl=function(e){return this.dataServiceModelConverter.getImageUrl(e)},o.prototype.getSsrsImageUrl=function(e){return this.dataServiceModelConverter.getSsrsImageUrl(e)},o.prototype.convertDashboardInvitation=function(e){var t=this,i=[];return null==e||""===e.toString()?[]:i=e.map((function(e){return t.convertToUserInvitation(e)}))},o.prototype.convertToUserInvitation=function(e){var t=new i.UserInvitationModel;return t.dashboardId=e.dashboardId,t.id=e.id,t.permissions=e.permissions,t.sentToEmailAddress=e.sentToEmailAddress,t},o.prototype.convertDashboardAccessInfoArray=function(e){var t=this;return null==e||_.isEmpty(e.toString())?[]:_.map(e,(function(e){return t.convertDashboardAccessInfo(e)}))},o.prototype.convertDashboardAccessInfo=function(e){var t=new i.DashboardAccessInfoModel;return t.emailAddress=e.emailAddress,t.id=e.id,t.kind=e.kind,t.permissions=e.permissions,t.givenName=e.givenName,t.familyName=e.familyName,t.fullName=e.givenName,e.familyName?t.fullName=t.fullName+" "+e.familyName:_.isEmpty(t.fullName)&&(t.fullName=t.emailAddress),t},o.prototype.convertCuratedContent=function(e,t){if(!e)return null;var o=[],r=[],a=[],n=[],s=new i.ActivityPaneCuratedContentModel,c=e.activityPaneData;t||c&&c.length>0&&(t=new i.ComboBoxItem(c[0].packageName,c[0].packageId));var l=_.filter(c,(function(e){return e.packageId===t.tag}));return l&&1===l.length&&(l[0].models&&(n=l[0].models),l[0].reports&&(o=l[0].reports),l[0].dashboards&&(r=l[0].dashboards),l[0].tiles&&(a=l[0].tiles),s.packageId=l[0].packageId),s.addModels(n),s.addReports(o),s.addDashboards(r),s.addTiles(a),s},o.prototype.convertAlertsEditorPane=function(e,i,o){return{contract:e,title:e.title,tileName:i.getDisplayText(),measureName:o,thresholdValue:e.rule.condition.compareToAValue.value.toString(),enabled:e.enabled,operator:e.rule.condition.compareToAValue.operator,frequency:e.notificationSetting.frequency,emailNotificationEnabled:v.hasFlag(e.notificationSetting.carrierType,2),isExpanded:!1,isNew:!1,alertFailureState:t.AlertFailureState.None}},o.prototype.convertAlertModelToContract=function(e,t,i){var o=e.contract;return{id:o?o.id:null,rule:i,modelId:t.contract.modelId,tileId:t.id,notificationSetting:{carrierType:e.emailNotificationEnabled?3:1,frequency:e.frequency},enabled:e.enabled,title:e.title,dashboard:o?o.dashboard:null,group:o?o.group:null,tile:o?o.tile:null,createdDateTimeUtc:o?o.createdDateTimeUtc:null,alertQueryFilters:[]}},o.prototype.convertSettingsAlerts=function(e,t){var i=moment(t.createdDateTimeUtc.toLocaleString()+"Z").toDate();return{contract:t,alertCreatedDate:s.GetFullDateWithTime(e,i),alertTitle:t.title,dashboardName:t.dashboard?t.dashboard.displayName:null,enabled:t.enabled}},o})()})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=jsCommon.EnumExtensions,r=e.explore.viewModels,a=e.common.contracts.Permissions,n=e.dataServices.models.RealTimeModel,s=e.data.SemanticFilter,c=e.dataServices.TileDefaultSizesUtils,l=e.dataServices.TileUtils,d=e.explore.util.VisualContainerUtils;!(function(t){function i(e,t,i,o,a,n,s,c){var l=[];return m(s,o)&&l.push(r(0,e,"Duplicate_Dashboard")),t.featureSwitches.printingEnabled!==!1&&l.push(r(2,e,"Print_Dashboard")),!a.disableDashboardRefresh&&v(s)&&l.push(r(3,e,"Refresh_Dashboard")),t.featureSwitches.perfInspector&&!a.disablePerfInspector&&l.push(r(1,e,"PerfInspector")),g(s)&&l.push(r(7,e,"ContentTileOptions_Settings")),l}function r(e,t,i){return{text:t.get(i),action:e,type:DropDownMenuItemType.Item}}function s(e){var t=[];return t.push({text:e.get("Dashboard_Authoring_Delete_Phone_View"),action:9,type:DropDownMenuItemType.Item}),t}function d(e,t){return{dashboardPane:p(e,t),mobileDashboard:e}}function p(e,t){return void 0===t&&(t=!0),{dashboard:e,isPaneExpanded:t}}function u(e){for(var t=1,i=[],o=1,r=1,a=0,n=e;a<n.length;a++){var s=n[a];i.push(l.createDefaultPhoneByTile(o,r,s)),o+=c.getRowSpan(s,t)}return i}function h(){var t={name:"",columns:[],mode:e.common.contracts.RealTimeMode.CacheOnly},i=new n(null,t);return i.isNew=!0,i}function v(e){return!!e}function g(e){return e&&(o.hasFlag(e.getPermissions(),a.All)||o.hasFlag(e.getPermissions(),a.ReadWrite))}function m(e,t){return e&&e.canEdit&&!t.isActiveWorkspaceIsReadOnly&&o.hasFlag(e.getPermissions(),a.ReShare)}t.createDashboardMenuItems=i,t.createDashboardMenuItemsAuthoringContext=s,t.createDashboardEditMobileDisplay=d,t.createDashboardPane=p,t.createDefaultPhonePositions=u,t.createDefaultRealTimeModel=h})(i=t.modelFactory||(t.modelFactory={}));var p;!(function(t){function i(e,t,i){return{canvas:a(e,i),taskPane:{isPaneExpanded:!1},visualizationPane:{sections:[],activeSection:0,pagePaneSections:[],activePageSection:0,isPaneExpanded:!1,visualPluginFilter:function(e){var i=t.tryGetFilterPropertyIdentifier(e.capabilities);return!i}},showVisualEnabled:!1,inFocusTile:null,dashboardText:"",displayText:"",subDisplayText:"",source:"",pinVisualText:"",getRelatedInsightsText:"",workbook:null,realTime:null,showInsightsPane:!1,showPreviousVisualButton:!1}}function o(e,t){var i=[];return i.push({text:e.get("InFocus_GenerateQrCode"),action:0,type:DropDownMenuItemType.Item}),t&&i.push({text:e.get("ExportData_MenuItem"),action:1,type:DropDownMenuItemType.Item}),i}function a(e,t){var i={id:0,name:d.uniqueName(e.visualContainers),config:{},layouts:jsCommon.ArrayExtensions.extendWithId([{id:t,position:c()}])},o={visual:{visualContainer:r.ViewModelFactory.convertVisualContainerStandalone(i,t)},exploration:n(e)},a=o.visual.visualContainer;return a.overridePosition=c(),a.allowDeferredRendering=!0,a.hostServices={deleteVisualRelationships:_.noop,getFilters:function(){var t=[],i=a.contract.filters||[];i=i.concat(e.filters||[]);for(var o=0,r=i;o<r.length;o++){var n=r[o],c=n.filter;c&&t.push(c)}return{dataFilter:s.merge(t),highlightFilter:null}},getVisualRelationshipFilterAction:function(){return 0},selectDataPoint:function(){},setVisualRelationshipFilterAction:_.noop,clearHighlight:function(){}},o}function n(t){var i={width:t.size.width,height:t.size.height,dataSources:e.explore.contracts.createDataSourceArray(),sections:[t]};return e.explore.viewModels.ViewModelFactory.convertExploration(i,0)}function c(){return{x:0,y:0,width:1024,height:768}}t.createInFocus=i,t.createInFocusMenuItems=o})(p=t.inFocusViewModelFactory||(t.inFocusViewModelFactory={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i){return new a(e,t,i)}var o=e.common.helpers.ModelConverterHelper,r=e.dataServices.ContractUtils;t.createModelMerger=i;var a=(function(){function e(e,t,i){this.permissionService=i,this.modelConverter=e,this.dataServiceModelMerger=t}return e.prototype.mergeDashboard=function(e,t,i,o,r){this.dataServiceModelMerger.mergeDashboard(e,t,i,o,r)},e.prototype.mergeDashboardShallow=function(e,t){this.dataServiceModelMerger.mergeDashboardShallow(e,t)},e.prototype.mergeDashboardOwnerInfo=function(e,t){this.dataServiceModelMerger.mergeDashboardOwnerInfo(e,t)},e.prototype.mergeDashboardTiles=function(e,t){this.dataServiceModelMerger.mergeDashboardTiles(e,t)},e.prototype.mergeTileShallow=function(e,t,i,o){this.dataServiceModelMerger.mergeTileShallow(e,t,i,o)},e.prototype.mergeTile=function(e,t,i,o,r,a){this.dataServiceModelMerger.mergeTile(e,t,i,o,r,a)},e.prototype.mergeResourceWithIdArrays=function(e,t){for(var i=e.slice(0),o=function(e){_.filter(t,(function(t){return t.id===e.id})).length>0&&i.splice(i.indexOf(e),1)},r=0,a=e;r<a.length;r++){var n=a[r];o(n)}return i.concat(t)},e.prototype.mergeModelContentProviderId=function(e,t){if(e)for(var i=0,o=e;i<o.length;i++){var a=o[i];a.contentProviderId=a.contentProviderId||r.findContentProviderId(t,a.packageId)}},e.prototype.mergeReport=function(e,t){var i=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.objectId=t.objectId||e.objectId,e.modelId=t.modelId||e.modelId,e.reportUrl=t.reportUrl||e.reportUrl,e.packagePublishStatus=t.packagePublishStatus||e.packagePublishStatus,e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.fileName=t.fileName||e.fileName,e.packageId=t.packageId||e.packageId,e.packageVersion=t.packageVersion||e.packageVersion,e.contentProviderId=t.contentProviderId||e.contentProviderId,e.getPermissionsCallback=function(){return i.permissionService.getReportEffectivePermissions(t)})},e.prototype.mergeModel=function(e,t){var i=this;e&&t&&(e.contract=t,e.id=t.id||e.id,e.isNew=t.isNew||e.isNew,e.getPermissionsCallback=function(){return i.permissionService.getModelEffectivePermissions(t)},e.name=t.name||e.name,e.displayName=t.displayName||e.displayName,e.description=t.description||e.description,e.fileName=t.fileName||e.fileName,e.packageId=t.packageId||e.packageId,e.packageVersion=t.packageVersion||e.packageVersion,e.contentProviderId=t.contentProviderId||e.contentProviderId,e.qnaSupported=t.qnaSupported,e.packagePublishStatus=null!=t.packagePublishStatus?t.packagePublishStatus:e.packagePublishStatus,e.isRefreshInProgress=t.currentRefreshStartingTime&&o.convertRefreshTimeToJsDateTime(t.currentRefreshStartingTime).getTime()+18e5>Date.now(),e.cloudRlsEnabled=t.cloudRlsEnabled)},e.prototype.mergeWorkbook=function(e,t){this.dataServiceModelMerger.mergeWorkbook(e,t)},e.prototype.mergePackage=function(e,t){this.dataServiceModelMerger.mergePackage(e,t)},e})()})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.contracts.Permissions,o=(function(){function o(e){this.source=e,this.isNameEditable=!1,this.metadata=[],this.actions=[],this.icon=t.NavigationPaneListItemIcon.None}return o.getDashboardPermissionString=function(t){var o;return e.common.localize.ensureLocalization((function(){switch(t){case i.All:o=e.common.localize.get("DashboardContextMenu_AllPermissionMessage");break;case i.None:o=e.common.localize.get("DashboardContextMenu_NonePermissionMessage");break;case i.Read:o=e.common.localize.get("DashboardContextMenu_ReadPermissionMessage");break;case i.ReadReshare:o=e.common.localize.get("DashboardContextMenu_ReadResharePermissionMessage");break;case i.ReadWrite:o=e.common.localize.get("DashboardContextMenu_ReadWritePermissionMessage");break;case i.ReShare:o=e.common.localize.get("DashboardContextMenu_ReSharePermissionMessage");break;case i.Write:o=e.common.localize.get("DashboardContextMenu_WritePermissionMessage");break;default:o=e.common.localize.get("DashboardContextMenu_UnknownPermissionMessage")}})),o},o})();t.DashboardNavigationPaneListItemModel=o})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function t(t){this.source=t,this.isNameEditable=!1,this.metadata=[],this.actions=[],this.icon=e.NavigationPaneListItemIcon.None}return t})();e.DatasetNavigationPaneListItemModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function t(t){this.source=t,this.isNameEditable=!1,this.metadata=this.getGroupMetadata(t),this.actions=this.getGroupActions(t),t.isMyWorkspace?this.icon=e.NavigationPaneListItemIcon.User:this.icon=e.NavigationPaneListItemIcon.Group}return t.prototype.getGroupMetadata=function(e){var t=[];return t},t.prototype.getGroupActions=function(e){var t=[];return t.push({text:"'"+e.displayName+"' 1",action:function(){}}),t.push({text:"'"+e.displayName+"' 2",action:function(){}}),t.push({text:"'"+e.displayName+"' 3",action:function(){}}),t},t})();e.GroupNavigationPaneListItemModel=t;
})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e[e.None=0]="None",e[e.Shared=1]="Shared",e[e.ReadOnly=2]="ReadOnly",e[e.Group=3]="Group",e[e.User=4]="User",e[e.Workbook=5]="Workbook"})(t=e.NavigationPaneListItemIcon||(e.NavigationPaneListItemIcon={}));var i=(function(){function e(){}return e})();e.NavigationPaneListItemModel=i})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function t(t){this.source=t,this.isNameEditable=!1,this.metadata=[],this.actions=[],this.icon=e.NavigationPaneListItemIcon.None}return t})();e.ReportNavigationPaneListItemModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function t(t){this.source=t,this.isNameEditable=!1,this.metadata=[],this.actions=[],this.icon=e.NavigationPaneListItemIcon.Workbook}return t})();e.WorkbookNavigationPaneListItemModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.dashboardTile=e,this.reportTile=e,this.workbookTile=e,this.hasTileFormatting=!0}return e})();e.PinTileDialogModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){})(t=e.PowerBICompanionModel||(e.PowerBICompanionModel={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){})(t=e.PowerBIConnectorModel||(e.PowerBIConnectorModel={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){})(t=e.PowerBIOnPremGatewayModel||(e.PowerBIOnPremGatewayModel={}))})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){e&&(this.isDefaultImageUsed=!e.icon),this.contentPackCreatedFor=!1}return e})();e.PublishContentPackViewModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e})();e.QrCodeDialogModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Privacy=0]="Privacy",e[e.CloseAccount=1]="CloseAccount",e[e.Language=2]="Language",e[e.Plugins=3]="Plugins",e[e.Esri=5]="Esri"})(t=e.SettingsGeneralSubgroupType||(e.SettingsGeneralSubgroupType={}));var i=(function(){function e(e,t){this.type=e,this.name=t}return e})();e.GeneralSubGroup=i})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.type=e,this.name=t}return e})();e.SettingsGroup=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i,o=e.common.contracts.Permissions;!(function(e){e[e.Default=0]="Default",e[e.SharedUsers=1]="SharedUsers",e[e.InvitedUsers=2]="InvitedUsers",e[e.RequestingUsers=3]="RequestingUsers"})(i=t.SharingUserList||(t.SharingUserList={}));var r;!(function(e){e[e.ReadOnly=0]="ReadOnly",e[e.ReadReshare=1]="ReadReshare",e[e.StopSharing=2]="StopSharing"})(r=t.SharingOptions||(t.SharingOptions={}));var a=(function(){function e(){}return e})();t.UserInvitationModel=a;var n=(function(){function t(){}return Object.defineProperty(t.prototype,"permissionsDisplayText",{get:function(){return(this.permissions&o.ReadReshare)===o.ReadReshare?e.common.localize.get("PermissionCenter_ReadAndReshare"):(this.permissions&o.Read)===o.Read?e.common.localize.get("PermissionCenter_Read"):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExternalUser",{get:function(){return this._isExternalUser},set:function(e){this._isExternalUser=e,this.allowedActions=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sharingPermissionsOptions",{get:function(){if(this.allowedActions)return this.allowedActions;var t=[];return(this.permissions&o.ReShare)===o.ReShare?t.push({text:e.common.localize.get("PermissionCenter_Read"),action:r.ReadOnly,id:this.id,type:DropDownMenuItemType.Item,kind:this.kind}):this.isExternalUser||t.push({text:e.common.localize.get("PermissionCenter_ReadAndReshare"),action:r.ReadReshare,id:this.id,type:DropDownMenuItemType.Item,kind:this.kind}),t.push({text:e.common.localize.get("PermissionCenter_RemoveAccess"),action:r.StopSharing,id:this.id,type:DropDownMenuItemType.Item,kind:this.kind}),this.allowedActions=t,this.allowedActions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emailAddressAsLink",{get:function(){return"mailto:"+this.emailAddress},enumerable:!0,configurable:!0}),t})();t.DashboardAccessInfoModel=n;var s=(function(){function e(){this.allowReshare=!0}return Object.defineProperty(e.prototype,"hasValidationError",{get:function(){return!_.isEmpty(this.emailValidationError)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasValidationWarning",{get:function(){return!_.isEmpty(this.emailValidationWarning)},enumerable:!0,configurable:!0}),e})();t.ShareViewModel=s})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.contract=e}return e})();e.ProviderTileModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,a,n){return t.isE2ERun?{itemKeys:[],items:{}}:window.initialDashboardContainer&&jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(window.initialDashboardContainer.previousTenantId)?c.createTutorialModel(o,a,i,n,r):{itemKeys:["WelcomeToNewPowerBI","ViewArchivedContent"],items:{WelcomeToNewPowerBI:{title:"<div class='archived-content'>"+o.get("TutorialPopup_WelcomeArchivedContentTitle")+"</div>",text:"<div class='archived-content'>"+o.get("TutorialPopup_WelcomeArchivedContentParagraphOne")+"<br/><br/>"+o.get("TutorialPopup_WelcomeArchivedContentParagraphTwo")+"<br/><br/ >"+o.get("TutorialPopup_WelcomeArchivedContentGoingForward")+"</div><div class='archived-content-caption archived-content-caption-title archived-content-caption-left'>"+o.get("TutorialPopup_ArchivedContentTitle")+"</div><div class='archived-content-caption archived-content-caption-left'>"+o.get("TutorialPopup_ArchivedContentText")+"<br/><br/></div><div class='tenant-merge-picture'></div><div class='archived-content-caption archived-content-caption-title archived-content-caption-right'>"+o.get("TutorialPopup_ForYourOrganizationTitle")+"</div><div class='archived-content-caption archived-content-caption-right'>"+o.get("TutorialPopup_ForYourOrganizationText")+"</div><div class='archived-content-learn-more'><a target='_blank' href='https://go.microsoft.com/fwlink/?LinkId=615080'>"+o.get("TutorialPopup_WelcomeArchivedContentLearnMoreLinkText")+"</a></div>",buttonLabel:o.get("TutorialPopup_GotIt")+'<i class="check ms-Icon ms-Icon--check get-data-icon archived-content"></i>',modalButtonClassOverride:"archived-content-override",canShow:function(){return 0===$(".loading.intro").length},attachTo:function(){return $("body")},modal:!0},ViewArchivedContent:{title:o.get("TutorialPopup_ViewArchivedContentTitle"),text:o.get("TutorialPopup_ViewArchivedContentText"),buttonLabel:o.get("TutorialPopup_GotIt"),canShow:function(){return $(".navigationPane .viewArchivedContent").length>0},attachTo:function(){return $(".navigationPane").hasClass("isCollapsed")?$(".navigationPane .expanderBtn"):$(".navigationPane .viewArchivedContent")},offset:s.connectData}}}}function i(e){var t="GroupCapacitySettings";return{itemKeys:[t],items:{GroupCapacitySettings:{title:e.get("TutorialPopup_GroupCapacitySettingsTitle"),text:e.get("TutorialPopup_GroupCapacitySettingsText"),buttonLabel:e.get("TutorialPopup_GotIt"),canShow:function(){return $(".advanced").length>0},attachTo:function(){return $(".advanced")},iconClass:"pbi-glyph-diamond",offset:s.groupCapacitySettings,dataStoreKey:t}}}}function o(e){var t="WelcomeToConsumptionUI",i=e.get("TutorialPopup_WelcomeToConsumptionUITitle"),o="<h1>"+i+"</h1>",r=e.get("TutorialPopup_WelcomeToConsumptionUIDescription"),a="<p>"+r+"</p>";return{itemKeys:[t],items:{WelcomeToConsumptionUI:{title:o,text:a,buttonLabel:e.get("TutorialPopup_GotIt"),modalButtonClassOverride:"tutorial-consumption-ui-button-override",canShow:function(){return 0===$(".loading.intro").length},attachTo:function(){return $("body")},modal:!0,customClass:"tutorial-consumption-ui-container",overlayOptions:0,dataStoreKey:t}}}}function r(e){var t="WelcomeToCapacity",i=$("<div>"),o='<div class="tutorial-capacity-title">'+e.get("TutorialPopup_WelcomeToCapacityTitle")+"</div>",r=$(o);r.appendTo(i),$("<div>").addClass("tutorial-capacity-header").text(e.get("TutorialPopup_AddedToCapacity")).appendTo(i);var a=$("<div>");$("<div>").addClass("tutorial-capacity-picture").appendTo(a);var n='<div class="tutorial-capacity-text"><div class="description-title">'+e.get("TutorialPopup_WelcomeToCapacityText")+'</div><ul><li><i class="glyphicon pbi-glyph-diamond glyph-normal"></i>'+e.get("TutorialPopup_WelcomeToCapacityText1")+"</li><li>"+e.get("TutorialPopup_WelcomeToCapacityText2")+'</li></ul><a target="_blank" href="https://go.microsoft.com/fwlink/?linkid=845343">'+e.get("TutorialPopup_WelcomeToCapacityLearnMore")+"</a></div>";return $(n).appendTo(a),{itemKeys:[t],items:{WelcomeToCapacity:{title:i.html(),text:a.html(),buttonLabel:e.get("TutorialPopup_GotIt"),modalButtonClassOverride:"tutorial-capacity-button-override",canShow:function(){return 0===$(".loading.intro").length},attachTo:function(){return $("body")},modal:!0,customClass:"tutorial-capacity-container",overlayOptions:0,dataStoreKey:t}}}}function a(e,t){var i="WelcomeProTrial",o=$("<div>"),r='<div class="tutorial-protrial-title">'+e.get("TutorialPopup_WelcomeTitle")+"</div>",a=$(r);a.appendTo(o),$("<div>").addClass("tutorial-protrial-header").text(e.get("TutorialPopup_WelcomeFreeTrial_Header")).appendTo(o);var n=$("<div>");$("<div>").addClass("tutorial-protrial-picture").appendTo(n);var s='<div class="tutorial-protrial-text"><div class="description-title">'+e.get("TutorialPopup_WelcomeFreeTrialText_Line1")+"</div><ul><li>"+e.get("TutorialPopup_WelcomeFreeTrialText_Line2")+"</li><li>"+e.get("TutorialPopup_WelcomeFreeTrialText_Line3")+"</li></ul></div>";return $(s).appendTo(n),{itemKeys:[i],items:{WelcomeProTrial:{title:o.html(),text:n.html(),buttonLabel:e.get("TutorialPopup_WelcomeFreeTrial_Button"),modalButtonClassOverride:"tutorial-protrial-button-override",onButtonClick:t,canShow:function(){return 0===$(".loading.intro").length},attachTo:function(){return $("body")},modal:!0,customClass:"tutorial-protrial-container",overlayOptions:0,dataStoreKey:i,includeNewUser:!0}}}}function n(e){var t="ConvertTable",i=".visualizationPane .visual-types-container";return{itemKeys:[t],items:{ConvertTable:{title:e.get("ConvertTableDialog_TutorialTitle"),text:"<div>"+e.get("ConvertTableDialog_TableDetected")+"</div>",learnMoreText:e.get("LearnMore"),learnMoreUrl:"https://go.microsoft.com/fwlink/?linkid=840927",buttonLabel:e.get("TutorialPopup_GotIt"),canShow:function(){return!!document.body.querySelector(i)},attachTo:function(){return $(document.body.querySelector(i))},showWhenUnclickable:!0,dataStoreKey:t}}}}var s;!(function(e){e.connectData={top:0,left:-25},e.home={top:-15,left:-15},e.findContent={top:0,left:-25},e.dataCapacityLimit={top:-10,left:0},e.dataOnPremises={top:10,left:0},e.createGroup={top:0,left:-25},e.createContentPacks={top:0,left:-25},e.insights={top:-10,left:0},e.groupCapacitySettings={top:-25,left:-5}})(s=e.tutorialPopupOffset||(e.tutorialPopupOffset={}));var c;!(function(t){function i(e){var t=".navigationPaneV2 "+e;return $(".navigationPaneV2").hasClass("isExpanded")||$(".navigationPaneV2 .expanderBtn").click(),$(t)}function o(e){switch(e){case p:return"pbi-glyph-favoritestar";case u:return"pbi-glyph-mru";case h:return"pbi-glyph-my-apps";case v:return"pbi-glyph-shared";case g:return"pbi-glyph-collections";case m:return"pbi-glyph-user";case f:return"pbi-glyph-getdata";case b:return"pbi-glyph-gear";default:return""}}function r(t,i){return t===f?i.isRtlLayout?e.Direction.RightBottomForRtl:e.Direction.LeftBottom:t===b?e.Direction.Top:i.isRtlLayout?e.Direction.RightTopForRtl:e.Direction.LeftTop}function a(e,t){var i=$("<div>");$("<div>").addClass("list-view-navigation-header").text(e.get("TutorialPopup_PowerBIPreview")).appendTo(i),$("<div>").addClass("list-view-navigation-title").text(e.get("TutorialPopup_ListViewNavigationPreviewTitle")).appendTo(i);var o=$("<div>");return $("<div>").addClass("tutorial-nav-model-picture").appendTo(o),$("<div>").addClass("list-view-navigation-text").text(e.get("TutorialPopup_ListViewNavigationPreviewText")).appendTo(o),{title:i.html(),text:o.html(),buttonLabel:e.get("TutorialPopup_TakeAQuickTourButtonText"),modalButtonClassOverride:"list-view-navigation-button-override",canShow:function(){return 0===$(".loading.intro").length},attachTo:function(){return $("body")},modal:!0,customClass:"list-view-navigation-container",cancelText:e.get("TutorialPopup_SkipTutorial"),overlayOptions:0,dataStoreKey:d,onButtonClick:function(){return t.resetToMyWorkspace()}}}function n(t,o,r,a,n){var s="."+t[0].toLowerCase()+t.slice(1,t.length),l=function(){return i(s)},d=c(t,l,o,r,a,n);return t===h&&(d.learnMoreText=o.get("LearnMore"),d.learnMoreUrl=e.constants.pbiAppsLink),d}function s(e,t,i,o){var r="#"+e[0].toLowerCase()+e.slice(1,e.length),a=function(){return $(".topNavRight "+r)},n=c(e,a,t,i,void 0,o);return n}function c(e,t,i,a,n,s){var c=i.get("TutorialPopup_"+e+"Title"),l=i.get("TutorialPopup_"+e+"Text"),p=s?i.get("TutorialPopup_GotIt"):i.get("TutorialPopup_Next"),u=function(){return t().length>0},h=o(e),v=r(e,a),g=!0,m=2,f=n||d,b={title:c,text:l,buttonLabel:p,canShow:u,showWhenUnclickable:g,attachTo:t,iconClass:h,preferredOrientation:v,overlayOptions:m,dataStoreKey:f};return b}function l(e,t,i,o,r){var c={itemKeys:[],items:{}},l=_(c.itemKeys).concat(d,p,u);return t.isAppsEnabled()&&(l=l.concat(h)),l=l.concat(v,g,m,f),i.featureSwitches.conceptualModelEnabled||(l=l.concat(b)),c.itemKeys=l.value(),c.items[d]=a(e,r),c.items[p]=n(p,e,o),c.items[u]=n(u,e,o),c.items[h]=n(h,e,o,y),c.items[v]=n(v,e,o),c.items[g]=n(g,e,o),c.items[m]=n(m,e,o),c.items[f]=n(f,e,o),c.items[b]=s(b,e,o,!0),t.isAppsEnabled()&&(c.items[f].text=e.get("TutorialPopup_GetDataWithAppsText")),c.isBlockingTutorial=!0,c.isSequentialTutorial=!0,c}var d="ListViewNavigationPreviewTutorial",p="Favorites",u="Recent",h="MyApps",v="SharedWithMe",g="Workspaces",m="QuickAccessPaneLauncher",f="GetData",b="SettingsMenuBtn",y="AppModelPreviewTutorial";t.createTutorialModel=l})(c=e.ListViewNavigationPreviewTutorialFactory||(e.ListViewNavigationPreviewTutorialFactory={})),e.createStartupTutorialModel=t,e.createGroupCapacitySettingsTutorialModel=i,e.createConsumptionUITutorialModel=o,e.createStartUpCapacityTutorialModel=r,e.createNewFreeUserLicenseV2TutorialModel=a,e.createConvertTableTutorialModel=n})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.isMyWorkspace=!0}return e})();e.UserGroupHeaderModel=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.contract=e}return e})();e.UserSettings=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(e){e[e.FixIt=1]="FixIt",e[e.YesNo=2]="YesNo"})(i=t.WarningBarActionType||(t.WarningBarActionType={}));var o;!(function(e){e[e.Yes=0]="Yes",e[e.No=1]="No",e[e.FixIt=2]="FixIt"})(o=t.WarningBarResult||(t.WarningBarResult={}));var r=(function(){function t(t,i,o){var r=this;e.common.localize.ensureLocalization((function(){r._text=e.common.localize.get(t)})),this._type=i,this._clickCallback=o}return Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),t.prototype.onButtonClick=function(e){this._clickCallback(e)},t})();t.WarningBarModel=r})(t=e.models||(e.models={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.contract=e}return Object.defineProperty(e.prototype,"showDiscoverabilityToast",{get:function(){return!e.DiscoverabilityToastDismissed&&this._showDiscoverabilityToast},set:function(e){this._showDiscoverabilityToast=e},enumerable:!0,configurable:!0}),e})();e.WorkbookContainer=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={})),define("powerBI/proxies/alertsHttpService",["require","exports"],(function(e,t){function i(e,t,i,o){return new a(e,t,i,o)}Object.defineProperty(t,"__esModule",{value:!0});var o=jsCommon.StringExtensions,r=powerbi.telemetry;t.createAlertHttpService=i;var a=(function(){function e(e,t,i,o){this.httpService=common.httpService,this.promiseFactory=e,this.telemetryService=t,this.errorService=i,this.localizationService=o,this.allAlerts=[]}return e.prototype.createAlert=function(t,i){var o=this,a=this.promiseFactory.defer(),n="metadata/alerts",s=this.telemetryService.startChildEvent(i,r.DataAlertsRequest,r.AlertRequestType.Create);return this.httpService.post(n,t,this.httpService.powerbiRequestOptions()).then((function(e){s.resolve(),a.resolve(e.data)}),(function(t){var i=o.getErrorCode(t);if(i===e.quotaExceededError){var r=o.errorService.control();r.showPrompt(o.localizationService.get("Alerts_QuotaExceededDialogTitle"),o.localizationService.get("Alerts_QuotaExceededDialogMessage"),[new InJs.ModalDialogAction(o.localizationService.get("ModalDialogButtonText_Ok"),function(e,t){r.hideDialog()})])}s.reject({errorCode:i}),a.resolve(-1)})),a.promise},e.prototype.updateAlert=function(e,t){var i=this,a=this.promiseFactory.defer(),n="metadata/alerts/{0}",s=this.telemetryService.startChildEvent(t,r.DataAlertsRequest,r.AlertRequestType.Update);return this.httpService.put(o.format(n,e.id.toString()),e,this.httpService.powerbiRequestOptions()).then((function(e){s.resolve(),a.resolve(!0)}),(function(e){var t=i.getErrorCode(e);s.reject({errorCode:t}),a.resolve(!1)})),a.promise},e.prototype.deleteAlert=function(e,t){var i=this,a=this.promiseFactory.defer(),n="metadata/alerts/{0}",s=this.telemetryService.startChildEvent(t,r.DataAlertsRequest,r.AlertRequestType.Delete);return this.httpService.delete(o.format(n,e.toString()),this.httpService.powerbiRequestOptions()).then((function(e){s.resolve(),a.resolve(!0)}),(function(e){var t=i.getErrorCode(e);s.reject({errorCode:t}),a.resolve(!1)})),a.promise},e.prototype.toggleAlert=function(e,t,i){var a=this,n=this.promiseFactory.defer(),s="metadata/alerts/{0}/toggle",c=this.telemetryService.startChildEvent(i,r.DataAlertsRequest,r.AlertRequestType.Toggle);return this.httpService.put(o.format(s,e.toString()),t,this.httpService.powerbiRequestOptions()).then((function(e){c.resolve(),n.resolve(!0)}),(function(e){var t=a.getErrorCode(e);c.reject({errorCode:t}),n.resolve(!1)})),n.promise},e.prototype.getAllAlerts=function(e,t){var i=this,a=this.promiseFactory.defer(),n="metadata/alerts{0}",s=this.telemetryService.startChildEvent(e,r.DataAlertsRequest,r.AlertRequestType.Get);return this.httpService.get(o.format(n,null!=t?"?tileId="+t:""),this.httpService.powerbiRequestOptions()).then((function(e){s.resolve(),a.resolve(e.data)}),(function(e){var t=i.getErrorCode(e);s.reject({errorCode:t}),a.resolve([])})),a.promise},e.prototype.getErrorCode=function(e){var t;return e&&(e.error?t=e.error.code:e.status&&(t=e.status.toString())),t},e.quotaExceededError="DataDrivenAlertRulesQuotaExceeded",e})()}));var powerbi;!(function(e){var t;!(function(t){function i(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"DeleteContentPack");return o.enableTelemetry=!0,e.common.httpService.delete("/powerbi/content/providers/organization/"+t+"/",o)}function o(t,i,o,a,n,s){var c=r(t,i,o,a,n),l=t.isTemplate,d=e.common.httpService.powerbiRequestOptions(s,l?"PublishTenantContentPack":"PublishContentPack"),p=l?"/powerbi/content/providers/organizationaltemplate/":"/powerbi/content/providers/organization/";return t.providerKey?e.common.httpService.put(p+t.providerKey+"/",JSON.stringify(c),d):e.common.httpService.post(p,JSON.stringify(c),d)}function r(e,t,i,o,r){var a;a=e.isTemplate?s.OrganizationalTemplate:s.Organizational;var n={name:e.titleText,description:e.descriptionText,icon:t,parameterIcon:i,accessPermissions:{listOfGroupsOrPrincipals:e.groupsAddressesList,isSharedToEntireOrganization:e.isSharedWithOrg},dashboardIds:e.selectedDashboardIds,reportIds:e.selectedReportIds,modelIds:e.selectedDatasetIds,workbookIds:e.selectedWorkbookIds,contentProviderCategory:a};return e.emailsList&&e.emailsList.inputUserList&&(n.accessPermissions.adUserMetadataList=e.emailsList.inputUserList),e.providerKey&&(o||(n.skipUpdateIcon=!o,n.icon=""),r||(n.skipUpdateParameterIcon=!r,n.parameterIcon="")),n}function a(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"SetContentPackDirty");o.enableTelemetry=!0;var r={contentProviderKeys:t},a=e.common.httpService.put("/powerbi/content/providers/organization/",JSON.stringify(r),o);return a}function n(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"Personalize");return e.common.httpService.put("/powerbi/content/providers/personalize?packageId="+t,null,o)}var s=e.common.contracts.ContentProviderCategory;t.deleteContentPack=i,t.publishContentPack=o,t.createContentPackRequest=r,t.setContentPackDirty=a,t.personalize=n})(t=e.contentPackService||(e.contentPackService={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i){return new o(e,t,i)}t.createExportStaticReportProxy=i;var o=(function(){function t(e,t,i){this.promiseFactory=e,this.errorService=t,this.localizationService=i}return t.prototype.exportAsImage=function(t,i){var o=this,r="v1.0/myorg/reports/"+t;i&&(r+="/pages/"+i);var a=e.common.httpService.powerbiRequestOptions();_.extend(a.headers,{Accept:"image/png"}),a.responseType="arraybuffer";var n=this.promiseFactory.defer();return e.common.httpService.get(r,a).then((function(e){n.resolve({blob:e.data})}),(function(e){n.reject(e?{error:e.error,requestId:e.requestId}:{}),o.errorService.error(o.localizationService.get("ExportStaticImage_Error"),"ExportStaticImage_Error",{requestId:e.requestId,statusCode:e.status.toString()})})),n.promise},t})()})(t=e.proxies||(e.proxies={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t){return new i(e,t)}e.createFavoritesHttpService=t;var i=(function(){function t(e,t){this.syncService=e,this.notificationToastService=t}return t.prototype.deleteFavorite=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"DeleteFavorite"),r="metadata/favorites/"+t.id+"?type="+t.favoriteType;return e.common.httpService.delete(r,o)},t.prototype.getFavorites=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"GetFavorites");return e.common.httpService.get("metadata/favorites",i)},t.prototype.addFavorite=function(t,i,o){var r=e.common.httpService.powerbiRequestOptions(o,"AddFavorites"),a={favoriteType:t,favoriteId:i};return e.common.httpService.post("metadata/favorites",JSON.stringify(a),r)},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t){return new i(e,t)}e.createGroupHttpService=t;var i=(function(){function t(e,t){this.telemetryService=e,this.activeGroupIdService=t}return t.prototype.setActiveGroupId=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"SetActiveGroup"),o="/powerbi/metadata/user/activegroup";return i.enableTelemetry=!0,e.common.httpService.post(o,null,i)},t.prototype.getGroupDashboardContainer=function(t,i){var o=t.lastViewedDashboard,r=e.common.httpService.powerbiRequestOptions(i,"GetGroupContainer"),a="powerbi/metadata/groupmetadata/";return o&&o!==-1&&(a=jsCommon.Utility.urlCombine(a,"?dashboardId="+encodeURIComponent(o.toString()))),e.common.httpService.get(a,r)},t.prototype.addGroup=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"AddGroup");return o.enableTelemetry=!0,e.common.httpService.put("/powerbi/metadata/groups",t,o)},t.prototype.validateGroupMembers=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"ValidateGroupMembers");return o.enableTelemetry=!0,e.common.httpService.post("/powerbi/metadata/groups/validatemembers",t,o)},t.prototype.getGroupMembers=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"GetGroupMembers");return o.enableTelemetry=!0,e.common.httpService.get("/powerbi/metadata/groups/"+t+"/members",o)},t.prototype.updateGroup=function(t,i,o,r,a,n,s){var c=e.common.httpService.powerbiRequestOptions(s,"UpdateGroupMembers");c.enableTelemetry=!0;var l={group:i,membersToAdd:o,membersToRemove:r,membersToAdmins:a,adminsToMembers:n};return e.common.httpService.post("/powerbi/metadata/groups/"+t,l,c)},t.prototype.deleteGroup=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"DeleteGroup");return o.enableTelemetry=!0,e.common.httpService.delete("/powerbi/metadata/groups/"+t,o)},t.prototype.validateGroupId=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"ValidateGroupId");return o.enableTelemetry=!0,e.common.httpService.post("/powerbi/metadata/groups/validategroupid",JSON.stringify(t),o)},t.prototype.getAvailableGroupCapacities=function(){var t=e.common.httpService.powerbiRequestOptions(this.telemetryService.startEvent(e.telemetry.GroupsGetCapacities).event,"GetAvailableGroupCapacities");return t.enableTelemetry=!0,e.common.httpService.get("/capacities/author",t)},t.prototype.updateMyWorkspace=function(t){var i=e.common.httpService.powerbiRequestOptions(this.telemetryService.startEvent(e.telemetry.GroupsChangeMyWorkspaceCapacity).event,"ChangeMyWorkspaceCapacity",{dismissGroupObjectId:!0});return i.enableTelemetry=!0,e.common.httpService.post("/capacities/migrationrequest",JSON.stringify(t),i)},t})()})(powerbi||(powerbi={})),define("powerBI/proxies/insightsHttpRuntime",["require","exports","Insights/services/insightsAnalysisSerializer","Insights/services/insightsErrorService"],(function(e,t,i,o){function r(e,t,i,o){return new c(e,t,i,o)}Object.defineProperty(t,"__esModule",{value:!0});var a=powerbi.insights.utils.InsightsRuntimeUtils;t.create=r;var n="insights/derive",s="insights/derive/queue",c=(function(){function e(e,t,i,o){this.httpService=e,this.promiseFactory=t,this.featureSwitchService=o,this.pendingInsightsRequests={},i.addInsightsListener(this)}return e.prototype.deriveInsights=function(e){return this.featureSwitchService.featureSwitches.insightsSyncServiceEnabled?this.deriveInsightsAsync(e):this.deriveInsightsSync(e)},e.prototype.deriveInsightsSync=function(e){var t=this,i=this.promiseFactory.defer(),r=this.createDeriveInsightsQueueRequest(e);return this.httpService.post(n,r,this.httpService.powerbiRequestOptions()).then((function(e){if(0===e.data.Insights.length){var t=o.getMostFatalErrorCode(e.data.Warnings);i.reject({ErrorCode:t,RequestId:e.requestId,Warnings:e.data.Warnings})}else i.resolve(a.createInsightContainers(e.data))}),(function(e){var o=t.getErrorCode(e);i.reject({ErrorCode:o,RequestId:e.requestId,Warnings:null})})),i.promise},e.prototype.deriveInsightsAsync=function(e){var t=this,i=this.promiseFactory.defer(),o=this.createDeriveInsightsQueueRequest(e);return this.httpService.post(s,o,this.httpService.powerbiRequestOptions()).then((function(e){t.pendingInsightsRequests[e.data.JobId]=i}),(function(e){var o=t.getErrorCode(e);i.reject({ErrorCode:o,RequestId:e.requestId,Warnings:null})})),i.promise},e.prototype.createDeriveInsightsQueueRequest=function(e){var t=i.serialize(e.analysisDefinition);t.TelemetryId=e.telemetryId;var o=e.model&&e.model.vsName||e.dsrDataSource&&e.dsrDataSource.dsr.vsName,r=e.model&&e.model.dbName||e.dsrDataSource&&e.dsrDataSource.dsr.dbName,a=e.model&&e.model.id||e.dsrDataSource&&e.dsrDataSource.dsr.modelId;return this.featureSwitchService.featureSwitches.insightsExplore?{VirtualServerName:o,DatabaseName:r,ModelId:a,Analysis:t,Version:1}:this.downgradeAnalysisDefinition(o,r,a,t)},e.prototype.onInsightsAvailable=function(e){var t=this,i=s+"/"+e+"/results",r=this.pendingInsightsRequests[e];this.httpService.get(i,this.httpService.powerbiRequestOptions()).then((function(e){if(0===e.data.Results.Insights.length&&r){var t=o.getMostFatalErrorCode(e.data.Results.Warnings);r.reject({ErrorCode:t,RequestId:e.requestId,Warnings:e.data.Results.Warnings})}else r&&r.resolve(a.createInsightContainers(e.data.Results))}),(function(e){if(r){var i=t.getErrorCode(e);r.reject({ErrorCode:i,RequestId:e.requestId,Warnings:null})}}))},e.prototype.getErrorCode=function(e){var t;return e&&(e.error?t=e.error.code:e.status&&(t=e.status.toString())),t},e.prototype.downgradeAnalysisDefinition=function(e,t,i,o){if(!o.ExplainDifference&&!o.ExplainChange)return o.Explore?{VirtualServerName:e,DatabaseName:t,ModelId:i,TimeoutInMS:o.Explore.TimeoutInMS,RequestedInsights:o.Explore.RequestedInsights,Options:o.Explore.Options}:o.GetRelatedInsights?{VirtualServerName:e,DatabaseName:t,ModelId:i,TimeoutInMS:o.GetRelatedInsights.TimeoutInMS,RequestedInsights:o.GetRelatedInsights.RequestedInsights,Options:o.GetRelatedInsights.Options,Scope:{TopicQuery:o.GetRelatedInsights.TopicQuery}}:void 0},e})()}));var powerbi;!(function(e){var t;!(function(t){function i(t){var i={};return e.common.httpService.get(t,i)}t.showNpsDialog=i})(t=e.npsHttpService||(e.npsHttpService={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){return new o}var i=jsCommon.Utility;e.createO365ApplicationLauncherService=t;var o=(function(){function t(){}return t.prototype.getApplicationLauncher=function(){var t="/metadata/office365shell/";t=i.urlCombine(t,"?locale="+e.common.localization.loader.currentLanguageLocale);var o=e.common.httpService.powerbiRequestOptions();return e.common.httpService.get(t,o)},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"GetDelayedQueryResult");return e.common.httpService.get("explore/queryresult/"+t,o)}t.getQueryData=i})(t=e.queryService||(e.queryService={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,a,n,s,c,d){return new l(e,t,i,o,r,a,n,s,c,d)}var i=e.common.contracts.admsGateway.DatabaseType,o=e.common.contracts.gateway.DataSourceType,r=e.common.contracts.gateway.GatewayStatus,a=e.connectivity.helpers.ErrorConverterHelper,n=e.common.helpers.ModelConverterHelper,s=e.explore.util.ScriptVisualsUtil,c="RefreshingData";e.createRefreshService=t;var l=(function(){function t(e,t,i,o,r,a,n,s,c,l){this.modelHttpService=e,this.datasetsService=t,this.gatewaysMetadataService=r,this.rootScope=i,this.notificationToastService=o,this.featureSwitchService=a,this.promiseFactory=n,this.selectGatewayService=s,this.localizationService=c,this.modalDialogService=l}return t.prototype.handleRefreshError=function(t,i,o,r){var a=o.headers(e.common.PowerBIErrorHeader);a&&a===e.common.constants.serverErrors.packageOperationInProgress?this.displayOopsErrorAndEndTelemetry(t,i,"PackageOperationBlocked",o,r):a&&a===e.common.constants.serverErrors.dataRefreshTooSoon?this.displayOopsErrorAndEndTelemetry(t,i,"DataRefreshBlocked",o,r):this.displayOopsErrorAndEndTelemetry(t,i,"PackageRefreshUnknownFailure",o,r)},t.prototype.refreshNow=function(t,i,o,r,a,n,s,l,d){var p,u=this,h=t.startEvent(e.telemetry.DashboardDatasetRefresh,r);p=this.notificationToastService.notify({title:e.common.localize.get(a?a:c),message:n?e.common.localize.get(n):void 0,notificationType:e.common.NotificationToastType.Loading}),this.refreshPackage(o,h.event).then((function(t){u.notificationToastService.hide(p),s&&u.notificationToastService.notify({title:e.common.localize.get(s),message:e.common.localize.format(l,[d]),notificationType:e.common.NotificationToastType.Success}),h.resolve()}),(function(e){u.notificationToastService.hide(p),u.handleRefreshError(t,i,e,h)}))},t.prototype.tryRefreshDMNow=function(e,t,i,o,r,a,s,c){this.tryRefreshDMNowImpl(e,t,n.shouldUseDMTS(i.data.refreshConnections,null,this.featureSwitchService.featureSwitches),o,r,a,s,c);
},t.prototype.tryRefreshDMNowImpl=function(t,i,o,r,a,c,l,d){var p=this,u=t.startEvent(e.telemetry.DashboardGetAggregatedDatasourcesForOneModel,r.contentProviderId);if(o)if(a)if(null!=c){var h=this.promiseFactory,v=this,g=n.getEffectiveDatasourcesFromDiscoverDatasourceResponse(a,c),m=_.map(g,(function(e){return p.gatewaysMetadataService.getDataSourceStatus(e.gatewayId,e.dataSourceId)}));h.all(m).then((function(){return u.resolve(),p.isUserConsentRequiredDmts(g)?void s.confirmRefreshForRDataSource(i,p.localizationService,p.modalDialogService,p.rootScope.$new(),(function(){v.refreshNow(t,i,r.packageId,r.contentProviderId)}),(function(){v.notificationToastService.hide(l)})):void v.refreshNow(t,i,r.packageId,r.contentProviderId)}),(function(o){v.rootScope.$emit(e.common.constants.showSettingsViewerEventName,d,r.dbName);var a="SettingsDataset_Error_CannotRefreshTitle",n=e.common.localize.get("ServerError_PersonalGateway_LongMessage_DataSource_InvalidCredential");p.notificationToastService.hide(l),v.displayCustomizedErrorAndEndTelemetry(t,i,null,n,a,u,e.telemetry.ErrorSource.User,o)}))}else 0===a.datasources.length&&0===a.gateways.length&&(u.resolve(),this.refreshNow(t,i,r.packageId,r.contentProviderId));else u.reject(),this.notificationToastService.hide(l),this.rootScope.$emit(e.common.constants.showSettingsViewerEventName,d,r.dbName);else this.gatewaysMetadataService.getAdmsAggregatedDatasourcesForOneModel(r.id.toString(),!0).then((function(e){if(p.notificationToastService.hide(l),e){if(p.isUserConsentRequired(e))return void s.confirmRefreshForRDataSource(i,p.localizationService,p.modalDialogService,p.rootScope.$new(),(function(){p.refreshNowADMS(t,i,r,d,e,u)}),(function(){}));p.refreshNowADMS(t,i,r,d,e,u)}else p.gatewaysMetadataService.displayOopsErrorAndEndTelemetry(t,i,"SettingsDataset_Error_FailedToLoadDatasources",u)}),(function(e){p.notificationToastService.hide(l),p.displayOopsErrorAndEndTelemetry(t,i,"SettingsDataset_Error_FailedToLoadDatasources",e,u)}))},t.prototype.tryRefreshNow=function(t,i,o,r){var a=this,n=t.startEvent(e.telemetry.DashboardPrepareRefreshNow,o.contentProviderId),s=this.notificationToastService.notify({title:e.common.localize.get("PreparingForRefresh"),notificationType:e.common.NotificationToastType.Loading});this.modelHttpService.getModelAndPackageForRefresh(o.id,o.packageId,n.event).then((function(c){n.resolve(),c.data&&c.data.packageId?a.isModelRefreshInProgress(c.data)?(a.notificationToastService.hide(s),a.displayCustomizedErrorAndEndTelemetry(t,i,"SettingsDataset_RefreshNow_Popup_RefreshInProgress",null,"SettingsDataset_RefreshNow_Popup_RefreshInProgressTitle",n,e.telemetry.ErrorSource.User,c)):c.data.isAllDataSourcesSupportedForRefresh===!0?a.isPackageImportedFromOneDrive(c.data)?(a.notificationToastService.hide(s),a.tryRefreshNonDMNow(t,i,c,o,r)):a.gatewaysMetadataService.getModelDataSources(o.id).then((function(n){if(0===n.gateways.length&&0===n.datasources.length)return void(!c.data.isHidden&&e.common.helpers.ModelConverterHelper.onpremGatewayRequired(c.data)?a.tryRetrieveGatewayAndRefreshDMNow(t,i,c,o,n,s,r):a.tryRefreshDMNow(t,i,c,o,n,null,s,r));var l=a.selectGatewayService.getSelectedGateway(n),d=a.selectGatewayService.getSelectedGatewayType(l);switch(d){case 0:a.rootScope.$emit(e.common.constants.showSettingsViewerEventName,r,o.dbName),i.error(e.common.localize.get("SettingsDataset_Error_DatasetNotBoundToAnyGateway"),"SettingsDataset_Error_DatasetNotBoundToAnyGateway"),a.notificationToastService.hide(s);break;case 1:!c.data.isHidden&&e.common.helpers.ModelConverterHelper.onpremGatewayRequired(c.data)?a.tryRetrieveGatewayAndRefreshDMNow(t,i,c,o,n,s,r):a.tryRefreshDMNow(t,i,c,o,n,l.gatewayId,s,r);break;case 2:a.refreshNow(t,i,o.packageId,o.contentProviderId)}}),(function(n){return n.error&&n.error.code===e.gateways.constants.ServerError_ModelHasNoPowerBIDMMoniker?void(!c.data.isHidden&&e.common.helpers.ModelConverterHelper.onpremGatewayRequired(c.data)?a.tryRetrieveGatewayAndRefreshDMNow(t,i,c,o,null,s,r):a.tryRefreshDMNow(t,i,c,o,null,null,s,r)):void i.error(e.common.localize.get("SettingsDataset_Error_FailedToDiscoverDatasource"),"SettingsDataset_Error_FailedToDiscoverDatasource",{requestId:n.requestId,statusCode:n.status.toString()})})):(a.notificationToastService.hide(s),a.tryRefreshNonDMNow(t,i,c,o,r)):(a.notificationToastService.hide(s),t.logEvent(e.telemetry.DashboardRefreshNowFailedToRetrieveModel,o.contentProviderId),a.showRefreshNowNotification(!1,o))}),(function(e){a.notificationToastService.hide(s),a.displayOopsErrorAndEndTelemetry(t,i,"SettingsDataset_Error_FailedToLoadModelForRefresh",e,n)}))},t.prototype.tryRetrieveGatewayAndRefreshDMNow=function(t,i,o,a,s,c,l){var d=this,p=t.startEvent(e.telemetry.DashboardRetrieveGateway,a.contentProviderId);this.gatewaysMetadataService.getPersonalGateway().then((function(u){return u.gatewayStatus===r.NotReachable?(d.rootScope.$emit(e.common.constants.showSettingsViewerEventName,l,a.dbName),d.displayCustomizedErrorAndEndTelemetry(t,i,"SettingsDataset_Error_GatewayOffline",null,"SettingsDataset_Error_GatewayOfflineTitle",p,e.telemetry.ErrorSource.External),void d.notificationToastService.hide(c)):u.gatewayStatus===r.NotInstalled?(d.rootScope.$emit(e.common.constants.showSettingsViewerEventName,l,a.dbName),d.displayCustomizedErrorAndEndTelemetry(t,i,"SettingsDataset_Error_GatewayNotExist",null,"SettingsDataset_Error_GatewayNotExistTitle",p,e.telemetry.ErrorSource.External),void d.notificationToastService.hide(c)):void d.tryRefreshDMNowImpl(t,i,n.shouldUseDMTS(o.data.refreshConnections,u,d.featureSwitchService.featureSwitches),a,s,u.gatewayId,c,l)}),(function(e){d.notificationToastService.hide(c),d.displayOopsErrorAndEndTelemetry(t,i,"SettingsDataset_Error_FailedToRetrieveGateway",e,p)}))},t.prototype.tryRefreshNonDMNow=function(t,i,o,r,a){var n=o.data.contentProviderId;6===n||7===n||9===n||60===n||o.data.directQueryMode?this.refreshNow(t,i,r.packageId,r.contentProviderId):this.rootScope.$emit(e.common.constants.showSettingsViewerEventName,a,r.dbName)},t.prototype.displayOopsErrorAndEndTelemetry=function(t,i,o,r,a){a.reject(),i.error(e.common.localize.get(o),o,{requestId:r.requestId,statusCode:r.status.toString()})},t.prototype.refreshPackage=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"RefreshPackage");return o.retryCount=0,e.common.httpService.post("powerbi/content/packages/"+t+"/refresh/",null,o)},t.prototype.getGatewayStatus=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"GetGatewayStatus");return e.common.httpService.get("powerbi/dmm/subscribe/"+t,o)},t.prototype.updateRefreshSchedule=function(t,i,o){var r=e.common.httpService.powerbiRequestOptions(o,"UpdateRefreshSchedule");return r.retryCount=0,e.common.httpService.post("powerbi/metadata/models/"+t+"/refreshschedule",i,r)},t.prototype.showRefreshNowNotification=function(t,i){var o=t?i.name+e.common.localize.get("SettingsDataset_Notification_RefreshNow_Scheduled_Title"):i.name+e.common.localize.get("SettingsDataset_Notification_RefreshNow_NotScheduled_Title"),r=t?i.name+e.common.localize.get("SettingsDataset_Notification_RefreshNow_Scheduled_Message"):e.common.localize.get("SettingsDataset_Notification_RefreshNow_NotScheduled_Message_Part1")+i.name+e.common.localize.get("SettingsDataset_Notification_RefreshNow_NotScheduled_Message_Part2");this.notificationToastService.notify({title:o,message:r})},t.prototype.displayCustomizedErrorAndEndTelemetry=function(t,i,o,r,a,n,s,c){n.reject();var l={requestId:c?c.requestId:void 0,statusCode:c?c.status.toString():void 0,title:e.common.localize.get(a)};i.error(o?e.common.localize.get(o):r,o,l,!1,s)},t.prototype.isPackageImportedFromOneDrive=function(e){return e.packageVersion.length>10&&(6===e.contentProviderId||7===e.contentProviderId||60===e.contentProviderId)},t.prototype.isModelRefreshInProgress=function(e){var t=e.currentRefreshStartingTime&&n.convertRefreshTimeToJsDateTime(e.currentRefreshStartingTime);return t&&t.getTime()+18e5>Date.now()},t.prototype.isUserConsentRequired=function(t){return t&&_.some(t,(function(t){return t.discoverDataSourceEntry.databaseType.toString()===i.Extension.toString()&&t.discoverDataSourceEntry.extensionDatabaseType===e.common.constants.RDataSourceName}))},t.prototype.isUserConsentRequiredDmts=function(e){return e&&_.some(e,(function(e){return e.dataSourceType===o.Extension&&e.connectionDetails.indexOf('"extensionDataSourceKind":"R",')!==-1}))},t.prototype.refreshNowADMS=function(t,i,o,r,n,s){s.resolve();for(var c=!0,l=0,d=n;l<d.length;l++){var p=d[l];if(!p.testConnectionResponse||p.testConnectionResponse.instanceTestConnectionResults.testPassed===!1){c=!1,this.rootScope.$emit(e.common.constants.showSettingsViewerEventName,r,o.dbName);var u="SettingsDataset_Error_CannotRefreshTitle",h=a.convertADMSTestConnectionResultToErrorMessage(p.testConnectionResponse);this.displayCustomizedErrorAndEndTelemetry(t,i,null,h,u,s,e.telemetry.ErrorSource.PowerBI);break}}c&&this.refreshNow(t,i,o.packageId,o.contentProviderId)},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){return new i}e.createRealTimeDataHttpService=t;var i=(function(){function t(){}return t.prototype.createDataset=function(t){var i=e.common.httpService.powerbiRequestOptions(null,"Create Real Time Dataset");return e.common.httpService.post("realtime/models",t,i)},t.prototype.getCredentials=function(t){var i=e.common.httpService.powerbiRequestOptions(null,"Get Real Time Dataset External Credentials");return e.common.httpService.get("realtime/models/"+t+"/credentials",i)},t.prototype.getDataset=function(t){var i=e.common.httpService.powerbiRequestOptions(null,"Get Real Time Dataset");return e.common.httpService.get("realtime/models/"+t,i)},t.prototype.getHistory=function(t){var i=e.common.httpService.powerbiRequestOptions(null,"Get History");return e.common.httpService.post("realtime/history",t,i)},t.prototype.updateDataset=function(t,i){var o=e.common.httpService.powerbiRequestOptions(null,"Update Real Time Dataset");return e.common.httpService.put("realtime/models/"+t,i,o)},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){return new i}e.createSettingsMetadataHttpService=t;var i=(function(){function t(){}return t.prototype.getSettings=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"GetSettingsMetadata");return i.enableTelemetry=!0,e.common.httpService.get("/powerbi/metadata/settings",i)},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){return new i}e.createUserSettingsHttpService=t;var i=(function(){function t(){}return t.prototype.getUserSettings=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"GetUserSettings");return i.enableTelemetry=!0,e.common.httpService.get("/powerbi/metadata/userSettings",i)},t.prototype.updateAllowQnaDataCollection=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"UpdateAllowQnaDataCollection",{dismissGroupObjectId:!0});return o.enableTelemetry=!0,e.common.httpService.post("/powerbi/metadata/userSettings/allowQnaDataCollection",JSON.stringify(t),o)},t.prototype.updateExtendedSettings=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"UpdateUserExtendedSettings");return o.enableTelemetry=!0,e.common.httpService.post("/powerbi/metadata/userSettings/extendedSettings",JSON.stringify(t),o)},t.prototype.updateUserSettings=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"UpdateUserSettings",{dismissGroupObjectId:!0});return o.enableTelemetry=!0,e.common.httpService.post("/powerbi/metadata/userSettings/updateUserSettings",JSON.stringify(t),o)},t.prototype.sendEmailForDownloadPowerBI=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"SendEmailForDownloadPowerBI");return o.enableTelemetry=!0,o.retryCount=0,o.params={email:t},e.common.httpService.get("https://powerbi.microsoft.com/submitemail",o)},t})()})(powerbi||(powerbi={})),define("powerBI/proxies/publishAppHttp",["require","exports"],(function(e,t){function i(){return new s}Object.defineProperty(t,"__esModule",{value:!0});var o=powerbi.helpers.PublishAppHelper,r=jsCommon.Utility,a="/powerbi/content/providers/organization/",n="/powerbi/content/providers/organizationaltemplate/";t.create=i;var s=(function(){function e(){}return e.prototype.publishApp=function(e,t,i){var r=common.httpService,a=r.powerbiRequestOptions(e,"PublishApp"),n=o.createPublishOrUpdateAppModelRequest(t);return r.post(this.getUrlPrefix(t),n,a)},e.prototype.updateApp=function(e,t,i){var a=common.httpService,n=a.powerbiRequestOptions(e,"UpdateApp"),s=o.createPublishOrUpdateAppModelRequest(t);return a.put(r.urlCombine(this.getUrlPrefix(t),t.objectId)+"/",s,n)},e.prototype.deleteApp=function(e,t){var i=common.httpService.powerbiRequestOptions(e,"DeletePublishedApp");return i.enableTelemetry=!0,common.httpService.delete("/powerbi/content/providers/organization/"+t+"/",i)},e.prototype.getUrlPrefix=function(e){return e.publishAsTemplate?n:a},e})()}));var powerbi;!(function(e){function t(e){return new i(e)}e.createConceptualModelSetting=t;var i=(function(){function e(e){this.featureSwitchService=e}return e.prototype.isAppsEnabled=function(){return this.featureSwitchService.featureSwitches.appsEnabled},e.prototype.isTemplateAppsEnabled=function(){return this.featureSwitchService.featureSwitches.appTemplatesEnabled&&this.isAppsEnabled()},e.prototype.isServiceAppsEnabled=function(){return this.featureSwitchService.featureSwitches.serviceAppsEnabled&&this.isAppsEnabled()},e})();e.ConceptualModelSetting=i})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,a,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C,T){return new n(t,e,i,o,r,a,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C,T)}var i=e.common.contracts.ContentProviderCategory,o=e.dataServices.models.ContentPackItems,r=e.dialogbuilders.MakeACopyDialogBuilder,a=e.common.dialog.MessageDialogBuilder;e.createContentPackService=t;var n=(function(){function t(t,i,o,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C,T,I,k){var M=this;this.appService=t,this.rootScope=i,this.errorService=o,this.telemetryService=n,this.modelConverter=s,this.syncService=c,this.contentProviderHttpService=l,this.localizationService=d,this.navigation=p,this.dashboardService=u,this.lazy=g,this.notificationToast=m,this.reportService=f,this.modelService=b,this.permissionService=y,this.workbookService=S,this.promiseFactory=w,this.quota=D,this.modalDialogService=C,this.groupService=T,this.licenseEnforcementService=I,this.moduleLoader=k,this.requests={},this.contentPacksDirtyStates={},this.makeACopyDialogBuilder=new r(C),this.messageDialogBuilder=new a(C),this.userInfo=v,this.syncService.addContentPackRefreshListener(this),this.rootScope.$on(e.constants.dashboardContainerLoaded,(function(){M.loadContentPacks()})),this.groupService.addGroupChangedHandler(this),this.rootScope.$on(e.constants.contentPackDirtyShowNotification,(function(e,t,i){return M.notifyIfDirty(t,i)})),this.rootScope.$on(e.common.constants.navigation.stateChangeSuccess,(function(e,t,i,o,r){M.contentPacksDirtyStates={}}))}return t.prototype.isApp=function(e){var t=e.category;return t===i.OrganizationalApp||t===i.OrganizationalTemplateApp},t.prototype.onContentPackDeleted=function(e){this.currentGroupCPs&&_.remove(this.currentGroupCPs.contentPacks,(function(t){return t.providerId===e}))},t.prototype.getContentPacksForCurrentGroup=function(){var e=this.getActiveGroupGUID();return e?this.currentGroupCPs&&this.currentGroupCPs.groupGUID===e?this.promiseFactory.resolve(this.currentGroupCPs.contentPacks):this.loadContentPacks():this.promiseFactory.reject()},t.prototype.displayLicenseErrorDialog=function(t){var i,o=this,r=t?e.telemetry.LicenseEnforcementOperation.ConnectApps:e.telemetry.LicenseEnforcementOperation.ConnectContentPacks;i=this.userInfo.userFreeTrialExpired?"UpgradeAccount_DisabledFeatureMessageTrialExpired":t?"UpgradeAccount_ConnectAppMessage":"UpgradeAccount_ConnectContentMessage";var a=t?"UpgradeAccount_ConnectAppTitle":"UpgradeAccount_ConnectContentTitle";this.lazy("licenseHelper").then((function(t){return t.displayFeatureDisabledErrorMessage(r,o.localizationService.format(i,[""+e.common.constants.FreeTrialPeriod]),o.localizationService.get(a))}))},t.prototype.setContentPackCleanForSession=function(e){if(this.currentGroupCPs){var t=this.currentGroupCPs.contentPacks,i=_.find(t,(function(t){return t.providerContract.providerKey===e}));i&&(i.providerContract.isDirty=!1)}},t.prototype.showDialogOnModelDeleteInContentPack=function(e){var t=_.find(this.currentGroupCPs.contentPacks,(function(t){return _.contains(t.modelIds,e)}));t&&this.showDeleteArtifactInContentPack(t,"Model_DeleteConfirmationTitle","Model_DeleteCheckMessageApps","Model_DeleteCheckMessage","ModelDeleteInOrgProvider")},t.prototype.showDialogOnWorkbookRemoveInContentPack=function(e){var t=_.find(this.currentGroupCPs.contentPacks,(function(t){return _.contains(t.workbookIds,e)}));t&&this.showDeleteArtifactInContentPack(t,"Workbook_RemoveConfirmationTitle","Workbook_RemoveCheckMessageApps","Workbook_RemoveCheckMessage","WorkbookDeleteInOrgProvider")},t.prototype.deleteContentPack=function(e){var t=this,i=this.promiseFactory.defer(),o=this.localizationService;return this.messageDialogBuilder.show("DeleteInContentPack",{messageText:o.get("ContentPackDelete_Message"),titleText:o.get("ContentPack_DeleteConfirmationTitle"),okButtonText:o.get("ModalDialogButtonText_Delete"),cancelButtonText:o.get("PBI_Button_Label_Cancel")}).then((function(o){0===o?(t.deleteContentPackRequest(e).then((function(e){return i.resolve(!0)}),(function(e){return i.reject()})),t.currentGroupCPs&&!_.isEmpty(t.currentGroupCPs.contentPacks)||t.navigation.navigateToContentListOrActiveDashboard()):i.resolve(!1)}),(function(){return i.reject()})),i.promise},t.prototype.onPersonalizeContentPack=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,o,r,a,n,s,c=this;return __generator(this,(function(l){switch(l.label){case 0:return this.appService.getAppInstance(t)?[2]:this.licenseEnforcementService.supportsAppsAuthoring()?(i=e.telemetry.QuotaCheckOperation.PersonalizeContentPack,this.quota.checkQuotaExceeded(i)?[2]:[4,this.showMakeACopyDialog(t)]):(this.displayLicenseErrorDialog(!1),[2]);case 1:return o=l.sent(),0!==o?[2]:[4,this.moduleLoader.require({javascript:"PowerBIDialogs/components/progressDialog/progressDialogBuilder"})];case 2:return r=l.sent(),a=r.createProgressDialogBuilder(this.modalDialogService,this.promiseFactory),n=a.show("PersonalizeOrgAppProgress","MakeACopy_ProgressDialogTitle","MakeACopy_ProgressDialogDescription",!1),s=this.telemetryService.startEvent(e.telemetry.DashboardContentPackPersonalize),e.contentPackService.personalize(t,s.event).then((function(e){s.resolve(),c.navigation.navigateToContentListOrActiveDashboard()}),(function(t){s.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),c.errorService.error(c.localizationService.get("PublishContentPack_PersonalizationFailed_Desc"),"",{requestId:t.requestId,statusCode:t.status.toString(),activityId:t.activityId})})).finally((function(){return a.hide(n.dialogVisiblePromise)})),[2]}}))}))},t.prototype.showDeleteArtifactInContentPack=function(e,t,i,o,r){var a=this,n=this.isApp(e),s=n?i:o,c=n?"PBI_Button_Label_OK":"Publish_ViewContentPacks",l=n?void 0:"PBI_Button_Label_Cancel",d=this.messageDialogBuilder.show(r,{messageText:s,titleText:t,okButtonText:c,cancelButtonText:l});n||d.then((function(e){0===e&&a.navigation.showViewContentPackSlider()}))},t.prototype.showMakeACopyDialog=function(e){var t=this.dashboardService.findDashboardsByPackageId(e),i=this.modelService.findModelsByPackageId(e),o=this.reportService.findReportsByPackageId(e),r="PublishContentPack_PersonalizeTitle",a="PublishContentPack_PersonalizeDescription",n="PersonalizeContentPack";return this.makeACopyDialogBuilder.show(n,r,a,"PersonalizeOrgApp_PersonalizeDescriptionItemIntro",t,o,i)},t.prototype.resetContentPackUsageFlags=function(){var e=this.dashboardService.dashboardContainerModel.dashboards;if(e)for(var t=0,i=e;t<i.length;t++){var o=i[t];o&&(o.isUsedByContentPack=!1)}var r=this.reportService.reports;if(r)for(var a=0,n=r;a<n.length;a++){var s=n[a];s&&(s.isUsedByContentPack=!1)}var c=this.modelService.models;if(c)for(var l=0,d=c;l<d.length;l++){var p=d[l];p&&(p.isUsedByContentPack=!1)}var u=this.workbookService.workbooks;if(u)for(var h=0,v=u;h<v.length;h++){var g=v[h];g&&(g.isUsedByContentPack=!1)}},t.prototype.deleteContentPackRequest=function(t){var i=this,o=this.promiseFactory.defer();return this.findContentPackByGUID(t).then((function(r){if(r){var a=i.telemetryService.startEvent(e.telemetry.DashboardDeleteContentPack,r.isSharedToEntireOrg,r.dashboardIds.length,r.reportIds.length,r.modelIds.length,r.workbookIds.length,r.listOfGroupPrincipals.length);i.removeContentPacks([r.providerId]),e.contentPackService.deleteContentPack(t,a.event).then((function(e){a.resolve(),i.markItemsUsedByContentPack(),o.resolve(null)}),(function(e){a.reject(),i.addContentPack(r),i.errorService.error(i.localizationService.get("ContentPack_Delete_FailedMessage"),"",{requestId:e.requestId,statusCode:e.status.toString(),activityId:e.activityId}),o.reject()}))}else i.notificationToast.notify({title:i.localizationService.get("ContentPack_Delete_Failed_Title"),message:i.localizationService.get("ContentPack_Delete_FailedMessage"),notificationType:e.common.NotificationToastType.Error}),o.reject()}),(function(e){return o.reject()})),o.promise},t.prototype.addContentPack=function(t){var i=this.getActiveGroupGUID();if(i){this.currentGroupCPs||(this.currentGroupCPs={groupGUID:i,contentPacks:[]});var o=this.currentGroupCPs.contentPacks;if(t){var r=_.find(o,(function(e){return e.providerId===t.providerId}));r?e.helpers.ContentPackAuthoringHelper.updateContentPack(r,t):o.push(t)}}},t.prototype.findContentPack=function(e){var t=this.promiseFactory.defer();return _.isNaN(e)&&t.resolve(void 0),this.getContentPacksForCurrentGroup().then((function(i){var o=_.find(i,(function(t){return t.providerId===e}));t.resolve(o)}),(function(){return t.resolve(void 0)})),t.promise},t.prototype.findContentPackByGUID=function(e){var t=this.promiseFactory.defer();return null==e&&t.resolve(void 0),this.getContentPacksForCurrentGroup().then((function(i){var o=_.find(i,(function(t){return t.providerContract.providerKey===e}));t.resolve(o)}),(function(){return t.resolve(void 0)})),t.promise},t.prototype.removeContentPacks=function(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];this.onContentPackDeleted(o)}},t.prototype.onGroupChanged=function(){this.currentGroupCPs=null,this.loadContentPacks()},t.prototype.loadContentPacks=function(){var t=this;if(this.permissionService.isActiveWorkspaceIsReadOnly)return this.promiseFactory.reject();var i=this.groupService.activeGroup&&this.groupService.activeGroup.aadGroupId;if(!i)return this.promiseFactory.reject();var o=this.requests[i];if(o)return o.promise;var r=this.requests[i]=this.promiseFactory.defer(),a=this.telemetryService.startEvent(e.telemetry.DashboardViewContentPacks);return this.contentProviderHttpService.getOrganizationalContentProviders(a.event).then((function(e){a.resolve();for(var o=[],n=0,s=e.data;n<s.length;n++){var c=s[n];o.push(t.modelConverter.convertContentPack(c))}i===t.groupService.activeGroup.aadGroupId&&(t.currentGroupCPs={groupGUID:i,contentPacks:o},t.markItemsUsedByContentPack()),r.resolve(o)}),(function(e){a.reject(),r.reject()})).finally((function(){delete t.requests[i]})),r.promise},t.prototype.markItemsUsedByContentPack=function(){var e=this;if(this.resetContentPackUsageFlags(),this.currentGroupCPs&&!_.isEmpty(this.currentGroupCPs.contentPacks))for(var t=0,i=this.currentGroupCPs.contentPacks;t<i.length;t++){var o=i[t];o.dashboardIds.forEach((function(t){var i=e.dashboardService.findDashboard(t);i&&(i.isUsedByContentPack=!0)})),o.reportIds.forEach((function(t){var i=e.reportService.findReport(t);i&&(i.isUsedByContentPack=!0)})),o.modelIds.forEach((function(t){var i=e.modelService.findModel(t);i&&(i.isUsedByContentPack=!0)})),o.workbookIds.forEach((function(t){var i=e.workbookService.findWorkbook(t);i&&(i.isUsedByContentPack=!0)}))}},t.prototype.notifyIfDirty=function(e,t){if(this.currentGroupCPs&&!_.isEmpty(this.currentGroupCPs.contentPacks)){var i=[],r=this.currentGroupCPs.contentPacks,a={isApp:!1,isContentPack:!1};switch(t){case o.Dashboard:for(var n=0,s=r;n<s.length;n++){var c=s[n];this.dirtyCheck(c.dashboardIds,e,i,c,a)}break;case o.Report:for(var l=0,d=r;l<d.length;l++){var c=d[l];this.dirtyCheck(c.reportIds,e,i,c,a)}break;case o.Model:for(var p=0,u=r;p<u.length;p++){var c=u[p];this.dirtyCheck(c.modelIds,e,i,c,a)}break;case o.Workbook:for(var h=0,v=r;h<v.length;h++){var c=v[h];this.dirtyCheck(c.workbookIds,e,i,c,a)}}this.contentPacksDirtyStates[t]||(this.contentPacksDirtyStates[t]={});var g=this.contentPacksDirtyStates[t];g[e]||(this.showContentPackDirtyNotification(a),g[e]=!0),i.length>0&&this.setContentPackDirty(i)}},t.prototype.dirtyCheck=function(e,t,i,o,r){_.contains(e,t)&&(i.push(o.providerContract.providerKey),o.providerContract.isDirty=!0,this.appService.isAppCategory(o.category)?r.isApp=!0:r.isContentPack=!0)},t.prototype.showContentPackDirtyNotification=function(t){var i=this;if(t.isContentPack){var o={displayText:this.localizationService.get("PublishContentPack_IsDirty_Ok"),action:function(){i.navigation.showViewContentPackSlider()}};this.notificationToast.notify({message:this.localizationService.get("PublishContentPack_Changes"),notificationType:e.common.NotificationToastType.Alert,actionButtons:[o]})}},t.prototype.setContentPackDirty=function(t){var i=this.telemetryService.startEvent(e.telemetry.DashboardContentPackDirty,t.length);e.contentPackService.setContentPackDirty(t,i.event).then((function(e){i.resolve()}),(function(e){i.reject()}))},t.prototype.getActiveGroupGUID=function(){var e=this.groupService.activeGroup,t=e&&e.aadGroupId;if(t)return t},t})();e.ContentPackService=n})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,C,T,I,k,M,P,E,A){return new D(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,C,T,I,k,M,P,E,A)}function i(e){return e.inContentListView()?n.ContentList:e.inAppsDetailView()?n.OrgApps:e.inFavoritesView()?n.Favorites:e.inRecentlyViewedView()?n.RecentlyUsed:void 0}var o=e.dataServices.AppUtils,r=e.common.contracts.Permissions,a=e.common.models.CollapsiblePaneExpandedWidth,n=e.telemetry.ContentListArtifactSource,s=e.telemetry.ContentListArtifactType,c=e.common.contracts.ContentProviderClientCategory,l=e.helpers.ContentTileHelper,d=e.common.contracts.ContentTileType,p=e.dataServices.models.Dashboard,u=jsCommon.EnumExtensions,h=e.common.models.Model,v=e.models.MRUArtifactType,g=e.models.MRUModel,m=e.dataServices.contracts.PackageType,f=e.common.contracts.Permissions,b=e.common.models.Report,y=e.common.contracts.PublishOrRefreshStatus,S=e.dataServices.models.Workbook,w="packageType";e.createContentListService=t;var D=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S,w,D,C,T,I,k,M,P,E){this.telemetryService=e,this.dashboardService=t,this.reportService=i,this.navigation=o,this.modelService=r,this.analyzeInExcel=a,this.workbookService=n,this.contentPackService=s,this.localizationService=c,this.packageService=l,this.errorService=d,this.$rootScope=p,this.modalDialogService=u,this.refreshService=h,this.permissionService=v,this.settingsMetadataService=g,this.location=m,this.$window=f,this.favorites=b,this.shareSliderService=y,this.groupService=S,this.appService=w,this.promiseFactory=D,this.mostRecentlyUsedService=C,this.dashboardDataService=T,this.taskPaneSliderService=I,this.ownershipService=k,this.usageMetricsReport=M,this.lazyInjector=P,this.licenseEnforcementService=E}return t.prototype.isVisible=function(e){if(e.isHidden)return!1;switch(e.contentTileType){case d.Report:case d.Workbook:return this.canCopyAndEdit(e)&&this.isFromVisiblePackage(e,!0);case d.Dataset:return this.modelService.isExplorableNonLegacySampleModel(e)&&this.isFromVisiblePackage(e,!0)}return this.isFromVisiblePackage(e,!1)},t.prototype.isVisibleAndOwned=function(e){return(e.contentTileType===d.Dataset||!this.ownershipService.isResourceSharedWithMe(e))&&this.isVisible(e)},t.prototype.isFromVisiblePackage=function(e,t){var i=l.getPackageId(e);if(!_.isNumber(i))return!0;var o=this.packageService.findPackage(i);if(!o)return!1;var r=!this.groupService.isMyWorkspace()||o.packageType!==m.AppInstance||null==this.appService.getAppInstance(o.id);return r&&(!t||!this.usageMetricsReport.packageIsUsageMetricsContentPack(o))},t.prototype.canCopyAndEdit=function(e){var t=e.getPermissions();return u.hasFlag(t,f.Write)||u.hasFlag(t,f.CopyOnWrite)},t.prototype.tileSelectionOff=function(e){this.shareSliderService.shareDashboard=null;var t=e.objectId,i=this.dashboardService.findDashboardByGUID(t);if(i&&(i.isContentTileSelected=!1),this.navigation.inFavoritesView()){var o=this.favorites.getFavoriteByContentTile(e);o&&(o.isContentTileSelected=!1)}},t.prototype.dashboardsOwnersMergedPromise=function(){return this.dashboardService.dashboardsOwnersMergedPromise()},t.prototype.isFavorite=function(e){var t=l.getActualType(e);if(!l.isFavoritableContentType(t))return!1;var i=this.favorites.getFavoriteByContentTile(e);return!!i},t.prototype.isFavoriteDisabled=function(e){var t=this.dashboardService.findDashboardByGUID(e);return!!t&&(t.isFavoriteDisabled||t.id<0)},t.prototype.identifyAndDeleteContent=function(e){var t=this.getStrategy(e);t&&t.identifyAndDeleteContent(l.getObjectID(e))},t.prototype.deleteContent=function(e,t){var i=this.getStrategy(e);i&&i.deleteContent(l.getObjectID(e),t)},t.prototype.addDashboard=function(e){this.dashboardService.addDashboard(e)},t.prototype.canShowTileOptions=function(e){var t=this.getStrategy(e);return!!t&&t.canShowTileOptions(e)},t.prototype.publishInProgress=function(e){var t=this.getStrategy(e);if(t){var i=t.getModels(e),o=i&&i[0];return!!o&&o.packagePublishStatus===y.PublishInProgress}},t.prototype.canRefreshNow=function(e){var t=this.getStrategy(e);return!!t&&t.canRefreshNow(e)},t.prototype.canScheduleRefresh=function(e){var t=this.getStrategy(e);return!!t&&t.canScheduleRefresh(e)},t.prototype.canReplaceWorkbook=function(e){var t=this.getStrategy(e);return!!t&&t.canReplaceWorkbook(l.getObjectID(e))},t.prototype.shareContent=function(e,t){var i=this.getStrategy(e);i&&i.shareContent(e,t)},t.prototype.shareReport=function(e){var t=this.getStrategy(e);t&&t.shareReport(e)},t.prototype.addFavorite=function(e,t){return this.groupService.activeGroupObjectId!==t?this.switchGroupThenAddFavorite(e,t):this.addFavoriteInternal(e)},t.prototype.removeFavorite=function(e){this.favorites.deleteFavorite(e)},t.prototype.refreshNow=function(e){var t=this.getStrategy(e);t&&t.refreshNow(e)},t.prototype.scheduleRefresh=function(e){var t=this.getStrategy(e);t&&t.scheduleRefresh(e)},t.prototype.editContent=function(e){var t=this.getStrategy(e);t&&t.editContent(e)},t.prototype.canEditContent=function(e){var t=this.getStrategy(e);if(t)return t.canEditContent(e)},t.prototype.editWorkbook=function(e){var t=this.getStrategy(e);t&&t.editWorkbook(l.getObjectID(e))},t.prototype.replaceWorkbook=function(e){var t=this.getStrategy(e);t&&t.replaceWorkbook(l.getObjectID(e))},t.prototype.exportDashboard=function(e){var t=this.getStrategy(e);t&&t.exportDashboard(l.getObjectID(e))},t.prototype.exportToPowerPoint=function(e){var t=this.getStrategy(e);t&&t.exportReportToPowerPoint(l.getObjectID(e))},t.prototype.getDashboards=function(){return this.dashboardService.getDashboards()},t.prototype.getReports=function(){return this.reportService.getReports()},t.prototype.getWorkbooks=function(){var e=this;return this.workbookService.ensureWorkbookInitialization().then((function(){return e.workbookService.workbooks}))},t.prototype.getDatasets=function(){var e=this;return this.modelService.modelsPromise.then((function(){return e.modelService.models}))},t.prototype.subscribeReports=function(e){var t={onReportAdded:e,onReportDeleted:e,onReportsReset:e};return this.reportService.subscribe(t),t},t.prototype.unsubscribeReports=function(e){this.reportService.unsubscribe(e);
},t.prototype.subscribeDashboards=function(e){var t={onDashboardAdded:e,onDashboardDeleted:e,onDashboardsReset:e};return this.dashboardDataService.subscribe(t),t},t.prototype.unsubscribeDashboards=function(e){this.dashboardDataService.unsubscribe(e)},t.prototype.subscribeModels=function(e){var t={onModelAdded:e,onModelDeleted:e,onModelsReset:e};return this.modelService.subscribe(t),t},t.prototype.unsubscribeModels=function(e){this.modelService.unsubscribe(e)},t.prototype.subscribeWorkbooks=function(e){var t={onWorkbookAdded:e,onWorkbookDeleted:e,onWorkbooksReset:e};return this.workbookService.subscribe(t),t},t.prototype.unsubscribeWorkbooks=function(e){this.workbookService.unsubscribe(e)},t.prototype.openContent=function(e,t,i,o){var r=this.getStrategy(e);r&&r.openContent(e,t,i,o)},t.prototype.openUsageMetricsReport=function(e,t,i,o){var r=this.getStrategy(e);r&&r.openUsageMetricsReport(e,t)},t.prototype.showRename=function(e){var t=this.getStrategy(e);t&&t.showRename(l.getObjectID(e))},t.prototype.analyzeContentInExcel=function(e){var t=this.getStrategy(e);t&&t.analyzeContentInExcel(e)},t.prototype.personalizeContent=function(t){var i=this.getStrategy(t);if(i){var o=l.getPackageId(t);this.telemetryService.logEvent(e.telemetry.DashboardClickPersonalize,o),this.contentPackService.onPersonalizeContentPack(o)}},t.prototype.getModels=function(e){var t=this.getStrategy(e);if(t)return t.getModels(e)},t.prototype.runInsights=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,o,r,a,n;return __generator(this,(function(s){switch(s.label){case 0:return(i=this.getStrategy(t))?(o=i.getModels(t),r=o&&o[0],a=t.contentTileType===d.Report?e.insights.constants.insightsSourceReportTile:e.insights.constants.insightsSourceNavigationPane,[4,this.lazyInjector("insightsBootstrap")]):[3,2];case 1:n=s.sent(),n.start(r.dbName,r.vsName,r.packageId,a),s.label=2;case 2:return[2]}}))}))},t.prototype.getStrategy=function(e){var t={navigation:this.navigation,dashboardService:this.dashboardService,reportService:this.reportService,errorService:this.errorService,$rootScope:this.$rootScope,modalDialogService:this.modalDialogService,localizationService:this.localizationService,modelService:this.modelService,analyzeInExcel:this.analyzeInExcel,workbookService:this.workbookService,contentPackService:this.contentPackService,packageService:this.packageService,telemetryService:this.telemetryService,refreshService:this.refreshService,permissionService:this.permissionService,settingsMetadataService:this.settingsMetadataService,location:this.location,$window:this.$window,favorites:this.favorites,shareSliderService:this.shareSliderService,groupService:this.groupService,promiseFactory:this.promiseFactory,appService:this.appService,mostRecentlyUsedService:this.mostRecentlyUsedService,taskPaneSliderService:this.taskPaneSliderService,ownershipService:this.ownershipService,usageMetricsReport:this.usageMetricsReport,lazy:this.lazyInjector,licenseEnforcementService:this.licenseEnforcementService};switch(e.contentTileType){case d.Dashboard:return new T(t);case d.Favorite:return new k(t);case d.Report:return new I(t);case d.Workbook:return new M(t);case d.OrgApp:return new P(t);case d.Dataset:return new E(t);case d.MRU:return new A(t);case d.AppPlaceHolder:return new x(t)}},t.prototype.switchGroupThenAddFavorite=function(t,i){var o=this,r=this.groupService.getGroup(i),a=this.telemetryService.startEvent(e.telemetry.GroupsSwitchGroup,i);return this.groupService.switchGroup(r,!1,a).then((function(){return o.addFavoriteInternal(t)}))},t.prototype.addFavoriteInternal=function(e){return this.favorites.addFavorite(e)},t})();e.ContentListService=D;var C=(function(){function e(e){this.services=e}return e.prototype.openContent=function(e,t){},e.prototype.openUsageMetricsReport=function(e,t){},e.prototype.deleteContent=function(e,t){},e.prototype.shareContent=function(e,t){},e.prototype.shareReport=function(e){},e.prototype.editContent=function(e){},e.prototype.canEditContent=function(e){},e.prototype.showRename=function(e){},e.prototype.identifyAndDeleteContent=function(e){},e.prototype.analyzeContentInExcel=function(e){},e.prototype.getModels=function(e){},e.prototype.runInsights=function(e){},e.prototype.canRefreshNow=function(e){return!1},e.prototype.canScheduleRefresh=function(e){return!1},e.prototype.canReplaceWorkbook=function(e){return!1},e.prototype.canShowTileOptions=function(e){return!0},e.prototype.refreshNow=function(e){},e.prototype.scheduleRefresh=function(e){},e.prototype.exportDashboard=function(e){},e.prototype.editWorkbook=function(e){},e.prototype.replaceWorkbook=function(e){},e.prototype.exportReportToPowerPoint=function(e){},e.prototype.prepareAndTriggerModelDeletion=function(e,t,i,o){var r=this.services.modelService.findModel(e,t);if(r&&r.isUsedByContentPack)this.services.contentPackService.showDialogOnModelDeleteInContentPack(e);else{var a=this.services.localizationService.get(i),n=this.services.localizationService.get(o);this.deleteModel(e,t,a,n)}},e.prototype.deleteModel=function(e,t,i,o){var r=this,a=this.services.errorService.control(),n=[new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_Delete"),function(i,o){a.hideDialog(),r.services.modelService.deleteModel(e,t)}),new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_Cancel"),function(e,t){a.hideDialog()})],s=this.services.modelService.findModel(e,t),c="";s&&(c=s.displayName),i=i||this.services.localizationService.get("Model_DeleteConfirmationTitle"),o=o||this.services.localizationService.format("Model_DeleteConfirmationMessage",c),a.showCustomDialog(i,$("<div/>").text(o),n,(function(e){e.parent().find('input[value="'+r.services.localizationService.get("ModalDialogButtonText_No")+'"]').focus()}),!0)},e.prototype.removeWorkbook=function(e,t,i){var o=this;t||i||(t="Workbook_RemoveConfirmationTitle",i=e.isOwner()?this.services.packageService.isLocalWorkbook(e.packageId)?"Workbook_RemoveOwnedLocalConfirmationMessage":"Workbook_RemoveOwnedRemoteConfirmationMessage":e.isPersonalized()?"Workbook_RemovePersonalizedConfirmationMessage":"Workbook_RemoveInOrgPackConfirmationMessage");var r=this.services.localizationService.get(t),a=this.services.localizationService.get(i),n=this.services.errorService.control(),s=[new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_Remove"),function(t,i){n.hideDialog(),o.services.workbookService.removeWorkbook(e.id,e.packageId,o.services.packageService.getWorkbookStorageProvider(e.packageId),o.services.packageService.getWorkbookContentProvider(e.packageId)),o.services.mostRecentlyUsedService.removeMRU(e.uniqueId)}),new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_Cancel"),function(e,t){n.hideDialog()})];n.showCustomDialog(r,$("<div/>").text(a),s,(function(e){e.parent().find('input[value="'+o.services.localizationService.get("ModalDialogButtonText_No")+'"]').focus()}),!0)},e})(),T=(function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.openContent=function(t,r,a,n){return __awaiter(this,void 0,e.Promise,(function(){var c,d,p,u,h;return __generator(this,(function(v){switch(v.label){case 0:return c=this.services,d=l.getObjectID(t),p=l.getOriginalObjectID(t),u=c.dashboardService.findDashboardByGUID(d),h=u,h?[4,c.licenseEnforcementService.supportsDashboard(u.contract,e.telemetry.LicenseEnforcementOperation.SwitchDashboards,!0)]:[3,2];case 1:h=!v.sent(),v.label=2;case 2:return h?[2]:(c.telemetryService.logEvent(e.telemetry.ContentListOpenArtifact,i(c.navigation),s.Dashboard),_.isEmpty(a)?c.ownershipService.isResourceSharedWithMe(t)?c.navigation.navigateToSharedDashboardByGUID(d):c.navigation.insertGroupAndNavigateToDashboardByGUID(d,r):(o.isOrgAppInstance(n,c.appService)&&(n=null),c.navigation.navigateToAppDashboardByGUID(d,p,a,r,null,!0,n)),[2])}}))}))},r.prototype.openUsageMetricsReport=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a,n;return __generator(this,(function(s){switch(s.label){case 0:if(o=l.getObjectID(t),r=this.services.dashboardService.findDashboardByGUID(o),!r)return[2];a=this.services.telemetryService.startEvent(e.telemetry.UsageMetricsViewUsageMetricsReport,e.constants.usageMetrics_Dashboard,o,e.constants.usageMetrics_NavModel),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.services.usageMetricsReport.openDashboardUsageMetricsReport(r,i,a)];case 2:return s.sent(),a.resolve(),[3,4];case 3:return n=s.sent(),a.reject(e.errorDetailsHelper.getTelemetryErrorDetails(n.error)),[3,4];case 4:return[2]}}))}))},r.prototype.deleteContent=function(e,t){var i=this.services.dashboardService.findDashboardByGUID(e);i&&this.services.dashboardService.promptForDeleteDashboard(i.id,t)},r.prototype.shareContent=function(e,t){e&&e instanceof p&&(this.services.shareSliderService.openShareSlider(e),e.isContentTileSelected=!0)},r.prototype.showRename=function(e){var t=this.services.dashboardService.findDashboardByGUID(e);t&&(this.services.settingsMetadataService.setSettings(1,e),t.isContentTileSelected=!0,this.services.taskPaneSliderService.expandPane(12,a.Medium))},r.prototype.canShowTileOptions=function(e){return!this.services.permissionService.isActiveWorkspaceIsReadOnly},r.prototype.getModels=function(e){var t=this;if(e&&e instanceof p){var i=e.contract;if(i&&!_.isEmpty(i.modelIds)&&!_.isEmpty(i.packageIds))return _.map(i.modelIds,(function(e){return t.services.modelService.findModel(e)}))}},r.prototype.exportDashboard=function(e){var t=this.services.dashboardService.findDashboardByGUID(e);if(t){var i;this.services.location&&(i=this.services.location.search()[w]),i||(i="XMLA"),this.services.dashboardService.exportDashboard(t.id,i)}},r.prototype.identifyAndDeleteContent=function(e){var t=this.services.dashboardService.findDashboardByGUID(e);if(t){var i=t.contract.workbookIds[0],o=t.contract.modelIds[0],a=t.contract.originalPackageId;if(o)this.prepareAndTriggerModelDeletion(o,a,r.dashboardDeleteConfirmationTitle,r.dashboardDeleteContentPackMessage);else if(i){var n=this.services.workbookService.findWorkbook(i,a);if(n&&n.isUsedByContentPack)this.services.contentPackService.showDialogOnWorkbookRemoveInContentPack(i);else{var s=r.dashboardDeleteConfirmationTitle,c=r.dashboardDeleteConfirmationTitle;this.removeWorkbook(n,s,c)}}else a&&this.services.appService.deleteInstance(a)}},r.dashboardDeleteConfirmationTitle="Dashboard_DeleteConfirmationTitle",r.dashboardDeleteContentPackMessage="Dashboard_DeleteOrgAppContentPack",r})(C),I=(function(t){function r(e){return t.call(this,e)||this}return __extends(r,t),r.prototype.openContent=function(t,r,a,n){this.services.telemetryService.logEvent(e.telemetry.ContentListOpenArtifact,i(this.services.navigation),s.Report);var c=l.getObjectID(t),d=l.getOriginalObjectID(t),p=a&&n&&!o.isOrgAppInstance(n,this.services.appService)?n:void 0;this.services.navigation.navigateToReport({appGUID:a,appInstanceId:p,reportGUID:c,reportOriginalGUID:d,groupGUID:r})},r.prototype.openUsageMetricsReport=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a,n;return __generator(this,(function(s){switch(s.label){case 0:if(o=l.getObjectID(t),r=this.services.reportService.findReportByGUID(o),!r)return[2];a=this.services.telemetryService.startEvent(e.telemetry.UsageMetricsViewUsageMetricsReport,e.constants.usageMetrics_Report,o,e.constants.usageMetrics_NavModel),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.services.usageMetricsReport.openReportUsageMetricsReport(r,i,a)];case 2:return s.sent(),a.resolve(),[3,4];case 3:return n=s.sent(),a.reject(e.errorDetailsHelper.getTelemetryErrorDetails(n.error)),[3,4];case 4:return[2]}}))}))},r.prototype.showRename=function(e){var t=this.services.reportService.findReportByGUID(e);t&&(this.services.settingsMetadataService.setSettings(2,e),t.isContentTileSelected=!0,this.services.taskPaneSliderService.expandPane(12,a.Medium))},r.prototype.deleteContent=function(e,t){var i=this.services.reportService.findReportByGUID(e);i&&this.deleteReport(i.id)},r.prototype.shareReport=function(e){e&&e instanceof b&&(this.services.shareSliderService.openShareReportSlider(e),e.isContentTileSelected=!0)},r.prototype.canShowTileOptions=function(t){if(t&&t instanceof b){var i=this.getModels(t),o=i&&i[0];return!this.services.permissionService.isActiveWorkspaceIsReadOnly&&o&&o.packagePublishStatus!==e.common.contracts.PublishOrRefreshStatus.PublishInProgress}return!1},r.prototype.identifyAndDeleteContent=function(e){var t=this.services.reportService.findReportByGUID(e);if(t){var i=t.modelId,o=t.packageId;i&&this.prepareAndTriggerModelDeletion(i,o,r.reportDeleteConfirmationTitle,r.reportDeleteContentPackMessage)}},r.prototype.analyzeContentInExcel=function(t){var i=this.getModels(t),o=i&&i[0];o&&(this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsAnalyzeInExcel,"Report Navigation Pane List",o.contentProviderId,o.contract.modelFeatures,o.dbName),this.services.analyzeInExcel.startAnalyzeInExcel(o))},r.prototype.exportReportToPowerPoint=function(e){var t=this.services.reportService.findReportByGUID(e);if(t){var i={reportId:t.id,filename:t.displayName,reportSectionsNumber:void 0};this.services.lazy("exportToPowerPoint").then((function(e){e.exportToPowerPoint(i)}))}},r.prototype.getModels=function(e){if(e&&e instanceof b){var t=this.services.modelService.findModel(e.modelId,e.packageId);if(t)return[t]}},r.prototype.deleteReport=function(e){var t=this,i=this.services.$rootScope.$new(),o=this.services.errorService.control(),r=this.services.reportService.findReport(e),a=[new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_Delete"),function(i,a){o.hideDialog(),t.services.mostRecentlyUsedService.removeMRU(r.objectId),t.services.reportService.deleteReport(e)}),new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_Cancel"),function(e,t){o.hideDialog()})];i.message=this.services.localizationService.format("Report_DeleteConfirmationMessage",[r.displayName]);var n,s,c=this.services.dashboardService.hasTileForReportandSection(void 0,e);c&&(n=jsCommon.ModalDialogNotificationType.Warning,s=this.services.localizationService.get("PinLiveReport_DeleteReportWarning"));var l={dialogName:this.services.localizationService.get("Report_DeleteConfirmationTitle"),isDismissable:!0,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",focusOnFirstButton:!0,dialogActions:a,notificationType:n,notificationText:s};this.services.modalDialogService.showLegacyWebModalDialog(l)},r.reportDeleteConfirmationTitle="Report_DeleteConfirmationTitle",r.reportDeleteContentPackMessage="Report_DeleteOrgAppContentPack",r})(C),k=(function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.openContent=function(t,o,r,a){var n=t;if(3===n.favoriteType){var c=new P(this.services);c.openContent(n,o,n.contentProviderKey,n.favoriteId)}else{this.services.telemetryService.logEvent(e.telemetry.ContentListOpenArtifact,i(this.services.navigation),s.Dashboard);var d=l.getObjectID(t);this.services.navigation.insertGroupAndNavigateToDashboardByGUID(d,o)}},o.prototype.shareContent=function(e,t){this.services.groupService.activeGroupObjectId!==t?this.switchGroupThenShare(e,t):this.shareContentInternal(e)},o.prototype.canEditContent=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o;return __generator(this,(function(r){switch(r.label){case 0:return e=t,3!==e.favoriteType?[3,3]:[4,this.services.appService.ensureAppsInitialization()];case 1:return r.sent(),(i=this.getFavoriteAppInstance(e))?(o=new P(this.services),[4,o.canEditContent(i)]):[3,3];case 2:return[2,r.sent()];case 3:return[2,!1]}}))}))},o.prototype.editContent=function(e){var t=e;if(3===t.favoriteType){var i=this.getFavoriteAppInstance(t);if(i){var o=new P(this.services);o.editContent(i)}}},o.prototype.getFavoriteAppInstance=function(e){var t=e;if(3!==t.favoriteType)return null;var i=this.services.appService.getAppInstancesForApp(t.contentProviderKey);return _.first(i)},o.prototype.switchGroupThenShare=function(t,i){var o=this,r=this.services.groupService.getGroup(i),a=this.services.telemetryService.startEvent(e.telemetry.GroupsSwitchGroup,i);this.services.groupService.switchGroup(r,!1,a).then((function(){o.services.groupService.ensureGroupsInitialization().then((function(){o.services.navigation.inFavoritesView()&&o.services.dashboardService.getDashboards().then((function(){o.shareContentInternal(t)}))}))}))},o.prototype.shareContentInternal=function(e){var t=l.getObjectID(e),i=this.services.dashboardService.findDashboardByGUID(t);if(i){this.services.shareSliderService.openShareSlider(i);var o=this.services.favorites.getFavoriteByContentTile(e);o&&(o.isContentTileSelected=!0)}},o.prototype.canShowTileOptions=function(e){return!0},o})(C),M=(function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.openContent=function(t,o,r,a){var n=l.getObjectID(t),c=this.services.workbookService.findWorkbookByUniqueId(n);c&&(c.isNew=!1),this.services.telemetryService.logEvent(e.telemetry.ContentListOpenArtifact,i(this.services.navigation),s.Workbook),_.isEmpty(r)?this.services.navigation.insertGroupAndNavigateToWorkbookByUniqueId(n,o):this.services.navigation.navigateToAppWorkbookByUniqueId(n,r,o)},o.prototype.editWorkbook=function(t){var i=this.services.workbookService.findWorkbookByUniqueId(t);i&&(this.services.$window.open(i.editUrl,"_blank"),this.services.telemetryService.logEvent(e.telemetry.DashboardEditWorkbook,i.contract.etagHash))},o.prototype.replaceWorkbook=function(e){var t=this.services.workbookService.findWorkbookByUniqueId(e);t&&this.services.workbookService.replaceLocalWorkbook(t.uniqueId)},o.prototype.showRename=function(e){var t=this.services.workbookService.findWorkbookByUniqueId(e);t&&(this.services.settingsMetadataService.setSettings(3,e),t.isContentTileSelected=!0,this.services.taskPaneSliderService.expandPane(12,a.Medium))},o.prototype.identifyAndDeleteContent=function(e){var t=this.services.workbookService.findWorkbookByUniqueId(e);if(t){var i=t.id,o=t.packageId;if(i){var r=this.services.workbookService.findWorkbook(i,o);r&&r.isUsedByContentPack?this.services.contentPackService.showDialogOnWorkbookRemoveInContentPack(i):this.removeWorkbook(r)}}},o.prototype.canRefreshNow=function(e){var t=l.getObjectID(e),i=this.services.workbookService.findWorkbookByUniqueId(t);return!!i&&this.services.packageService.isRefreshNowEnabledForWorkbook(i)},o.prototype.canShowTileOptions=function(e){return!this.services.permissionService.isActiveWorkspaceIsReadOnly},o.prototype.getModels=function(e){if(e&&e instanceof S&&e.isOwner()&&e.modelId&&e.packageId){var t=this.services.modelService.findModel(e.modelId,e.packageId);if(t)return[t]}},o.prototype.canScheduleRefresh=function(e){var t=l.getObjectID(e),i=this.services.workbookService.findWorkbookByUniqueId(t);return!!i&&this.services.packageService.isScheduleRefreshEnabledForWorkbook(i)},o.prototype.canReplaceWorkbook=function(e){var t=this.services.workbookService.findWorkbookByUniqueId(e);return!!t&&this.services.packageService.isLocalWorkbook(t.packageId)},o.prototype.refreshNow=function(t){var i=l.getObjectID(t),o=this.services.workbookService.findWorkbookByUniqueId(i);if(o)if(o.modelId&&o.contract.isPowerPivotVersionSupportsRefresh){var r=this.services.modelService.findModel(o.modelId,o.packageId);r&&(this.services.telemetryService.logEvent(e.telemetry.DashboardWorkbookClickRefreshNow,r.contentProviderId),this.services.refreshService.tryRefreshNow(this.services.telemetryService,this.services.errorService,r,"workbooks"))}else this.services.telemetryService.logEvent(e.telemetry.DashboardWorkbookClickRefreshNow,o.contentProviderId),this.services.refreshService.refreshNow(this.services.telemetryService,this.services.errorService,o.packageId,o.contentProviderId)},o.prototype.scheduleRefresh=function(t){var i=l.getObjectID(t),o=this.services.workbookService.findWorkbookByUniqueId(i);if(o){var r=this.services.modelService.findModel(o.modelId,o.packageId);r&&(this.services.telemetryService.logEvent(e.telemetry.DashboardWorkbookClickScheduleRefresh,r.contentProviderId),this.services.$rootScope.$emit(e.common.constants.showSettingsViewerEventName,"workbooks",r.dbName))}},o})(C),P=(function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.openContent=function(t,i,o,r){var a=this,n=this.services;n.groupService.ensureGroupsInitialization().then((function(){if(n.groupService.isMyWorkspace())a.openContentHelper(t,i,o,r);else{var s=_.find(n.groupService.groups,(function(e){return e.isMyWorkspace})),c=a.services.telemetryService.startEvent(e.telemetry.GroupsSwitchGroup,s.aadGroupId);n.groupService.switchGroup(s,!1,c,!0).then((function(){a.openContentHelper(t,i,o,r)}))}}))},r.prototype.openContentHelper=function(t,r,a,n){var c=this.services;c.telemetryService.logEvent(e.telemetry.ContentListOpenArtifact,i(c.navigation),s.OrgApp);var l;if(t.contentTileType===d.MRU&&t instanceof g?(l=c.appService.getAppInstance(t.packageid),null==l&&this.services.mostRecentlyUsedService.removeMRU(t.objectId,r)):t.contentTileType===d.Favorite&&null!=n?l=c.appService.getAppInstance(n):t.contentTileType===d.OrgApp&&(l=t),null==l)return e.helpers.ArtifactNotFoundHelper.showArtifactDoesNotExistDialog("ArtifactKind_App",this.services.errorService,this.services.localizationService,this.services.telemetryService),void this.services.navigation.navigateToApps();if(c.licenseEnforcementService.supportsConnectApps(l.providerContract,!1,!0)){var u=o.getDefaultAppArtefact(l,c.appService),h=o.isOrgApp(l.providerContract)?null:l.packageId;if(u){var v=t.objectId;u instanceof p?this.services.navigation.navigateToAppDashboardByGUID(u.objectId,u.contract.originalDashboardObjectId,v,r,null,!0,h):u instanceof b?this.services.navigation.navigateToReport({appGUID:v,appInstanceId:h,reportGUID:u.objectId,reportOriginalGUID:u.contract.originalReportObjectId,groupGUID:this.services.groupService.activeGroupObjectId}):u instanceof S&&this.services.navigation.navigateToAppWorkbookByUniqueId(u.uniqueId,v,r)}else this.services.navigation.navigateToApp(l.providerContract.providerKey,h)}},r.prototype.identifyAndDeleteContent=function(e){var t=this.services.appService,i=t.getAppByGUID(e),r=i.providerKey,a=o.getPackageIDByOrgAppGUID(t,this.services.packageService,r);t.deleteInstance(a)},r.prototype.canShowTileOptions=function(e){return!1},r.prototype.canScheduleRefresh=function(e){return!1},r.prototype.editContent=function(e){var t=e,i=t.groupObjectId,o=this.services.groupService,r=o.getGroup(i);!r||r.contract.isReadOnly&&!r.contract.isOwner||this.services.navigation.navigateToContentList(t.groupObjectId)},r.prototype.canEditContent=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i;return __generator(this,(function(o){switch(o.label){case 0:return e=t,[4,this.services.groupService.ensureGroupsInitialization()];case 1:return o.sent(),i=_.find(this.services.groupService.groups,(function(t){return t.aadGroupId===e.groupObjectId&&(!t.contract.isReadOnly||t.contract.isOwner)})),[2,!!i]}}))}))},r})(C),E=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.canShowTileOptions=function(e){return!1},i.prototype.analyzeContentInExcel=function(t){var i=t;this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsAnalyzeInExcel,"Report Navigation Pane List",i.contentProviderId,i.contract.modelFeatures,i.dbName),this.services.analyzeInExcel.startAnalyzeInExcel(i)},i.prototype.getModels=function(e){var t=e;if(t)return[t]},i.prototype.canRefreshNow=function(e){return this.canModelRefresh(e)},i.prototype.refreshNow=function(e){if(this.canRefreshNow(e)){var t=e;this.services.refreshService.tryRefreshNow(this.services.telemetryService,this.services.errorService,t,"datasets")}},i.prototype.canScheduleRefresh=function(e){return this.canModelRefresh(e)},i.prototype.scheduleRefresh=function(e){if(this.canScheduleRefresh(e)){var t=e;this.services.navigation.showSettingsSlider("datasets",t.dbName)}},i.prototype.canModelRefresh=function(e){if(e instanceof h&&u.hasFlag(e.getPermissions(),r.Write))return!!o.isParameterizedAppInstance(e.packageId,this.services.appService)},i})(C),A=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getStrategy=function(e){switch(e.type){case v.Dashboards:return new T(this.services);case v.Reports:return new I(this.services);case v.Workbooks:return new M(this.services);case v.AppInstance:return new P(this.services)}},t.prototype.openContent=function(e,t,i,o){if(e instanceof g){var r=this.getStrategy(e);if(r){var a=l.getMRUOriginalContentTile(e,this.services.dashboardService,this.services.reportService,this.services.workbookService,this.services.appService);o=e.packageid||o,r.openContent(a,t,i,o)}}},t})(C),x=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.openContent=function(t,i,o,r){e.helpers.ContentProviderStoreHelper.navigateToCategoryAndProviderHelper(c.Organizational,e.contentProviderConstants.getAppsInteraction,0,this.services.telemetryService,this.services.navigation,this.services.$rootScope,!0)},i.prototype.canShowTileOptions=function(e){return!1},i})(C)})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r){return new h(e,t,i,o,r)}function i(e,t,i){var o=e?r.dynamicGridWidth:r.dynamicGridHeight,a=0;i&&(a=e?l+d:p+u);var n=e?0:c;return o*t+2*r.dynamicGridItemSpacing*(t-1)-a-n}function o(t,i,o,r){var s=i.tooltipsEnabled,c=r&&r.forecastEnabled,l=r&&r.improvedMapLegend,d=r&&r.axisControlImprovements,p=r&&r.responsiveCartesianChart,u=r&&r.customFontFamily,h=r&&r.customFontFamilyForDataLabel,v=r&&r.lineMarkersEnabled,g=r&&r.lineStylesEnabled;switch(t){case e.visuals.plugins.barChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.barChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:6,tooltipsEnabled:s,animator:t.createDashboardColumnChartAnimator(),cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.clusteredBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredBarChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:5,tooltipsEnabled:s,animator:t.createDashboardColumnChartAnimator(),cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.clusteredColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.clusteredColumnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:3,tooltipsEnabled:s,animator:t.createDashboardColumnChartAnimator(),cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.columnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.columnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:4,tooltipsEnabled:s,animator:t.createDashboardColumnChartAnimator(),cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.dataDotClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotClusteredColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:16,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.dataDotStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.dataDotStackedColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:17,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.donutChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.donutChart,(function(){return new e.visuals.DonutChart({tooltipsEnabled:s,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.funnel.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.funnel,(function(){return new e.visuals.FunnelChart({tooltipsEnabled:s,axisControlImprovements:d,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.gauge.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.gauge,(function(t){return t.module.createGauge({animator:new e.visuals.BaseAnimator,tooltipsEnabled:s,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.hundredPercentStackedBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedBarChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:7,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.hundredPercentStackedColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.hundredPercentStackedColumnChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:8,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.lineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineChart,(function(e){
var t=e.module;return t.createCartesianChart({chartType:0,tooltipsEnabled:s,forecastEnabled:c,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p}),lineMarkersEnabled:v,lineStylesEnabled:g})}),r);case e.visuals.plugins.areaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.areaChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:1,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p}),lineMarkersEnabled:v,lineStylesEnabled:g})}),r);case e.visuals.plugins.stackedAreaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.stackedAreaChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:2,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p}),lineMarkersEnabled:v,lineStylesEnabled:g})}),r);case e.visuals.plugins.lineClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineClusteredColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:14,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p}),lineMarkersEnabled:v,lineStylesEnabled:g})}),r);case e.visuals.plugins.lineStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.lineStackedColumnComboChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:15,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p}),lineMarkersEnabled:v,lineStylesEnabled:g})}),r);case e.visuals.plugins.pieChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pieChart,(function(){return new e.visuals.DonutChart({sliceWidthRatio:0,tooltipsEnabled:s,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.ribbonChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.ribbonChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:9,tooltipsEnabled:s,animator:t.createDashboardColumnChartAnimator(),cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.scatterChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.scatterChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:10,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,scatterWithMatrixDV:r&&r.scatterWithMatrixDV,scatterWithDataVolume:r&&r.scatterWithDataVolume,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.treemap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.treemap,(function(e){var t=e.module;return new t.Treemap({isScrollable:!1,tooltipsEnabled:s,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.waterfallChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.waterfallChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:13,tooltipsEnabled:s,cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,axisControlImprovements:d,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p}),waterfallBreakdown:r&&r.waterfallBreakdown})}),r);case e.visuals.plugins.map.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.applyImprovedMapLegendMappings(e.visuals.plugins.map,l,!1),(function(){return new e.visuals.Map({tooltipsEnabled:s,disableZooming:!0,disablePanning:!0,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.filledMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.applyImprovedMapLegendMappings(e.visuals.plugins.filledMap,l,!0),(function(){return new e.visuals.Map({filledMap:!0,tooltipsEnabled:s,disableZooming:!0,disablePanning:!0,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.shapeMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.shapeMap,(function(e){var t=e.module;return new t.ShapeMap({tooltipsEnabled:s,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.matrix.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.matrix,(function(){return new e.visuals.Matrix}),r);case e.visuals.plugins.tableEx.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.tableEx,(function(){return new e.visuals.TableEx(n.createDashboardConstructorOptions())}),r);case e.visuals.plugins.pivotTable.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.pivotTable,(function(){return new e.visuals.PivotTable(a.createDashboardConstructorOptions())}),r);case e.visuals.plugins.realTimeLineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.realTimeLineChart,(function(e){var t=e.module;return t.createCartesianChart({chartType:18,animator:t.createRealTimeLineChartAnimator(),cartesianSmallViewPortProperties:o.cartesianSmallViewPortProperties,legendSmallViewPortProperties:o.legendSmallViewPortProperties,animateCategoryAxis:!0,animateValueAxis:!0,responsiveCartesianChart:p,customFontFamily:u,customFontFamilyForDataLabel:h,viewModelAdapter:t.createCartesianViewModelAdapter({responsiveCartesianChart:p})})}),r);case e.visuals.plugins.table.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.table,(function(){return new e.visuals.Table}),r);case e.visuals.plugins.card.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.card,(function(e){return e.module.createCard({cardSmallViewportProperties:o.cardSmallViewportProperties,customFontFamilyForDataLabel:h})}),r);case e.visuals.plugins.textbox.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins.textbox,(function(e){var t=e.module;return t.createTextbox({viewModelAdapter:t.createTextboxViewModelAdapter(o.textboxSmallViewportProperties),disableScrollingInViewMode:!0})}),r);case e.visualHost.EsriVisual:return e.visuals.plugins[e.visualHost.EsriVisual]?e.visualHost.visualPluginServiceHelpers.getPluginCopyWithFeatureSwitches(e.visuals.plugins[e.visualHost.EsriVisual],e.visuals.plugins[e.visualHost.EsriVisual].create,r):null;default:return e.Prototype.inherit(e.visuals.plugins[t])}}var r=e.common.GridLayoutConstants,a=e.visuals.PivotTableOptions,n=e.visuals.TableExOptions,s=e.visualHost.visualPluginServiceHelpers.VisualPluginStorage,c=42,l=10,d=10,p=0,u=8;e.createDashboardVisualPluginService=t;var h=(function(){function t(t,r,a,n,c){var l=this;this.asyncFeatureSwitchService=t,this.promiseFactory=r,this.resourceLoader=a,this.telemetryService=n,this.storage=new s;var d=i(!0,2,!1),p=i(!0,2,!0),u=i(!1,2,!0),h=i(!0,3,!0),v=i(!0,4,!0),g=i(!1,2,!0),m=i(!0,3,!0),f=i(!1,2,!0),b=i(!0,3,!0),y=i(!0,2,!0),S=i(!1,2,!0),w=i(!0,4,!0),D=i(!1,3,!0),C={cardSmallViewportProperties:{cardSmallViewportWidth:d},cartesianSmallViewPortProperties:{minWidthForLegend:p,minHeightForLegend:u,minHeightForAxisLabels:f,minWidthForAxisLabels:m,mediumWidthForAxis:b,minWidthForAxis:y,minHeightForAxis:S,maxWidthForMediumFont:v,maxWidthForSmallFont:h},legendSmallViewPortProperties:{maxWidthForSmallFont:h,maxWidthForMediumFont:v,minHeightForTransform:g},textboxSmallViewportProperties:{minWidthToScaleFontSize:w,minHeightToScaleFontSize:D}};this.initBuiltInPlugins=this.asyncFeatureSwitchService.getFeatureSwitches().then((function(t){for(var i in e.visuals.plugins)l.storage.loadPlugin(i,o(i,c,C,t))}))}return t.prototype.ensureBuiltInPlugins=function(){return this.initBuiltInPlugins},t.prototype.getVisuals=function(){return this.storage.getLoadedPlugins()},t.prototype.ensureTrustedVisualPlugins=function(e){s.ensureTrustedVisualPlugins(this.storage,e)},t.prototype.ensurePlugins=function(e,t){var i=[];if(e&&e.length)for(var o=0,r=e;o<r.length;o++){var a=r[o];0===a.type&&i.push(this.ensurePlugin(a,!1))}return this.promiseFactory.allSettled(i)},t.prototype.ensurePlugin=function(e,t){return s.ensurePlugin(this.storage,this.promiseFactory,this.resourceLoader,e,!1,this.telemetryService)},t.prototype.getPlugin=function(t){var i=this.storage.getLoadedPlugin(t);return!i&&e.visuals.plugins[t]&&(this.storage.loadPlugin(t,e.Prototype.inherit(e.visuals.plugins[t])),i=this.storage.getLoadedPlugin(t)),i},t.prototype.capabilities=function(e){var t=this.getPlugin(e);return t?t.capabilities:void 0},t.prototype.isCustomVisual=function(t){return e.visualHost.utils.isCustomVisual(this.getPlugin(t),t)},t.prototype.getInteractivityOptions=function(){return{overflow:"hidden",isVisualInteractive:!1}},t.prototype.getTelemetryHostInformation=function(){return{name:"Dashboard"}},t.prototype.isScriptVisual=function(t){return e.visualHost.utils.isScriptVisual(this.getPlugin(t))},t.prototype.isScriptVisualQueryable=function(){return e.visualHost.utils.isScriptVisualQueryable(this.asyncFeatureSwitchService.featureSwitches)},t.prototype.isLightWeightRenderingVisual=function(t){return e.visualHost.utils.isLightWeightRenderingVisual(this.getPlugin(t))},t.prototype.getStorage=function(){return this.storage},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i){return new a(e,t,i)}var i=e.data.EmptyDataClientError,o=e.data.InvalidDataResponseClientError;e.createDelayedQueryResultResolver=t;var r=1e4,a=(function(){function t(e,t,i){this.jobsWaitingForResults={},this.jobsAlreadyResolved=[],this.syncService=e,this.$timeout=t,this.telemetryService=i,e.addDelayedQueryDataListener(this)}return t.prototype.resolveDelayedQuery=function(e,t){var i=this,o=this.$timeout(r);o.then((function(){return i.preemptiveQuery(e)})),this.jobsWaitingForResults[e]={jobId:e,deferred:t,preemptiveQueryPromise:o},this.jobsAlreadyResolved.indexOf(e)>=0&&this.onDelayedQueryDataAvailable(e)},t.prototype.onDelayedQueryDataAvailable=function(i){var r=this,a=this.jobsWaitingForResults[i];a?(this.$timeout.cancel(this.jobsWaitingForResults[i].preemptiveQueryPromise),delete this.jobsWaitingForResults[i],e.queryService.getQueryData(i,void 0).then((function(e){return r.handleQueryDataResult(e,a)})).catch((function(){a.deferred.reject(new o)}))):this.jobsAlreadyResolved.indexOf(i)<0&&(this.jobsAlreadyResolved.push(i),this.jobsAlreadyResolved.length>t.MaxResolvedJobsToTrack&&this.jobsAlreadyResolved.shift())},t.prototype.preemptiveQuery=function(t){var i=this,o=this.jobsWaitingForResults[t];o&&e.queryService.getQueryData(t,void 0).then((function(r){i.handleQueryDataResult(r,o),delete i.jobsWaitingForResults[t],i.telemetryService.logEvent(e.telemetry.AppPreemptiveQueryData,t)}))},t.prototype.handleQueryDataResult=function(t,o){var r=t.data;if(r&&r.data){var a={descriptor:r.data.descriptor,dsr:r.data.dsr,requestId:t.requestId};o.deferred.resolve(a)}else if(r.error){var n=new e.ServiceErrorToClientError(r.error);n.requestId=t.requestId,o.deferred.reject(n)}else o.deferred.reject(new i)},t.MaxResolvedJobsToTrack=100,t})()})(powerbi||(powerbi={})),define("powerBI/services/errorFormat",["require","exports"],(function(e,t){function i(){return new n}Object.defineProperty(t,"__esModule",{value:!0});var o=powerbi,r=jsCommon.JsonExtensions,a=o.helpers.PowerBIServiceExceptionErrorHelper;t.create=i;var n=(function(){function e(){}return e.prototype.convertErrorDetailsJson=function(e){if(!_.isEmpty(e)){var t=r.tryParseJSON(e),i=[];return a.GenerateErrorMessage(t.error).done((function(e){for(var t=0,o=e.displayableErrorInfo;t<o.length;t++){var r=o[t];i.push({Name:r.errorInfoKey,Value:r.errorInfoValue})}})),i}},e.prototype.getFriendlyErrorMessage=function(e){if(!_.isEmpty(e)){var t=r.tryParseJSON(e);return a.FormatWithNamedParameters(t.error.code,null)}},e})()}));var powerbi;!(function(e){function t(e,t,i,o,a,n,s,c,l,d,p,u,h,v,g,m,f){return new r(e,t,i,o,a,n,s,c,l,d,p,u,h,v,g,m,f)}var i=e.common.contracts.ContentTileType,o=e.common.contracts.Permissions;e.createFavoritesService=t;var r=(function(){function t(t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f){var b=this;this.telemetryService=t,this.favoritesHttp=i,this.activeGroupId=o,this.promiseFactory=r,this.dashboardService=a,this.rootScope=n,this.localizationService=l,this.errorService=d,this.permissionService=p,this.appMetadataService=u,this.navigation=h,this.appService=m,this.mostRecentlyUsedService=f,this.favorites=[],this.listeners=[],this.navigation.inFavoritesView()||this.reloadFavorites(),this.rootScope.$on(e.constants.groupSwitchedEventName,(function(){return b.populateFavorites()}))}return t.prototype.getFavoriteByContentTile=function(t){var i=e.helpers.ContentTileHelper.getObjectID(t),o=e.helpers.ContentTileHelper.getContentFavoriteType(t);return _.find(this.favorites,(function(e){return e.objectId===i&&e.favoriteType===o}))},t.prototype.getFavoriteTelemetryType=function(t){switch(t){case 1:return e.telemetry.FavoriteType.Dashboard;case 3:return e.telemetry.FavoriteType.AppInstance;case 2:return e.telemetry.FavoriteType.Report}},t.prototype.addFavorite=function(t){var i=this,o=e.helpers.ContentTileHelper.getContentFavoriteType(t);if(!o)return this.promiseFactory.reject();var r=e.helpers.ContentTileHelper.getFavoriteId(t,this.dashboardService),a=this.promiseFactory.defer();return this.ensureDependentServices().then((function(t){var n;if(1===o?n=i.dashboardService.findDashboard(r):3===o&&(n=i.appService.getAppInstance(r)),n){n.isFavorite=!0,n.isFavoriteDisabled=!0;var s=i.getFavoriteTelemetryType(o),c=i.telemetryService.startEvent(e.telemetry.DashboardAddFavorite,r,i.activeGroupId.activeGroupObjectId,s);i.favoritesHttp.addFavorite(o,r,c.event).then((function(e){var t=e.data;t.uniqueId=i.getUniqueId(r,o),1===o?(i.fillFavoriteDashboardInfo(t,r,i.activeGroupId.activeGroupObjectId),a.resolve(t)):3===o&&(i.fillFavoriteOrgAppInfo(t,r,i.activeGroupId.activeGroupObjectId),a.resolve(t)),i.matchMRUFavorites(t),c.resolve(),i.onAdded(t)}),(function(e){a.reject(),c.reject(),n&&(n.isFavorite=!1,n.isFavoriteDisabled=!1),i.errorService.error(i.localizationService.get("Favorites_FailedToFavorite"),"",{requestId:e.requestId,statusCode:e.status.toString(),activityId:e.activityId})})).finally((function(){n.isFavoriteDisabled=!1}))}else a.reject()}),(function(e){return a.reject()})),a.promise},t.prototype.deleteFavorite=function(t){var i=this,o=this.getFavoriteByContentTile(t);o&&this.ensureDependentServices().then((function(r){var a,n=e.helpers.ContentTileHelper.getContentFavoriteType(t),s=i.getFavoriteTelemetryType(n);t instanceof e.models.MRUModel?a=t:1===n?a=i.dashboardService.findDashboardByGUID(o.objectId):3===n&&(a=i.appService.getAppInstance(o.favoriteId)),null!=a&&(a.isFavoriteDisabled=!0);var c=i.telemetryService.startEvent(e.telemetry.DashboardDeleteFavorite,o.objectId,o.workspaceId,s);i.favoritesHttp.deleteFavorite(o,c.event).then((function(e){var t=_.remove(i.favorites,(function(e){return e.id===o.id}));t&&t.length>0&&i.onDeleted(o),o=null,c.resolve(),a&&(a.isFavorite=!1,a.isFavoriteDisabled=!1)}),(function(e){c.reject(),i.errorService.error(i.localizationService.get("Favorites_FailedToUnfavorite"),"",{requestId:e.requestId,statusCode:e.status.toString(),activityId:e.activityId}),a&&(a.isFavorite=!0,a.isFavoriteDisabled=!1)}))}))},t.prototype.updateFavoritesWithPermissions=function(e){for(var t=function(e){e.getPermissions=function(){return e.permissions}},i=0,o=e;i<o.length;i++){var r=o[i];t(r)}return e},Object.defineProperty(t.prototype,"favoritesCache",{get:function(){return this.initialized?this.favorites:void 0},enumerable:!0,configurable:!0}),t.prototype.reloadFavorites=function(t){var i=this;if(this.favoritesDeferred=this.promiseFactory.defer(),t){var o=this.telemetryService.startEvent(e.telemetry.DashboardGetFavorites,0);return this.favoritesHttp.getFavorites(o.event).then((function(e){var t=i.updateFavoritesWithPermissions(e.data);i.favorites=t,i.favorites=_.uniq(i.favorites,(function(e){return e.favoriteId})),_.isEmpty(i.favorites)||(o.event.info.countOfFavorites=i.favorites.length),i.populateFavorites().finally((function(){i.favoritesDeferred.resolve(i.favorites),i.initialized=!0,o.resolve(),i.onReset()}))}),(function(t){i.favoritesDeferred.reject(),t.status===e.HttpStatusCode.Unauthorized?o.resolve():(o.reject(),i.errorService.error(i.localizationService.get("Favorites_FailedToLoadFavorites"),"",{requestId:t.requestId,statusCode:t.status.toString(),activityId:t.activityId}))})),this.favoritesDeferred.promise}return this.promiseFactory.all([this.appMetadataService.getAppMetadata(),this.ensureDependentServices()]).then((function(e){var t=e[0]&&e[0].favorites;if(t){var o=i.updateFavoritesWithPermissions(t);i.favorites=o,i.favorites=_.uniq(i.favorites,(function(e){return e.favoriteId})),i.initialized=!0,i.populateFavorites().finally((function(){i.favoritesDeferred.resolve(i.favorites),i.onReset()}))}})),this.favoritesDeferred.promise},t.prototype.subscribe=function(e){_.contains(this.listeners,e)||this.listeners.push(e)},t.prototype.unsubscribe=function(e){_.pull(this.listeners,e)},t.prototype.onAdded=function(e){for(var t=0,i=this.listeners;t<i.length;t++){var o=i[t];o.onFavoriteAdded&&o.onFavoriteAdded(e)}},t.prototype.onDeleted=function(e){for(var t=0,i=this.listeners;t<i.length;t++){var o=i[t];o.onFavoriteDeleted&&o.onFavoriteDeleted(e)}},t.prototype.onReset=function(){for(var e=0,t=this.listeners;e<t.length;e++){var i=t[e];i.onFavoriteDeleted&&i.onFavoritesReset()}},t.prototype.fillFavoriteDashboardInfo=function(e,t,i){var r=this.dashboardService.findDashboard(t);this.fillFavoriteInfo(e,r,1),e.permissions=this.permissionService.isActiveWorkspaceIsReadOnly?o.Read:r.getPermissions(),e.getPermissions=function(){return e.permissions},e.workspaceId===this.activeGroupId.myWorkspaceGroupId?e.ownerInfo=r.ownerFullname:(e.ownerInfo=this.activeGroupId.groupDisplayName,e.workspaceId=i)},t.prototype.fillFavoriteOrgAppInfo=function(e,t,i){var o=this.appService.getAppInstance(t);o&&(this.fillFavoriteInfo(e,o,3),e.permissions=o.getPermissions(),e.getPermissions=o.getPermissions,e.ownerInfo=o.author,e.favoriteId=o.packageId)},t.prototype.fillFavoriteInfo=function(e,t,o){e.objectId=t.objectId,e.displayName=t.displayName,e.contentTileType=i.Favorite,e.favoriteType=o,this.favorites.push(e)},t.prototype.populateFavorites=function(){var e=this,t=this.promiseFactory.defer(),i=this.favorites;return i?this.updateFavorites(i).then((function(){return t.resolve(null)})):this.reloadFavorites().then((function(i){e.updateFavorites(i).then((function(){return t.resolve(null)}))})),t.promise},t.prototype.updateFavorites=function(e){var t=this;return this.ensureDependentServices().then((function(o){var r=t.activeGroupId.activeGroupObjectId;r===t.activeGroupId.myWorkspaceGroupId&&(r=null);for(var a=0,n=e;a<n.length;a++){var s=n[a];s.contentTileType=i.Favorite;var c=s.favoriteId;if(s.uniqueId=t.getUniqueId(c,s.favoriteType),t.matchMRUFavorites(s),3===s.favoriteType){var l=t.appService.getAppInstance(s.favoriteId);l&&(s.objectId=l.providerContract.providerKey,s.ownerInfo=l.author,t.updateFavoritableContent(l,s))}else if(1===s.favoriteType&&s.workspaceId===r){var d=t.dashboardService.findDashboardByGUID(s.objectId);s.dataClassificationId=d&&d.dataClassificationId,t.updateFavoritableContent(d,s)}}}))},t.prototype.matchMRUFavorites=function(e){var t;switch(e.favoriteType){case 1:t=this.mostRecentlyUsedService.findDashboardMRU(e.objectId);break;case 3:t=this.mostRecentlyUsedService.findAppInstanceMRU(e.favoriteId),t&&(e.objectId=t.objectId)}t&&this.updateFavoritableContent(t,e)},t.prototype.updateFavoritableContent=function(e,t){e&&(e.favoriteInfo=t,e.isFavorite=!0)},t.prototype.ensureDependentServices=function(){return this.promiseFactory.all([this.dashboardService.getDashboards(),this.appService.ensureAppsInitialization(),this.mostRecentlyUsedService.getMRUModels()])},t.prototype.getUniqueId=function(e,t){return 10*e+t},t})();e.FavoritesService=r})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i){return new o(e,t,i)}t.createFilterPersistenceService=i;var o=(function(){function t(e,i,o){var r=this;this.userSettingsService=i,this.telemetryService=o,this.filters={},this.filtersLoadedPromise=this.userSettingsService.getExtendedSettingByKey(t.UserExtendedSettingKey).then((function(e){r.filters=e||r.filters}))}return t.prototype.getFilter=function(e){var t=this;return this.filtersLoadedPromise.then((function(){return t.filters?t.filters[e]:null})).catch((function(e){return null}))},t.prototype.setFilter=function(i,o){var r=this.telemetryService.startEvent(e.telemetry.ContentListPersistFilter);this.filters[i]=o,this.userSettingsService.updateExtendedSettings(t.UserExtendedSettingKey,this.filters,r)},t.UserExtendedSettingKey="filter",t})();t.FilterPersistenceService=o})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e){return new r(e)}var i=e.common.models.CollapsiblePaneExpandedWidth,o=e.common.contracts.GroupLinkType;e.createGroupContextMenuService=t;var r=(function(){function t(e){this.services=e,this.localizationService=e.localizationService}return t.prototype.getIconNameForGroupLinkType=function(e){switch(e){case o.Calendar:return"calendar";case o.Conversations:return"comment";case o.Files:return"page2";case o.Members:return"group";case o.Notebook:return"folder";case o.EditGroup:return"edit";case o.ViewGroup:return"show";case o.LeaveGroup:return"delete";case o.EditMyWorkspace:return"edit"}},t.prototype.getTextForGroupLinkType=function(e){switch(e){case o.Calendar:return this.localizationService.get("GroupNavigationPaneContextMenuItem_Calendar");case o.Conversations:return this.localizationService.get("GroupNavigationPaneContextMenuItem_Conversations");case o.Files:return this.localizationService.get("GroupNavigationPaneContextMenuItem_Files");case o.Members:return this.localizationService.get("GroupNavigationPaneContextMenuItem_Members");case o.Notebook:return this.localizationService.get("GroupNavigationPaneContextMenuItem_Notebook");case o.EditGroup:return this.localizationService.get("GroupNavigationPaneContextMenuItem_EditGroup");case o.ViewGroup:return this.localizationService.get("GroupNavigationPaneContextMenuItem_ViewGroup");case o.LeaveGroup:return this.localizationService.get("GroupNavigationPaneContextMenuItem_LeaveGroup");case o.UnpublishApp:return this.localizationService.get("GroupNavigationPaneContextMenuItem_UnpublishApp");case o.EditMyWorkspace:return this.localizationService.get("GroupNavigationPaneContextMenuItem_EditGroup");default:return""}},t.prototype.performActionWithGroupContextMenuItem=function(e,t){switch(e.linkType){case o.Calendar:case o.Conversations:case o.Files:case o.Members:case o.Notebook:this.services.$window.open(e.url,"_blank");break;case o.EditGroup:case o.ViewGroup:case o.LeaveGroup:case o.EditMyWorkspace:this.performActionWithNonUrlGroupLinkType(e.linkType,t)}},t.prototype.performActionWithNonUrlGroupLinkType=function(e,t){switch(e){case o.EditGroup:this.services.taskPaneSliderService.expandPane(3,i.Large,{group:t});break;case o.ViewGroup:this.services.taskPaneSliderService.expandPane(4,i.Large,{group:t});break;case o.LeaveGroup:this.leaveGroup(t);break;case o.EditMyWorkspace:this.services.taskPaneSliderService.expandPane(19,i.Large,{group:t})}},t.prototype.leaveGroup=function(e){var t=this,i=this.services.errorService,o=i.control(),r=[new InJs.ModalDialogAction(this.localizationService.get("ModalDialogButtonText_Leave"),function(i,r){o.hideDialog(),t.tryLeaveGroup(e)}),new InJs.ModalDialogAction(this.localizationService.get("PBI_Button_Label_Cancel"),function(e,t){o.hideDialog()})],a=this.localizationService.get("GroupEditor_LeaveGroupConfirmation_Title"),n=this.localizationService.get("GroupEditor_LeaveGroupConfirmation_Message");o.showCustomDialog(a,$("<div/>").text(n),r,(function(e){e.parent().find('input[value="'+t.localizationService.get("PBI_Button_Label_Cancel")+'"]').focus()}),!0)},t.prototype.tryLeaveGroup=function(t){var i=this,o=this.services.errorService.control(),r=this.services.promiseFactory.defer(),a=this.services.rootScope.$new(),n={dialogName:null,scope:a,template:'<spinner></spinner><span localize="GroupEditor_WaitLeaveGroup"></span>',containerCssClass:"leaveGroup",isDismissable:!1};this.services.modalDialogService.showLegacyWebModalDialog(n);var s=e.session.UserInfoUtils.getEmailAddressForReceivingMail();if(t.contract.isOwner){var c=this.services.telemetryService,l=c.startEvent(e.telemetry.GroupEditorGetGroupMembers);this.services.groupHttp.getGroupMembers(t.aadGroupId,l.event).then((function(e){if(i.isUserTheOnlyAdmin(s,e.data)){o.hideDialog();var a=[new InJs.ModalDialogAction(i.localizationService.get("ModalDialogButtonText_Ok"),function(e,t){o.hideDialog()})],n=i.localizationService.get("Groups_LeaveGroup_TheOnlyAdmin_Message");o.showCustomDialog("",$("<div/>").text(n),a,null,!0),l.resolve(),r.resolve(!1)}else l.resolve(),i.leaveGroupInternal(t,s).then((function(e){r.resolve(e)}))}),(function(t){o.hideDialog(),i.services.errorService.error(i.localizationService.get("GroupEditor_FailedGetGroupMembers_Message"),"FailedToGetGroupMembers",{requestId:t.requestId,statusCode:t.status.toString()}),l.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),r.resolve(!1)}))}else this.leaveGroupInternal(t,s).then((function(e){r.resolve(e)}));return r.promise},t.prototype.leaveGroupInternal=function(t,i){var o=this,r=this.services.promiseFactory.defer(),a=[],n=[{userPrincipalName:i,membershipStatus:e.common.contracts.GroupMembershipStatus.Member}],s={displayName:""},c=this.services.telemetryService,l=c.startEvent(e.telemetry.GroupEditorUserLeaveGroup,!1,t.contract.objectId,t.contract.isReadOnly,0,0),d=this.services.errorService.control();return this.services.groupHttp.updateGroup(t.aadGroupId,s,a,n,null,null,l.event).then((function(i){d.hideDialog(),o.services.groupService.removeGroup(t.aadGroupId),o.services.navigation.navigateToGroupByGUID(e.constants.myWorkSpaceGroupId),l.event.info.groupUpdated=!0;var a=_.filter(i.data,(function(t){return t.membershipStatus!==e.common.contracts.GroupMembershipStatus.Owner})).length;l.event.info.adminCount=a,l.event.info.memberCount=i.data.length-a,l.resolve(),r.resolve(!0)}),(function(t){d.hideDialog(),o.services.errorService.error(o.localizationService.get("GroupEditor_FailedUpdateGroup_Message"),"FailedToUpdateGroup",{requestId:t.requestId,statusCode:t.status.toString()}),l.event.info.groupUpdated=!1,l.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),r.resolve(!1)})),r.promise},t.prototype.isUserTheOnlyAdmin=function(t,i){var o=0===_.filter(i,(function(i){return(i.membershipStatus===e.common.contracts.GroupMembershipStatus.Owner||i.membershipStatus===e.common.contracts.GroupMembershipStatus.MemberAndOwner)&&i.userPrincipalName.toLowerCase()!==t.toLowerCase()})).length;return o},t})();e.GroupContextMenuService=r})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e){return new i(e)}e.createGroupService=t;var i=(function(){function t(e){this._isInGroupTransition=!1,this._isGroupTransitionDelayed=!1,this._groups=[],this.groupChangedHandlers=[],this.services=e,this.initializationDeferredOperation=this.services.promiseFactory.defer(),this.initGroupsService()}return t.prototype.resolveGroupSwitchTelemetry=function(){this.perfSwitchGroupEvent&&(this.perfSwitchGroupEvent.resolve(),this.perfSwitchGroupEvent=null)},Object.defineProperty(t.prototype,"isInGroupTransition",{get:function(){return this._isInGroupTransition},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGroupTransitionDelayed",{get:function(){return this._isGroupTransitionDelayed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this._groups},enumerable:!0,configurable:!0}),t.prototype.getGroup=function(e){return _.find(this._groups,(function(t){return t.aadGroupId===e}))},t.prototype.addGroup=function(t){var i=new e.models.Group(t);this._groups.push(i)},t.prototype.removeGroup=function(t){_.remove(this._groups,(function(e){return e.aadGroupId===t})),this.services.rootScope.$emit(e.constants.groupDeletedEventName)},t.prototype.isMyWorkspace=function(){return!this.services.activeGroupIdService.isInGroup},Object.defineProperty(t.prototype,"activeGroup",{get:function(){var e=this.getGroup(this.services.activeGroupIdService.activeGroupObjectId);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeGroupObjectId",{get:function(){return this.services.activeGroupIdService.activeGroupObjectId},set:function(e){this.services.activeGroupIdService.activeGroupObjectId=e,this.activeGroup?(this.services.activeGroupIdService.isReadOnly=this.activeGroup.contract.isReadOnly&&!this.activeGroup.contract.isOwner,this.services.telemetryService.setHostInfo("isInCapacity",!!this.activeGroup.capacity)):this.services.activeGroupIdService.isReadOnly=!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"datasets",{get:function(){return this.services.modelService.models},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reports",{get:function(){return this.services.reportService.reports},enumerable:!0,configurable:!0}),t.prototype.switchGroup=function(e,t,i,o){this.groupSwitchDeferred&&(this.groupSwitchDeferred.reject(),this.groupSwitchDeferred=null);var r=this.services.navigation,a=r.currentGroupGUID;r.currentGroupGUID=e.aadGroupId,this.switchGroupInternal(e,t,i,o);var n=this.groupSwitchPromise();return n.catch((function(){return r.currentGroupGUID=a})),n},t.prototype.isDataInCurrentGroup=function(){
return this.services.modelService.models.length>0||this.services.reportService.reports.length>0||this.services.workbookService.workbooks.length>0},t.prototype.showGroupUpsellMessage=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,o,r,a;return __generator(this,(function(n){switch(n.label){case 0:return i=this.services.localizationService.get("UpgradeReasonText_Groups"),o=this.services.localizationService.format("UpgradeDialogTitle",[i]),r=this.services.localizationService.format("UpgradeAccount_ProContentProviderMessage",[i.toLocaleLowerCase(),e.common.constants.FreeTrialPeriod]),[4,this.services.lazy("licenseHelper")];case 1:return a=n.sent(),a.displayFeatureDisabledErrorMessage(t,r,o),[2]}}))}))},t.prototype.ensureGroupsInitialization=function(){return this.initializationDeferredOperation.promise},t.prototype.groupSwitchPromise=function(){return this.groupSwitchDeferred?this.groupSwitchDeferred.promise:this.services.promiseFactory.resolve(null)},t.prototype.addGroupChangedHandler=function(e){this.groupChangedHandlers.push(e)},t.prototype.updateActiveGroup=function(e,t){this.activeGroupObjectId=e,this.services.activeGroupIdService.groupDisplayName=t},t.prototype.initGroupsService=function(){var t=this;this.services.appMetadataService.getAppMetadata().then((function(e){t.initGroupsServiceFromDashboardContainer(e)}),(function(){return t.updateGroups()})),this.services.rootScope.$on(e.common.constants.navigation.stateChangeSuccess,(function(e,i,o,r,a){return t.handleStateChange(i,o,r,a)})),this.services.rootScope.$on(e.common.constants.dashboardTileRepeatFinishedEvent,this.resolveGroupSwitchTelemetry.bind(this))},t.prototype.handleStateChange=function(t,i,o,r){var a=this;if(window.appLoadError&&!window.appLoadError.handled&&window.appLoadError.error===e.constants.appLoadErrorGroupNotAccessible&&i&&i.groupGUID===e.constants.myWorkSpaceGroupId)return i.dashboardGUID||this.showGroupNotAccessibleMessage(),window.appLoadError.handled=!0,void(this.activeGroupObjectId=e.constants.myWorkSpaceGroupId);if(this.activeGroupObjectId!==i.groupGUID){var n=this.activeGroupObjectId,s=e.constants.navigation.states.home;t.name===s&&this.services.home.isHomeDashboardSet?this.activeGroupObjectId=this.services.home.homeDashboard.groupId:this.services.navigation.inGroupView()&&this.services.navigation.currentGroupGUID&&(this.activeGroupObjectId=this.services.navigation.currentGroupGUID),this.shouldSwitchGroup(t,i,o,r,n)&&(this.groupSwitchDeferred&&this.groupSwitchDeferred.reject(),this.groupSwitchDeferred=this.services.promiseFactory.defer(),this.ensureGroupsInitialization().then((function(){var o=a.getGroup(t.name===s?a.services.home.homeDashboard.groupId:i.groupGUID);if(o){var r=!1;t.name===s&&(o.lastViewedDashboard=a.services.home.homeDashboard.dashboardId,r=!0),a.perfSwitchGroupEvent=a.services.telemetryService.startEvent(e.telemetry.GroupsSwitchGroup,i.groupGUID),a.switchGroupInternal(o,r,a.perfSwitchGroupEvent,!1)}else a.groupSwitchDeferred.resolve(null)})))}},t.prototype.shouldSwitchGroup=function(t,i,o,r,a){var n=r.groupGUID||this.isValidStateWithEmptyGroupGUID(o)&&a;if(!n)return!1;if(i.groupGUID&&i.groupGUID!==n)return!0;if(t.name===e.constants.navigation.states.home){if(!this.services.home.isHomeDashboardSet)return!1;if(n!==this.services.home.homeDashboard.groupId)return!0}return!1},t.prototype.isValidStateWithEmptyGroupGUID=function(t){var i=t.name;return i===e.constants.navigation.states.recentlyViewed||i===e.constants.navigation.states.workspaces||i===e.constants.navigation.states.home},t.prototype.switchGroupInternal=function(t,i,o,r){var a=this;this.startTimedTransition(),this.groupSwitchDeferred||(this.groupSwitchDeferred=this.services.promiseFactory.defer()),this.updateActiveGroup(t.aadGroupId,t.displayName),this.services.groupHttpService.getGroupDashboardContainer(t,o.event).then((function(o){if(t.aadGroupId===a.activeGroupObjectId){var n=o.data;if(n){a.services.packageService.updatePackageCollection(n.packages),a.services.reportService.updateReportCollection(n.reports),a.services.modelService.updateDatasetCollection(n.models),a.services.workbookService.updateWorkbookCollection(n.workbooks),t.isMyWorkspace&&a.services.appService.updateAppsCollection(n.apps,n.packages);for(var s=0,c=a.groupChangedHandlers;s<c.length;s++){var l=c[s];l.onGroupChanged()}}a.groupSwitchDeferred.resolve(null),a.groupSwitchDeferred=null,a.services.rootScope.$emit(e.constants.groupSwitchedEventName,n,i,!!r),a.endTimedTransition()}}),(function(e){var t=jsCommon.StringExtensions.format("Status:{0} requestId:{1} Details:{2}",e.status.toString(),e.requestId,e.error&&e.error.message?e.error.message:"");o.reject({errorCode:e.error&&e.error.code?e.error.code:"FailToGetGroupDashboardContainer",errorMessage:t}),a.groupSwitchDeferred.reject(),a.groupSwitchDeferred=null,a.showLoadGroupFailedMessage(e.requestId,e.status.toString()),a.endTimedTransition()}))},t.prototype.initGroupsServiceFromDashboardContainer=function(e){this.loadGroupsWithActiveDashboard(this.services.userInfo.userMetadata?this.services.userInfo.userMetadata.groups:null,e.activeDashboardId),this.updateGroups(),this.handleUrlQueryString()},t.prototype.handleUrlQueryString=function(){this.services.location.search().needproforgroups&&(this.showGroupUpsellMessage(e.telemetry.LicenseEnforcementOperation.LandingGroups),this.services.location.search("needproforgroups",null))},t.prototype.showLoadGroupFailedMessage=function(e,t){var i=this;this.services.localizationService.ensureLocalization((function(){i.services.errorService.error(i.services.localizationService.get("ErrorMessage_FailedLoadGroup"),"FailedLoadGroup",{requestId:e,statusCode:t})}))},t.prototype.showGroupNotAccessibleMessage=function(){var e=this.services.errorService.control(),t=[new InJs.ModalDialogAction(this.services.localizationService.get("DashboardContainer_Ok"),function(t,i){e.hideDialog()})],i=this.services.localizationService.get("GroupNotAccessibleDialogTitle"),o=this.services.localizationService.get("GroupNotAccessibleDialogMessage");e.showCustomDialog(i,InJs.DomFactory.div().text(o),t,void 0,!0)},t.prototype.updateGroups=function(){var t=this;return this.activeGroupObjectId=_.isEmpty(window.initialGroupGUID)?e.constants.myWorkSpaceGroupId:window.initialGroupGUID,this.services.userInfo.userMetadataPromise.then((function(e){var i;t.activeGroup&&(i=t.activeGroup.lastViewedDashboard),t.loadGroupsWithActiveDashboard(e.groups,i),t.services.activeGroupIdService.initialGroupIdReadyPromise.then((function(){t.services.activeGroupIdService.isReadOnly=t.activeGroup.contract.isReadOnly&&!t.activeGroup.contract.isOwner}))}))},t.prototype.loadGroupsWithActiveDashboard=function(e,t){var t=t;this.loadGroups(e),this.activeGroup&&(this.activeGroup.lastViewedDashboard=t),this.initializationDeferredOperation.resolve(null)},t.prototype.loadGroups=function(t){var i=this;if(this._groups=[],this.loadMyWorkspace(),t)for(var o=0,r=t.length;o<r;++o){var a=new e.models.Group(t[o]);!(function(e){i.services.userInfo.findGroupIcon(e.contract.objectId).then((function(t){e.icon=t}))})(a),this._groups.push(a)}},t.prototype.loadMyWorkspace=function(){var t=this.services.userInfo&&this.services.userInfo.userMetadata&&this.services.userInfo.userMetadata.capacityWorkspaceMetadata,i={id:-1,displayName:this.services.localizationService.get("NavigationPane_Groups_MyWorkspace"),objectId:this.services.activeGroupIdService.myWorkspaceGroupId,groupType:e.common.contracts.GroupType.Unknown,isOwner:!1,isPublic:!1,isReadOnly:!1,mailNickname:"",capacityObjectId:t&&t.capacityObjectId,capacityName:t&&t.capacityName,isMyWorkspace:!0},o=new e.models.Group(i);o.workspaceId=t&&t.workspaceObjectId,this._groups.push(o)},t.prototype.startTimedTransition=function(){var e=this;this._isInGroupTransition=!0,this._isGroupTransitionDelayed=!1,this._groupTransitionTimeoutPromise&&this.services.timeout.cancel(this._groupTransitionTimeoutPromise),this._groupTransitionTimeoutPromise=this.services.timeout((function(){e._isGroupTransitionDelayed=!0}),t.switchGroupTimeLimit)},t.prototype.endTimedTransition=function(){this._isInGroupTransition=!1,this._isGroupTransitionDelayed=!1,this.services.timeout.cancel(this._groupTransitionTimeoutPromise)},t.switchGroupTimeLimit=1e3,t})();e.Groups=i})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t){return new o(e,t)}var i=e.models.HistoryDialogModel;e.createHistoryDialogService=t;var o=(function(){function e(e,t){this.rootScope=e,this.compile=t,this.parameters=new i,this.serviceScope=this.rootScope.$new(),this.serviceScope.historyDialogParameters=this.parameters}return e.prototype.showHistoryDialog=function(t){var i=this.parameters;i.showHistoryDialog=!0,i.showSpinner=!0,i.datasetModel={},i.datasetModel.dataset=t.dataset,this.historyDialogElement||(this.template=angular.element(e.htmlTemplate),this.historyDialogElement=this.compile(this.template)(this.serviceScope)),$("body").append(this.historyDialogElement)},e.prototype.hideHistoryDialog=function(){var e=this.parameters;e.showHistoryDialog=!1,e.showSpinner=!1},Object.defineProperty(e.prototype,"historyDialogParameters",{get:function(){return this.parameters},enumerable:!0,configurable:!0}),e.htmlTemplate="<history-dialog view-model='historyDialogParameters' ng-if='historyDialogParameters.showHistoryDialog'> </history-dialog>",e})();e.HistoryDialogService=o})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,r,a,n){return new o(e,t,i,r,a,n)}t.createHome=i;var o=(function(){function t(e,t,i,o,r,a){this.rootScope=e,this.errorService=t,this.localizationService=i,this.notificationToast=o,this.telemetryService=r,this.promiseFactory=a,this.onHomeSettingChanged=[],this.resetHomeAtClientSide()}return Object.defineProperty(t.prototype,"isHomeDashboardSet",{get:function(){return this.homeDashboard.dashboardId!==-1},enumerable:!0,configurable:!0}),t.prototype.resetHomeAtClientSide=function(){this.homeDashboard={dashboardId:-1,groupId:"",dashboardObjectId:""};for(var e=0,t=this.onHomeSettingChanged.length;e<t;e++)this.onHomeSettingChanged[e]()},t.prototype.resetHome=function(e){var t=this,i=this.promiseFactory.defer();return this.disableHomeDashboardHelper(e).then((function(e){t.resetHomeAtClientSide(),i.resolve(e)}),(function(e){i.reject(e)})),i.promise},t.prototype.getHomeDashboard=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"GetHomeDashboard");return i.enableTelemetry=!0,e.common.httpService.get("/powerbi/metadata/user/homedashboard",i)},t.prototype.disableHomeDashboard=function(){var t=this,i=this.localizationService,o=this.errorService.control(),r=[new InJs.ModalDialogAction(i.get("Jumps_Dialog_Confirm"),function(r,a){o.hideDialog();var n=t.notificationToast.notify({message:i.get("DisablingFeaturedDashboard"),notificationType:e.common.NotificationToastType.Loading}),s=t.telemetryService.startEvent(e.telemetry.DashboardDisableHomeDashboard,t.homeDashboard.dashboardObjectId);t.resetHome(s.event).then((function(o){t.notificationToast.notify({title:i.get("SetFeaturedDashboardSuccessTitle"),message:i.get("DisableFeaturedDashboardSuccessContent"),notificationType:e.common.NotificationToastType.Success}),s.resolve()}),(function(e){t.errorService.error(i.get("SetFeaturedDashboardFailed"),"SetFeaturedDashboardFailed",{requestId:e.requestId,statusCode:e.status.toString()}),s.reject()})).finally((function(){t.notificationToast.hide(n)}))}),new InJs.ModalDialogAction(i.get("ExplorationNavigationTab_Cancel"),function(e,t){o.hideDialog()})];o.showPrompt(i.get("DisableFeaturedDashboardTitle"),i.get("DisableFeaturedDashboardContent"),r,!1)},t.prototype.isOnHomeDashboard=function(e){return this.homeDashboard.dashboardObjectId===e},t.prototype.setHomeDashboard=function(t,i,o,r){var a=this,n=this.localizationService,s=this.notificationToast.notify({message:n.get("SettingFeaturedDashboard"),notificationType:e.common.NotificationToastType.Loading}),c=this.telemetryService.startEvent(e.telemetry.DashboardSetHomeDashboard,i);this.setHomeDashboardHelper(t,c.event).then((function(s){a.notificationToast.notify({title:n.get("SetFeaturedDashboardSuccessTitle"),message:a.localizationService.format("SetFeaturedDashboardSuccessContent",[o]),notificationType:e.common.NotificationToastType.Success}),a.homeDashboard.dashboardId=t,a.homeDashboard.groupId=r,a.homeDashboard.dashboardObjectId=i;for(var l=0,d=a.onHomeSettingChanged.length;l<d;l++)a.onHomeSettingChanged[l]();c.resolve()}),(function(e){a.errorService.error(n.get("Dashboard_RefreshCompletedFailure"),"Dashboard_RefreshCompletedFailure",{requestId:e.requestId,statusCode:e.status.toString()}),c.reject()})).finally((function(){a.notificationToast.hide(s)}))},t.prototype.setHomeDashboardDialog=function(e,t){var i=this,o=this.errorService.control(),r=this.localizationService,a=[new InJs.ModalDialogAction(r.get("SetFeaturedDashboardButton"),function(r,a){o.hideDialog(),i.setHomeDashboard(e.id,e.objectId,e.displayName,t)}),new InJs.ModalDialogAction(r.get("ExplorationNavigationTab_Cancel"),function(e,t){o.hideDialog()})],n=e.displayName;if(this.homeDashboard.dashboardId===-1){var s=r.format("SetFeaturedDashboardContent",[n]);o.showPrompt(r.get("SetFeaturedDashboardTitle"),s,a,!1)}else{var s=r.format("ChangeFeaturedDashboardContent",[n]);o.showPrompt(r.get("ChangeFeaturedDashboardTitle"),s,a,!1)}},t.prototype.setHomeDashboardHelper=function(t,i){var o=e.common.httpService.powerbiRequestOptions(i,"SetHomeDashboard");return o.enableTelemetry=!0,e.common.httpService.post("/powerbi/metadata/user/homedashboard/"+t,null,o)},t.prototype.disableHomeDashboardHelper=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"DeleteHomeDashboard");return i.enableTelemetry=!0,e.common.httpService.delete("/powerbi/metadata/user/homedashboard",i)},t})();t.Home=o})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a,n){return new c(e,t,i,o,r,a,n)}var o,r=e.dataServices.ContractUtils,a=e.dataServices.models.Tile,n=e.dataServices.contracts.TileType,s=e.dataServices.models.WorkbookTileModel;!(function(e){e[e.Failure=0]="Failure",e[e.Success=1]="Success"})(o=t.InFocusable||(t.InFocusable={})),t.createInFocusService=i;var c=(function(){function t(e,t,i,o,r,a,n){this.rootScope=e,this.telemetryService=t,this.modelConverter=i,this.modelService=o,this.reportService=r,this.localizationService=a,this.visualPlugin=n,this.inFocusTile=null}return t.prototype.view=function(e,t,i){this.inFocusTile=e,e.type===n.workbook?this.openInFocusWorkbookTile(e,t):e.type===n.realTime?this.openInFocusRealTimeTile(e):this.openInFocusTile(e,t,i)},t.prototype.openInFocusTile=function(t,i,o){this.rootScope.$emit(e.constants.openInFocusTileActionName,{modelId:t.contract.modelId,openInsightArgs:i,runScopedInsights:o})},t.prototype.openInFocusWorkbookTile=function(i,o){var r=t.cloneWorkbookTileModelForInFocusUse(i.workbook,this.localizationService),a=r.tileModel.layoutPosition;a.width=Math.floor(i.gridLayoutContext.getGridWidth()/e.common.GridLayoutConstants.defaultGridWidth),a.height=Math.floor(i.gridLayoutContext.getGridHeight()/e.common.GridLayoutConstants.defaultGridHeight),this.rootScope.$emit(e.constants.openInFocusWorkbookTileActionName,{workbook:r})},t.prototype.openInFocusRealTimeTile=function(t){this.rootScope.$emit(e.constants.openInFocusRealTimeTileActionName,t)},t.prototype.exit=function(){this.inFocusTile=null,this.showVisualEnabled=!1},t.prototype.getInFocusState=function(t){if(!t)return o.Failure;switch(t.type){case n.composite:var i=t.composite&&t.composite.visual;if(i&&i.type!==e.visuals.plugins.image.name)try{var a=t.contract.query,s=r.convertToSemanticQueryWithDataShapeBinding(a);if(s&&s.defn&&s.defn.Version>=2&&_.isEmpty(s.defn.Transform))return o.Success}catch(e){}break;case n.workbook:case n.realTime:return o.Success}return o.Failure},t.cloneWorkbookTileModelForInFocusUse=function(e,t){var i=new s(null,null);return jQuery.extend(i,e),i.tileModel=new a(null,t),jQuery.extend(i.tileModel,e.tileModel),i.tileModel.layoutPosition=_.cloneDeep(e.tileModel.layoutPosition),i},t})();t.InFocusService=c})(t=e.services||(e.services={}))})(powerbi||(powerbi={})),define("powerBI/services/insightsBootstrap",["require","exports"],(function(e,t){function i(e,t,i,o,a,n,s){return new r(e,t,i,o,a,n,s)}Object.defineProperty(t,"__esModule",{value:!0});var o=powerbi.insights.constants;t.create=i;var r=(function(){function e(e,t,i,o,r,a,n){this.insightsService=e,this.modelService=t,this.navigationService=i,this.telemetryService=o,this.notificationToastService=r,this.localizationService=a,this.appService=n}return e.prototype.start=function(e,t,i,o){var r=this.modelService.findModelByDBName(e,i);if(r){var a=this.appService.getAppInstance(i),n=a&&a.providerContract.providerKey,s=this.insightsService.getInsightsStatus(r.contract),c=this.navigationService;switch(s){case 2:c.showInsightsPanel({groupGUID:c.currentGroupGUID,dataGUID:e,insightsSource:o,appGUID:n});break;case 0:this.getInsights(r,o,c.currentGroupGUID,n)}}},e.prototype.getInsights=function(e,t,i,r){return __awaiter(this,void 0,powerbi.Promise,(function(){var a,n,s,c,l,d,p,u;return __generator(this,(function(h){switch(h.label){case 0:return a=powerbi.telemetry.InsightEntryPoint.NavigationPane,t===powerbi.insights.constants.insightsSourceToast&&(a=powerbi.telemetry.InsightEntryPoint.Notification),n=this.telemetryService.startEvent(powerbi.telemetry.InsightsShowInsights,0,a,e.contract.contentProviderId,powerbi.getHashCode(e.contract.dbName),!1),s={model:e.contract,analysisDefinition:{explore:{requestedInsights:o.numberOfInsightsRequested,timeoutInMS:o.timeoutInMs,options:0}}},c=this.showInsightsLoadingNotification(e),[4,this.insightsService.getInsights(s,n.event)];case 1:return l=h.sent(),d=l.insightContainers,p=_.size(d),u=p>0,n.event.info.insightCount=p,l.isError&&!u?n.reject():n.resolve(),this.notificationToastService.hide(c),this.showInsightsLoadedNotification(e,u,i,r),[2]}}))}))},e.prototype.showInsightsLoadingNotification=function(e){return this.notificationToastService.notify({title:this.localizationService.get("Insights_LoadingTitle"),message:this.localizationService.format("Insights_LoadingSubtitle",[e.displayName]),notificationType:common.NotificationToastType.Loading,sticky:!0})},e.prototype.showInsightsLoadedNotification=function(e,t,i,o){var r=this,a=this.localizationService,n={displayText:a.get("Insights_FinishedLoadingButtonText"),action:function(){r.navigationService.showInsightsPanel({groupGUID:i,dataGUID:e.dbName,insightsSource:powerbi.insights.constants.insightsSourceToast,appGUID:o})}},s={displayText:a.get("LearnMore"),action:function(){window.open(powerbi.insights.constants.zeroInsightsLink,"_blank")}};t?this.notificationToastService.notify({title:a.get("Insights_FinishedLoadingTitle"),message:a.format("Insights_FinishedLoadingSubtitle",[e.displayName]),notificationType:common.NotificationToastType.Success,actionButtons:[n],sticky:!0}):this.notificationToastService.notify({title:a.get("Insights_FinishedLoadingNoInsightsTitle"),message:a.format("Insights_FinishedLoadingNoInsightsSubtitle",[e.displayName]),notificationType:common.NotificationToastType.NoIcon,actionButtons:[s]})},e})()}));var powerbi;!(function(e){function t(e,t,i,o,a,n){return new r(e,t,i,o,a,n)}var i=e.common.constants;e.createLicenseEnforcementSevice=t;var o=7,r=(function(){function t(e,t,i,o,r,a){var n=this;this.analyzeInExcelService=e,this.licenseStrategyFactory=t,this.userInfoService=i,this.lazy=o,this.checkUnsavedService=r,this.userNotificationInfoService=a,e.onBeforeAnalyzeInExcel=function(){return n.supportsAnalyzeInExcel(!0)}}return t.prototype.accept2017ProTrial=function(){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this.lazy("licenseHelper")];case 1:return e=t.sent(),[4,e.accept2017proTrial()];case 2:return t.sent(),[2]}}))}))},t.prototype.acceptProTrial=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.lazy("licenseHelper")];case 1:return e=i.sent(),e.acceptProTrial(t),[2]}}))}))},t.prototype.supportsDashboard=function(e,t,i){return this.licenseCheckStrategy.checkForDashboard(e,t,i)},t.prototype.dashboardHasProFeatures=function(e){return this.licenseCheckStrategy.dashboardHasProFeatures(e)},t.prototype.supportsReport=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.licenseCheckStrategy.checkForReport(t,!!i)]}))}))},t.prototype.supportsDataset=function(e,t){return this.licenseCheckStrategy.checkForDataset(e,!!t)},t.prototype.supportsGroups=function(e){return this.licenseCheckStrategy.checkForGroups(!!e)},t.prototype.supportsUsageMetrics=function(){return this.licenseCheckStrategy.checkForUsageMetrics()},t.prototype.supportsReportEmailSubscription=function(e){return this.licenseCheckStrategy.checkForReportEmailSubscription(!!e)},t.prototype.supportsDashboardEmailSubscription=function(e){return this.licenseCheckStrategy.checkForDashboardEmailSubscription(!!e)},t.prototype.supportsProModels=function(){return this.licenseCheckStrategy.checkForProModels()},t.prototype.supportsScriptVisuals=function(){return this.licenseCheckStrategy.checkForScriptVisuals()},t.prototype.supportsAppsAuthoring=function(e){return this.licenseCheckStrategy.checkForEditApps(!!e)},t.prototype.supportsConnectApps=function(e,t,i){return this.licenseCheckStrategy.checkForConnectApps(e,t,!!i)},t.prototype.supportsPremiumContentProviders=function(){return this.licenseCheckStrategy.checkForPremiumContentProviders()},t.prototype.supportsSharing=function(e){return this.licenseCheckStrategy.checkForSharing(!!e)},t.prototype.supportsExportToPowerPoint=function(e){return this.licenseCheckStrategy.checkForExportToPowerPoint(!!e)},t.prototype.supportsAnalyzeInExcel=function(e){return this.licenseCheckStrategy.checkForAnalyzeInExcel(!!e)},t.prototype.supportsExportData=function(e){return this.licenseCheckStrategy.checkForExportData(!!e)},Object.defineProperty(t.prototype,"licenseCheckStrategy",{get:function(){return this.strategy||(this.strategy=this.licenseStrategyFactory.create()),this.strategy},enumerable:!0,configurable:!0}),t.prototype.createNotificationForTrial=function(){var t=this.userInfoService.userFreeTrialDaysRemaining;!this.userInfoService.userHasPremiumPlan&&(this.userInfoService.userHasFreeTrial||this.userInfoService.userFreeTrialExpired)&&t<=o&&this.userNotificationInfoService&&this.userNotificationInfoService.addClientNotification({id:0,notificationCategory:e.userNotifications.contracts.NotificationCategory.Trial,message:{title:{displayTextResource:this.getTrialNoticeDisplayTitle(t),values:t>1?[{NotificationValueType:1,value:t.toString()}]:null},message:{displayTextResource:this.getTrialNoticeDisplayDescription(t),values:t>1?[{NotificationValueType:1,value:t.toString()}]:null},image:{imageType:6}},action:{resource:{displayTextResource:this.getTrialNoticeDisplayActionText(),values:[{NotificationValueType:1,value:i.FreeTrialPeriod.toString()}]},actionType:1},seen:!1})},t.prototype.showUpgradeDialog=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.lazy("licenseHelper")];case 1:return e=i.sent(),e.displayDialogToUpgrade(t),[2]}}))}))},t.prototype.showTrialDialog=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return[4,this.lazy("licenseHelper")];case 1:return e=i.sent(),e.displayDialogToAcceptTrialTerms(t),[2]}}))}))},t.prototype.getTrialNoticeDisplayDescription=function(t){return this.userInfoService.userFreeTrialExpired?e.userNotifications.contracts.NotificationResource.ExtendTrial_TrialExpired:0===t?e.userNotifications.contracts.NotificationResource.UsersNotifications_TrialRunsOutInLessThanADay:1===t?e.userNotifications.contracts.NotificationResource.UsersNotifications_TrialRunsOutInOneDay:e.userNotifications.contracts.NotificationResource.UsersNotifications_TrialRunningOut},t.prototype.getTrialNoticeDisplayTitle=function(t){return this.userInfoService.userFreeTrialExpired?e.userNotifications.contracts.NotificationResource.UsersNotifications_TitleTrialExpired:0===t?e.userNotifications.contracts.NotificationResource.UsersNotifications_TitleTrialRunsOutInLessThanADay:1===t?e.userNotifications.contracts.NotificationResource.UsersNotifications_TitleTrialRunsOutInOneDay:e.userNotifications.contracts.NotificationResource.UsersNotifications_TitleTrialRunningOut},t.prototype.getTrialNoticeDisplayActionText=function(){return e.userNotifications.contracts.NotificationResource.UsersNotifications_Upgrade},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){var t=e.common.constants,i=e.telemetry.LicenseEnforcementOperation,o=(function(){function e(e,t,i,o,r,a,n){this.userInfoService=e,this.reportService=t,this.modelService=i,this.lazy=o,this.localizationService=r,this.appService=a,this.activeGroupIdService=n}return e.prototype.create=function(){return new a(this.userInfoService,this.reportService,this.modelService,this.lazy,this.localizationService,this.appService,this.activeGroupIdService)},e})();e.LicenseCheckStrategyFactory=o;var r=(function(){function e(e,t,i){this.userInfoService=e,this.lazy=t,this.localizationService=i,this.initializeProFeatures()}return e.prototype.checkForGroups=function(e){return this.checkForFeature(i.SwitchGroups,e)},e.prototype.checkForUsageMetrics=function(){return this.checkForFeature(i.UsageMetrics)},e.prototype.checkForReportEmailSubscription=function(e){return this.checkForFeature(i.ReportEmailSubscription,e)},e.prototype.checkForDashboardEmailSubscription=function(e){return this.checkForFeature(i.DashboardEmailSubscription,e)},e.prototype.checkForScriptVisuals=function(){return this.checkForFeature(i.ScriptVisual)},e.prototype.checkForEditApps=function(e){return this.checkForFeature(i.AuthorApps,e)},e.prototype.checkForProModels=function(){return this.checkForFeature(i.ProModels)},e.prototype.checkForPremiumContentProviders=function(){return this.checkForFeature(i.PremiumContentProviders)},e.prototype.checkForSharing=function(e){return this.checkForFeature(i.Sharing,e)},e.prototype.checkForExportToPowerPoint=function(e){return this.checkForFeature(i.ExportToPowerPoint,e)},e.prototype.checkForAnalyzeInExcel=function(e){return this.checkForFeature(i.AnalyzeInExcel,e)},e.prototype.checkForExportData=function(e){return this.checkForFeature(i.ExportData,e)},e.prototype.checkForFeature=function(e,t){var i=this;if(this.userInfoService.isPremiumUser)return!0;var o=!_.contains(this.proFeatures,e);if(!o&&t){var r=this.localizationService;this.lazy("licenseHelper").then((function(t){t.displayFeatureDisabledErrorMessage(e,i.defaultDisabledFeatureMessage,r.get("UpgradeAccount_Title"))}))}return o},Object.defineProperty(e.prototype,"defaultDisabledFeatureMessage",{get:function(){var e=this.localizationService;return this.userInfoService.userFreeTrialExpired?e.get("UpgradeAccount_DisabledFeatureMessageTrialExpired"):e.format("UpgradeAccount_DisabledFeatureMessage",[t.FreeTrialPeriod.toString()])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultDisabledContentMessage",{get:function(){var e=this.localizationService;return this.userInfoService.userFreeTrialExpired?e.get("UpgradeAccount_DisabledContentMessageTrialExpired"):e.format("UpgradeAccount_DisabledContentAccessMessage",[t.FreeTrialPeriod.toString()])},enumerable:!0,configurable:!0}),e})(),a=(function(t){function o(e,i,o,r,a,n,s){var c=t.call(this,e,r,a)||this;return c.userInfoService=e,c.reportService=i,c.modelService=o,c.lazy=r,c.localizationService=a,c.appService=n,c.activeGroupIdService=s,c}return __extends(o,t),o.prototype.initializeProFeatures=function(){this.proFeatures=[i.SwitchGroups,i.UsageMetrics,i.AuthorApps,i.ReportEmailSubscription,i.DashboardEmailSubscription,i.Sharing,i.AnalyzeInExcel]},o.prototype.checkForDashboard=function(t,i,o){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,this.checkEntityAccess(t,o)]}))}))},o.prototype.dashboardHasProFeatures=function(t){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){return[2,!1]}))}))},o.prototype.checkForReport=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,o;return __generator(this,(function(r){return e=this.reportService.findReportByGUID(t),o=e&&e.contract,[2,this.checkEntityAccess(o,i)]}))}))},o.prototype.checkForDataset=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var e,o,r;return __generator(this,(function(a){switch(a.label){case 0:return[4,this.modelService.findModelsByDBName(t)];case 1:return e=a.sent(),o=_.first(e),r=o&&o.contract,[2,this.checkEntityAccess(r,!!i)]}}))}))},o.prototype.checkForConnectApps=function(t,i,o){if(this.userInfoService.isPremiumUser)return!0;if(i){var r=this.appService.isAppCategory(t.category);return!!r||(o&&this.showUpsellDialog(e.telemetry.LicenseEnforcementOperation.ConnectApps,this.defaultDisabledContentMessage),!1)}var a=1===t.sharedFromEnterpriseCapacitySkuTier;return!a&&o&&this.showUpsellDialog(e.telemetry.LicenseEnforcementOperation.ConnectApps,this.defaultDisabledContentMessage),a},o.prototype.checkEntityAccess=function(t,i){if(!t)return!0;if(this.userInfoService.isPremiumUser)return!0;var o=t.packageId|t.originalPackageId;if(this.inPremiumCapacity(o))return!0;var r=this.activeGroupIdService&&!this.activeGroupIdService.isInGroup&&!this.hasFeature(t.featuresV2,38);return!r&&i&&this.showUpsellDialog(e.telemetry.LicenseEnforcementOperation.ReportMessage,this.defaultDisabledContentMessage),r},o.prototype.inPremiumCapacity=function(e){if(null==e)return!1;var t=this.appService.getAppInstance(e);return!!t&&1===t.providerContract.sharedFromEnterpriseCapacitySkuTier},o.prototype.hasFeature=function(e,t){if(!e)return!1;var i=Math.floor(t/32),o=t%32;return e.length<=i,!!(e[i]&1<<o)},o.prototype.showUpsellDialog=function(t,i,o){return __awaiter(this,void 0,e.Promise,(function(){var e,r;return __generator(this,(function(a){switch(a.label){case 0:return[4,this.lazy("licenseHelper")];case 1:return e=a.sent(),r=this.localizationService,_.isEmpty(i)&&(i=this.defaultDisabledFeatureMessage),_.isEmpty(o)&&(o=r.get("UpgradeAccount_Title")),e.displayFeatureDisabledErrorMessage(t,i,o),[2]}}))}))},o})(r)})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a,n,s,c,l){return new d(e,t,i,o,r,a,n,s,c,l)}function o(e){return{getMRUModels:function(){return e.resolve([])},removeMRU:function(e){},updateMRU:function(e,t,i,o,r,a,n){},findDashboardMRU:function(e){},findAppInstanceMRU:function(e){}}}var r=e.common.contracts.ContentTileType,a=e.models.MRUArtifactType,n=e.models.MRUModel;t.createMostRecentlyUsedService=i,t.createMostRecentlyUsedServicePlaceholder=o;var s="MRU",c=5e3,l=100,d=(function(){function t(e,i,o,r,a,n,c,l,d,p){var u=this;this.groupService=e,this.promiseFactory=i,this.navigation=o,this.telemetryService=r,this.timeoutService=a,this.userSettingsService=n,this.dashboardDataService=l,this.reportService=d,this.appService=p,this.mostRecentlyUsedModels=[];var h=this.promiseFactory.defer();this.mostRecentlyUsedLoadedPromise=h.promise,this.groupService.ensureGroupsInitialization().then((function(){u.userSettingsService.getExtendedSettingByKey(s).then((function(e){u.mostRecentlyUsedModels=e?e.map(t.convertToMRUModel):[],h.resolve(null)}))}))}return t.prototype.getMRUModels=function(){var e=this;return this.mostRecentlyUsedLoadedPromise.then((function(){return e.removeRecordsWithInaccessibleGroups(),e.fixMRUEntriesForContentPack(),e.mostRecentlyUsedModels}))},t.prototype.findDashboardMRU=function(e){return _.find(this.mostRecentlyUsedModels,(function(t){return t.objectId===e&&t.type===a.Dashboards}))},t.prototype.findAppInstanceMRU=function(e){return _.find(this.mostRecentlyUsedModels,(function(t){return t.packageid===e&&t.type===a.AppInstance;
}))},t.prototype.removeMRU=function(e,t){var i=this,o=t?t:this.navigation.currentGroupGUID;this.mostRecentlyUsedLoadedPromise.then((function(t){_.remove(i.mostRecentlyUsedModels,(function(t){return t.objectId===e&&t.workspaceId===o})),i.updateUserSettings()}))},t.prototype.updateMRU=function(e,t,i,o,r,s,c){var d=this;if(r||(r=this.navigation.currentGroupGUID),c){var p=this.appService.getAppInstance(c);p&&(e=a.AppInstance,t=p.objectId,i=p.displayName,s=void 0)}this.mostRecentlyUsedLoadedPromise.then((function(a){var p=_.findIndex(d.mostRecentlyUsedModels,(function(e){return e.objectId===t&&e.workspaceId===r})),u=p>=0?d.mostRecentlyUsedModels.splice(p,1)[0]:new n(e,t,r,c);u.count++,u.displayName=i,u.lastAccess=new Date,u.originalGUID=s,o&&(u.permissions=o),d.mostRecentlyUsedModels.unshift(u),d.mostRecentlyUsedModels.splice(l),d.updateUserSettings()}))},t.prototype.removeRecordsWithInaccessibleGroups=function(){var e=this,t=_.remove(this.mostRecentlyUsedModels,(function(t){return!e.groupService.getGroup(t.workspaceId)}));_.isEmpty(t)||this.updateUserSettings()},t.prototype.updateUserSettings=function(){var i=this;this.updateMRUPromise||(this.updateMRUPromise=this.timeoutService((function(){i.updateMRUPromise=null;var o=i.telemetryService.startEvent(e.telemetry.MostRecentlyUsedServiceUpdateMRUData),r=i.mostRecentlyUsedModels.map(t.convertToMRUContract);i.userSettingsService.updateExtendedSettings(s,r,o)}),c))},t.prototype.fixMRUEntriesForContentPack=function(){for(var t=function(t){if(null!=t.originalGUID&&null!==t.packageid)if(e.helpers.ContentTileHelper.getMRUActualType(t)===r.Dashboard){var o=i.dashboardDataService.findDashboardsByPackageId(t.packageid);if(!_.isEmpty(o)){var a=_.find(o,(function(e){return e.contract.originalDashboardObjectId===t.originalGUID}));a&&(t.objectId=a.objectId)}}else if(e.helpers.ContentTileHelper.getMRUActualType(t)===r.Report){var n=i.reportService.findReportsByPackageId(t.packageid);if(!_.isEmpty(n)){var s=_.find(n,(function(e){return e.contract.originalReportObjectId===t.originalGUID})),c=s&&s.objectId;null!=c&&(t.objectId=c)}}},i=this,o=0,a=this.mostRecentlyUsedModels;o<a.length;o++){var n=a[o];t(n)}},t.convertToMRUContract=function(e){var t={co:e.count,dn:e.displayName,la:e.lastAccess.toISOString(),oid:e.objectId,ty:e.type};return angular.isDefined(e.workspaceId)&&(t.gid=e.workspaceId),angular.isDefined(e.permissions)&&(t.pm=e.permissions),angular.isDefined(e.originalGUID)&&(t.originalid=e.originalGUID),angular.isDefined(e.packageid)&&(t.packageid=e.packageid),t},t.convertToMRUModel=function(e){var t=new n(e.ty,e.oid,e.gid,e.packageid);return t.count=e.co,t.displayName=e.dn,t.lastAccess=new Date(e.la),angular.isDefined(e.gid)&&(t.workspaceId=e.gid),angular.isDefined(e.pm)&&(t.permissions=e.pm),angular.isDefined(e.originalid)&&(t.originalGUID=e.originalid),t},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,r){return new o(e,t,i,r)}t.createNavigationStateValidator=i;var o=(function(){function t(t,i,o,r){this.$timeout=t,this.impersonationService=i,this.permissionService=o,this.reportService=r,this.allowedReadOnlyStates=[e.constants.navigation.states.apps,e.constants.navigation.states.landing,e.constants.navigation.states.adminPortal,e.constants.navigation.states.adminPortalCapacities,e.constants.navigation.states.groups,e.constants.navigation.states.group,e.constants.navigation.states.dashboards,e.constants.navigation.states.dashboard,e.constants.navigation.states.dashboardReport,e.constants.navigation.states.dashboardReportPage,e.constants.navigation.states.dashboardReports,e.constants.navigation.states.dashboardWorkbook,e.constants.navigation.states.dashboardWorkbooks,e.constants.navigation.states.inFocusMode,e.constants.navigation.states.insights,e.constants.navigation.states.dashboardQna,e.constants.navigation.states.modelQna,e.constants.navigation.states.settings,e.constants.navigation.states.settingsGroup,e.constants.navigation.states.sharedDashboard,e.constants.navigation.states.sharedDashboardReport,e.constants.navigation.states.sharedDashboardReportPage,e.constants.navigation.states.sharedDashboardReports,e.constants.navigation.states.sharedDashboardWorkbook,e.constants.navigation.states.sharedDashboardWorkbooks,e.constants.navigation.states.home,e.constants.navigation.states.favorites,e.constants.navigation.states.recentlyViewed,e.constants.navigation.states.sharedWithMe,e.constants.navigation.states.contentList,e.constants.navigation.states.manageEmbed,e.constants.navigation.states.workspaces,e.common.constants.navigation.states.report,e.common.constants.navigation.states.reportPage,e.common.constants.navigation.states.reports,e.common.constants.navigation.states.workbook,e.common.constants.navigation.states.workbooks]}return t.prototype.setDefaultStateCallback=function(e){this.navigateToDefaultState=e},t.prototype.validateState=function(e){this.handleStateAccessibility(e)},t.prototype.validateStateChange=function(e,t,i,o,r){this.impersonationService.impersonating&&this.handleImpersonationStateChanging(t,i.reportGUID),this.handleStateAccessibility(t,e,o)},t.prototype.handleImpersonationStateChanging=function(t,i){if(t===e.common.constants.navigation.states.reportPage){var o=this.impersonationService.getImpersonationState().modelId,r=this.reportService.findReportByGUID(i);r&&r.modelId===o||this.impersonationService.clearImpersonation()}else t&&this.impersonationService.clearImpersonation()},t.prototype.handleStateAccessibility=function(e,t,i){var o=this;this.permissionService.isActiveWorkspaceIsReadOnly&&!_.contains(this.allowedReadOnlyStates,e)&&(i&&_.contains(this.allowedReadOnlyStates,i)&&t?t.preventDefault():this.$timeout((function(){o.navigateToDefaultState()})))},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e){return new l(e)}var i=e.dataServices.models.Dashboard,o=e.common.models.Model,r=jsCommon.EnumExtensions,a=e.models.MRUModel,n=e.common.contracts.Permissions,s=e.common.models.Report,c=e.dataServices.models.Workbook;e.createOwnershipService=t;var l=(function(){function e(e){this.packageService=e}return e.prototype.isResourceShareableWithMe=function(e){return e instanceof i||e instanceof s||e instanceof c||e instanceof o||e instanceof a},e.prototype.isResourceSharedWithMe=function(e){switch(!0){case e instanceof i:return e.getPermissions()===n.Read||e.getPermissions()===n.ReadReshare;case e instanceof s:return!1;case e instanceof c:return!e.isOwner()&&!r.hasFlag(e.getPermissions(),n.CopyOnWrite);case e instanceof o:var t=this.packageService.findPackage(e.packageId);return this.permissionsArePersonalized(e.getPermissions(),t);case e instanceof a:return e.permissions===n.Read||e.permissions===n.ReadReshare;default:return!1}},e.prototype.permissionsArePersonalized=function(e,t){var i=n.ReadWrite|n.Explore,o=n.Read,r=null==t?void 0:t.getPermissions();return void 0===r?(e&n.All)!==n.All&&(e&i)===i:(e&n.All)!==n.All&&(e&o)===o&&(r&n.ReadWrite)===n.ReadWrite},e})();e.OwnershipService=l})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i){return new r(e,t,i)}var i=["moz","ms","webkit"];e.createPageVisibilityService=t;var o="isAppInactive",r=(function(){function e(e,t,i){this.config=e,this.telemetryService=t,this.$document=i;var o=this.getBrowserVisibilityAttributes();o&&(this.browserHiddenAttribute=o.hiddenAttributeName,this.browserVisibilityChangeAttribute=o.visibilityChangeEventName,this.$document.on(this.browserVisibilityChangeAttribute,this.visibilityStateListener.bind(this)),this.services=[])}return e.prototype.register=function(e){var t=this.services;_.contains(t,e)||t.push(e)},e.prototype.unregister=function(e){var t=this.services;_.pull(t,e)},e.prototype.onBrowserTabActive=function(){for(var e=0,t=this.services;e<t.length;e++){var i=t[e];i.resume()}this.telemetryService.setHostInfo(o,!1)},e.prototype.onBrowserHidden=function(){for(var e=0,t=this.services;e<t.length;e++){var i=t[e];i.pause()}this.config.logPageInactiveToTelemetry&&this.telemetryService.setHostInfo(o,!0)},e.prototype.visibilityStateListener=function(){this.$document.prop(this.browserHiddenAttribute)?this.onBrowserHidden():this.onBrowserTabActive()},e.prototype.getBrowserVisibilityAttributes=function(){var e=this.$document,t="hidden",o="visibilitychange";if(void 0!==e.prop(t))return{hiddenAttributeName:t,visibilityChangeEventName:o};for(var r=_.capitalize(t),a=0,n=i;a<n.length;a++){var s=n[a],c=s+r;if(e.prop(c))return{hiddenAttributeName:c,visibilityChangeEventName:s+o}}return null},e})()})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,a,n,s,l,d,p,u,h,v,g,m,f,b,y,S,w){return new c(e,t,i,o,r,a,n,s,l,d,p,u,h,v,g,m,f,b,y,S,w)}var i=e.dataServices.ContractUtils,o=e.data.services.DataViewTransformActionsSerializer,r=e.explore.contracts.PinData,a=e.explore.util.ScriptVisualsUtil,n=e.common.constants.tileActions,s=e.dataServices.models.TileFactory;e.createPinTileService=t;var c=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g,m,f,b,y,S){this.telemetryService=i,this.localizationService=o,this.errorService=t,this.rootScope=e,this.modalDialogService=r,this.modelConverter=a,this.visualPlugin=n,this.themeService=s,this.visualStylePresetService=c,this.userSettingsService=l,this.reportService=d,this.modelService=p,this.workbookService=u,this.dashboardService=h,this.packageService=v,this.explorationSerializer=g,this.promiseFactory=m,this.moduleLoader=f,this.featureSwitchService=b,this.modalDialog=this.errorService.control(),this.usageMetricsReport=y,this.interval=S}return t.prototype.setSavedReportId=function(e){this.savedReportId=e},t.prototype.showPinVisualDialog=function(e,i,o,a,c,l){var d,p=l,u=void 0===i?[]:[i],h=void 0===o?[]:[o],v=void 0===a?[]:[a];this.pinEvent=c;var g=void 0!==l,m=!1,f=e&&(e.action.action===n.openInsightsActionName||e.action.originalAction===n.openInsightsActionName),b=e&&e.action&&!e.action.action&&!e.reportId;if(g||(m=e.action.action===n.openQnAActionName||e.action.originalAction===n.openQnAActionName),this.isPinFromDashboard=!1,this.isLiveReport=!1,this.pinTileScope=this.createPinTileScope(void 0===i&&!m),g)this.pinTileScope.viewModel.hasTileFormatting=!1,this.formattedTileContract=l;else{p=s.createTileForPinData(this.visualPlugin,e,o);var y=e&&r.getVisualType(e);y&&e.themeName&&e.themeName!==t.defaultTheme&&this.isTileFormattingRequired(y)?e.themeName=void 0:this.pinTileScope.viewModel.hasTileFormatting=!1,d=s.createTileForPinData(this.visualPlugin,e,o),this.formattedTileContract=d}this.dashboardTile=this.modelConverter.convertTile(this.formattedTileContract,h,u,v),this.reportTile=this.modelConverter.convertTile(p,[o],u),this.reportTile.composite&&(this.themeName=this.reportTile.composite.config.themeName),this.setTheme(this.dashboardTile,!1),this.setTheme(this.reportTile,!0),this.pinTileScope.viewModel.needSaveReport=!(i||m||f||a||b),this.createModelDialogWithOptions(this.pinTileScope)},t.prototype.showPinVisualFromDashboardDialog=function(i,o){if(this.pinEvent=o,this.isPinFromDashboard=!0,i.reportTile){var r=i.reportTile.exploration,a=i.contract.sectionId,n=e.explore.SectionUtils.findSectionById(r.contract,a);if(!n)return;var s=void 0,c=void 0;if(i.config&&i.config.reportTile){var l=i.config.reportTile;s=l.pod;var d=[];c=l.filters&&this.explorationSerializer.deserializeFilterCollection(l.filters,d,!1)}var p={exploration:r,section:n,reportId:i.contract.reportId,modelId:i.contract.modelId,packageId:i.contract.packageId,isPinFromDashboard:this.isPinFromDashboard,displayText:i.displayText,subDisplayText:i.subDisplayText,action:i.action,filters:c,pod:s,utterance:i.utterance};return this.showPinReportPageDialog(p)}this.isLiveReport=!1;var u=!1;this.pinTileScope=this.createPinTileScope(!1);var h=void 0===i.contractsReport?[]:[i.contractsReport];this.formattedTileContract=i.contract,i.composite&&i.composite.config&&(u=void 0!==i.composite.config.themeName&&i.composite.config.themeName!==t.defaultTheme),this.pinTileScope.viewModel.hasTileFormatting=u;var v=this.createCustomTileForPinData(i,!0),g=void 0;if(i.config&&i.config.workbookTile&&i.workbook&&i.workbook.contract){var m=this.workbookService.findWorkbook(i.workbook.contract.workbookId,i.workbook.contract.packageId);g=m?[m.contract]:void 0}this.dashboardTile=this.modelConverter.convertTile(v,[i.contractsModel],h,g);var f=this.createCustomTileForPinData(i,!1);this.reportTile=this.modelConverter.convertTile(f,[i.contractsModel],h),this.themeName=this.reportTile.composite?this.reportTile.composite.config.themeName:void 0,this.setTheme(this.dashboardTile,!1),this.setTheme(this.reportTile,!0),this.createModelDialogWithOptions(this.pinTileScope)},t.prototype.showPinReportPageDialog=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o,r,a,c,l,d,p,u,h,v;return __generator(this,(function(g){switch(g.label){case 0:return this.exploration=t.exploration,this.pinEvent=this.createPinEvent(t.isPinFromDashboard),this.isPinFromDashboard=!!t.isPinFromDashboard,this.isLiveReport=!0,this.pinTileScope=this.createPinTileScope(!1),this.pinTileScope.viewModel.needSaveReport=!1,this.pinTileScope.viewModel.hasTileFormatting=!1,i=this.reportService.findReport(t.reportId),o=i?i.modelId:void 0,r=this.modelService.findModel(o),a=r?[r]:[],c=t.section.size,l=c?c.width:void 0,d=c?c.height:void 0,u=i&&this.featureSwitchService.featureSwitches.usageMetricsEnabled&&this.usageMetricsReport.reportBelongsToUsageMetricsContentPack(i.contract)&&!_.isEmpty(t.additionalODataFilter),u&&(p=t.additionalODataFilter),h=t.action||{action:n.openReportActionName,targetSlideId:t.section.name,filter:p},i?[4,this.generateReportFilters(t,u)]:(this.pinTileScope.viewModel.needSaveReport=!0,this.createModelDialogWithOptions(this.pinTileScope,!0),[2]);case 1:return v=g.sent(),e=s.createReportTileForExploreData(t.reportId,o,t.section.id,t.displayText?t.displayText:i.displayName,t.subDisplayText?t.subDisplayText:t.section.displayName,h,t.pod,v,t.utterance,l,d),this.dashboardTile=this.modelConverter.convertTile(e,a,[i]),this.reportTile=this.modelConverter.convertTile(e,a,[i]),this.themeName=this.getTheme(t.exploration.exploreCanvas),this.setTheme(this.dashboardTile,!1),this.setTheme(this.reportTile,!0),this.createModelDialogWithOptions(this.pinTileScope,!0),[2]}}))}))},t.prototype.generateReportFilters=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var o,r,a;return __generator(this,(function(n){switch(n.label){case 0:return o=t.filters||[],i?[4,this.loadODataFilterDependencies()]:[3,2];case 1:n.sent(),e.explore.odata&&(r=e.explore.odata.createODataFilterParser(),a=r.tryGetFilters(t.additionalODataFilter),o.push.apply(o,a)),n.label=2;case 2:return[2,o?this.explorationSerializer.serializeFilterCollection(o):void 0]}}))}))},t.prototype.loadODataFilterDependencies=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.promiseFactory.all([this.moduleLoader.require({javascript:"odataFilterParser"}),this.moduleLoader.require({javascript:"odataExplore"})])];case 1:return e.sent(),[2]}}))}))},t.prototype.isScriptVisualInLivePage=function(e){if(e&&e.exploreCanvas&&e.exploreCanvas.visualContainers){var t=e.exploreCanvas.contract.visualContainers;return a.visualContainerHasScriptVisuals(t,this.visualPlugin)}return!1},t.prototype.getTheme=function(e){var i;if(e){var o=e.visualContainers,r=o?o.length:0;r>0&&(i=o[0].themeName)}return i&&i!==t.defaultTheme?i:void 0},t.prototype.createModelDialogWithOptions=function(e,t){var i=t?"liveReport":"pinTile",o={dialogName:null,isDismissable:!0,scope:e,template:"<pin-tile-dialog></pin-tile-dialog>",focusOnFirstButton:!0,dialogCssClass:i};0===this.pinTileScenario&&(o.notificationText=this.localizationService.get("PinTile_Workbook_Changed"),o.notificationType=jsCommon.ModalDialogNotificationType.Info),this.modalDialogService.showLegacyWebModalDialog(o)},t.prototype.createPinEvent=function(t){return this.telemetryService.startEvent(e.telemetry.DashboardPinTile,"reportPage",t?e.telemetry.PinTileSource.Dashboard:e.telemetry.PinTileSource.Report,"",!1,"",!1,"",this.isScriptVisualInLivePage(this.exploration))},t.prototype.createCustomTileForPinData=function(e,a){var n={visualContainer:void 0,dataViewSource:void 0},c=e.contract,l=c&&c.$config;if(l){n.dataViewSource=c.tileDataSet,n.reportId=c.reportId,n.modelId=c.modelId,n.action=e.action,n.utterance=c.query&&c.query.modelQuery?e.contract.query.modelQuery.utterance:void 0,n.tileSubDisplay=e.getSubDisplayText(),n.tileHeading=e.getDisplayText(),n.themeName=!a&&e.composite&&e.composite.config?e.composite.config.themeName:t.defaultTheme,n.baseThemeName=e.composite&&e.composite.config&&e.composite.config.baseThemeName,n.resourcePackageIds=c.resourcePackageIds;var d=l.visualContainer||l.realTimeVisual;if(d){n.queryMetadata=d.queryMetadata,n.elements=d.elements,n.tileLayoutType=d.layoutType,n.visualContainer=this.explorationSerializer.deserializeVisualContainer(this.explorationSerializer.serializeVisualContainer(d.$visualContainer));var p=this.visualPlugin.capabilities(r.getVisualType(n));if(p&&p.objects&&d.transform){var u=p.objects,h=JSON.parse(d.transform);n.dataTransforms=o.deserializeDataViewTransformActions(h,u)}}l.realTimeVisual&&(n.realTimeDataWindow=l.realTimeVisual.dataWindow);var v=c.query&&c.query.modelQuery&&c.query.modelQuery.sq,g=v?i.convertToTileDataQuery(c.query):void 0,m=l&&l.tileDataType;g&&(n.query=g),m&&(n.tileDataType=l.tileDataType),c.name&&(n.name=c.name)}var f=n.visualContainer?s.createTileForPinData(this.visualPlugin,n,e.model):s.createNonVisualTileFromExisting(c);return l.widget&&(f.$config.widget=l.widget),this.modelConverter.resolveTilePackage(f,this.packageService.packages),f},t.prototype.updateTile=function(e){this.formattedTileContract=e?this.dashboardTile.contract:this.reportTile.contract},t.prototype.hideDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},t.prototype.onPinButtonClickedActions=function(){var t=this.pinTileScope.viewModel.useDashboardFormatting?e.contracts.TileDialogPreviewFormats.DashboardFormat:e.contracts.TileDialogPreviewFormats.ReportFormat;if(this.userSettingsService.updatePinDialogPreviewTileFormat(t,this.pinEvent),this.savedReportId&&(this.formattedTileContract.reportId=this.savedReportId,this.savedReportId=null),this.modalDialog.hideDialog(),this.pinTileScope.viewModel.useExistingDashboard)this.dashboardService.pinTileWithoutNotification({tile:this.formattedTileContract,dashboardId:parseInt(this.pinTileScope.viewModel.selectedDashboardId,10),parentEvent:this.pinEvent,showNotification:!0,isLiveReport:this.isLiveReport});else{var i={tile:this.formattedTileContract,newDashboardName:this.pinTileScope.viewModel.newDashboardName,parentEvent:this.pinEvent,showNotification:!0,isLiveReport:this.isLiveReport};this.dashboardService.addDashboard(i.newDashboardName,i)}},t.prototype.onSaveAndContinueButtonClickedActions=function(){var t=this;this.rootScope.$emit(e.constants.saveReportFromPinDialog,this.pinTileScope.viewModel.newReportName);var i=this.interval((function(){t.savedReportId&&(t.pinTileScope.viewModel.needSaveReport=!1,t.interval.cancel(i))}),100)},t.prototype.showNotSupportedDialog=function(){var e=this.errorService.control(),t=this.localizationService.get("PinTile_NotSupportedTitle"),i=this.localizationService.get("PinTile_NotSupportedMessage"),o=[new InJs.ModalDialogAction(this.localizationService.get("PinTile_OK"),function(t,i){e.hideDialog()})];e.showCustomDialog(t,$("<div/>").text(i),o,null,!0)},t.prototype.mapCanvasSize=function(t,i){if(t){var o=e.explore.SectionUtils.findSectionIndexForSectionId(t,i);if(t.sections&&t.sections[o]&&void 0!==t.sections[o].size.displayOption){var r=t.sections[o].size;r.displayOption=1}}return t},t.prototype.setTheme=function(i,o){i&&(i.calculateLayout(e.common.GridLayoutConstants.getDefaultGridItemViewport(e.common.GridLayoutConstants.getSmallLandscapeGridItem())),i.applyLayout(),o?(i.composite?(i.composite.config.themeName=this.themeName,i.composite.visual.themeName=this.themeName):i.reportTile&&(i.reportTile.themeName=this.themeName),this.pinTileScope&&this.pinTileScope.viewModel&&(this.pinTileScope.viewModel.reportTile=i)):(i.composite&&(i.composite.config.themeName=t.defaultTheme,i.composite.visual.themeName=t.defaultTheme),this.pinTileScope&&this.pinTileScope.viewModel&&(this.pinTileScope.viewModel.dashboardTile=i,this.pinTileScope.viewModel.workbookTile=i)))},t.prototype.isTileFormattingRequired=function(t){return t!==e.visuals.plugins.textbox.name&&t!==e.visuals.plugins.image.name},t.prototype.createPinTileScope=function(t){var i=this.rootScope.$new();return i.viewModel=new e.models.PinTileDialogModel(null),i.viewModel.needSaveReport=t,i},t.defaultTheme="ThemeNew1",t})();e.PinTileService=c})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e){return new r(e)}var i=e.common.constants,o=jsCommon.BrowserUtils;e.createPrintService=t;var r=(function(){function e(e){var t=this;if(this.rootScope=e,o.isFirefox()||o.isInternetExplorerOrEdge())window.onbeforeprint=function(){return t.enterPrintHandler()},window.onafterprint=function(){return t.exitPrintHandler()};else if(window.matchMedia){var i=window.matchMedia("print");i.addListener((function(e){t.mediaQueryListener(e)}))}}return e.prototype.mediaQueryListener=function(e){e.matches?this.enterPrintHandler():this.exitPrintHandler()},e.prototype.enterPrintHandler=function(){this.rootScope.$emit(i.enterPrintModeEvent)},e.prototype.exitPrintHandler=function(){this.rootScope.$emit(i.exitPrintModeEvent)},e})();e.PrintService=r})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,a,n,c,l,d){return new s(e,t,i,o,r,a,n,c,l,d)}var i=e.helpers.RedirectUrlHelper;e.createQRCodeService=t;var o=".qrLoading",r="#fff",a="#333",n="#ccc",s=(function(){function t(e,t,i,o,r,a,n,s,c,l){this.rootScope=e,this.compile=t,this.promiseFactory=i,this.localizationService=o,this.dashboardHttpService=r,this.reportHttpService=a,this.errorService=n,this.modalDialogService=s,this.telemetryService=c,this.moduleLoader=l,this.modalDialog=this.errorService.control(),this.stopQrGeneration=!1}return t.prototype.getQRCodeCanvas=function(e){var t={ecLevel:"M",background:r,text:e,size:180};return this.getPbiQRCodeCanvasWithOptions(t)},t.prototype.showDialogForTile=function(t,i,o,r,a){var n=this;this.showProgressDialog(),this.composeOpenTileRedirectUrl(a,r,o.id,o.objectId,o.originalDashboardObjectId,i.contract.id,i.contract.objectId,i.contract.originalTileObjectId).then((function(t){n.qrCodeScope=n.createQRCodeScope(),n.qrCodeScope.viewModel.displayText=i.getDisplayText(),n.qrCodeScope.viewModel.subDisplayText=i.getSubDisplayText(),n.qrCodeScope.viewModel.url=t,n.qrCodeScope.viewModel.dialogMessage=n.localizationService.get("InFocus_QRCodeDialog_Message"),n.qrCodeScope.viewModel.notificationMessage=n.localizationService.get("InFocus_QRCodeDialog_Notification"),n.telemetryService.logEvent(e.telemetry.QRCodeQRCodeDialogShown,r,o.objectId,i.objectId,a,o.originalDashboardObjectId,i.contract.originalTileObjectId),n.createModelDialogWithOptions(n.qrCodeScope)}))},t.prototype.showDialogForReport=function(t,i,o,r,a,n){var s=this;this.showProgressDialog(),this.composeOpenReportRedirectUrl(r,n,i.id,i.objectId,i.originalReportObjectId,a).then((function(t){s.qrCodeScope=s.createQRCodeScope(),s.qrCodeScope.viewModel.displayText=o,s.qrCodeScope.viewModel.url=t,s.qrCodeScope.viewModel.dialogMessage=s.localizationService.get("Report_QRCodeDialog_Message"),s.qrCodeScope.viewModel.notificationMessage=s.localizationService.get("Report_QRCodeDialog_Notification"),s.telemetryService.logEvent(e.telemetry.QRCodeQRCodeReportDialogShown,r,i.objectId,n,i.originalReportObjectId),s.createModelDialogWithOptions(s.qrCodeScope)}))},t.prototype.showProgressDialog=function(){var e=this.rootScope.$new(),t=this.compile("<qr-code-progress-dialog></qr-code-progress-dialog>")(e);$("body").append(t)},t.prototype.hideQRCodeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},t.prototype.hideQRProgressDialog=function(){this.stopQrGeneration=!0,this.closeQRProgressDialog()},t.prototype.closeQRProgressDialog=function(){$("body").find(o).remove()},t.prototype.createModelDialogWithOptions=function(e){var t={dialogName:null,isDismissable:!0,scope:e,template:"<qr-code-dialog></qr-code-dialog>",focusOnFirstButton:!0,dialogCssClass:"qrCode"};this.stopQrGeneration?this.stopQrGeneration=!1:(this.closeQRProgressDialog(),this.modalDialogService.showLegacyWebModalDialog(t))},t.prototype.createQRCodeScope=function(){var t=this.rootScope.$new();return t.viewModel=new e.models.QrCodeDialogModel,t},t.prototype.composeOpenTileRedirectUrl=function(t,o,r,a,n,s,c,l){var d=this,p=this.promiseFactory.defer();return this.dashboardHttpService.getTileShortUrl(r,s,void 0).then((function(i){d.telemetryService.logEvent(e.telemetry.QRCodeShortUrlCreated,t,a,c,o,n,l),p.resolve(i.data)}),(function(r){var s,u="QR";s=_.isEmpty(o)?i.MobileRedirectUrlHelper.getTileRedirectUrl(t,null,a,c,u):i.MobileRedirectUrlHelper.getTileRedirectUrl(null,o,n,l,u),d.telemetryService.logEvent(e.telemetry.QRCodeShortUrlFailed,t,a,c,r.status.toString(),o,n,l),p.resolve(s)})),p.promise},t.prototype.composeOpenReportRedirectUrl=function(t,o,r,a,n,s){var c=this,l=this.promiseFactory.defer();return this.reportHttpService.getReportShortUrl(r,s,void 0).then((function(i){c.telemetryService.logEvent(e.telemetry.QRCodeReportShortUrlCreated,t,a,o,n),l.resolve(i.data)}),(function(e){var r,c="QR";r=_.isEmpty(o)?i.MobileRedirectUrlHelper.getReportRedirectUrl(t,null,a,s,c):i.MobileRedirectUrlHelper.getReportRedirectUrl(null,o,n,s,c),l.resolve(r)})),l.promise},t.prototype.getQRCodeCanvasWithOptions=function(e){var t=$("<canvas />"),i=t.get(0);return i.width=i.height=e.size,t.qrcode(e),i},t.prototype.getPbiQRCodeCanvasWithOptions=function(e){var t=this;return this.moduleLoader.require({javascript:"jquery-qrcode"}).then((function(){var i=$("<canvas />").get(0);i.width=190;var o=192;i.height=o+13+11+1;var s=i.getContext("2d");s.fillStyle=r,s.fillRect(0,0,i.width,i.height),s.drawImage(t.getQRCodeCanvasWithOptions(e),5,5);var c="Power BI";s.font="13px wf_segoe-ui_semibold",s.fillStyle=a,s.textBaseline="hanging";var l=(i.width-s.measureText(c).width)/2;return s.fillText(c,l,o),s.rect(0,0,i.width,i.height),s.strokeStyle=n,s.lineWidth=2,s.stroke(),i}))},t})();e.QRCodeService=s})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,a){return new r(e,t,i,o,a)}var o=e.common.contracts.RealTimeMode;t.createRealTimeDataService=i;var r=(function(){function e(e,t,i,o,r){this.modelService=t,this.realTimeLongPollDataService=i,this.realTimeLongPubNubDataService=o,this.tabularDataCache=r,this.listenerMap={},i.setCallbacks(this.processMessage.bind(this),this.raiseErrors.bind(this)),o.setCallbacks(this.processMessage.bind(this),this.raiseErrors.bind(this))}return e.prototype.subscribe=function(e,t){if(e&&t){var i=this.tabularDataCache,o=null!=e.originalModelId?e.originalModelId:e.id,r=i.getKey(o,e.tableName),a=this.listenerMap[r]||[];if(!_.contains(a,t)){a.push(t),this.listenerMap[r]=a;var n=i.get(r);if(n)return void t.onDataChanged();i.add({modelId:o,name:e.tableName,rowGroups:null,columns:this.getColumnMetadata(e.schema)});var s=this.resolveDataService(e);s&&s.subscribe(e)}}},e.prototype.unsubscribe=function(e,t){if(e&&t){var i=this.tabularDataCache,o=null!=e.originalModelId?e.originalModelId:e.id,r=i.getKey(o,e.tableName),a=this.listenerMap[r];if(a&&(_.pull(a,t),_.isEmpty(a))){delete this.listenerMap[r],i.remove(r);var n=this.resolveDataService(e);n&&n.unsubscribe(e)}}},e.prototype.pause=function(){this.realTimeLongPollDataService.pause(),this.realTimeLongPubNubDataService.pause()},e.prototype.resume=function(){this.realTimeLongPollDataService.resume(),this.realTimeLongPubNubDataService.resume()},e.prototype.replaceListener=function(e,t,i){var o=null!=e.originalModelId?e.originalModelId:e.id,r=this.tabularDataCache.getKey(o,e.tableName),a=this.listenerMap[r]||[];this.listenerMap[r]=a;var n=_.remove(a,(function(e){return e===t}));_.isEmpty(n)||a.push(i)},e.prototype.processMessage=function(e){if(e){var t=this.tabularDataCache,i=t.getKey(e.modelId,e.name);if(_.isEmpty(e.rowGroups)){if(e.lastVersion){var o=this.tabularDataCache.get(i);o&&(o.lastVersion=e.lastVersion)}}else{t.mergeRows(e.modelId,e.name,e.rowGroups,e.lastVersion);var r=this.listenerMap[i];if(r)for(var a=0,n=r;a<n.length;a++){var s=n[a];s.onDataChanged()}}}},e.prototype.raiseErrors=function(e,t){for(var i=[],o=0,r=e;o<r.length;o++){var a=r[o],n=this.tabularDataCache.getKey(a.id,a.tableName);i.push(n)}i=_.uniq(i);for(var s=0,c=i;s<c.length;s++){var n=c[s],l=this.listenerMap[n];if(!l)return;for(var d=0,p=l;d<p.length;d++){var u=p[d];u.onError(t)}}},e.prototype.getColumnMetadata=function(e){if(e){var t=e.entities;if(!_.isEmpty(t)){var i=_.first(t);if(!_.isEmpty(i.properties)){for(var o=[],r=0,a=i.properties;r<a.length;r++){var n=a[r];o.push({name:n.name,type:n.type})}return o}}}},e.prototype.resolveDataService=function(e){var t=this.modelService.findModel(e.id,e.packageId);if(t)switch(t.realTimeMode){case o.CacheOnly:case o.PersistAndCache:return this.realTimeLongPollDataService;case o.PubNubCacheOnly:return this.realTimeLongPubNubDataService}},e})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a){return new u(e,t,i,o,r,a)}var o=jsCommon.JsonExtensions,r=e.data.tabular.MaxRealTimeDataWindowInMs,a=e.data.MessageExceedLimitClientError,n=e.data.RealTimeGetHistoryClientError,s=e.data.RealTimeLongPollError,c=20,l=12e4;t.createRealTimeLongPollDataService=i;var d,p="realTimeErrorCode";!(function(e){e[e.None=0]="None",e[e.MaximumDataExceeded=1]="MaximumDataExceeded"})(d||(d={}));var u=(function(t){function i(e,i,o,r,a,n){var s=t.call(this,e,a)||this;return s.tabularDataService=i,s.telemetryService=r,s.realTimeDataHttpService=o,s.activeRealTimeModelIds=[],s.options=n,s}return __extends(i,t),i.prototype.setCallbacks=function(e,t){this.updateCallback=e,this.errorCallback=t},i.prototype.subscribe=function(e){e&&(_.contains(this.activeRealTimeModelIds,e)||(this.activeRealTimeModelIds.push(e),this.delayedGetHistory()))},i.prototype.unsubscribe=function(e){e&&(_.remove(this.activeRealTimeModelIds,e),this.delayedGetUpdate())},i.prototype.resume=function(){this.paused=!1,this.delayedGetHistory()},i.prototype.getRequest=function(){for(var e=[],t=this.tabularDataService,i=0,o=this.activeRealTimeModelIds;i<o.length;i++){var r=o[i],a=null!=r.originalModelId?r.originalModelId:r.id,n=t.getKey(a,r.tableName),s=t.get(n);e.push({id:s.modelId,packageId:r.packageId,tableName:s.name,version:s.lastVersion?s.lastVersion:0})}if(!_.isEmpty(e))return{models:e}},i.prototype.getEndpointUrl=function(){return"powerbi/refresh/rtsubscribe"},i.prototype.processResponse=function(e){e&&this.processUpdates(e.results)},i.prototype.processError=function(){this.telemetryService.logEvent(e.telemetry.RealTimeLongPollError),this.errorCallback(this.activeRealTimeModelIds,(new s).getDetails(e.common.localize))},Object.defineProperty(i.prototype,"longPollDurationInMs",{get:function(){return l},enumerable:!0,configurable:!0}),i.prototype.delayedGetHistory=function(){var e=this,t=this.timeout;t.cancel(this.getHistoryHandle),this.getHistoryHandle=this.timeout((function(){return e.getHistory()}),c)},i.prototype.delayedGetUpdate=function(){var e=this,t=this.timeout;t.cancel(this.getUpdateHandle),this.getUpdateHandle=t((function(){e.getUpdate()}),c)},i.prototype.getUpdate=function(){this.options.enableDataRefresh&&(this.cancelCurrentRequest(),_.isEmpty(this.activeRealTimeModelIds)||this.startMonitoring())},i.prototype.getHistory=function(){for(var t=this,i=[],o=0,a=this.activeRealTimeModelIds;o<a.length;o++){var s=a[o],c=null!=s.originalModelId?s.originalModelId:s.id;i.push({modelId:c,tableName:s.tableName,fromMilliseconds:r})}_.isEmpty(i)||this.realTimeDataHttpService.getHistory(i).then((function(e){
e&&t.processUpdates(e.data),t.getUpdate()}),(function(){var i=(new n).getDetails(e.common.localize);t.errorCallback(t.activeRealTimeModelIds,i)}))},i.prototype.processUpdates=function(t){if(!_.isEmpty(t))for(var o=0,r=t;o<r.length;o++){var a=r[o];if(a){var n=i.convertToDataRowGroup(a.rows);if(!_.isEmpty(n)){var s=i.checkForError(n);s&&this.errorCallback([a],s.getDetails(e.common.localize)),n=i.filterOutErrorRow(n);var c={modelId:a.id,name:a.tableName,rowGroups:n,lastVersion:a.version};this.updateCallback(c)}}}},i.checkForError=function(e){var t=_.last(e);if(t){var o=_.first(t.rows);if(o){var r=o[p];return r?i.getErrorForCode(r):void 0}}},i.filterOutErrorRow=function(e){for(var t=[],i=0,o=e;i<o.length;i++){var r=o[i];_.remove(r.rows,(function(e){return null!=e[p]})),_.isEmpty(r.rows)||t.push(r)}return t},i.getErrorForCode=function(e){switch(e){case jsCommon.EnumExtensions.toString(d,d.MaximumDataExceeded):return new a}},i.convertToDataRowGroup=function(e){var t=[];if(_.isEmpty(e))return t;for(var i=0,r=e;i<r.length;i++){var a=r[i],n=a&&a.data,s=o.tryParseJSON(n);_.isEmpty(s)||t.push({version:a.version,rows:s})}return t},i})(e.common.LongPollServiceBase)})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a,s,c){return new n(e,t,i,o,r,a,s,c)}var o=e.errorDetailsHelper,r=e.dataServices.models.RealTimeModel,a=e.dataServices.models.RealTimeModelUtility;t.createRealTimeModelService=i;var n=(function(){function t(e,t,i,o,r,a,n,s){this.conceptualSchemaProxy=e,this.errorService=t,this.localizationService=i,this.modelService=o,this.promiseFactory=r,this.realTimeDataHttpService=a,this.telemetryService=n,this.selectedModelId=null}return t.prototype.setSelected=function(e){this.selectedModelId=e,this.selectedModel=null},t.prototype.getSelected=function(){var e=this;if(this.selectedModel)return this.promiseFactory.resolve(this.selectedModel);var t=this.getModel(this.selectedModelId);return t.then((function(t){e.selectedModel=t})),t},t.prototype.createModel=function(t){var i=this,a=this.promiseFactory.defer(),n=this.getColumnStatistic(t.columns),s=this.telemetryService.startEvent(e.telemetry.RealTimeAddUpdateRemoveStreamingDataset,e.telemetry.CreateUpdateDeleteAction.Create,n.dateTimeColumnCount,n.numericColumnCount,n.stringColumnCount,t.mode);return this.realTimeDataHttpService.createDataset(t).then((function(e){var o=new r(e.data,t);o.isNew=!0,i.selectedModel=o,s.resolve(),a.resolve(o)}),(function(e){i.errorService.error(i.localizationService.get("StreamingDataset_FailedToCreateDataset"),"StreamingDataset_FailedToCreateDataset",{requestId:e.requestId,statusCode:e.status.toString()}),s.reject(o.getTelemetryErrorDetails(e.error,e.status)),a.reject()})),a.promise},t.prototype.getModel=function(t){var i=this,n=this.promiseFactory.defer();if(!t||t<0)return n.resolve(null),n.promise;var s=_.first(this.modelService.findModels(t)),c=this.telemetryService.startEvent(e.telemetry.RealTimeGetStreamingDataset);return this.realTimeDataHttpService.getDataset(t).then((function(e){var o=a.getRealTimeDataSource(t),l=e.data;c.resolve(),i.conceptualSchemaProxy.get(o).then((function(e){var t=new r(l,r.createRealTimeDatasetDefinition(s.displayName,s.realTimeMode,e));n.resolve(t)}),(function(){n.reject(null)}))}),(function(e){i.errorService.error(i.localizationService.get("StreamingDataset_FailedToLoadDataset"),"StreamingDataset_FailedToLoadDataset",{requestId:e.requestId,statusCode:e.status.toString()}),c.reject(o.getTelemetryErrorDetails(e.error,e.status)),n.reject(null)})),n.promise},t.prototype.getAndSelectEmptyModel=function(){var t=e.models.modelFactory.createDefaultRealTimeModel();return this.selectedModel=t,t},t.prototype.updateModel=function(t,i){var r=this,n=this.promiseFactory.defer(),s=this.getColumnStatistic(t.columns),c=this.telemetryService.startEvent(e.telemetry.RealTimeAddUpdateRemoveStreamingDataset,e.telemetry.CreateUpdateDeleteAction.Update,s.dateTimeColumnCount,s.numericColumnCount,s.stringColumnCount,t.mode),l=a.getRealTimeDataSource(i||this.selectedModelId);return this.conceptualSchemaProxy.clearCache(null,l),this.realTimeDataHttpService.updateDataset(i||this.selectedModelId,t).then((function(){c.resolve(),n.resolve({})}),(function(e){r.errorService.error(r.localizationService.get("StreamingDataset_FailedToUpdateDataset"),"StreamingDataset_FailedToUpdateDataset",{requestId:e.requestId,statusCode:e.status.toString()}),c.reject(o.getTelemetryErrorDetails(e.error,e.status)),n.reject(null)})),n.promise},t.prototype.deleteModel=function(t){var i=this.modelService.findModel(t);this.telemetryService.logEvent(e.telemetry.RealTimeAddUpdateRemoveStreamingDataset,e.telemetry.CreateUpdateDeleteAction.Delete,null,null,null,i.realTimeMode),this.modelService.deleteModel(t),this.selectedModelId===t&&(this.selectedModelId=null,this.selectedModel=null)},t.prototype.getColumnStatistic=function(e){for(var t={dateTimeColumnCount:0,numericColumnCount:0,stringColumnCount:0},i=0,o=e;i<o.length;i++){var r=o[i];2===r.dataType?t.dateTimeColumnCount++:1===r.dataType?t.numericColumnCount++:0===r.dataType&&t.stringColumnCount++}return t},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a){return new c(e,t,i,o,r,a)}var o=e.errorDetailsHelper,r=e.dataServices.models.RealTimeModelUtility,a=e.data.RealTimePubNubGetCredentialsClientError;t.createRealTimePubNubDataService=i;var n=200,s=5e3,c=(function(){function t(e,t,i,o,r,a){this.promiseFactory=e,this.realTimeDataHttpService=t,this.tabularDataService=i,this.telemetryService=o,this.moduleLoader=r,this.timeout=a,this.modelCredentialMap={},this.pubNubConnectionMap={}}return t.prototype.getPubNub=function(){return this.moduleLoader.require({javascript:"pubnub"})},t.prototype.setCallbacks=function(e,t){this.updateCallback=e,this.errorCallback=t},t.prototype.pause=function(){this.toggleSubscribe(1)},t.prototype.resume=function(){this.toggleSubscribe(0)},t.prototype.toggleSubscribe=function(e){var t=this;_.forOwn(this.modelCredentialMap,(function(i,o){var r=t.getConnectionKey(i),a=t.pubNubConnectionMap[r],n=a&&a.instance;if(n)for(var s=Object.keys(a.channelListeners),c=0,l=s;c<l.length;c++){var d=l[c];0===e?n.subscribe({channels:d,message:function(e,o,r,a){t.processMessage(i,e,o[1])}}):n.unsubscribe({channel:d})}}))},t.prototype.subscribe=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o,r,a,s,c,l=this;return __generator(this,(function(d){switch(d.label){case 0:return t?[4,this.getCredentials(t)]:[2];case 1:return e=d.sent(),[4,this.getPubNub()];case 2:return i=d.sent(),o=this.getConnectionKey(e),r=this.pubNubConnectionMap[o],r||(a={message:function(t){l.processMessage(e,t.message,t.timetoken)}},r={instance:new i({subscribeKey:e.subscriptionKey,authKey:e.authKey,ssl:!0,noleave:!0,windowing:n}),channelListeners:{},listener:a},r.instance.addListener(a),this.pubNubConnectionMap[o]=r),s=e.channelName,c=r.channelListeners[s],_.isEmpty(c)&&(r.instance.subscribe({channels:[s]}),c=r.channelListeners[s]=[]),c.push(t),[2]}}))}))},t.prototype.unsubscribe=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o,r,a,n;return __generator(this,(function(s){switch(s.label){case 0:return t?[4,this.getCredentials(t)]:[2];case 1:return e=s.sent(),[4,this.getPubNub()];case 2:return s.sent(),i=e.channelName,o=this.getConnectionKey(e),r=this.pubNubConnectionMap[o],a=r&&r.channelListeners[i],a&&(_.remove(a,t),_.isEmpty(a)&&(delete r.channelListeners[i],n=r.instance,n.removeListener(r.listener),n.unsubscribe({channel:[i]}),_.isEmpty(Object.keys(r.channelListeners))&&delete this.pubNubConnectionMap[o])),[2]}}))}))},t.prototype.detectPubNubColumnsDefinition=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o,a,n,c,l;return __generator(this,(function(d){switch(d.label){case 0:return e=t.channelName,i=this.promiseFactory.defer(),o=this.timeout,[4,this.getPubNub()];case 1:return a=d.sent(),n=new a({subscribeKey:t.subscriptionKey,authKey:t.authKey,ssl:!0,noleave:!0}),c={message:function(t){o.cancel(l),n.removeListener(c),n.unsubscribe({channel:[e]});var a=t.message;return a?void i.resolve(r.convertToColumnsDefinition(a)):void i.reject()}},n.addListener(c),l=o((function(){i.reject(),n.removeListener(c),n.unsubscribe({channel:[e]})}),s),n.subscribe({channels:[e]}),[2,i.promise]}}))}))},t.prototype.getCredentials=function(t){var i=this,r=this.promiseFactory.defer(),n=null!=t.originalModelId?t.originalModelId:t.id,s=this.tabularDataService.getKey(n,t.tableName),c=this.modelCredentialMap[s];if(c)r.resolve(c);else{var l=this.telemetryService.startEvent(e.telemetry.RealTimeGetPubNubCredentials);this.realTimeDataHttpService.getCredentials(t.id).then((function(e){var t=e.data;i.modelCredentialMap[s]=t,l.resolve(),r.resolve(t)}),(function(n){l.reject(o.getTelemetryErrorDetails(n.error,n.status)),i.errorCallback([t],(new a).getDetails(e.common.localize)),r.reject()}))}return r.promise},t.prototype.getConnectionKey=function(e){return e.subscriptionKey+(e.authKey||"")},t.prototype.processMessage=function(e,i,o){if(i&&o)for(var r=this.getConnectionKey(e),a=this.pubNubConnectionMap[r],n=a.channelListeners[e.channelName],s=t.convertTimeTokenToVersion(o),c=0,l=n;c<l.length;c++){var d=l[c],p=null!=d.originalModelId?d.originalModelId:d.id,u={modelId:p,name:d.tableName,rowGroups:t.convertToDataRowGroup(s,i),lastVersion:s};this.updateCallback(u)}},t.convertToDataRowGroup=function(e,t){return t?[{version:e,rows:[t]}]:[]},t.convertTimeTokenToVersion=function(e){var t=1e4;return Math.floor(e/t)},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r){return new s(e,t,i,o,r)}var o=jsCommon.Utility;t.createServerLatencyService=i,t.DefaultPauseTimeBetweenRequestsInMs=6e4;var r=2e3,a=-1,n="pingLatency",s=(function(){function i(e,t,i,o,r){this.clusterUriRetriever=e,this.$http=t,this.telemetryService=i,this.promiseFactory=o,this.$interval=r,this.requestPromise=null}return i.prototype.getServerLatencyInMs=function(){var t=this,i=performance.now(),o=this.promiseFactory.defer();return this.$http.get(this.pingUrl,{timeout:r}).then((function(r){r.status!==e.HttpStatusCode.OK&&(o.reject(),e.contract.fail("Ping request failed."));var a=performance.now(),s=a-i;t.telemetryService.setHostInfo(n,s),o.resolve(s)}),(function(){t.telemetryService.setHostInfo(n,a),o.resolve(a)})),o.promise},i.prototype.startMonitoring=function(){var e=this;this.stopMonitoring(),this.getServerLatencyInMs(),this.requestPromise=this.$interval((function(){e.getServerLatencyInMs()}),t.DefaultPauseTimeBetweenRequestsInMs)},i.prototype.stopMonitoring=function(){this.requestPromise&&(this.$interval.cancel(this.requestPromise),this.requestPromise=null)},Object.defineProperty(i.prototype,"pingUrl",{get:function(){return this.pingUrlString||(this.pingUrlString=o.urlCombine(this.clusterUriRetriever.backendUri,"/powerbi/metadata/ping")),this.pingUrlString},enumerable:!0,configurable:!0}),i})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,o){return new i(e,t,o)}e.createSettingsMetadataService=t;var i=(function(){function t(e,t,i){this._promiseFactory=e,this._settingsHttpService=t,this._telemetryService=i}return t.prototype.getSettingsType=function(){return this._settingsType},t.prototype.getArtifactObjectId=function(){return this._artifactObjectId},t.prototype.getArtifactId=function(){return this._artifactId},t.prototype.setSettings=function(e,t,i){this._settingsType=e,this._artifactObjectId=t,this._artifactId=i},t.prototype.getSettings=function(){var t=this._promiseFactory.defer(),i=this._telemetryService.startEvent(e.telemetry.SettingsLoadSettingsData);return this._settingsHttpService.getSettings(i.event).then((function(e){i.resolve(),t.resolve(e.data)}),(function(){i.reject(),t.reject()})),t.promise},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i){return new o(e,t,i)}t.ShowGridlinesSettingKey="ShowGridlines",t.SnapToGridSettingKey="SnapToGrid",t.createSettingsService=i;var o=(function(){function i(e,i,o){var r=this;this.telemetryService=e,this.userSettingsService=o,o.getExtendedSettingsByKeys([t.ShowGridlinesSettingKey,t.SnapToGridSettingKey]).then((function(e){r.showGridlines=e[0],r.snapToGrid=e[1],i.$applyAsync()}))}return i.prototype.getShowGridlines=function(){return this.showGridlines},i.prototype.setShowGridlines=function(i){this.showGridlines=i,this.persistSetting(e.telemetry.SettingsSetShowGridlines,t.ShowGridlinesSettingKey,i)},i.prototype.getSnapToGrid=function(){return this.snapToGrid},i.prototype.setSnapToGrid=function(i){this.snapToGrid=i,this.persistSetting(e.telemetry.SettingsSetSnapToGrid,t.SnapToGridSettingKey,i)},i.prototype.persistSetting=function(e,t,i){var o=this.telemetryService.startEvent(e,i);this.userSettingsService.updateExtendedSettings(t,i,o)},i})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(){var e={contentProviders:[],collapsed:!0};return e}e.getActivityPaneContract=t})(t=e.staticContract||(e.staticContract={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,a,n,c,l,d,p,u,h,v,g,m){return new s(e,t,i,o,r,a,n,c,l,d,p,u,h,v,g,m)}var i,o=jsCommon.EnumExtensions,r=e.common.helpers.ModelConverterHelper,a=e.common.contracts.ModelProperty,n=e.common.contracts.Permissions;!(function(e){e[e.Dataset=0]="Dataset",e[e.Report=1]="Report"})(i=e.storageType||(e.storageType={})),e.createStorageUsageService=t;var s=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h,v,g){this.rootScope=e,this.telemetryService=t,this.localizationService=r,this.featureSwitchService=a,this.reportService=n,this.modelService=s,this.navigation=l,this.userInfo=d,this.groupService=p,this.workbookService=u,this.lazy=h,this.permissionService=v,this.appMetadataService=g}return t.convertToUsageWithUnit=function(e){return e>=t.usageUnitRadix?t.usageInGBFormat.replace("{0}",(Math.ceil(e/t.usageUnitRadix*10)/10).toString()):t.usageInMBFormat.replace("{0}",e.toString())},Object.defineProperty(t.prototype,"quotaLimitInMB",{get:function(){if(this.featureSwitchService.featureSwitches.quotaSmallLimitEnabled)return t.smallLimitInMB;if(this.featureSwitchService.featureSwitches.forceFreeUserEnabled)return t.freeUserLimitInMB;var e;return this.userInfo&&this.userInfo.userMetadata&&this.userInfo.userMetadata.quotaStatus&&(e=this.userInfo.userMetadata.quotaStatus.quotaLimitInMB),e},enumerable:!0,configurable:!0}),t.prototype.getUsageModels=function(e){for(var a=this,s=[],c=this.modelService.models,l=this.reportService.reports,d=0,p=c.length;d<p;++d){var u=c[d].contract,h=u.sizeInMBs?u.sizeInMBs:0,v=_.filter(e,(function(e){return e.contract.modelIds&&e.contract.modelIds.indexOf(u.id)>=0}));if(this.shouldIncludeModel(u,v)){var g=this.permissionService.getModelEffectivePermissions(u),m={modelId:u.id,packageId:u.packageId,name:u.displayName,sizeInMBs:h,sizeWithUnit:t.convertToUsageWithUnit(h),storageType:i.Dataset,typeText:this.localizationService.get("QuotaManagement_ModelType_Dataset"),lastRefreshTime:r.convertRefreshTimeToLocaleString(u.lastRefreshTime),reportsFromModel:_.filter(l,(function(e){return e.modelId===u.id})),dashboardsFromModel:v,associatedDashboards:"",associatedReports:"",ownedByMe:o.hasFlag(g,n.ReadWrite)};m.associatedDashboards=this.getAssociateNames(m.dashboardsFromModel,"displayName").join(", "),m.associatedReports=this.getAssociateNames(m.reportsFromModel,"displayName").join(", "),s.push(m)}}for(var f=this.workbookService.workbooks,d=0,p=f.length;d<p;d++){var b=f[d],y=_.filter(c,(function(e){return a.shouldIncludeWorkbook(e,b)}));if(y&&y.length>0){var S=y[0].contract,h=S.sizeInMBs,g=this.permissionService.getModelEffectivePermissions(S),m={modelId:b.modelId,packageId:b.packageId,name:b.displayName,sizeInMBs:h,sizeWithUnit:t.convertToUsageWithUnit(h),storageType:i.Report,typeText:this.localizationService.get("QuotaManagement_ModelType_Report"),lastRefreshTime:r.convertRefreshTimeToJsDateTime(S.lastRefreshTime).toLocaleDateString(),reportsFromModel:[],dashboardsFromModel:[],associatedDashboards:"",associatedReports:"",ownedByMe:o.hasFlag(g,n.ReadWrite)};s.push(m)}}return s},t.prototype.getAssociateNames=function(e,t){for(var i=[],o=0,r=e;o<r.length;o++){var a=r[o];i.push(a[t])}return i},t.prototype.getUsage=function(e){for(var t=this,i=0,r=0,a=0,s=this.modelService.models,c=0,l=s.length;c<l;++c){var d=s[c].contract,p=_.filter(e,(function(e){return e.contract.modelIds&&e.contract.modelIds.indexOf(d.id)>=0}));if(this.shouldIncludeModel(d,p)){var u=this.permissionService.getModelEffectivePermissions(d);o.hasFlag(u,n.ReadWrite)?i+=d.sizeInMBs:r+=d.sizeInMBs}}for(var h=this.workbookService.workbooks,c=0,l=h.length;c<l;++c){var v=h[c],g=_.filter(s,(function(e){return t.shouldIncludeWorkbook(e,v)}));if(g&&g.length>0){var m=g[0].contract,f=m.sizeInMBs,u=this.permissionService.getModelEffectivePermissions(m);o.hasFlag(u,n.ReadWrite)?i+=f:r+=f}}return a=i+r,{ownedUsage:i,sharedUsage:r,totalUsage:a}},t.prototype.checkQuotaExceeded=function(t,i,o){void 0===i&&(i=e.telemetry.QuotaCheckOperation.Unknown);var r=this.getUsage(t),a=r.totalUsage,n=this.quotaLimitInMB;return a>n&&(this.logQuotaExceededEvent(this.userInfo.isPremiumUser,this.isMyWorkspace,i,r.ownedUsage,r.sharedUsage,n),o||this.showQuotaExceedDialog(),!0)},t.prototype.getUsageBarMenuItemViewModel=function(e){var i;i=this.isMyWorkspace?this.localizationService.get("QuotaManagement_ManagePersonalStorage"):this.localizationService.get("QuotaManagement_ManageGroupStorage");var o=this.getUsage(e).totalUsage,r=this.quotaLimitInMB;return{usageInMB:o,quotaLimitInMB:r,usageDescription:this.localizationService.get("QuotaManagement_UsageDescription").replace("{0}",t.convertToUsageWithUnit(o)).replace("{1}",t.convertToUsageWithUnit(r)),text:i}},t.prototype.showQuotaExceedDialog=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i=this;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.lazy("licenseHelper")];case 1:return t=o.sent(),[4,this.appMetadataService.getAppMetadata()];case 2:return o.sent(),this.userInfo.isPremiumUser?t.displayQuotaExceededErrorMessage(e.telemetry.LicenseEnforcementOperation.QuotaExceededTrialAndPaidUser,this.localizationService.get("QuotaExceedDialogMessage_TrialAndPaidUser"),this.localizationService.get("QuotaExceedDialogTitle"),(function(){return i.rootScope.$applyAsync((function(){i.navigation.showManageStorageSlider()}))})):t.displayQuotaExceededErrorMessage(e.telemetry.LicenseEnforcementOperation.QuotaExceededTrialUser,this.localizationService.format("QuotaExceedDialogMessage_TrialUser",[""+e.common.constants.FreeTrialPeriod]),this.localizationService.get("QuotaExceedDialogTitle"),(function(){return i.rootScope.$applyAsync((function(){i.navigation.showManageStorageSlider()}))})),[2]}}))}))},t.prototype.isInVisibleDashboard=function(e){if(_.isEmpty(e))return!0;for(var t=0,i=e;t<i.length;t++){var o=i[t];if(!o.isHidden)return!0}return!1},Object.defineProperty(t.prototype,"isMyWorkspace",{get:function(){return this.groupService.activeGroup&&this.groupService.activeGroup.isMyWorkspace},enumerable:!0,configurable:!0}),t.prototype.logQuotaExceededEvent=function(t,i,o,r,a,n){var s=i?e.telemetry.QuotaOpenManageStorageContext.Personal:e.telemetry.QuotaOpenManageStorageContext.Group,c=this.telemetryService;c.logEvent(e.telemetry.QuotaExceeded,t,s,o,r,a,n)},t.prototype.shouldIncludeModel=function(e,t){return!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e.displayName)&&null!=e.sizeInMBs&&e.sizeInMBs>0&&(e.modelFeatures&a.OrgApp)!==a.OrgApp&&e.isHidden!==!0&&this.isInVisibleDashboard(t)},t.prototype.shouldIncludeWorkbook=function(e,t){return e.contract.id===t.contract.modelId&&e.contract.packageId===t.packageId&&null!=e.contract.sizeInMBs&&e.contract.sizeInMBs>0&&t.isOwner()},t.usageInMBFormat="{0} MB",t.usageInGBFormat="{0} GB",t.usageUnitRadix=1024,t.freeUserLimitInMB=1024,t.smallLimitInMB=10,t})();e.StorageUsageService=s})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a,n,s,c,l,d,u,h,v){return new p(e,t,i,o,r,a,n,s,c,l,d,u,h,v)}var o=e.helpers.ArtifactNotFoundHelper,r=e.common.contracts.ContentProviderCategory,a=e.common.constants,n=e.dataServices.models.Dashboard,s=e.errorDetailsHelper,c=e.telemetry.InstallSource,l=e.common.models.Report,d=e.dataServices.models.Workbook;t.createStoreAppInstallService=i;var p=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u,h){this.appService=e,this.navigation=t,this.promiseFactory=i,this.contentProviderService=o,this.contentProviderHttpService=r,this.errorService=a,this.localizationService=n,this.telemetryService=s,this.quota=c,this.rootScope=l,this.dashboardDataService=d,this.modelService=p,this.reportService=u,this.workbookService=h}return t.prototype.addAppAndNavigate=function(t,i){var a=this,n=this.promiseFactory.defer();if(this.quota.checkQuotaExceeded(e.telemetry.QuotaCheckOperation.AppAutoInstall))return this.rejectDeferredAndNavigateAway(n),n.promise;var c=this.navigation;c.navigateToAppAutoInstall();var l=this.telemetryService.startEvent(e.telemetry.AppModelInitializeContentProviders);return this.contentProviderHttpService.getNonInstantiatedOrganizationalContentProviderByProviderKey(l.event,t).then((function(e){l.resolve();var t=e.data;if(!t)return a.showUnexpectedGetContentProviderError(e),void a.rejectDeferredAndNavigateAway(n);if(!a.appService.isAppCategory(r.OrganizationalApp)||t.category!==r.OrganizationalApp)return n.reject(),void c.showGetDataSlider();var o=a.contentProviderService;return o.upgradeRequiredToConnect(t)?(o.displayFeatureDisabledDialog(t),void a.rejectDeferredAndNavigateAway(n)):void a.installAppInternal(t,n,i)}),(function(t){t.status===e.HttpStatusCode.NotFound||t.status===e.HttpStatusCode.Unauthorized?o.showArtifactDoesNotExistDialog("ArtifactKind_App",a.errorService,a.localizationService,a.telemetryService):a.showUnexpectedGetContentProviderError(t),l.reject(s.getTelemetryErrorDetails(t.error,t.status)),a.rejectDeferredAndNavigateAway(n)})),n.promise},t.prototype.rejectDeferredAndNavigateAway=function(e){e.reject(),this.navigation.navigateToContentListOrActiveDashboard()},t.prototype.onInstanceInstalled=function(t){var i=this;if(t.providerContract.providerKey===this.installedAppGUID)return this.appService.unsubscribeToInstanceEvents(this.appCollectionChangedHandler),!this.targetAppArtifact&&1===t.defaultContentOption&&t.defaultContent&&(this.targetAppArtifact={dashboardOriginalGUID:t.defaultContent.dashboardObjectId,reportOriginalGUID:t.defaultContent.reportObjectId,workbookID:t.defaultContent.workbookObjectId}),this.appChangedHandler=function(){i.tryNavigateToApp()&&i.unsubscribe()},this.appInstanceService=e.dataServices.createAppInstanceService(t,this.dashboardDataService,this.modelService,this.reportService,this.workbookService),this.installedAppModel=this.appInstanceService.subscribe(this.appChangedHandler),this.tryNavigateToApp()?void this.unsubscribe():void 0},t.prototype.installAppInternal=function(e,t,i){var o=this,r=this.contentProviderService,n=this.navigation,s=c.AppAutoInstallLink;i&&(i.dashboardOriginalGUID||i.reportOriginalGUID||i.workbookID)&&(this.targetAppArtifact=i,s=c.AppArtifactAutoInstallLink),this.installedAppGUID=e.providerKey,this.appCollectionChangedHandler={onInstanceInstalled:function(e){return o.onInstanceInstalled(e)},onInstancesReset:_.noop,onInstanceUninstalled:_.noop},this.appService.subscribeToInstanceEvents(this.appCollectionChangedHandler),r.storeDataAccessInfo(r.getDataAccessInfo(e),e,s,!0).then((function(){t.resolve(null),o.appService.addApp(e),o.appCollectionChangedHandler||o.appChangedHandler?o.unregisterStateChangeHandler=o.rootScope.$on(a.navigation.stateChangeSuccess,(function(e,t,i,r,a){return o.unsubscribe()})):o.installedAppModel=o.targetAppArtifact=null}),(function(){t.reject(),o.unsubscribe()})),n.navigateToApps()},t.prototype.unsubscribe=function(){this.installedAppGUID=this.installedAppModel=this.targetAppArtifact=null,this.unregisterStateChangeHandler&&(this.unregisterStateChangeHandler(),this.unregisterStateChangeHandler=null),this.appCollectionChangedHandler&&this.appService.unsubscribeToInstanceEvents(this.appCollectionChangedHandler),this.appChangedHandler&&(this.appInstanceService.unsubscribe(),this.appInstanceService=null,this.appChangedHandler=null)},t.prototype.tryNavigateToApp=function(){if(!this.installedAppModel)return!1;if(!this.targetAppArtifact)return this.navigation.navigateToApp(this.installedAppModel.providerContract.providerKey),!0;var t=this.installedAppModel,i=this.appService.getAppArtifact(t,this.targetAppArtifact);if(!i)return!1;var o=t.providerContract.providerKey;if(i instanceof n)this.navigation.navigateToAppDashboardByGUID(i.objectId,i.contract.originalDashboardObjectId,o);else if(i instanceof l){var r=i.packageId,a=i.modelId,s=_.find(t.models,(function(e){return e.id===a&&e.packageId===r}));if(!s)return!1;this.navigation.navigateToReport({appGUID:o,reportGUID:i.objectId,reportOriginalGUID:i.contract.originalReportObjectId,groupGUID:e.constants.myWorkSpaceGroupId})}else i instanceof d&&this.navigation.navigateToAppWorkbookByUniqueId(i.uniqueId,o);return!0},t.prototype.showUnexpectedGetContentProviderError=function(e){this.errorService.error(this.localizationService.get("ErrorMessage_FailedLoadContentProviders"),"FailedLoadContentProviders",{requestId:e.requestId,statusCode:e.status.toString()})},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(t,o,r){var a=o.convertTileConfig(r.contract);if(a&&a.refreshPeriod){var n=a.refreshPeriod;n<i&&(n=i);var s=setInterval((function(){return r.refreshData()}),n);t.$on(e.common.constants.scopeDestroyEventName,(function(){return clearInterval(s)}))}}var i=6e4;e.tileDataRefreshWorker=t})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e){return new o(e)}var i="Tile_FailedToDisplay";e.createTileDisplayService=t;var o=(function(){function e(e){this.errorService=e}return e.prototype.onErrorIconClicked=function(e){var t=e.errorTitle,o=e.errorTitle,r=e.errorDetails;if(e.isError&&t){var a=r&&r.displayableErrorInfo;if(a){for(var n=0,s=a;n<s.length;n++){var c=s[n];if(c.errorInfoValue){t=c.errorInfoKey,o=c.errorInfoValue;break}}this.errorService.error(o,i,{title:t,helpLink:r.helpLink})}}},e.prototype.shouldShowTileVisual=function(e){return!0},e.prototype.isVisualSupportedInErrorState=function(e){var t=e.composite,i=e.realTime,o=!!(t&&t.tileData&&t.tileData.data),r=!!(i&&i.visual&&i.visual.data);return o||r},e})()})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,n,s,c,l,d,p,u){return new a(e,t,o,r,n,s,c,l,i,d,p,u)}e.createTutorialPopupService=t;var i=300,o=1500,r="Welcome",a=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p){this.telemetryService=e,this.userInfo=t,this.applicationOptions=i,this.featureSwitchService=o,this.localizationService=r,this.navigation=a,this.conceptualModelSetting=n,this.rtl=s,this.appMetadataService=l,this.groupHttp=d,this.licenseEnforcementService=p,this.dataStore=c}return t.prototype.startTutorial=function(e){var t=this;this.dataStore.onReady((function(){return t.startTutorialInternal(e)}))},t.prototype.showStartupTutorial=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o,r;return __generator(this,(function(a){switch(a.label){case 0:return[4,this.featureSwitchService.getFeatureSwitches()];case 1:return a.sent(),t=e.createStartupTutorialModel(this.userInfo,this.applicationOptions,this.featureSwitchService,this.localizationService,this.navigation,this.conceptualModelSetting,this.rtl),[4,this.getCapacityTutorialModel()];case 2:return i=a.sent(),t=this.appendExtraTutorialModel(t,i),o=this.getNewFreeProTrialTutorialModel(!1),t=this.appendExtraTutorialModel(t,o),[4,this.getConsumptionUITutorialModel()];case 3:return r=a.sent(),t=this.appendExtraTutorialModel(t,r),t&&this.startTutorialInternal(t),[2]}}))}))},t.prototype.appendExtraTutorialModel=function(e,t){return e?t?((i=e.itemKeys).push.apply(i,t.itemKeys),_.extend(e.items,t.items),e):e:t;var i},t.prototype.getCapacityTutorialModel=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,o;return __generator(this,(function(r){switch(r.label){case 0:if(this.dataStore.hasKey("WelcomeToCapacity")&&this.dataStore.getKey("WelcomeToCapacity")||this.applicationOptions.isE2ERun)return[2,null];r.label=1;case 1:return r.trys.push([1,5,,6]),[4,this.appMetadataService.getAppMetadata()];case 2:return t=r.sent(),t.tenantHasCapacities?[4,this.groupHttp.getAvailableGroupCapacities()]:[3,4];case 3:if(i=r.sent(),i&&!_.isEmpty(i.data))return[2,e.createStartUpCapacityTutorialModel(this.localizationService)];r.label=4;case 4:return[3,6];case 5:return o=r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.getConsumptionUITutorialModel=function(){return __awaiter(this,void 0,e.Promise,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:return this.dataStore.hasKey("WelcomeToConsumptionUI")||this.applicationOptions.isE2ERun?[2]:[4,this.featureSwitchService.getFeatureSwitches()];case 1:return t=i.sent(),t.contentAuthoringUIEnabled?[2]:[2,e.createConsumptionUITutorialModel(this.localizationService)]}}))}))},t.prototype.getNewFreeProTrialTutorialModel=function(t){var i=this;return this.dataStore.hasKey(r)||this.userInfo.isPremiumUser||this.applicationOptions.isE2ERun||!t?null:this.navigation.isRedirectedFromSignup()?e.createNewFreeUserLicenseV2TutorialModel(this.localizationService,(function(){return i.startProTrial()})):null},t.prototype.startProTrial=function(){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.licenseEnforcementService.acceptProTrial(e.telemetry.LicenseEnforcementOperation.TutorialPopup)];case 1:return t.sent(),window.location.reload(),[2]}}))}))},t.prototype.startTutorialInternal=function(t){this.tutorialModel&&this.stopTimer(),this.itemKeys=t.itemKeys;for(var i=0;i<this.itemKeys.length;++i){var o=this.itemKeys[i],a=t.items[o];if(a.itemKey=o,a.dataStoreKey||(a.dataStoreKey=o),this.dataStore.hasKey(a.dataStoreKey))this.itemKeys.splice(i,1),--i;else if(!this.dataStore.hasKey(r)&&!a.includeNewUser){var n={event:void 0,resolve:_.noop,reject:_.noop};this.dataStore.setKey(a.dataStoreKey,!0,n),this.itemKeys.splice(i,1),--i}}if(this.itemKeys.length>0&&(this.nonModalPopupCount=_.countBy(this.itemKeys,(function(e){if(!t.items[e].modal)return"nonModal"})).nonModal,this.nonModalPopupCurrentIndex=0,this.previousNonModalItem=null,this.tutorialModel=t,this.startTimer()),!this.dataStore.hasKey(r)){var s=this.telemetryService.startEvent(e.telemetry.DashboardFirstUse);this.dataStore.setKey(r,!0,s)}},t.prototype.startTimer=function(){var e=this;this.popupContainer=new u;var t=this.tutorialModel.isBlockingTutorial?i:o;this.timerID=setInterval((function(){e.checkStatus()}),t),this.checkStatus()},t.prototype.stopTimer=function(){this.tutorialModel=null,this.currentItem=null,this.popup=null,this.popupContainer.destroy(),clearInterval(this.timerID)},t.prototype.checkStatus=function(){if(this.currentItem)this.canShow(this.currentItem)?this.popup?this.popup.alignPopup():this.showItem(this.currentItem):this.popup?this.popup.closePopup(!1):this.currentItem=null;else{if(0===this.itemKeys.length)return void this.stopTimer();for(var e=this.tutorialModel.isSequentialTutorial?1:this.itemKeys.length,t=0;t<e;++t){var i=this.itemKeys[t],o=this.tutorialModel.items[i];if(this.canShow(o))return void(this.currentItem=o)}}},t.prototype.showItem=function(t){var i,o=this;!t.modal&&this.tutorialModel.isSequentialTutorial&&(this.previousNonModalItem!==t&&(this.previousNonModalItem=t,++this.nonModalPopupCurrentIndex),i=e.formattingService.format(this.localizationService.get("TutorialPopup_ProgressCount"),[this.nonModalPopupCurrentIndex,this.nonModalPopupCount])),this.popup=new h(this.popupContainer,t.attachTo,{title:t.title,text:t.text,
buttonLabel:t.buttonLabel,modalButtonClassOverride:t.modalButtonClassOverride,imageUrl:t.imageUrl,iframeUrl:t.iframeUrl,modal:t.modal,offset:t.offset,onButtonClick:t.onButtonClick,onClose:function(e,t){o.onItemClose(e,t)},preferredOrientation:t.preferredOrientation,customClass:t.customClass,iconClass:t.iconClass,cancelText:t.cancelText,overlayOptions:t.overlayOptions,progressCountText:i,learnMoreText:t.learnMoreText,learnMoreUrl:t.learnMoreUrl});var r=this.telemetryService;this.gettingStartedEvent=r.startEvent(e.telemetry.DashboardShowGettingStartedPopup,t.dataStoreKey)},t.prototype.onItemClose=function(e,t){var i=this;if(e&&(this.itemKeys.splice($.inArray(this.currentItem.itemKey,this.itemKeys),1),this.dataStore.setKey(this.currentItem.dataStoreKey,!0,this.gettingStartedEvent),this.currentItem.telemetryEventArgs&&this.telemetryService.logEvent.apply(this.telemetryService,this.currentItem.telemetryEventArgs)),t){var o=_(this.itemKeys).map((function(e){return i.tutorialModel.items[e]})).pluck("dataStoreKey").unique().value();this.itemKeys=[];for(var r=0,a=o;r<a.length;r++){var n=a[r];this.dataStore.setKey(n,!0,this.gettingStartedEvent)}}this.currentItem=null,this.popup=null},t.prototype.canShow=function(e){try{if(!e.canShow())return!1;if(e.modal)return!0;var t=e.attachTo(),i=t.offset();return null!=i&&((0!==i.left||0!==i.top)&&(this.rtl.isRtlLayout&&(i.left+=t.outerWidth()-1),!(!e.showWhenUnclickable&&0===$(document.elementFromPoint(i.left+1,i.top+1)).closest(t).length)))}catch(e){return!1}},t})();e.TutorialPopupService=a;var n=(function(){function e(){}return e.Left="left",e.Right="right",e.Top="top",e.Bottom="bottom",e.Center="center",e.LeftTop="leftTop",e.RightTopForRtl="rightTopForRtl",e.LeftBottom="leftBottom",e.RightBottomForRtl="rightBottomForRtl",e})();e.Direction=n;var s=(function(){function e(){}return e.Left="arrowLeft",e.Right="arrowRight",e.Top="arrowTop",e.Bottom="arrowBottom",e})(),c=["modal"],l=[""],d=["non-modal-list-view","non-modal-list-view-visible"],p=(function(){function e(){}return e.toStringArray=function(e){switch(e){case 0:return c;case 1:return l;case 2:return d;default:return l}},e})(),u=(function(){function e(){this.popupContainer=$(e.PopupContainerTemplate),this.overlayContainer=$(e.OverlayContainerTemplate),this.overlayOptions=1,this.destroyed=!1,$(e.PopupParent).append(this.popupContainer),this.popupContainer.append(this.overlayContainer)}return e.prototype.updateOverlaysWithClasses=function(t){if(!this.destroyed&&this.overlayOptions!==t){this.clearOverlayContainer();for(var i=p.toStringArray(t),o=0,r=i;o<r.length;o++){var a=r[o];$(e.OverlayTemplate).addClass(a).appendTo(this.overlayContainer)}this.overlayOptions=t}},e.prototype.clearOverlayContainer=function(){this.overlayContainer.remove(),this.overlayContainer=$(e.OverlayContainerTemplate),this.popupContainer.append(this.overlayContainer)},e.prototype.destroy=function(){this.destroyed=!0,this.overlayContainer.remove(),this.popupContainer.remove()},e.PopupParent="body",e.PopupContainerTemplate='<div class="tutorial-popup-container"></div>',e.OverlayContainerTemplate='<div class="tutorial-popup-overlay-container"></div>',e.OverlayTemplate='<div class="tutorial-popup-overlay"></div>',e})(),h=(function(){function e(e,t,i){this.popupContainer=e,this.attachTo=t,this.options=i,this.createPopup(i)}return e.prototype.createPopup=function(t){var i=this,o=e.PopupTemplate;for(var r in t)"string"==typeof t[r]&&(o=o.replace("{"+r+"}",t[r]));this.popup=$(o);var a=this.popup.find(".icon i");t.iconClass?a.addClass(t.iconClass):a.hide(),t.customClass&&this.popup.addClass(t.customClass);var n=this.popup.find(".image");null!=t.imageUrl?n.addClass(e.VisibleClass):n.remove(),null!=t.offset?this.popOffset=t.offset:this.popOffset={left:0,top:0},null!=t.modalButtonClassOverride&&this.popup.find(".ok-btn").addClass(t.modalButtonClassOverride),this.popup.on(e.ElementClickEventName,(function(e){e.stopPropagation()})),$(window).on(e.WindowResizeEventName,(function(){requestAnimationFrame((function(){i.alignPopup()}))})),this.popup.find(".ok-btn").html(t.buttonLabel).on(e.ElementClickEventName,(function(){i.closePopup(!0);var e=t.onButtonClick;e&&"function"==typeof e&&e()}));var s=this.popup.find(".cancel");t.cancelText?s.on(e.ElementClickEventName,(function(){i.closePopup(!0,!0)})):s.remove(),$(e.PopupParentClass).append(this.popup),t.modal?(this.popup.addClass(e.ModalClass),$(e.PopupParentClass).off(e.ElementClickEventName)):this.attachTo().on(e.ElementClickEventName,(function(){i.closePopup(!0)})),t.learnMoreText?this.popup.find(".progress-count").addClass("with-learn-more"):this.popup.find(".learn-more").remove(),t.progressCountText||this.popup.find(".progress-count").remove(),requestAnimationFrame((function(){i.alignPopup()}))},e.prototype.closePopup=function(t,i){void 0===i&&(i=!1),null!=this.popup&&(this.popup.removeClass(e.VisibleClass),this.attachTo().off(e.ElementClickEventName),$(window).off(e.WindowResizeEventName),$(e.PopupParentClass).off(e.ElementClickEventName),this.popup.remove(),this.options.onClose(t,i))},e.prototype.alignPopup=function(){var t=this,i=this.popup,o=this.attachTo();if(null!=i){var r={width:i.outerWidth(),height:i.outerHeight()},a={left:0,top:0,width:$(window).width(),height:$(window).height()},s=a;if(!this.options.modal){if(null==o)return;s=$.extend({width:o.outerWidth(),height:o.outerHeight()},o.offset())}var c=Math.floor(s.left+s.width/2-r.width/2),l=Math.floor(s.top+s.height/2-r.height/2),d=Math.floor(s.left),p=Math.floor(s.top),u=Math.floor(s.left+s.width-r.width+this.popOffset.left),h=Math.floor(s.top+s.height-r.height+e.ArrowSpacing+this.popOffset.top),v=Math.floor(s.left+s.width+e.ArrowSpacing+this.popOffset.left),g=Math.floor(s.top+s.height+e.ArrowSpacing+this.popOffset.top),m=Math.floor(s.left-r.width-e.ArrowSpacing+this.popOffset.left),f=Math.floor(s.top-r.height-e.ArrowSpacing+this.popOffset.top);if(this.options.modal){if(this.tryFitInWindow(n.Center,c,l,r,s,a))return}else{var b=[{direction:n.Left,x:v,y:l},{direction:n.Right,x:m,y:l},{direction:n.Bottom,x:c,y:f},{direction:n.Top,x:c,y:g},{direction:n.Bottom,x:d,y:f},{direction:n.Left,x:v,y:p},{direction:n.Right,x:m,y:p},{direction:n.Top,x:d,y:g},{direction:n.Bottom,x:u,y:f},{direction:n.Left,x:v,y:h},{direction:n.Right,x:m,y:h},{direction:n.Top,x:u,y:g},{direction:n.LeftTop,x:v,y:l+.35*r.height},{direction:n.RightTopForRtl,x:m,y:l+.35*r.height},{direction:n.LeftBottom,x:v,y:l-.4*r.height},{direction:n.RightBottomForRtl,x:m,y:l-.4*r.height}];this.options.preferredOrientation&&(b=_.sortBy(b,(function(e){return e.direction===t.options.preferredOrientation?0:1})));for(var y=0,S=b;y<S.length;y++){var w=S[y];if(this.tryFitInWindow(w.direction,w.x,w.y,r,s,a))return}}this.tryFitInWindow(n.Center,c,0,r,s,a,!0)}},e.prototype.tryFitInWindow=function(t,i,o,r,a,c,l){if(void 0===l&&(l=!1),i>=0&&o>=0&&i+r.width<=c.width&&o+r.height<=c.height||l){this.arrowPosition!==t&&(this.popup.removeClass(this.arrowPosition).addClass(t).css({left:"initial",top:"initial"}),this.arrowPosition=t),this.popup.addClass(e.VisibleClass).css({left:i,top:o});var d=this.popup.find(".arrow");return d.removeAttr("style"),t===n.Left?(d.css({top:Math.floor(a.top+a.height/2-o-e.ArrowSpacing)}),d.addClass(s.Left)):t===n.Top?(d.css({left:Math.floor(a.left+a.width/2-i-e.ArrowSpacing)}),d.addClass(s.Top)):t===n.Right?(d.css({top:Math.floor(a.top+a.height/2-o-e.ArrowSpacing)}),d.addClass(s.Right)):t===n.Bottom?(d.css({left:Math.floor(a.left+a.width/2-i-e.ArrowSpacing)}),d.addClass(s.Bottom)):t===n.LeftTop?(d.css({top:Math.floor(a.top+a.height/2-(o-.05*r.height)-e.ArrowSpacing)}),d.addClass(s.Left)):t===n.RightTopForRtl?(d.css({top:Math.floor(a.top+a.height/2-(o-.05*r.height)-e.ArrowSpacing)}),d.addClass(s.Right)):t===n.LeftBottom?(d.css({top:Math.floor(a.top+a.height/2-o-e.ArrowSpacing)}),d.addClass(s.Left)):t===n.RightBottomForRtl&&(d.css({top:Math.floor(a.top+a.height/2-o-e.ArrowSpacing)}),d.addClass(s.Right)),this.options.overlayOptions?this.popupContainer.updateOverlaysWithClasses(this.options.overlayOptions):this.options.modal?this.popupContainer.updateOverlaysWithClasses(0):this.popupContainer.updateOverlaysWithClasses(1),!0}return!1},e.PopupParentClass=".tutorial-popup-container",e.ArrowSpacing=20,e.VisibleClass="show",e.ModalClass="modal",e.ElementClickEventName="click.popup",e.WindowResizeEventName="resize.popup",e.PopupTemplate='             <div class="tutorial-popup">                 <div class="box">                     <div class="arrow"></div>                     <div class="icon"><i class="glyphicon glyph-small"></i></div>                     <div class="title">{title}</div>                     <img src="{imageUrl}" class="image"></img>                     <div class="text">{text}</div>                     <a class="learn-more" target="_blank" href="{learnMoreUrl}">{learnMoreText}</a>                     <div class="progress-count">{progressCountText}</div>                     <div class="ok-btn primary"></div>                     <div class="cancel">{cancelText}</div>                 </div>             </div>',e})()})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,r,a,n,c,l,d,p,u,h){return new s(e,t,i,o,r,a,n,c,l,d,p,u,h)}var o=e.common.constants,r=e.common.contracts.ContentProviderCategory,a=jsCommon.JsonExtensions,n=e.telemetry.UsageMetricsArtifactType;t.createUsageMetricsReport=i;var s=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u){this.usageMetricsHttp=e,this.navigation=t,this.localizationService=i,this.notificationToastService=o,this.dashboardService=r,this.errorService=a,this.reportService=n,this.promiseFactory=s,this.packageService=c,this.modelService=l,this.moduleLoader=d,this.featureSwitchService=p,this.contentProviderHttpService=u,this.pendingUsageMetricsRequests=[]}return t.prototype.openDashboardUsageMetricsReport=function(t,i,o){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.getPackageAndNavigateToUsageMetricsReport(n.Dashboard,t.displayName,t.objectId,i,o)];case 1:return[2,e.sent()]}}))}))},t.prototype.openReportUsageMetricsReport=function(t,i,o){return __awaiter(this,void 0,e.Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.getPackageAndNavigateToUsageMetricsReport(n.Report,t.displayName,t.objectId,i,o)];case 1:return[2,e.sent()]}}))}))},t.prototype.getContentTileFromUsageMetricsFilters=function(t){return __awaiter(this,void 0,e.Promise,(function(){var i,o,r,a,n,s,c;return __generator(this,(function(l){switch(l.label){case 0:return[4,this.promiseFactory.all([this.moduleLoader.require({javascript:"odataFilterParser"}),this.moduleLoader.require({javascript:"odataExplore"})])];case 1:if(l.sent(),o={supportMultiplePredicates:!0},r=e.explore.odata.createODataFilterParser(o),a=r.tryGetFilters(t),_.isEmpty(a))return[2];for(n=0,s=a;n<s.length&&(c=s[n],i=this.getContentTileFromFilters(c),_.isEmpty(i));n++);return[2,i]}}))}))},t.prototype.isUsageMetricsContentProvider=function(e){return o.isUsageMetricsContentProvider(e)},t.prototype.reportBelongsToUsageMetricsContentPack=function(e){return!!e&&this.lookupPackageAndCheckPackageIsUsageMetricsContentPack(e.packageId)},t.prototype.reportOriginatedFromUsageMetricsContentPack=function(e){if(!e)return!1;if(this.reportBelongsToUsageMetricsContentPack(e))return!0;var t=this.packageService.findPackage(e.packageId);return!!t&&this.packageIsACopyOfUsageMetricsContentPack(t)},t.prototype.modelBelongsToUsageMetricsContentPack=function(e){return!!e&&this.lookupPackageAndCheckPackageIsUsageMetricsContentPack(e.packageId)},t.prototype.modelOriginatedFromUsageMetricsContentPack=function(e){if(!e)return!1;if(this.modelBelongsToUsageMetricsContentPack(e))return!0;var t=this.packageService.findPackage(e.packageId);return!!t&&this.packageIsACopyOfUsageMetricsContentPack(t)},t.prototype.packageIsACopyOfUsageMetricsContentPack=function(e){if(!e)return!1;if(!_.isNumber(e.originalPackageId))return!1;var t=this.packageService.findPackage(e.originalPackageId);return this.packageIsUsageMetricsContentPack(t)},t.prototype.packageIsUsageMetricsContentPack=function(e){return e&&o.isUsageMetricsContentProvider(e.contentProviderId)},t.prototype.populateCurrentUsageMetricsVersion=function(t){return __awaiter(this,void 0,e.Promise,(function(){var e,i,o,n,s,c,l,d,p;return __generator(this,(function(u){switch(u.label){case 0:return[4,this.contentProviderHttpService.getBuiltInContentProvidersAsync(t)];case 1:return e=u.sent(),_.isEmpty(e)||(i=_.filter(e,(function(e){return e.category===r.BuiltIn&&103===e.id})),o=!_.isEmpty(i)&&i[0].providerConfig,n=!_.isEmpty(o)&&a.tryParseJSON(o),s=n&&n.providerVersion,this.currentDashboardUsageMetricsVersion=!_.isEmpty(s)&&new Number(s),c=_.filter(e,(function(e){return e.category===r.BuiltIn&&102===e.id})),l=!_.isEmpty(c)&&c[0].providerConfig,d=!_.isEmpty(l)&&a.tryParseJSON(l),p=d&&d.providerVersion,this.currentReportUsageMetricsVersion=!_.isEmpty(p)&&new Number(p)),[2]}}))}))},t.prototype.lookupPackageAndCheckPackageIsUsageMetricsContentPack=function(e){var t=this.packageService.findPackage(e);return!!t&&this.packageIsUsageMetricsContentPack(t)},t.prototype.getContentTileFromFilters=function(e){var t=_.first(e.filter.from().keys());if(t){var i=e.filter.from().source(t);if(i){var o=i.entity;if("Reports"===o||"Dashboards"===o){var r=_.first(e.filter.where());if(r&&r.condition){var a=r.condition.left,n=r.condition.right;if(a&&n){var s=a.ref,c=n.value;if(s&&c&&("ReportGuid"===s||"DashboardGuid"===s))return"ReportGuid"===s?this.reportService.findReportByGUID(c):"DashboardGuid"===s?this.dashboardService.findDashboardByGUID(c):void 0}}}}}},t.prototype.getPackageAndNavigateToUsageMetricsReport=function(t,i,o,r,a){return __awaiter(this,void 0,e.Promise,(function(){var s,c,l,d,p;return __generator(this,(function(u){switch(u.label){case 0:return s=this.notificationToastService.notify({title:this.localizationService.get("UsageMetrics_LoadingTitle"),message:this.localizationService.format("UsageMetrics_LoadingSubtitle",[i]),notificationType:e.common.NotificationToastType.Loading,sticky:!0}),this.tryAttachToPendingUsageMetricsRequestIfExisting(i,o,r,t,s)?[2]:this.currentDashboardUsageMetricsVersion&&this.currentReportUsageMetricsVersion?[3,2]:[4,this.populateCurrentUsageMetricsVersion(a.event)];case 1:u.sent(),u.label=2;case 2:if(t===n.Dashboard)c=this.currentDashboardUsageMetricsVersion;else{if(t!==n.Report)return[2];c=this.currentReportUsageMetricsVersion}if(!c)return[2];if(this.tryNavigateToUsageMetricsReport(o,r,t,c,a.event))return this.onPackagePublishDone(s),[2];l=this.pushPendingUsageMetricsRequest(r,t),this.attachToPendingUsageMetricsRequest(l,i,o,r,t,s),u.label=3;case 3:return u.trys.push([3,5,6,7]),[4,this.usageMetricsHttp.getPackage(t,a.event)];case 4:return d=u.sent(),this.packageService.mergePackageCollection([d]),this.reportService.mergeReportCollection(d.reports),d.models[0].permissions=d.permissions,this.modelService.mergeDatasetCollection(d.models),l.defered.resolve(d.reports[0]),[3,7];case 5:throw p=u.sent(),l.defered.reject(p),p;case 6:return _.remove(this.pendingUsageMetricsRequests,l),[7];case 7:return[2]}}))}))},t.prototype.tryNavigateToUsageMetricsReport=function(e,t,i,o,r){var a=this.getUsageMetricsReportIfExisting(i,o,r);return!_.isEmpty(a)&&(this.constructODataFiltersThenNavigateToReportByGuid(a.objectId,i,e,t),!0)},t.prototype.tryAttachToPendingUsageMetricsRequestIfExisting=function(e,t,i,o,r){var a=this.getPendingRequestIfExisting(i,o);return!_.isEmpty(a)&&(this.attachToPendingUsageMetricsRequest(a,e,t,i,o,r),!0)},t.prototype.pushPendingUsageMetricsRequest=function(e,t){var i=this.promiseFactory.defer(),o={artifactType:t,groupObjectId:e,defered:i};return this.pendingUsageMetricsRequests.push(o),o},t.prototype.attachToPendingUsageMetricsRequest=function(e,t,i,o,r,a){var n=this;e.defered.promise.then((function(e){e&&n.showSuccessToastToNavigateToReport(e.objectId,i,o,t,r),n.onPackagePublishSucceeded(a)}),(function(e){return n.onPackagePublishFailed(a,e.requestId,e.errorCode)}))},t.prototype.showSuccessToastToNavigateToReport=function(t,i,o,r,a){var n=this,s={displayText:this.localizationService.get("UsageMetrics_FinishedLoadingButtonText"),action:function(){return n.constructODataFiltersThenNavigateToReportByGuid(t,a,i,o)}};this.notificationToastService.notify({title:this.localizationService.get("UsageMetrics_FinishedLoadingTitle"),message:this.localizationService.format("UsageMetrics_FinishedLoadingSubtitle",[r]),notificationType:e.common.NotificationToastType.Success,actionButtons:[s],sticky:!0})},t.prototype.getUsageMetricsReportIfExisting=function(e,t,i){var o=this,r=-1;if(e===n.Dashboard)r=103;else{if(e!==n.Report)return;r=102}var a=_.find(this.reportService.reports,(function(e){var t=o.packageService.findPackage(e.packageId);return t.contentProviderId===r}));if(!this.featureSwitchService.featureSwitches.usageMetricsUpgrade)return a;if(a){var s=new Number(a.contract.packageVersion);if(s.valueOf()===t.valueOf())return a}},t.prototype.constructODataFiltersThenNavigateToReportByGuid=function(e,t,i,o){var r="";t===n.Report?r="Reports/ReportGuid eq '"+i+"'":t===n.Dashboard&&(r="Dashboards/DashboardGuid eq '"+i+"'"),this.navigation.navigateToReport({groupGUID:o,reportGUID:e,filter:r})},t.prototype.getPendingRequestIfExisting=function(e,t){var i=_.find(this.pendingUsageMetricsRequests,(function(i){return i.artifactType===t&&i.groupObjectId===e}));return i},t.prototype.onPackagePublishSucceeded=function(e){this.onPackagePublishDone(e)},t.prototype.onPackagePublishFailed=function(e,t,i){this.onPackagePublishDone(e),this.showErrorMessage(t,i)},t.prototype.onPackagePublishDone=function(e){_.isEmpty(e)||this.notificationToastService.hide(e)},t.prototype.showErrorMessage=function(e,t){this.errorService.error(this.localizationService.get("UsageMetrics_FailedOpeningReport_Message"),"FailedToOpenUsageMetricsReport",{requestId:e,statusCode:t})},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,o,r,a,n,s,c,l){return new i(e,t,o,r,a,n,s,c,l)}e.createUserSettingsService=t;var i=(function(){function t(e,t,i,o,r,a,n,s,c){this.telemetryService=e,this.modelConverter=t,this.promiseFactory=i,this.userSettingsHttpService=o,this.errorService=r,this.localizationService=a,this.appMetadataService=n,this.networkAvailability=s,this.rootScope=c,this.getSettingsDeferred=null,this.forceRefreshOfUserSettings=!1}return t.prototype.getUserSettings=function(){var e=this;return this.getSettingsDeferred||(this.getSettingsDeferred=this.promiseFactory.defer(),this.appMetadataService.getAppMetadata().then((function(t){t.userSettings&&!e.forceRefreshOfUserSettings?(e.getSettingsDeferred.resolve(e.modelConverter.convertUserSettings(t.userSettings)),e.getSettingsDeferred=null):(e.loadUserSettingsFromServer(t),e.forceRefreshOfUserSettings=!1)}),(function(){e.loadUserSettingsFromServer()}))),this.getSettingsDeferred.promise},t.prototype.refreshUserSettings=function(){this.forceRefreshOfUserSettings=!0},t.prototype.getExtendedSettingByKey=function(e){var t=this,i=this.promiseFactory.defer();return this.ensureExtendedSettings().then((function(){i.resolve(t.extendedSettings[e])})),i.promise},t.prototype.getExtendedSettingsByKeys=function(e){var t=this,i=this.promiseFactory.defer();return this.ensureExtendedSettings().then((function(){i.resolve(_.map(e,(function(e){return t.extendedSettings[e]})))})),i.promise},t.prototype.updateExtendedSettings=function(e,t,i){var o=this;return this.ensureExtendedSettings().then((function(){o.extendedSettings[e]=t;var r=JSON.stringify(o.extendedSettings);return o.userSettingsHttpService.updateExtendedSettings(r,i.event).then((function(){i.resolve()}))})).catch((function(e){i.reject()}))},t.prototype.ensureExtendedSettings=function(){var e=this,t=this.promiseFactory.defer();return this.extendedSettings?t.resolve(null):this.getUserSettings().then((function(i){e.extendedSettings=i&&i.extendedSettings?i.extendedSettings:{},t.resolve(null)})),t.promise},t.prototype.loadUserSettingsFromServer=function(t){var i=this;if(!this.networkAvailability.isNetworkAvailable())return this.getSettingsDeferred.reject(),void(this.getSettingsDeferred=null);var o=this.telemetryService.startEvent(e.telemetry.PrivacyInitializeSettingsModel);this.userSettingsHttpService.getUserSettings(o.event).then((function(e){var r=e.data;t&&(t.userSettings=r),i.getSettingsDeferred.resolve(i.modelConverter.convertUserSettings(r)),i.getSettingsDeferred=null,o.resolve()}),(function(e){i.getSettingsDeferred.reject(),o.reject(),i.getSettingsDeferred=null,i.errorService.error(i.localizationService.get("SettingsGeneral_Error_FailedToLoad"),"SettingsGeneral_Error_FailedToLoad",{requestId:e.requestId,statusCode:e.status.toString()})}))},t.prototype.updateAllowQnaDataCollection=function(t,i){var o=this,r=this.promiseFactory.defer();return this.userSettingsHttpService.updateAllowQnaDataCollection(t,i.event).then((function(){i.resolve(),window.initialDashboardContainer&&window.initialDashboardContainer.userSettings&&(window.initialDashboardContainer.userSettings.allowQnaDataCollection=t),r.resolve(t),o.rootScope.$emit(e.constants.notifyUpdateAllowQnaDataCollectionEventName,t)}),(function(e){i.reject(),r.reject(),o.errorService.error(o.localizationService.get("SettingsGeneral_Error_FailedToSave"),"SettingsGeneral_Error_FailedToSave",{requestId:e.requestId,statusCode:e.status.toString()})})),r.promise},t.prototype.updateEsriSetting=function(e,t){var i=this,o=this.promiseFactory.defer(),r={esriVisualEnabled:e};return this.userSettingsHttpService.updateUserSettings(r,t.event).then((function(){t.resolve(),o.resolve(e)}),(function(e){t.reject(),o.reject(),i.errorService.error(i.localizationService.get("SettingsGeneral_Error_FailedToSave"),"SettingsGeneral_Error_FailedToSave",{requestId:e.requestId,statusCode:e.status.toString()})})),o.promise},t.prototype.updateLanguageSetting=function(e,t){var i=this,o=this.promiseFactory.defer(),r={preferredLanguage:e};return this.userSettingsHttpService.updateUserSettings(r,t.event).then((function(){t.resolve(),o.resolve(e)}),(function(e){t.reject(),o.reject(),i.errorService.error(i.localizationService.get("SettingsGeneral_Error_FailedToSave"),"SettingsGeneral_Error_FailedToSave",{requestId:e.requestId,statusCode:e.status.toString()})})),o.promise},t.prototype.updatePinDialogPreviewTileFormat=function(e,t){var i=this,o=this.promiseFactory.defer(),r={tileDialogPreviewFormat:e};return this.userSettingsHttpService.updateUserSettings(r,t.event).then((function(){t.resolve(),window.initialDashboardContainer&&window.initialDashboardContainer.userSettings&&(window.initialDashboardContainer.userSettings.tileDialogPreviewFormat=e),o.resolve(e)}),(function(e){t.reject(),o.reject(),i.errorService.error(i.localizationService.get("SettingsGeneral_Error_FailedToSave"),"SettingsGeneral_Error_FailedToSave",{requestId:e.requestId,statusCode:e.status.toString()})})),o.promise},t})()})(powerbi||(powerbi={}));var powerbi;!(function(e){var t="zh-hans",i="zh-hant",o="cn",r="zh-TW",a=(function(){function e(){}return e.createIfUndefined=function(){e.Popover||($("body").append(e.PopoverHtml),e.Popover=$(e.PopoverSelector),e.hide(),e.Popover.find(e.FooterSelector).on(jsCommon.DOMConstants.mouseDownEventName,(function(e){e.stopPropagation()})))},e.setFooterText=function(t){e.Popover.find(e.FooterSelector).html(t)},e.show=function(){e.createIfUndefined(),e.Popover.show()},e.hide=function(){e.Popover&&e.Popover.hide()},e.PopoverHtml='<div id="popover"><div id="popovermain"><div class="powerbi-spinner"><div class="spinner"><div class="dots" ><span>&#9679;</span><span>&#9679;</span><span>&#9679;</span><span>&#9679;</span><span>&#9679;</span></div></div></div></div><div class="footer"></div></div>',e.PopoverSelector="#popover",e.FooterSelector=".footer",e})();e.UserVoicePopover=a;var n=(function(){function n(){}return Object.defineProperty(n,"api",{get:function(){return n.updateEventBindings(),window.UserVoice},enumerable:!0,configurable:!0}),n.updateIdentificationInfo=function(){e.session.userInfo&&n.api.push([n.identifyKey,{email:e.session.UserInfoUtils.getEmailAddressForReceivingMail(),display_name:e.session.UserInfoUtils.getFullName(),id:e.session.userInfo.puid}])},n.ensureUserVoice=function(s,c){var l=this;if(!this.serviceLoaded){var d=this.promiseFactory.defer(),p=(new Date).toTimeString();n.loadAPI();var u=e.common.httpService.powerbiRequestOptions();return u.telemetryDescription="GetUserVoiceDetails",e.common.localization.loader.currentLanguageLocale.toLowerCase()===t?n.api.push(["set","locale",o]):e.common.localization.loader.currentLanguageLocale.toLowerCase()===i?n.api.push(["set","locale",r]):n.api.push(["set","locale",e.common.localization.loader.currentLanguageLocale||window.navigator.language||window.navigator.userLanguage]),n.api.push(["set",{accent_color:"#000000"}]),n.api.push(["set","ticket_custom_fields",{ClientSessionID:s.sessionId,TimeZone:p.substring(p.indexOf(" ")+1)}]),n.updateIdentificationInfo(),e.common.httpService.get("/powerbi/metadata/user/userVoiceDetails",u).then((function(t){null!=t.data&&null!=t.data.alternateEmail&&t.data.alternateEmail.length>0&&e.session.userInfo&&(e.session.userInfo.alternateEmail=t.data.alternateEmail),n.updateIdentificationInfo(),l.serviceLoaded=!0,c(),d.resolve({})})),$("body").on(jsCommon.DOMConstants.mouseDownEventName,(function(e){n.onBodyClick(e),a.hide()})),d}c()},n.loadAPI=function(){window.UserVoice||(window.UserVoice=window.UserVoice||[],(function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//widget.uservoice.com/EPlzu5neSTcHV7QTq9luQ.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})())},n.updateEventBindings=function(){window.setTimeout((function(){n.activeWidgets=$(".uv-popover"),n.activeWidgets.on(jsCommon.DOMConstants.mouseClickEventName,(function(e){e.stopPropagation()}))}),250)},n.onBodyClick=function(e){n.activeWidgets&&n.activeWidgets.length>0&&(n.activeWidgets.remove(),n.activeWidgets=null)},n.identifyKey="identify",n.serviceLoaded=!1,n.promiseFactory=e.createJQueryPromiseFactory(),n})();e.UserVoiceService=n})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e,t){t.models=i(e.models,t.models),t.packages=i(e.packages,t.packages),t.reports=i(e.reports,t.reports),t.workbooks=i(e.workbooks,t.workbooks)}function i(e,t){if(_.isEmpty(e))return t;if(_.isEmpty(t))return e;for(var i={},o=0,r=t.length;o<r;o++){var a=t[o];i[a.id]=a}for(var n=0,s=e.length;n<s;n++){var c=e[n];i[c.id]=c}var l=[];for(var d in i)l.push(i[d]);return l}e.mergeDashboardContainerModelsReportsAndPackages=t})(t=e.contracts||(e.contracts={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.explore.contracts,o=e.explore.viewModels,r=(function(){function t(i,o){var r=this;this.scope=i,this.services=o,this.rtl=this.services.rtl,this.scope.userGroupHeader=new e.models.UserGroupHeaderModel,this.scope.sortDescending=!1,this.scope.sortProperty="associatedReport.displayName",this.scope.onDeleteEmbedClick=function(e){return r.onDeleteEmbedClick(e)},this.scope.showEmbedCode=function(e){return r.showEmbedCode(e)},this.scope.updateSortProperty=function(e){return r.updateSortProperty(e)},this.loadEmbeddedResources(),this.scope.manageFlyoutStyle=t.ManageFlyoutInactiveStyle,this.scope.toggleFlyout=function(e,t){return r.toggleFlyout(e,t)},i.$on("$destroy",(function(){return r.dispose()})),$(window).on(jsCommon.DOMConstants.keyDownEventName,(function(e){return r.keyDownHideDialog(e)})),$(window).on(jsCommon.DOMConstants.mouseDownEventName,(function(e){return r.mouseDownHideDialog(e)}))}return t.createOptions=function(){return{additionalServices:["reportService","modelService","embedProxy","embed","errorService","modelConverter","localizationService","telemetryService","promiseFactory","modalDialogService","rtl","activeGroupId","lazy"]}},t.prototype.deleteEmbed=function(t,o){var r=this,a=_.find(this.scope.embeddedResources,(function(e){return e.contract.snapshotId===t&&e.contract.embedType===o})),n=this.services.telemetryService.startEvent(e.telemetry.ManageEmbedDeleteEmbedCode,a.contract.snapshotId,a.contract.embedType,a.contract.disabled);this.deleteEmbedInternal(a).then((function(e){n.resolve();var i=_.findIndex(r.scope.embeddedResources,(function(e){return e.contract.snapshotId===t&&e.contract.embedType===o}));r.scope.embeddedResources.splice(i,1)}),(function(e){n.reject(),a.contract.embedType===i.EmbedType.Interactive&&r.services.errorService.error("Delete live embed error","DeleteLiveEmbedError",{requestId:e.requestId,statusCode:e.status.toString()})}))},t.prototype.onDeleteEmbedClick=function(e){var t=this,i=this.scope.$new(!0),o=[new InJs.ModalDialogAction(this.services.localizationService.get("ManageEmbed_PublishToWeb_DeleteConfirmationConfirmButtonText"),function(o,r){i.closeDialog(),t.deleteEmbed(e.contract.snapshotId,e.contract.embedType)},null,"confirmation"),new InJs.ModalDialogAction(this.services.localizationService.get("ManageEmbed_PublishToWeb_DeleteConfirmationCloseButtonText"),function(e,t){i.closeDialog()})],r=this.services.localizationService.get("ManageEmbed_PublishToWeb_DeleteConfirmationTitle"),a=this.services.localizationService.get("ManageEmbed_PublishToWeb_DeleteConfirmationMessage");i.viewModel={message:a};var n={dialogCssClass:"embedDeleteDialog",dialogName:r,template:"<confirmation-modal-dialog></confirmation-modal-dialog>",scope:i,dialogActions:o};this.services.modalDialogService.showLegacyWebModalDialog(n)},t.prototype.toggleFlyout=function(e,i){this.scope.manageFlyoutStyle===t.ManageFlyoutActiveStyle?this.scope.manageFlyoutStyle=t.ManageFlyoutInactiveStyle:(this.scope.selectedEmbed=i,this.showDialog(e))},t.prototype.showDialog=function(e){var i=this;if(!this.flyoutElement){var o=this.services.activeGroupId.isReadOnly?t.ManageFlyoutTemplateForReadOnlyMember:t.ManageFlyoutTemplateForNonReadOnlyMember;this.template=angular.element(o),this.flyoutElement=this.services.compile(this.template)(this.scope),this.arrowElement=this.flyoutElement.find(t.ArrowSelector),$("body").append(this.flyoutElement)}var r={left:e.pageX,top:e.pageY},a=e.target,n=a.clientWidth;this.services.timeout((function(){if(r.top-=i.flyoutElement.height()/2-t.PositionOffset.top,r.top=i.adjustPositionTop(r),i.rtl&&i.rtl.isRtlLayout){var e=i.flyoutElement.width();r.left=r.left-(e+t.ArrowWidth)-t.PositionOffset.left,i.arrowElement.addClass(t.rightArrowDirection)}else r.left+=n+t.ArrowWidth+t.PositionOffset.left;i.flyoutElement.css(r),i.scope.manageFlyoutStyle=t.ManageFlyoutActiveStyle}))},t.prototype.adjustPositionTop=function(e){var i=0,o=i+$(document).height()-this.flyoutElement.height();return e.top<i?(this.arrowElement.css({top:e.top+this.flyoutElement.height()/2-i+t.ArrowPositionOffset.top}),i):e.top>o?(this.arrowElement.css({top:e.top+this.flyoutElement.height()/2-o+t.ArrowPositionOffset.top}),o):(this.arrowElement.removeAttr("style"),e.top)},t.prototype.showEmbedCode=function(t){var i=this.scope.$new(!0),r=t.associatedReport.id,a=t.contract,n=a.name,s={name:n,reportId:r,culture:e.common.cultureInfo,size:{height:a.size.height,width:a.size.width},version:e.build},c=this.services.promiseFactory.defer();c.reject(),i.viewModel=o.ViewModelFactory.createEmbedModalDialog(this.services.localizationService,this.services.embed,void 0,s,c.promise,void 0);var l=i.viewModel;l.publishState=4,l.currentEmbed=a;var d=l.embedTab.embed,p=this.services.embed;d.link=p.createEmbedUri(a),d.embedCode=p.createEmbedCode(a);var u={containerCssClass:"small embedContainer",dialogCssClass:"embedDialog",dialogName:null,template:"<embed-modal-dialog></embed-modal-dialog>",scope:i};this.services.modalDialogService.showLegacyWebModalDialog(u)},t.prototype.deleteEmbedInternal=function(e){if(e.contract.embedType===i.EmbedType.Interactive)return this.services.embedProxy.deleteLiveEmbed(e.contract.snapshotId)},t.prototype.mouseDownHideDialog=function(e){var i=this;this.clickOutsideFlyout(e)&&this.scope.$apply((function(){
i.scope.manageFlyoutStyle=t.ManageFlyoutInactiveStyle}))},t.prototype.keyDownHideDialog=function(e){var i=this;this.scope.manageFlyoutStyle===t.ManageFlyoutActiveStyle&&27===e.keyCode&&this.scope.$apply((function(){i.scope.manageFlyoutStyle=t.ManageFlyoutInactiveStyle}))},t.prototype.clickOutsideFlyout=function(e){var i=e.pageX,o=e.pageY;if(this.flyoutElement&&this.scope.manageFlyoutStyle===t.ManageFlyoutActiveStyle){var r=this.flyoutElement.offset(),a=r.left,n=r.top,s=a+this.flyoutElement.width(),c=n+this.flyoutElement.height();return a>i||i>s||n>o||o>c}return!1},t.prototype.dispose=function(){this.flyoutElement&&this.flyoutElement.remove(),$(window).off(jsCommon.DOMConstants.keyDownEventName,this.keyDownHideDialog),$(window).off(jsCommon.DOMConstants.mouseDownEventName,this.mouseDownHideDialog)},t.prototype.updateSortProperty=function(e){this.scope.sortProperty===e?this.scope.sortDescending=!this.scope.sortDescending:(this.scope.sortProperty=e,this.scope.sortDescending=!1)},t.prototype.loadEmbeddedResources=function(){return __awaiter(this,void 0,e.Promise,(function(){var e,t=this;return __generator(this,(function(i){switch(i.label){case 0:return this.scope.isLoaded=!1,e=this.services,[4,this.services.lazy("embedCodesService")];case 1:return e.embedCodesService=i.sent(),this.services.embedCodesService.loadEmbeddedResources().then((function(e){t.scope.embeddedResources=e,t.scope.isLoaded=!0})),[2]}}))}))},t.ArrowWidth=28,t.ArrowPositionOffset={left:0,top:-10},t.ArrowSelector=".wrapper .arrow",t.ManageFlyoutActiveStyle="active",t.ManageFlyoutInactiveStyle="inactive",t.rightArrowDirection="right",t.PositionOffset={left:-22,top:0},t.GetCodeTemplate="<div class='action alignIcon'><i class='glyphicon glyph-small pbi-glyph-code'></i><a href='' localize='ManageEmbed_CodeText' ng-click='showEmbedCode(selectedEmbed)'></a></div>",t.DeleteTemplate="<div class='alignIcon'><i class='glyphicon glyph-small pbi-glyph-delete'></i><a href='' localize='ManageEmbed_DeleteText' ng-click='onDeleteEmbedClick(selectedEmbed)'></a></div>",t.ManageFlyoutTemplate="<div class='manageFlyout active' ng-class='manageFlyoutStyle'><div class='wrapper'><div class='arrow'></div><div class='manageFlyout-container'>{0}</div></div></div>",t.ManageFlyoutTemplateForReadOnlyMember=jsCommon.StringExtensions.format(t.ManageFlyoutTemplate,t.GetCodeTemplate),t.ManageFlyoutTemplateForNonReadOnlyMember=jsCommon.StringExtensions.format(t.ManageFlyoutTemplate,t.GetCodeTemplate+"<br/>"+t.DeleteTemplate),t})();t.ManageEmbedView=r})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.helpers.ModelConverterHelper,o=(function(){function t(e,t){this.scope=e,this.services=t,this.initialize(this.scope.viewModel)}return t.createOptions=function(){return{additionalServices:["localizationService","modelConverter","modelService","navigation","storageUsageService","userSettingsService","featureSwitchService","dashboardDataService","rtl","sampleQuestionsService"],scopedServiceRoot:!0}},t.prototype.initialize=function(t){var o=this,r=!t||!t.models;if(r&&this.services.navigation.inQnaView()){var a=this.services.dashboardDataService.activeDashboard,n=this.services.dashboardDataService.activeDashboardModels;a&&n?(this.scope.viewModel.models=n,this.scope.viewModel.title=a.displayName):this.unregisterDashboardContainerWatch=this.services.rootScope.$on(e.constants.dashboardContainerLoaded,(function(){var e=o.services.dashboardDataService.activeDashboard,t=o.services.dashboardDataService.activeDashboardModels;o.scope.viewModel.models=t,o.scope.viewModel.title=e.displayName}))}else r&&this.services.navigation.inQnaModelView()&&this.services.modelService.modelsPromise.then((function(e){var t=o.services.navigation.currentDatasetDBName,i=_(e).filter((function(e){return e.dbName===t})).map((function(e){return e.contract})).value();o.scope.viewModel.models=i,o.scope.viewModel.title=i[0].displayName}));this.scope.questionBoxOutput={utterance:"",showQnaFeedback:!1,showPinButton:!1,interpretUtterance:null,updateUtteranceWithoutInterpret:null,clearQuestionBox:null,showUserFeedbackDialog:null},this.scope.newQnaEnabled=!this.services.rtl.isRtlLayout,this.scope.getAdditionalODataFilter=function(){return o.services.navigation.additionalODataFilter},this.scope.pinQnAVisual=function(e){return o.pinQnAVisual(e)};var s=this.scope.navigation=this.services.navigation,c={getInitialVisualState:function(){return 4},setInterpretListener:function(e){o.scope.infoNavContainerInterpretListener=e},updatePinIconState:function(e){o.scope.pinIconState=e},setUtteranceText:function(e){o.scope.questionBoxOutput.updateUtteranceWithoutInterpret(e)}};this.scope.infoNavHostService=c,this.scope.allowQnaDataCollection=!1,this.services.userSettingsService.getUserSettings().then((function(e){e&&(o.scope.allowQnaDataCollection=e.allowQnaDataCollection)}));var l=this.services.rootScope.$on(e.constants.notifyUpdateAllowQnaDataCollectionEventName,(function(e,t){e.stopPropagation(),e.preventDefault(),o.scope.allowQnaDataCollection=t}));if(this.scope.$watch("viewModel.models",(function(e){if(e){var t=o.services.featureSwitchService.featureSwitches;o.scope.modelsSupportQna=_.some(e,(function(e){return i.getIsQnaSupported(e,t)}))}})),s.qnaQuery)var d=this.scope.$watch("questionBoxOutput.interpretUtterance",(function(e){e&&(e(s.qnaQuery),o.watchUtteranceForNavigation(),d())}));else this.watchUtteranceForNavigation();this.services.localizationService.ensureLocalization((function(){o.scope.unsupportedModelMessage=o.services.localizationService.get("QnAVisualization_UnsupportedModelTitleText")})),this.scope.$on("$destroy",(function(){l(),o.unregisterDashboardContainerWatch&&o.unregisterDashboardContainerWatch()})),this.setQnaEnableAndTilesUtterance()},t.prototype.watchUtteranceForNavigation=function(){var e=this.services.navigation;this.scope.$watch("questionBoxOutput.utterance",(function(t){e.inQnaModelView()||e.inQnaView()?e.showQnaView(t,2,!1):_.isEmpty(t)||(e.qnaQuery||"")===(t||"")||e.showQnaView(t,0,!1)}))},t.prototype.pinQnAVisual=function(t){t.stopPropagation(),this.services.rootScope.$emit(e.infonav.constants.pinSelectedVisual)},t.prototype.setQnaEnableAndTilesUtterance=function(){var e=this.services.dashboardDataService;e.updateIsQnaEnabled();var t=e.activeDashboard&&e.activeDashboard.tiles;if(!_.isEmpty(t)){var i=this.services.sampleQuestionsService;i.clearTilesUtterance();for(var o=0,r=t;o<r.length;o++){var a=r[o];_.isEmpty(a.utterance)||i.addTileUtterance(a.utterance,a.contract.modelId)}}},t})();t.QnaContainerController=o})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.services.FullScreenFitStyle,o=(function(){function t(o,r){var a=this;this.restrict="E",this.templateUrl="views/fullScreenControls.html",this.replace=!0,this.scope={},this.link=function(o,r,n){var s=-1,c=function(){s!==-1&&(window.clearTimeout(s),r.addClass(t.TransitioningCSSClass)),s=window.setTimeout((function(){s=-1,r.removeClass(t.TransitioningCSSClass)}),t.ControlDisplayTimeInMs)},l=function(e){o.$applyAsync((function(){return 27===e.keyCode?void a.fullScreen.exitFullScreen():void(a.navigation.inDashboardDetailView()&&83===e.keyCode?o.toggleFitContent():a.navigation.inDashboardDetailView()&&87===e.keyCode?o.toggleFitWidth():a.navigation.inReportDetailView()&&(37===e.keyCode?a.fullScreen.fullScreenPreviousPage():39===e.keyCode&&a.fullScreen.fullScreenNextPage()))}))};o.toggleFitContent=function(){a.fullScreen.fitStyle=a.fullScreen.fitStyle!==i.FitToContent?i.FitToContent:i.None},o.toggleFitWidth=function(){a.fullScreen.fitStyle=a.fullScreen.fitStyle!==i.FitToWidth?i.FitToWidth:i.None},o.print=function(){return window.print()},o.exitFullScreen=function(){return a.fullScreen.exitFullScreen()},o.fullScreen=a.fullScreen,o.navigation=a.navigation;var d=a.fullScreen,p=function(){d.fullScreenMode?(c(),$(document).on("mousemove",c),$(document).on("keydown",l)):($(document).off("mousemove",c),$(document).off("keydown",l))};p();var u={onFitStyleChanged:_.noop,onFullScreenModeChanged:p};d.subscribe(u),o.$on(e.common.constants.scopeDestroyEventName,(function(){$(document).off("mousemove",c),$(document).off("keydown",l),d.unsubscribe(u)}))},this.fullScreen=o,this.navigation=r}return t.TransitioningCSSClass="transitioning",t.ControlDisplayTimeInMs=1500,t})();t.FullScreenControls=o})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/manageEmbedView.html",this.replace=!0,this.controller=e.common.createController(e.controllers.ManageEmbedView)}return t})();t.ManageEmbedView=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.templateUrl="views/qna/qnaContainer.html",this.replace=!0,this.scope={viewModel:"=",collapsiblePaneMode:"="},this.controller=e.common.createController(e.controllers.QnaContainerController)}return t})();t.QnaContainer=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.contract=e}return e})();e.QnaContainer=t})(t=e.models||(e.models={}))})(powerbi||(powerbi={})),angular.module("powerbi").run(["$templateCache",function(e){e.put("components/appActionMenu/appActionMenu.html",'<section class="appActionMenuWrapper" ng-style="::{\'background-color\': $ctrl.currentInstalledApp.headerBackgroundColor, \'color\': $ctrl.getHeaderFontColor()}"><span ng-switch="$ctrl.canFavoriteApp"><pbi-icon name="favoritestar" size="small" ng-switch-when="true" ng-click="$ctrl.toggleFavoriteApp()" localize-tooltip="App_Favorite"></pbi-icon><pbi-icon name="favoritefilled" size="small" ng-switch-when="false" ng-click="$ctrl.toggleFavoriteApp()" localize-tooltip="App_Unfavorite"></pbi-icon></span><pbi-icon name="edit" size="small" ng-if="::$ctrl.canEditApp" ng-click="$ctrl.editApp()" localize-tooltip="AppModel_Edit"></pbi-icon><pbi-icon name="bulletedlist" size="small" ng-click="$ctrl.navigateToApp()" localize-tooltip="AppHeader_Index_Title"></pbi-icon></section>'),e.put("components/appArtifactsList/appArtifactsList.html",'<section class="artifactsScrollSection" vs-repeat><div class="itemContainer" ng-repeat="artifact in $ctrl.artifacts track by artifact.uniqueId" ng-if="$ctrl.canShowTile(artifact)"><div ng-if="::$ctrl.isSectionTile(artifact)"><section class="typeTitle" ng-click="$ctrl.toggle(artifact)"><i class="caret glyphicon pbi-glyph-caretright glyph-mini smallFontSize" ng-class="{expanded : artifact.expanded}"/><span class="unselectable" localize="{{::artifact.title}}"></span></section><section ng-if="artifact.expanded" class="unselectable artifactsHeader"><header class="name trimmedTextWithEllipsis unselectable" localize="ContentHeader_Name"></header><header class="actions trimmedTextWithEllipsis unselectable" ng-class="::{noClassification: !artifact.isDataClassificationEnabled}" localize="ContentHeader_Actions"></header><header ng-if="::artifact.isDataClassificationEnabled" class="classification" localize="ContentHeader_Classification"></header></section></div><section class="artifact" ng-if="::!$ctrl.isSectionTile(artifact)"><section class="icons"><span class="tileTypeIndicator glyphicon glyph-small {{::$ctrl.getClassName(artifact)}}"></span></section><section class="name" ng-class="{clickable: $ctrl.canOpenTile(artifact) }" ng-click="$ctrl.openContentTile(artifact)"><span class="displayName trimmedTextWithEllipsis" ng-bind="::artifact.displayName" title="{{::artifact.displayName}}"></span><pbi-icon ng-if="::$ctrl.isNew(artifact)" name="asterisk" size="mini"></pbi-icon></section><content-tile-options-menu class="actions unselectable" ng-class="::{readOnly: !$ctrl.canShowOptionsMenu(artifact), noClassification: !$ctrl.isDataClassificationEnabled(artifact)}" view-model="::artifact" in-list-view="true"></content-tile-options-menu><data-classification-label ng-if="::$ctrl.isDataClassificationEnabled(artifact)" class="classification unselectable" data-classification-id="artifact.dataClassificationId"></data-classification-label></section></div></section>'),e.put("components/appChannelHeader/appChannelHeader.html",'<header class="channelHeader" ng-style="{\'background-color\': $ctrl.viewModel.headerBackgroundColor, \'color\': $ctrl.getHeaderFontColor()}"><app-logo view-model="::$ctrl.viewModel" size="small"></app-logo><pbi-icon class="actionIcon" name="favoritestar" ng-if="$ctrl.canFavorite()" size="small" localize-tooltip="Artifact_Favorite" ng-click="$ctrl.favoriteApp()"></pbi-icon><pbi-icon class="actionIcon toggledIcon" name="favoritefilled" ng-if="$ctrl.canUnFavorite()" size="small" localize-tooltip="ContentListMenu_RemoveFavorite" ng-click="$ctrl.unfavoriteApp()"></pbi-icon><h6 class="header trimmedTextWithEllipsis unselectable" bind-text-and-tooltip="$ctrl.getAppTitle()"></h6><span class="description trimmedTextWithEllipsis" bind-text-and-tooltip="$ctrl.viewModel.description"></span><aside class="status"><div class="details" title="{{$ctrl.getArtifactCountTooltip(4)}}"><pbi-icon name="gauge" size="small"></pbi-icon><span class="countLabel" bind-text-and-tooltip="$ctrl.dashboards.length.toString()"></span></div><div class="details" title="{{$ctrl.getArtifactCountTooltip(2)}}"><pbi-icon name="barchart" size="small"></pbi-icon><span class="countLabel" bind-text-and-tooltip="$ctrl.reports.length.toString()"></span></div><div class="details" title="{{$ctrl.getArtifactCountTooltip(8)}}"><pbi-icon name="excel" size="small"></pbi-icon><span class="countLabel" bind-text-and-tooltip="$ctrl.workbooks.length.toString()"></span></div><div class="details" title="{{$ctrl.getArtifactCountTooltip(512)}}"><pbi-icon name="database" size="small"></pbi-icon><span class="countLabel" bind-text-and-tooltip="$ctrl.datasets.length.toString()"></span></div><div class="details editApp" ng-if="::$ctrl.canEditApp" ng-click="$ctrl.editApp()" localize-tooltip="AppModel_Edit"><pbi-icon name="edit" size="small"></pbi-icon><span class="countLabel" localize="AppModel_Edit"></span></div></aside></header>'),e.put("components/appContainer/appContainer.html",'<app-channel-header view-model="::$ctrl.installedApp" ng-if="::$ctrl.installedApp"></app-channel-header><pbi-data-loader-spinner class="centered" ng-if="!$ctrl.installedApp"></pbi-data-loader-spinner><app-artifacts-list ng-if="$ctrl.artifactList && $ctrl.inAppArtifactsListView()" class="appContent" view-model="::$ctrl.artifactList"></app-artifacts-list>'),e.put("components/appLogo/appLogo.html",'<section class="container {{::$ctrl.size}}" ng-switch="$ctrl.hasAppLogoImage()"><span ng-switch-when="true" class="imageLogo" ng-style="{\'background-image\': $ctrl.getAppLogoImageUrlStyle(), \'background-color\': $ctrl.viewModel.iconBackgroundColor}"></span><pbi-icon ng-switch-when="false" class="iconLogo" name="{{$ctrl.viewModel.icon}}" ng-style="{\'color\': $ctrl.viewModel.iconColor, \'background-color\': $ctrl.viewModel.iconBackgroundColor}" size="{{::$ctrl.size}}"></pbi-icon></section>'),e.put("components/appPlaceholder/appPlaceholder.html","<loading-watermark></loading-watermark>"),e.put("components/appsContainer/appsContainer.html",'<div class="mainContent"><div class="dashboardControls"><search-box should-focus="true" on-change="$ctrl.onSearchTextChange()" on-blur="$ctrl.resolveSearchTelemetry()" filter="$ctrl.searchText" placeholder="SearchContent"></search-box><pbi-button ng-click="$ctrl.getApps()" primary="primary" label="Get_App_Label" localize-tooltip="Get_App_Tooltip" ng-if="$ctrl.hasApps"></pbi-button></div><div class="dashboardSliderMain" feature-switch-class="breadcrumbNavigationEnabled" ng-class="::{hasTopBar: !$ctrl.hasSufficientLicense()}"><pbi-data-loader-spinner class="centered" ng-if="!$ctrl.isLoaded"></pbi-data-loader-spinner><water-mark-message ng-if="$ctrl.showWatermarkConfig" config="$ctrl.watermarkConfig"></water-mark-message><div class="galleryContainer appsGallery" feature-switch-class="breadcrumbNavigationEnabled" ng-if="$ctrl.isLoaded && !$ctrl.showWatermarkConfig"><content-tile-container tiles="::$ctrl.filteredProviders" place-holder-tile="::$ctrl.getAppTile" disable-lazy-loading="true" collapsible-pane-mode="false"></content-tile-container></div></div></div>'),e.put("components/authoringDropDownMenu/authoringDropDownMenu.html",'<li class="authoringDropDown" ng-if="$ctrl.shouldShowAuthoringDropDown()" ng-click="$ctrl.showMenu($event, $ctrl.getAuthoringMenuProperties)" title="{{$ctrl.getSelectedItem().tooltip}}"><span ng-if="$ctrl.shouldShowNewTilesCounter()" class="numberOfNewTilesBadge" ng-bind="$ctrl.numberOfNewTiles()"></span><i class="{{$ctrl.getSelectedItem().iconClass}} glyph-small"></i><span class="appBarMenuItem" ng-bind="$ctrl.getSelectedItem().text"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini anchorElementForAuthoring"></i></li>'),e.put("components/breadcrumbs/breadcrumb.html",'<pbi-icon ng-if="::breadcrumb.beforeIcon && !breadcrumb.group" name="{{::breadcrumb.beforeIcon}}" size="{{::breadcrumb.beforeIconSize}}" class="breadcrumbBeforeIcon"></pbi-icon><group-icon ng-if="::breadcrumb.entity && breadcrumb.entity.aadGroupId && !breadcrumb.icon" group="breadcrumb.entity" placeholder-size="small"></group-icon><app-logo ng-if="::breadcrumb.entity && !!breadcrumb.entity.providerKey" view-model="breadcrumb.entity" size="micro"></app-logo><span ng-bind="breadcrumb.label"></span><pbi-icon ng-if="::breadcrumb.afterIcon && !breadcrumb.group" name="{{::breadcrumb.afterIcon}}" size="{{::breadcrumb.afterIconSize}}" class="breadcrumbAfterIcon"></pbi-icon><pbi-icon class="capacity" name="diamond" size="small" ng-if="breadcrumb.entity.capacity" tooltip tooltip-config="{tooltipLocalizeDescription: \'Capacity_Icon_Tooltop\', tooltipArrowPosition: 1}"></pbi-icon>'),e.put("components/breadcrumbs/breadcrumbLabel.html",'<span class="breadcrumb" tooltip tooltip-config="breadcrumb.tooltipConfig"><ng-include src="::\'components/breadcrumbs/breadcrumb.html\'"></ng-include></span>'),e.put("components/breadcrumbs/breadcrumbLink.html",'<a class="breadcrumb" ui-sref="{{::breadcrumb.uiSref}}" ui-sref-opts="{{::breadcrumb.stateOptions}}" tooltip tooltip-config="breadcrumb.tooltipTemplateConfig" ng-click="$ctrl.logTelemetry(breadcrumb.state)"><ng-include src="::\'components/breadcrumbs/breadcrumb.html\'"></ng-include></a>'),e.put("components/breadcrumbs/breadcrumbs.html",'<pbi-icon ng-repeat-start="breadcrumb in $ctrl.breadcrumbs | filter: $ctrl.breadcrumbFilter" ng-if="!$first" name="chevronrightmedium" size="mini"></pbi-icon><ng-include class="{{::breadcrumb.customClass}}" src="$ctrl.getTemplate(breadcrumb, $last)"></ng-include><data-classification-label ng-repeat-end ng-if="::breadcrumb.entity && (breadcrumb.entity.dataClassificationId || breadcrumb.entity.dataClassificationId === 0)" data-classification-id="::breadcrumb.entity.dataClassificationId"></data-classification-label>'),e.put("components/contentDatasetActions/contentDatasetActions.html",'<section class="datacell optionsCell" ng-class="{\'publishing\': $ctrl.isPackagePublishInProgress()}"><section ng-if="::!$ctrl.streamingDataset"> <button class="createReport pbi-glyph-create-report" localize-tooltip="DashboardContextMenu_CreateReport" ng-if="::$ctrl.canCreateReport()" ng-click="$ctrl.createReport()"></button> <button class="refreshNow pbi-glyph-refresh" localize-tooltip="ContentTileOptions_RefreshNow" ng-if="::$ctrl.canRefreshNow()" ng-click="$ctrl.refreshNow()"></button> <button class="scheduleRefresh pbi-glyph-refresh-data" localize-tooltip="ContentTileOptions_ScheduleRefresh" ng-if="::$ctrl.canScheduleRefresh()" ng-click="$ctrl.refreshSchedule()"></button> <button class="viewRelated pbi-glyph-relationship" localize-tooltip="DashboardAppBar_ViewRelated" ng-if="::$ctrl.viewRelatedEnabled" ng-click="$ctrl.viewRelatedContent()"></button> <button class="moreButton pbi-glyph-more" ng-click="$ctrl.showOptions(); $event.stopPropagation();" dropdown-overlay-invoke="{{::$ctrl.rowId}}" prefer-left="true" need-blur="true" disable-animation="true" localize-tooltip="Options_Menu"></button></section><section ng-if="::$ctrl.streamingDataset" class="actionContents"> <button class="glyphicon glyph-small actionIcon {{::action.iconClass}}" ng-repeat="action in $ctrl.getStreamingDatasetActions() track by action.action" ng-click="$ctrl.streamingDatasetActionSelected(action)" ng-attr-title="{{::action.text}}"></button></section><dropdown-overlay ng-if="$ctrl.menuSelected" dropdown-overlay-name="{{::$ctrl.rowId}}"><ul class="angular-dropdown active datasetActionList"><li ng-repeat="item in $ctrl.datasetMenuActions" class="dropdown-item" ng-mousedown="$ctrl.datasetMenuActionSelected(item); $event.stopPropagation();"><a href="" target="_blank"><div class="dropdown-content"><div class="dropdown-label" ng-bind="::item.text"></div></div></a></li></ul></dropdown-overlay></section>'),e.put("components/contentHeader/contentHeader.html",'<header class="name" localize="ContentHeader_Name"></header><header class="actions" localize="ContentHeader_Actions"></header><header ng-if="$ctrl.showSharedTime()" class="sharedTime" localize="ContentHeader_SharedTime"></header><header ng-if="$ctrl.showOwner()" class="owner" localize="ContentHeader_Owner"></header><div ng-if="$ctrl.showRecentlyUsedInfo()"><header class="lastAccess" localize="ContentHeader_LastAccess"></header><header class="location" localize="ContentHeader_Location"></header></div><header ng-if="$ctrl.showClassification()" class="classification" localize="ContentHeader_Classification"></header><div ng-if="$ctrl.showRefreshInfo()"><header class="lastRefresh" localize="ContentHeader_LastRefresh"></header><header class="nextRefresh" localize="ContentHeader_NextRefresh"></header><header class="apiAccess" localize="ContentHeader_ApiAccess"></header></div>'),e.put("components/contentListContainerV2/contentListContainerV2.html",'<div class="contentListView" ng-class="{\'initializing\': !$ctrl.initialized, \'onlySharedWithMe\': $ctrl.isOnlySharedWithMe()}"><introduce-app-bar ng-if="$ctrl.shouldDisplayIntroduceAppBar" config="::$ctrl.introduceAppBarConfig"></introduce-app-bar><div class="header"><div class="dashboardAppBar"><div ng-hide="$ctrl.groupService.activeGroup.isMyWorkspace || $ctrl.groupService.isInGroupTransition"><group-actions group="$ctrl.groupService.activeGroup" dropdown-orientation="vertical" allow-unpublish-app="true" unpublish-app-in-progress="$ctrl.unpublishAppInProgress"></group-actions><pbi-button ng-if="$ctrl.shouldDisplayAppBtn" class="publishAppBtn appBarBtn" primary="true" localize-tooltip="{{::$ctrl.appBtnResourceKey}}" label="{{::$ctrl.appBtnResourceKey}}" icon-name="my-apps" ng-click="$ctrl.addChannel()" ng-disabled="$ctrl.unpublishAppInProgress"></pbi-button></div> <button ng-if="!$ctrl.isActiveWorkspaceReadOnly" class="createButton dropDownBtn appBarBtn" localize-tooltip="Create_ButtonText" ng-click="$ctrl.showCreateDropdownMenu($event)"><pbi-icon name="add" size="small"></pbi-icon><span class="label" localize="Create_ButtonText"></span></button></div></div><div class="dashboardControls"><search-box should-focus="::true" on-change="$ctrl.onSearchTextChange()" on-blur="$ctrl.resolveSearchTelemetry()" filter="$ctrl.searchText" placeholder="SearchContent"></search-box></div><div class="contentListOptionsTabs unselectable"><div class="left" role="tablist"><div class="optionTab dashboard label-med" ng-class="{selected: $ctrl.activeTab === 0}" ng-click="$ctrl.setActiveTab(0)" localize="ContentList_Dashboards" role="tab"></div><div class="optionTab report label-med" ng-class="{selected: $ctrl.activeTab === 2}" ng-click="$ctrl.setActiveTab(2)" localize="ContentList_Reports" role="tab"></div><div class="optionTab workbook label-med" ng-class="{selected: $ctrl.activeTab === 4}" ng-click="$ctrl.setActiveTab(4)" localize="ContentList_Workbooks" role="tab"></div><div class="optionTab dataset label-med" ng-if="$ctrl.canManageDatasets" ng-class="{selected: $ctrl.activeTab === 8}" ng-click="$ctrl.setActiveTab(8)" localize="ContentList_Datasets" role="tab"></div></div><div class="right"><span class="count" localize="ShowingXItems" localize-fragments><span fragment-index="0" ng-bind="$ctrl.getNumberOfShownTabItems()"></span></span><select-tile-sort selected-predicate="$ctrl.sortPredicate" on-select="$ctrl.selectSort" predicates="$ctrl.sortPredicates"></select-tile-sort></div></div><div class="dashboardSliderMain" ng-class="{hasIntroduceAppBar: $ctrl.shouldDisplayIntroduceAppBar}"><spinner ng-show="$ctrl.showSpinner" class="large centered"></spinner><water-mark-message config="$ctrl.getWatermarkConfig()" ng-show="$ctrl.getWatermarkConfig()"></water-mark-message><content-list-gallery view-model="::$ctrl.galleryViewModel"></content-list-gallery></div></div>'),e.put("components/contentListGallery/contentListGallery.html",'<div class="galleryContainer" ng-class="$ctrl.galleryContainerStyle"><content-header class="unselectable" tab-type="$ctrl.viewModel.tabType"></content-header><div class="contentScrollSectionContainer"><div class="contentScrollSection" vs-repeat ng-class="{isContentTileContentDisabled: $ctrl.viewModel.collapsiblePaneMode !== 0}"><content-row ng-repeat="tile in $ctrl.viewModel.getTiles() track by tile.uniqueId" view-model="tile" tab-type="$ctrl.viewModel.tabType" ng-repeat-finish-event="{{::$ctrl.viewModel.finishLoadEvent}}"></content-row></div></div></div>'),e.put("components/contentRow/contentRow.html",'<section class="galleryItem" ng-switch="::$ctrl.tabType" ng-class="{selected: $ctrl.viewModel.isContentTileSelected, publishing: $ctrl.publishInProgress()}" data-id="{{::$ctrl.viewModel.id}}" data-name="{{::$ctrl.viewModel.displayName}}"><section class="galleryItemContainer" ng-switch-when="0"><section class="nameDetails"><span class="tileTypeIndicator glyphicon glyph-small" ng-class="::$ctrl.getGlyphClass()" localize-tooltip="{{::$ctrl.getTitleTooltip()}}"></span><header class="favoriteIndicator"><span ng-if="$ctrl.canFavorite()" class="favoriteBtn pbi-glyph-favoritestar" localize-tooltip="Artifact_Favorite" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.favoriteContentTile()"></span><span ng-if="$ctrl.canUnFavorite()" class="unfavoriteBtn powervisuals-glyph star-full" localize-tooltip="Artifact_Favorite" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.unfavoriteContentTile()"></span></header><header class="galleryItemTitle trimmedTextWithEllipsis" title="{{$ctrl.viewModel.displayName}}" ng-click="$ctrl.openContentTile()"><span ng-bind="$ctrl.viewModel.displayName"></span><pbi-icon ng-if="::$ctrl.isNew()" name="asterisk" size="mini"></pbi-icon></header></section><content-tile-options-menu class="tileOptions unselectable" ng-class="{readOnly: !$ctrl.canShowOptionsMenu()}" view-model="::$ctrl.viewModel" in-list-view="true"></content-tile-options-menu><header class="authorName trimmedTextWithEllipsis" ng-bind="::$ctrl.getOwnerNameOrMailForDashboard()" title="{{::$ctrl.getOwnerNameOrMailForDashboard()}}"></header><header class="classification unselectable"><data-classification-label data-classification-id="$ctrl.viewModel.dataClassificationId"></data-classification-label></header></section><section class="galleryItemContainer" ng-if="::$ctrl.isWorkbookOrReport()"><section class="nameDetails"><span class="tileTypeIndicator glyphicon glyph-small" ng-class="::$ctrl.getGlyphClass()" localize-tooltip="{{::$ctrl.getTitleTooltip()}}"></span><header class="galleryItemTitle trimmedTextWithEllipsis" title="{{$ctrl.viewModel.displayName}}" ng-click="$ctrl.openContentTile()"><span ng-bind="$ctrl.viewModel.displayName"></span><pbi-icon ng-if="::$ctrl.isNew()" name="asterisk" size="mini"></pbi-icon></header><dataset-icon-container view-model="::$ctrl.viewModel" can-show-new="false" refresh-related="::$ctrl.isRefreshRelated()"></dataset-icon-container></section><content-tile-options-menu class="tileOptions unselectable" ng-class="{readOnly: !$ctrl.canShowOptionsMenu()}" view-model="::$ctrl.viewModel" in-list-view="true"></content-tile-options-menu><header class="authorName trimmedTextWithEllipsis" ng-bind="::$ctrl.viewModel.ownerFullname" title="{{::$ctrl.viewModel.ownerFullname}}"></header></section><section class="galleryItemContainer" ng-switch-when="8"><section class="nameDetails"><span class="tileTypeIndicator glyphicon pbi-glyph-database glyph-small" localize-tooltip="Artifact_Dataset"></span><header class="galleryItemTitle trimmedTextWithEllipsis" title="{{$ctrl.viewModel.displayName}}" ng-click="$ctrl.openContentTile()"><span ng-bind="$ctrl.viewModel.displayName"></span><pbi-icon ng-if="::$ctrl.isNew()" name="asterisk" size="mini"></pbi-icon></header></section><header class="tileOptions unselectable"><content-dataset-actions view-model="::$ctrl.viewModel" can-show-new="false" streaming-dataset="$ctrl.streamingDataset"></content-dataset-actions></header><dataset-icon-container view-model="::$ctrl.viewModel" can-show-new="false" refresh-related="true"></dataset-icon-container><header class="lastRefresh trimmedTextWithEllipsis" ng-bind="$ctrl.convertRefreshTimeToLocaleString($ctrl.viewModel.contract.lastRefreshTime) | date:\'h:mm a MM.dd.yyyy\'"></header><header class="nextRefresh trimmedTextWithEllipsis" ng-bind="$ctrl.convertRefreshTimeToLocaleString($ctrl.viewModel.contract.nextRefreshTime, $ctrl.viewModel.contract.refreshSchedule.refreshEnabled) | date:\'h:mm a MM.dd.yyyy\'"></header><header class="apiAccess trimmedTextWithEllipsis" ng-bind="::$ctrl.apiAccessType" title="{{::$ctrl.apiAccessType}}"></header></section><section class="galleryItemContainer" ng-switch-when="16" ng-init="$ctrl.initializeMruRow()"><section class="nameDetails"><span class="tileTypeIndicator glyphicon glyph-small" ng-class="::$ctrl.getGlyphClass()" localize-tooltip="{{::$ctrl.getTitleTooltip()}}"></span><header class="favoriteIndicator" ng-if="$ctrl.isItemAvailable"><span ng-if="$ctrl.canFavorite()" class="favoriteBtn pbi-glyph-favoritestar" localize-tooltip="Artifact_Favorite" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.favoriteContentTile()"></span><span ng-if="$ctrl.canUnFavorite()" class="unfavoriteBtn powervisuals-glyph star-full" localize-tooltip="ContentListMenu_RemoveFavorite" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.unfavoriteContentTile()"></span></header> <button class="galleryItemTitle trimmedTextWithEllipsis" title="{{::$ctrl.viewModel.displayName}}" ng-click="$ctrl.openContentTile()" ng-class="{\'notAvailable\': !$ctrl.isItemAvailable}"><span ng-bind="$ctrl.viewModel.displayName"></span><pbi-icon ng-if="::$ctrl.isNew()" name="asterisk" size="mini"></pbi-icon><pbi-icon class="capacity" ng-if="$ctrl.hasCapacity()" name="diamond" size="mini"></pbi-icon></button></section><header class="tileOptions unselectable" ng-class="{\'readOnly\': !$ctrl.isItemAvailable}"><content-tile-options-menu view-model="::$ctrl.getOriginalContentTileOrViewModel()" delete-enabled="false" in-list-view="true"></content-tile-options-menu></header><header class="lastAccess trimmedTextWithEllipsis" ng-bind="::$ctrl.getPrettyDate($ctrl.viewModel.lastAccess)"></header> <button class="location" ng-click="$ctrl.navigateToGroup()"><header class="locationName trimmedTextWithEllipsis" title="{{::$ctrl.groupName}}" ng-bind="::$ctrl.groupName"></header></button><header ng-if="::$ctrl.isDataClassified" class="classification unselectable"><data-classification-label data-classification-id="$ctrl.viewModel.dataClassificationId"></data-classification-label></header></section><section class="galleryItemContainer" ng-switch-when="64"><section class="nameDetails"><span class="tileTypeIndicator glyphicon glyph-small" ng-class="::$ctrl.getGlyphClass()" localize-tooltip="{{::$ctrl.getTitleTooltip()}}"></span><header class="favoriteIndicator"><span ng-if="$ctrl.canFavorite()" class="favoriteBtn pbi-glyph-favoritestar" localize-tooltip="Artifact_Favorite" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.favoriteContentTile()"></span><span ng-if="$ctrl.canUnFavorite()" class="unfavoriteBtn powervisuals-glyph star-full" localize-tooltip="Artifact_Favorite" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.unfavoriteContentTile()"></span></header><header class="galleryItemTitle trimmedTextWithEllipsis" title="{{$ctrl.viewModel.displayName}}" ng-click="$ctrl.openContentTile()"><span ng-bind="$ctrl.viewModel.displayName"></span><pbi-icon ng-if="::$ctrl.isNew()" name="asterisk" size="mini"></pbi-icon><pbi-icon class="capacity" ng-if="$ctrl.hasCapacity()" name="diamond" size="mini"></pbi-icon></header><dataset-icon-container view-model="::$ctrl.viewModel" can-show-new="false" refresh-related="false"></dataset-icon-container></section><content-tile-options-menu class="tileOptions unselectable" ng-class="{readOnly: !$ctrl.canShowOptionsMenu()}" view-model="::$ctrl.viewModel" in-list-view="true"></content-tile-options-menu><header class="sharedTime trimmedTextWithEllipsis" ng-bind="::$ctrl.getPrettySharedDate($ctrl.viewModel.sharedTime)"></header><section class="authorName"><header ng-if="$ctrl.getOwnerNameOrMailForDashboard()" class="trimmedTextWithEllipsis" ng-bind="::$ctrl.getOwnerNameOrMailForDashboard()" title="{{::$ctrl.getOwnerNameOrMailForDashboard()}}"></header><header ng-if="!$ctrl.getOwnerNameOrMailForDashboard()" localize="SharedWithMe_Owner_Loading" localize-tooltip="SharedWithMe_Owner_Loading"></header></section><header ng-if="::$ctrl.isDataClassified" class="classification unselectable"><data-classification-label data-classification-id="$ctrl.viewModel.dataClassificationId"></data-classification-label></header></section><section class="galleryItemContainer" ng-switch-when="128" ng-init="$ctrl.initializeFavoriteRow()"><section class="nameDetails"><span class="tileTypeIndicator glyphicon glyph-small" ng-class="::$ctrl.getGlyphClass()" localize-tooltip="{{::$ctrl.getTitleTooltip()}}"></span><header class="favoriteIndicator"><span class="unfavoriteBtn powervisuals-glyph star-full" localize-tooltip="ContentListMenu_RemoveFavorite" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.unfavoriteContentTile()"></span></header> <button class="galleryItemTitle trimmedTextWithEllipsis" title="{{::$ctrl.viewModel.displayName}}" ng-click="$ctrl.openContentTile()"><span ng-bind="::$ctrl.viewModel.displayName"></span><pbi-icon class="capacity" ng-if="$ctrl.hasCapacity()" name="diamond" size="mini"></pbi-icon><dataset-icon-container view-model="$ctrl.viewModel" refresh-related="false"></dataset-icon-container></button></section><header class="tileOptions unselectable favoriteOptions"><content-tile-options-menu view-model="::$ctrl.viewModel" in-list-view="true"></content-tile-options-menu></header><header class="location"><span class="locationName trimmedTextWithEllipsis" bind-text-and-tooltip="$ctrl.viewModel.ownerInfo"></span></header><header ng-if="::$ctrl.isDataClassified" class="classification unselectable"><data-classification-label data-classification-id="::$ctrl.viewModel.dataClassificationId"></data-classification-label></header></section></section>'),
e.put("components/contentTile/contentTile.html",'<li class="galleryItem unselectable" ng-class="{\'selected\': $ctrl.viewModel.isContentTileSelected, \'publishing\':$ctrl.publishInProgress()}" data-id="{{::$ctrl.viewModel.id}}" data-content-tile-type="{{$ctrl.getTileTypeName()}}" data-name="{{::$ctrl.viewModel.displayName}}" in-viewport="$ctrl.onceInViewport()" in-viewport-context=".dashboardSliderMain" in-viewport-offset="150%"><div class="galleryTileContainer" ng-switch="$ctrl.viewModel.contentTileType" ng-click="$ctrl.openContentTile()"><div class="backgroundAndContent" ng-switch-when="1" ng-init="$ctrl.viewModel.workspaceId ? $ctrl.setGroupIcon($ctrl.viewModel.workspaceId) : $ctrl.setUserPhoto()"><div class="galleryBackground" ng-switch="$ctrl.viewModel.favoriteType"><div class="dashboardFavorite" ng-switch-when="1"><i class="glyphicon dashboardWatermarkIcon pbi-glyph-gauge glyph-large"></i><div class="galleryIcons"><i class="glyphicon pbi-glyph-gauge glyph-med" title="{{::$ctrl.dashboardTitle}}"></i></div></div><div class="reportFavorite" ng-switch-when="2"><i class="glyphicon reportWatermarkIcon pbi-glyph-barchart glyph-large"></i><div class="galleryIcons"><i class="glyphicon pbi-glyph-barchart glyph-large"></i></div></div></div><div class="iconsContainer"><div ng-if="!$ctrl.isMyWorkspace" class="owner" ng-switch="$ctrl.hasGroupIconSet" title="{{::$ctrl.groupName}}"><i ng-switch-when="false" class="glyphicon pbi-glyph-group glyph-med groupIcon placeholder"></i> <img class="groupIcon" ng-switch-when="true" ng-src="{{$ctrl.groupIcon}}"/></div><div ng-if="$ctrl.isMyWorkspace" ng-switch="$ctrl.hasUserIconSet" title="{{::$ctrl.groupName}}"><i ng-switch-when="false" class="glyphicon pbi-glyph-user glyph-med groupIcon placeholder"></i><div ng-switch-when="true" class="userIcon" ng-style="{\'background-image\': $ctrl.userIcon}"/></div><data-classification-label data-classification-id="$ctrl.viewModel.dataClassificationId"></data-classification-label></div><div class="content"><div class="titleAndIndicator"><dataset-icon-container view-model="$ctrl.viewModel" refresh-related="false"></dataset-icon-container><div class="galleryItemTitle trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.displayName" ng-attr-title="{{$ctrl.viewModel.displayName}}"/></div><div class="authorNameFavorite trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.ownerInfo" ng-attr-title="{{$ctrl.viewModel.ownerInfo}}"/></div></div><div class="backgroundAndContent" ng-switch-when="4"><div class="galleryBackground"><i class="glyphicon dashboardWatermarkIcon pbi-glyph-gauge glyph-large"></i><div class="galleryIcons"><i class="glyphicon pbi-glyph-gauge glyph-large"></i></div></div><div class="iconsContainer"><div ng-if="$ctrl.hasOwnerPhoto && $ctrl.inViewport" ng-switch="$ctrl.hasOwnerPhotoSet"><i ng-switch-when="false" class="glyphicon pbi-glyph-user glyph-med groupIcon placeholder"></i> <img ng-switch-when="true" class="userIcon" ng-src="{{$ctrl.ownerIcon}}"/></div><data-classification-label ng-if="$ctrl.inViewport" data-classification-id="$ctrl.viewModel.dataClassificationId"></data-classification-label></div><div class="content"><div class="titleAndIndicator"><dataset-icon-container ng-if="$ctrl.inViewport" view-model="$ctrl.viewModel" refresh-related="false"></dataset-icon-container><div class="galleryItemTitle trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.displayName" ng-attr-title="{{$ctrl.viewModel.displayName}}"/></div><div class="authorName trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.ownerFullname" ng-attr-title="{{$ctrl.viewModel.ownerFullname}}"/></div></div><div class="backgroundAndContent" ng-switch-when="2"><div class="galleryBackground"><i class="glyphicon reportWatermarkIcon pbi-glyph-barchart glyph-large"></i><div class="galleryIcons"><i class="glyphicon pbi-glyph-barchart glyph-large"></i></div></div><div class="content"><div class="titleAndIndicator"><dataset-icon-container ng-if="$ctrl.inViewport" view-model="$ctrl.viewModel" refresh-related="false"></dataset-icon-container><div class="galleryItemTitle trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.displayName" ng-attr-title="{{$ctrl.viewModel.displayName}}"/></div><div class="authorName trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.ownerFullname" ng-attr-title="{{$ctrl.viewModel.ownerFullname}}"/></div></div><div class="backgroundAndContent" ng-switch-when="8"><div class="galleryBackground"><i class="glyphicon workbookWatermarkIcon pbi-glyph-excel glyph-large"></i><div class="galleryIcons"><i class="glyphicon pbi-glyph-excel glyph-large"></i></div></div><div class="content"><div class="titleAndIndicator"><dataset-icon-container ng-if="$ctrl.inViewport" view-model="$ctrl.viewModel" refresh-related="false"></dataset-icon-container><dataset-icon-container ng-if="$ctrl.inViewport" view-model="$ctrl.viewModel" refresh-related="true"></dataset-icon-container><div class="galleryItemTitle trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.displayName" ng-attr-title="{{$ctrl.viewModel.displayName}}"/></div><div class="authorName trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.ownerFullname" ng-attr-title="{{$ctrl.viewModel.ownerFullname}}"/></div></div><div class="backgroundAndContent" ng-switch-when="16"><section class="galleryBackground"><app-logo view-model="::$ctrl.viewModel" size="large"></app-logo></section><section class="titleAndIndicator"><pbi-icon ng-if="::$ctrl.hasCapacity()" name="diamond" size="small" tooltip tooltip-config="{tooltipLocalizeDescription: \'Capacity_Icon_Tooltop\', tooltipArrowPosition: 1}"></pbi-icon><h1 class="trimmedTextWithEllipsis unselectable" bind-text-and-tooltip="::$ctrl.viewModel.displayName" ng-class="::{isPremium: $ctrl.hasCapacity()}"/><h2 class="trimmedTextWithEllipsis unselectable" bind-text-and-tooltip="::$ctrl.viewModel.displayDate"/></section><section class="appActions"><header class="trimmedTextWithEllipsis" bind-text-and-tooltip="::$ctrl.viewModel.author"/><content-tile-options-menu view-model="::$ctrl.viewModel"></content-tile-options-menu></section></div><div class="backgroundAndContent placeHolderBorder" ng-switch-when="1024" ng-attr-title="{{::$ctrl.viewModel.description}}"><section class="placeHolderGalleryBackground"><pbi-icon class="addApp" name="my-apps" size="large"></pbi-icon></section><h1 class="placeHolderTitle" bind-text-and-tooltip="::$ctrl.viewModel.displayName"></h1></div><div class="backgroundAndContent" ng-switch-when="256"><div class="galleryBackground"><group-icon group="::$ctrl.viewModel" placeholder-size="large"></group-icon></div><section class="titleAndIndicator"><h1 class="trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.displayName"/><h2 class="trimmedTextWithEllipsis unselectable" ng-bind="::$ctrl.getOwnershipTextForWorkspace()"/></section><section class="contentDetails" ng-if="!$ctrl.isTileActionsVisible"><h1 class="trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.displayName" title="{{$ctrl.viewModel.displayName}}"/><h2 class="trimmedTextWithEllipsis unselectable" ng-bind="::$ctrl.getOwnershipTextForWorkspace()"/><h3 class="trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.getGroupTypeTextForWorkspace()"/><h3 class="trimmedTextWithEllipsis unselectable" ng-if="::$ctrl.viewModel.contract.isReadOnly" localize="ContentList_Workspaces_ReadOnly"/><pbi-icon class="upperRight" ng-click="$ctrl.toggleTileActionsVisibility($event)" name="more" size="small"></pbi-icon></section><section class="contentActions" ng-if="$ctrl.isTileActionsVisible"><h1 class="trimmedTextWithEllipsis unselectable" ng-bind="$ctrl.viewModel.displayName" title="{{$ctrl.viewModel.displayName}}"/><div class="actions"><content-tile-options-menu view-model="::$ctrl.viewModel"></content-tile-options-menu></div><pbi-icon class="upperRight" ng-click="$ctrl.toggleTileActionsVisibility($event)" name="close" size="mini"></pbi-icon></section></div><div class="tileOptions trimmedTextWithEllipsis unselectable" ng-if="$ctrl.viewModel.contentTileType !== 16 && $ctrl.viewModel.contentTileType !== 256 && $ctrl.inViewport" ng-class="{\'readOnly\': !$ctrl.canShowOptionsMenu()}"><content-tile-options-menu view-model="$ctrl.viewModel"></content-tile-options-menu></div></div></li>'),e.put("components/contentTileContainer/contentTileContainer.html",'<div class="contentSection" ng-class="{isContentTileContentDisabled: $ctrl.collapsiblePaneMode !== 0}"><div class="mainContentHeader"><div class="galleryTitle" ng-transclude="title"></div></div> <button class="addButton" ng-click="$ctrl.activeAddDashboard()" localize-tooltip="NavigationPane_CreateDashboard" ng-show="$ctrl.showAddDashboardBtn"><i class="glyphicon pbi-glyph-add"></i></button><div class="contentScrollSection"><ul class="galleryList noselect"><content-tile ng-repeat="tile in $ctrl.getTiles() track by tile.uniqueId" view-model="tile" disable-lazy-loading="$ctrl.disableLazyLoading" ng-repeat-finish-event="{{::$ctrl.finishLoadEvent}}"></content-tile><content-tile ng-if="::$ctrl.placeHolderTile" disable-lazy-loading="false" view-model="::$ctrl.placeHolderTile"></content-tile></ul></div></div>'),e.put("components/contentTileOptionsMenu/contentTileOptionsMenu.html",'<section ng-switch="$ctrl.tileType" ng-init="$ctrl.canShare($ctrl.viewModel, $ctrl.tileType)"><section class="tileMenu" onclick="event.stopPropagation();" ng-switch-when="1"><div class="shareBtn pbi-glyph-share" localize-tooltip="ContentListMenu_Share" ng-if="::$ctrl.canShareTile" ng-click="$ctrl.shareContentTile($ctrl.viewModel, $ctrl.tileType)"></div><pbi-icon name="edit" size="small" localize-tooltip="Edit_ToolTip" ng-if="::$ctrl.canEditApp" ng-click="$ctrl.editApp()"></pbi-icon></section><section class="tileMenu" onclick="event.stopPropagation();" ng-switch-when="2"><div class="actionIcon usageMetricsReportBtn pbi-glyph-chart" localize-tooltip="UsageMetrics_Tooltip" ng-if="::$ctrl.canOpenUsageMetricsReport($ctrl.tileType)" ng-click="$ctrl.openUsageMetricsReport($ctrl.tileType)"></div><div class="actionIcon shareBtn pbi-glyph-share" localize-tooltip="ContentListMenu_Share" ng-if="::$ctrl.canShareReport()" ng-click="$ctrl.shareReport($ctrl.viewModel, $ctrl.tileType)"></div><div class="actionIcon personalizeBtn pbi-glyph-contentviewicon" localize-tooltip="ContentTileOptions_Personalize" ng-if="::$ctrl.canPersonalize()" ng-click="$ctrl.personalize()"></div><div class="actionIcon analyzeInExcel pbi-glyph-excel" localize-tooltip="ContentTileOptions_AnalyzeInExcel" ng-if="::$ctrl.canAnalyzeInExcel()" ng-click="$ctrl.analyzeInExcel()"></div><div class="actionIcon insightsBtn pbi-glyph-insight" localize-tooltip="GetQuickInsights" ng-if="::$ctrl.canRunInsights()" ng-click="$ctrl.runInsights()"></div><div class="actionIcon viewRelatedContentBtn pbi-glyph-relationship" localize-tooltip="DashboardAppBar_ViewRelated" ng-if="::$ctrl.viewRelated" ng-click="$ctrl.viewRelatedContent()"></div><div class="actionIcon powerPointBtn pbi-glyph-powerpoint" localize-tooltip="ContentTileOptions_ExportPowerPoint" ng-if="::$ctrl.canExportPowerPoint($ctrl.tileType)" ng-click="$ctrl.exportToPowerPoint($ctrl.tileType)"></div><div class="actionIcon renameBtn pbi-glyph-settings" localize-tooltip="ContentTileOptions_Settings" ng-if="::$ctrl.canRewrite($ctrl.viewModel.getPermissions())" ng-click="$ctrl.contentTileRename($ctrl.tileType)"></div><div class="actionIcon removeBtn pbi-glyph-delete" localize-tooltip="ContentTileOptions_Delete" ng-if="::$ctrl.deleteEnabled" ng-click="$ctrl.deleteContentTile($ctrl.tileType)"></div></section><section class="tileMenu" onclick="event.stopPropagation();" ng-switch-when="4"><div class="actionIcon usageMetricsReportBtn pbi-glyph-chart" localize-tooltip="UsageMetrics_Tooltip" ng-if="::$ctrl.canOpenUsageMetricsReport($ctrl.tileType)" ng-click="$ctrl.openUsageMetricsReport($ctrl.tileType)"></div><div class="actionIcon personalizeBtn pbi-glyph-contentviewicon" localize-tooltip="ContentTileOptions_Personalize" ng-if="::$ctrl.canPersonalize()" ng-click="$ctrl.personalize()"></div><div class="actionIcon shareBtn pbi-glyph-share" localize-tooltip="ContentListMenu_Share" ng-if="::$ctrl.canShareTile" ng-click="$ctrl.shareContentTile($ctrl.viewModel, $ctrl.tileType)"></div><div class="actionIcon exportBtn pbi-glyph-export" ng-if="::$ctrl.isExportAllowed($ctrl.tileType)" ng-click="$ctrl.exportDashboard()"></div><div class="actionIcon viewRelatedContentBtn pbi-glyph-relationship" localize-tooltip="DashboardAppBar_ViewRelated" ng-if="::$ctrl.viewRelated" ng-click="$ctrl.viewRelatedContent()"></div><div class="actionIcon dashboardfavoriteBtn pbi-glyph-favoritestar" localize-tooltip="Artifact_Favorite" ng-if="$ctrl.canFavorite()" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.favoriteContentTile($ctrl.tileType)"></div><div class="actionIcon dashboardUnfavoriteBtn powervisuals-glyph star-full" localize-tooltip="ContentListMenu_RemoveFavorite" ng-if="$ctrl.canUnFavorite()" ng-disabled="$ctrl.isFavoriteDisabled()" ng-click="$ctrl.unfavoriteContentTile($ctrl.tileType)"></div><div class="actionIcon renameBtn pbi-glyph-settings" localize-tooltip="ContentTileOptions_Settings" ng-if="::$ctrl.canRewrite($ctrl.viewModel.getPermissions())" ng-click="$ctrl.contentTileRename($ctrl.tileType)"></div><div class="actionIcon removeBtn pbi-glyph-delete" localize-tooltip="ContentTileOptions_Delete" ng-if="::$ctrl.deleteEnabled" ng-click="$ctrl.deleteContentTile($ctrl.tileType)"></div></section><section class="tileMenu" onclick="event.stopPropagation();" ng-switch-when="8"><div class="actionIcon personalizeBtn pbi-glyph-contentviewicon" localize-tooltip="ContentTileOptions_Personalize" ng-if="::$ctrl.canPersonalize()" ng-click="$ctrl.personalize()"></div><div class="actionIcon refreshNow pbi-glyph-refresh" localize-tooltip="ContentTileOptions_RefreshNow" ng-if="::$ctrl.canRefreshNow()" ng-click="$ctrl.refreshNow()"></div><div class="actionIcon scheduleRefresh pbi-glyph-refresh-data" localize-tooltip="ContentTileOptions_ScheduleRefresh" ng-if="::$ctrl.canScheduleRefresh()" ng-click="$ctrl.scheduleRefresh()"></div><div class="actionIcon editWorkbookBtn pbi-glyph-edit" localize-tooltip="ContentTileOptions_EditWorkbooks" ng-if="::$ctrl.canEditWorkbook($ctrl.tileType)" ng-click="$ctrl.editWorkbook($ctrl.tileType)"></div><div class="actionIcon replaceWorkbookBtn pbi-glyph-getdata" localize-tooltip="ReplaceLocalWorkbook_ReplaceFile" ng-if="::$ctrl.canReplaceWorkbook($ctrl.tileType)" ng-click="$ctrl.replaceWorkbook($ctrl.tileType)"></div><div class="actionIcon renameBtn pbi-glyph-settings" localize-tooltip="ContentTileOptions_Settings" ng-if="::$ctrl.canRewriteWorkbook($ctrl.viewModel)" ng-click="$ctrl.contentTileRename($ctrl.tileType)"></div><div class="actionIcon removeBtn pbi-glyph-delete" localize-tooltip="ContentTileOptions_Delete" ng-if="::$ctrl.deleteEnabled" ng-click="$ctrl.deleteContentTile($ctrl.tileType)"></div></section><section class="tileMenu" onclick="event.stopPropagation();" ng-switch-when="16"><pbi-icon name="edit" size="small" localize-tooltip="Edit_ToolTip" ng-if="::$ctrl.canEditApp" ng-click="$ctrl.editApp()"></pbi-icon><pbi-icon name="favoritestar" size="small" localize-tooltip="Artifact_Favorite" ng-if="$ctrl.canFavorite()" ng-click="$ctrl.favoriteContentTile()"></pbi-icon><pbi-icon name="favoritefilled" class="toggledIcon" size="small" localize-tooltip="ContentListMenu_RemoveFavorite" ng-if="$ctrl.canUnFavorite()" ng-click="$ctrl.unfavoriteContentTile()"></pbi-icon><pbi-icon name="delete" size="small" localize-tooltip="{{$ctrl.deleteTooltip}}" ng-if="::$ctrl.deleteEnabled" ng-disabled="::$ctrl.viewModel.appPush" ng-click="$ctrl.deleteContentTile($ctrl.tileType)"></pbi-icon></section><section class="tileMenu" onclick="event.stopPropagation();" ng-switch-when="512"><pbi-icon class="actionIcon" name="excel" size="small" localize-tooltip="ContentTileOptions_AnalyzeInExcel" ng-if="::$ctrl.canAnalyzeInExcel()" ng-click="$ctrl.analyzeInExcel()"></pbi-icon><pbi-icon class="actionIcon" name="insight" size="small" localize-tooltip="GetQuickInsights" ng-if="::$ctrl.canRunInsights()" ng-click="$ctrl.runInsights()"></pbi-icon><pbi-icon class="actionIcon" name="refresh" size="small" localize-tooltip="ContentTileOptions_RefreshNow" ng-if="::$ctrl.canRefreshNow()" ng-click="$ctrl.refreshNow()"></pbi-icon><pbi-icon class="actionIcon" name="refresh-data" size="small" localize-tooltip="ContentTileOptions_ScheduleRefresh" ng-if="::$ctrl.canScheduleRefresh()" ng-click="$ctrl.scheduleRefresh()"></pbi-icon></section><section class="tileMenu" onclick="event.stopPropagation();" ng-switch-when="256"><pbi-icon ng-if="!$ctrl.viewModel.isMyWorkspace" ng-repeat="item in $ctrl.viewModel.metadata.contextMenuItemList" name="{{::$ctrl.getIconForGroupContextMenuItem(item)}}" size="small" title="{{::$ctrl.getTooltipForGroupContextMenuItem(item)}}" ng-click="$ctrl.onGroupContextMenuItemSelected(item)"></pbi-icon></section></section>'),e.put("components/dataClassificationLabel/dataClassificationLabel.html",'<a class="dataClassification" ng-href="{{$ctrl.dataClassification.url}}" onclick="event.stopPropagation();" target="_blank" ng-if="$ctrl.isDataClassificationFeatureEnabled && $ctrl.dataClassification && $ctrl.dataClassification.showTag && $ctrl.dataClassification.url" title="{{$ctrl.dataClassification.name}}" ng-bind="$ctrl.dataClassification.shortHand"></a><span class="dataClassification" ng-if="$ctrl.isDataClassificationFeatureEnabled && $ctrl.dataClassification && $ctrl.dataClassification.showTag && !$ctrl.dataClassification.url" title="{{$ctrl.dataClassification.name}}" ng-bind="$ctrl.dataClassification.shortHand"></span>'),e.put("components/datasetIconContainer/datasetIconContainer.html",'<span class="datasetItemIcon" ng-switch="::$ctrl.refreshRelated"><span class="datasetItemIndicator" ng-switch-when="false"><i ng-if="::$ctrl.isShared()" class="glyphicon pbi-glyph-shared" localize-tooltip="NavigationPane_SharedWithMe"></i><i ng-if="$ctrl.isNew()" class="glyphicon pbi-glyph-asterisk"></i></span><span class="datasetRefreshIcons" ng-switch-when="true" ng-switch="$ctrl.isRefreshInProgress()"><spinner ng-switch-when="true" localize-tooltip="NavigationPane_RefreshInProgress"></spinner><span ng-switch-default><i ng-if="$ctrl.isPublishError()" class="warning glyphicon pbi-glyph-warning glyph-small" localize-tooltip="NavigationPane_RefreshPublishError"></i><i ng-if="$ctrl.showRefreshError && $ctrl.showRefreshError()" class="warning glyphicon pbi-glyph-warning glyph-small" tooltip tooltip-config="$ctrl.tooltipConfig" ng-click="$event.stopPropagation();$ctrl.showRefreshErrorDialog()"></i></span></span></span>'),e.put("components/errorPlaceholder/errorPlaceholder.html",'<div class="errorPlaceholder"><div class="errorContainer"><div class="errorPlaceholderIcon glyphicon pbi-glyph-error glyph-med" title="{{$ctrl.errorText}}"></div><div class="errorPlaceholderTextContainer"><span class="errorPlaceholderText" ng-bind="$ctrl.errorText"></span><a ng-if="$ctrl.errorDetails" class="getDetailsText clickAction" localize="ErrorPlaceHolder_SeeDetails" ng-click="$ctrl.seeErrorDetails()"></a></div></div></div>'),e.put("components/exportDataDialog/exportDataDialog.html",'<dialog-frame><dialog-header><span localize="ModalDialog_ExportDataTitle" class="dialogTitle"></span></dialog-header><dialog-body><span localize="ModalDialog_ExportDataTextDialogTwo" class="dialogMessage"></span><ul class="radioButtonText"><li ng-repeat="val in ::$ctrl.viewModel.options"><div class="pbi-input dataTypeMenu" tooltip tooltip-config="$ctrl.getTooltipConfigForDataType(val)"> <input class="dataTypeItem" type="radio" name="option" ng-model="$ctrl.viewModel.dataType" ng-value="::$index" ng-change="$ctrl.update(val)" ng-disabled="$ctrl.isDataTypeDisabled(val)"><label ng-bind="::val"></label></div></li></ul><pbi-select ng-if="$ctrl.viewModel.isCsvFormatDisabled" class="exportDataSelectButton" label="ModalDialog_ExportDataFormatTypeText" ng-model="$ctrl.viewModel.dataFormat"><pbi-option label="ModalDialog_ExportDataFormatXL" ng-value="\'0\'" ng-disabled="::$ctrl.viewModel.isExlFormatDisabled"></pbi-option><pbi-option label="ModalDialog_ExportDataFormatCsv" ng-value="\'1\'" ng-disabled="true"></pbi-option></pbi-select><pbi-select ng-if="!$ctrl.viewModel.isCsvFormatDisabled" class="exportDataSelectButton" label="ModalDialog_ExportDataFormatTypeText" ng-model="$ctrl.viewModel.dataFormat"><pbi-option label="ModalDialog_ExportDataFormatXL" ng-value="\'0\'" ng-disabled="::$ctrl.viewModel.isExlFormatDisabled"></pbi-option><pbi-option label="ModalDialog_ExportDataFormatCsv" ng-value="\'1\'"></pbi-option></pbi-select><pbi-alert class="dataInfoMessage" kind="\'info\'" message-info="ModalDialog_ExportDataInfoMessage"></pbi-alert><div ng-if="::$ctrl.viewModel.isExlFormatDisabled" ng-switch="$ctrl.viewModel.exportXlsxUnsupportedType"><pbi-alert ng-switch-when="1" kind="\'info\'" message-info="ExlFormat_ToolTipDescription_AsOnPrem"></pbi-alert><pbi-alert ng-switch-default kind="\'info\'" message-info="ExlFormat_ToolTipDescription"></pbi-alert></div><pbi-alert ng-if="$ctrl.viewModel.isCsvFormatDisabled" kind="\'info\'" message-info="SupportOnlyExlFormat_ToolTipDescription"></pbi-alert></dialog-body><dialog-footer><pbi-link ng-if="::($ctrl.viewModel.isUnderlyingDisabled && !$ctrl.viewModel.isExlFormatDisabled)" class="learnMoreLink" guid="827799" label="Learn_Aggregates"></pbi-link> <button autofocus type="submit" ng-click="$ctrl.exportData()" class="primary" localize="ModalDialogButtonText_Export"></button> <button ng-click="$ctrl.close()" localize="ModalDialogButtonText_Cancel"></button></dialog-footer></dialog-frame>'),e.put("components/exportDataDialog/exportDataDialogDefinition.html",'<export-data-dialog view-model="viewModel"></export-data-dialog>'),e.put("components/favoritesContainer/favoritesContainer.html",'<div class="favoriteContainerView isNavigationPaneEnabled contentListView" ng-class="{isMainContentDisabled: collapsiblePaneMode !== 0}"><div class="dashboardControls"><search-box should-focus="true" on-change="$ctrl.onSearchTextChange()" on-blur="$ctrl.resolveSearchTelemetry()" filter="$ctrl.searchText" placeholder="SearchContent"></search-box></div><div class="contentListOptionsTabs unselectable"><div class="right"><span class="count" localize="ShowingXItems" localize-fragments><span fragment-index="0" ng-bind="$ctrl.filteredFavorites.length"></span></span><select-tile-sort selected-predicate="$ctrl.sortPredicate" on-select="$ctrl.selectSort" predicates="$ctrl.sortPredicates"></select-tile-sort></div></div><div class="dashboardSliderMain" ng-class="{noFavorites: $ctrl.showEmptyFavoritesWatermark}"><pbi-data-loader-spinner class="centered" ng-if="!$ctrl.initialized"></pbi-data-loader-spinner><water-mark-message config="::$ctrl.emptySearchWatermarkConfig" ng-show="$ctrl.showEmptySearchWatermarkConfig"></water-mark-message><content-list-gallery view-model="::$ctrl.galleryViewModel"></content-list-gallery><div class="emptyFavorites noselect"><div class="empty-favorites-img"></div><div class="noFavTitle" localize="Favorites_NoFavoritesTitle"></div><div class="noFavMessage" localize="Favorites_NoFavoritesMessage1"></div><i class="glyphicon pbi-glyph-favoritestar glyph-small"></i><div class="noFavMessage" localize="Favorites_NoFavoritesMessage2"></div></div></div></div>'),e.put("components/groupActions/groupActions.html",'<button class="options navigationPaneButton groupContextMenuButton " dropdown-menu dropdown-class="navigationPaneGroupContextMenu" dropdown-items="$ctrl.items" dropdown-orientation="$ctrl.dropdownOrientation" dropdown-on-item-selected="$ctrl.onGroupNavigationPaneMenuItemSelected(selected, $ctrl.group)" dropdown-separator-class="groupContextMenuSeparator"><i class="glyphicon pbi-glyph-more glyph-small"></i></button>'),e.put("components/groupIcon/groupIcon.html",'<lazy-icon ng-if="$ctrl.group" src="$ctrl.src" title="{{$ctrl.group.displayName}}" placeholder="$ctrl.placeholder" placeholder-size="$ctrl.placeholderSize"></lazy-icon>'),e.put("components/groupList/groupList.html",'<div class="myWorkspace"> <button class="button myWorkspace" ng-class="{selected: $ctrl.isActiveGroup($ctrl.myWorkspace)}" ng-click="$ctrl.switchGroup($ctrl.myWorkspace)"><div class="flexDiv"><group-icon group="::$ctrl.myWorkspace" placeholder-size="small"></group-icon><span class="workspaceName" ng-bind="::$ctrl.myWorkspace.displayName" title="{{::$ctrl.myWorkspace.displayName}}"></span><pbi-icon class="capacity" name="diamond" size="small" ng-if="$ctrl.myWorkspace.capacity" tooltip tooltip-config="{tooltipLocalizeDescription: \'Capacity_Icon_Tooltop\', tooltipArrowPosition: 1}"></pbi-icon></div></button><group-actions group="::$ctrl.myWorkspace" ng-if="$ctrl.tenantHasCapacities"></group-actions></div><header class="groupHeader"><span localize="NavigationPane_Groups_Workspaces_V2"></span></header><ul><li ng-repeat="group in $ctrl.groups track by group.aadGroupId"> <button class="button" ng-click="$ctrl.switchGroup(group)" ng-class="{selected: $ctrl.isActiveGroup(group)}"><div class="flexDiv"><group-icon group="group" placeholder-size="small"></group-icon><span class="workspaceName" ng-bind="group.displayName" title="{{group.displayName}}"></span><pbi-icon class="capacity" name="diamond" size="small" ng-if="!!group.capacity" tooltip tooltip-config="{tooltipLocalizeDescription: \'Capacity_Icon_Tooltop\', tooltipArrowPosition: 1}"></pbi-icon></div></button><group-actions group="group"></group-actions></li></ul><pbi-button class="addGroup" ng-click="$ctrl.addGroup()" primary="true" label="NavigationPane_CreateAppWorkspace"></pbi-button><div ng-if="$ctrl.isExpanded" class="capture" ng-click="$ctrl.toggleGroupListPane(false)"></div>'),e.put("components/groupSwitcher/groupSwitcher.html",'<div class="flexDiv" ng-click="$ctrl.onToggled()" localize-tooltip="NavigationPane_Workspaces"> <button><div class="flexDiv"><i class="navicon glyphicon pbi-glyph-collections glyph-small"></i><span class="btnLabel" localize="NavigationPane_Workspaces"></span></div></button></div> <button class="switcher" ng-click="$ctrl.onToggled()" localize-tooltip="GroupSwitch_NavPaneTitle"><span class="glyphicon glyph-small"></span></button>'),e.put("components/groupSwitcherV2/groupSwitcherV2.html",'<div class="groupSwitcherV2" ng-class="{\'isExpanded\':$ctrl.isExpanded && $ctrl.canExpand}"><div class="activeGroup"><div class="toggle" ng-click="$ctrl.toggleGroupSwitcherPane()" localize-tooltip="NavigationPane_Workspaces"><div class="icon"><i class="glyphicon pbi-glyph-collections glyph-small"></i></div><span class="text" localize="NavigationPane_Workspaces"></span></div> <button class="options add" focus-out-trigger ng-click="$ctrl.addGroup()" localize-tooltip="NavigationPane_CreateGroup"><i class="glyphicon pbi-glyph-add"></i></button></div><div class="list"><span class="sectionLabel" localize="NavigationPane_Groups_MyWorkspace_V2"></span><div focus-out-trigger class="groupItem" ng-click="$ctrl.switchGroup($ctrl.groupService.groups[0])" ng-class="{\'selected\': $ctrl.isGroupSelected($ctrl.groupService.groups[0])}"><div class="icon" ng-switch="$ctrl.userPhoto !== undefined"><i ng-switch-when="false" class="glyphicon pbi-glyph-user glyph-med groupIcon placeholder"></i><div ng-switch-when="true" ng-style="{\'background-image\': $ctrl.userPhoto,\'background-size\':\'cover\',\'background-position\':\'0px 0px\'}"></div></div><span class="text" title="{{$ctrl.groupService.groups[0].displayName}}" ng-bind="$ctrl.groupService.groups[0].displayName"></span></div><span class="sectionLabel" localize="NavigationPane_Groups_MyGroups"></span><ul><li ng-repeat="group in $ctrl.getGroups()" focus-out-trigger ng-click="$ctrl.switchGroup(group)" class="groupItem" ng-if="$index!=0" ng-class="{\'selected\': $ctrl.isGroupSelected(group)}"><div class="icon" ng-switch="group.icon !== undefined"><i ng-switch-when="false" class="glyphicon pbi-glyph-group glyph-med groupIcon placeholder"></i> <img ng-switch-when="true" class="groupIcon" ng-src="{{group.icon}}"/></div><span class="text"><span title="{{group.displayName}}" ng-bind="group.displayName"></span></span></li></ul></div></div>'),e.put("components/iframeTile/iframeTile.html",'<div class="iframeTile"><iframe class="iframeSelf" ng-if="!$ctrl.viewModel.isLoading" frameborder="0" ng-src="{{$ctrl.iframeSource}}" sandbox="allow-scripts allow-popups allow-same-origin allow-forms" marginheight="0" marginwidth="0"></iframe></div>'),e.put("components/insufficientLicenseBar/insufficientLicenseBar.html",'<span><label ng-bind="::$ctrl.content"></label></span> <button localize="UpgradeAccount_StartTrialButton" ng-click="$ctrl.startTrial()" ng-if="::$ctrl.showTrialButton()"></button> <button localize="UpgradeDialogButtonText_UpgradeNow" ng-click="$ctrl.upgrade()"></button>'),e.put("components/introduceAppBar/introduceAppBar.html",'<section ng-if="$ctrl.showIntroduceAppBar" class="trimmedTextWithEllipsis"><label class="title" ng-bind="::$ctrl.title"></label><label ng-bind="::$ctrl.content"></label><a href="{{::$ctrl.learnMoreLink}}" target="_blank" ng-bind="::$ctrl.learnMoreText"></a><pbi-icon name="close" size="small" class="closeButton" ng-click="$ctrl.hideBar()"></pbi-icon></section>'),e.put("components/landing/landing.html",'<div class="landingController"><navigation-bar ng-if="::$ctrl.isInitialized"></navigation-bar><impersonation-bar class="unselectable" ng-if="$ctrl.impersonation.impersonating" on-back="$ctrl.quitImpersonation()"></impersonation-bar><div id="contentMain" class="contentMain" ng-class="{isCollapsiblePaneExpanded: $ctrl.viewModel.collapsiblePane.isExpanded}"><navigation-pane-v2 ng-if="::$ctrl.showNavPane" is-expanded="$ctrl.isNavigationPaneExpanded" on-toggled="$ctrl.toggleNavigationPane(isExpanded)" ng-class="{isExpanded: $ctrl.isNavigationPaneExpanded}" resizable resizable-containerid="contentMain" resizable-expanded="{{$ctrl.isNavigationPaneExpanded}}" resizable-default-width="220" resizable-min-width="200" resizable-max-width="420" resizable-collapsed-width="48" resizable-side="{{::$ctrl.navigationPaneSide}}"></navigation-pane-v2><div id="contentColumn" class="contentColumn"><notification-bar></notification-bar><ng-transclude></ng-transclude><landing-container ng-if="::$ctrl.isInitialized"></landing-container></div><div class="taskPaneSliderOverlay" ng-click="$ctrl.hideTaskPaneSliderOnClick()" ng-if="$ctrl.viewModel.collapsiblePane.isExpanded" ng-class="{isCollapsiblePaneExpanded: $ctrl.viewModel.collapsiblePane.isExpanded, showOverlay:$ctrl.viewModel.collapsiblePane.expandedWidth> 0}"></div><task-pane-slider ng-show="$ctrl.viewModel.collapsiblePaneMode !== 0" view-model="$ctrl.viewModel"></task-pane-slider><div class="notificationPane" ng-if="$ctrl.viewModel.showNotificationPane"><div class="taskPaneSliderOverlay" ng-click="$ctrl.hideNotificationPaneOnClick()" ng-if="$ctrl.viewModel.notificationPane.isExpanded" ng-class="{isCollapsiblePaneExpanded: $ctrl.viewModel.notificationPane.isExpanded, showOverlay:$ctrl.viewModel.notificationPane.expandedWidth> 0}"></div><collapsible-pane view-model="$ctrl.viewModel.notificationPane" is-expander-hidden="$ctrl.viewModel.showNotificationPane"><user-notifications></user-notifications></collapsible-pane></div></div><marketplace-host ng-if="$ctrl.navigation.inGetDataView()"></marketplace-host><nps-host></nps-host><div class="sliderPane fullPageSlider unselectable" ng-if="$ctrl.navigation.inFullPageSliderView()" ui-view="fullPageSlider"></div></div>'),e.put("components/makeACopyDialog/makeACopyDialog.html",'<dialog-frame><dialog-header><label localize="$ctrl.titleKey"></label></dialog-header><dialog-body><label class="message" localize="$ctrl.messageKey"></label><label localize="$ctrl.itemsIntroKey"></label><div class="itemList"><label ng-repeat="item in ::$ctrl.itemNames track by $index" ng-bind="::item"></label></div></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="$ctrl.save()" class="primary" localize="ModalDialog_Save"></button> <button ng-click="$ctrl.cancel()" localize="ModalDialog_Cancel"></button></dialog-footer></dialog-frame>'),
e.put("components/makeACopyDialog/makeACopyDialogDefinition.html",'<make-a-copy-dialog title-key="titleKey" message-key="messageKey" items-intro-key="itemsIntroKey" dashboards="dashboards" reports="reports" models="models"></make-a-copy-dialog>'),e.put("components/navigationPaneV2/navigationPaneV2.html",'<div class="navigationPaneV2" ng-class="{isFrozen: $ctrl.groupService.isInGroupTransition, isExpanded: $ctrl.isExpanded}"> <button class="expanderBtn glyphicon pbi-glyph-globalnavbutton slideFadeIn" ng-click="$ctrl.onToggleClicked()" title="{{ $ctrl.getExpandButtonTitle() }}"></button><div class="navigationPaneBody slideFadeIn"><div class="globalPivots"><nav-pane-flyout-button class="button favorites" show-recent="false" icon="pbi-glyph-favoritestar" label="Favorites_NavPaneTitle" navigate-to="$ctrl.navigateToFavorites()" ng-class="{\'highlight\':$ctrl.isOnFavorites(), isExpanded: $ctrl.isExpanded}" ng-click="$ctrl.onGroupSwitcherToggled(false)"></nav-pane-flyout-button><nav-pane-flyout-button class="button recent" icon="pbi-glyph-mru" label="RecentlyViewed_NavPaneTitle" navigate-to="$ctrl.navigateToRecentlyViewed()" ng-class="{\'highlight\':$ctrl.isOnRecentlyViewed(), isExpanded: $ctrl.isExpanded}" ng-click="$ctrl.onGroupSwitcherToggled(false)"></nav-pane-flyout-button> <button class="button myApps" localize-tooltip="Apps_NavPaneTitle" ng-if="::$ctrl.isAppsEnabled()" ng-click="$ctrl.navigateToApps()" ng-class="{\'highlight\':$ctrl.isOnApps()}"><div class="flexDiv"><i class="navicon glyphicon pbi-glyph-my-apps glyph-small"></i><span class="btnLabel" localize="Apps_NavPaneTitle"></span></div></button> <button class="button sharedWithMe" localize-tooltip="NavigationPane_SharedWithMeTitle" ng-click="$ctrl.navigateToOnlySharedWithMe()" ng-class="{\'highlight\':$ctrl.isOnSharedWithMe()}"><div class="flexDiv"><i class="navicon glyphicon pbi-glyph-shared glyph-small"></i><span class="btnLabel" localize="NavigationPane_SharedWithMeTitle"></span></div></button></div><group-switcher class="button workspaces" ng-if="::$ctrl.showGroupSwitcher" on-toggled="$ctrl.onGroupSwitcherToggled(isExpanded)" ng-class="{\'highlight\':$ctrl.isOnWorkspaces(), isExpanded: $ctrl.isExpanded, isGroupSwitcherExpanded: $ctrl.isGroupSwitcherExpanded}"></group-switcher><quick-access-pane ng-if="$ctrl.showQuickAccessPane" selected="$ctrl.isOnWorkspace()" close-menus="$ctrl.onGroupSwitcherToggled(false)"></quick-access-pane> <button class="button getData" ng-if="$ctrl.showGetDataBtn" localize-tooltip="NavigationPane_GetData" ng-click="$ctrl.navigateToGetData()"><div class="flexDiv"><i class="navicon glyphicon pbi-glyph-getdata glyph-small"></i><span class="btnLabel" localize="NavigationPane_GetData"></span></div></button></div><group-list ng-if="$ctrl.isGroupSwitcherExpanded" ng-class="{large: $ctrl.shouldShowLargeGroupList}" active-group="$ctrl.groupService.activeGroup" on-toggled="$ctrl.onGroupSwitcherToggled(isExpanded)" is-expanded="$ctrl.isGroupSwitcherExpanded"></group-list></div>'),e.put("components/navPaneFlyoutButton/navPaneFlyoutButton.html",'<div class="flexDiv"> <button class="main" ng-click="$ctrl.navigateTo()" localize-tooltip="{{$ctrl.label}}"><div class="flexDiv"><i class="navicon glyphicon glyph-small" ng-class="::$ctrl.icon"></i><span class="name" localize="$ctrl.label"></span></div></button></div> <button class="switcher" ng-mousedown="$ctrl.mouseDownToggle()" ng-click="$ctrl.toggleFlyout()"><span class="glyphicon glyph-small" ng-class="{expanded: $ctrl.isExpanded}"></span></button><ul ng-class="{expand: $ctrl.isExpanded}" flyout-toggle="$ctrl.isExpanded"><li ng-repeat="item in $ctrl.items" title="{{item.displayName}}" ng-switch="::$ctrl.getActualType(item)"><a ng-click="$ctrl.openContent(item)"><i class="tileTypeIndicator glyphicon pbi-glyph-barchart glyph-small" ng-switch-when="2"></i><i class="tileTypeIndicator glyphicon pbi-glyph-gauge glyph-small" ng-switch-when="4"></i><i class="tileTypeIndicator glyphicon pbi-glyph-excel glyph-small" ng-switch-when="8"></i><i class="tileTypeIndicator glyphicon pbi-glyph-my-apps glyph-small" ng-switch-when="16"></i><span class="flyoutName" ng-bind="item.displayName"></span></a></li><li><a class="seeAll" ng-click="$ctrl.navigateToArea()" localize="NavigationPane_SeeAllLabel"></a></li></ul>'),e.put("components/popupNotificationDialog/popupNotificationDialog.html",'<dialog-frame><dialog-header><header class="smallHeader" ng-bind="::$ctrl.config.subtitle"></header><header class="mainHeader" ng-bind="::$ctrl.config.title"></header></dialog-header><dialog-body> <img src="{{::$ctrl.config.imgUrl}}" ng-if="::$ctrl.config.imgUrl"><section class="description" ng-bind="::$ctrl.config.message"></section></dialog-body><dialog-footer id="popupNotificationFooter"> <button type="submit" ng-click="$ctrl.ok()" autofocus class="okButton actionButton primary">{{::$ctrl.config.okButton.text}}</button> <button class="cancelButton text" ng-click="$ctrl.close()">{{::$ctrl.config.cancelButton.text}}</button></dialog-footer></dialog-frame>'),e.put("components/popupNotificationDialog/popupNotificationDialogDefinition.html",'<popup-notification-dialog config="config"></popup-notification-dialog>'),e.put("components/printableImage/printableImage.html",'<img class="image" ng-class="{loaded: $ctrl.imageLoaded, animate: !$ctrl.disableAnimation}" ng-src="{{$ctrl.source}}" on-load="$ctrl.onLoad()" on-error="$ctrl.onError()" draggable="false"/>'),e.put("components/quickAccessPane/quickAccessPane.html",'<div class="quickAccessPaneLauncher"><div class="flexDiv"> <button class="button workspace" ng-class="{highlight: $ctrl.selected}" ng-click="$ctrl.navigateToContentList()"><div class="flexDiv"><group-icon group="$ctrl.groupService.activeGroup" placeholder-size="small"></group-icon><span class="workspaceName" ng-bind="$ctrl.groupService.activeGroup.displayName" title="{{$ctrl.groupService.activeGroup.displayName}}"></span><pbi-icon class="capacity" name="diamond" size="small" ng-if="!!$ctrl.groupService.activeGroup.capacity" tooltip tooltip-config="{tooltipLocalizeDescription: \'Capacity_Icon_Tooltop\', tooltipArrowPosition: 1}"></pbi-icon></button></div> <button class="button switcher" ng-class="{highlight: $ctrl.selected}" ng-click="$ctrl.togglePane()" localize-tooltip="GroupSwitch_NavPaneTitle"><span class="glyphicon glyph-small" ng-class="{\'pbi-glyph-chevronupmedium\': $ctrl.paneExpanded, \'pbi-glyph-chevrondownmedium\': !$ctrl.paneExpanded}"></span></button></div><section class="artifactListing" ng-if="$ctrl.paneExpanded"><header class="artifactHeader unselectable" ng-click="$ctrl.toggleDashboards()" localize="NavigationPane_Dashboards_Header"></header><ul ng-if="$ctrl.dashboardsExpanded && !$ctrl.groupService.isInGroupTransition"><dashboard-navigation-pane-list-item ng-repeat="dashboard in $ctrl.dashboards track by dashboard.objectId" ng-click="$ctrl.openItem(dashboard)" view-model="::dashboard" new-style="true" selected="dashboard.objectId === $ctrl.currentObjectId"></dashboard-navigation-pane-list-item><li localize="NavigationPane_NoDashboardText" localize-tooltip="NavigationPane_NoDashboardText" class="noItemText navPaneListItem" ng-if="$ctrl.dashboards.length === 0"></li></ul><header class="artifactHeader unselectable" ng-click="$ctrl.toggleReports()" localize="NavigationPane_Reports_Header"></header><ul ng-if="$ctrl.reportsExpanded && !$ctrl.groupService.isInGroupTransition"><report-navigation-pane-list-item ng-repeat="report in $ctrl.reports track by report.objectId" ng-click="$ctrl.openItem(report)" view-model="::report" new-style="true" selected="report.objectId === $ctrl.currentObjectId"></report-navigation-pane-list-item><li localize="NavigationPane_NoReportText" localize-tooltip="NavigationPane_NoReportText" class="noItemText navPaneListItem" ng-if="$ctrl.reports.length === 0"></li></ul><header class="artifactHeader unselectable" ng-click="$ctrl.toggleWorkbooks()" localize="NavigationPane_Workbooks_Header"></header><ul ng-if="$ctrl.workbooksExpanded && !$ctrl.groupService.isInGroupTransition"><workbook-navigation-pane-list-item ng-repeat="workbook in $ctrl.workbooks track by workbook.uniqueId" ng-click="$ctrl.openItem(workbook)" view-model="::workbook" new-style="true" selected="workbook.uniqueId === $ctrl.currentObjectId"></workbook-navigation-pane-list-item><li localize="NavigationPane_NoWorkbookText" localize-tooltip="NavigationPane_NoWorkbookText" class="noItemText navPaneListItem" ng-if="$ctrl.workbooks.length === 0"></li></ul><header class="artifactHeader unselectable" ng-if="!$ctrl.isActiveWorkspaceReadOnly" ng-click="$ctrl.toggleDatasets()" localize="NavigationPane_Datasets_Header"></header><ul ng-if="$ctrl.datasetsExpanded && !$ctrl.groupService.isInGroupTransition && !$ctrl.isActiveWorkspaceReadOnly"><dataset-navigation-pane-list-item ng-repeat="model in $ctrl.datasets" ng-click="$ctrl.openModel(model)" view-model="::model" new-style="true" selected="model.dbName === $ctrl.currentObjectId || (navigation.inRowLevelSecurityView() && navigation.rowLevelSecurityModelId === model.id)"></dataset-navigation-pane-list-item><li localize="NavigationPane_NoDatasetText" localize-tooltip="NavigationPane_NoDatasetText" class="noItemText navPaneListItem" ng-if="$ctrl.datasets.length === 0"></li></ul></section>'),e.put("components/realTimeTile/realTimeTile.html",'<div class="realTimeTile compositeTile" ng-class="{ fullLayout: $ctrl.viewModel.config.layoutType === 1 }"><div class="visualTile"><visual ng-if="!$ctrl.viewModel.isLoading && !$ctrl.viewModel.hideVisual" view-model="$ctrl.viewModel.visual" allow-deferred-rendering="::true"></visual></div></div>'),e.put("components/recentlyViewedContainer/recentlyViewedContainer.html",'<div class="recentlyViewedContainer contentListView"><div class="dashboardControls"><search-box should-focus="::true" on-change="$ctrl.ensureSearchTelemetry()" on-blur="$ctrl.resolveSearchTelemetry()" filter="$ctrl.searchText" placeholder="SearchContent"></search-box></div><div class="contentListOptionsTabs unselectable"><div class="right"><span class="count" localize="ShowingXItems" localize-fragments><span fragment-index="0" ng-bind="$ctrl.filteredRecentlyUsedArtifacts.length"></span></span><select-tile-sort selected-predicate="$ctrl.sortPredicate" on-select="$ctrl.selectSort" predicates="$ctrl.sortPredicates"></select-tile-sort></div></div><div class="dashboardSliderMain"><water-mark-message config="$ctrl.watermarkConfig" ng-show="$ctrl.showWatermarkConfig"></water-mark-message><content-list-gallery view-model="::$ctrl.galleryViewModel"></content-list-gallery></div></div>'),e.put("components/selectArtifactFilter/selectArtifactFilter.html",'<select-button overlay-name="SelectArtifactFilter"><span localize="PermissionCenter_ViewAllContent" class="dropdownFontColor"></span></select-button><dropdown-overlay dropdown-overlay-name="SelectArtifactFilter" class="overlayTopBar"><dropdown-list class="topBar filters artifactFilter"><dropdown-list-item ng-click="$ctrl.selectType()($ctrl.Dashboard)"><div class="pbi-input"> <input id="dashboardCheckBoxInput" type="checkbox" ng-checked="$ctrl.isSelectedType($ctrl.Dashboard)"/><label localize="ContentList_Dashboards" for="dashboardCheckBoxInput"></label></div></dropdown-list-item><dropdown-list-item ng-click="$ctrl.selectType()($ctrl.Report)"><div class="pbi-input"> <input id="reportCheckBoxInput" type="checkbox" ng-checked="$ctrl.isSelectedType($ctrl.Report)"/><label localize="ContentList_Reports" for="reportCheckBoxInput"></label></div></dropdown-list-item><dropdown-list-item ng-click="$ctrl.selectType()($ctrl.Workbook)"><div class="pbi-input"> <input id="workbookCheckBoxInput" type="checkbox" ng-checked="$ctrl.isSelectedType($ctrl.Workbook)"/><label localize="ContentList_Workbooks" for="workbookCheckBoxInput"></label></div></dropdown-list-item><dropdown-list-item ng-click="$ctrl.selectType()($ctrl.Dataset)"><div class="pbi-input"> <input id="datasetChecBoxInput" type="checkbox" ng-checked="$ctrl.isSelectedType($ctrl.Dataset)"/><label localize="ContentList_Datasets" for="datasetChecBoxInput"></label></div></dropdown-list-item></dropdown-list></dropdown-overlay>'),e.put("components/selectButton/selectButton.html",'<div class="toggle" ng-mousedown="$ctrl.toggleDropdown($event)"><ng-transclude class="title"></ng-transclude><span class="glyphicon glyph-mini anchorContainer" ng-class="$ctrl.dropdownOpen ? \'pbi-glyph-chevronupmedium\' : \'pbi-glyph-chevrondownmedium\'"><span class="js-anchor anchor"></span></span></div>'),e.put("components/selectTileSort/selectTileSort.html",'<div class="select-button" ng-mousedown="$ctrl.showDropdownItems($event)"><span class="title" ng-bind="$ctrl.title"></span><span class="glyphicon glyph-mini anchorContainer" ng-class="$ctrl.dropdownOpen ? \'pbi-glyph-chevronupmedium\' : \'pbi-glyph-chevrondownmedium\'"></span></div>'),e.put("components/sharedByColumn/sharedByColumn.html",'<section class="contentHeaderContainer unselectable"><header class="name trimmedTextWithEllipsis" localize="ContentHeader_Owner"></header></section><div class="unselectable listContainer" vs-repeat><div ng-repeat="ownerInfo in $ctrl.ownerInfos track by ownerInfo.objectId" class="listItemWrapper"><div class="listItem" ng-class="{selected: $ctrl.selectedOwner === ownerInfo.objectId}" ng-click="$ctrl.onSelectedOwnerChanged({selectedOwner: ownerInfo.objectId})"><div class="icon" ng-switch="!!ownerInfo.icon"><i ng-switch-when="false" class="glyphicon glyph-small placeholder" ng-class="ownerInfo.isUser() ? \'pbi-glyph-user\' : \'pbi-glyph-group\'"></i> <img ng-switch-when="true" ng-src="{{ownerInfo.icon}}"/></div><div class="text trimmedTextWithEllipsis" ng-bind="::ownerInfo.name" title="{{::ownerInfo.name}}"></div></div></div></div><spinner ng-if="$ctrl.showSpinner" class="large"></spinner>'),e.put("components/sharedWithMeContainer/sharedWithMeContainer.html",'<div class="contentListView onlySharedWithMe" ng-class="{\'initializing\': !$ctrl.initialized}"><div class="header"></div><div class="dashboardControls"><search-box should-focus="::true" on-change="$ctrl.onSearchTextChange()" on-blur="$ctrl.resolveSearchTelemetry()" filter="$ctrl.searchText" placeholder="SearchContent"></search-box></div><div class="contentListOptionsTabs unselectable"><div class="left"><div class="optionTab dashboard label-med" ng-class="{hasNoResults: !$ctrl.hasResults}"></div></div><div class="right"><span class="count" localize="ShowingXItems" localize-fragments><span fragment-index="0" ng-bind="$ctrl.getNumberOfShownTabItems()"></span></span><select-tile-sort selected-predicate="$ctrl.sortPredicate" on-select="$ctrl.onSortPredicateChanged" predicates="$ctrl.sortPredicates"></select-tile-sort></div></div><div class="dashboardSliderMain" ng-class="::{hasTopBar: !$ctrl.hasSufficientLicense()}"><spinner ng-if="$ctrl.showSpinner" class="large centered"></spinner><water-mark-message config="$ctrl.getWatermarkConfig()" ng-if="$ctrl.shouldShowWatermark()"></water-mark-message><shared-by-column ng-if="!$ctrl.showSpinner" shared-dashboards="$ctrl.sharedDashboardsPrefiltered" selected-owner="$ctrl.selectedSharedByOwner" on-selected-owner-changed="$ctrl.onSelectedOwnerChanged(selectedOwner)"></shared-by-column><content-list-gallery ng-if="!$ctrl.showSpinner" view-model="::$ctrl.galleryViewModel"></content-list-gallery></div></div>'),e.put("components/tileOptionsMenu/tileOptionsMenu.html",'<button class="openTileOptionsBtn" ng-click="$ctrl.showOptionsMenu($event)"><i class="glyphicon pbi-glyph-more"></i></button>'),e.put("components/userNotifications/userNotificationsView.html",'<div class="usernotifications paneLayout"><header><div class="notificationheader"><div class="headercontainer"><div localize="UsersNotifications_AlertsFeed" class="heading"></div><div localize="UsersNotifications_AllNotifications" class="subheading"></div></div> <button ng-if="$ctrl.userNotifications.menuEnabled" localize-tooltip="UsersNotifications_Options" class="options" dropdown-overlay-invoke="notificationOptionsContextMenu" need-blur="true" prefer-left="true"><i class="glyphicon glyph-small pbi-glyph-more"></i></button><dropdown-overlay dropdown-overlay-name="notificationOptionsContextMenu" dropdown-overlay-class="angular-dropdown override-box-shadow"><dropdown-menu-items dropdown-items="::$ctrl.userNotifications.moreOptionsMenu" dropdown-class="additionalMenus active" dropdown-on-item-selected="$ctrl.moreOptionsMenuSelected(selected)"></dropdown-menu-items></dropdown-overlay></div></header><section class="contentContainer noPadding"><div class="notificationcontainer"><div class="nonotification" ng-if="!$ctrl.userNotifications.loadingData && (!$ctrl.userNotifications.notifications || $ctrl.userNotifications.notifications.length <= 0)"><div><i class="glyphicon pbi-glyph-emoji"></i></div><div localize="UsersNotifications_NoNotificationsMessage"></div></div><div ng-if="$ctrl.userNotifications.notifications && $ctrl.userNotifications.notifications.length> 0"><div ng-repeat="notification in $ctrl.userNotifications.notifications track by notification.contract.id"><div ng-init="$ctrl.userNotifications.loadIcon(notification)" ng-show="!notification.showDismissalDialog" class="notification" ng-class="notification.contract.id <= 0 ? \'pinned\' : (!notification.seen ? \'unseen\' : \'seen\')"><div class="notificationicon" ng-if="::!notification.contract.iconUrl" ng-switch="notification.image.imageType"><i class="glyphicon glyph-small pbi-glyph-user" ng-switch-when="0"></i><i class="glyphicon glyph-small pbi-glyph-group" ng-switch-when="1"></i><i class="glyphicon glyph-small pbi-glyph-gauge" ng-switch-when="2"></i><i class="glyphicon glyph-small pbi-glyph-barchart" ng-switch-when="3"></i><i class="glyphicon glyph-small pbi-glyph-insight" ng-switch-when="4"></i><i class="glyphicon glyph-small pbi-glyph-comment" ng-switch-when="5"></i><i class="glyphicon glyph-small pbi-glyph-powerbi" ng-switch-when="6"></i><i class="glyphicon glyph-small pbi-glyph-database" ng-switch-when="7"></i><i class="glyphicon glyph-small pbi-glyph-settings" ng-switch-when="8"></i><i class="glyphicon glyph-small pbi-glyph-uparrow rotate" ng-switch-when="9"></i><i class="glyphicon glyph-small pbi-glyph-uparrow" ng-switch-when="10"></i></div><div class="notificationicon" ng-if="::notification.contract.iconUrl"> <img class="icon" ng-src="{{::notification.contract.iconUrl}}"/></div><div class="message"><div><span class="title" ng-bind="::notification.title"></span><span class="time" ng-bind="::notification.formattedDate"></span></div><div class="desc" ng-bind="::notification.description"></div><div class="action" ng-if="::notification.actionText"><button ng-click="$ctrl.userNotifications.performAction(notification)" ng-bind="::notification.actionText"></button></div></div><div> <button class="close" ng-click="$ctrl.userNotifications.dismissNotification(notification)" localize-tooltip="UsersNotifications_DismissNotification"><i class="glyphicon glyph-micro pbi-glyph-close"></i></button></div></div></div><div ng-if="showLoadMore" class="loadmore"> <button ng-show="!disableLoadMore" ng-click="loadMoreNotification()" localize="UsersNotifications_LoadMore"></button><spinner ng-show="disableLoadMore" class="icon large centered"></spinner></div></div></div><spinner ng-show="$ctrl.userNotifications.loadingData" class="icon large centered"></spinner></section></div>'),e.put("components/workspacesContainer/workspacesContainer.html",'<div class="mainContent" ng-class="{\'initializing\': !$ctrl.initialized}"><div class="dashboardControls"><search-box should-focus="true" on-change="$ctrl.onSearchTextChange()" on-blur="$ctrl.resolveSearchTelemetry()" filter="$ctrl.searchText" placeholder="SearchContent"></search-box></div><div class="dashboardSliderMain" feature-switch-class="breadcrumbNavigationEnabled"><pbi-data-loader-spinner class="centered" ng-if="!$ctrl.groups"></pbi-data-loader-spinner><water-mark-message config="::$ctrl.watermarkConfig" ng-if="$ctrl.showWatermarkConfig"></water-mark-message><div class="galleryContainer workspacesGallery" feature-switch-class="breadcrumbNavigationEnabled" ng-if="$ctrl.groups"><content-tile-container tiles="$ctrl.groups" disable-lazy-loading="true" collapsible-pane-mode="false"></content-tile-container></div></div></div>'),e.put("views/bottomBar.html",'<div class="bottomBar" ng-hide="context.activeView === 2"><div class="dashboardConnectionsContainer"><dashboard-connections-dialog context="context.dashboardConnections"/></div><div class="dashboardConnectionsBtn unselectable" id="dashboardConnectionsBtn" ng-click="context.dashboardConnections.visible = !context.dashboardConnections.visible"><span localize="Landing_DashboardConnectionsButtonText"></span> <span>{{context.dashboardConnections.dashboardConnectionsCount}}</span><i class=\'ms-Icon ms-Icon--alert warningIcon\' ng-hide="!context.dashboardConnections.error"></i></div></div>'),e.put("views/collapsiblePane.html",'<div class="collapsiblePane" ng-class="{expanded: viewModel.isExpanded, hidden: !viewModel.isExpanded, smallWidth:viewModel.expandedWidth===1, mediumWidth:viewModel.expandedWidth===2, largeWidth:viewModel.expandedWidth===3}"><div class="innerLayout"><div class="contentFrameHost" ng-transclude></div><div class="expandButtonContainer"><div class="expanderBtn" ng-click="togglePane()" ng-hide="isExpanderHidden === true" localize-tooltip="ActivityPane_Tooltip"><i class="expandIcon glyphicon pbi-glyph-chevronleftmedium glyph-micro"></i></div></div></div></div>'),e.put("views/contentProviderStore/contentProviderSplash.html",'<div class="contentProviderSplash"><div ng-class="{welcome: screenState == 0}" class="container"><h1 ng-if="screenState == 0" localize="GetData_WelcomeTitle" class="title"></h1><h1 ng-if="screenState == 1" localize="GetData_GetData" class="title"></h1><h1 ng-if="screenState == 2" class="title">{{getSplashTitleForCurrentGroup()}}</h1><div ng-if="screenState == 0" class="desc"><div localize="GetData_WelcomeDescLine1"></div><div localize="GetData_WelcomeDescLine2"></div></div><div ng-if="screenState == 2 && !isMyWorkspace()" class="desc"><div localize="Groups_Splash_Description1"></div><div localize="Groups_Splash_Description2"></div></div><section class="helpSection"><span localize="GetData_TutorialLinkPreface_Text"></span><a localize="GetData_Try_This_Tutorial_Or_Watch_A_Video_1" href="https://go.microsoft.com/fwlink/p/?LinkId=522081" target=" _blank"></a><span localize="GetData_Try_This_Tutorial_Or_Watch_A_Video_2"></span><a localize="GetData_Try_This_Tutorial_Or_Watch_A_Video_3" href="javascript:void(0)" class="intoVideoButton" ng-click="showIntroductionVideoModal()"></a></section><section class="dataSourceTiles"><article class="dataSourceTileGroup"><h2 localize="GetData_ContentLibrary_Title"></h2><div class="dataSourceTile" ng-click="navigateToCategory(2, \'splashPage\')"><div class="tileContent"><h localize="GetData_MyOrganization" class="dataSourceTitle"></h><div localize="GetData_MyOrganizationDesc" class="dataSourceDesc"></div></div> <button class="getBtn biButton primary"><div localize="GetData_Get" class="btnLabel trimmedTextWithEllipsis" localize-tooltip="GetData_Get"></div><i class="glyphicon pbi-glyph-getdata glyph-small getDataIcon"></i></button></div><div class="dataSourceTile" id="serviceAppTile" ng-click="navigateToCategory(1, \'splashPage\')" feature-switch-not="serviceAppsDisabled"><div class="tileContent"><h localize="GetData_Services" class="dataSourceTitle"></h><div localize="GetData_ServicesDesc" class="dataSourceDesc"></div></div> <button class="getBtn biButton primary"><div localize="GetData_Get" class="btnLabel trimmedTextWithEllipsis" localize-tooltip="GetData_Get"></div><i class="glyphicon pbi-glyph-getdata glyph-small getDataIcon"></i></button></div><div class="separator"></div><footer><a ng-click="navigateToCategory(4, \'splashPage\')" href="javascript:void(0)"><i class="glyphicon pbi-glyph-paste glyph-small"></i> &nbsp;<span localize="GetData_Samples" class="text"></span></a><a href="https://go.microsoft.com/fwlink/?linkid=839715" target="_blank"><i class="glyphicon pbi-glyph-puzzle glyph-small"></i> &nbsp;<span localize="GetData_SolutionTemplates" class="text"></span></a><a href="https://go.microsoft.com/fwlink/?linkid=839714" target="_blank"><i class="glyphicon pbi-glyph-person glyph-small"></i> &nbsp;<span localize="GetData_PartnerShowcase" class="text"></span></a></footer></article><article class="dataSourceTileGroup"><h2 localize="GetData_UploadOrConnectData_Title"></h2><div class="dataSourceTile" ng-click="navigateToCategory(3, \'splashPage\')"><div class="tileContent"><h localize="GetData_Files" class="dataSourceTitle"></h><div localize="GetData_FilesDesc" class="dataSourceDesc"></div></div> <button class="getBtn biButton primary"><div localize="GetData_Get" class="btnLabel trimmedTextWithEllipsis" localize-tooltip="GetData_Get"></div><i class="glyphicon pbi-glyph-getdata glyph-small getDataIcon"></i></button></div><div class="dataSourceTile" ng-click="navigateToCategory(6, \'splashPage\')"><div class="tileContent"><h localize="GetData_Databases" class="dataSourceTitle"></h><div localize="GetData_Databases_Desc" class="dataSourceDesc"></div></div> <button class="getBtn biButton primary"><div localize="GetData_Get" class="btnLabel trimmedTextWithEllipsis" localize-tooltip="GetData_Get"></div><i class="glyphicon pbi-glyph-getdata glyph-small getDataIcon"></i></button></div><footer><a class="skipBtn" ng-click="navigateToContentList()" ng-if="inGroupWelcomeView()"><span localize="ContentList_SkipGetData" class="text"></span></a></footer></article></section></div></div>'),e.put("views/contentProviderStore/contentProviderSplashIntroVideoModal.html",'<iframe ng-src="https://go.microsoft.com/fwlink/?LinkID=761006" allowfullscreen></iframe><span localize="GetData_TutorialLinkPreface_Text"></span><a href="https://go.microsoft.com/fwlink/?LinkId=780853 " localize="GetData_Watch_Our_Video_Course_Or_Try_This_Tutorial_1" target="_blank"></a><span localize="GetData_Watch_Our_Video_Course_Or_Try_This_Tutorial_2"></span><a class="tutorialLink" localize="GetData_Watch_Our_Video_Course_Or_Try_This_Tutorial_3" href="https://go.microsoft.com/fwlink/p/?LinkId=522081" target="_blank"></a>'),e.put("views/contentProviderStore/customConfigHandlers/sharePointConfigHandler.html","<share-point-url-input></share-point-url-input>"),e.put("views/contentProviderStore/customConfigHandlers/sharePointUrlModal.html",'<div class="sharePointConfig"><div localize="SharePointSiteExample"></div> <input type="text" autofocus="" tabindex="1" ng-model="url"/><div class="notice infonav-dialogContentNotification typeInfo"><span class="glyphicon pbi-glyph-info glyph-mini"></span><span class="infonav-dialogContentNotificationText" localize="SharePoint_ModalNotification"></span></div><div ng-show="isLoading"><spinner class="xsmall"></spinner><span class="loading" localize="DataLoaderSpinner_LoadingMessage1"></span></div><div ng-show="hasError" class="error">{{errorMessage}}</div></div>'),e.put("views/contextMenu.html",'<div class="contextMenu" ng-class="contextMenuStyle"><div class="wrapper" ng-class="::arrowDirection"><div class="arrow"></div><dropdown-list><div class="metadata-container"><div ng-bind="context.source.displayName" class="title trimmedTextWithEllipsis" title="{{context.source.displayName}}"></div><div ng-click="close()" class="close-btn"><i class="glyphicon pbi-glyph-close glyph-mini"></i></div><div ng-repeat="metadata in context.metadata" class="metadata"><h6 class="metadataLabel" ng-bind="metadata.label"></h6><div ng-if="metadata.type === 0"> <span class="message">{{metadata.value()}}</span><span ng-if="metadata.infoTooltipConfig" class="glyphicon glyph-mini pbi-glyph-info tooltipIcon" tooltip tooltip-config="::metadata.infoTooltipConfig"></span></div><div ng-if="metadata.type === 2"> <span>{{ metadata.value() }}</span> <a ng-bind-attr="{href: metadata.linkUrl(), title: metadata.linkTitle() || metadata.linkText(), target: metadata.linkTarget}">{{ metadata.linkText() }}</a></div><div ng-if="metadata.type === 3"><span class="refreshFlyoutWarning" ng-if="metadata.isWarning == true"><i class="glyphicon pbi-glyph-error glyph-mini"></i></span> <a class="refreshHistory" href="" ng-click="metadata.actionOnClick();close();">{{metadata.value()}}</a></div><div ng-if="metadata.type === 4"><div ng-switch="metadata.status"><div ng-switch-when="0"><span class="glyphicon glyph-small pbi-glyph-error statusIcon"></span><span class="statusText" ng-bind="metadata.value"></span></div><div ng-switch-when="1"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color statusIcon"></span><span class="statusText" ng-bind="metadata.value"></span></div></div></div></div><hr/></div><dropdown-list-item ng-repeat="button in context.actions" class="contextMenuButton trimmedTextWithEllipsis" ng-click="button.action();close();"> <a ng-if="button.link" href="{{button.link}}" target="_blank" title="{{button.text}}">{{::button.text }}</a><span ng-if="!button.link" title="{{button.text}}" ng-bind="button.text"></span></dropdown-list-item></dropdown-list></div></div>'),e.put("views/dashboard.html",'<div class="dashboard" dashboard-printer><pbi-data-loader-spinner class="centered" ng-if="!viewModel.isLoaded && !isGroupTransitionDelayed && !showReloadDashboard"></pbi-data-loader-spinner><div class="error" ng-if="!viewModel.isLoaded && showReloadDashboard"><i class="glyphicon pbi-glyph-error glyph-large"></i><h3 localize="DashboardTilesLoadError_Title"></h3><span class="tileLoadErrorMessage" localize="DashboardTilesLoadError_Message1" localize-fragments><a fragment-index="0" href="https://support.powerbi.com" target="_blank" localize="DashboardTilesLoadError_Message2"></a><span fragment-index="1" localize="DashboardTilesLoadError_Message3"/></span> <button class="biButton primary" ng-click="reloadActiveDashboard()" localize="DashboardTilesLoadError_Reload"></button></div><ul class="tileContainer" ng-show="!showReloadDashboard" grid-layout id="dashboard{{viewModel.id}}"><dashboard-tile ng-repeat="tile in filteredTiles() track by tileTrackerFn(tile)" view-model="tile" can-edit="canEditTiles()" disable-pointer-events="{{::disablePointerEvents}}" grid-layout-item grid-layout-container="gridLayoutContainer" ng-repeat-finish-event="dashboardTileRepeatFinished" remove-tile-from-mobile-view="removeTileFromMobileView(tile)" in-edit-mobile-layout-mode="inEditMobileLayoutMode"></dashboard-tile></ul></div>'),e.put("views/dashboardContainer.html",'<div class="dashboardContainerView isNavigationPaneEnabled" ng-class="{isMainContentDisabled: collapsiblePaneMode !== 0 || showDashboardTileErrors,                isDashboardHeaderEnabled: showDashboardTileErrors,                isSelectedTileHighlighted: collapsiblePaneMode === 1 || collapsiblePaneMode === 7 || collapsiblePaneMode === 9 || showDashboardTileErrors,                isQuestionBoxHidden: !shouldDisplayQuestionBox}" ng-switch="getViewState()"><div class="mainContent" ng-switch-when="0"><div class="header" ng-if="!fullScreen.fullScreenMode"><div class="dashboardAppBar appBar"><div class="appBarSection left" ng-switch="refreshState"><ul ng-if="showBreadcrumb"><li class="label groupLabel"> <button class="activeDashboardLabel appBarTitle" title="{{groupService.activeGroup.displayName}}" ng-click="navigateToContentList()">{{groupService.activeGroup.displayName}}</button></li><li class="breadcrumbLabel"><i class="glyphicon pbi-glyph-arrowright glyph-small"></i></li><li class="label breadCrumbEnabled"> <span class="activeDashboardLabel appBarTitle" title="{{dashboardDataService.displayName}}">{{dashboardDataService.displayName}}</span><i ng-hide="dashboardDataService.activeDashboard.canEdit && !permissionService.isActiveWorkspaceIsReadOnly" class="readonlyIcon glyphicon pbi-glyph-lock glyph-mini"></i></li><li class="label dataClassificationSection"><data-classification-label data-classification-id="dashboardDataService.activeDashboard.dataClassificationId"></data-classification-label></li></ul><section class="notification" ng-switch-when="1"><spinner modern></spinner><span class="notificationText" localize="DashboardContainer_RefreshInProgress"></span></section><section class="notification" ng-switch-when="2"><span class="glyphicon glyph-small pbi-glyph-success icon"></span><span class="notificationText" localize="DashboardContainer_RefreshCompleted"></span></section></div><div class="appBarSection right"><app-action-menu ng-if="inAppArtifactView()"></app-action-menu><ul class="optionsMenu"><li ng-if="showAddTileButton()"> <button ng-click="showTileGalleryPane()" localize-tooltip="DashboardAppBar_AddTile" id="addTile"><i class="glyphicon pbi-glyph-add icon smallIcon"></i><span class="appBarMenuItem" localize="DashboardAppBar_AddTile"></span></button></li><li ng-if="showUsageMetricsButton()"> <button ng-click="openUsageMetricsReport()" localize-tooltip="UsageMetrics_Tooltip" id="addTile"><i class="glyphicon pbi-glyph-chart icon smallIcon"></i><span class="appBarMenuItem" localize="UsageMetrics_Label"></span></button></li><li ng-if="showViewRelatedButton()"> <button ng-click="showRelatedContentPane()" localize-tooltip="DashboardAppBar_ViewRelated"><i class="glyphicon pbi-glyph-relationship icon smallIcon"></i><span class="appBarMenuItem" localize="DashboardAppBar_ViewRelated"></span></button></li><li ng-if="showHomeDashboardButton() && !isOnHomeDashboard"> <button ng-click="setHomeDashboard()" class="setFeatured" localize-tooltip="SetFeaturedDashboardButton"><i class="glyphicon pbi-glyph-gauge glyph-small"></i><span class="appBarMenuItem" localize="SetFeaturedDashboardButton"></span></button></li><li ng-if="showHomeDashboardButton() && isOnHomeDashboard"> <button ng-click="unsetHomeDashboard()" class="unsetFeatured" localize-tooltip="NavigationPane_DisableFeaturedDashboard"><i class="glyphicon pbi-glyph-gauge glyph-small"></i><span class="appBarMenuItem" localize="NavigationPane_DisableFeaturedDashboard"></span></button></li><li ng-if="favoriteEnabled && !dashboardDataService.activeDashboard.isFavorite"> <button ng-click="addDashboardFavorite()" ng-disabled="dashboardDataService.activeDashboard.id < 0 || dashboardDataService.activeDashboard.isFavoriteDisabled" class="addFavorite" localize-tooltip="Artifact_Favorite"><i class="powervisuals-glyph star-empty glyph-small icon"></i><span class="appBarMenuItem" localize="Artifact_Favorite"></span></button></li><li ng-if="favoriteEnabled && dashboardDataService.activeDashboard.isFavorite"> <button ng-click="deleteDashboardFavorite()" ng-disabled="dashboardDataService.activeDashboard.isFavoriteDisabled" class="deleteFavorite" localize-tooltip="Artifact_UnFavorite"><i class="powervisuals-glyph star-full glyph-small icon"></i><span class="appBarMenuItem" localize="Artifact_UnFavorite"></span></button></li><li ng-if="isEmailSubscriptionEnabled()" class="subscription" localize-tooltip="ReportAppBar_Subscribe" ng-click="showSubscriptionPane()"><i class="glyphicon pbi-glyph-mail glyph-small"></i><span localize="ReportAppBar_Subscribe"></span></li><li ng-if="isInstantEmailEnabled()" class="subscription" localize-tooltip="ReportAppBar_SentInstantEmail" ng-click="showInstantEmailPane()"><i class="glyphicon pbi-glyph-mail glyph-small"></i><span localize="ReportAppBar_SentInstantEmail"></span></li><li> <button ng-click="showShareSlider()" class="shareDashboardButton" localize-tooltip="ReportAppBar_ShareButton" ng-if="sharingEnabled()"><i class="glyphicon pbi-glyph-share glyph-small icon"></i><span class="appBarMenuItem" localize="ReportAppBar_ShareButton"></span></button></li><authoring-drop-down-menu selected-item="0"></authoring-drop-down-menu><li class="moreOptionsItem"> <button id="optionsBtn" class="moreOptionsDashboardButton" ng-click="showMoreOptionsMenu($event)" ng-if="isMoreOptionsMenuAvailable()" localize-tooltip="Options_Menu"><i class="glyphicon glyph-small pbi-glyph-more"></i></button></li></ul> <span class="dashboardTileErrors trimmedTextWithEllipsis" ng-if="dashboardTileErrorCount>0"><div class="badge mini-label" ng-bind="dashboardTileErrorCount" ng-click="showTileErrorDetails()"></div><i class="glyphicon glyph-small pbi-glyph-warning" ng-click="showTileErrorDetails()"></i><span class="errorMessage"><span localize="DashboardAppBar_TileError"></span><span class="errorToggle" ng-switch="showDashboardTileErrors" ng-click="toggleTileError()"><span ng-switch-when="true" localize="DashboardAppBar_TileError_HideErrors"></span><span ng-switch-when="false" localize="DashboardAppBar_TileError_ShowErrors"></span></span></span></span></div></div><div class="dashboardControlsWrapper" ng-if="shouldDisplayQuestionBox"><qna-input-launcher ng-if="dashboardDataService.activeDashboardContainsQnaSupportedModel" models="dashboardDataService.activeDashboardModels" show-qna="showQna"></qna-input-launcher></div></div><div class="dashboardSliderMain fillAvailableSpace"><div class="dashboardViewSlider"><dashboard disable-tile-ease-in="true" view-model="dashboardDataService.activeDashboard" display-layout="0" is-group-transition-delayed="groupService.isGroupTransitionDelayed"></dashboard></div></div></div><water-mark-message config="errorMessageConfig" ng-switch-when="1"></water-mark-message></div>'),
e.put("views/devToolsView.html",'<div class="devToolsView"><title-bar></title-bar><dev-tools-main-container></dev-tools-main-container></div>'),e.put("views/dropdowns/appBarAuthoringMenu.html",'<dropdown-overlay dropdown-overlay-name="authorOptionsMenu" dropdown-overlay-class="mobileAuthoringAdditionalMenus angular-dropdown override-box-shadow angular-dropdown-authoring mobileAuthoringSelector"><ul class="mobileAuthoringAdditionalMenus angular-dropdown angular-dropdown-authoring active additionalMenus" ng-class="{dark: getMode() === 0}"><li ng-repeat="item in getMenuActions()" class="dropdown-item moreOptions" ng-class="{selectedItem: item.checked}" ng-mousedown="menuActionSelected(item); $event.stopPropagation();"><a href="" target="_blank"><div class="dropdown-content angular-dropdown-authoring"><i class="dropdown-icon {{::item.iconClass}}"></i><div class="dropdown-label" ng-bind="::item.text"></div><span ng-if="item.numberOfNewTiles" class="numberOfNewTilesBadge" ng-bind="item.numberOfNewTiles"></span></div></a></li></ul></dropdown-overlay>'),e.put("views/dropdowns/insightsExplore.html",'<dropdown-overlay dropdown-overlay-name="insightsExplore"><insights-explore args="args"></insights-explore></dropdown-overlay>'),e.put("views/dropdowns/navigationBarSettingsMenu.html",'<dropdown-overlay dropdown-overlay-name="settingsMenu" dropdown-overlay-class="angular-dropdown navigationBar-contextMenu override-box-shadow"><ul class="navigationBar-contextMenu active" ng-attr-read-only="{{!canWrite()}}"><li ng-if="::showQuotaManagement()" class="dropdown-item addBorderBottom quotaManagement" ng-click="onManageStorageSelected()"> <button class="dropdown-content "><usage-bar-menu-item label-class="lableItem"></usage-bar-menu-item></button></li><li class="orgApps" ng-if="::showContentPacks()"><div class="dropdown-item addBorderBottom" ng-click="onCreateContentPackSelected()"> <button class="dropdown-content dropdown-label" localize="TopNav_SettingsMenu_CreateContentPack"/></div><div class="dropdown-item addBorderBottom" ng-click="onViewContentPackSelected()"> <button class="dropdown-content dropdown-label" localize="TopNav_SettingsMenu_ViewContentPack"/></div></li><li ng-if="::showAdminPortal()" class="dropdown-item addBorderBottom manageAdminPortal" ng-click="onAdminPortalSelected()"> <button class="dropdown-content dropdown-label" localize="AdminPortal_Title"/></li><li ng-if="::showManageGateways()" class="dropdown-item addBorderBottom manageGateways" ng-click="onManageGatewaysSelected()"> <button class="dropdown-content dropdown-label" localize="TopNav_SettingsMenu_ManageGateways"/></li><li class="dropdown-item addBorderBottom manageSettings" ng-click="onPowerBISettingsSelected()"> <button class="dropdown-content dropdown-label" localize="TopNav_SettingsMenu_PowerBISettings"/></li><li ng-if="::showPublishToWeb()" class="dropdown-item addBorderBottom manageEmbedCodes" ng-click="onManageEmbedSelected()"> <button class="dropdown-content dropdown-label" localize="TopNav_SettingsMenu_ManageEmbedCodes"/></li><li ng-if="::showArchivedContentLink" class="dropdown-item addBorderBottom" ng-click="showArchivedContent()"> <button class="dropdown-content dropdown-label" localize="NavigationPane_ArchivedContent"/></li></ul></dropdown-overlay>'),e.put("views/dropdowns/tileOptionsMenu.html",'<dropdown-overlay dropdown-overlay-name="tileOptionsMenu" dropdown-overlay-class="angular-dropdown tileOptionsMenuNew"><ul><li ng-repeat="item in ::items" ng-click="item.action($event)" ng-switch="!!item.link"><a ng-switch-when="true" ng-attr-href="{{item.link.href}}" ng-attr-target="{{item.link.target}}" rel="noopener noreferrer" title="{{::item.title}}"><i ng-class="item.iconClass" class="glyphicon glyph-small"></i><span ng-bind="::item.text"></span></a> <button ng-switch-when="false" ng-class="item.buttonClass" title="{{::item.title}}"><i ng-class="item.iconClass" class="glyphicon glyph-small"></i><span ng-bind="::item.text"></span></button></li></ul></dropdown-overlay>'),e.put("views/excelUploadFormat.html",'<div class="excelContent"><div class="uploadFormat"><header><h1 class="title" localize="UploadExcelLocalFile_ChooseFormat"></h1><div class="text" localize="UploadExcel_ChooseFormatDescription"></div></header><table class="contentContainer"><tr class="contentItem"><td class="optionColumn"><div class="imageContainer"><div class="importDataIntoPowerBI"></div></div></td><td></td><td class="optionColumn"><div class="imageContainer"><div class="viewExcelInPowerView"></div></div></td></tr><tr class="spacer"></tr><tr class="contentItem"><td class="optionColumn"><span class="contentItemTitle" localize="UploadExcel_ChooseFormat_ImportData"></span></td><td class="seperatorColumn"><span class="contentItemTitle" localize="UploadExcel_ChooseFormat_Or"></span></td><td class="optionColumn"><span class="contentItemTitle" localize="UploadExcelLocalFile_ChooseFormat_ViewExcel"></span></td></tr><tr class="contentItem"><td class="optionColumn"><div class="contentItemDescription"><span localize="UploadExcelLocalFile_ChooseFormat_ImportDataDescription"></span></div></td><td></td><td class="optionColumn"><div class="contentItemDescription"><span localize="UploadExcelLocalFile_ChooseFormat_ViewExcelDescription"></span></div></td></tr><tr class="contentItem"><td class="optionColumn"><div class="contentBtnItem"> <button class="buttonProviderFormat submitBtn BigBtn importDataBtn" ng-click="chooseFormat(0)" ng-disabled="inProgress"><span localize="UploadExcel_ChooseFormat_Import"></span><i class="arrow glyphicon pbi-glyph-getdata glyph-small getDataIcon"></i></button></div></td><td></td><td class="optionColumn"><div class="contentBtnItem"> <button class="buttonProviderFormat submitBtn BigBtn viewExcelBtn" ng-click="chooseFormat(1)" ng-disabled="inProgress"><span localize="UploadExcelLocalFile_ChooseFormat_Upload"></span><i class="arrow glyphicon pbi-glyph-getdata glyph-small getDataIcon"></i></button></div></td></tr></table></div></div>'),e.put("views/explorationContainer.html",'<div class="explorationContainer explorationWithChrome" ng-class="{\'editing\' : (viewModeState.getMode() === 1 || viewModeState.getMode() === 2),    \'reading\': viewModeState.getMode() === 0}"><section class="appBar" ng-if="viewModel.options.showAppBar"><exploration-app-bar view-model="viewModel"></exploration-app-bar><app-action-menu ng-if="inAppArtifactView()"></app-action-menu></section><div class="explorationHost" ng-class="{ \'explorationHostNoAppBar\': !viewModel.options.showAppBar }"><exploration-host view-model="viewModel" id="pvExplorationHost"><task-pane view-model="viewModel.taskPane" ng-if="viewModeState.getMode() === 1 || viewModeState.getMode() === 2" field-list-config="::fieldListConfig" ng-show="viewModel.options.showTaskPane" resizable resizable-containerid="pvExplorationHost" resizable-sibling="visualizationPane" resizable-expanded="{{viewModel.taskPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"></task-pane><visualization-pane view-model="viewModel.visualizationPane" ng-show="isVisualizationPaneVisible()" resizable resizable-containerid="pvExplorationHost" resizable-sibling="taskPane" resizable-expanded="{{viewModel.visualizationPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"></visualization-pane><div class="sidePane visualizationPane rightSidePane smallFontSize" ng-if="viewModel.bookmarksPane.isPaneVisible" pbi-lazy-load-contents="exploreUIShellConfig" resizable resizable-containerid="pvExplorationHost" resizable-sibling="taskPane" resizable-expanded="true" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"><bookmarks-pane view-model="viewModel.bookmarksPane" bookmarks="viewModel.exploration.contract.bookmarks" selected-index="viewModel.exploration.contract.activeBookmarkIndex"></bookmarks-pane></div><div class="sidePane visualizationPane rightSidePane smallFontSize" ng-if="viewModel.canvasItemsPane.isPaneVisible" pbi-lazy-load-contents="exploreUIShellConfig" resizable resizable-containerid="pvExplorationHost" resizable-sibling="taskPane" resizable-expanded="true" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32" feature-switch="canvasItemsPane"><canvas-items-pane view-model="viewModel.canvasItemsPane" section="viewModel.exploration.contract.sections[viewModel.exploration.contract.activeSectionIndex]"></canvas-items-pane></div><div class="horizontalItemsContainer"><exploration view-model="viewModel.exploration" ng-class="{\'exploreCanvasToBottom\': !isFooterVisible()}" canvas-options="canvasOptions" should-set-focus="true"></exploration><exploration-footer ng-show="isFooterVisible()" view-model="viewModel"></exploration-footer></div></exploration-host></div><div class="explorationMask" ng-if="viewModel.showMask"><div class="centeredSpinner"><spinner></spinner></div></div><div class="canvasSpinnerBackground" ng-if="viewModel.showSpinner"><pbi-data-loader-spinner class="centered"></pbi-data-loader-spinner></div></div>'),e.put("views/fullScreenControls.html",'<div class="fullScreenBtnHost"><div ng-if="fullScreen.fullScreenMode"> <button class="fullScreenBrowserBack floatingViewBtn" localize-tooltip="Back_In_Browser" ng-click="navigation.navigateBack()"><i class="glyphicon pbi-glyph-pageleft"></i><span localize="FullScreen_Back"></span></button><span ng-if="navigation.inReportView() || navigation.inDatasetView()"><span class="floatingViewDivider"></span> <button class="fullScreenPrevious floatingViewBtn" localize-tooltip="Previous_Report_Page" ng-click="fullScreen.fullScreenPreviousPage()"><i class="glyphicon pbi-glyph-chevronleftmedium"></i></button> <button class="fullScreenNext floatingViewBtn" localize-tooltip="Next_Report_Page" ng-click="fullScreen.fullScreenNextPage()"><i class="glyphicon pbi-glyph-chevronrightmedium"></i></button></span><span class="floatingViewDivider"></span> <button class="printBtn floatingViewBtn" localize-tooltip="FullScreen_Print" ng-click="print()"><i class="glyphicon pbi-glyph-print"></i></button> <button class="fitContentBtn floatingViewBtn" localize-tooltip="FullScreen_FitToScreen" ng-if="navigation.inDashboardView()" ng-click="toggleFitContent()"><i class="glyphicon pbi-glyph-fittopage"></i></button> <button class="fitWidthBtn floatingViewBtn" localize-tooltip="FullScreen_FitToWidth" ng-if="navigation.inDashboardView()" ng-click="toggleFitWidth()"><i class="glyphicon pbi-glyph-fittowidth"></i></button> <button class="exitFullScreenBtn floatingViewBtn" ng-click="exitFullScreen()" localize-tooltip="FullScreen_Exit"><i class="glyphicon pbi-glyph-fullscreenexit"></i></button></div></div>'),e.put("views/groupNavigationPaneListItem.html",'<li class="navPaneListItem" ng-right-click="showContextMenuIfEnabled()" ng-class="{selected: selected === true, active: showContextMenu === true}" data-id="{{::viewModel.id}}"><div class="navPaneItemIcon" ng-switch on="model.icon"><div ng-switch-when="3" class="groupsListItemIcon defaultGroupIcon"></div><div ng-switch-when="4" class="groupsListItemIcon groupsUserPhoto" ng-style="userPhoto ?{\'background-image\': userPhoto,\'background-size\':\'cover\',\'background-position\':\'0px 0px\'}:\'\'"></div></div><div class="navPaneListItemName trimmed groupNavPaneListItemName"><div class="textLabel" title="{{model.source.displayName}}">{{model.source.displayName}}</div></div></li>'),e.put("views/historyDialogView.html",'<div><modal-dialog class="historyDialog" history-dialog="viewModel" view-model="dialogModel" ng-if="viewModel.showModalDialog" on-cancel-action="closeDialog()" on-confirm-action="closeDialog()"><div class="title"><span localize="HistoryDialog_Title"></span></div><div class="model-package-selection"><span ng-class="{\'active\': refreshTypeSelected === 0}" ng-click="refreshTypeSelected = 0" localize="HistoryDialog_ScheduledTab"></span><span ng-class="{\'active\': refreshTypeSelected === 1}" ng-click="refreshTypeSelected = 1" localize="HistoryDialog_OneDriveTab"></span></div><div class="historyTableContainer"><table class="historyTable"><thead class="historyTableHeader"><tr><th class="historyDetails" localize="HistoryDialog_TableHeader_Details"></th><th class="historyType" localize="HistoryDialog_TableHeader_Type"></th><th class="historyStart" localize="HistoryDialog_TableHeader_Start"></th><th class="historyEnd" localize="HistoryDialog_TableHeader_End"></th><th class="historyStatus" localize="HistoryDialog_TableHeader_Status"></th><th class="historyFailMessage" localize="HistoryDialog_TableHeader_FailMessage"></th></tr></thead><tbody class="historyTableBody" ng-repeat="history in getSelectedHistories(refreshTypeSelected)" ng-init="detailExpand=false"><tr><td class="errorDetailsLink"><div ng-show="history.isSuccessful===false" ng-switch="detailExpand" ng-click="detailExpand=!detailExpand"><span localize="HistoryDialog_RefreshDetail_Show" ng-switch-when="false"></span><span localize="HistoryDialog_RefreshDetail_Hide" ng-switch-when="true"></span></div></td><td class="historyType" ng-switch="isScheduledRefresh(history)"><span ng-switch-when=true localize="HistoryDialog_RefreshType_Scheduled"></span><span ng-switch-when=false localize="HistoryDialog_RefreshType_OnDemand"></span></td><td class="historyStart"><span ng-bind="::history.startTime"/></td><td class="historyEnd"><span ng-bind="::history.endTime"/></td><td class="historyStatus"><span ng-bind="::history.status"/></td><td class="historyFailMessage"><span ng-bind="::history.friendlyErrorMessage"/></td></tr><tr class="historyErrorDetails" ng-if="detailExpand"><td colspan="9"><inline-name-value-pairs mode="\'info\'" show-title="false" detail-expand="true" name-value-pairs="history.details"></inline-name-value-pairs></td></tr></tbody></table></div></modal-dialog></div>'),e.put("views/inFocus.html",'<div class="inFocusContainer" ng-if="showInFocusMode"><div class="inFocusAppBar appBar"><div class="appBarSection left"><ul><li> <button class="iconBox" ng-click="hide()"><i class="glyphicon pbi-glyph-arrowleft glyph-small"></i><span class="dashboardTitle link appBarMenuItem" localize="InFocus_ExitInFocus"></span></button></li><li class="appBarDivider"></li><li class="focusTitle appBarTitle" ng-bind="viewModel.displayText"></li><li class="focusSubtitle appBarText" ng-bind="viewModel.subDisplayText"></li></ul></div><div class="appBarSection right" ng-class="{readOnlyMode: !(canEdit || viewModel.openInsightArgs.canPin), insights: viewModel.openInsightArgs != null}" ng-if="viewModel.inFocusTile"><ul><li class="lastRefreshTimestamp appBarText metadata" ng-if="viewModel.inFocusTile.formattedTime"><span class="caption" localize="InFocus_RefreshTime"></span><span ng-bind="viewModel.inFocusTile.formattedTime"></span></li><li class="appBarDivider"></li><li class="getRelatedInsightsBtn" localize-tooltip="Insights_GetRelatedInsights_Tooltip" ng-if="relatedInsightsEnabled"> <button ng-click="getRelatedInsights()"><i class="glyphicon pbi-glyph-insight glyph-small"></i><span class="appBarMenuItem" ng-bind="viewModel.getRelatedInsightsText"></span></button></li><li class="pinBtn" ng-if="viewModel.inFocusTile && viewModel.inFocusTile.type != 5 && viewModel.inFocusTile.type != 8"> <button ng-click="pinVisual()"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span class="appBarMenuItem" ng-bind="viewModel.pinVisualText"></span></button></li><li class="moreOptionsItem"> <button dropdown-menu class="moreOptionsInFocusButton" dropdown-items="inFocusMenuItems" dropdown-on-item-selected="inFocusMenuItemSelected(selected)" dropdown-class="additionalMenus"><i class="glyphicon pbi-glyph-more glyph-small"></i></button></li></ul></div></div><div ng-if="viewModel.inFocusTile" ng-switch="viewModel.inFocusTile.type"><section class="explorationContainer inFocus" ng-switch-when="0"><exploration-host ng-if="viewModel.showVisualEnabled && !inFocusDrillableError" class="explorationHost inFocusBody" view-model="viewModel" id="inFocusExpHost"><task-pane view-model="viewModel.taskPane" field-list-config="::fieldListConfig" ng-if="viewModeState.getMode() === 1" resizable resizable-containerid="InFocusExpHost" resizable-sibling="visualizationPane" resizable-expanded="{{viewModel.taskPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"></task-pane><visualization-pane class="inFocusVizPane" view-model="viewModel.visualizationPane" resizable resizable-containerid="InFocusExpHost" resizable-sibling="taskPane" resizable-expanded="{{viewModel.visualizationPane.isPaneExpanded}}" resizable-default-width="180" resizable-min-width="180" resizable-max-width="420" resizable-collapsed-width="32"></visualization-pane><insights-pane ng-if="viewModel.showInsightsPane" model="viewModel.inFocusTile.datasetModel.contract" visual-contract="viewModel.canvas.visual.visualContainer.contract" exploration-contract="viewModel.canvas.exploration.contract" tile-action="viewModel.inFocusTile.action.action" visual-title="viewModel.displayText + \' \' + viewModel.subDisplayText" visual="viewModel.canvas.visual.visualContainer.readOnlyState.visual" parent-event="openInFocusEvent"></insights-pane><div class="exploration"> <button class="previousVisualButton" ng-if="viewModel.showPreviousVisualButton" ng-click="showPreviousVisual()"><i class="glyphicon iconBox pbi-glyph-chevronleftmedium glyph-small"></i><span localize="InFocus_PreviousVisual"></span></button><explore-canvas view-model="::viewModel.canvas.exploration.exploreCanvas"></explore-canvas><div class="sourceInfo"> <button class="sourceStyle" ng-if="viewModel.inFocusTile.report" ng-click="openReport()" ng-bind="viewModel.source"></button><div class="insightFeedbackStyle" ng-if="viewModel.openInsightArgs.insightContainerModel && viewModel.openInsightArgs.showInsightsEvent"><span localize="Insights_FeedbackLink"></span> <button ng-click="logInsightFeedback(true)" class="insightFeedbackButton" localize="Insights_FeedbackYes"></button> <button ng-click="logInsightFeedback(false)" class="insightFeedbackButton" localize="Insights_FeedbackNo"></button></div></div></div></exploration-host><water-mark-message ng-if="inFocusDrillableError" config="errorMessageConfig"></water-mark-message><div class="inFocusCenteredSpinner" ng-show="!viewModel.inFocusTile"><spinner modern delay="1000"></spinner></div></section><workbook-tile on-resize="handleResize(width, height)" view-model="viewModel.workbook" class="explorationContainer inFocus" ng-switch-when="5"></workbook-tile><real-time-tile on-resize="handleResize(width, height)" view-model="viewModel.realTime" class="realTimeTile inFocus" ng-switch-when="8"></real-time-tile></div></div>'),e.put("views/insights/insights.html",'<div class="sliderContentView insightsSliderContentView"><insights-canvas view-model="viewModel.insightsCanvasModel"></insights-canvas></div>'),e.put("views/landingContainer.html",'<div class="landingContainer"><notification-toast></notification-toast><full-screen-controls></full-screen-controls><div class="waitingContainer" ng-if="showLoadingSpinner()"><div class="spinnerWithText"><spinner class="large"></spinner><div class="loadingText" localize="Loading_Text"></div></div></div><div id="favoritesLandingContainer" class="favoritesRootContent" ng-if="inFavoritesView()"><favorites-container collapsible-pane-mode="viewModel.collapsiblePaneMode"></favorites-container></div><div id="appsLandingContainer" class="appsRootContent" ng-if="inAppsView()"><apps-container></apps-container></div><div id="installedAppLandingContainer" ng-if="inAppDetailView()"><app-container></app-container></div><div id="workspacesLandingContainer" class="workspacesRootContent" ng-if="inWorkspacesView()"><workspaces-container></workspaces-container></div><div id="contentListLandingContainer" class="contentListRootContent" ng-if="!groupService.isGroupTransitionDelayed && isContentListActive"><content-list-container-v2 collapsible-pane-mode="viewModel.collapsiblePaneMode"></content-list-container-v2></div><div id="dashboardLandingContainer" class="landingRootContent" ng-if="isDashboardLandingContainerActive && !showLoadingForDashboard() && !inQnaModelView() && !inQnaView()" ng-class="{inApps: inAppView()}"><dashboard-container view-model="viewModel.dashboardContainer" collapsible-pane-mode="viewModel.collapsiblePaneMode" is-active="isDashboardLandingContainerActive"></dashboard-container></div><div id="reportLandingContainer" class="landingRootContent reportContainerContent" ng-if="inReportView() && !inQnaModelView()" ng-class="{inApps: inAppView()}"><exploration-container view-model="viewModel.explorationContainer" exploration-container-options="explorationContainerOptions"></exploration-container></div><div id="workbookLandingContainer" class="landingRootContent workbookContainerContent" ng-if="inWorkbookView()" ng-class="{inApps: inAppView()}"><workbook-container view-model="viewModel.workbookContainer"></workbook-container></div><div id="qnaLandingContainer" class="landingRootContent" ng-if="inQnaModelView() || inQnaView()" ng-class="{inApps: inAppView()}"><qna-container view-model="viewModel.qnaContainer" collapsible-pane-mode="viewModel.collapsiblePaneMode"></qna-container></div><div in-focus ng-if="::isInitialized" can-edit="dashboardDataService.activeDashboard.canEdit"></div><content-provider-splash screen-state="2" class="isGroupWelcome" ng-if="inGroupWelcomeView()"></content-provider-splash><div class="sliderPane unselectable" ng-if="navigation.inContentSliderView()" ui-view="contentSlider"></div></div>'),e.put("views/loadNotificationDialog.html",'<div class="contentProviderLoadNotificationContent"><span class="pbi-spinner"></span><span class="contentProviderLoadNotificationMessage" localize="ParametersLoadingMessage"></span></div>'),e.put("views/localFileBrowser.html",'<div> <input class="browseFileInput" type="file" accept="{{fileDialogFilter}}"/></div>'),e.put("views/manageEmbedView.html",'<div class="sliderContentView manageEmbed"><user-group-header view-model="userGroupHeader"></user-group-header><div class="tableArea"><div class="centeredSpinner" ng-if="!isLoaded"><spinner modern></spinner></div><div ng-if="isLoaded" ng-switch="embeddedResources.length> 0"><table class="manageEmbedTable" ng-switch-when="true"><thead><tr><th class="associatedReport" ng-click="updateSortProperty(\'associatedReport.displayName\')" localize="ManageEmbed_AssociatedReport_Header"></th><th class="status" ng-click="updateSortProperty(\'status\')" localize="ManageEmbed_Status_Header"></th><th class="dateCreated" ng-click="updateSortProperty(\'dateCreatedSortable\')" localize="ManageEmbed_DateCreated_Header"></th><th class="actions header"></th></tr></thead><tbody><tr ng-repeat="resource in embeddedResources | orderBy:sortProperty:sortDescending track by resource.uniqueId"><td class="itemField trimmedTextWithEllipsis" ng-bind="resource.associatedReport.displayName"></td><td class="itemField trimmedTextWithEllipsis" ng-bind="resource.status"></td><td class="itemField trimmedTextWithEllipsis" ng-bind="resource.dateCreated"></td><td class="actionsField"><a href="" class="glyphicon glyph-small pbi-glyph-more" ng-click="$event.stopPropagation();toggleFlyout($event, resource)" localize-tooltip="NavigationPane_OpenMenu"></a></td></tr></tbody></table><div class="manageEmbedTableEmpty" ng-switch-when="false"><i class="glyphicon pbi-glyph-warning glyph-med warningIcon"></i><h2 localize="ManageEmbed_NoEmbedCodesWarningTitle"></h2><p localize="ManageEmbed_NoEmbedCodesWarningText"></p></div></div></div></div>'),e.put("views/manageStorageView.html",'<div class="sliderContentView"><div class="manageStorage"><user-group-header view-model="userGroupHeader"></user-group-header><usage-bar usage-bar-model="viewModel.usageBarModel" view-model="viewModel"></usage-bar><div class="actionButtons"> <button class="primary submit" type="button" ng-if="::allowProTrial()" ng-click="tryItFree()"><span ng-bind="viewModel.tryItFreeText"></span></button> <button class="primary submit" type="button" ng-if="::!viewModel.isPremiumUser" ng-click="upgrade()"><span localize="QuotaManagement_UpgradeAccount"></span></button></div><div class="storageArea"><div class="own" role="tablist"><div class="tab" ng-click="viewModel.ownedByMeSelected=true" ng-switch on="viewModel.isMyWorkspace" role="tab"><div localize="QuotaManagement_OwnedByMe" ng-switch-when="true"></div><div localize="QuotaManagement_OwnedByUs" ng-switch-when="false"></div><div class="highlight" ng-if="viewModel.ownedByMeSelected"></div></div><div class="tab" ng-click="viewModel.ownedByMeSelected=false" role="tab"><div localize="QuotaManagement_OwnedByOthers"></div><div class="highlight" ng-if="!viewModel.ownedByMeSelected"></div></div></div><div class="usageList"><table class="usageListTable"><thead><tr><th class="delete"></th><th class="name header" localize="QuotaManagement_ModelName"></th><th class="size header" localize="QuotaManagement_ModelSize"></th><th class="type header" localize="QuotaManagement_ModelType"></th><th class="lastRefresh header" localize="QuotaManagement_ModelLastRefreshedTime"></th><th class="associated header" localize="QuotaManagement_AssociatedDashboards"></th><th class="associated header" localize="QuotaManagement_AssociatedReports"></th></tr></thead><tbody><tr class="ms-font-weight-regular" ng-repeat="usage in viewModel.usageDetails|filter:{ownedByMe: viewModel.ownedByMeSelected}|filter:isInVisibleDashboard(dashboardsFromModel)| orderBy:\'-sizeInMBs\'"><td class="deleteIcon" ng-click="deleteModel(usage)" localize-tooltip="QuotaManagement_DeleteButtonText"><div class="btn-delete"></div></td><td class="itemField" title="{{usage.name}}" ng-bind="usage.name"></td><td class="itemField" ng-bind="usage.sizeWithUnit"></td><td class="itemField" ng-bind="usage.typeText"></td><td class="itemField" ng-bind="usage.lastRefreshTime"></td><td class="itemField associated" title="{{usage.associatedDashboards}}" ng-bind="usage.associatedDashboards"></td><td class="itemField associated" title="{{usage.associatedReports}}" ng-bind="usage.associatedReports"></td></tr></tbody></table></div></div></div></div>'),e.put("views/navigationBar.html",'<div id="topBar" class="unselectable fadeIn"><div class="topNavLeft"><o365-application-launcher ng-if="::shellCapabilities.showO365Launcher"></o365-application-launcher><pbi-logo config="logoConfig" ng-click="navigateToLanding()"></pbi-logo></div><breadcrumbs></breadcrumbs><div class="topNavRight"><span class="topNavTrialStatus" ng-if="::getProTrialStatus()" ng-bind="::getProTrialStatus()" ng-click="promptForUpgrade()"></span> <button class="enterFullScreenBtn topNavButton" ng-if="fullScreen.enterFullScreenSupported" localize-tooltip="TopNav_FullScreen_Enter" ng-click="enterFullScreen()"><i class="glyphicon glyph-small pbi-glyph-fullscreen"></i></button> <button class="notificationsBtn topNavButton" ng-if="::shellCapabilities.showNavBarNotifications" localize-tooltip="UsersNotifications_BadgeTooltip" ng-click="showUserNotifications()"><i class="glyphicon glyph-small pbi-glyph-notification-center"></i> <span ng-if="getUserNotificationsCount()>0" class="badge" ng-class="{\'warning\': getHighestNotificationLevel(userNotifications) === 2}" ng-bind="getUserNotificationsCount()"></span></button> <button id="settingsMenuBtn" class="topNavButton" ng-if="::shellCapabilities.showNavBarSettings" ng-click="showSettingsMenu($event)" localize-tooltip="TopNav_Settings"><i class="glyphicon glyph-small pbi-glyph-gear"></i></button> <button id="downloadMenuBtn" class="topNavButton" ng-click="showMenu(\'downloadMenu\', downloadMenu, $event)" localize-tooltip="TopNav_Download"><i class="glyphicon glyph-small pbi-glyph-download"></i></button> <button id="helpMenuBtn" class="topNavButton" ng-click="showHelpMenu($event)" localize-tooltip="TopNav_Help"><i class="glyphicon glyph-small pbi-glyph-question"></i></button><pbi-button kind="icon" icon-name="smiley" icon-size="small" no-label="" class="topNavButton" ng-click="showFeedbackContextMenu($event)" localize-tooltip="TopNav_Feedback"></pbi-button> <button id="powerBIUserInfoBtn" class="powerBIUserInfoButton" localize-tooltip="TopNav_ProfileText" ng-click="showUserInfoMenu($event)" ng-style="userPhoto ? {\'background-image\': userPhoto, \'background-size\':\'cover\', \'background-position\':\'0px 0px\'} : \'\'"><i ng-if="!userPhoto" class="glyphicon glyph-small pbi-glyph-user"></i></button></div></div>'),e.put("views/navigationPaneListItem.html",'<li class="navPaneListItem" ng-right-click="showContextMenuIfEnabled()" ng-class="{selected: selected, active: showContextMenu}" data-id="{{::viewModel.id}}"><div class="navPaneItemIcon" ng-if="::!newStyle" ng-switch="isRefreshInProgress()"><spinner ng-switch-when="true" localize-tooltip="NavigationPane_RefreshInProgress"></spinner><div ng-switch-default><i ng-if="model.icon === 1 && model.source.packagePublishStatus !== 2 && model.source.contract.lastRefreshStatus !== 4" class="glyphicon pbi-glyph-share" localize-tooltip="NavigationPane_SharedWithMe"></i><i ng-if="model.icon === 5 && showIcon && showIcon()" class="glyphicon pbi-glyph-excel" localize-tooltip="NavigationPane_ExcelWorkbook"></i><i ng-if="getPackagePublishStatus && getPackagePublishStatus() === 2" class="warning glyphicon pbi-glyph-warning glyph-small" localize-tooltip="NavigationPane_RefreshPublishError"></i><i ng-if="showRefreshError && showRefreshError()" class="warning glyphicon pbi-glyph-warning glyph-small" tooltip tooltip-config="tooltipConfig" ng-click="$event.stopPropagation();showRefreshErrorDialog()"></i></div></div><editable-label class="navPaneListItemName smallFontSize" ng-class="{trimmed: model.source.isNew || model.source.packagePublishStatus === 2 || model.source.packagePublishStatus === 4, publishing: model.source.packagePublishStatus === 1, editing: model.isNameEditable}" view-model="::model.source" on-blur="::rename(newName)" validate="::isNameValid" disable-click="true" editable="model.isNameEditable"></editable-label><div class="navPaneItemIndicator" ng-if="::!newStyle"><i ng-if="model.source.isNew && model.source.packagePublishStatus !== 2 && model.source.packagePublishStatus !== 4 && !model.source.isRefreshInProgress" class="glyphicon pbi-glyph-asterisk"></i></div> <button class="navigationPaneButton itemActionsBtn" context-menu localize-tooltip="NavigationPane_OpenMenu" context="::model" show-context-menu="showContextMenu" ng-click="$event.stopPropagation();showContextMenuIfEnabled()"><i class="glyphicon pbi-glyph-more"></i></button></li>'),e.put("views/npsHost.html",'<div class="npsHost"></div>'),e.put("views/o365ApplicationLauncher.html",'<div class="o365Waffle"><div class="powerBILogo"><div class="waffle glyphicon pbi-glyph-waffle"></div></div><div id="o365AppLauncherContainer" class="o365AppLauncherContainer" tabindex="-1"><div class="o365LoadingContainer" ng-if="loadingAppLauncher"><div class="loadingspinner"><spinner></spinner></div><div class="o365AppLauncherLoading" localize="Loading_Text"></div></div><div class="o365AppLauncherError" ng-if="::loadingError" localize="TopNav_O365ApplicationLauncher_Error"></div><div id="o365AppLauncherContent" class="o365AppLauncherContent" ng-if="!loadingAppLauncher"></div></div></div>'),e.put("views/pbiDataLoaderSpinner.html",'<div class="dataLoaderSpinner"><spinner class="xlarge"></spinner><h3 class="unselectable"></h3></div>'),e.put("views/pinTileDialog.html",'<div class="explorationPinTileDialog" ng-class="{liveReportTile: isLiveReport, pinDashboardTile: !isLiveReport}"><div class="tilePreview section" ng-class="{noTitle: !viewModel.hasTitle(viewModel.useDashboardFormatting ? viewModel.reportTile:viewModel.dashboardTile), noPreview: viewModel.needSaveReport, showPreview: !viewModel.needSaveReport,vrmPreview:!viewModel.hasTileFormatting }"><div class="liveReport" ng-if="isLiveReport"><span class="previewSection" localize="PinLiveReport_Preview"/><span localize="PinLiveReport_SavedState"/></div><div class="dashTile tilePreviewFrame" ng-show="viewModel.useDashboardFormatting"><ul><dashboard-tile view-model="viewModel.dashboardTile"></dashboard-tile></ul></div><div class="reportTile tilePreviewFrame" ng-show="!viewModel.useDashboardFormatting"><ul><dashboard-tile view-model="viewModel.reportTile"></dashboard-tile></ul></div><div class="tileFormatting section" ng-show="viewModel.hasTileFormatting"><div class="tileFormattingMessage pinTileBoldText" localize="ReportContainer_TileFormattingMessage"></div><div class="formatChoices tileRadioGroup"><ul><li><div class="pbi-input"> <input type="radio" name="cpRadio1" ng-disabled="viewModel.needSaveReport" ng-model="viewModel.useDashboardFormatting" ng-value="true" ng-change="updateFormatting()"><label class="form-label" localize="ReportContainer_UseDashboardFormattingRadioText"></label></div></li><li><div class="pbi-input"> <input type="radio" name="cpRadio2" ng-disabled="viewModel.needSaveReport" ng-model="viewModel.useDashboardFormatting" ng-value="false" ng-change="updateFormatting()"><label class="form-label" localize="ReportContainer_RetainReportFormattingRadioText"></label></div></li></ul></div></div></div><div class="dashboardSelector section"><div class="sectionContainer pinToDashboard" ng-model="viewModel.needSaveReport" ng-show="!viewModel.needSaveReport"><h2 class="title trimmedTextWithEllipsis" localize="ReportContainer_PinToDashboardTitle" localize-tooltip="ReportContainer_PinToDashboardTitle"></h2><div class="message" localize="ReportContainer_SelectExistingOrCreateNewDashboardMessage"></div><div class="pinMessage" localize="ReportContainer_WhereToPinMessage"></div><div class="dashboardChoices tileRadioGroup"><ul><li><div class="pbi-input" ng-disabled="viewModel.noExistingDashboard"> <input type="radio" class="existingDashRadio" ng-model="viewModel.useExistingDashboard" ng-value="true" ng-disabled="noPinnableDashboard()"><label class="form-label" localize="ReportContainer_UseExistingDashboardRadioText"></label></div></li><li><div class="pbi-input"> <input class="newDashRadio" type="radio" ng-model="viewModel.useExistingDashboard" ng-value="false"><label class="form-label" localize="ReportContainer_UseNewDashboardRadioText"></label></div></li></ul></div><div class="existingDashboardDropDown" ng-show="viewModel.useExistingDashboard"> <select ng-model="viewModel.selectedDashboardId"><option ng-selected="{{dashboard.id === dashboardDataService.activeDashboard.id}}" ng-repeat="dashboard in getDashboards() | filter:isDashboardPinnable | orderBy:\'displayName\'" value="{{dashboard.id}}" title="{{dashboard.displayName}}" ng-bind="dashboard.displayName"></option></select></div><div class="newNameTextBox animate-show section" ng-show="!viewModel.useExistingDashboard"> <input type="text" class="pinTileText inputDashboardTitle" ng-trim="false" min="1" maxlength="500" ng-model="viewModel.newDashboardName"/></div><div class="liveReportMessage" ng-if="isLiveReport"><span class="glyphicon pbi-glyph-info glyph-mini"/><span localize="PinLiveReport_RefreshMessage"/></div></div><div class="sectionContainer saveYourReport" ng-model="viewModel.needSaveReport" ng-hide="!viewModel.needSaveReport"><h2 class="title" localize="ReportAppBar_SaveAsDialogTitle"></h2><div class="message" localize="ReportContainer_NeedToSaveReportBeforePin"></div><div class="newNameTextBox animate-show section"> <input type="text" class="pinTileText inputReportTitle" ng-trim="false" min="1" maxlength="500" ng-model="viewModel.newReportName"/></div></div><div class="pinTileButtons"> <button class="cancelpinTile biButton" ng-click="cancel()" localize="PBI_Button_Label_Cancel"></button> <button class="pinTile biButton primary trimmedTextWithEllipsis" ng-click="pin()" ng-show="!viewModel.needSaveReport" ng-disabled="viewModel.isPinned || (!viewModel.useExistingDashboard && (!viewModel.newDashboardName || viewModel.newDashboardName.length===0))" ng-bind="::pinButtonText" ng-attr-title="{{::pinButtonText}}"></button> <button class="saveAndContinueBtn biButton primary" ng-click="saveAndContinue()" ng-show="viewModel.needSaveReport" ng-disabled="(!viewModel.newReportName || viewModel.newReportName.length===0)" localize="ReportContainer_SaveAndContinue"></button></div></div></div>'),
e.put("views/qna/qnaContainer.html",'<div class="dashboardContainerView isNavigationPaneEnabled qnaMode" ng-class="{isMainContentDisabled: collapsiblePaneMode !== 0,                isSelectedTileHighlighted: collapsiblePaneMode === 1}" ng-switch="modelsSupportQna"><div class="mainContent" ng-switch-when="true"><div class="header" ng-cloak><div class="qnaAppBar appBar"><div class="appBarSection left"><ul><li> <button class="backBtn" ng-click="navigation.navigateBack()"><i class="glyphicon pbi-glyph-arrowleft glyph-small"></i><span class="activeDashboardLabel appBarTitle displayOnSmallScreen" localize="QnA_ExitQnA"></span></button></li></ul></div><div class="appBarSection right" ng-if="newQnaEnabled"><ul><li class="pinBtn" ng-if="pinIconState.visible && !!pinIconState.enabled"> <button id="pinVisualBtn" class="in_navigationBtn infoNavActionItem" localize-tooltip="PinVisual_ToolTip" ng-click="pinQnAVisual($event)"><i class="glyphicon pbi-glyph-pinned pinButton glyph-small"></i><span class="appBarMenuItem" localize="PinVisual_ToolTip"></span></button></li></ul></div></div><div class="dashboardControlsWrapper" ng-if="!newQnaEnabled" ng-cloak><div class="legacyQnaWrapper"><div class="qnaQuestionBoxWrapper"><question-box-container get-additional-o-data-filter="getAdditionalODataFilter" interpret-listener="infoNavContainerInterpretListener" output="questionBoxOutput" usage-reporting-enabled="allowQnaDataCollection" models="viewModel.models"></question-box-container></div><section class="infoNavActions"><span ng-if="pinIconState.visible" ng-switch="!!pinIconState.enabled"><span id="pinVisualBtn" class="in_navigationBtn infoNavActionItem" localize-tooltip="PinVisual_ToolTip" ng-click="pinQnAVisual($event)" ng-switch-when="true"><i class="glyphicon pbi-glyph-pinned pinButton"></i></span><span id="pinVisualBtn" class="in_navigationBtn infoNavActionItem infoNavActionItemDisabled" localize-tooltip="PinVisual_DisabledForReportPagesToolTip" ng-switch-when="false"><i class="glyphicon pbi-glyph-pinned pinButton"></i></span></span><span id="userFeedbackBtn" class="in_navigationBtn infoNavActionItem" ng-if="questionBoxOutput.showQnaFeedback" localize-tooltip="UtteranceFeedbackTooltip" ng-click="questionBoxOutput.showUserFeedbackDialog()"><i class="glyphicon pbi-glyph-flag"></i></span></section></div></div></div><div class="dashboardSliderMain"><div class="infoNavVisualizationModeView"><info-nav-container host-service="infoNavHostService" question-box-output="questionBoxOutput" interpret-listener="infoNavContainerInterpretListener" usage-reporting-enabled="allowQnaDataCollection" models="viewModel.models" get-additional-o-data-filter="getAdditionalODataFilter"></info-nav-container></div></div></div><div class="waterMarkMsg unselectable" ng-switch-when="false"><i class="glyphicon pbi-glyph-warning glyph-med warningIcon"></i><p>{{::unsupportedModelMessage}}</p></div></div>'),e.put("views/qrCodeDialog.html",'<div class="qrCodeDialog"><div class="qrCodePreview section"><div class="tileHeader"><div class="heading title"><div class="displayText" ng-bind="viewModel.displayText"></div></div><div class="heading subTitle"><div class="subDisplayText" ng-bind="viewModel.subDisplayText"></div></div></div> <img class="qrCode" ng-src="{{qrCodeImageDataUrl}}"/></div><div class="qrCodeInstructions"><h2 class="title" localize="QRCodeDialog_Title"></h2><div class="message" ng-bind="viewModel.dialogMessage"></div><div class="notification"><i class="glyphicon pbi-glyph-info glyph-small"></i><div class="notificationBody" ng-bind="viewModel.notificationMessage"></div><div class="qrCodeButtons"> <button class="done biButton" ng-click="hideDialog()" localize="QRCodeDialog_Done"></button><a class="downloadButton btn primary" ng-disabled="!qrCodeCanvas" role="button" localize="QRCodeDialog_Download" ng-href="{{qrCodeImageDataUrl}}" ng-click="tryIEDownloadQRCodeImage()" download="{{qrCodeImageFileName}}"></a></div></div></div></div>'),e.put("views/qrCodeProgressDialog.html",'<div class="qrLoading" ng-click="$event.stopPropagation()"><div class="content"><div class="information"><div class="title" localize="QRCodeProgressDialog_Title"/><spinner class="large"></spinner></div> <button class="primary" ng-click="hideDialog()" localize="GetData_Cancel"></button></div></div>'),e.put("views/settings/settingsDashboardsView.html",'<div class="settingsDatasets"><div class="settingsDatasetsLeftColumn" ng-if="viewModel && viewModel.dashboards && viewModel.dashboards.length !== 0"><div class="datasetsList"><ul><li ng-repeat="dashboard in viewModel.dashboards | orderBy: \'name\' track by dashboard.dashboardId" ng-click="onDashboardSelected(dashboard.objectId)" ng-class="{selected: viewModel.currentDashboardId === dashboard.objectId}"><span ng-bind="::dashboard.name"/></li></ul></div></div><div class="settingsDatasetsRightColumn" ng-if="viewModel && viewModel.dashboards && viewModel.dashboards.length !== 0"><div ng-repeat="dashboard in viewModel.dashboards track by dashboard.objectId"><settings-dashboard view-model="dashboard" ng-if="viewModel.currentDashboardId === dashboard.objectId"/></div></div><water-mark-message config="::watermarkConfig" ng-if="!viewModel.dashboards.length"></div>'),e.put("views/settings/settingsDatasetFeaturedQuestionsView.html",'<div><div class="featuredQuestionsSection" ng-if="modelSupportsQna"><div class="sectionHeader" ng-click="sectionExpanded = !sectionExpanded"><i class="glyphicon" ng-class="{true:\'refreshSectionExpander pbi-glyph-caretdownright\', false:\'refreshSectionExpander pbi-glyph-caretright\'}[sectionExpanded]"></i><span class="refreshSectionTitle" localize="SettingsDataset_FeaturedQuestions_Title"></span></div><div class="expandableInnerContainer" ng-if="sectionExpanded"><div class="prompt" localize="SettingsDataset_FeaturedQuestions_Prompt"></div><div class="question" ng-repeat="q in questions"> <input class="mediumFontSize" type="text" ng-model="q.utterance" ng-class="{hasError: q.utterance.length === 0}" ng-change="onChange(q)" maxlength="{{maxUtteranceLength}}" aria-label="{{inputAriaLabel}}"/><a class="deleteQuestion" ng-click="deleteQuestion($index)" localize-tooltip="SettingsDataset_FeaturedQuestions_DeleteQuestion"><i class="glyphicon pbi-glyph-close glyph-mini"></i></a><div class="emptyQuestion smallFontSize" ng-if="!q.isValid"><i class="glyphicon pbi-glyph-error glyph-small"></i> <span>{{q.validationMessage}}</span></div></div><div ng-if="questions.length < maxQuestions"><a href="" class="addQuestion" ng-click="addQuestion()" localize="SettingsDataset_FeaturedQuestions_AddAnotherQuestion"></a></div><div class="buttonsContainer"> <button class="primary" localize="SettingsDataset_ApplyButtonText" ng-click="applyChanges()" ng-disabled="!isDirty || !isValid"></button> <button localize="SettingsDataset_DiscardButtonText" ng-click="discardChanges()" ng-disabled="!isDirty"></button></div></div></div></div>'),e.put("views/settings/settingsDatasourceCredentials.html",'<div ng-if="::hasEditableDatasources" class="settingsDatasourceCredentials"><div class="refreshSectionHeader" ng-class="{disabledContainer : shouldDatasourceCredentialsDisabled()}" ng-click="viewModel.manageDataSourcesExpand = !viewModel.manageDataSourcesExpand"><i class="glyphicon" ng-class="{true:\'refreshSectionExpander pbi-glyph-caretdownright\', false:\'refreshSectionExpander pbi-glyph-caretright\'}[!shouldDatasourceCredentialsDisabled() && viewModel.manageDataSourcesExpand]"></i><span class="refreshSectionTitle" localize="SettingsDataset_ManageDataSources_Title"></span></div><div class="expandableInnerContainer" ng-show="!shouldDatasourceCredentialsDisabled() && viewModel.manageDataSourcesExpand" ng-switch="showDiscoverDatasourcesSpinner"><spinner ng-switch-when="true"></spinner><div ng-switch-when="false"><inline-message trace-details="datasourceTraceDetails" use-error-icon class="expandableBlockWarning" ng-show="viewModel.hasDatasourceWithWrongCredentials || viewModel.hasDirectQueryDatasourceWithMissingCredentials"><span ng-show="viewModel.hasDatasourceWithWrongCredentials" localize="SettingsDataset_ManageDataSources_Warning_YouNeedToProvideCredentials"></span><span ng-show="viewModel.hasDirectQueryDatasourceWithMissingCredentials" localize="SettingsDataset_ManageDataSources_Warning_DirectQueryMissingCredentials"></span></inline-message><div class="topMarginTextContainer"><table class="datasourceContainer"><tr ng-repeat="datasource in viewModel.datasources | orderBy:\'displayName\'"><th class="datasourceName"><span title="{{::datasource.fullName}}" ng-bind="::datasource.displayName"></span><th><div class="statusContainer"><spinner ng-show="testConnectionProgressing(datasource)"></spinner><i class="glyphicon pbi-glyph-error glyph-small" title="{{datasource.testConnectionErrorMessage}}" ng-show="testConnectionFailed(datasource)"></i></div><a href="" class="dataSourceEditButton" localize="SettingsDataset_ManageDataSources_EditButtonText" ng-click="editDatasource(datasource)" ng-cloak ng-show="!datasource.useEGW"></a><span class="datasourceName" localize="SettingsDataset_ManageDataSources_DataSourceWithEnterpriseGateway" ng-cloak ng-show="datasource.useEGW"></span></th></tr></table></div></div></div></div>'),e.put("views/settings/settingsDatasourceScheduleRefresh.html",'<div ng-if="::hasRefreshSchedule" class="settingsDatasourceScheduleRefresh"><div class="refreshSectionHeader" ng-class="{disabledContainer : shouldScheduleRefreshContainerDisabled()}" ng-click="viewModel.refreshSectionExpand = !viewModel.refreshSectionExpand"><i class="glyphicon" ng-class="{true:\'refreshSectionExpander pbi-glyph-caretdownright\', false:\'refreshSectionExpander pbi-glyph-caretright\'}[(firstTimeExperience && viewModel.takenOver) ? false : viewModel.refreshSectionExpand]"></i><span class="refreshSectionTitle" ng-attr-localize="{{viewModel.isDirectQueryOrOnPremModel ? \'SettingsDataset_DirectQuery_SettingTitle\' : \'SettingsDataset_ScheduleRefresh_Title\'}}"></span></div><div class="expandableInnerContainer" ng-show="viewModel.refreshSectionExpand"><div class="datasetSchedule" ng-cloak><div class="topMarginTextContainer" ng-class="{disabledContainer : !viewModel.takenOver}" ng-switch="::viewModel.isDirectQueryOrOnPremModel"><section ng-switch-when="true" class="directQueryRefreshHeader"><header localize="SettingsDataset_DirectQuery_RefreshTitle"></header><a href="https://go.microsoft.com/fwlink/?linkid=839732" target="_blank" localize="SettingsDashboard_DQRefresh_LearnMore"/></section><section ng-switch-when="false"><header localize="SettingsDataset_ScheduleRefresh_EnableRefresh_Title"></header><pbi-toggle ng-model="viewModel.refreshSettings.refreshEnabled" ng-disabled="shouldRefreshSettingsToggleDisabled()" ng-change="refreshSettingsToggleMouseUp()" no-label on-state-text="ToggleSwitchOn" off-state-text="ToggleSwitchOff"></pbi-toggle></section></div><fieldset class="inputContainer" ng-class="{disabledContainer : shouldRefreshSettingsDisabled()}" ng-disabled="shouldRefreshSettingsDisabled()"><div class="refreshFrequencyContainer"><header localize="SettingsDataset_ScheduleRefresh_RefreshFrequency_Title"></header> <select ng-model="viewModel.refreshFrequencyString" ng-options="key as value for (key, value) in ::viewModel.refreshFrequencies"/></div><section ng-if="viewModel.showRefreshTimeInfo"><div class="refreshTimeZoneContainer"><header localize="SettingsDataset_ScheduleRefresh_TimeZone"></header> <select ng-model="viewModel.refreshSettings.refreshTimeZoneId" ng-options="refreshTimeZone.key as refreshTimeZone.value for refreshTimeZone in viewModel.refreshTimeZonesViewModel"/></div><ul class="refreshFrequencyWeekDays" ng-if="viewModel.showWeekDays"><li ng-repeat="weekdayKey in ::viewModel.weekdayKeys"><pbi-checkbox label="{{::weekdayKey}}" ng-model="viewModel.refreshSettings.refreshDays[$index]" class="refreshFrequencyDay"></pbi-checkbox></li></ul><div ng-switch="hasLicenseForProModel"><div class="refreshWindowContainer" ng-switch-when="false"><header localize="SettingsDataset_ScheduleRefresh_TimeWindow"></header> <select ng-model="viewModel.refreshSettings.refreshTimeWindowIndex" ng-options="viewModel.refreshTimeWindows.indexOf(refreshTimeWindow) as refreshTimeWindow for refreshTimeWindow in viewModel.refreshTimeWindows"/><span class="updateAccountScheduleDataRefreshMessage" ng-bind="updateAccountScheduleDataRefreshMessage"/><div><button class="biButton primary" ng-bind="tryProAccountButtonText" ng-click="tryProAccount()"></button></div></div><div ng-switch-when="true"><div class="refreshProWindowContainer"><header localize="SettingsDataset_ScheduleRefresh_TimeProWindow"></header><div ng-repeat="time in viewModel.refreshSettings.refreshTimesHourly "> <select ng-model="time.refreshHourIndex" ng-options="viewModel.refreshTimeHourWindows.indexOf(refreshTimeHourWindow) as refreshTimeHourWindow for refreshTimeHourWindow in viewModel.refreshTimeHourWindows"/> <select ng-model="time.refreshMinuteIndex" ng-options="viewModel.refreshTimeMinuteWindows.indexOf(refreshTimeMinuteWindow) as refreshTimeMinuteWindow for refreshTimeMinuteWindow in viewModel.refreshTimeMinuteWindows"/> <select ng-model="time.refreshAmPmIndex" ng-options="viewModel.refreshTimeAmPmWindows.indexOf(refreshTimeAmPmWindow) as refreshTimeAmPmWindow for refreshTimeAmPmWindow in viewModel.refreshTimeAmPmWindows"/><i class="refreshTimeDeletButton glyphicon pbi-glyph-cancel glyph-mini" ng-click="removeRefreshTime($index)"></i><div class="invalidTimeWarning" ng-if="time.isDuplicate"><i class="invalidTimeErrorIcon glyphicon pbi-glyph-error glyph-small"></i><span localize="SettingsDataset_DuplicateTime"></span></div><div class="invalidTimeWarning" ng-if="time.isIncomplete"><i class="invalidTimeErrorIcon glyphicon pbi-glyph-error glyph-small"></i><span localize="SettingsDataset_IncompleteTime"></span></div></div></div><a href="" class="addRefreshTime" localize="SettingsDataset_Add_Refresh_Time" ng-show="canAddRefreshTime()" ng-click="addRefreshTime()"></a></div></div></section><div class="sendFailureEmail" ng-if="::!viewModel.isDirectQueryOrOnPremModel"><pbi-checkbox label="SettingsDataset_ScheduleRefresh_SendRefreshFailureEmail" ng-model="viewModel.refreshSettings.refreshNotificationEnabled"></pbi-checkbox></div></fieldset><div class="buttonsContainer"> <button class="biButton primary" localize="SettingsDataset_ApplyButtonText" ng-disabled="shouldSettingsDatasetButtonDisable()" ng-click="applyChanges()"></button> <button class="biButton" localize="SettingsDataset_DiscardButtonText" ng-disabled="shouldSettingsDatasetButtonDisable()" ng-click="discardChanges()"></button></div></div></div></div>'),e.put("views/settings/settingsGateways.html",'<div><div class="refreshSectionHeader" ng-class="{disabledContainer : shouldGatewaysContainerDisabled()}" ng-click="viewModel.gatewaysExpand = !viewModel.gatewaysExpand"><i class="glyphicon" ng-class="{true:\'refreshSectionExpander pbi-glyph-caretdownright\', false:\'refreshSectionExpander pbi-glyph-caretright\'}[viewModel.gatewaysExpand]"></i><span class="refreshSectionTitle" localize="SettingsDataset_GatewayConnection_Title"></span></div><div class="expandableInnerContainer" ng-show="viewModel.takenOver && viewModel.gatewaysExpand"><select-gateway ng-if="viewModel.takenOver" view-model="selectGatewayModel"></select-gateway><div class="buttonsContainer"> <button class="primary" localize="SettingsDataset_ApplyButtonText" ng-click="applyGatewaySelection()" ng-disabled="!selectGatewayModel.isDirty"></button> <button localize="SettingsDataset_DiscardButtonText" ng-click="discardGatewaySelection()" ng-disabled="!selectGatewayModel.isDirty"></button></div></div></div>'),e.put("views/settings/settingsGeneralView.html",'<div class="settingsDatasets"><div class="settingsDatasetsLeftColumn"><div class="datasetsList"><ul><li ng-repeat="subGroup in subGroups track by subGroup.type" ng-click="onSubgroupSelected(subGroup.type)" ng-class="{selected: viewModel.selectedSubgroupType === subGroup.type}"><span ng-bind="subGroup.name"></span></li></ul></div></div><div class="settingsDatasetsRightColumn" ng-switch="viewModel.selectedSubgroupType"><settings-privacy ng-switch-when="0" view-model="viewModel.privacy"></settings-privacy><close-account ng-switch-when="1"></close-account><settings-language ng-switch-when="2" view-model="viewModel.language"></settings-language><settings-plugins ng-switch-when="3" view-model="viewModel.plugins"></settings-plugins><settings-esri ng-switch-when="5" view-model="viewModel.esri"></settings-esri></div></div>'),e.put("views/settings/settingsOneDriveCredentials.html",'<div class="settingsOneDriveCredentials"><div class="refreshSectionHeader" ng-class="{disabledContainer : storageSourceFileNotFound}" ng-click="viewModel.manageStorageSourceExpand = !viewModel.manageStorageSourceExpand"><i class="glyphicon" ng-class="{true:\'refreshSectionExpander pbi-glyph-caretdownright\', false:\'refreshSectionExpander pbi-glyph-caretright\'}[viewModel.manageStorageSourceExpand]"></i><span class="refreshSectionTitle" localize="SettingsDataset_ManageStorageSource_Title"></span></div><div class="expandableInnerContainer" ng-show="viewModel.manageStorageSourceExpand" ng-switch="showDiscoverStorageSourcesSpinner"><spinner ng-switch-when="true"></spinner><div ng-switch-when="false"><inline-message trace-details="storageSourceTraceDetails" use-error-icon class="expandableBlockWarning" ng-show="testPackageConnectionFailed()"><span localize="SettingsDataset_ManageStorageSource_Warning_YouNeedToProvideCredentials"></span></inline-message><div><table class="datasourceContainer"><tr><th class="datasourceName"><span title="{{::getStorageSourceDisplayName()}}" ng-bind="getStorageSourceDisplayName()"></span></th><th><div class="statusContainer"><spinner ng-show="testPackageConnectionProgressing()"></spinner><i class="glyphicon pbi-glyph-error glyph-small" title="{{viewModel.storageSource.testConnectionErrorMessage}}" ng-show="testPackageConnectionFailed()"></i></div><a href="" class="dataSourceEditButton" localize="SettingsDataset_ManageDataSources_EditButtonText" ng-click="editStorageSource()"></a></th></tr></table></div></div></div></div>'),e.put("views/settings/settingsOneDriveRefresh.html",'<div class="settingsOneDriveRefresh"><div class="refreshSectionHeader" ng-class="{disabledContainer : storageSourceFileNotFound}" ng-click="viewModel.manageStorageRefreshExpand = !viewModel.manageStorageRefreshExpand"><i class="glyphicon" ng-class="{true:\'refreshSectionExpander pbi-glyph-caretdownright\', false:\'refreshSectionExpander pbi-glyph-caretright\'}[viewModel.manageStorageRefreshExpand]"></i><span class="refreshSectionTitle" localize="SettingsDataset_RefreshStorageSource_Title"></span></div><div class="expandableInnerContainer" ng-show="viewModel.manageStorageRefreshExpand" ng-switch="showDiscoverStorageSourcesSpinner"><spinner ng-switch-when="true"></spinner><div class="topMarginTextContainer" ng-switch-when="false"><header localize="SettingsDataset_Enable_PackageRefresh_Title"></header><inline-message trace-details="storageSourceTraceDetails" use-error-icon class="expandableBlockWarning" ng-show="testPackageConnectionFailed()"><span localize="SettingsDataset_ManageStorageSource_Warning_YouNeedToProvideCredentials"></span></inline-message><pbi-toggle ng-model="viewModel.contract.isPackageRefreshEnabled" ng-disabled="shouldPackageRefreshSettingsToggleDisabled()" ng-change="updateStorageSourceRefresh()" no-label on-state-text="ToggleSwitchOn" off-state-text="ToggleSwitchOff"></pbi-toggle></div></div></div>'),e.put("views/settings/settingsPublishedContentView.html",'<div class="settings"></div>'),e.put("views/settings/settingsQnaView.html",'<div class="expandableRefreshSections"><section class="qnaSection" ng-if="qna"><div class="sectionHeader" ng-click="viewModel.qnaSectionExpand = !viewModel.qnaSectionExpand"><i class="glyphicon" ng-class="{true:\'refreshSectionExpander pbi-glyph-caretdownright\', false:\'refreshSectionExpander pbi-glyph-caretright\'}[viewModel.qnaSectionExpand]"></i><span class="refreshSectionTitle" localize="SettingsDataset_QnaAndCortana_Title"></span></div><div class="expandableInnerContainer" ng-show="viewModel.qnaSectionExpand"><inline-message ng-if="qna.showOnPremiseSetting" display-icon="displayIcon" use-error-icon="storageSourceFileNotFound" use-error-background="storageSourceFileNotFound"><span><a class="onPremQna" localize="SettingsDataset_Qna_OnPremWarning"></a><a class="learnAboutOnPremQna" target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=786785" localize="LearnMore"></a></span></inline-message><div class="qnaOptions" ng-if="qna.showOnPremiseSetting"><pbi-checkbox label="SettingsDataset_Cortana_EnableQnaOption" ng-model="qna.powerBIQnaEnabled" ng-change="enableQna()"></pbi-checkbox></div><div class="qnaOptions" ng-if="qna.showCortanaSetting"><pbi-checkbox label="SettingsDataset_Cortana_EnableCortanaOption" ng-model="qna.cortanaEnabled" ng-change="enableCortana()"></pbi-checkbox></div><div class="qnaInfo" ng-if="qna.showCortanaSetting"><span localize="SettingsDataset_Cortana_InformationSharing"/></div><div class="buttonsContainer"> <button class="primary" localize="SettingsDataset_ApplyButtonText" ng-disabled="!viewModel.isQnaDirty" ng-click="qna.apply()"></button> <button localize="SettingsDataset_DiscardButtonText" ng-disabled="!viewModel.isQnaDirty" ng-click="qna.discard()"></button></div></div><settings-dataset-featured-questions view-model="viewModel"></settings-dataset-featured-questions></section></div>'),e.put("views/settings/settingsViewerView.html",'<div class="sliderContentView" ng-switch="isLoading"><div class="layoutTop"><div class="backToDashboard section"><div class="sliderContentHeader ms-font-weight-light ms-font-color-neutralSecondary"><span feature-switch-not="breadcrumbNavigationEnabled" localize="SettingsViewer_Title"></span><spinner class="settingsLoadingSpinner" ng-switch-when="true"></spinner></div></div></div><div class="layoutBottom" ng-switch-when="false"><div class="layoutLeft"><div class="settingsList"><ul><li ng-repeat="settingsGroup in settingsGroups" ng-click="onSettingsGroupSelected(settingsGroup.type)" ng-class="{selected: currentSettingsGroup === settingsGroup.type}"> <span>{{::settingsGroup.name}}</span></li></ul></div></div><div class="layoutRight"><div ng-switch on="currentSettingsGroup" feature-switch-class="breadcrumbNavigationEnabled"><settings-general ng-switch-when="general" view-model="viewModel.general"></settings-general><settings-dashboards ng-switch-when="dashboards" view-model="viewModel.dashboards"></settings-dashboards><settings-datasets ng-switch-when="datasets" view-model="viewModel.datasets"></settings-datasets><settings-workbooks ng-switch-when="workbooks" view-model="viewModel.workbooks"></settings-workbooks><settings-alerts ng-switch-when="alerts"></settings-alerts><settings-communications ng-switch-when="communications" view-model="viewModel.communications"></settings-communications></div></div></div></div>'),e.put("views/states/adminPortalState.html","<admin-portal></admin-portal>"),e.put("views/states/appAutoInstallState.html","<app-placeholder></app-placeholder>"),e.put("views/states/createChannelState.html","<create-app-channel></create-app-channel>"),e.put("views/states/devToolsViewState.html","<dev-tools-view></dev-tools-view>"),e.put("views/states/externalContentViewerState.html",'<content-provider-store active-dashboard="dashboardDataService.activeDashboard"></content-provider-store>'),e.put("views/states/gatewaysState.html","<gateways></gateways>"),e.put("views/states/insightsState.html",'<insights active-dashboard="dashboardDataService.activeDashboard"></insights>'),e.put("views/states/manageEmbedViewState.html","<manage-embed-view></manage-embed-view>"),e.put("views/states/managePermissionsState.html","<permission-details></permission-details>"),e.put("views/states/manageStorageViewState.html",'<manage-storage-view view-model="viewModel.dashboardContainer.manageStoragePane" dashboard-container="viewModel.dashboardContainer"></manage-storage-view>'),e.put("views/states/permissionCenterState.html","<permission-center-home></permission-center-home>"),e.put("views/states/publishContentPackViewState.html",'<introduce-app-bar></introduce-app-bar><publish-content-pack-view view-model="viewModel.dashboardContainer.publishPane" dashboard-container="viewModel.dashboardContainer"></publish-content-pack-view>'),e.put("views/states/rowLevelSecurityState.html","<row-level-security-container></row-level-security-container>"),e.put("views/states/settingsViewerState.html","<settings-viewer></settings-viewer>"),e.put("views/states/shareViewState.html",'<share-view view-model="viewModel.dashboardContainer.sharePane" active-dashboard="dashboardDataService.activeDashboard"></share-view>'),e.put("views/states/viewContentPackViewState.html","<introduce-app-bar></introduce-app-bar><view-content-pack></view-content-pack>"),e.put("views/taskPaneSliderView.html",'<div class="taskPaneSliderView" ng-if="isPaneExpanded()" pbi-lazy-load-contents="::getModuleConfig()"><collapsible-pane view-model="viewModel.collapsiblePane" is-expander-hidden="viewModel.collapsiblePaneMode !== 0" ng-switch="viewModel.collapsiblePaneMode"><tile-editor ng-switch-when="1"></tile-editor><create-group-blade ng-switch-when="2" group-editor-mode="viewModel.collapsiblePaneMode"></create-group-blade><edit-group-blade ng-switch-when="3" group-editor-mode="viewModel.collapsiblePaneMode" parameters="viewModel.parameters"></edit-group-blade><view-group-blade ng-switch-when="4" group-editor-mode="viewModel.collapsiblePaneMode" parameters="viewModel.parameters"></view-group-blade><tile-gallery ng-switch-when="5"></tile-gallery><share-view ng-switch-when="6" view-model="viewModel.dashboardContainer.sharePane"></share-view><real-time-blade ng-switch-when="7"></real-time-blade><upn-mapping-pane ng-switch-when="8"></upn-mapping-pane><alerts-editor ng-switch-when="9"></alerts-editor><streaming-dataset-editor ng-switch-when="10" from="viewModel.previousMode"></streaming-dataset-editor><streaming-dataset-push-info ng-switch-when="11"></streaming-dataset-push-info><settings-blade ng-switch-when="12"></settings-blade><streaming-dataset-gallery ng-switch-when="13"></streaming-dataset-gallery><pub-nub-editor ng-switch-when="14"></pub-nub-editor><subscription-pane ng-switch-when="15"></subscription-pane><capacity-migrate-workspaces ng-switch-when="16"></capacity-migrate-workspaces><related-content-blade ng-switch-when="17" view-model="viewModel.parameters"></related-content-blade><capacity-settings-editor ng-switch-when="18"></capacity-settings-editor><edit-my-workspace-blade ng-switch-when="19" group-editor-mode="viewModel.collapsiblePaneMode" parameters="viewModel.parameters"></edit-my-workspace-blade><performance-inspector ng-switch-when="20"></performance-inspector><grant-access-pane ng-switch-when="21"></grant-access-pane><instant-email-pane ng-switch-when="22"></instant-email-pane><share-report-pane ng-switch-when="23"></share-report-pane><capacity-change-pane ng-switch-when="24"></capacity-change-pane><capacity-workspace-admin-pane ng-switch-when="25" workspace="viewModel.parameters"></capacity-workspace-admin-pane></collapsible-pane></div>'),e.put("views/tiles/compositeTile.html",'<div class="compositeTile" ng-class="{ fullLayout: viewModel.config.layoutType === 1 }"><div class="visualTile"><visual ng-if="$ctrl.readyToRender()" view-model="viewModel.visual" allow-deferred-rendering="::allowDeferredRendering"></visual></div></div>'),e.put("views/tiles/dashboardTile.html",'<li class="dashboardTile baseTile" in-viewport="onceInViewport()" in-viewport-context="{{::viewportContextSelector}}" in-viewport-offset="100%" ng-class="{selected: model.isSelected, readonly: isReadOnly(), showOptions: optionsMenuVisible, nonActionable: isNonActionable(), hasSpotlight: hasSpotlight()}" ng-click="$event.stopPropagation()" ng-mouseenter="setHover(true)" ng-mouseleave="setHover(false)"><dashboard-tile-open-options ng-if="displayDashboardTileOpenOptions()" model="model"></dashboard-tile-open-options><div ng-if="inViewport" class="tileWrapper" ng-click="openTile(disablePointerEvents, $event)" ng-switch="::showLockedTile"><div ng-switch-when="false" class="dashboardTileLayout"><section ng-if="::(inEditMobileLayoutMode() || displayDashboardTileShowIcon())"> <button ng-click="addTileToMobileView()" class="tileAction pinTile glyphicon pbi-glyph-pinned glyph-small showTileIcon" localize-tooltip="DashboardTile_ToggleVisibility" ng-if="displayDashboardTileShowIcon()"></button> <button ng-click="removeTileFromMobileView()" class="tileAction unpinTile glyphicon pbi-glyph-unpin glyph-small" localize-tooltip="DashboardTile_unpinTile" ng-if="::(!displayDashboardTileShowIcon())"></button></section><a class="urlTile" ng-attr-href="{{viewModel.href}}" ng-attr-target="{{viewModel.hrefTarget}}" rel="noopener noreferrer" draggable="false"><tile view-model="viewModel" disable-pointer-events="{{::disablePointerEvents}}" header-click-target="openNotification ? openNotifications(event) : openTile(true, event)"></tile></a><dashboard-tile-options-menu ng-if="displayDashboardTileOptionsMenuVisible()"></dashboard-tile-options-menu></div><div ng-switch-when="true" class="permissionLockedTileWrapper" pbi-lazy-load-contents="moduleConfig"><permission-locked-tile></permission-locked-tile></div></div><div ng-if="viewModel.shouldNewBadgeAppear" class="newBadgeContainer" localize="DashboardTile_NewTileBadge"></div></li>'),e.put("views/tiles/dashboardTileOpenOptions.html",'<div class="moreOptions" localize-tooltip="NavigationPane_OpenMenu"> <button class="inFocusTileBtn" ng-click="inFocusTile($event)" ng-disabled="model.isLoading" ng-if="shouldShowInfocusButton()" localize-tooltip="TileEditor_InFocusTile"><i class="glyphicon pbi-glyph-miniexpand glyph-small"></i></button><tile-options-menu feature-switch="tileMenu" is-read-only="isReadOnly()" model="model" view-model="viewModel" can-export="canExport" is-tile-in-error="isTileError" is-tile-openable="isOpenable()"></tile-options-menu> <button feature-switch-not="tileMenu" localize-tooltip="Options_Menu" class="openTileOptionsBtn" ng-click="tileOptionsClicked($event)"><i class="glyphicon pbi-glyph-more"></i></button></div>'),e.put("views/tiles/dashboardTileOptionsMenu.html",'<div class="tileOptionsMenu"> <button class="closeOptionsMenu" ng-click="toggleLegacyOptions(false, $event)"><i class="glyphicon pbi-glyph-close glyph-mini"></i></button><a class="openActionDescription mediumFontSize" ng-click="openTile(true, $event)" ng-attr-href="{{viewModel.href}}" ng-attr-target="{{viewModel.hrefTarget}}" rel="noopener noreferrer"><div class="actionInfo" ng-switch="::getOpenActionType()"><div ng-switch-when="0"><i class="glyphicon pbi-glyph-link glyph-small"></i><span class="openActionHeader trimmedTextWithEllipsis" localize="TileMenuOption_GoToURL"></span></div><div ng-switch-when="1"><i class="glyphicon pbi-glyph-comment glyph-small"></i><span class="openActionHeader trimmedTextWithEllipsis" localize="TileMenuOption_GoToQnA"></span></div><div ng-switch-when="2"><i class="glyphicon pbi-glyph-barchart glyph-small"></i><span class="openActionHeader trimmedTextWithEllipsis" localize="TileMenuOption_GoToReport"></span></div><div ng-switch-when="3"><i class="glyphicon pbi-glyph-excel glyph-small"></i><span class="openActionHeader trimmedTextWithEllipsis" localize="GoToWorkbook"></span></div><div ng-switch-when="4"><i class="glyphicon pbi-glyph-dataset glyph-small"></i><span class="openActionHeader trimmedTextWithEllipsis" localize="TileMenuOption_GoToDataset"></span></div></div><i class="glyphicon pbi-glyph-rightarrow glyph-small"></i><span class="actionText trimmedTextWithEllipsis" ng-bind="::getOpenActionDescriptionText()"></span></a><div class="optionsMenu" ng-click="$event.stopPropagation();"> <button class="inFocusTileBtn" ng-click="inFocusTile($event);" ng-disabled="model.isLoading" ng-if="shouldShowInfocusButton()" localize-tooltip="TileEditor_InFocusTile"><i class="glyphicon pbi-glyph-miniexpand glyph-small"></i></button> <button class="insightsBtn" localize-tooltip="Insights_GetRelatedInsights_Tooltip" ng-disabled="model.isLoading" ng-click="inFocusTile($event, true)" ng-if="isInsightsSupported()  && shouldShowInfocusButton()"><i class="glyphicon pbi-glyph-insight"></i></button> <button class="vcPinBtn" ng-click="pinTileFromDashboard($event)" ng-disabled="model.isLoading" ng-hide="!shouldShowPinButton();" localize-tooltip="PinVisual_ToolTip"><i class="glyphicon pbi-glyph-pinned"></i></button> <button class="vcAlertBtn" ng-click="showAlertsEditor($event)" ng-disabled="model.isLoading" ng-hide="::!shouldShowAlertsButton();" localize-tooltip="ManageAlerts_Tooltip"><i class="glyphicon pbi-glyph-bell"></i></button> <button class="vcExportBtn" ng-click="exportVisualData($event);" ng-if="::canExport" localize-tooltip="ExportData_MenuItem"><i class="glyphicon pbi-glyph-export glyph-small"></i></button> <button class="editTileBtn" ng-click="editTile($event);" ng-disabled="model.isLoading" localize-tooltip="TileEditor_PaneTitle_Details"><i class="glyphicon pbi-glyph-edit"></i></button> <button class="deleteTileBtn" ng-click="deleteTile();" localize-tooltip="TileEditor_DeleteTile"><i class="glyphicon pbi-glyph-delete"></i></button></div><div class="webContentWarning" ng-if="::viewModel.type === 1"><span localize="WebContentWarning_Widget" localize-tooltip="WebContentWarning_Widget"></span><a href="https://go.microsoft.com/fwlink/?LinkID=759648" localize="LearnMore" target="_blank"></a></div></div>'),
e.put("views/tiles/imageTile.html",'<div class="imageTile"><printable-image source="{{viewModel.imageUrl}}"></printable-image></div>'),e.put("views/tiles/modelTile.html",'<div class="modelTile"><printable-image source="{{imageUrl}}"></printable-image></div>'),e.put("views/tiles/providerTile.html",'<div class="dashboardTaskPaneTile" ng-click="openTile()"><div class="background" background-image="{{viewModel.backgroundImageUrl}}"></div><div class="dashboardTaskPaneTitle" ng-bind="viewModel.displayText"></div></div>'),e.put("views/tiles/reportTile.html",'<div class="explorationContainer" ng-switch="viewModel.isError"><exploration ng-switch-when="false" view-model="viewModel.exploration" disable-print="true"></exploration><error-placeholder ng-switch-when="true" error-text="viewModel.errorText"></error-placeholder></div>'),e.put("views/tiles/ssrsTile.html",'<div class="ssrsTile"><printable-image source="{{viewModel.imageUrl}}"></printable-image></div>'),e.put("views/tiles/tile.html",'<div class="tile baseTile" ng-class="{ noTitle: !viewModel.hasTitle(), largeHeader:largeHeader, noSubtitle: !viewModel.hasSubtitle() && viewModel.hasTitle() }"><div class="item-auto" ng-if="::(viewModel.type === 1)"><div class="webContentCorner"></div> <button class="webContentIcon" localize-tooltip="WebContentWarning_Widget" ng-click="onIconClick(getWebContentIcon(), $event)"><i class="glyphicon pbi-glyph-securityalert glyph-small"></i></button></div><header class="flexbox"> <button ng-repeat="icon in ::getIcons()" class="item-auto {{::icon.itemClass}}" ng-if="::icon.show()" title="{{::icon.tooltip()}}" ng-click="onIconClick(icon, $event)"><i class="glyphicon glyph-small {{::icon.iconClass}}"></i><span class="badge" ng-if="::icon.hasBadge" ng-bind="icon.badgeValueSetter()"></span></button><div class="headerText item-fill unselectable" ng-click="headerClickTarget({event: $event})"><div class="displayText" ng-bind="viewModel.getDisplayText()"></div><div class="flexbox"><span class="subDisplayText item-auto first-part" ng-bind="viewModel.getSubDisplayText()"></span> <span class="subDisplayText item-auto" ng-show="viewModel.shouldPlaceBulletSeperator()"></span><span class="subDisplayText item-auto item-fill" bind-text-and-tooltip="viewModel.lastRefreshTimeInLocaleWithLabel()"></span></div></div></header><section><div class="loadingPlaceholder"><div class="loadingPlaceholderText glyphicon pbi-glyph-powerbi glyph-large"></div></div><div ng-show="!viewModel.isTileLoading && shouldShowTileVisual()" class="tileBody unselectable" ng-class="::{nonInteractive: disablePointerEvents}" ng-switch on="::{{viewModel.type}}"><composite-tile view-model="viewModel.composite" ng-switch-when="0" allow-interactivity="{{::allowInteractivity}}"></composite-tile><iframe-tile view-model="viewModel.iframe" ng-switch-when="1"></iframe-tile><image-tile view-model="viewModel.image" ng-attr-title="{{viewModel.displayText}}" ng-switch-when="2"></image-tile><model-tile view-model="viewModel.model" ng-switch-when="3"></model-tile><ssrs-tile view-model="viewModel.ssrs" ng-switch-when="4"></ssrs-tile><workbook-tile view-model="viewModel.workbook" ng-switch-when="5"></workbook-tile><report-tile view-model="viewModel.reportTile" ng-switch-when="6"></report-tile><real-time-tile view-model="viewModel.realTime" ng-switch-when="8"></real-time-tile></div><error-placeholder ng-if="!shouldShowTileVisual()" error-text="errorText" error-details="errorDetails"></error-placeholder></section></div>'),e.put("views/tiles/workbookTile.html",'<div class="workbookTile" ng-class="{hasTitle: title}" ng-switch="useLiveEwaControl"><iframe ng-src="{{::workbookTileUrl}}" ng-switch-when="true"/><printable-image source="{{viewModel.dynamicImageUrl}}" disable-animation="true" ng-class="{backgroundOriginalSize: viewModel.keepOriginalContentSize}" ng-switch-when="false"></printable-image> <img class="internalWorkbookTileImage" name="internalWorkbookTileImage" ng-src="{{viewModel.previewImageUrl}}" ng-hide="true"/></div>'),e.put("views/usageBarMenuItemView.html",'<div class="usageBarMenuItemBlock"><div class="{{labelClass}}">{{text}}</div><div class="toptext">{{usageDescription}}</div><section class="usageBar"><div class="bar usedSpace"></div><div class="bar freeSpace"></div></section></div>'),e.put("views/usageBarView.html",'<div class="usageBarBlock"><div class="toptext">{{usageBarModel.usageDescription}}</div><section class="usageBar"><div class="bar selfUsed"></div><div class="bar othersUsed"></div><div class="bar freeSpace"></div></section><section class="legends"><span class="square selfUsed"></span><div class="textstyle">{{usageBarModel.selfUsageInUnit}}</div><span ng-switch on="viewModel.isMyWorkspace"><div class="textstyle" localize="QuotaManagement_OwnedByMe" ng-switch-when="true"></div><div class="textstyle" localize="QuotaManagement_OwnedByUs" ng-switch-when="false"></div></span><span class="square othersUsed"></span><div class="textstyle">{{usageBarModel.otherUsageInUnit}}</div><div class="textstyle" localize="QuotaManagement_OwnedByOthers"></div></section><section class="limit"><div class="limitnumber">{{viewModel.quotaLimitInUnit}}</div><div class="limitline"></div></section></div>'),e.put("views/userGroupHeaderView.html",'<header class="userGroupHeader"><h1><span class="name" ng-bind="viewModel.isMyWorkspace ? viewModel.userName : viewModel.activeGroup.displayName"></span><span class="servicePlan" localize="QuotaManagement_FreeUser" ng-if="::!viewModel.isPremiumUser"></span><span class="servicePlan" localize="QuotaManagement_ProTrialUser" ng-if="viewModel.userHasFreeTrial && !viewModel.userHasPremiumPlan && viewModel.isMyWorkspace"></span><span class="servicePlan" localize="QuotaManagement_ProUser" ng-if="viewModel.userHasPremiumPlan && viewModel.isMyWorkspace"></span></h1></header>'),e.put("views/warningBar.html",'<div class="warningBar"><span class=\'warning\'><i class=\'glyphicon pbi-glyph-error icon\'></i></span><div class=\'errorMessage\'>{{viewModel.text}}</div><div class=\'button officeStyleLink\' ng-if="viewModel.type === 1" localize="ErrorBar_FixItText" ng-click="onFixItClick()"></div><div class=\'button officeStyleLink\' ng-if="viewModel.type === 2" localize="ErrorBar_NoText" ng-click="onNoClick()"></div><div class=\'button officeStyleLink\' ng-if="viewModel.type === 2" localize="ErrorBar_YesText" ng-click="onYesClick()"></div></div>'),e.put("views/waterMarkMessage.html",'<div class="waterMarkMsg unselectable"><i class="glyphicon" ng-class="{true: \'pbi-glyph-error glyph-med\', false: \'pbi-glyph-warning glyph-med warningIcon\'}[config.mode]"></i><div ng-if="config.imgClass" ng-class="config.imgClass"></div><div ng-switch="config.canEdit"><div ng-switch-when="true"><h2 class="title" ng-bind="config.titleNonShared"></h2><p class="content" ng-bind="config.contentNonShared"></p></div><div ng-switch-when="false"><h2 class="title" ng-bind="config.titleShared"></h2><p class="content" ng-bind="config.contentShared"></p><p ng-bind="config.contact"></p></div></div><p ng-if="config.linkAction"><span class="linkDescription" ng-bind="config.linkDescription"></span><span class="linkText" ng-mousedown="config.linkAction()" ng-bind="config.linkText"></span></p><pbi-button ng-if="config.btnClick" label="{{config.btnLabelKey}}" localize-tooltip="{{config.btnLabelKey}}" ng-click="config.btnClick()" primary="true"></pbi-button></div>'),e.put("views/workbookAppBar.html",'<div class="workbookAppBarContent appBar trimmedTextWithEllipsis unselectable"><div class="appBarSection left"><ul><li class="workbookAppBarItemNotClickable"><span class="excelOnlineText" localize="WorkbookAppBar_ExcelOnline"></span></li><li class="appBarDivider"></li><li class="edit-menu" ng-class="{workbookAppBarItemNotClickable: !isEditEnabled()}"> <button dropdown-menu dropdown-items="editMenuActions" dropdown-class="workbookAppBarMenu" dropdown-dark-theme="viewModeState.getMode() === 0" dropdown-on-item-selected="editMenuActionSelected(selected)" ng-disabled="!isEditEnabled()" localize-tooltip="{{getEditButtonTooltipLocId()}}" dynamic-tooltip-update tabindex="0"><span localize="WorkbookAppBar_EditButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li></ul></div><div class="appBarSection right"><app-action-menu ng-if="inAppArtifactView()"></app-action-menu><ul><li ng-switch="getRefreshDataStatus()" class="appBarText refreshStatus workbookAppBarItemNotClickable"><div ng-switch-when="0"><span ng-bind="refreshInformationText"></span></div><div ng-switch-when="1"> <button ng-click="showRefreshHistory()"><i class="glyphicon pbi-glyph-warning"></i></button><span ng-bind="refreshInformationText"></span></div><div ng-switch-when="2"><i class="glyphicon pbi-glyph-info" tooltip tooltip-config="refreshNotSupportedTooltip"></i><span ng-bind="refreshInformationText"></span></div></li><li class="reload" ng-class="{workbookAppBarItemNotClickable: !isWorkbookLoaded()}"> <button ng-disabled="!isWorkbookLoaded()" ng-click="reloadClicked()"><i class="glyphicon pbi-glyph-refresh"></i><span localize="WorkbookAppBar_ReloadButton"></span></button></li><li class="data-menu" id="data" ng-class="{workbookAppBarItemNotClickable: !isWorkbookLoaded()}"> <button ng-disabled="!isWorkbookLoaded()" dropdown-menu dropdown-items="dataMenuActions" dropdown-class="workbookAppBarMenu" dropdown-on-item-selected="dataMenuActionSelected(selected)" tabindex="0"><i class="glyphicon pbi-glyph-dataset"></i><span localize="WorkbookAppBar_DataButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button></li><li ng-class="{workbookAppBarItemNotClickable: !isPinToDashboardEnabled()}"> <button class="pinToDashboard" ng-disabled="!isPinToDashboardEnabled()" ng-click="pinClicked()" localize-tooltip="{{getPinButtonTooltipLocId()}}" dynamic-tooltip-update><i class="glyphicon pbi-glyph-pinned"></i><span localize="WorkbookAppBar_PinWorkbookElementButton"></span></button></li></ul></div></div>'),e.put("views/workbookContainer.html",'<div id="workbookContainerWrapper" class="workbookContainerContent"><workbook-discoverability-toast class="discoverabilityToast"></workbook-discoverability-toast><workbook-app-bar view-model="viewModel" ng-if="workbookAppBarIncluded"></workbook-app-bar><spinner class="centeredSpinner" ng-show="!isEmbeddedWorkbookReady && !embeddedWorkbookFailed"></spinner><iframe name="workbookEWAIsolation" class="workbookEWAIsolation" src="/ewaIsolation.cshtml" ng-if="isEmbeddedWorkbookDataReady" ng-class="{\'fullSizeFrame\': !workbookAppBarIncluded }"></iframe></div>'),e.put("views/workbookDiscoverabilityToast.html",'<div class="workbookDiscoverabilityToast" ng-show="viewModel.showDiscoverabilityToast"><div class="arrow"></div><div class="title" localize="WorkbookPinDiscoverability_Title"></div><div class="message" localize="WorkbookPinDiscoverability_Message"></div><div class="gotItBtn"><pbi-button label="TutorialPopup_GotIt" primary="true" ng-click="dismissToast()"></pbi-button></div><i class="glyphicon pbi-glyph-pinned"></i></div>')}]);var powerbi;!(function(e){function t(e,t,i,o,r,a,n,s,c,d,p,u,h){return new l(e,t,i,o,r,a,n,s,c,d,p,u,h)}var i=e.dataServices.ContractUtils,o=e.explore.util.FilterContainerBuilder,r=e.explore.viewModels.FilterViewModelFactory,a=e.explore.QueryProjectionBuilderCoreUtils,n=e.data.services.SemanticQuerySerializer,s=e.dataServices.contracts.TileType;e.createExportDataService=t;var c="sobe_onpremisevirtualserver",l=(function(){function t(e,t,i,o,r,a,n,s,c,l,d,p,u){this.promiseFactory=e,this.notificationToastService=t,this.localizationService=i,this.conceptualSchemaProxy=o,this.visualPluginService=r,this.visualPluginOps=a,this.exportVisualDataService=n,this.featureSwitchService=s,this.displayNameService=c,this.aggrOps=l,this.filterRestatementService=d,this.fileSaver=p,this.lazyScopedSync=u}return t.prototype.exportTileDataToCsv=function(t){var o=this,r=t.composite,s=t.contract,c=t.config,l=e.dataServices.TileUtils.getVisualType(c),d=this.getDataSources(t),p=this.promiseFactory.defer(),u=this.localizationService,h=this.notificationToastService,v=h.notify({title:u.get("ExportData_LoadingTitle"),message:u.get("ExportData_LoadingMessage"),notificationType:e.common.NotificationToastType.Loading});return this.conceptualSchemaProxy.get(d).then((function(t){h.hide(v);var u=i.convertToSemanticQueryWithDataShapeBinding(s.query),g=n.deserializeQuery(u.defn),m=c.visualContainer.elements,f=m&&m.length>0?m[0].DataRoles:null,b=o.visualPluginService.getPlugin(l),y=a.createProjectionBuilderFromDataRoles(b,f,g,t),S=o.visualPluginService.capabilities(l);if(S){var w=c.visualContainer.$visualContainer.config.singleVisual.objects,D={objects:w,visualType:l,query:new e.explore.contracts.VisualQuery(g,y.build(u.shape))};o.exportVisualDataToCsv(c.visualContainer.heading1,r.tileData,d,D,r.visual.dataTransforms,null).then((function(e){p.resolve(e)}),(function(e){p.reject(e)}))}}),(function(){h.hide(v)})),p.promise},t.prototype.exportVisualDataToCsv=function(t,i,o,r,a,n){var s=this.localizationService,c=this.notificationToastService,l=c.notify({title:s.get("ExportData_LoadingTitle"),message:s.get("ExportData_LoadingMessage"),notificationType:e.common.NotificationToastType.Loading,sticky:!0}),d=this.exportVisualDataService.exportToCsv(t,i,o,r,a,n);return this.handleExportDataResult(d,l)},t.prototype.exportVisualDataToExcel=function(t,i,o,r,a,n){var s=this,c=this.localizationService,l=this.notificationToastService,d=this.promiseFactory.defer(),p=l.notify({title:c.get("ExportData_LoadingTitle"),message:c.get("ExportData_LoadingMessage"),notificationType:e.common.NotificationToastType.Loading,sticky:!0});return this.conceptualSchemaProxy.get(i).then((function(e){var c=o;if(a){var l=s.lazyScopedSync("drillToDetails").generateDetailsTable(o,e,n);if(!l)return void d.reject({blob:null,error:4});c=l}s.generateFiltersDescriptionPromise(e,r,c,i).then((function(e){s.exportVisualDataService.exportToExcel(t,i,c,r,e).then((function(e){d.resolve(e)}),(function(e){d.reject(e)}))}),(function(){d.reject({blob:null,error:5})}))}),(function(){d.reject({blob:null,error:3})})),this.handleExportDataResult(d.promise,p)},t.prototype.canExportTileData=function(t){if(!this.featureSwitchService.featureSwitches.exportDataEnabled)return!1;if(t.type!==s.composite)return!1;var o=t.composite&&t.composite.visual&&t.composite.visual.type,r=this.visualPluginService.getPlugin(o);if(!r)return!1;if(!t.composite.tileData)return!1;if(!this.visualPluginOps.isQueryVisual(o))return!1;try{var a=t&&t.contract&&t.contract.query,n=i.convertToSemanticQueryWithDataShapeBinding(a),c=n.defn;if(!c||!c.Version||c.Version<e.data.SemanticQueryVersions.Version2)return!1}catch(e){return!1}return!0},t.prototype.getExportDataToExcelUnsupportedType=function(e,t){var i=e.objects,o=e.visualType,r=!0;return!r&&this.isDataModelASOnPremises(t)?1:i&&i.forecast?3:i&&i.clustering?2:this.visualPluginService.isScriptVisual(o)?4:this.visualPluginService.isCustomVisual(o)?5:0},t.prototype.isDataModelASOnPremises=function(e){return e&&e.vsName&&e.vsName===c},t.prototype.generateFiltersDescriptionPromise=function(t,i,a,n){var s={filtersNamesAndRestatements:[]},c=this.promiseFactory.defer();if(!i||!i.dataFilter)return c.resolve(s),c.promise;var l=o.fromSemanticFilter(i.dataFilter,t);if(!l)return c.resolve({}),c.promise;for(var d={container:{filters:l},scopeType:0},p=[],u=[],h=[],v=0,g=l;v<g.length;v++){var m=g[v],f=this.visualPluginService.capabilities(a.visualType),b=r.convertFilterContainer(m,t,this.displayNameService,d,this.visualPluginService,this.aggrOps,this.localizationService,f,a);b.updateFilterProperties(t,this.visualPluginService,this.aggrOps),b.contract.config={singleVisual:a};var y={includeVariationSource:!0},S=b.contract.expression,w=a.query.defn.selectNameOf(S);p.push(this.displayNameService.getDisplayName(S,t,f,w,a.columnProperties,y)),u.push(this.displayNameService.getQualifiedDisplayName(S,t,f,y));var D=this.promiseFactory.defer(),C=e.explore.components.TopNFilterViewModelFactory.createViewModelFromSemanticFilter(m.filter,t,this.localizationService,this.displayNameService,this.aggrOps);if(C)D.resolve(C.getRestatement(this.localizationService));else{var T=e.explore.viewModels.FilterViewModelFactory.extractAdvFilterCard(m);if(!T)return c.resolve({}),c.promise;var I=T.getRestatement(b.formatter);I?D.resolve(I):D.promise=this.filterRestatementService.loadRestatement(n,m,b.formatter)}h.push(D.promise)}return p.length!==l.length||h.length!==l.length||u.length!==l.length?(c.resolve({}),c.promise):(this.promiseFactory.all(h).then((function(e){for(var t=0;t<l.length;t++)_.isEmpty(p[t])||_.isEmpty(e[t])||s.filtersNamesAndRestatements.push({displayName:p[t],qualifiedDisplayName:u[t],restatement:e[t]});c.resolve(s)})),c.promise)},t.prototype.getDataSources=function(t){var i=t.contract,o=e.explore.contracts.createDataSourceArray(),r={type:"dsr",id:i.modelId,name:i.modelName,dsr:{schemaName:i.modelName,vsName:t.vsName,dbName:t.dbName,modelId:i.modelId}};if(o.push(r),this.featureSwitchService.featureSwitches.reportMeasures){var a=e.explore.constants.ExplorationSchemaName;o.push({type:e.explore.dataReaderPlugins.ExplorationDataReaderType,id:i.id,name:a,extends:i.modelName,exploration:{schemaName:a,extends:i.modelName,getModelExtensions:function(){return t.config.visualContainer.$modelExtensions}}})}return o},t.prototype.saveResult=function(e){switch(e.format){case 0:this.fileSaver.saveAs(e.blob,e.fileName,{type:"text/csv;charset=utf-8;"});break;case 1:this.fileSaver.saveAs(e.blob,e.fileName,{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;"})}},t.prototype.handleExportDataResult=function(t,i){var o=this,r=this.promiseFactory.defer(),a=this.localizationService,n=this.notificationToastService;return t.then((function(t){null!=t.error?(n.notify({title:a.get("ExportData_FailureTitle"),message:a.get("ExportData_FailureMessage"),notificationType:e.common.NotificationToastType.Error}),r.reject(t)):(t.isPartialResult&&n.notify({title:a.get("ExportData_PartialDataTitle"),message:a.get("ExportData_PartialDataMessage"),notificationType:e.common.NotificationToastType.Warning}),o.saveResult(t),r.resolve(t))}),(function(t){n.notify({title:a.get("ExportData_FailureTitle"),message:a.get("ExportData_FailureMessage"),notificationType:e.common.NotificationToastType.Error}),r.reject(t)})).finally((function(){return n.hide(i)})),r.promise},t})();e.ExportDataService=l})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,r){return new o(e,t,i,r)}t.createExportStaticExplorationService=i;var o=(function(){function t(e,t,i,o){this.exportStaticReportProxy=e,this.notificationToast=t,this.localizationService=i,this.fileSaver=o}return t.prototype.exportToPng=function(i,o,r){var a=this,n=this.localizationService,s=this.notificationToast.notify({title:n.get("ExportStaticImage_Title"),message:n.get("ExportStaticImage_Message"),notificationType:e.common.NotificationToastType.Loading});this.exportStaticReportProxy.exportAsImage(o,r).then((function(e){a.fileSaver.saveAs(e.blob,t.getFileName(i),{type:"image/png"})})).finally((function(){a.notificationToast.hide(s)}))},t.getFileName=function(e){var t=jsCommon.StringExtensions.normalizeFileName(e);return t+".png"},t})();t.ExportStaticExplorationService=o})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){var i=this;this.restrict="E",this.replace=!0,this.templateUrl="views/pbiDataLoaderSpinner.html",this.link=function(e,t,o){var r=t.find("h3");r.text(i.loc.get("DataLoaderSpinner_LoadingMessage1")),i.timeout((function(){r.text(i.loc.get("DataLoaderSpinner_LoadingMessage2"))}),5e3)},this.loc=e,this.timeout=t}return e})();e.PbiDataLoaderSpinner=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o,a,n,s){return new r(e,t,i,o,a,n,s)}var o=e.common.constants;t.createPageTitleService=i;var r=(function(){function t(e,t,i,o,r,a,n){this.navigationService=t,this.window=a,this.dashboardService=i,this.reportService=o,this.localizationService=e,this.workbookService=r,this.rootScope=n,this.initialize()}return t.prototype.refresh=function(){var e,t=this.navigationService,i=this.localizationService,o=this.reportService,r=this.workbookService,a=this.dashboardService;if(t.inReportView()){var n=o.findReportByGUID(t.currentReportGUID);n&&n.displayName&&(e=i.format("PowerBI_PageTitle",[n.displayName]))}else if(t.inWorkbookView()){var s=r.findWorkbookByUniqueId(t.currentWorkbookURLIdentifier);s&&s.displayName&&(e=i.format("PowerBI_PageTitle",[s.displayName]))}else if(t.inDashboardView()){var c=a.findDashboardByGUID(t.currentDashboardGUID);c&&c.displayName&&(e=i.format("PowerBI_PageTitle",[c.displayName]))}_.isEmpty(e)&&(e=i.get("Power_BI")),this.window.document.title=e},t.prototype.initialize=function(){var t=this,i=this.rootScope,r=function(){t.refresh()},a=i.$on(o.navigation.stateChangeSuccess,r),n=i.$on(o.currentActiveReportInfoChangedEventName,r),s=i.$on(e.constants.renameDashboardEventName,r),c=i.$on(e.constants.dashboardContainerLoaded,r);i.$on("$destroy",(function(){a(),n(),s(),c()}))},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,o){return new r(e,t,i,o)}var o=e.common.models.CollapsiblePaneExpandedWidth;t.createShareSliderService=i;var r=(function(){function e(e,t,i,o){this.navigation=e,this.rootscope=t,this.taskPaneSliderService=i,this.licenseEnforcementService=o}return e.prototype.openShareSlider=function(e){e&&(this.shareDashboard=e,this.licenseEnforcementService.supportsSharing(!0)&&this.taskPaneSliderService.expandPane(6,o.Large))},e.prototype.openShareReportSlider=function(e){e&&(this.shareReport=e,this.taskPaneSliderService.expandPane(23,o.Large))},e.prototype.openGrantAccessPane=function(e,t){e&&(this.grantAccessArtifact=e,this.callbackOnSuccess=t,this.licenseEnforcementService.supportsSharing(!0)&&this.taskPaneSliderService.expandPane(21,o.Large))},e.prototype.closeGrantAccessPane=function(e){e&&this.callbackOnSuccess&&this.callbackOnSuccess(),this.callbackOnSuccess=void 0,this.taskPaneSliderService.collapsePane()},e})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){var o=this;this.excelProviderBaseEndpointPath="/powerbi/providers/excel/",this.scope=t,this.services=i,this.scope.isLoading=!1,this.scope.hasError=!1;var r,a="<share-point-url-modal></share-point-url-modal>",n=this.services.telemetryService.startChildEvent(this.services.telemetryService.root,e.telemetry.CustomConfigHandlerSharePointDiscover,this.scope.url),s={dialogName:this.services.localizationService.get("SharePoint_ModalTitle"),isDismissable:!1,scope:this.scope,template:a,focusOnFirstButton:!0,dialogActions:[new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialog_Connect"),function(i,a){o.scope.isLoading=!0,o.scope.hasError=!1,o.services.contentProviderConfigHandler.configData={},o.services.contentProviderConfigHandler.configData.sharePointUrl=o.scope.url,o.getDocumentLibararies(n.event).then((function(i){o.services.contentProviderConfigHandler.configData.result=i,o.scope.isLoading=!1,r.closeDialog(),t.$emit(e.common.constants.contentProviderStoreCustomConfigurationPostbackEventName,!0),n.resolve()}),(function(t){o.scope.hasError=!0,o.scope.isLoading=!1,(t.status=e.HttpStatusCode.NotFound)?(o.scope.errorMessage=o.services.localizationService.get("SharePoint_AccessError"),n.resolve()):(r.closeDialog(),n.reject())}))}),new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialog_Cancel"),function(i,a){o.scope.isLoading=!1,o.scope.hasError=!1,r.closeDialog(),t.$emit(e.common.constants.contentProviderStoreCustomConfigurationPostbackEventName,!1)})],notificationType:jsCommon.ModalDialogNotificationType.Info};r=this.services.modalDialogService.showLegacyWebModalDialog(s)}return t.createOptions=function(){return{additionalServices:["modalDialogService","localizationService","contentProviderConfigHandler","telemetryService"]}},t.prototype.getDocumentLibararies=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"GetSharepointDocumentLibraries"),o=this.excelProviderBaseEndpointPath+"allDocumentLibraries";return this.scope.url&&(o=o+"?siteUrl="+this.scope.url),e.common.httpService.get(o,i)},t})();t.SharePointUrlInputController=i})(i=t.contentProviderStore||(t.contentProviderStore={}))})(t=e.controllers||(e.controllers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.templateUrl="views/tiles/dashboardTileOpenOptions.html",this.replace=!0}return e})();e.DashboardTileOpenOptions=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.templateUrl="views/tiles/dashboardTileOptionsMenu.html",this.replace=!0}return e})();e.DashboardTileOptionsMenu=t})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=(function(){function t(){this.restrict="E",this.controller=e.common.createController(e.controllers.contentProviderStore.SharePointUrlInputController)}return t})();t.SharePointUrlInput=i})(t=e.directives||(e.directives={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.constants,o=(function(){function e(){}return e.getClusterLocation=function(e,t){var o=i.clusterLocations;for(var r in o)for(var a=o[r],n=0,s=a;n<s.length;n++){var c=s[n];if(e.toLocaleLowerCase().indexOf(c)>=0)return t.get(r)}return t.get("Cluster_Location_TestEnvironment")},e})();t.ClusterLocationHelper=o})(t=e.helpers||(e.helpers={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,o,r,n){return new a(e,t,i,o,r,n)}var i=e.contracts.DynamicMessageNotificationLevel,o=e.contracts.DynamicMessageNotificationType,r=e.contracts.DynamicMessageActionType;e.createDynamicMessagingDataService=t;var a=(function(){function t(e,t,i,o,r,a){var n=this;this.dynamicMessagingDataHttp=e,this.userNotificationInfo=t,this.userInfo=i,this.telemetryService=o,this.localizationService=r,this.asyncFeatureSwitchService=a,"undefined"!=typeof dynamicMessagingUrl&&this.asyncFeatureSwitchService.getFeatureSwitches().then((function(){n.asyncFeatureSwitchService.featureSwitches.dynamicMessageEnabled&&n.getData()}))}return t.prototype.postData=function(t){if(this.notificationMessage){var i=this.telemetryService.startEvent(e.telemetry.DynamicMessageUserAction,t);return this.dynamicMessagingDataHttp.postData(this.localizationService.currentLanguageLocale,this.notificationMessage.MessageID,this.notificationMessage.TransactionID,this.notificationMessage.CampaignId,this.userInfo.puid,t).then((function(e){i.resolve()}),(function(t){i.reject({errorCode:"DynamicMessagingPostUserActionFailed.",errorSource:e.telemetry.ErrorSource.External})}))}},t.prototype.getData=function(){var t=this,i=this.telemetryService.startEvent(e.telemetry.DynamicMessageGetMessage,!1);this.userInfo.puid&&this.dynamicMessagingDataHttp.getData(this.userInfo.puid,this.localizationService.currentLanguageLocale).then((function(o){if(null!=o.data){var r=o.data[dynamicMessageSurfaceName],a=r.Data;if(r&&99!==r.ContentType&&r.Message){t.notificationMessage=r;var n=jsCommon.JsonExtensions.tryParseJSON(r.Message);n&&n.NotificationTitle&&n.NotificationMessage&&(t.userNotificationInfo.addClientNotification({id:0,notificationCategory:e.userNotifications.contracts.NotificationCategory.DynamicMessage,notificationType:t.getUserNotificationType(a),notificationLevel:t.getUserNotificationLevel(a),message:t.createNotificationMessage(n),action:_.isEmpty(n.Buttons)?null:t.createNotificationAction(n.Buttons[0],n.ActionType),subAction:_.isEmpty(n.Buttons)&&n.Buttons.length<2?null:t.createNotificationAction(n.Buttons[1]),seen:!1}),i.event.info.parsedMessage=!0)}}i.resolve()}),(function(t){i.reject({errorCode:"DynamicMessagingInitializationFailed.",errorSource:e.telemetry.ErrorSource.External})}))},t.prototype.createNotificationAction=function(e,t){var i=null;return e&&(i={resource:{text:e.Text},actionType:this.getNotificationActionType(t),path:[e.URL]}),i},t.prototype.getNotificationActionType=function(t){if(!t)return 5;var i=e.contracts.DynamicMessageActionType[t];switch(i){case r.OpenLink:default:return 5}},t.prototype.createNotificationMessage=function(e){var t={title:{text:e.NotificationTitle},image:this.createNotificationImage(e.Body),message:{text:e.NotificationMessage}};return e.Body&&(t.subTitle=this.createNotificationSubtitle(e.Body)),t},t.prototype.createNotificationImage=function(e){var t={imageType:6};if(e){var i=e.filter((function(e){return e.ImageURL})).map((function(e){return e.ImageURL}));t.imagePath=_.first(i)}return t},t.prototype.createNotificationSubtitle=function(e){var t={},i=e.filter((function(e){return e.Text})).map((function(e){return e.Text}));return _.isEmpty(i)||(t.text=i[0]),t},t.prototype.getUserNotificationType=function(e){if(!e)return 1;var t=o[e.NotificationType];switch(t){case o.NotificationPane:return 1;case o.Popup:return 0;case o.NotificationBar:return 2;default:return 1}},t.prototype.getUserNotificationLevel=function(e){if(!e)return 1;var t=i[e.NotificationLevel];switch(t){case i.Low:return 0;case i.Normal:return 1;case i.High:return 2;default:return 1}},t})();e.DynamicMessagingDataService=a})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(){return new i}e.createDynamicMessagingDataHttpService=t;var i=(function(){function t(){}return t.prototype.getData=function(t,i){var o=e.common.httpService.powerbiRequestOptions();return e.common.httpService.get(jsCommon.StringExtensions.format("{0}/api/V2/messaging/Web/Message?source={1}&Locale={2}&id=5:{3}",dynamicMessagingUrl,dynamicMessageSurfaceName,i,t),o)},t.prototype.postData=function(t,i,o,r,a,n){var s=e.common.httpService.powerbiRequestOptions(),c=jsCommon.StringExtensions.format("{0}/api/v1/messaging/Web/useraction?source={1}&Locale={2}&contentID={3}&transactionID={4}&campaignId={5}&id={6}&type=0&useraction={7}",dynamicMessagingUrl,dynamicMessageSurfaceName,t,i,o,r,a,n);return e.common.httpService.post(c,{},s)},t})();e.DynamicMessagingDataHttpService=i})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t){return new o(e,t)}t.createQuota=i;var o=(function(){function t(e,t){this.storageUsageService=e,this.dashboardService=t}return Object.defineProperty(t.prototype,"quotaLimitInMB",{get:function(){return this.storageUsageService.quotaLimitInMB},enumerable:!0,configurable:!0}),t.prototype.getUsageModels=function(){return this.storageUsageService.getUsageModels(this.dashboardService.dashboards)},t.prototype.getUsage=function(){return this.storageUsageService.getUsage(this.dashboardService.dashboards)},t.prototype.checkQuotaExceeded=function(t,i){return void 0===t&&(t=e.telemetry.QuotaCheckOperation.Unknown),this.storageUsageService.checkQuotaExceeded(this.dashboardService.dashboards,t,i)},t.prototype.getUsageBarMenuItemViewModel=function(){return this.storageUsageService.getUsageBarMenuItemViewModel(this.dashboardService.dashboards)},t.prototype.showQuotaExceedDialog=function(){this.storageUsageService.showQuotaExceedDialog()},t.prototype.isInVisibleDashboard=function(e){return this.storageUsageService.isInVisibleDashboard(e)},t})()})(t=e.services||(e.services={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){function t(e,t,i,r){return new o(e,t,i,r)}var i=e.telemetry.UsageMetricsArtifactType;e.createUsageMetricsHttpService=t;var o=(function(){function t(e,t,i,o){this.telemetryService=e,this.promiseFactory=t,this.httpService=i,this.featureSwitchService=o}return t.prototype.getPackage=function(t,o){return __awaiter(this,void 0,e.Promise,(function(){var r,a,n,s,c,l,d,p,u,h,v;return __generator(this,(function(g){switch(g.label){case 0:r=this.telemetryService.startChildEvent(o,e.telemetry.UsageMetricsHttpGetPackage,t),
g.label=1;case 1:switch(g.trys.push([1,3,,4]),a=void 0,t){case i.Report:a="powerbi/content/providers/usagemetrics/report/{0}";break;case i.Dashboard:a="powerbi/content/providers/usagemetrics/dashboard/{0}"}return n=this.featureSwitchService.featureSwitches,s=n&&n.usageMetricsUpgrade?"?allowUpgrade=true":"",c=jsCommon.StringExtensions.format(a,s),l=this.httpService.powerbiRequestOptions(o,"getPackage"),[4,this.httpService.get(c,l)];case 2:return d=g.sent(),r.resolve(),[2,d.data];case 3:return p=g.sent(),u=this.promiseFactory.defer(),h=e.errorDetailsHelper.getTelemetryErrorDetails(p.error),r.reject(h),v=this.getErrorCode(p),u.reject({errorCode:v,requestId:p.requestId,error:p.error}),[2,u.promise];case 4:return[2]}}))}))},t.prototype.getErrorCode=function(e){var t;return e&&(e.error?t=e.error.code:e.status&&(t=e.status.toString())),t},t})()})(powerbi||(powerbi={}));;"use strict";var powerbi;!(function(e){var o;!(function(o){function t(t,n,r,i,a,s,p,d,l,v){var m=o.CustomerAction(n,r,i,a,s,p,d,l,v),S=u(m.info,{reportGuid:t}),f={name:"PBI.StandaloneReportHost.LoadExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({reportGuid:S.reportGuid},null,m.formatted())},info:S,loggers:o.StandaloneReportHostLoadExplorationLoggers};return f}function n(t,n,r,i,a,s,p,d,l,v,m){var S=o.CustomerAction(r,i,a,s,p,d,l,v,m),f=u(S.info,{reportGuid:t,endPoint:n}),R={name:"PBI.StandaloneReportHost.GetExplorationAndModel",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({reportGuid:f.reportGuid,endPoint:f.endPoint},null,S.formatted())},info:f,loggers:o.StandaloneReportHostGetExplorationAndModelLoggers};return R}function r(t,n,r,i,a,s,p,d,l,v,m){var S=o.CustomerAction(r,i,a,s,p,d,l,v,m),f=u(S.info,{reportGuid:t,clientAndServerRequestIdMatch:n}),R={name:"PBI.StandaloneReportHost.GetExplorationAndModelRequestInfo",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({reportGuid:f.reportGuid,clientAndServerRequestIdMatch:f.clientAndServerRequestIdMatch},null,S.formatted())},info:f,loggers:o.StandaloneReportHostGetExplorationAndModelRequestInfoLoggers};return R}function i(t,n,r,i,a,s,p,d,l){var v=o.CustomerAction(t,n,r,i,a,s,p,d,l),m=u(v.info,{}),S={name:"PBI.StandaloneReportHost.LoadingStarted",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:m,loggers:o.StandaloneReportHostLoadingStartedLoggers};return S}function a(t,n,r,i,a,s,p,d,l){var v=o.CustomerAction(t,n,r,i,a,s,p,d,l),m=u(v.info,{}),S={name:"PBI.StandaloneReportHost.PageLoaded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:m,loggers:o.StandaloneReportHostPageLoadedLoggers};return S}function s(t,n,r,i,a,s,p,d,l){var v=o.CustomerAction(t,n,r,i,a,s,p,d,l),m=u(v.info,{}),S={name:"PBI.StandaloneReportHost.ScriptLoaded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:m,loggers:o.StandaloneReportHostScriptLoadedLoggers};return S}function p(t,n,r,i,a,s,p,d,l){var v=o.CustomerAction(t,n,r,i,a,s,p,d,l),m=u(v.info,{}),S={name:"PBI.StandaloneReportHost.SwitchedPage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted(null,null,v.formatted())},info:m,loggers:o.StandaloneReportHostSwitchedPageLoggers};return S}function d(t,n,r,i,a,s,p,d,l,v){var m=o.CustomerAction(n,r,i,a,s,p,d,l,v),S=u(m.info,{IsResolvedDuringScriptLoad:t}),f={name:"PBI.StandaloneReportHost.ClusterResolved",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:c(),formatted:function(){return e.extendFormatted({IsResolvedDuringScriptLoad:S.IsResolvedDuringScriptLoad},null,m.formatted())},info:S,loggers:o.StandaloneReportHostClusterResolvedLoggers};return f}var c,l=jsCommon.Utility,u=jsCommon.UnionExtensions.mergeUnionType;c=l?l.generateGuid:Function.prototype,o.StandaloneReportHostLoadExploration=t,o.StandaloneReportHostGetExplorationAndModel=n,o.StandaloneReportHostGetExplorationAndModelRequestInfo=r,o.StandaloneReportHostLoadingStarted=i,o.StandaloneReportHostPageLoaded=a,o.StandaloneReportHostScriptLoaded=s,o.StandaloneReportHostSwitchedPage=p,o.StandaloneReportHostClusterResolved=d})(o=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var o;!(function(e){var o;!(function(e){var o;!(function(e){e.LoadReportInStandaloneReportHost="LoadReportInStandaloneReportHost",e.UnloadReportInStandaloneReportHost="UnloadReportInStandaloneReportHost",e.GoToNextSectionInStandaloneReportHost="GoToNextSectionInStandaloneReportHost",e.GoToPreviousSectionInStandaloneReportHost="GoToPreviousSectionInStandaloneReportHost",e.SetPageInStandaloneReportHost="SetPageInStandaloneReportHost"})(o=e.StandaloneReportHostEvents||(e.StandaloneReportHostEvents={}));var t;!(function(e){e.LoadReportError="LoadReportError",e.LoadReportFinished="LoadReportFinished",e.VisualsFinishedRendering="visualsFinishedRendering"})(t=e.StandaloneReportHostProgressNotificationServiceOperationNames||(e.StandaloneReportHostProgressNotificationServiceOperationNames={}))})(o=e.constants||(e.constants={}))})(o=e.standaloneReportHost||(e.standaloneReportHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var o;!(function(o){var t=["powerbi.common","powerbi","powerbi.explore"];angular.module("powerbi.standaloneReportHost.mock",t).factory("userInfo",["telemetryService","errorService","localizationService","userMetadataHttpService","promiseFactory","featureSwitchService","$timeout",function(o,t,n,r,i,a,s){return e.common.createUserInfoService({telemetryService:o,errorService:t,localizationService:n,userMetadataHttpService:r,promiseFactory:i,featureSwitchService:a,timeout:s},{shouldGetUserPhoto:!1,shouldRefreshUserMetadata:!1})}]).factory("navigation",["$location","promiseFactory","$state",function(o,t,n){return new e.services.MockNavigation(o,t,n)}]).factory("userNotificationInfo",(function(){return[]})).factory("userNotificationTileFilterService",(function(){return[]})).factory("permissionDataService",(function(){return[]})).factory("dynamicMessagingData",(function(){return[]})).factory("appMetadataService",["promiseFactory",function(e){return new n(e)}]);var n=(function(){function e(e){this.promiseFactory=e,this.mockInitDashboardContainer={userMetadata:{},homeDashboardId:-1,dashboards:[]},this.getAppMetadataDeferred=this.promiseFactory.defer(),this.getAppMetadataDeferred.resolve(this.mockInitDashboardContainer)}return e.prototype.getAppMetadata=function(){return this.getAppMetadataDeferred.promise},e})(),r=(function(){function e(e){this.promiseFactory=e}return e.prototype.getUserSettings=function(){return this.promiseFactory.resolve(null)},e.prototype.updateAllowQnaDataCollection=function(e,o){return this.promiseFactory.resolve(null)},e.prototype.updateLanguageSetting=function(e,o){return this.promiseFactory.resolve(null)},e.prototype.updatePinDialogPreviewTileFormat=function(e,o){return this.promiseFactory.resolve(null)},e.prototype.updateEsriSetting=function(e,o){return this.promiseFactory.resolve(null)},e.prototype.updateExtendedSettings=function(e,o,t){return this.promiseFactory.resolve(null)},e.prototype.getExtendedSettingByKey=function(e){return this.promiseFactory.resolve(null)},e.prototype.getExtendedSettingsByKeys=function(e){return this.promiseFactory.resolve(_.map(e,(function(e){return null})))},e.prototype.refreshUserSettings=function(){},e})();o.MockUserSettingsService=r})(o=e.standaloneReportHost||(e.standaloneReportHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var o;!(function(o){var t;!(function(t){var n=e.common.events,r=e.common.contracts,i=e.errorDetailsHelper,a=e.common.contracts.Permissions,s=e.explore.viewModels,p=4e3,d=(function(){function t(t,n){var r=this;this.$scope=t,this.services=n,this.$scope=t,this.explorationContainer=s.ViewModelFactory.createExplorationContainer(),this.canvasOptions={autoLayoutVisualPadding:0,scrollbarOffset:0,disableDeferredRendering:!0};var i=a.Read|a.Explore;this.report={permissions:i,hasExploration:!0},window.external&&"notify"in window.external?(this.notificationsEnabled=!0,this.hostingWindow=window.external):this.notificationsEnabled=!1,this.notifyMessage(e.constants.pvScriptsLoaded),this.modelFetched=!1,this.loadPowerViewReportEventEmitted=!1;var p=this.services.rootScope.$on(e.constants.openReportFinished,(function(e,o,t){r.endPageLoadedEvent(o,t),r.notifyMessage(r.preparePvNotificationMsg(o,t))}));this.services.rootScope.$on(o.constants.StandaloneReportHostEvents.LoadReportInStandaloneReportHost,(function(e,o){r.loadReport(o)})),this.services.rootScope.$on(o.constants.StandaloneReportHostEvents.UnloadReportInStandaloneReportHost,(function(e){r.unloadReport()})),this.services.rootScope.$on(o.constants.StandaloneReportHostEvents.GoToNextSectionInStandaloneReportHost,(function(e,o){r.goToNextSection(o)})),this.services.rootScope.$on(o.constants.StandaloneReportHostEvents.GoToPreviousSectionInStandaloneReportHost,(function(e,o){r.goToPreviousSection(o)})),this.services.rootScope.$on(o.constants.StandaloneReportHostEvents.SetPageInStandaloneReportHost,(function(e,o){r.setPage(o)})),t.$on("$destroy",(function(){p()})),this.services.standaloneReportHostService.loadReadyPromise.resolve(null)}return t.createOptions=function(){return{additionalServices:["activeGroupId","errorService","dataServiceModelConverter","telemetryService","$timeout","featureSwitchService","standaloneReportHostService","standaloneReportHostProxyService","promiseFactory"],scopedDependencies:["explorationCapabilities"],scopedServiceRoot:!0}},t.prototype.loadReport=function(o){var t=this;if(this.loadReportConfig=o,window.powerBIAccessToken=o.pbiAccessToken||window.powerBIAccessToken,!window.powerBIAccessToken)return void this.services.errorService.fatal("powerbiToken parameter not specified","Invalid parameters");var n=o.reportObjectId;if(!n)return void this.services.errorService.fatal("reportObjectId parameter not specified","Invalid parameters");if(_.isNumber(window.viewLoadingStarted)){var r=this.services.telemetryService.startEvent(e.telemetry.StandaloneReportHostScriptLoaded);r.event.time=window.viewLoadingStarted,r.resolve(),this.pageLoadedEvent=this.services.telemetryService.startEvent(e.telemetry.StandaloneReportHostPageLoaded),this.pageLoadedEvent.event.time=window.viewLoadingStarted}var i=this.services.telemetryService.startEvent(e.telemetry.StandaloneReportHostLoadExploration,n);this.loadPowerViewReportEventEmitted=!1,o.groupId=o.groupId||e.common.constants.myWorkspaceGroupId,o.tokenRefreshEnabled=!!o.tokenRefreshEnabled,o.allowDeferredRendering=!!o.allowDeferredRendering,window.skipCheckPowerBIAccessToken=!o.tokenRefreshEnabled,this.canvasOptions.disableDeferredRendering=!o.allowDeferredRendering,this.services.activeGroupId.activeGroupObjectId=o.groupId,this.applyExplorationOptions(o),this.services.standaloneReportHostProxyService.getClusterUrl().then((function(e){clusterUri=e.backendUrl,t.initializeReport(n,o).then((function(){return i.resolve()}),(function(e){var r=t.prepareTelemetryErrorDetails("Standalone Report Host: Fail to initialize - Could not initialize report");i.reject(r),t.services.standaloneReportHostService.loadError(n,o.groupId),o.onLoadFailed&&o.onLoadFailed("Standalone Report Host: Fail to initialize")}))}),(function(e){var r=e&&e.error?"Standalone Report Host: "+e.error.code:"Standalone Report Host: Fail to initialize - Could not resolve cluster",a=t.prepareTelemetryErrorDetails(r);i.reject(a),t.services.standaloneReportHostService.loadError(n,o.groupId),o.onLoadFailed&&o.onLoadFailed(r)}))},t.prototype.unloadReport=function(){var e=this;this.$scope.$applyAsync((function(){e.reportContainer=void 0,e.explorationContainer=void 0}))},t.prototype.goToNextSection=function(o){void 0===o&&(o=!1),this.$scope.$emit(e.explore.constants.explorationNextPageEvent),o&&this.$scope.$apply()},t.prototype.goToPreviousSection=function(o){void 0===o&&(o=!1),this.$scope.$emit(e.explore.constants.explorationPreviousPageEvent),o&&this.$scope.$apply()},t.prototype.setPage=function(o){var t=this;if(this.exploration){var n=this.getPageIndexByName(this.exploration.sections,o);n>=0&&(this.$scope.$applyAsync((function(){t.$scope.$emit(e.explore.constants.switchSectionEvent,n)})),this.services.telemetryService.logEvent(e.telemetry.StandaloneReportHostSwitchedPage))}},t.prototype.notifyMessage=function(e){this.notificationsEnabled&&this.hostingWindow.notify(e)},t.prototype.endPageLoadedEvent=function(e,o){if(o){if(this.pageLoadedEvent){var t=this.prepareTelemetryErrorDetails(e);this.pageLoadedEvent.reject(t)}}else this.pageLoadedEvent&&this.pageLoadedEvent.resolve()},t.prototype.preparePvNotificationMsg=function(o,t){var n;if(t){var r=o.length;r>p&&(r=p),n=e.constants.openReportFailed+" "+o.substring(0,r)}else n=e.constants.openReportSucceeded;return n},t.prototype.prepareTelemetryErrorDetails=function(o,t){var n;t&&(n=i.getTelemetryErrorDetails(t));var r={errorSource:n?n.errorSource:e.telemetry.ErrorSource.PowerBI,errorCode:o};return r},t.prototype.initializeReport=function(o,t){var n=this,r=this.services.promiseFactory.defer(),a=this.services.telemetryService.startEvent(e.telemetry.StandaloneReportHostGetExplorationAndModelRequestInfo,o,!1);return this.services.standaloneReportHostProxyService.getModelsAndExploration(o).then((function(e){n.loadExploration(e,t),r.resolve(null),a.resolve()}),(function(e){r.reject(e),a.reject(i.getTelemetryErrorDetails(e.error,e.httpStatusCode))})),r.promise},t.prototype.loadExploration=function(o,t){var n=this;this.notifyMessage(e.constants.openReportStarting),this.exploration=o.exploration,this.model=this.services.dataServiceModelConverter.convertModel(o.models[0]);var r=this.createReportModel(this.report);r.model=this.model,this.reportContainer=this.createReportContainer(this.report),this.reportContainer.report=r,this.reportContainer.report.activeSlideId=t.slideName,this.services.timeout((function(){return n.emitLoadPowerViewReportEvent(t)}))},t.prototype.applyExplorationOptions=function(e){e&&this.services.explorationCapabilities.setCapabilities(e.explorationContainerOptions)},t.prototype.emitLoadPowerViewReportEvent=function(e){if(!this.loadPowerViewReportEventEmitted){this.loadPowerViewReportEventEmitted=!0;var o={report:this.reportContainer.report,model:this.model,instantiationMode:r.reportServer.ReportInstantiationMode.None,exploration:this.exploration,reportPage:e.slideName,additionalODataFilter:e.additionalODataFilter};this.hideLoadingSplash(),this.services.standaloneReportHostService.loadFinished(e.reportObjectId,e.groupId),this.$scope.$emit(n.loadPowerViewReportEventName,o),e.onLoadSuccess&&e.onLoadSuccess()}},t.prototype.createReportModel=function(e){var o=this.services.dataServiceModelConverter.convertReport(e);return this.services.dataServiceModelConverter.fillReport(o,e),o},t.prototype.createReportContainer=function(o){var t=new e.common.models.ReportContainer(o);return t.report=this.createReportModel(o),t},t.prototype.hideLoadingSplash=function(){var e=angular.element("#pbi-loading");_.isEmpty(e)||e.remove()},t.prototype.getPageIndexByName=function(e,o){return e?e.map((function(e){return e.name})).indexOf(o):-1},t})();t.StandaloneReportHostController=d})(t=o.controllers||(o.controllers={}))})(o=e.standaloneReportHost||(e.standaloneReportHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var o;!(function(o){var t;!(function(t){t.StandaloneReportHost={templateUrl:"components/standaloneReportHost/standaloneReportHostView.html",controller:e.common.createController(o.controllers.StandaloneReportHostController)}})(t=o.components||(o.components={}))})(o=e.standaloneReportHost||(e.standaloneReportHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var o;!(function(o){var t;!(function(t){function n(e,o,n,i,a){return t.standaloneReportHostService||(t.standaloneReportHostService=new r(e,o,i,a)),t.standaloneReportHostService}t.createStandaloneReportHostService=n;var r=(function(){function t(e,o,t,n){this.promiseFactory=e,this.rootScopeService=o,this.hostService=t,this.localizationService=n,this.loadReadyPromise=this.promiseFactory.defer()}return t.prototype.loadReport=function(e){var t=this;this.loadReadyPromise.promise.then((function(){t.rootScopeService.$emit(o.constants.StandaloneReportHostEvents.LoadReportInStandaloneReportHost,e)}))},t.prototype.unloadReport=function(){var e=this;this.loadReadyPromise.promise.then((function(){e.rootScopeService.$emit(o.constants.StandaloneReportHostEvents.UnloadReportInStandaloneReportHost)}))},t.prototype.goToNextSection=function(e){var t=this;void 0===e&&(e=!1),this.loadReadyPromise.promise.then((function(){t.rootScopeService.$emit(o.constants.StandaloneReportHostEvents.GoToNextSectionInStandaloneReportHost,e)}))},t.prototype.goToPreviousSection=function(e){var t=this;void 0===e&&(e=!1),this.loadReadyPromise.promise.then((function(){t.rootScopeService.$emit(o.constants.StandaloneReportHostEvents.GoToPreviousSectionInStandaloneReportHost,e)}))},t.prototype.setPage=function(e){var t=this;this.loadReadyPromise.promise.then((function(){t.rootScopeService.$emit(o.constants.StandaloneReportHostEvents.SetPageInStandaloneReportHost,e)}))},t.prototype.loadError=function(e,t){this.sendMessage(o.constants.StandaloneReportHostProgressNotificationServiceOperationNames.LoadReportError,e,t)},t.prototype.loadFinished=function(e,t){this.sendMessage(o.constants.StandaloneReportHostProgressNotificationServiceOperationNames.LoadReportFinished,e,t)},t.prototype.visualsFinishedRendering=function(e,t,n){this.sendMessage(o.constants.StandaloneReportHostProgressNotificationServiceOperationNames.VisualsFinishedRendering,e,t,n)},t.prototype.cancelLoading=function(){this.rootScopeService.$broadcast(e.common.constants.visualCancelLoadEventName,this.localizationService.get("StandAloneReportError_VisualExportTimeout")),this.rootScopeService.$applyAsync()},t.prototype.sendMessage=function(o,t,n,r){var i={id:t,groupId:n,isError:r};this.hostService.invokeAndForget(e.common.constants.ServiceNames.StandaloneHostProgressNotificationService,o,i)},t})();t.StandaloneReportHostService=r})(t=o.services||(o.services={}))})(o=e.standaloneReportHost||(e.standaloneReportHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var o;!(function(o){function t(o){e.common.registerBuildingBlocksForHost(o,i,{componentsTarget:"powerbi.standaloneReportHost.components",componentsMap:e.standaloneReportHost.components})}var n=["powerbi.common","powerbi.explore","powerbi","powerbi.gateways","powerbi.standaloneReportHost.components","powerbi.standaloneReportHost.mock"],r=256,i=[{name:"StandaloneReportHost",dependencies:[],blockType:2,consumerHostFlags:r}];angular.module("powerbi.standaloneReportHost.components",[]),angular.module("powerbi.standaloneReportHost",n).config(["$httpProvider",function(e){e.useApplyAsync(!0)}]).config(["pbiLazyLoadProvider",function(e){e.setHostEnv(r)}]).factory("standaloneReportHostService",["promiseFactory","$rootScope","telemetryService","hostService","localizationService",function(e,t,n,r,i){return o.services.createStandaloneReportHostService(e,t,n,r,i)}]).run(["standaloneReportHostService",function(e){}]),o.registerBuildingBlocksForHost=t,t(r),e.common.registerPBICommonBuildingBlocksForHost(r),e.visualHost.registerBuildingBlocksForHost(r),e.explore.registerBuildingBlocksForHost(r),e.registerBuildingBlocksForHost(r),e.explore.registerBuildingBlocksForHost(r)})(o=e.standaloneReportHost||(e.standaloneReportHost={}))})(powerbi||(powerbi={}));var StandaloneHost;!(function(e){function o(){powerbi.standaloneReportHost.services.standaloneReportHostService.cancelLoading()}function t(e){powerbi.standaloneReportHost.services.standaloneReportHostService.loadReport(e)}function n(){powerbi.standaloneReportHost.services.standaloneReportHostService.unloadReport()}function r(e){powerbi.standaloneReportHost.services.standaloneReportHostService.goToNextSection(e)}function i(e){powerbi.standaloneReportHost.services.standaloneReportHostService.goToPreviousSection(e)}function a(e){powerbi.standaloneReportHost.services.standaloneReportHostService.setPage(e)}e.cancelLoading=o,e.loadReport=t,e.unloadReport=n,e.goToNextSection=r,e.goToPreviousSection=i,e.setPage=a})(StandaloneHost||(StandaloneHost={})),angular.module("powerbi.standaloneReportHost").run(["$templateCache",function(e){e.put("components/standaloneReportHost/standaloneReportHostView.html",'<div class="landingController"><div class="contentMain standaloneHostContentMain"><div class="contentColumn"><div class="landingContainer" ng-class="{\'noSliderBar\': !$ctrl.loadReportConfig.showSlideBar}"><div id="reportLandingContainer" class="landingRootContent reportContainerContent isActive embeddedPV"><div class="embeddedPV"><notification-bar></notification-bar><exploration-container view-model="$ctrl.explorationContainer" canvas-options="$ctrl.canvasOptions" exploration-container-options="$ctrl.loadReportConfig.explorationContainerOptions"></exploration-container></div></div></div></div></div></div>')}]);;"use strict";var powerbi;!(function(e){var r;!(function(r){function t(t,i,s,a,c,l,u,p,d,v){var f=r.CustomerAction(i,s,a,c,l,u,p,d,v),h=n(f.info,{reportObjectId:t}),g={name:"PBI.ReportServerHost.LoadReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:o(),formatted:function(){return e.extendFormatted({reportObjectId:h.reportObjectId},null,f.formatted())},info:h,loggers:r.ReportServerHostLoadReportLoggers};return g}var o,i=jsCommon.Utility,n=jsCommon.UnionExtensions.mergeUnionType;o=i?i.generateGuid:Function.prototype,r.ReportServerHostLoadReport=t})(r=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){function r(e,r,t,o){return new i(e,r,t,o)}var t="PbixPageLoadComplete",o="PbixPageInitialized";e.createReportServerReportHostProxyService=r;var i=(function(){function e(e,r,t,o){this.explorationProxy=e,this.promiseFactory=r,this.errorService=t,this.localizationService=o,this.visualsToLoad=[]}return e.prototype.getModelsAndExploration=function(e){var r=this,t=this.explorationProxy.getModelsAndExploration(e);return t.then((function(e){var t=e.exploration;if(t){var o=t.activeSectionIndex||0,i=t.sections;i&&i.length>0&&i.length>o&&(r.visualsToLoad=i[o].visualContainers||[])}}),(function(e){var t={requestId:e.requestId,statusCode:e.httpStatusCode.toString(),showAdditionalErrorInfo:!0,displayableErrorInfo:[{errorInfoKey:r.localizationService.get(e.error.details[0]),errorInfoValue:""}]};r.errorService.error(r.localizationService.get(e.error.code),e.error.code,t)})),t},e.prototype.getClusterUrl=function(){var e=this.promiseFactory.defer();return e.resolve({backendUrl:"/powerbi/api"}),e.promise},e.prototype.onLoadSuccess=function(){this.fireEvent(o,!0),this.startTrackingVisuals()},e.prototype.onLoadFailed=function(){this.fireEvent(o,!1),this.fireEvent(t,!1)},e.prototype.completePageLoad=function(e){void 0===e&&(e=!1),jsCommon.Trace.verbose("page load complete (timeout: "+e+")"),this.visualsToLoad=[],this.fireEvent(t,!0,e)},e.prototype.fireEvent=function(e,r,t){void 0===t&&(t=!1),window.parent&&window.parent.postMessage({name:e,success:r,timeout:t},location.origin)},e.prototype.startTrackingVisuals=function(){var e=this;0===this.visualsToLoad.length&&this.completePageLoad();var r=6e4,t=Date.now()+r,o=0,i=setInterval((function(){var n=e.visualsToLoad,s=n.filter((function(e){return!(e.cachedData&&e.cachedData.query&&void 0===e.cachedData.dataUpdatedTime)}));s.length===n.length&&(clearInterval(i),e.completePageLoad()),s.length===o&&Date.now()>t&&(clearInterval(i),e.completePageLoad(!0)),s.length>o&&(t=Date.now()+r),o=s.length}),20)},e})();e.ReportServerReportHostProxyService=i})(r=e.services||(e.services={}))})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){function t(r,t,o){return e.reportServerHost.services.errorService=new i(r,t,o),e.reportServerHost.services.errorService}var o=jsCommon.TraceType;r.createErrorService=t;var i=(function(){function r(r,t,o){if(this.localizationService=t,this.telemetryService=r,this.customTraceLoggerService=o,this.localizationService)var i={closePromptText:this.localizationService.get("PBI_Button_Label_Close"),refreshPagePromptText:this.localizationService.get("ModalDialogButtonText_RefreshPage"),showTechnicalDetailsText:this.localizationService.get("ErrorShowTechnicalDetails"),errorDialogHelperText:this.localizationService.get("ErrorDialogHelperText")};this.modalDialog=e.common.ModalDialogService.errorServiceModalDialogControl(i)}return r.prototype.error=function(t,i,s,a,c){var l=this;n.logTelemetry(this.telemetryService,n.getRequestId(s),n.getClientActivityId(s),i,c);var u;s&&s.showAdditionalErrorInfo===!1?u=null:(s=this.ensureRequestId(s),u=n.getErrorInfo(this.telemetryService,s)),e.common.localize.ensureLocalization((function(){l.customTraceLoggerService&&l.customTraceLoggerService.flushLogEntries();var i=e.common.localize.get("ErrorMessage_DefaultTitle");l.modalDialog.showCustomError(s?s.title||i:i,t,s?s.level:o.Error,!s||s.isDismissable,u,s?s.dismissCallback:null,s?s.dialogOptions:null,null,s?s.onDialogClosed:null,a,s?s.customErrorDialogHelperText:null,r.modalDialogCssClass)}))},r.prototype.errorNoDefaultAdditionalErrorInfo=function(r,t,i){var n,s=this;n=i&&i.showAdditionalErrorInfo===!1?null:i.displayableErrorInfo,e.common.localize.ensureLocalization((function(){var t={label:e.common.localize.get("TopNav_HelpMenu_GetHelp"),url:i&&i.helpLink?i.helpLink:jsCommon.PowerBIDefaultHelpPage},a=e.common.localize.get("ErrorMessage_DefaultTitle");s.modalDialog.showCustomError(i?i.title||a:a,r,i?i.level:o.Error,!i||i.isDismissable,n,i?i.dismissCallback:null,i?i.dialogOptions:null,t,i?i.onDialogClosed:null)}))},r.prototype.fatalCustom=function(r,t,i){_.isEmpty(i)||n.logTelemetry(this.telemetryService,"","",i);var s={label:e.common.localize.get("TopNav_HelpMenu_GetHelp"),url:jsCommon.PowerBIDefaultHelpPage};this.modalDialog.showCustomError(r,t,o.Fatal,!1,null,null,null,s)},r.prototype.fatal=function(e,r){n.logTelemetry(this.telemetryService,"","",r),this.modalDialog.showError(e,o.Fatal)},r.prototype.warning=function(e){this.modalDialog.showError(e,o.Warning)},r.prototype.info=function(e){this.modalDialog.showError(e,o.Information)},r.prototype.infoCustom=function(e,r){this.modalDialog.showMessage(e,r)},r.prototype.control=function(){return this.modalDialog},r.prototype.ensureRequestId=function(e){if(e&&!_.isEmpty(e.requestId))return e;var r=this.customTraceLoggerService;if(!r)return e;var t=r.getLatestErrorTraceEntry();return t&&t.requestId&&(e=e||{},e.requestId=t.requestId),e},r.modalDialogCssClass="reportServer",r})();r.ErrorService=i;var n=(function(){function r(){}return r.getRequestId=function(e){return e&&!_.isEmpty(e.requestId)?e.requestId:""},r.getClientActivityId=function(e){return e&&!_.isEmpty(e.ecsCorrelationId)?e.ecsCorrelationId:""},r.getErrorInfo=function(t,o){var i,n=[],s=r.getRequestId(o);return o&&o.displayableErrorInfo&&(n=o.displayableErrorInfo),e.common.localize.ensureLocalization((function(){s&&(i={errorInfoKey:e.common.localize.get("AdditionalErrorInfo_RequestIdText"),errorInfoValue:s},n.push(i)),o&&!_.isEmpty(o.statusCode)&&(i={errorInfoKey:e.common.localize.get("AdditionalErrorInfo_ErrorCodeText"),errorInfoValue:o.statusCode},n.push(i));var r=o&&o.errorTime?o.errorTime.toLocaleString():(new Date).toString();i={errorInfoKey:e.common.localize.get("AdditionalErrorInfo_TimestampText"),errorInfoValue:r},n.push(i),"undefined"==typeof e.build||_.isEmpty(e.build)||(i={errorInfoKey:e.common.localize.get("AdditionalErrorInfo_VersionText"),errorInfoValue:e.build},n.push(i))})),n},r.logTelemetry=function(r,t,o,i,n){void 0===n&&(n=null),r.logEvent(e.telemetry.DashboardErrorDialog,t,o,i,n,"")},r})();r.ErrorOptionsHelper=n})(t=r.services||(r.services={}))})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){function t(e){switch(e){case i.AllowScripts:return"allow-scripts";case i.AllowPopups:return"allow-popups";case i.AllowSameOrigin:return"allow-same-origin";case i.AllowForms:return"allow-forms"}}function o(e,r,t,o,i,s){return new n(e,r,t,o,i,s)}var i;!(function(e){e[e.AllowScripts=0]="AllowScripts",e[e.AllowPopups=1]="AllowPopups",e[e.AllowSameOrigin=2]="AllowSameOrigin",e[e.AllowForms=3]="AllowForms"})(i=r.SandboxProperty||(r.SandboxProperty={})),r.SandboxPropertyTranslator=t,r.createTrustedVisualService=o;var n=(function(){function r(e,r,t,o,i,n){this.promiseFactory=e,this.telemetryService=r,this.visualConsent=t,this.approvedResourceService=o,this.resourceLoader=n,this.trustedVisualsMap={}}return r.prototype.registerTrustedVisual=function(e,r){this.trustedVisualsMap[e]=r,r.registerVisualConsentOptions&&this.visualConsent.registerVisualConsent(e,r.registerVisualConsentOptions),this.approvedResourceService&&this.approvedResourceService.addTrustedVisual(e)},r.prototype.isTrustedVisual=function(e){return!!this.trustedVisualsMap[e]},r.prototype.validate=function(e){if(this.isTrustedVisual(e)){var r=this.trustedVisualsMap[e]&&this.trustedVisualsMap[e].providers&&this.trustedVisualsMap[e].providers.validator;return r?r.getErrorDetails():void 0}},r.prototype.loadTrustedVisualPlugins=function(r){var t=this;if(!this.resourceLoader)return this.promiseFactory.reject();var o;o=r?r:this.getAllTrustedVisualTypes();var i=_.filter(o,(function(e){return t.isTrustedVisualAllowed(e)&&t.trustedVisualsMap[e].automaticallyImport}));return this.telemetryService.logEvent(e.telemetry.TrustedVisualLoad,r?r.join(","):"",o?o.join(","):"",this.telemetryService.root.id,!1,e.telemetry.ErrorSource.PowerBI),0===i.length?this.promiseFactory.resolve([]):this.resourceLoader.loadTrustedResourcePackages(i).catch((function(e){return t.promiseFactory.reject(e)})).then((function(e){return e&&e.length>0&&e[0].length>0&&e[0][0].length>0?t.promiseFactory.resolve(e[0][0]):t.promiseFactory.resolve([])}))},r.prototype.getVisualTypeOptions=function(e){if(this.isTrustedVisual(e))return this.trustedVisualsMap[e].visualTypeOptions},r.prototype.getConsentAndLoadVisuals=function(r){var t=this;return this.telemetryService.logEvent(e.telemetry.TrustedVisualGetConsent,r?r.join(","):"",this.telemetryService.root.id,!1,e.telemetry.ErrorSource.PowerBI),this.visualConsent.getConsent(r).then((function(r){var o=_.map(_.filter(r,(function(r){return r.consent!==e.visualHost.UserConsent.Declined})),(function(e){return e.visualType}));return t.loadTrustedVisualPlugins(o)}))},r.prototype.canLoadVisual=function(e){return!this.isTrustedVisual(e)||!!this.isTrustedVisualAllowed(e)&&(!this.trustedVisualsMap[e].registerVisualConsentOptions||this.visualConsent.hasConsent(e))},r.prototype.getAllTrustedVisualTypes=function(){return _.keys(this.trustedVisualsMap)},r.prototype.isTrustedVisualAllowed=function(e){if(!this.isTrustedVisual(e))return!1;var r=this.trustedVisualsMap[e]&&this.trustedVisualsMap[e].providers&&this.trustedVisualsMap[e].providers.blocker;return!r||!r.blockedInCluster()&&!r.blockedInTenant()},r})()})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){function t(e,r,t,o){return new i(e,r,t,o)}r.createReportServerResourceLoader=t;var o;!(function(e){e.loadResourcePackage="loadResourcePackage",e.loadVisualPlugin="loadVisualPlugin",e.loadVisualPluginWithContent="loadVisualPluginWithContent",e.onVisualPluginLoad="onVisualPluginLoad",e.onResourcePackageLoad="onResourcePackageLoad",e.onVisualPluginLoadError="onVisualPluginLoadError",e.onResourcePackageLoadError="onResourcePackageLoadError"})(o||(o={}));var i=(function(){function r(e,r,t,o){this.locale=e&&e.locale,this.promiseFactory=e.promiseFactory,this.messageProxy=r,this.sandboxLoaderUri=t,this.provider=o,this.initIFrame()}return r.prototype.loadResourcePackage=function(e){return this.loadVisualPlugin(e)},r.prototype.loadResourcePackages=function(e){for(var r=[],t=0,o=e;t<o.length;t++){var i=o[t];r.push(this.loadResourcePackage(i))}return this.promiseFactory.all(r)},r.prototype.loadTrustedResourcePackages=function(e){return this.promiseFactory.reject()},r.prototype.loadResourcePackageItem=function(e,r){var t=_.find(e.items,(function(e){return e.name===r}));return t?t.content?this.promiseFactory.resolve(t.content):this.getBlob(e.id,t.name,t):this.promiseFactory.resolve(null)},r.prototype.loadSharedResource=function(e){return this.promiseFactory.reject()},r.prototype.loadVisualPlugin=function(r){var t=this,i=this.promiseFactory.defer();return this.loadResourcesContent(r).then((function(n){var s=_.indexBy(n,"type"),a=s[5];if(a)try{var c=jsCommon.JsonExtensions.tryParseJSON(a.content),l=e.visualHost.visualPluginUtility.createVisualPlugin(c,t.locale),u=_.find(r.items,(function(e){return 5===e.type}));if(u.content){var p=void 0;p=_.isString(u.content)?jsCommon.JsonExtensions.tryParseJSON(u.content):u.content,p.content=void 0,u.content=JSON.stringify(p)}e.extensibility.visualPluginAdapter.transformPlugin(l),e.visuals.plugins[l.name]=l,i.resolve(l)}catch(e){i.reject(e)}else{var d={pluginName:r.name,mappedPluginContent:s},v={eventName:o.loadVisualPluginWithContent,arguments:[d]};t.messageProxy.postMessageAsync(v).then((function(r){var t=r,o=e.visuals.plugins[t.name];if(!o||o.custom){t.custom=!0;var n=t.capabilities.objects;t.capabilities.objects=e.data.services.DataViewObjectDescriptorSerializer.deserialize(n),e.extensibility.visualPluginAdapter.transformPlugin(t),e.visuals.plugins[t.name]=t,i.resolve(t)}})).catch((function(e){i.reject(e)}))}})).catch((function(e){i.reject(e)})),i.promise},r.prototype.loadVisualPlugins=function(e){var r=[];if(e)for(var t=0,o=e;t<o.length;t++){var i=o[t];r.push(this.loadVisualPlugin(i))}return this.promiseFactory.all(r)},r.prototype.destroy=function(){this.iframe.remove(),this.iframe=null,this.messageProxy.destroy(),this.messageProxy=null,this.contentWindow=null},r.prototype.initIFrame=function(){var e=this,r=this.sandboxLoaderUri;jsCommon.QueryStringUtil.getQueryStringValue("unmin")&&(r+="?unmin=1"),this.iframe=$('<iframe class="sandbox-resource-loader ng-hide" sandbox="allow-scripts"></iframe>').attr("src",r).one("load",(function(){return e.onIFrameLoad()})).appendTo(document.body)},r.prototype.onIFrameLoad=function(){this.contentWindow=this.iframe[0].contentWindow,this.messageProxy.contentWindow=this.contentWindow,this.messageProxy.flushQueue()},r.prototype.loadResourcesContent=function(e){for(var r=[],t=e.id,o=e.name,i=0,n=e.items;i<n.length;i++){var s=n[i];3!==s.type&&r.push(this.loadResourceContent(t,o,s))}return this.promiseFactory.all(r)},r.prototype.loadResourceContent=function(e,r,t){var o=this,i=this.promiseFactory.defer();return this.provider.get(e,r,t.path).then((function(e){i.resolve(o.getItemContent(e,t))})).catch((function(e){i.reject(e)})),i.promise},r.prototype.getItemContent=function(e,r){var t=_.isString(e)?e:JSON.stringify(e);return r.content=5===r.type?t:void 0,{type:r.type,content:t}},r.prototype.getBlob=function(e,r,t){var o=this.promiseFactory.defer();return t.contentBlob?o.resolve(t.contentBlob):this.provider.getBlob(e,r,t.path).then((function(e){t.contentBlob=e,o.resolve(e)})).catch((function(e){o.reject(e)})),o.promise},r})()})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){function t(r,t,o,n,s){n.register("resourceLoader",{services:["promiseFactory","featureSwitchService","visualSandbox","approvedResourceService","resourcePackagesService","telemetryService"],fn:function(r,t,o,n,s,a){var c={promiseFactory:r,locale:e.common.localization.loader.currentLanguageLocale},l=i(c,o),u={localResourceLoaderFactory:function(){return l},sandboxResourceLoaderFactory:function(){return l},approvedResourceLoaderFactory:function(){return l},trustedResourceLoaderFactory:function(){return null}},p={getSandboxVisualsEnabled:function(){return t.featureSwitches.sandboxVisualsEnabled},getApprovedResourcesEnabled:function(){return!t.featureSwitches.approvedResourcesDisabled}};return e.visualHost.createConditionalResourceLoader(r,p,u,n)}});var a=c.id,l=c.filter;window.reportServerSessionId=jsCommon.Utility.generateGuid();var u={onLoadSuccess:function(){o.onLoadSuccess()},onLoadFailed:function(){o.onLoadFailed()},reportObjectId:a,tokenRefreshEnabled:!1,additionalODataFilter:l,explorationContainerOptions:{showAppBar:!1,showTaskPane:!0,showVisualizationPane:!0,showNavContentPane:!0,showBackButtonOnAppBar:!1,visualContainerOptions:{disablePin:!0,showPin:!1,showMenu:!0}}};StandaloneHost.loadReport(u)}function o(e){}function i(t,o){var i=e.visualHost.createWindowMessageProxy(t.promiseFactory),n=e.visualSandbox.getResourceLoaderUrl(),s=window.resourceLoaderIncludePackageId===!0,a=r.createReportServerResourceItemProxy(e.common.httpService,n,u,s);return e.reportServerHost.createReportServerResourceLoader(t,i,o.settings.resourceLoaderUri,a)}function n(){var r=e.visualHost.createVisualSandboxProvider(),t=r.settings;return t.visualSandboxUri="/powerbi/sandbox/VisualSandbox.htm",t.visualSandboxMinimalUri="/powerbi/sandbox/VisualSandboxMinimal.htm",t.resourceLoaderUri="/powerbi/sandbox/VisualResourceLoader.htm",r.config(t),r}function s(){var r=[{name:"ExploreCanvasPrinter",dependencies:["$rootScope","$compile","featureSwitchService","localizationService"],blockType:1,consumerHostFlags:8}];e.common.registerBuildingBlocksForHost(8,r,{componentsTarget:"powerbi.components",componentsMap:e.components,directivesTarget:"powerbi.directives",directivesMap:e.directives,filtersTarget:"powerbi.filters"})}var a=["powerbi.standaloneReportHost"],c=jsCommon.QueryStringUtil.parseQueryString(),l=c.id,u="/explore/resourcePackageItem/"+l;window.resourceLoaderUrl="/explore/customvisuals/"+l,angular.module("powerbi.reportServerHost",a).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,o,i){i.html5Mode(!0),o.otherwise("/powerbi/"),t.state("reportServerHost",{url:"/powerbi/",controller:e.common.createController(r.controllers.ReportServerHostController),templateUrl:"views/reportServerHost.html",reloadOnSearch:!1,resolve:e.common.helpers.LoadJQueryUI})}]).config(["moduleLoaderProvider",function(e){var r=e.config.paths;r["angular-ui-datetimepicker"]="powerbi/libs/scripts/angular-ui-datetimepicker",r.filesaver="powerbi/libs/scripts/filesaver",r.quill="powerbi/libs/scripts/quill.min",r["jquery-ui"]="powerbi/libs/scripts/jquery-ui",r.resizeSensor="powerbi/libs/scripts/resizeSensor",r.topojson="powerbi/libs/scripts/topojson.min",r["powerbi-models"]="powerbi/libs/scripts/powerbi-models.min",r.accessibleTableVisual="powerbi/libs/scripts/accessibleTableVisual",r.basicShapeVisual="powerbi/libs/scripts/basicShapeVisual",r.cartesianVisuals="powerbi/libs/scripts/cartesianVisuals",r.donutChartVisuals="powerbi/libs/scripts/donutChartVisuals",r.exploreActions="powerbi/libs/scripts/exploreActions",r.exploreUIShell="powerbi/libs/scripts/exploreUIShell",r.exploreUIDialogs="powerbi/libs/scripts/exploreUIDialogs",r.funnelChartVisual="powerbi/libs/scripts/funnelChartVisual",r.insights="powerbi/libs/scripts/insights",r.jsonFilter="powerbi/libs/scripts/jsonFilter",r.imageVisual="powerbi/libs/scripts/imageVisual",r.kpiVisual="powerbi/libs/scripts/kpiVisual",r.mapVisuals="powerbi/libs/scripts/mapVisuals",r.multiRowCardVisual="powerbi/libs/scripts/multiRowCardVisual",r.odataExplore="powerbi/libs/scripts/oDataExplore",r.odataFilterParser="powerbi/libs/scripts/odataFilterParser",r.pivotTableVisuals="powerbi/libs/scripts/pivotTableVisuals",r.scriptVisual="powerbi/libs/scripts/scriptVisual",r.shapeMapVisual="powerbi/libs/scripts/shapeMapVisual",r.singleValueVisuals="powerbi/libs/scripts/singleValueVisuals",r.slicerVisual="powerbi/libs/scripts/slicerVisual",r.sunburstVisual="powerbi/libs/scripts/sunburstVisual",r.textboxVisual="powerbi/libs/scripts/textboxVisual",r.treemapVisual="powerbi/libs/scripts/treemapVisual",r.uiComponents="powerbi/libs/scripts/uiComponents";var t=e.config.cssPaths;t.accessibleTableVisual="powerbi/libs/styles/accessibleTableVisual",t.exploreUIShell="powerbi/libs/styles/exploreUIShell",t.exploreUIDialogs="powerbi/libs/styles/exploreUIDialogs",t["jquery-ui"]="powerbi/libs/styles/jquery-ui",t.pivotTableVisuals="powerbi/libs/styles/pivotTableVisuals",t.insights="powerbi/libs/styles/insights"}]).factory("hostTypeResolutionService",[function(){return new e.common.HostTypeResolutionService("phantomjs")}]).factory("standaloneReportHostProxyService",["explorationProxy","promiseFactory","errorService","localizationService",function(e,t,o,i){return r.services.createReportServerReportHostProxyService(e,t,o,i)}]).provider("visualSandbox",[function(){return n()}]).factory("resourcePackagesService",[function(){return e.visualHost.createResourcePackagesService()}]).factory("renderingSynchronizer",["$window",function(r){return e.visualHost.createRenderingSynchronizer(r)}]).factory("approvedResourceService",[function(){return e.visualHost.createApprovedResourceService()}]).factory("groupService",(function(){return[]})).factory("activeGroupId",["promiseFactory","featureSwitchService",function(r,t){return e.common.createHostActiveGroupIdService(r,t)}]).factory("contentPackService",(function(){return[]})).factory("reportService",(function(){return[]})).factory("modelService",(function(){return[]})).factory("dashboardService",(function(){return[]})).factory("workbookService",(function(){return[]})).factory("fullScreen",(function(){return{subscribe:_.noop,unsubscribe:_.noop}})).factory("usageMetricsReport",(function(){return[]})).factory("appService",["promiseFactory",function(r){return e.dataServices.createMockAppService(r)}]).factory("modelConverter",["telemetryService","errorService","visualPlugin","promiseFactory","geolocationService","dataServiceModelConverter","localizationService",function(r,t,o,i,n,s,a){return e.models.createModelConverter(r,t,o,i,n,s,a)}]).factory("licenseEnforcementService",(function(){return[]})).factory("userInfo",(function(){return{userLicense:function(){}}})).factory("activeGroupId",(function(){return[]})).factory("dashboardDataService",(function(){return[]})).factory("appService",(function(){return[]})).factory("userSettingsService",["promiseFactory",function(e){return{getUserSettings:function(){return e.resolve(null)}}}]).factory("userSettingsHttpService",["promiseFactory",function(e){return{getUserSettings:function(){return e.resolve(null)}}}]).factory("favoritesHttp",(function(){return[]})).factory("printService",["$rootScope",function(r){return e.createPrintService(r)}]).factory("errorService",["telemetryService","localizationService","customTraceLoggerService",function(r,t,o){return e.reportServerHost.services.createErrorService(r,t,o)}]).factory("trustedVisual",["promiseFactory","telemetryService","visualConsent","approvedResourceService","visualSandbox","resourceLoader",function(r,t,o,i,n,s){return e.visualHost.createTrustedVisualService(r,t,o,i,n,s)}]).factory("resourceLoader",["promiseFactory","featureSwitchService","visualSandbox","approvedResourceService","resourcePackagesService","telemetryService",function(r,t,o,n,s,a){var c={promiseFactory:r,locale:e.common.localization.loader.currentLanguageLocale},l=i(c,o),u={localResourceLoaderFactory:function(){return l},sandboxResourceLoaderFactory:function(){return l},approvedResourceLoaderFactory:function(){return l},trustedResourceLoaderFactory:function(){return null}},p={getSandboxVisualsEnabled:function(){return t.featureSwitches.sandboxVisualsEnabled},getApprovedResourcesEnabled:function(){return!t.featureSwitches.approvedResourcesDisabled}};return e.visualHost.createConditionalResourceLoader(r,p,u,n)}]).factory("visualPlugin",["featureSwitchService","mapControlFactory","promiseFactory","resourceLoader","visualSandbox",function(r,t,o,i,n){return e.explore.services.createExplorationVisualPluginService(r,o,i,t,n)}]).config(["telemetryServiceProvider",function(r){r.hostService=e.telemetry.createTelemetryHostService()}]).provider("dataReaderProvider",(function(){var r=c.id,t="explore/reports/"+r+"/querydata",o="explore/reports/"+r+"/conceptualschema",i=this;return i.$get=["promiseFactory","featureSwitchService","delayedQueryResultHandler","localizationService","telemetryService",function(r,n,s,a,c){var l=e.common.httpService,u={dsr:{name:"dsr",reader:function(o){return new e.data.dsr.DsrDataReader(o,i.executeSemanticQueryProxyCommunication||e.data.dsr.createExecuteSemanticQueryProxyHttpCommunication(l,c,r,t),s,n.featureSwitches.cellLevelFormatting)},queryGenerator:function(){return e.data.dsr.createQueryGenerator()},schemaReader:function(){return e.data.dsr.createConceptualSchemaReader(r,c,e.data.dsr.createConceptualSchemaProxyHttpCommunication(e.common.httpService,r,o),e.data.dsr.ConceptualSchemaFactory.createLocOptions(a))}}},p={};return e.explore.dataReaderPlugins.registerExplorationDataReaderExtension(p,r,!1),e.data.createDataReaderProvider(e.data.createDataReaderFactory(u,p),{promiseFactory:function(){return r}})}],i})).run(["printService",function(){}]).run(["telemetryService","errorService","standaloneReportHostProxyService","scopedProvider","featureSwitchService",t]),r.registerBuildingBlocksForHost=o,r.createResourceLoader=i,r.createVisualSandboxProvider=n,s()})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={})),angular.module("powerbi.reportServerHost").run(["$templateCache",function(e){e.put("views/reportServerHost.html","<standalone-report-host></standalone-report-host>")}]);var powerbi;!(function(e){var r;!(function(e){var r;!(function(r){var t=(function(){function r(r,t){var o=e.services.createScopedServices(t.scopedProvider),i=e.services.createApiService(o,r),n=e.services.createWindowParentSameUrlMessageProxy(t.$location);this.apiMessageProxy=e.services.createApiMessageProxy(i,n,r),this.apiMessageProxy.startListening()}return r.createOptions=function(){return{additionalServices:["scopedProvider","$location"]}},r})();r.ReportServerHostController=t})(r=e.controllers||(e.controllers={}))})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){function t(e,r,t,i){return new o(e,r,t,i)}r.createReportServerResourceItemProxy=t;var o=(function(){function r(e,r,t,o){this.httpService=e,this.customVisualResourceUri=r,this.staticResourceUri=t,this.includePackageIdInUri=o}return r.prototype.get=function(r,t,o){var i=this.customVisualResourceUri;this.includePackageIdInUri&&(i=this.customVisualResourceUri+r+"/");var n=jsCommon.Utility.urlCombine(i,encodeURIComponent(t+"."+o)),s=this.httpService.powerbiRequestOptions();return s.timeout=e.visualHost.resourceLoaderHttpTimeout,this.httpService.get(n,s).then((function(e){return e.data}))},r.prototype.getBlob=function(e,r,t){var o=this.staticResourceUri;this.includePackageIdInUri&&(o=this.staticResourceUri+e+"/");var i=jsCommon.Utility.urlCombine(o,encodeURIComponent(t)),n=this.httpService.powerbiRequestOptions();return n.responseType=jsCommon.HttpConstants.Blob,this.httpService.get(i,n).then((function(e){return e.data}))},r})()})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){function r(e,r,o){return new t(e,r,o)}e.IToolbarActionMessageKind="powerbi.reportServerHost.IToolbarActionMessage",e.IToolbarButtonSelectedStateMessageKind="powerbi.reportServerHost.IToolbarButtonSelectedStateMessage",e.IToolbarButtonEnabledStateMessageKind="powerbi.reportServerHost.IToolbarButtonEnabledStateMessage",e.createApiMessageProxy=r;var t=(function(){function r(e,r,t){this.apiService=e,this.windowMessageProxy=r,this.scope=t}return r.prototype.startListening=function(){var e=this,r=function(r){return e.onMessageReceived(r)};this.windowMessageProxy.startListening(r),this.scope.$on("$destroy",(function(){e.windowMessageProxy.stopListening()})),this.scope.$watch((function(){return e.apiService.isSeeDataSelected()}),(function(r,t){return e.sendToolbarButtonSelectedStateUpdate("seeData",r)})),this.scope.$watch((function(){return e.apiService.isDrillDownSelected()}),(function(r,t){return e.sendToolbarButtonSelectedStateUpdate("drillDown",r)})),this.scope.$watch((function(){return e.apiService.isSeeRecordsSelected()}),(function(r,t){return e.sendToolbarButtonSelectedStateUpdate("seeRecords",r)})),this.scope.$watch((function(){return e.apiService.isSeeDataEnabled()}),(function(r,t){return e.sendToolbarButtonEnabledStateUpdate("seeData",r)})),this.scope.$watch((function(){return e.apiService.isExpandVisualEnabled()}),(function(r,t){return e.sendToolbarButtonEnabledStateUpdate("expandVisual",r)})),this.scope.$watch((function(){return e.apiService.isExpandVisualGroupedEnabled()}),(function(r,t){return e.sendToolbarButtonEnabledStateUpdate("expandVisualGrouped",r)})),this.scope.$watch((function(){return e.apiService.isDrillDownEnabled()}),(function(r,t){return e.sendToolbarButtonEnabledStateUpdate("drillDown",r)})),this.scope.$watch((function(){return e.apiService.isDrillUpEnabled()}),(function(r,t){return e.sendToolbarButtonEnabledStateUpdate("drillUp",r)})),this.scope.$watch((function(){return e.apiService.isSeeRecordsEnabled()}),(function(r,t){return e.sendToolbarButtonEnabledStateUpdate("seeRecords",r)}))},r.prototype.sendToolbarButtonSelectedStateUpdate=function(r,t){this.windowMessageProxy.sendMessage({kind:e.IToolbarButtonSelectedStateMessageKind,button:r,isSelected:t})},r.prototype.sendToolbarButtonEnabledStateUpdate=function(r,t){this.windowMessageProxy.sendMessage({kind:e.IToolbarButtonEnabledStateMessageKind,button:r,isEnabled:t})},r.prototype.onMessageReceived=function(r){if(r.data.kind===e.IToolbarActionMessageKind){var t=r.data;switch(t.button){case"print":this.apiService.print();break;case"setToActualSize":this.apiService.setToActualSize();break;case"fitToWidth":this.apiService.fitToWidth();break;case"fitToPage":this.apiService.fitToPage();break;case"seeData":this.apiService.seeData();break;case"expandVisual":this.apiService.expandVisual();break;case"expandVisualGrouped":this.apiService.expandVisualGrouped();break;case"drillUp":this.apiService.drillUp();break;case"drillDown":this.apiService.drillDown();break;case"seeRecords":this.apiService.seeRecords();break;case"refresh":this.apiService.refresh()}}},r})()})(r=e.services||(e.services={}))})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(r){var t;!(function(r){function t(e,r){return new n(e,r)}var o=e.explore.services.events,i=e.explore.services.selectionUtils;r.createApiService=t;var n=(function(){function e(e,r){this.scopedServices=e,this.scope=r}return e.prototype.print=function(){jsCommon.BrowserUtility.isInternetExplorerBrowser()?window.document.execCommand("print",!1,null):window.print()},e.prototype.setToActualSize=function(){this.scopedServices.getEventBridge().publishToChannel(o.canvasDisplayChanged,3)},e.prototype.fitToWidth=function(){this.scopedServices.getEventBridge().publishToChannel(o.canvasDisplayChanged,2)},e.prototype.fitToPage=function(){this.scopedServices.getEventBridge().publishToChannel(o.canvasDisplayChanged,1)},e.prototype.seeData=function(){this.toggleSeeDataMode(),this.applyScopeIfNeeded()},e.prototype.expandVisual=function(){this.drillDownLevel(3),this.applyScopeIfNeeded()},e.prototype.expandVisualGrouped=function(){this.drillDownLevel(2),this.applyScopeIfNeeded()},e.prototype.drillUp=function(){this.drillUpLevel(),this.applyScopeIfNeeded()},e.prototype.drillDown=function(){this.setDrillMode(1),this.applyScopeIfNeeded()},e.prototype.seeRecords=function(){this.setDrillMode(2),this.applyScopeIfNeeded()},e.prototype.refresh=function(){this.scopedServices.getEventBridge().publishToChannel(o.refreshExploration)},e.prototype.isSeeDataSelected=function(){var e=this.scopedServices.getPopOut().get();return e&&2===e.visibility},e.prototype.isDrillDownSelected=function(){return this.scopedServices.getDrill().isDrillModeEnabled(this.getSelectedVisual(),1)},e.prototype.isSeeRecordsSelected=function(){return this.scopedServices.getDrill().isDrillModeEnabled(this.getSelectedVisual(),2)},e.prototype.isSeeDataEnabled=function(){return this.scopedServices.getDrill().canSeeData(this.getSelectedVisual())},e.prototype.isExpandVisualEnabled=function(){return this.scopedServices.getDrill().canDrillByDirection(this.getSelectedVisual(),4)},e.prototype.isExpandVisualGroupedEnabled=function(){return this.scopedServices.getDrill().canDrillByDirection(this.getSelectedVisual(),2)},e.prototype.isDrillDownEnabled=function(){return this.isExpandVisualEnabled()||this.isDrillUpEnabled()},e.prototype.isDrillUpEnabled=function(){return this.scopedServices.getDrill().canDrillByDirection(this.getSelectedVisual(),1)},e.prototype.isSeeRecordsEnabled=function(){return this.scopedServices.getDrill().canDrillToDetails(this.getSelectedVisual())},e.prototype.toggleSeeDataMode=function(){var e=this.scopedServices.getPopOut().get()||this.getSelectedVisual();if(e){var r=e.visibility;2===r?this.scopedServices.getPopOut().clear():this.scopedServices.getPopOut().set(e,2)}},e.prototype.drillUpLevel=function(){this.scopedServices.getVisualAuthoring().drillUp(null,this.getSelectedVisual());
},e.prototype.drillDownLevel=function(e){this.scopedServices.getVisualAuthoring().drillDownLevel(null,this.getSelectedVisual(),e)},e.prototype.setDrillMode=function(e){var r=this.getSelectedVisual();if(r){var t=r.drillMode,o=t===e?0:e;this.scopedServices.getDrill().setDrillMode(r,o)}},e.prototype.getSelectedVisual=function(){return i.getSelectedVisual(this.scopedServices.getSelection())},e.prototype.applyScopeIfNeeded=function(){var e=this.scope.$$phase;"$apply"!==e&&"$digest"!==e&&this.scope.$apply()},e})()})(t=r.services||(r.services={}))})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){function r(e){return new t(e)}e.createScopedServices=r;var t=(function(){function e(e){this.scopedProvider=e}return e.prototype.getEventBridge=function(){return this.getRegisteredScopedProviderByName("eventBridge")},e.prototype.getSelection=function(){return this.getRegisteredScopedProviderByName("selection")},e.prototype.getPopOut=function(){return this.getRegisteredScopedProviderByName("visibility")},e.prototype.getDrill=function(){return this.getRegisteredScopedProviderByName("drill")},e.prototype.getVisualAuthoring=function(){return this.getRegisteredScopedProviderByName("visualAuthoring")},e.prototype.getRegisteredScopedProviderByName=function(e){var r=this.getExplorationContainerScope();if(r){var t=this.scopedProvider.find(r).get(e,r);return t}return null},e.prototype.getExplorationContainerScope=function(){var e=this.getExplorationContainerElement();return e?e.isolateScope():null},e.prototype.getExplorationContainerElement=function(){return angular.element(".explorationContainer")},e})()})(r=e.services||(e.services={}))})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var r;!(function(e){var r;!(function(e){function r(e){return new t(e)}e.createWindowParentSameUrlMessageProxy=r;var t=(function(){function e(e){this.location=e}return e.prototype.startListening=function(e){var r=this;this.messageEventListener&&this.stopListening(),this.messageEventListener=function(t){return r.onMessageReceived(t,e)},window.addEventListener("message",this.messageEventListener,!1)},e.prototype.stopListening=function(){window.removeEventListener("message",this.messageEventListener,!1),this.messageEventListener=null},e.prototype.getRootUrlWithPort=function(){return this.getRootUrl()+":"+this.location.port()},e.prototype.getRootUrl=function(){return this.location.protocol()+"://"+this.location.host()},e.prototype.sendMessage=function(e){window.parent.postMessage(e,this.getRootUrlWithPort())},e.prototype.onMessageReceived=function(e,r){e.origin!==this.getRootUrl()&&e.origin!==this.getRootUrlWithPort()||r(e)},e})()})(r=e.services||(e.services={}))})(r=e.reportServerHost||(e.reportServerHost={}))})(powerbi||(powerbi={}));

window.parseTimeMarkers['powerbireportserverhost.bundle.min.js'].end = Date.now();
